function $ae(e,t){for(var i=0;i<t.length;i++){const r=t[i];if(typeof r!="string"&&!Array.isArray(r)){for(const n in r)if(n!=="default"&&!(n in e)){const s=Object.getOwnPropertyDescriptor(r,n);s&&Object.defineProperty(e,n,s.get?s:{enumerable:!0,get:()=>r[n]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function i(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(n){if(n.ep)return;n.ep=!0;const s=i(n);fetch(n.href,s)}})();var W_=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function gF(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var xY={exports:{}},eC={},wY={exports:{}},Ui={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var gb=Symbol.for("react.element"),eoe=Symbol.for("react.portal"),toe=Symbol.for("react.fragment"),ioe=Symbol.for("react.strict_mode"),roe=Symbol.for("react.profiler"),noe=Symbol.for("react.provider"),soe=Symbol.for("react.context"),aoe=Symbol.for("react.forward_ref"),ooe=Symbol.for("react.suspense"),loe=Symbol.for("react.memo"),coe=Symbol.for("react.lazy"),eV=Symbol.iterator;function uoe(e){return e===null||typeof e!="object"?null:(e=eV&&e[eV]||e["@@iterator"],typeof e=="function"?e:null)}var bY={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},_Y=Object.assign,SY={};function J0(e,t,i){this.props=e,this.context=t,this.refs=SY,this.updater=i||bY}J0.prototype.isReactComponent={};J0.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};J0.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function MY(){}MY.prototype=J0.prototype;function vF(e,t,i){this.props=e,this.context=t,this.refs=SY,this.updater=i||bY}var yF=vF.prototype=new MY;yF.constructor=vF;_Y(yF,J0.prototype);yF.isPureReactComponent=!0;var tV=Array.isArray,EY=Object.prototype.hasOwnProperty,xF={current:null},AY={key:!0,ref:!0,__self:!0,__source:!0};function TY(e,t,i){var r,n={},s=null,a=null;if(t!=null)for(r in t.ref!==void 0&&(a=t.ref),t.key!==void 0&&(s=""+t.key),t)EY.call(t,r)&&!AY.hasOwnProperty(r)&&(n[r]=t[r]);var o=arguments.length-2;if(o===1)n.children=i;else if(1<o){for(var l=Array(o),c=0;c<o;c++)l[c]=arguments[c+2];n.children=l}if(e&&e.defaultProps)for(r in o=e.defaultProps,o)n[r]===void 0&&(n[r]=o[r]);return{$$typeof:gb,type:e,key:s,ref:a,props:n,_owner:xF.current}}function hoe(e,t){return{$$typeof:gb,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function wF(e){return typeof e=="object"&&e!==null&&e.$$typeof===gb}function doe(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(i){return t[i]})}var iV=/\/+/g;function C3(e,t){return typeof e=="object"&&e!==null&&e.key!=null?doe(""+e.key):t.toString(36)}function BE(e,t,i,r,n){var s=typeof e;(s==="undefined"||s==="boolean")&&(e=null);var a=!1;if(e===null)a=!0;else switch(s){case"string":case"number":a=!0;break;case"object":switch(e.$$typeof){case gb:case eoe:a=!0}}if(a)return a=e,n=n(a),e=r===""?"."+C3(a,0):r,tV(n)?(i="",e!=null&&(i=e.replace(iV,"$&/")+"/"),BE(n,t,i,"",function(c){return c})):n!=null&&(wF(n)&&(n=hoe(n,i+(!n.key||a&&a.key===n.key?"":(""+n.key).replace(iV,"$&/")+"/")+e)),t.push(n)),1;if(a=0,r=r===""?".":r+":",tV(e))for(var o=0;o<e.length;o++){s=e[o];var l=r+C3(s,o);a+=BE(s,t,i,l,n)}else if(l=uoe(e),typeof l=="function")for(e=l.call(e),o=0;!(s=e.next()).done;)s=s.value,l=r+C3(s,o++),a+=BE(s,t,i,l,n);else if(s==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return a}function X_(e,t,i){if(e==null)return e;var r=[],n=0;return BE(e,r,"","",function(s){return t.call(i,s,n++)}),r}function foe(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(i){(e._status===0||e._status===-1)&&(e._status=1,e._result=i)},function(i){(e._status===0||e._status===-1)&&(e._status=2,e._result=i)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var Ba={current:null},FE={transition:null},poe={ReactCurrentDispatcher:Ba,ReactCurrentBatchConfig:FE,ReactCurrentOwner:xF};function CY(){throw Error("act(...) is not supported in production builds of React.")}Ui.Children={map:X_,forEach:function(e,t,i){X_(e,function(){t.apply(this,arguments)},i)},count:function(e){var t=0;return X_(e,function(){t++}),t},toArray:function(e){return X_(e,function(t){return t})||[]},only:function(e){if(!wF(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};Ui.Component=J0;Ui.Fragment=toe;Ui.Profiler=roe;Ui.PureComponent=vF;Ui.StrictMode=ioe;Ui.Suspense=ooe;Ui.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=poe;Ui.act=CY;Ui.cloneElement=function(e,t,i){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=_Y({},e.props),n=e.key,s=e.ref,a=e._owner;if(t!=null){if(t.ref!==void 0&&(s=t.ref,a=xF.current),t.key!==void 0&&(n=""+t.key),e.type&&e.type.defaultProps)var o=e.type.defaultProps;for(l in t)EY.call(t,l)&&!AY.hasOwnProperty(l)&&(r[l]=t[l]===void 0&&o!==void 0?o[l]:t[l])}var l=arguments.length-2;if(l===1)r.children=i;else if(1<l){o=Array(l);for(var c=0;c<l;c++)o[c]=arguments[c+2];r.children=o}return{$$typeof:gb,type:e.type,key:n,ref:s,props:r,_owner:a}};Ui.createContext=function(e){return e={$$typeof:soe,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:noe,_context:e},e.Consumer=e};Ui.createElement=TY;Ui.createFactory=function(e){var t=TY.bind(null,e);return t.type=e,t};Ui.createRef=function(){return{current:null}};Ui.forwardRef=function(e){return{$$typeof:aoe,render:e}};Ui.isValidElement=wF;Ui.lazy=function(e){return{$$typeof:coe,_payload:{_status:-1,_result:e},_init:foe}};Ui.memo=function(e,t){return{$$typeof:loe,type:e,compare:t===void 0?null:t}};Ui.startTransition=function(e){var t=FE.transition;FE.transition={};try{e()}finally{FE.transition=t}};Ui.unstable_act=CY;Ui.useCallback=function(e,t){return Ba.current.useCallback(e,t)};Ui.useContext=function(e){return Ba.current.useContext(e)};Ui.useDebugValue=function(){};Ui.useDeferredValue=function(e){return Ba.current.useDeferredValue(e)};Ui.useEffect=function(e,t){return Ba.current.useEffect(e,t)};Ui.useId=function(){return Ba.current.useId()};Ui.useImperativeHandle=function(e,t,i){return Ba.current.useImperativeHandle(e,t,i)};Ui.useInsertionEffect=function(e,t){return Ba.current.useInsertionEffect(e,t)};Ui.useLayoutEffect=function(e,t){return Ba.current.useLayoutEffect(e,t)};Ui.useMemo=function(e,t){return Ba.current.useMemo(e,t)};Ui.useReducer=function(e,t,i){return Ba.current.useReducer(e,t,i)};Ui.useRef=function(e){return Ba.current.useRef(e)};Ui.useState=function(e){return Ba.current.useState(e)};Ui.useSyncExternalStore=function(e,t,i){return Ba.current.useSyncExternalStore(e,t,i)};Ui.useTransition=function(){return Ba.current.useTransition()};Ui.version="18.3.1";wY.exports=Ui;var _e=wY.exports;const ar=gF(_e),moe=$ae({__proto__:null,default:ar},[_e]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var goe=_e,voe=Symbol.for("react.element"),yoe=Symbol.for("react.fragment"),xoe=Object.prototype.hasOwnProperty,woe=goe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,boe={key:!0,ref:!0,__self:!0,__source:!0};function PY(e,t,i){var r,n={},s=null,a=null;i!==void 0&&(s=""+i),t.key!==void 0&&(s=""+t.key),t.ref!==void 0&&(a=t.ref);for(r in t)xoe.call(t,r)&&!boe.hasOwnProperty(r)&&(n[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps,t)n[r]===void 0&&(n[r]=t[r]);return{$$typeof:voe,type:e,key:s,ref:a,props:n,_owner:woe.current}}eC.Fragment=yoe;eC.jsx=PY;eC.jsxs=PY;xY.exports=eC;var Te=xY.exports,DY={exports:{}},Uo={},RY={exports:{}},IY={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(z,V){var U=z.length;z.push(V);e:for(;0<U;){var k=U-1>>>1,X=z[k];if(0<n(X,V))z[k]=V,z[U]=X,U=k;else break e}}function i(z){return z.length===0?null:z[0]}function r(z){if(z.length===0)return null;var V=z[0],U=z.pop();if(U!==V){z[0]=U;e:for(var k=0,X=z.length,re=X>>>1;k<re;){var q=2*(k+1)-1,ee=z[q],$=q+1,ne=z[$];if(0>n(ee,U))$<X&&0>n(ne,ee)?(z[k]=ne,z[$]=U,k=$):(z[k]=ee,z[q]=U,k=q);else if($<X&&0>n(ne,U))z[k]=ne,z[$]=U,k=$;else break e}}return V}function n(z,V){var U=z.sortIndex-V.sortIndex;return U!==0?U:z.id-V.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;e.unstable_now=function(){return s.now()}}else{var a=Date,o=a.now();e.unstable_now=function(){return a.now()-o}}var l=[],c=[],u=1,h=null,d=3,f=!1,p=!1,v=!1,m=typeof setTimeout=="function"?setTimeout:null,g=typeof clearTimeout=="function"?clearTimeout:null,y=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function x(z){for(var V=i(c);V!==null;){if(V.callback===null)r(c);else if(V.startTime<=z)r(c),V.sortIndex=V.expirationTime,t(l,V);else break;V=i(c)}}function _(z){if(v=!1,x(z),!p)if(i(l)!==null)p=!0,j(M);else{var V=i(c);V!==null&&Y(_,V.startTime-z)}}function M(z,V){p=!1,v&&(v=!1,g(E),E=-1),f=!0;var U=d;try{for(x(V),h=i(l);h!==null&&(!(h.expirationTime>V)||z&&!D());){var k=h.callback;if(typeof k=="function"){h.callback=null,d=h.priorityLevel;var X=k(h.expirationTime<=V);V=e.unstable_now(),typeof X=="function"?h.callback=X:h===i(l)&&r(l),x(V)}else r(l);h=i(l)}if(h!==null)var re=!0;else{var q=i(c);q!==null&&Y(_,q.startTime-V),re=!1}return re}finally{h=null,d=U,f=!1}}var S=!1,T=null,E=-1,C=5,A=-1;function D(){return!(e.unstable_now()-A<C)}function R(){if(T!==null){var z=e.unstable_now();A=z;var V=!0;try{V=T(!0,z)}finally{V?L():(S=!1,T=null)}}else S=!1}var L;if(typeof y=="function")L=function(){y(R)};else if(typeof MessageChannel<"u"){var O=new MessageChannel,H=O.port2;O.port1.onmessage=R,L=function(){H.postMessage(null)}}else L=function(){m(R,0)};function j(z){T=z,S||(S=!0,L())}function Y(z,V){E=m(function(){z(e.unstable_now())},V)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(z){z.callback=null},e.unstable_continueExecution=function(){p||f||(p=!0,j(M))},e.unstable_forceFrameRate=function(z){0>z||125<z?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):C=0<z?Math.floor(1e3/z):5},e.unstable_getCurrentPriorityLevel=function(){return d},e.unstable_getFirstCallbackNode=function(){return i(l)},e.unstable_next=function(z){switch(d){case 1:case 2:case 3:var V=3;break;default:V=d}var U=d;d=V;try{return z()}finally{d=U}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(z,V){switch(z){case 1:case 2:case 3:case 4:case 5:break;default:z=3}var U=d;d=z;try{return V()}finally{d=U}},e.unstable_scheduleCallback=function(z,V,U){var k=e.unstable_now();switch(typeof U=="object"&&U!==null?(U=U.delay,U=typeof U=="number"&&0<U?k+U:k):U=k,z){case 1:var X=-1;break;case 2:X=250;break;case 5:X=1073741823;break;case 4:X=1e4;break;default:X=5e3}return X=U+X,z={id:u++,callback:V,priorityLevel:z,startTime:U,expirationTime:X,sortIndex:-1},U>k?(z.sortIndex=U,t(c,z),i(l)===null&&z===i(c)&&(v?(g(E),E=-1):v=!0,Y(_,U-k))):(z.sortIndex=X,t(l,z),p||f||(p=!0,j(M))),z},e.unstable_shouldYield=D,e.unstable_wrapCallback=function(z){var V=d;return function(){var U=d;d=V;try{return z.apply(this,arguments)}finally{d=U}}}})(IY);RY.exports=IY;var _oe=RY.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Soe=_e,Oo=_oe;function gt(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,i=1;i<arguments.length;i++)t+="&args[]="+encodeURIComponent(arguments[i]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var LY=new Set,nw={};function Nm(e,t){_0(e,t),_0(e+"Capture",t)}function _0(e,t){for(nw[e]=t,e=0;e<t.length;e++)LY.add(t[e])}var _h=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),TL=Object.prototype.hasOwnProperty,Moe=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,rV={},nV={};function Eoe(e){return TL.call(nV,e)?!0:TL.call(rV,e)?!1:Moe.test(e)?nV[e]=!0:(rV[e]=!0,!1)}function Aoe(e,t,i,r){if(i!==null&&i.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return r?!1:i!==null?!i.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function Toe(e,t,i,r){if(t===null||typeof t>"u"||Aoe(e,t,i,r))return!0;if(r)return!1;if(i!==null)switch(i.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function Fa(e,t,i,r,n,s,a){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=r,this.attributeNamespace=n,this.mustUseProperty=i,this.propertyName=e,this.type=t,this.sanitizeURL=s,this.removeEmptyString=a}var ks={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){ks[e]=new Fa(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];ks[t]=new Fa(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){ks[e]=new Fa(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){ks[e]=new Fa(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){ks[e]=new Fa(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){ks[e]=new Fa(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){ks[e]=new Fa(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){ks[e]=new Fa(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){ks[e]=new Fa(e,5,!1,e.toLowerCase(),null,!1,!1)});var bF=/[\-:]([a-z])/g;function _F(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(bF,_F);ks[t]=new Fa(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(bF,_F);ks[t]=new Fa(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(bF,_F);ks[t]=new Fa(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){ks[e]=new Fa(e,1,!1,e.toLowerCase(),null,!1,!1)});ks.xlinkHref=new Fa("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){ks[e]=new Fa(e,1,!1,e.toLowerCase(),null,!0,!0)});function SF(e,t,i,r){var n=ks.hasOwnProperty(t)?ks[t]:null;(n!==null?n.type!==0:r||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(Toe(t,i,n,r)&&(i=null),r||n===null?Eoe(t)&&(i===null?e.removeAttribute(t):e.setAttribute(t,""+i)):n.mustUseProperty?e[n.propertyName]=i===null?n.type===3?!1:"":i:(t=n.attributeName,r=n.attributeNamespace,i===null?e.removeAttribute(t):(n=n.type,i=n===3||n===4&&i===!0?"":""+i,r?e.setAttributeNS(r,t,i):e.setAttribute(t,i))))}var Fh=Soe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,q_=Symbol.for("react.element"),Ev=Symbol.for("react.portal"),Av=Symbol.for("react.fragment"),MF=Symbol.for("react.strict_mode"),CL=Symbol.for("react.profiler"),OY=Symbol.for("react.provider"),zY=Symbol.for("react.context"),EF=Symbol.for("react.forward_ref"),PL=Symbol.for("react.suspense"),DL=Symbol.for("react.suspense_list"),AF=Symbol.for("react.memo"),_d=Symbol.for("react.lazy"),BY=Symbol.for("react.offscreen"),sV=Symbol.iterator;function Zy(e){return e===null||typeof e!="object"?null:(e=sV&&e[sV]||e["@@iterator"],typeof e=="function"?e:null)}var Xr=Object.assign,P3;function Z1(e){if(P3===void 0)try{throw Error()}catch(i){var t=i.stack.trim().match(/\n( *(at )?)/);P3=t&&t[1]||""}return`
`+P3+e}var D3=!1;function R3(e,t){if(!e||D3)return"";D3=!0;var i=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(c){var r=c}Reflect.construct(e,[],t)}else{try{t.call()}catch(c){r=c}e.call(t.prototype)}else{try{throw Error()}catch(c){r=c}e()}}catch(c){if(c&&r&&typeof c.stack=="string"){for(var n=c.stack.split(`
`),s=r.stack.split(`
`),a=n.length-1,o=s.length-1;1<=a&&0<=o&&n[a]!==s[o];)o--;for(;1<=a&&0<=o;a--,o--)if(n[a]!==s[o]){if(a!==1||o!==1)do if(a--,o--,0>o||n[a]!==s[o]){var l=`
`+n[a].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}while(1<=a&&0<=o);break}}}finally{D3=!1,Error.prepareStackTrace=i}return(e=e?e.displayName||e.name:"")?Z1(e):""}function Coe(e){switch(e.tag){case 5:return Z1(e.type);case 16:return Z1("Lazy");case 13:return Z1("Suspense");case 19:return Z1("SuspenseList");case 0:case 2:case 15:return e=R3(e.type,!1),e;case 11:return e=R3(e.type.render,!1),e;case 1:return e=R3(e.type,!0),e;default:return""}}function RL(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case Av:return"Fragment";case Ev:return"Portal";case CL:return"Profiler";case MF:return"StrictMode";case PL:return"Suspense";case DL:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case zY:return(e.displayName||"Context")+".Consumer";case OY:return(e._context.displayName||"Context")+".Provider";case EF:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case AF:return t=e.displayName||null,t!==null?t:RL(e.type)||"Memo";case _d:t=e._payload,e=e._init;try{return RL(e(t))}catch{}}return null}function Poe(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return RL(t);case 8:return t===MF?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function df(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function FY(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function Doe(e){var t=FY(e)?"checked":"value",i=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&typeof i<"u"&&typeof i.get=="function"&&typeof i.set=="function"){var n=i.get,s=i.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return n.call(this)},set:function(a){r=""+a,s.call(this,a)}}),Object.defineProperty(e,t,{enumerable:i.enumerable}),{getValue:function(){return r},setValue:function(a){r=""+a},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function Y_(e){e._valueTracker||(e._valueTracker=Doe(e))}function UY(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var i=t.getValue(),r="";return e&&(r=FY(e)?e.checked?"true":"false":e.value),e=r,e!==i?(t.setValue(e),!0):!1}function S2(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function IL(e,t){var i=t.checked;return Xr({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:i??e._wrapperState.initialChecked})}function aV(e,t){var i=t.defaultValue==null?"":t.defaultValue,r=t.checked!=null?t.checked:t.defaultChecked;i=df(t.value!=null?t.value:i),e._wrapperState={initialChecked:r,initialValue:i,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function NY(e,t){t=t.checked,t!=null&&SF(e,"checked",t,!1)}function LL(e,t){NY(e,t);var i=df(t.value),r=t.type;if(i!=null)r==="number"?(i===0&&e.value===""||e.value!=i)&&(e.value=""+i):e.value!==""+i&&(e.value=""+i);else if(r==="submit"||r==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?OL(e,t.type,i):t.hasOwnProperty("defaultValue")&&OL(e,t.type,df(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function oV(e,t,i){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!(r!=="submit"&&r!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,i||t===e.value||(e.value=t),e.defaultValue=t}i=e.name,i!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,i!==""&&(e.name=i)}function OL(e,t,i){(t!=="number"||S2(e.ownerDocument)!==e)&&(i==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+i&&(e.defaultValue=""+i))}var K1=Array.isArray;function t0(e,t,i,r){if(e=e.options,t){t={};for(var n=0;n<i.length;n++)t["$"+i[n]]=!0;for(i=0;i<e.length;i++)n=t.hasOwnProperty("$"+e[i].value),e[i].selected!==n&&(e[i].selected=n),n&&r&&(e[i].defaultSelected=!0)}else{for(i=""+df(i),t=null,n=0;n<e.length;n++){if(e[n].value===i){e[n].selected=!0,r&&(e[n].defaultSelected=!0);return}t!==null||e[n].disabled||(t=e[n])}t!==null&&(t.selected=!0)}}function zL(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(gt(91));return Xr({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function lV(e,t){var i=t.value;if(i==null){if(i=t.children,t=t.defaultValue,i!=null){if(t!=null)throw Error(gt(92));if(K1(i)){if(1<i.length)throw Error(gt(93));i=i[0]}t=i}t==null&&(t=""),i=t}e._wrapperState={initialValue:df(i)}}function kY(e,t){var i=df(t.value),r=df(t.defaultValue);i!=null&&(i=""+i,i!==e.value&&(e.value=i),t.defaultValue==null&&e.defaultValue!==i&&(e.defaultValue=i)),r!=null&&(e.defaultValue=""+r)}function cV(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function VY(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function BL(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?VY(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var Q_,GY=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,i,r,n){MSApp.execUnsafeLocalFunction(function(){return e(t,i,r,n)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(Q_=Q_||document.createElement("div"),Q_.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=Q_.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function sw(e,t){if(t){var i=e.firstChild;if(i&&i===e.lastChild&&i.nodeType===3){i.nodeValue=t;return}}e.textContent=t}var gx={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Roe=["Webkit","ms","Moz","O"];Object.keys(gx).forEach(function(e){Roe.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),gx[t]=gx[e]})});function HY(e,t,i){return t==null||typeof t=="boolean"||t===""?"":i||typeof t!="number"||t===0||gx.hasOwnProperty(e)&&gx[e]?(""+t).trim():t+"px"}function jY(e,t){e=e.style;for(var i in t)if(t.hasOwnProperty(i)){var r=i.indexOf("--")===0,n=HY(i,t[i],r);i==="float"&&(i="cssFloat"),r?e.setProperty(i,n):e[i]=n}}var Ioe=Xr({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function FL(e,t){if(t){if(Ioe[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(gt(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(gt(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(gt(61))}if(t.style!=null&&typeof t.style!="object")throw Error(gt(62))}}function UL(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var NL=null;function TF(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var kL=null,i0=null,r0=null;function uV(e){if(e=xb(e)){if(typeof kL!="function")throw Error(gt(280));var t=e.stateNode;t&&(t=sC(t),kL(e.stateNode,e.type,t))}}function WY(e){i0?r0?r0.push(e):r0=[e]:i0=e}function XY(){if(i0){var e=i0,t=r0;if(r0=i0=null,uV(e),t)for(e=0;e<t.length;e++)uV(t[e])}}function qY(e,t){return e(t)}function YY(){}var I3=!1;function QY(e,t,i){if(I3)return e(t,i);I3=!0;try{return qY(e,t,i)}finally{I3=!1,(i0!==null||r0!==null)&&(YY(),XY())}}function aw(e,t){var i=e.stateNode;if(i===null)return null;var r=sC(i);if(r===null)return null;i=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(e=e.type,r=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!r;break e;default:e=!1}if(e)return null;if(i&&typeof i!="function")throw Error(gt(231,t,typeof i));return i}var VL=!1;if(_h)try{var Ky={};Object.defineProperty(Ky,"passive",{get:function(){VL=!0}}),window.addEventListener("test",Ky,Ky),window.removeEventListener("test",Ky,Ky)}catch{VL=!1}function Loe(e,t,i,r,n,s,a,o,l){var c=Array.prototype.slice.call(arguments,3);try{t.apply(i,c)}catch(u){this.onError(u)}}var vx=!1,M2=null,E2=!1,GL=null,Ooe={onError:function(e){vx=!0,M2=e}};function zoe(e,t,i,r,n,s,a,o,l){vx=!1,M2=null,Loe.apply(Ooe,arguments)}function Boe(e,t,i,r,n,s,a,o,l){if(zoe.apply(this,arguments),vx){if(vx){var c=M2;vx=!1,M2=null}else throw Error(gt(198));E2||(E2=!0,GL=c)}}function km(e){var t=e,i=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(i=t.return),e=t.return;while(e)}return t.tag===3?i:null}function ZY(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function hV(e){if(km(e)!==e)throw Error(gt(188))}function Foe(e){var t=e.alternate;if(!t){if(t=km(e),t===null)throw Error(gt(188));return t!==e?null:e}for(var i=e,r=t;;){var n=i.return;if(n===null)break;var s=n.alternate;if(s===null){if(r=n.return,r!==null){i=r;continue}break}if(n.child===s.child){for(s=n.child;s;){if(s===i)return hV(n),e;if(s===r)return hV(n),t;s=s.sibling}throw Error(gt(188))}if(i.return!==r.return)i=n,r=s;else{for(var a=!1,o=n.child;o;){if(o===i){a=!0,i=n,r=s;break}if(o===r){a=!0,r=n,i=s;break}o=o.sibling}if(!a){for(o=s.child;o;){if(o===i){a=!0,i=s,r=n;break}if(o===r){a=!0,r=s,i=n;break}o=o.sibling}if(!a)throw Error(gt(189))}}if(i.alternate!==r)throw Error(gt(190))}if(i.tag!==3)throw Error(gt(188));return i.stateNode.current===i?e:t}function KY(e){return e=Foe(e),e!==null?JY(e):null}function JY(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=JY(e);if(t!==null)return t;e=e.sibling}return null}var $Y=Oo.unstable_scheduleCallback,dV=Oo.unstable_cancelCallback,Uoe=Oo.unstable_shouldYield,Noe=Oo.unstable_requestPaint,dn=Oo.unstable_now,koe=Oo.unstable_getCurrentPriorityLevel,CF=Oo.unstable_ImmediatePriority,eQ=Oo.unstable_UserBlockingPriority,A2=Oo.unstable_NormalPriority,Voe=Oo.unstable_LowPriority,tQ=Oo.unstable_IdlePriority,tC=null,Yc=null;function Goe(e){if(Yc&&typeof Yc.onCommitFiberRoot=="function")try{Yc.onCommitFiberRoot(tC,e,void 0,(e.current.flags&128)===128)}catch{}}var ec=Math.clz32?Math.clz32:Woe,Hoe=Math.log,joe=Math.LN2;function Woe(e){return e>>>=0,e===0?32:31-(Hoe(e)/joe|0)|0}var Z_=64,K_=4194304;function J1(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function T2(e,t){var i=e.pendingLanes;if(i===0)return 0;var r=0,n=e.suspendedLanes,s=e.pingedLanes,a=i&268435455;if(a!==0){var o=a&~n;o!==0?r=J1(o):(s&=a,s!==0&&(r=J1(s)))}else a=i&~n,a!==0?r=J1(a):s!==0&&(r=J1(s));if(r===0)return 0;if(t!==0&&t!==r&&!(t&n)&&(n=r&-r,s=t&-t,n>=s||n===16&&(s&4194240)!==0))return t;if(r&4&&(r|=i&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=r;0<t;)i=31-ec(t),n=1<<i,r|=e[i],t&=~n;return r}function Xoe(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function qoe(e,t){for(var i=e.suspendedLanes,r=e.pingedLanes,n=e.expirationTimes,s=e.pendingLanes;0<s;){var a=31-ec(s),o=1<<a,l=n[a];l===-1?(!(o&i)||o&r)&&(n[a]=Xoe(o,t)):l<=t&&(e.expiredLanes|=o),s&=~o}}function HL(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function iQ(){var e=Z_;return Z_<<=1,!(Z_&4194240)&&(Z_=64),e}function L3(e){for(var t=[],i=0;31>i;i++)t.push(e);return t}function vb(e,t,i){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-ec(t),e[t]=i}function Yoe(e,t){var i=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<i;){var n=31-ec(i),s=1<<n;t[n]=0,r[n]=-1,e[n]=-1,i&=~s}}function PF(e,t){var i=e.entangledLanes|=t;for(e=e.entanglements;i;){var r=31-ec(i),n=1<<r;n&t|e[r]&t&&(e[r]|=t),i&=~n}}var ur=0;function rQ(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var nQ,DF,sQ,aQ,oQ,jL=!1,J_=[],Qd=null,Zd=null,Kd=null,ow=new Map,lw=new Map,Ad=[],Qoe="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function fV(e,t){switch(e){case"focusin":case"focusout":Qd=null;break;case"dragenter":case"dragleave":Zd=null;break;case"mouseover":case"mouseout":Kd=null;break;case"pointerover":case"pointerout":ow.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":lw.delete(t.pointerId)}}function Jy(e,t,i,r,n,s){return e===null||e.nativeEvent!==s?(e={blockedOn:t,domEventName:i,eventSystemFlags:r,nativeEvent:s,targetContainers:[n]},t!==null&&(t=xb(t),t!==null&&DF(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,n!==null&&t.indexOf(n)===-1&&t.push(n),e)}function Zoe(e,t,i,r,n){switch(t){case"focusin":return Qd=Jy(Qd,e,t,i,r,n),!0;case"dragenter":return Zd=Jy(Zd,e,t,i,r,n),!0;case"mouseover":return Kd=Jy(Kd,e,t,i,r,n),!0;case"pointerover":var s=n.pointerId;return ow.set(s,Jy(ow.get(s)||null,e,t,i,r,n)),!0;case"gotpointercapture":return s=n.pointerId,lw.set(s,Jy(lw.get(s)||null,e,t,i,r,n)),!0}return!1}function lQ(e){var t=kp(e.target);if(t!==null){var i=km(t);if(i!==null){if(t=i.tag,t===13){if(t=ZY(i),t!==null){e.blockedOn=t,oQ(e.priority,function(){sQ(i)});return}}else if(t===3&&i.stateNode.current.memoizedState.isDehydrated){e.blockedOn=i.tag===3?i.stateNode.containerInfo:null;return}}}e.blockedOn=null}function UE(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var i=WL(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(i===null){i=e.nativeEvent;var r=new i.constructor(i.type,i);NL=r,i.target.dispatchEvent(r),NL=null}else return t=xb(i),t!==null&&DF(t),e.blockedOn=i,!1;t.shift()}return!0}function pV(e,t,i){UE(e)&&i.delete(t)}function Koe(){jL=!1,Qd!==null&&UE(Qd)&&(Qd=null),Zd!==null&&UE(Zd)&&(Zd=null),Kd!==null&&UE(Kd)&&(Kd=null),ow.forEach(pV),lw.forEach(pV)}function $y(e,t){e.blockedOn===t&&(e.blockedOn=null,jL||(jL=!0,Oo.unstable_scheduleCallback(Oo.unstable_NormalPriority,Koe)))}function cw(e){function t(n){return $y(n,e)}if(0<J_.length){$y(J_[0],e);for(var i=1;i<J_.length;i++){var r=J_[i];r.blockedOn===e&&(r.blockedOn=null)}}for(Qd!==null&&$y(Qd,e),Zd!==null&&$y(Zd,e),Kd!==null&&$y(Kd,e),ow.forEach(t),lw.forEach(t),i=0;i<Ad.length;i++)r=Ad[i],r.blockedOn===e&&(r.blockedOn=null);for(;0<Ad.length&&(i=Ad[0],i.blockedOn===null);)lQ(i),i.blockedOn===null&&Ad.shift()}var n0=Fh.ReactCurrentBatchConfig,C2=!0;function Joe(e,t,i,r){var n=ur,s=n0.transition;n0.transition=null;try{ur=1,RF(e,t,i,r)}finally{ur=n,n0.transition=s}}function $oe(e,t,i,r){var n=ur,s=n0.transition;n0.transition=null;try{ur=4,RF(e,t,i,r)}finally{ur=n,n0.transition=s}}function RF(e,t,i,r){if(C2){var n=WL(e,t,i,r);if(n===null)H3(e,t,r,P2,i),fV(e,r);else if(Zoe(n,e,t,i,r))r.stopPropagation();else if(fV(e,r),t&4&&-1<Qoe.indexOf(e)){for(;n!==null;){var s=xb(n);if(s!==null&&nQ(s),s=WL(e,t,i,r),s===null&&H3(e,t,r,P2,i),s===n)break;n=s}n!==null&&r.stopPropagation()}else H3(e,t,r,null,i)}}var P2=null;function WL(e,t,i,r){if(P2=null,e=TF(r),e=kp(e),e!==null)if(t=km(e),t===null)e=null;else if(i=t.tag,i===13){if(e=ZY(t),e!==null)return e;e=null}else if(i===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return P2=e,null}function cQ(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(koe()){case CF:return 1;case eQ:return 4;case A2:case Voe:return 16;case tQ:return 536870912;default:return 16}default:return 16}}var zd=null,IF=null,NE=null;function uQ(){if(NE)return NE;var e,t=IF,i=t.length,r,n="value"in zd?zd.value:zd.textContent,s=n.length;for(e=0;e<i&&t[e]===n[e];e++);var a=i-e;for(r=1;r<=a&&t[i-r]===n[s-r];r++);return NE=n.slice(e,1<r?1-r:void 0)}function kE(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function $_(){return!0}function mV(){return!1}function No(e){function t(i,r,n,s,a){this._reactName=i,this._targetInst=n,this.type=r,this.nativeEvent=s,this.target=a,this.currentTarget=null;for(var o in e)e.hasOwnProperty(o)&&(i=e[o],this[o]=i?i(s):s[o]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?$_:mV,this.isPropagationStopped=mV,this}return Xr(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var i=this.nativeEvent;i&&(i.preventDefault?i.preventDefault():typeof i.returnValue!="unknown"&&(i.returnValue=!1),this.isDefaultPrevented=$_)},stopPropagation:function(){var i=this.nativeEvent;i&&(i.stopPropagation?i.stopPropagation():typeof i.cancelBubble!="unknown"&&(i.cancelBubble=!0),this.isPropagationStopped=$_)},persist:function(){},isPersistent:$_}),t}var $0={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},LF=No($0),yb=Xr({},$0,{view:0,detail:0}),ele=No(yb),O3,z3,e1,iC=Xr({},yb,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:OF,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==e1&&(e1&&e.type==="mousemove"?(O3=e.screenX-e1.screenX,z3=e.screenY-e1.screenY):z3=O3=0,e1=e),O3)},movementY:function(e){return"movementY"in e?e.movementY:z3}}),gV=No(iC),tle=Xr({},iC,{dataTransfer:0}),ile=No(tle),rle=Xr({},yb,{relatedTarget:0}),B3=No(rle),nle=Xr({},$0,{animationName:0,elapsedTime:0,pseudoElement:0}),sle=No(nle),ale=Xr({},$0,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),ole=No(ale),lle=Xr({},$0,{data:0}),vV=No(lle),cle={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},ule={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},hle={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function dle(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=hle[e])?!!t[e]:!1}function OF(){return dle}var fle=Xr({},yb,{key:function(e){if(e.key){var t=cle[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=kE(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?ule[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:OF,charCode:function(e){return e.type==="keypress"?kE(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?kE(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),ple=No(fle),mle=Xr({},iC,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),yV=No(mle),gle=Xr({},yb,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:OF}),vle=No(gle),yle=Xr({},$0,{propertyName:0,elapsedTime:0,pseudoElement:0}),xle=No(yle),wle=Xr({},iC,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),ble=No(wle),_le=[9,13,27,32],zF=_h&&"CompositionEvent"in window,yx=null;_h&&"documentMode"in document&&(yx=document.documentMode);var Sle=_h&&"TextEvent"in window&&!yx,hQ=_h&&(!zF||yx&&8<yx&&11>=yx),xV=" ",wV=!1;function dQ(e,t){switch(e){case"keyup":return _le.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function fQ(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var Tv=!1;function Mle(e,t){switch(e){case"compositionend":return fQ(t);case"keypress":return t.which!==32?null:(wV=!0,xV);case"textInput":return e=t.data,e===xV&&wV?null:e;default:return null}}function Ele(e,t){if(Tv)return e==="compositionend"||!zF&&dQ(e,t)?(e=uQ(),NE=IF=zd=null,Tv=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return hQ&&t.locale!=="ko"?null:t.data;default:return null}}var Ale={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function bV(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!Ale[e.type]:t==="textarea"}function pQ(e,t,i,r){WY(r),t=D2(t,"onChange"),0<t.length&&(i=new LF("onChange","change",null,i,r),e.push({event:i,listeners:t}))}var xx=null,uw=null;function Tle(e){EQ(e,0)}function rC(e){var t=Dv(e);if(UY(t))return e}function Cle(e,t){if(e==="change")return t}var mQ=!1;if(_h){var F3;if(_h){var U3="oninput"in document;if(!U3){var _V=document.createElement("div");_V.setAttribute("oninput","return;"),U3=typeof _V.oninput=="function"}F3=U3}else F3=!1;mQ=F3&&(!document.documentMode||9<document.documentMode)}function SV(){xx&&(xx.detachEvent("onpropertychange",gQ),uw=xx=null)}function gQ(e){if(e.propertyName==="value"&&rC(uw)){var t=[];pQ(t,uw,e,TF(e)),QY(Tle,t)}}function Ple(e,t,i){e==="focusin"?(SV(),xx=t,uw=i,xx.attachEvent("onpropertychange",gQ)):e==="focusout"&&SV()}function Dle(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return rC(uw)}function Rle(e,t){if(e==="click")return rC(t)}function Ile(e,t){if(e==="input"||e==="change")return rC(t)}function Lle(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var rc=typeof Object.is=="function"?Object.is:Lle;function hw(e,t){if(rc(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var i=Object.keys(e),r=Object.keys(t);if(i.length!==r.length)return!1;for(r=0;r<i.length;r++){var n=i[r];if(!TL.call(t,n)||!rc(e[n],t[n]))return!1}return!0}function MV(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function EV(e,t){var i=MV(e);e=0;for(var r;i;){if(i.nodeType===3){if(r=e+i.textContent.length,e<=t&&r>=t)return{node:i,offset:t-e};e=r}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=MV(i)}}function vQ(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?vQ(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function yQ(){for(var e=window,t=S2();t instanceof e.HTMLIFrameElement;){try{var i=typeof t.contentWindow.location.href=="string"}catch{i=!1}if(i)e=t.contentWindow;else break;t=S2(e.document)}return t}function BF(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function Ole(e){var t=yQ(),i=e.focusedElem,r=e.selectionRange;if(t!==i&&i&&i.ownerDocument&&vQ(i.ownerDocument.documentElement,i)){if(r!==null&&BF(i)){if(t=r.start,e=r.end,e===void 0&&(e=t),"selectionStart"in i)i.selectionStart=t,i.selectionEnd=Math.min(e,i.value.length);else if(e=(t=i.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var n=i.textContent.length,s=Math.min(r.start,n);r=r.end===void 0?s:Math.min(r.end,n),!e.extend&&s>r&&(n=r,r=s,s=n),n=EV(i,s);var a=EV(i,r);n&&a&&(e.rangeCount!==1||e.anchorNode!==n.node||e.anchorOffset!==n.offset||e.focusNode!==a.node||e.focusOffset!==a.offset)&&(t=t.createRange(),t.setStart(n.node,n.offset),e.removeAllRanges(),s>r?(e.addRange(t),e.extend(a.node,a.offset)):(t.setEnd(a.node,a.offset),e.addRange(t)))}}for(t=[],e=i;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof i.focus=="function"&&i.focus(),i=0;i<t.length;i++)e=t[i],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var zle=_h&&"documentMode"in document&&11>=document.documentMode,Cv=null,XL=null,wx=null,qL=!1;function AV(e,t,i){var r=i.window===i?i.document:i.nodeType===9?i:i.ownerDocument;qL||Cv==null||Cv!==S2(r)||(r=Cv,"selectionStart"in r&&BF(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),wx&&hw(wx,r)||(wx=r,r=D2(XL,"onSelect"),0<r.length&&(t=new LF("onSelect","select",null,t,i),e.push({event:t,listeners:r}),t.target=Cv)))}function eS(e,t){var i={};return i[e.toLowerCase()]=t.toLowerCase(),i["Webkit"+e]="webkit"+t,i["Moz"+e]="moz"+t,i}var Pv={animationend:eS("Animation","AnimationEnd"),animationiteration:eS("Animation","AnimationIteration"),animationstart:eS("Animation","AnimationStart"),transitionend:eS("Transition","TransitionEnd")},N3={},xQ={};_h&&(xQ=document.createElement("div").style,"AnimationEvent"in window||(delete Pv.animationend.animation,delete Pv.animationiteration.animation,delete Pv.animationstart.animation),"TransitionEvent"in window||delete Pv.transitionend.transition);function nC(e){if(N3[e])return N3[e];if(!Pv[e])return e;var t=Pv[e],i;for(i in t)if(t.hasOwnProperty(i)&&i in xQ)return N3[e]=t[i];return e}var wQ=nC("animationend"),bQ=nC("animationiteration"),_Q=nC("animationstart"),SQ=nC("transitionend"),MQ=new Map,TV="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function _f(e,t){MQ.set(e,t),Nm(t,[e])}for(var k3=0;k3<TV.length;k3++){var V3=TV[k3],Ble=V3.toLowerCase(),Fle=V3[0].toUpperCase()+V3.slice(1);_f(Ble,"on"+Fle)}_f(wQ,"onAnimationEnd");_f(bQ,"onAnimationIteration");_f(_Q,"onAnimationStart");_f("dblclick","onDoubleClick");_f("focusin","onFocus");_f("focusout","onBlur");_f(SQ,"onTransitionEnd");_0("onMouseEnter",["mouseout","mouseover"]);_0("onMouseLeave",["mouseout","mouseover"]);_0("onPointerEnter",["pointerout","pointerover"]);_0("onPointerLeave",["pointerout","pointerover"]);Nm("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Nm("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Nm("onBeforeInput",["compositionend","keypress","textInput","paste"]);Nm("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Nm("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Nm("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var $1="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Ule=new Set("cancel close invalid load scroll toggle".split(" ").concat($1));function CV(e,t,i){var r=e.type||"unknown-event";e.currentTarget=i,Boe(r,t,void 0,e),e.currentTarget=null}function EQ(e,t){t=(t&4)!==0;for(var i=0;i<e.length;i++){var r=e[i],n=r.event;r=r.listeners;e:{var s=void 0;if(t)for(var a=r.length-1;0<=a;a--){var o=r[a],l=o.instance,c=o.currentTarget;if(o=o.listener,l!==s&&n.isPropagationStopped())break e;CV(n,o,c),s=l}else for(a=0;a<r.length;a++){if(o=r[a],l=o.instance,c=o.currentTarget,o=o.listener,l!==s&&n.isPropagationStopped())break e;CV(n,o,c),s=l}}}if(E2)throw e=GL,E2=!1,GL=null,e}function Mr(e,t){var i=t[JL];i===void 0&&(i=t[JL]=new Set);var r=e+"__bubble";i.has(r)||(AQ(t,e,2,!1),i.add(r))}function G3(e,t,i){var r=0;t&&(r|=4),AQ(i,e,r,t)}var tS="_reactListening"+Math.random().toString(36).slice(2);function dw(e){if(!e[tS]){e[tS]=!0,LY.forEach(function(i){i!=="selectionchange"&&(Ule.has(i)||G3(i,!1,e),G3(i,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[tS]||(t[tS]=!0,G3("selectionchange",!1,t))}}function AQ(e,t,i,r){switch(cQ(t)){case 1:var n=Joe;break;case 4:n=$oe;break;default:n=RF}i=n.bind(null,t,i,e),n=void 0,!VL||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(n=!0),r?n!==void 0?e.addEventListener(t,i,{capture:!0,passive:n}):e.addEventListener(t,i,!0):n!==void 0?e.addEventListener(t,i,{passive:n}):e.addEventListener(t,i,!1)}function H3(e,t,i,r,n){var s=r;if(!(t&1)&&!(t&2)&&r!==null)e:for(;;){if(r===null)return;var a=r.tag;if(a===3||a===4){var o=r.stateNode.containerInfo;if(o===n||o.nodeType===8&&o.parentNode===n)break;if(a===4)for(a=r.return;a!==null;){var l=a.tag;if((l===3||l===4)&&(l=a.stateNode.containerInfo,l===n||l.nodeType===8&&l.parentNode===n))return;a=a.return}for(;o!==null;){if(a=kp(o),a===null)return;if(l=a.tag,l===5||l===6){r=s=a;continue e}o=o.parentNode}}r=r.return}QY(function(){var c=s,u=TF(i),h=[];e:{var d=MQ.get(e);if(d!==void 0){var f=LF,p=e;switch(e){case"keypress":if(kE(i)===0)break e;case"keydown":case"keyup":f=ple;break;case"focusin":p="focus",f=B3;break;case"focusout":p="blur",f=B3;break;case"beforeblur":case"afterblur":f=B3;break;case"click":if(i.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":f=gV;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":f=ile;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":f=vle;break;case wQ:case bQ:case _Q:f=sle;break;case SQ:f=xle;break;case"scroll":f=ele;break;case"wheel":f=ble;break;case"copy":case"cut":case"paste":f=ole;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":f=yV}var v=(t&4)!==0,m=!v&&e==="scroll",g=v?d!==null?d+"Capture":null:d;v=[];for(var y=c,x;y!==null;){x=y;var _=x.stateNode;if(x.tag===5&&_!==null&&(x=_,g!==null&&(_=aw(y,g),_!=null&&v.push(fw(y,_,x)))),m)break;y=y.return}0<v.length&&(d=new f(d,p,null,i,u),h.push({event:d,listeners:v}))}}if(!(t&7)){e:{if(d=e==="mouseover"||e==="pointerover",f=e==="mouseout"||e==="pointerout",d&&i!==NL&&(p=i.relatedTarget||i.fromElement)&&(kp(p)||p[Sh]))break e;if((f||d)&&(d=u.window===u?u:(d=u.ownerDocument)?d.defaultView||d.parentWindow:window,f?(p=i.relatedTarget||i.toElement,f=c,p=p?kp(p):null,p!==null&&(m=km(p),p!==m||p.tag!==5&&p.tag!==6)&&(p=null)):(f=null,p=c),f!==p)){if(v=gV,_="onMouseLeave",g="onMouseEnter",y="mouse",(e==="pointerout"||e==="pointerover")&&(v=yV,_="onPointerLeave",g="onPointerEnter",y="pointer"),m=f==null?d:Dv(f),x=p==null?d:Dv(p),d=new v(_,y+"leave",f,i,u),d.target=m,d.relatedTarget=x,_=null,kp(u)===c&&(v=new v(g,y+"enter",p,i,u),v.target=x,v.relatedTarget=m,_=v),m=_,f&&p)t:{for(v=f,g=p,y=0,x=v;x;x=mg(x))y++;for(x=0,_=g;_;_=mg(_))x++;for(;0<y-x;)v=mg(v),y--;for(;0<x-y;)g=mg(g),x--;for(;y--;){if(v===g||g!==null&&v===g.alternate)break t;v=mg(v),g=mg(g)}v=null}else v=null;f!==null&&PV(h,d,f,v,!1),p!==null&&m!==null&&PV(h,m,p,v,!0)}}e:{if(d=c?Dv(c):window,f=d.nodeName&&d.nodeName.toLowerCase(),f==="select"||f==="input"&&d.type==="file")var M=Cle;else if(bV(d))if(mQ)M=Ile;else{M=Dle;var S=Ple}else(f=d.nodeName)&&f.toLowerCase()==="input"&&(d.type==="checkbox"||d.type==="radio")&&(M=Rle);if(M&&(M=M(e,c))){pQ(h,M,i,u);break e}S&&S(e,d,c),e==="focusout"&&(S=d._wrapperState)&&S.controlled&&d.type==="number"&&OL(d,"number",d.value)}switch(S=c?Dv(c):window,e){case"focusin":(bV(S)||S.contentEditable==="true")&&(Cv=S,XL=c,wx=null);break;case"focusout":wx=XL=Cv=null;break;case"mousedown":qL=!0;break;case"contextmenu":case"mouseup":case"dragend":qL=!1,AV(h,i,u);break;case"selectionchange":if(zle)break;case"keydown":case"keyup":AV(h,i,u)}var T;if(zF)e:{switch(e){case"compositionstart":var E="onCompositionStart";break e;case"compositionend":E="onCompositionEnd";break e;case"compositionupdate":E="onCompositionUpdate";break e}E=void 0}else Tv?dQ(e,i)&&(E="onCompositionEnd"):e==="keydown"&&i.keyCode===229&&(E="onCompositionStart");E&&(hQ&&i.locale!=="ko"&&(Tv||E!=="onCompositionStart"?E==="onCompositionEnd"&&Tv&&(T=uQ()):(zd=u,IF="value"in zd?zd.value:zd.textContent,Tv=!0)),S=D2(c,E),0<S.length&&(E=new vV(E,e,null,i,u),h.push({event:E,listeners:S}),T?E.data=T:(T=fQ(i),T!==null&&(E.data=T)))),(T=Sle?Mle(e,i):Ele(e,i))&&(c=D2(c,"onBeforeInput"),0<c.length&&(u=new vV("onBeforeInput","beforeinput",null,i,u),h.push({event:u,listeners:c}),u.data=T))}EQ(h,t)})}function fw(e,t,i){return{instance:e,listener:t,currentTarget:i}}function D2(e,t){for(var i=t+"Capture",r=[];e!==null;){var n=e,s=n.stateNode;n.tag===5&&s!==null&&(n=s,s=aw(e,i),s!=null&&r.unshift(fw(e,s,n)),s=aw(e,t),s!=null&&r.push(fw(e,s,n))),e=e.return}return r}function mg(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function PV(e,t,i,r,n){for(var s=t._reactName,a=[];i!==null&&i!==r;){var o=i,l=o.alternate,c=o.stateNode;if(l!==null&&l===r)break;o.tag===5&&c!==null&&(o=c,n?(l=aw(i,s),l!=null&&a.unshift(fw(i,l,o))):n||(l=aw(i,s),l!=null&&a.push(fw(i,l,o)))),i=i.return}a.length!==0&&e.push({event:t,listeners:a})}var Nle=/\r\n?/g,kle=/\u0000|\uFFFD/g;function DV(e){return(typeof e=="string"?e:""+e).replace(Nle,`
`).replace(kle,"")}function iS(e,t,i){if(t=DV(t),DV(e)!==t&&i)throw Error(gt(425))}function R2(){}var YL=null,QL=null;function ZL(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var KL=typeof setTimeout=="function"?setTimeout:void 0,Vle=typeof clearTimeout=="function"?clearTimeout:void 0,RV=typeof Promise=="function"?Promise:void 0,Gle=typeof queueMicrotask=="function"?queueMicrotask:typeof RV<"u"?function(e){return RV.resolve(null).then(e).catch(Hle)}:KL;function Hle(e){setTimeout(function(){throw e})}function j3(e,t){var i=t,r=0;do{var n=i.nextSibling;if(e.removeChild(i),n&&n.nodeType===8)if(i=n.data,i==="/$"){if(r===0){e.removeChild(n),cw(t);return}r--}else i!=="$"&&i!=="$?"&&i!=="$!"||r++;i=n}while(i);cw(t)}function Jd(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function IV(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var i=e.data;if(i==="$"||i==="$!"||i==="$?"){if(t===0)return e;t--}else i==="/$"&&t++}e=e.previousSibling}return null}var ey=Math.random().toString(36).slice(2),Nc="__reactFiber$"+ey,pw="__reactProps$"+ey,Sh="__reactContainer$"+ey,JL="__reactEvents$"+ey,jle="__reactListeners$"+ey,Wle="__reactHandles$"+ey;function kp(e){var t=e[Nc];if(t)return t;for(var i=e.parentNode;i;){if(t=i[Sh]||i[Nc]){if(i=t.alternate,t.child!==null||i!==null&&i.child!==null)for(e=IV(e);e!==null;){if(i=e[Nc])return i;e=IV(e)}return t}e=i,i=e.parentNode}return null}function xb(e){return e=e[Nc]||e[Sh],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function Dv(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(gt(33))}function sC(e){return e[pw]||null}var $L=[],Rv=-1;function Sf(e){return{current:e}}function Cr(e){0>Rv||(e.current=$L[Rv],$L[Rv]=null,Rv--)}function _r(e,t){Rv++,$L[Rv]=e.current,e.current=t}var ff={},la=Sf(ff),ao=Sf(!1),vm=ff;function S0(e,t){var i=e.type.contextTypes;if(!i)return ff;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var n={},s;for(s in i)n[s]=t[s];return r&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=n),n}function oo(e){return e=e.childContextTypes,e!=null}function I2(){Cr(ao),Cr(la)}function LV(e,t,i){if(la.current!==ff)throw Error(gt(168));_r(la,t),_r(ao,i)}function TQ(e,t,i){var r=e.stateNode;if(t=t.childContextTypes,typeof r.getChildContext!="function")return i;r=r.getChildContext();for(var n in r)if(!(n in t))throw Error(gt(108,Poe(e)||"Unknown",n));return Xr({},i,r)}function L2(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||ff,vm=la.current,_r(la,e),_r(ao,ao.current),!0}function OV(e,t,i){var r=e.stateNode;if(!r)throw Error(gt(169));i?(e=TQ(e,t,vm),r.__reactInternalMemoizedMergedChildContext=e,Cr(ao),Cr(la),_r(la,e)):Cr(ao),_r(ao,i)}var Qu=null,aC=!1,W3=!1;function CQ(e){Qu===null?Qu=[e]:Qu.push(e)}function Xle(e){aC=!0,CQ(e)}function Mf(){if(!W3&&Qu!==null){W3=!0;var e=0,t=ur;try{var i=Qu;for(ur=1;e<i.length;e++){var r=i[e];do r=r(!0);while(r!==null)}Qu=null,aC=!1}catch(n){throw Qu!==null&&(Qu=Qu.slice(e+1)),$Y(CF,Mf),n}finally{ur=t,W3=!1}}return null}var Iv=[],Lv=0,O2=null,z2=0,ll=[],cl=0,ym=null,sh=1,ah="";function xp(e,t){Iv[Lv++]=z2,Iv[Lv++]=O2,O2=e,z2=t}function PQ(e,t,i){ll[cl++]=sh,ll[cl++]=ah,ll[cl++]=ym,ym=e;var r=sh;e=ah;var n=32-ec(r)-1;r&=~(1<<n),i+=1;var s=32-ec(t)+n;if(30<s){var a=n-n%5;s=(r&(1<<a)-1).toString(32),r>>=a,n-=a,sh=1<<32-ec(t)+n|i<<n|r,ah=s+e}else sh=1<<s|i<<n|r,ah=e}function FF(e){e.return!==null&&(xp(e,1),PQ(e,1,0))}function UF(e){for(;e===O2;)O2=Iv[--Lv],Iv[Lv]=null,z2=Iv[--Lv],Iv[Lv]=null;for(;e===ym;)ym=ll[--cl],ll[cl]=null,ah=ll[--cl],ll[cl]=null,sh=ll[--cl],ll[cl]=null}var Ro=null,Po=null,Ir=!1,jl=null;function DQ(e,t){var i=dl(5,null,null,0);i.elementType="DELETED",i.stateNode=t,i.return=e,t=e.deletions,t===null?(e.deletions=[i],e.flags|=16):t.push(i)}function zV(e,t){switch(e.tag){case 5:var i=e.type;return t=t.nodeType!==1||i.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,Ro=e,Po=Jd(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,Ro=e,Po=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(i=ym!==null?{id:sh,overflow:ah}:null,e.memoizedState={dehydrated:t,treeContext:i,retryLane:1073741824},i=dl(18,null,null,0),i.stateNode=t,i.return=e,e.child=i,Ro=e,Po=null,!0):!1;default:return!1}}function eO(e){return(e.mode&1)!==0&&(e.flags&128)===0}function tO(e){if(Ir){var t=Po;if(t){var i=t;if(!zV(e,t)){if(eO(e))throw Error(gt(418));t=Jd(i.nextSibling);var r=Ro;t&&zV(e,t)?DQ(r,i):(e.flags=e.flags&-4097|2,Ir=!1,Ro=e)}}else{if(eO(e))throw Error(gt(418));e.flags=e.flags&-4097|2,Ir=!1,Ro=e}}}function BV(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;Ro=e}function rS(e){if(e!==Ro)return!1;if(!Ir)return BV(e),Ir=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!ZL(e.type,e.memoizedProps)),t&&(t=Po)){if(eO(e))throw RQ(),Error(gt(418));for(;t;)DQ(e,t),t=Jd(t.nextSibling)}if(BV(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(gt(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var i=e.data;if(i==="/$"){if(t===0){Po=Jd(e.nextSibling);break e}t--}else i!=="$"&&i!=="$!"&&i!=="$?"||t++}e=e.nextSibling}Po=null}}else Po=Ro?Jd(e.stateNode.nextSibling):null;return!0}function RQ(){for(var e=Po;e;)e=Jd(e.nextSibling)}function M0(){Po=Ro=null,Ir=!1}function NF(e){jl===null?jl=[e]:jl.push(e)}var qle=Fh.ReactCurrentBatchConfig;function t1(e,t,i){if(e=i.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(i._owner){if(i=i._owner,i){if(i.tag!==1)throw Error(gt(309));var r=i.stateNode}if(!r)throw Error(gt(147,e));var n=r,s=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===s?t.ref:(t=function(a){var o=n.refs;a===null?delete o[s]:o[s]=a},t._stringRef=s,t)}if(typeof e!="string")throw Error(gt(284));if(!i._owner)throw Error(gt(290,e))}return e}function nS(e,t){throw e=Object.prototype.toString.call(t),Error(gt(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function FV(e){var t=e._init;return t(e._payload)}function IQ(e){function t(g,y){if(e){var x=g.deletions;x===null?(g.deletions=[y],g.flags|=16):x.push(y)}}function i(g,y){if(!e)return null;for(;y!==null;)t(g,y),y=y.sibling;return null}function r(g,y){for(g=new Map;y!==null;)y.key!==null?g.set(y.key,y):g.set(y.index,y),y=y.sibling;return g}function n(g,y){return g=rf(g,y),g.index=0,g.sibling=null,g}function s(g,y,x){return g.index=x,e?(x=g.alternate,x!==null?(x=x.index,x<y?(g.flags|=2,y):x):(g.flags|=2,y)):(g.flags|=1048576,y)}function a(g){return e&&g.alternate===null&&(g.flags|=2),g}function o(g,y,x,_){return y===null||y.tag!==6?(y=J3(x,g.mode,_),y.return=g,y):(y=n(y,x),y.return=g,y)}function l(g,y,x,_){var M=x.type;return M===Av?u(g,y,x.props.children,_,x.key):y!==null&&(y.elementType===M||typeof M=="object"&&M!==null&&M.$$typeof===_d&&FV(M)===y.type)?(_=n(y,x.props),_.ref=t1(g,y,x),_.return=g,_):(_=qE(x.type,x.key,x.props,null,g.mode,_),_.ref=t1(g,y,x),_.return=g,_)}function c(g,y,x,_){return y===null||y.tag!==4||y.stateNode.containerInfo!==x.containerInfo||y.stateNode.implementation!==x.implementation?(y=$3(x,g.mode,_),y.return=g,y):(y=n(y,x.children||[]),y.return=g,y)}function u(g,y,x,_,M){return y===null||y.tag!==7?(y=im(x,g.mode,_,M),y.return=g,y):(y=n(y,x),y.return=g,y)}function h(g,y,x){if(typeof y=="string"&&y!==""||typeof y=="number")return y=J3(""+y,g.mode,x),y.return=g,y;if(typeof y=="object"&&y!==null){switch(y.$$typeof){case q_:return x=qE(y.type,y.key,y.props,null,g.mode,x),x.ref=t1(g,null,y),x.return=g,x;case Ev:return y=$3(y,g.mode,x),y.return=g,y;case _d:var _=y._init;return h(g,_(y._payload),x)}if(K1(y)||Zy(y))return y=im(y,g.mode,x,null),y.return=g,y;nS(g,y)}return null}function d(g,y,x,_){var M=y!==null?y.key:null;if(typeof x=="string"&&x!==""||typeof x=="number")return M!==null?null:o(g,y,""+x,_);if(typeof x=="object"&&x!==null){switch(x.$$typeof){case q_:return x.key===M?l(g,y,x,_):null;case Ev:return x.key===M?c(g,y,x,_):null;case _d:return M=x._init,d(g,y,M(x._payload),_)}if(K1(x)||Zy(x))return M!==null?null:u(g,y,x,_,null);nS(g,x)}return null}function f(g,y,x,_,M){if(typeof _=="string"&&_!==""||typeof _=="number")return g=g.get(x)||null,o(y,g,""+_,M);if(typeof _=="object"&&_!==null){switch(_.$$typeof){case q_:return g=g.get(_.key===null?x:_.key)||null,l(y,g,_,M);case Ev:return g=g.get(_.key===null?x:_.key)||null,c(y,g,_,M);case _d:var S=_._init;return f(g,y,x,S(_._payload),M)}if(K1(_)||Zy(_))return g=g.get(x)||null,u(y,g,_,M,null);nS(y,_)}return null}function p(g,y,x,_){for(var M=null,S=null,T=y,E=y=0,C=null;T!==null&&E<x.length;E++){T.index>E?(C=T,T=null):C=T.sibling;var A=d(g,T,x[E],_);if(A===null){T===null&&(T=C);break}e&&T&&A.alternate===null&&t(g,T),y=s(A,y,E),S===null?M=A:S.sibling=A,S=A,T=C}if(E===x.length)return i(g,T),Ir&&xp(g,E),M;if(T===null){for(;E<x.length;E++)T=h(g,x[E],_),T!==null&&(y=s(T,y,E),S===null?M=T:S.sibling=T,S=T);return Ir&&xp(g,E),M}for(T=r(g,T);E<x.length;E++)C=f(T,g,E,x[E],_),C!==null&&(e&&C.alternate!==null&&T.delete(C.key===null?E:C.key),y=s(C,y,E),S===null?M=C:S.sibling=C,S=C);return e&&T.forEach(function(D){return t(g,D)}),Ir&&xp(g,E),M}function v(g,y,x,_){var M=Zy(x);if(typeof M!="function")throw Error(gt(150));if(x=M.call(x),x==null)throw Error(gt(151));for(var S=M=null,T=y,E=y=0,C=null,A=x.next();T!==null&&!A.done;E++,A=x.next()){T.index>E?(C=T,T=null):C=T.sibling;var D=d(g,T,A.value,_);if(D===null){T===null&&(T=C);break}e&&T&&D.alternate===null&&t(g,T),y=s(D,y,E),S===null?M=D:S.sibling=D,S=D,T=C}if(A.done)return i(g,T),Ir&&xp(g,E),M;if(T===null){for(;!A.done;E++,A=x.next())A=h(g,A.value,_),A!==null&&(y=s(A,y,E),S===null?M=A:S.sibling=A,S=A);return Ir&&xp(g,E),M}for(T=r(g,T);!A.done;E++,A=x.next())A=f(T,g,E,A.value,_),A!==null&&(e&&A.alternate!==null&&T.delete(A.key===null?E:A.key),y=s(A,y,E),S===null?M=A:S.sibling=A,S=A);return e&&T.forEach(function(R){return t(g,R)}),Ir&&xp(g,E),M}function m(g,y,x,_){if(typeof x=="object"&&x!==null&&x.type===Av&&x.key===null&&(x=x.props.children),typeof x=="object"&&x!==null){switch(x.$$typeof){case q_:e:{for(var M=x.key,S=y;S!==null;){if(S.key===M){if(M=x.type,M===Av){if(S.tag===7){i(g,S.sibling),y=n(S,x.props.children),y.return=g,g=y;break e}}else if(S.elementType===M||typeof M=="object"&&M!==null&&M.$$typeof===_d&&FV(M)===S.type){i(g,S.sibling),y=n(S,x.props),y.ref=t1(g,S,x),y.return=g,g=y;break e}i(g,S);break}else t(g,S);S=S.sibling}x.type===Av?(y=im(x.props.children,g.mode,_,x.key),y.return=g,g=y):(_=qE(x.type,x.key,x.props,null,g.mode,_),_.ref=t1(g,y,x),_.return=g,g=_)}return a(g);case Ev:e:{for(S=x.key;y!==null;){if(y.key===S)if(y.tag===4&&y.stateNode.containerInfo===x.containerInfo&&y.stateNode.implementation===x.implementation){i(g,y.sibling),y=n(y,x.children||[]),y.return=g,g=y;break e}else{i(g,y);break}else t(g,y);y=y.sibling}y=$3(x,g.mode,_),y.return=g,g=y}return a(g);case _d:return S=x._init,m(g,y,S(x._payload),_)}if(K1(x))return p(g,y,x,_);if(Zy(x))return v(g,y,x,_);nS(g,x)}return typeof x=="string"&&x!==""||typeof x=="number"?(x=""+x,y!==null&&y.tag===6?(i(g,y.sibling),y=n(y,x),y.return=g,g=y):(i(g,y),y=J3(x,g.mode,_),y.return=g,g=y),a(g)):i(g,y)}return m}var E0=IQ(!0),LQ=IQ(!1),B2=Sf(null),F2=null,Ov=null,kF=null;function VF(){kF=Ov=F2=null}function GF(e){var t=B2.current;Cr(B2),e._currentValue=t}function iO(e,t,i){for(;e!==null;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,r!==null&&(r.childLanes|=t)):r!==null&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===i)break;e=e.return}}function s0(e,t){F2=e,kF=Ov=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(io=!0),e.firstContext=null)}function xl(e){var t=e._currentValue;if(kF!==e)if(e={context:e,memoizedValue:t,next:null},Ov===null){if(F2===null)throw Error(gt(308));Ov=e,F2.dependencies={lanes:0,firstContext:e}}else Ov=Ov.next=e;return t}var Vp=null;function HF(e){Vp===null?Vp=[e]:Vp.push(e)}function OQ(e,t,i,r){var n=t.interleaved;return n===null?(i.next=i,HF(t)):(i.next=n.next,n.next=i),t.interleaved=i,Mh(e,r)}function Mh(e,t){e.lanes|=t;var i=e.alternate;for(i!==null&&(i.lanes|=t),i=e,e=e.return;e!==null;)e.childLanes|=t,i=e.alternate,i!==null&&(i.childLanes|=t),i=e,e=e.return;return i.tag===3?i.stateNode:null}var Sd=!1;function jF(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function zQ(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function mh(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function $d(e,t,i){var r=e.updateQueue;if(r===null)return null;if(r=r.shared,Yi&2){var n=r.pending;return n===null?t.next=t:(t.next=n.next,n.next=t),r.pending=t,Mh(e,i)}return n=r.interleaved,n===null?(t.next=t,HF(r)):(t.next=n.next,n.next=t),r.interleaved=t,Mh(e,i)}function VE(e,t,i){if(t=t.updateQueue,t!==null&&(t=t.shared,(i&4194240)!==0)){var r=t.lanes;r&=e.pendingLanes,i|=r,t.lanes=i,PF(e,i)}}function UV(e,t){var i=e.updateQueue,r=e.alternate;if(r!==null&&(r=r.updateQueue,i===r)){var n=null,s=null;if(i=i.firstBaseUpdate,i!==null){do{var a={eventTime:i.eventTime,lane:i.lane,tag:i.tag,payload:i.payload,callback:i.callback,next:null};s===null?n=s=a:s=s.next=a,i=i.next}while(i!==null);s===null?n=s=t:s=s.next=t}else n=s=t;i={baseState:r.baseState,firstBaseUpdate:n,lastBaseUpdate:s,shared:r.shared,effects:r.effects},e.updateQueue=i;return}e=i.lastBaseUpdate,e===null?i.firstBaseUpdate=t:e.next=t,i.lastBaseUpdate=t}function U2(e,t,i,r){var n=e.updateQueue;Sd=!1;var s=n.firstBaseUpdate,a=n.lastBaseUpdate,o=n.shared.pending;if(o!==null){n.shared.pending=null;var l=o,c=l.next;l.next=null,a===null?s=c:a.next=c,a=l;var u=e.alternate;u!==null&&(u=u.updateQueue,o=u.lastBaseUpdate,o!==a&&(o===null?u.firstBaseUpdate=c:o.next=c,u.lastBaseUpdate=l))}if(s!==null){var h=n.baseState;a=0,u=c=l=null,o=s;do{var d=o.lane,f=o.eventTime;if((r&d)===d){u!==null&&(u=u.next={eventTime:f,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var p=e,v=o;switch(d=t,f=i,v.tag){case 1:if(p=v.payload,typeof p=="function"){h=p.call(f,h,d);break e}h=p;break e;case 3:p.flags=p.flags&-65537|128;case 0:if(p=v.payload,d=typeof p=="function"?p.call(f,h,d):p,d==null)break e;h=Xr({},h,d);break e;case 2:Sd=!0}}o.callback!==null&&o.lane!==0&&(e.flags|=64,d=n.effects,d===null?n.effects=[o]:d.push(o))}else f={eventTime:f,lane:d,tag:o.tag,payload:o.payload,callback:o.callback,next:null},u===null?(c=u=f,l=h):u=u.next=f,a|=d;if(o=o.next,o===null){if(o=n.shared.pending,o===null)break;d=o,o=d.next,d.next=null,n.lastBaseUpdate=d,n.shared.pending=null}}while(!0);if(u===null&&(l=h),n.baseState=l,n.firstBaseUpdate=c,n.lastBaseUpdate=u,t=n.shared.interleaved,t!==null){n=t;do a|=n.lane,n=n.next;while(n!==t)}else s===null&&(n.shared.lanes=0);wm|=a,e.lanes=a,e.memoizedState=h}}function NV(e,t,i){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var r=e[t],n=r.callback;if(n!==null){if(r.callback=null,r=i,typeof n!="function")throw Error(gt(191,n));n.call(r)}}}var wb={},Qc=Sf(wb),mw=Sf(wb),gw=Sf(wb);function Gp(e){if(e===wb)throw Error(gt(174));return e}function WF(e,t){switch(_r(gw,t),_r(mw,e),_r(Qc,wb),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:BL(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=BL(t,e)}Cr(Qc),_r(Qc,t)}function A0(){Cr(Qc),Cr(mw),Cr(gw)}function BQ(e){Gp(gw.current);var t=Gp(Qc.current),i=BL(t,e.type);t!==i&&(_r(mw,e),_r(Qc,i))}function XF(e){mw.current===e&&(Cr(Qc),Cr(mw))}var Ur=Sf(0);function N2(e){for(var t=e;t!==null;){if(t.tag===13){var i=t.memoizedState;if(i!==null&&(i=i.dehydrated,i===null||i.data==="$?"||i.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var X3=[];function qF(){for(var e=0;e<X3.length;e++)X3[e]._workInProgressVersionPrimary=null;X3.length=0}var GE=Fh.ReactCurrentDispatcher,q3=Fh.ReactCurrentBatchConfig,xm=0,Hr=null,Hn=null,us=null,k2=!1,bx=!1,vw=0,Yle=0;function Xs(){throw Error(gt(321))}function YF(e,t){if(t===null)return!1;for(var i=0;i<t.length&&i<e.length;i++)if(!rc(e[i],t[i]))return!1;return!0}function QF(e,t,i,r,n,s){if(xm=s,Hr=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,GE.current=e===null||e.memoizedState===null?Jle:$le,e=i(r,n),bx){s=0;do{if(bx=!1,vw=0,25<=s)throw Error(gt(301));s+=1,us=Hn=null,t.updateQueue=null,GE.current=ece,e=i(r,n)}while(bx)}if(GE.current=V2,t=Hn!==null&&Hn.next!==null,xm=0,us=Hn=Hr=null,k2=!1,t)throw Error(gt(300));return e}function ZF(){var e=vw!==0;return vw=0,e}function Oc(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return us===null?Hr.memoizedState=us=e:us=us.next=e,us}function wl(){if(Hn===null){var e=Hr.alternate;e=e!==null?e.memoizedState:null}else e=Hn.next;var t=us===null?Hr.memoizedState:us.next;if(t!==null)us=t,Hn=e;else{if(e===null)throw Error(gt(310));Hn=e,e={memoizedState:Hn.memoizedState,baseState:Hn.baseState,baseQueue:Hn.baseQueue,queue:Hn.queue,next:null},us===null?Hr.memoizedState=us=e:us=us.next=e}return us}function yw(e,t){return typeof t=="function"?t(e):t}function Y3(e){var t=wl(),i=t.queue;if(i===null)throw Error(gt(311));i.lastRenderedReducer=e;var r=Hn,n=r.baseQueue,s=i.pending;if(s!==null){if(n!==null){var a=n.next;n.next=s.next,s.next=a}r.baseQueue=n=s,i.pending=null}if(n!==null){s=n.next,r=r.baseState;var o=a=null,l=null,c=s;do{var u=c.lane;if((xm&u)===u)l!==null&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),r=c.hasEagerState?c.eagerState:e(r,c.action);else{var h={lane:u,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};l===null?(o=l=h,a=r):l=l.next=h,Hr.lanes|=u,wm|=u}c=c.next}while(c!==null&&c!==s);l===null?a=r:l.next=o,rc(r,t.memoizedState)||(io=!0),t.memoizedState=r,t.baseState=a,t.baseQueue=l,i.lastRenderedState=r}if(e=i.interleaved,e!==null){n=e;do s=n.lane,Hr.lanes|=s,wm|=s,n=n.next;while(n!==e)}else n===null&&(i.lanes=0);return[t.memoizedState,i.dispatch]}function Q3(e){var t=wl(),i=t.queue;if(i===null)throw Error(gt(311));i.lastRenderedReducer=e;var r=i.dispatch,n=i.pending,s=t.memoizedState;if(n!==null){i.pending=null;var a=n=n.next;do s=e(s,a.action),a=a.next;while(a!==n);rc(s,t.memoizedState)||(io=!0),t.memoizedState=s,t.baseQueue===null&&(t.baseState=s),i.lastRenderedState=s}return[s,r]}function FQ(){}function UQ(e,t){var i=Hr,r=wl(),n=t(),s=!rc(r.memoizedState,n);if(s&&(r.memoizedState=n,io=!0),r=r.queue,KF(VQ.bind(null,i,r,e),[e]),r.getSnapshot!==t||s||us!==null&&us.memoizedState.tag&1){if(i.flags|=2048,xw(9,kQ.bind(null,i,r,n,t),void 0,null),vs===null)throw Error(gt(349));xm&30||NQ(i,t,n)}return n}function NQ(e,t,i){e.flags|=16384,e={getSnapshot:t,value:i},t=Hr.updateQueue,t===null?(t={lastEffect:null,stores:null},Hr.updateQueue=t,t.stores=[e]):(i=t.stores,i===null?t.stores=[e]:i.push(e))}function kQ(e,t,i,r){t.value=i,t.getSnapshot=r,GQ(t)&&HQ(e)}function VQ(e,t,i){return i(function(){GQ(t)&&HQ(e)})}function GQ(e){var t=e.getSnapshot;e=e.value;try{var i=t();return!rc(e,i)}catch{return!0}}function HQ(e){var t=Mh(e,1);t!==null&&tc(t,e,1,-1)}function kV(e){var t=Oc();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:yw,lastRenderedState:e},t.queue=e,e=e.dispatch=Kle.bind(null,Hr,e),[t.memoizedState,e]}function xw(e,t,i,r){return e={tag:e,create:t,destroy:i,deps:r,next:null},t=Hr.updateQueue,t===null?(t={lastEffect:null,stores:null},Hr.updateQueue=t,t.lastEffect=e.next=e):(i=t.lastEffect,i===null?t.lastEffect=e.next=e:(r=i.next,i.next=e,e.next=r,t.lastEffect=e)),e}function jQ(){return wl().memoizedState}function HE(e,t,i,r){var n=Oc();Hr.flags|=e,n.memoizedState=xw(1|t,i,void 0,r===void 0?null:r)}function oC(e,t,i,r){var n=wl();r=r===void 0?null:r;var s=void 0;if(Hn!==null){var a=Hn.memoizedState;if(s=a.destroy,r!==null&&YF(r,a.deps)){n.memoizedState=xw(t,i,s,r);return}}Hr.flags|=e,n.memoizedState=xw(1|t,i,s,r)}function VV(e,t){return HE(8390656,8,e,t)}function KF(e,t){return oC(2048,8,e,t)}function WQ(e,t){return oC(4,2,e,t)}function XQ(e,t){return oC(4,4,e,t)}function qQ(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function YQ(e,t,i){return i=i!=null?i.concat([e]):null,oC(4,4,qQ.bind(null,t,e),i)}function JF(){}function QQ(e,t){var i=wl();t=t===void 0?null:t;var r=i.memoizedState;return r!==null&&t!==null&&YF(t,r[1])?r[0]:(i.memoizedState=[e,t],e)}function ZQ(e,t){var i=wl();t=t===void 0?null:t;var r=i.memoizedState;return r!==null&&t!==null&&YF(t,r[1])?r[0]:(e=e(),i.memoizedState=[e,t],e)}function KQ(e,t,i){return xm&21?(rc(i,t)||(i=iQ(),Hr.lanes|=i,wm|=i,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,io=!0),e.memoizedState=i)}function Qle(e,t){var i=ur;ur=i!==0&&4>i?i:4,e(!0);var r=q3.transition;q3.transition={};try{e(!1),t()}finally{ur=i,q3.transition=r}}function JQ(){return wl().memoizedState}function Zle(e,t,i){var r=tf(e);if(i={lane:r,action:i,hasEagerState:!1,eagerState:null,next:null},$Q(e))eZ(t,i);else if(i=OQ(e,t,i,r),i!==null){var n=Ia();tc(i,e,r,n),tZ(i,t,r)}}function Kle(e,t,i){var r=tf(e),n={lane:r,action:i,hasEagerState:!1,eagerState:null,next:null};if($Q(e))eZ(t,n);else{var s=e.alternate;if(e.lanes===0&&(s===null||s.lanes===0)&&(s=t.lastRenderedReducer,s!==null))try{var a=t.lastRenderedState,o=s(a,i);if(n.hasEagerState=!0,n.eagerState=o,rc(o,a)){var l=t.interleaved;l===null?(n.next=n,HF(t)):(n.next=l.next,l.next=n),t.interleaved=n;return}}catch{}finally{}i=OQ(e,t,n,r),i!==null&&(n=Ia(),tc(i,e,r,n),tZ(i,t,r))}}function $Q(e){var t=e.alternate;return e===Hr||t!==null&&t===Hr}function eZ(e,t){bx=k2=!0;var i=e.pending;i===null?t.next=t:(t.next=i.next,i.next=t),e.pending=t}function tZ(e,t,i){if(i&4194240){var r=t.lanes;r&=e.pendingLanes,i|=r,t.lanes=i,PF(e,i)}}var V2={readContext:xl,useCallback:Xs,useContext:Xs,useEffect:Xs,useImperativeHandle:Xs,useInsertionEffect:Xs,useLayoutEffect:Xs,useMemo:Xs,useReducer:Xs,useRef:Xs,useState:Xs,useDebugValue:Xs,useDeferredValue:Xs,useTransition:Xs,useMutableSource:Xs,useSyncExternalStore:Xs,useId:Xs,unstable_isNewReconciler:!1},Jle={readContext:xl,useCallback:function(e,t){return Oc().memoizedState=[e,t===void 0?null:t],e},useContext:xl,useEffect:VV,useImperativeHandle:function(e,t,i){return i=i!=null?i.concat([e]):null,HE(4194308,4,qQ.bind(null,t,e),i)},useLayoutEffect:function(e,t){return HE(4194308,4,e,t)},useInsertionEffect:function(e,t){return HE(4,2,e,t)},useMemo:function(e,t){var i=Oc();return t=t===void 0?null:t,e=e(),i.memoizedState=[e,t],e},useReducer:function(e,t,i){var r=Oc();return t=i!==void 0?i(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=Zle.bind(null,Hr,e),[r.memoizedState,e]},useRef:function(e){var t=Oc();return e={current:e},t.memoizedState=e},useState:kV,useDebugValue:JF,useDeferredValue:function(e){return Oc().memoizedState=e},useTransition:function(){var e=kV(!1),t=e[0];return e=Qle.bind(null,e[1]),Oc().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,i){var r=Hr,n=Oc();if(Ir){if(i===void 0)throw Error(gt(407));i=i()}else{if(i=t(),vs===null)throw Error(gt(349));xm&30||NQ(r,t,i)}n.memoizedState=i;var s={value:i,getSnapshot:t};return n.queue=s,VV(VQ.bind(null,r,s,e),[e]),r.flags|=2048,xw(9,kQ.bind(null,r,s,i,t),void 0,null),i},useId:function(){var e=Oc(),t=vs.identifierPrefix;if(Ir){var i=ah,r=sh;i=(r&~(1<<32-ec(r)-1)).toString(32)+i,t=":"+t+"R"+i,i=vw++,0<i&&(t+="H"+i.toString(32)),t+=":"}else i=Yle++,t=":"+t+"r"+i.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},$le={readContext:xl,useCallback:QQ,useContext:xl,useEffect:KF,useImperativeHandle:YQ,useInsertionEffect:WQ,useLayoutEffect:XQ,useMemo:ZQ,useReducer:Y3,useRef:jQ,useState:function(){return Y3(yw)},useDebugValue:JF,useDeferredValue:function(e){var t=wl();return KQ(t,Hn.memoizedState,e)},useTransition:function(){var e=Y3(yw)[0],t=wl().memoizedState;return[e,t]},useMutableSource:FQ,useSyncExternalStore:UQ,useId:JQ,unstable_isNewReconciler:!1},ece={readContext:xl,useCallback:QQ,useContext:xl,useEffect:KF,useImperativeHandle:YQ,useInsertionEffect:WQ,useLayoutEffect:XQ,useMemo:ZQ,useReducer:Q3,useRef:jQ,useState:function(){return Q3(yw)},useDebugValue:JF,useDeferredValue:function(e){var t=wl();return Hn===null?t.memoizedState=e:KQ(t,Hn.memoizedState,e)},useTransition:function(){var e=Q3(yw)[0],t=wl().memoizedState;return[e,t]},useMutableSource:FQ,useSyncExternalStore:UQ,useId:JQ,unstable_isNewReconciler:!1};function Vl(e,t){if(e&&e.defaultProps){t=Xr({},t),e=e.defaultProps;for(var i in e)t[i]===void 0&&(t[i]=e[i]);return t}return t}function rO(e,t,i,r){t=e.memoizedState,i=i(r,t),i=i==null?t:Xr({},t,i),e.memoizedState=i,e.lanes===0&&(e.updateQueue.baseState=i)}var lC={isMounted:function(e){return(e=e._reactInternals)?km(e)===e:!1},enqueueSetState:function(e,t,i){e=e._reactInternals;var r=Ia(),n=tf(e),s=mh(r,n);s.payload=t,i!=null&&(s.callback=i),t=$d(e,s,n),t!==null&&(tc(t,e,n,r),VE(t,e,n))},enqueueReplaceState:function(e,t,i){e=e._reactInternals;var r=Ia(),n=tf(e),s=mh(r,n);s.tag=1,s.payload=t,i!=null&&(s.callback=i),t=$d(e,s,n),t!==null&&(tc(t,e,n,r),VE(t,e,n))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var i=Ia(),r=tf(e),n=mh(i,r);n.tag=2,t!=null&&(n.callback=t),t=$d(e,n,r),t!==null&&(tc(t,e,r,i),VE(t,e,r))}};function GV(e,t,i,r,n,s,a){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(r,s,a):t.prototype&&t.prototype.isPureReactComponent?!hw(i,r)||!hw(n,s):!0}function iZ(e,t,i){var r=!1,n=ff,s=t.contextType;return typeof s=="object"&&s!==null?s=xl(s):(n=oo(t)?vm:la.current,r=t.contextTypes,s=(r=r!=null)?S0(e,n):ff),t=new t(i,s),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=lC,e.stateNode=t,t._reactInternals=e,r&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=n,e.__reactInternalMemoizedMaskedChildContext=s),t}function HV(e,t,i,r){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(i,r),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(i,r),t.state!==e&&lC.enqueueReplaceState(t,t.state,null)}function nO(e,t,i,r){var n=e.stateNode;n.props=i,n.state=e.memoizedState,n.refs={},jF(e);var s=t.contextType;typeof s=="object"&&s!==null?n.context=xl(s):(s=oo(t)?vm:la.current,n.context=S0(e,s)),n.state=e.memoizedState,s=t.getDerivedStateFromProps,typeof s=="function"&&(rO(e,t,s,i),n.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof n.getSnapshotBeforeUpdate=="function"||typeof n.UNSAFE_componentWillMount!="function"&&typeof n.componentWillMount!="function"||(t=n.state,typeof n.componentWillMount=="function"&&n.componentWillMount(),typeof n.UNSAFE_componentWillMount=="function"&&n.UNSAFE_componentWillMount(),t!==n.state&&lC.enqueueReplaceState(n,n.state,null),U2(e,i,n,r),n.state=e.memoizedState),typeof n.componentDidMount=="function"&&(e.flags|=4194308)}function T0(e,t){try{var i="",r=t;do i+=Coe(r),r=r.return;while(r);var n=i}catch(s){n=`
Error generating stack: `+s.message+`
`+s.stack}return{value:e,source:t,stack:n,digest:null}}function Z3(e,t,i){return{value:e,source:null,stack:i??null,digest:t??null}}function sO(e,t){try{console.error(t.value)}catch(i){setTimeout(function(){throw i})}}var tce=typeof WeakMap=="function"?WeakMap:Map;function rZ(e,t,i){i=mh(-1,i),i.tag=3,i.payload={element:null};var r=t.value;return i.callback=function(){H2||(H2=!0,mO=r),sO(e,t)},i}function nZ(e,t,i){i=mh(-1,i),i.tag=3;var r=e.type.getDerivedStateFromError;if(typeof r=="function"){var n=t.value;i.payload=function(){return r(n)},i.callback=function(){sO(e,t)}}var s=e.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(i.callback=function(){sO(e,t),typeof r!="function"&&(ef===null?ef=new Set([this]):ef.add(this));var a=t.stack;this.componentDidCatch(t.value,{componentStack:a!==null?a:""})}),i}function jV(e,t,i){var r=e.pingCache;if(r===null){r=e.pingCache=new tce;var n=new Set;r.set(t,n)}else n=r.get(t),n===void 0&&(n=new Set,r.set(t,n));n.has(i)||(n.add(i),e=mce.bind(null,e,t,i),t.then(e,e))}function WV(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function XV(e,t,i,r,n){return e.mode&1?(e.flags|=65536,e.lanes=n,e):(e===t?e.flags|=65536:(e.flags|=128,i.flags|=131072,i.flags&=-52805,i.tag===1&&(i.alternate===null?i.tag=17:(t=mh(-1,1),t.tag=2,$d(i,t,1))),i.lanes|=1),e)}var ice=Fh.ReactCurrentOwner,io=!1;function Ea(e,t,i,r){t.child=e===null?LQ(t,null,i,r):E0(t,e.child,i,r)}function qV(e,t,i,r,n){i=i.render;var s=t.ref;return s0(t,n),r=QF(e,t,i,r,s,n),i=ZF(),e!==null&&!io?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~n,Eh(e,t,n)):(Ir&&i&&FF(t),t.flags|=1,Ea(e,t,r,n),t.child)}function YV(e,t,i,r,n){if(e===null){var s=i.type;return typeof s=="function"&&!aU(s)&&s.defaultProps===void 0&&i.compare===null&&i.defaultProps===void 0?(t.tag=15,t.type=s,sZ(e,t,s,r,n)):(e=qE(i.type,null,r,t,t.mode,n),e.ref=t.ref,e.return=t,t.child=e)}if(s=e.child,!(e.lanes&n)){var a=s.memoizedProps;if(i=i.compare,i=i!==null?i:hw,i(a,r)&&e.ref===t.ref)return Eh(e,t,n)}return t.flags|=1,e=rf(s,r),e.ref=t.ref,e.return=t,t.child=e}function sZ(e,t,i,r,n){if(e!==null){var s=e.memoizedProps;if(hw(s,r)&&e.ref===t.ref)if(io=!1,t.pendingProps=r=s,(e.lanes&n)!==0)e.flags&131072&&(io=!0);else return t.lanes=e.lanes,Eh(e,t,n)}return aO(e,t,i,r,n)}function aZ(e,t,i){var r=t.pendingProps,n=r.children,s=e!==null?e.memoizedState:null;if(r.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},_r(Bv,Ao),Ao|=i;else{if(!(i&1073741824))return e=s!==null?s.baseLanes|i:i,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,_r(Bv,Ao),Ao|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=s!==null?s.baseLanes:i,_r(Bv,Ao),Ao|=r}else s!==null?(r=s.baseLanes|i,t.memoizedState=null):r=i,_r(Bv,Ao),Ao|=r;return Ea(e,t,n,i),t.child}function oZ(e,t){var i=t.ref;(e===null&&i!==null||e!==null&&e.ref!==i)&&(t.flags|=512,t.flags|=2097152)}function aO(e,t,i,r,n){var s=oo(i)?vm:la.current;return s=S0(t,s),s0(t,n),i=QF(e,t,i,r,s,n),r=ZF(),e!==null&&!io?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~n,Eh(e,t,n)):(Ir&&r&&FF(t),t.flags|=1,Ea(e,t,i,n),t.child)}function QV(e,t,i,r,n){if(oo(i)){var s=!0;L2(t)}else s=!1;if(s0(t,n),t.stateNode===null)jE(e,t),iZ(t,i,r),nO(t,i,r,n),r=!0;else if(e===null){var a=t.stateNode,o=t.memoizedProps;a.props=o;var l=a.context,c=i.contextType;typeof c=="object"&&c!==null?c=xl(c):(c=oo(i)?vm:la.current,c=S0(t,c));var u=i.getDerivedStateFromProps,h=typeof u=="function"||typeof a.getSnapshotBeforeUpdate=="function";h||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(o!==r||l!==c)&&HV(t,a,r,c),Sd=!1;var d=t.memoizedState;a.state=d,U2(t,r,a,n),l=t.memoizedState,o!==r||d!==l||ao.current||Sd?(typeof u=="function"&&(rO(t,i,u,r),l=t.memoizedState),(o=Sd||GV(t,i,o,r,d,l,c))?(h||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount=="function"&&(t.flags|=4194308)):(typeof a.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=l),a.props=r,a.state=l,a.context=c,r=o):(typeof a.componentDidMount=="function"&&(t.flags|=4194308),r=!1)}else{a=t.stateNode,zQ(e,t),o=t.memoizedProps,c=t.type===t.elementType?o:Vl(t.type,o),a.props=c,h=t.pendingProps,d=a.context,l=i.contextType,typeof l=="object"&&l!==null?l=xl(l):(l=oo(i)?vm:la.current,l=S0(t,l));var f=i.getDerivedStateFromProps;(u=typeof f=="function"||typeof a.getSnapshotBeforeUpdate=="function")||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(o!==h||d!==l)&&HV(t,a,r,l),Sd=!1,d=t.memoizedState,a.state=d,U2(t,r,a,n);var p=t.memoizedState;o!==h||d!==p||ao.current||Sd?(typeof f=="function"&&(rO(t,i,f,r),p=t.memoizedState),(c=Sd||GV(t,i,c,r,d,p,l)||!1)?(u||typeof a.UNSAFE_componentWillUpdate!="function"&&typeof a.componentWillUpdate!="function"||(typeof a.componentWillUpdate=="function"&&a.componentWillUpdate(r,p,l),typeof a.UNSAFE_componentWillUpdate=="function"&&a.UNSAFE_componentWillUpdate(r,p,l)),typeof a.componentDidUpdate=="function"&&(t.flags|=4),typeof a.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof a.componentDidUpdate!="function"||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=p),a.props=r,a.state=p,a.context=l,r=c):(typeof a.componentDidUpdate!="function"||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),r=!1)}return oO(e,t,i,r,s,n)}function oO(e,t,i,r,n,s){oZ(e,t);var a=(t.flags&128)!==0;if(!r&&!a)return n&&OV(t,i,!1),Eh(e,t,s);r=t.stateNode,ice.current=t;var o=a&&typeof i.getDerivedStateFromError!="function"?null:r.render();return t.flags|=1,e!==null&&a?(t.child=E0(t,e.child,null,s),t.child=E0(t,null,o,s)):Ea(e,t,o,s),t.memoizedState=r.state,n&&OV(t,i,!0),t.child}function lZ(e){var t=e.stateNode;t.pendingContext?LV(e,t.pendingContext,t.pendingContext!==t.context):t.context&&LV(e,t.context,!1),WF(e,t.containerInfo)}function ZV(e,t,i,r,n){return M0(),NF(n),t.flags|=256,Ea(e,t,i,r),t.child}var lO={dehydrated:null,treeContext:null,retryLane:0};function cO(e){return{baseLanes:e,cachePool:null,transitions:null}}function cZ(e,t,i){var r=t.pendingProps,n=Ur.current,s=!1,a=(t.flags&128)!==0,o;if((o=a)||(o=e!==null&&e.memoizedState===null?!1:(n&2)!==0),o?(s=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(n|=1),_r(Ur,n&1),e===null)return tO(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(a=r.children,e=r.fallback,s?(r=t.mode,s=t.child,a={mode:"hidden",children:a},!(r&1)&&s!==null?(s.childLanes=0,s.pendingProps=a):s=hC(a,r,0,null),e=im(e,r,i,null),s.return=t,e.return=t,s.sibling=e,t.child=s,t.child.memoizedState=cO(i),t.memoizedState=lO,e):$F(t,a));if(n=e.memoizedState,n!==null&&(o=n.dehydrated,o!==null))return rce(e,t,a,r,o,n,i);if(s){s=r.fallback,a=t.mode,n=e.child,o=n.sibling;var l={mode:"hidden",children:r.children};return!(a&1)&&t.child!==n?(r=t.child,r.childLanes=0,r.pendingProps=l,t.deletions=null):(r=rf(n,l),r.subtreeFlags=n.subtreeFlags&14680064),o!==null?s=rf(o,s):(s=im(s,a,i,null),s.flags|=2),s.return=t,r.return=t,r.sibling=s,t.child=r,r=s,s=t.child,a=e.child.memoizedState,a=a===null?cO(i):{baseLanes:a.baseLanes|i,cachePool:null,transitions:a.transitions},s.memoizedState=a,s.childLanes=e.childLanes&~i,t.memoizedState=lO,r}return s=e.child,e=s.sibling,r=rf(s,{mode:"visible",children:r.children}),!(t.mode&1)&&(r.lanes=i),r.return=t,r.sibling=null,e!==null&&(i=t.deletions,i===null?(t.deletions=[e],t.flags|=16):i.push(e)),t.child=r,t.memoizedState=null,r}function $F(e,t){return t=hC({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function sS(e,t,i,r){return r!==null&&NF(r),E0(t,e.child,null,i),e=$F(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function rce(e,t,i,r,n,s,a){if(i)return t.flags&256?(t.flags&=-257,r=Z3(Error(gt(422))),sS(e,t,a,r)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(s=r.fallback,n=t.mode,r=hC({mode:"visible",children:r.children},n,0,null),s=im(s,n,a,null),s.flags|=2,r.return=t,s.return=t,r.sibling=s,t.child=r,t.mode&1&&E0(t,e.child,null,a),t.child.memoizedState=cO(a),t.memoizedState=lO,s);if(!(t.mode&1))return sS(e,t,a,null);if(n.data==="$!"){if(r=n.nextSibling&&n.nextSibling.dataset,r)var o=r.dgst;return r=o,s=Error(gt(419)),r=Z3(s,r,void 0),sS(e,t,a,r)}if(o=(a&e.childLanes)!==0,io||o){if(r=vs,r!==null){switch(a&-a){case 4:n=2;break;case 16:n=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:n=32;break;case 536870912:n=268435456;break;default:n=0}n=n&(r.suspendedLanes|a)?0:n,n!==0&&n!==s.retryLane&&(s.retryLane=n,Mh(e,n),tc(r,e,n,-1))}return sU(),r=Z3(Error(gt(421))),sS(e,t,a,r)}return n.data==="$?"?(t.flags|=128,t.child=e.child,t=gce.bind(null,e),n._reactRetry=t,null):(e=s.treeContext,Po=Jd(n.nextSibling),Ro=t,Ir=!0,jl=null,e!==null&&(ll[cl++]=sh,ll[cl++]=ah,ll[cl++]=ym,sh=e.id,ah=e.overflow,ym=t),t=$F(t,r.children),t.flags|=4096,t)}function KV(e,t,i){e.lanes|=t;var r=e.alternate;r!==null&&(r.lanes|=t),iO(e.return,t,i)}function K3(e,t,i,r,n){var s=e.memoizedState;s===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:i,tailMode:n}:(s.isBackwards=t,s.rendering=null,s.renderingStartTime=0,s.last=r,s.tail=i,s.tailMode=n)}function uZ(e,t,i){var r=t.pendingProps,n=r.revealOrder,s=r.tail;if(Ea(e,t,r.children,i),r=Ur.current,r&2)r=r&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&KV(e,i,t);else if(e.tag===19)KV(e,i,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(_r(Ur,r),!(t.mode&1))t.memoizedState=null;else switch(n){case"forwards":for(i=t.child,n=null;i!==null;)e=i.alternate,e!==null&&N2(e)===null&&(n=i),i=i.sibling;i=n,i===null?(n=t.child,t.child=null):(n=i.sibling,i.sibling=null),K3(t,!1,n,i,s);break;case"backwards":for(i=null,n=t.child,t.child=null;n!==null;){if(e=n.alternate,e!==null&&N2(e)===null){t.child=n;break}e=n.sibling,n.sibling=i,i=n,n=e}K3(t,!0,i,null,s);break;case"together":K3(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function jE(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Eh(e,t,i){if(e!==null&&(t.dependencies=e.dependencies),wm|=t.lanes,!(i&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(gt(153));if(t.child!==null){for(e=t.child,i=rf(e,e.pendingProps),t.child=i,i.return=t;e.sibling!==null;)e=e.sibling,i=i.sibling=rf(e,e.pendingProps),i.return=t;i.sibling=null}return t.child}function nce(e,t,i){switch(t.tag){case 3:lZ(t),M0();break;case 5:BQ(t);break;case 1:oo(t.type)&&L2(t);break;case 4:WF(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,n=t.memoizedProps.value;_r(B2,r._currentValue),r._currentValue=n;break;case 13:if(r=t.memoizedState,r!==null)return r.dehydrated!==null?(_r(Ur,Ur.current&1),t.flags|=128,null):i&t.child.childLanes?cZ(e,t,i):(_r(Ur,Ur.current&1),e=Eh(e,t,i),e!==null?e.sibling:null);_r(Ur,Ur.current&1);break;case 19:if(r=(i&t.childLanes)!==0,e.flags&128){if(r)return uZ(e,t,i);t.flags|=128}if(n=t.memoizedState,n!==null&&(n.rendering=null,n.tail=null,n.lastEffect=null),_r(Ur,Ur.current),r)break;return null;case 22:case 23:return t.lanes=0,aZ(e,t,i)}return Eh(e,t,i)}var hZ,uO,dZ,fZ;hZ=function(e,t){for(var i=t.child;i!==null;){if(i.tag===5||i.tag===6)e.appendChild(i.stateNode);else if(i.tag!==4&&i.child!==null){i.child.return=i,i=i.child;continue}if(i===t)break;for(;i.sibling===null;){if(i.return===null||i.return===t)return;i=i.return}i.sibling.return=i.return,i=i.sibling}};uO=function(){};dZ=function(e,t,i,r){var n=e.memoizedProps;if(n!==r){e=t.stateNode,Gp(Qc.current);var s=null;switch(i){case"input":n=IL(e,n),r=IL(e,r),s=[];break;case"select":n=Xr({},n,{value:void 0}),r=Xr({},r,{value:void 0}),s=[];break;case"textarea":n=zL(e,n),r=zL(e,r),s=[];break;default:typeof n.onClick!="function"&&typeof r.onClick=="function"&&(e.onclick=R2)}FL(i,r);var a;i=null;for(c in n)if(!r.hasOwnProperty(c)&&n.hasOwnProperty(c)&&n[c]!=null)if(c==="style"){var o=n[c];for(a in o)o.hasOwnProperty(a)&&(i||(i={}),i[a]="")}else c!=="dangerouslySetInnerHTML"&&c!=="children"&&c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(nw.hasOwnProperty(c)?s||(s=[]):(s=s||[]).push(c,null));for(c in r){var l=r[c];if(o=n!=null?n[c]:void 0,r.hasOwnProperty(c)&&l!==o&&(l!=null||o!=null))if(c==="style")if(o){for(a in o)!o.hasOwnProperty(a)||l&&l.hasOwnProperty(a)||(i||(i={}),i[a]="");for(a in l)l.hasOwnProperty(a)&&o[a]!==l[a]&&(i||(i={}),i[a]=l[a])}else i||(s||(s=[]),s.push(c,i)),i=l;else c==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,o=o?o.__html:void 0,l!=null&&o!==l&&(s=s||[]).push(c,l)):c==="children"?typeof l!="string"&&typeof l!="number"||(s=s||[]).push(c,""+l):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&(nw.hasOwnProperty(c)?(l!=null&&c==="onScroll"&&Mr("scroll",e),s||o===l||(s=[])):(s=s||[]).push(c,l))}i&&(s=s||[]).push("style",i);var c=s;(t.updateQueue=c)&&(t.flags|=4)}};fZ=function(e,t,i,r){i!==r&&(t.flags|=4)};function i1(e,t){if(!Ir)switch(e.tailMode){case"hidden":t=e.tail;for(var i=null;t!==null;)t.alternate!==null&&(i=t),t=t.sibling;i===null?e.tail=null:i.sibling=null;break;case"collapsed":i=e.tail;for(var r=null;i!==null;)i.alternate!==null&&(r=i),i=i.sibling;r===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:r.sibling=null}}function qs(e){var t=e.alternate!==null&&e.alternate.child===e.child,i=0,r=0;if(t)for(var n=e.child;n!==null;)i|=n.lanes|n.childLanes,r|=n.subtreeFlags&14680064,r|=n.flags&14680064,n.return=e,n=n.sibling;else for(n=e.child;n!==null;)i|=n.lanes|n.childLanes,r|=n.subtreeFlags,r|=n.flags,n.return=e,n=n.sibling;return e.subtreeFlags|=r,e.childLanes=i,t}function sce(e,t,i){var r=t.pendingProps;switch(UF(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return qs(t),null;case 1:return oo(t.type)&&I2(),qs(t),null;case 3:return r=t.stateNode,A0(),Cr(ao),Cr(la),qF(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(e===null||e.child===null)&&(rS(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,jl!==null&&(yO(jl),jl=null))),uO(e,t),qs(t),null;case 5:XF(t);var n=Gp(gw.current);if(i=t.type,e!==null&&t.stateNode!=null)dZ(e,t,i,r,n),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(t.stateNode===null)throw Error(gt(166));return qs(t),null}if(e=Gp(Qc.current),rS(t)){r=t.stateNode,i=t.type;var s=t.memoizedProps;switch(r[Nc]=t,r[pw]=s,e=(t.mode&1)!==0,i){case"dialog":Mr("cancel",r),Mr("close",r);break;case"iframe":case"object":case"embed":Mr("load",r);break;case"video":case"audio":for(n=0;n<$1.length;n++)Mr($1[n],r);break;case"source":Mr("error",r);break;case"img":case"image":case"link":Mr("error",r),Mr("load",r);break;case"details":Mr("toggle",r);break;case"input":aV(r,s),Mr("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!s.multiple},Mr("invalid",r);break;case"textarea":lV(r,s),Mr("invalid",r)}FL(i,s),n=null;for(var a in s)if(s.hasOwnProperty(a)){var o=s[a];a==="children"?typeof o=="string"?r.textContent!==o&&(s.suppressHydrationWarning!==!0&&iS(r.textContent,o,e),n=["children",o]):typeof o=="number"&&r.textContent!==""+o&&(s.suppressHydrationWarning!==!0&&iS(r.textContent,o,e),n=["children",""+o]):nw.hasOwnProperty(a)&&o!=null&&a==="onScroll"&&Mr("scroll",r)}switch(i){case"input":Y_(r),oV(r,s,!0);break;case"textarea":Y_(r),cV(r);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(r.onclick=R2)}r=n,t.updateQueue=r,r!==null&&(t.flags|=4)}else{a=n.nodeType===9?n:n.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=VY(i)),e==="http://www.w3.org/1999/xhtml"?i==="script"?(e=a.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof r.is=="string"?e=a.createElement(i,{is:r.is}):(e=a.createElement(i),i==="select"&&(a=e,r.multiple?a.multiple=!0:r.size&&(a.size=r.size))):e=a.createElementNS(e,i),e[Nc]=t,e[pw]=r,hZ(e,t,!1,!1),t.stateNode=e;e:{switch(a=UL(i,r),i){case"dialog":Mr("cancel",e),Mr("close",e),n=r;break;case"iframe":case"object":case"embed":Mr("load",e),n=r;break;case"video":case"audio":for(n=0;n<$1.length;n++)Mr($1[n],e);n=r;break;case"source":Mr("error",e),n=r;break;case"img":case"image":case"link":Mr("error",e),Mr("load",e),n=r;break;case"details":Mr("toggle",e),n=r;break;case"input":aV(e,r),n=IL(e,r),Mr("invalid",e);break;case"option":n=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},n=Xr({},r,{value:void 0}),Mr("invalid",e);break;case"textarea":lV(e,r),n=zL(e,r),Mr("invalid",e);break;default:n=r}FL(i,n),o=n;for(s in o)if(o.hasOwnProperty(s)){var l=o[s];s==="style"?jY(e,l):s==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&GY(e,l)):s==="children"?typeof l=="string"?(i!=="textarea"||l!=="")&&sw(e,l):typeof l=="number"&&sw(e,""+l):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(nw.hasOwnProperty(s)?l!=null&&s==="onScroll"&&Mr("scroll",e):l!=null&&SF(e,s,l,a))}switch(i){case"input":Y_(e),oV(e,r,!1);break;case"textarea":Y_(e),cV(e);break;case"option":r.value!=null&&e.setAttribute("value",""+df(r.value));break;case"select":e.multiple=!!r.multiple,s=r.value,s!=null?t0(e,!!r.multiple,s,!1):r.defaultValue!=null&&t0(e,!!r.multiple,r.defaultValue,!0);break;default:typeof n.onClick=="function"&&(e.onclick=R2)}switch(i){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return qs(t),null;case 6:if(e&&t.stateNode!=null)fZ(e,t,e.memoizedProps,r);else{if(typeof r!="string"&&t.stateNode===null)throw Error(gt(166));if(i=Gp(gw.current),Gp(Qc.current),rS(t)){if(r=t.stateNode,i=t.memoizedProps,r[Nc]=t,(s=r.nodeValue!==i)&&(e=Ro,e!==null))switch(e.tag){case 3:iS(r.nodeValue,i,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&iS(r.nodeValue,i,(e.mode&1)!==0)}s&&(t.flags|=4)}else r=(i.nodeType===9?i:i.ownerDocument).createTextNode(r),r[Nc]=t,t.stateNode=r}return qs(t),null;case 13:if(Cr(Ur),r=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(Ir&&Po!==null&&t.mode&1&&!(t.flags&128))RQ(),M0(),t.flags|=98560,s=!1;else if(s=rS(t),r!==null&&r.dehydrated!==null){if(e===null){if(!s)throw Error(gt(318));if(s=t.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(gt(317));s[Nc]=t}else M0(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;qs(t),s=!1}else jl!==null&&(yO(jl),jl=null),s=!0;if(!s)return t.flags&65536?t:null}return t.flags&128?(t.lanes=i,t):(r=r!==null,r!==(e!==null&&e.memoizedState!==null)&&r&&(t.child.flags|=8192,t.mode&1&&(e===null||Ur.current&1?Yn===0&&(Yn=3):sU())),t.updateQueue!==null&&(t.flags|=4),qs(t),null);case 4:return A0(),uO(e,t),e===null&&dw(t.stateNode.containerInfo),qs(t),null;case 10:return GF(t.type._context),qs(t),null;case 17:return oo(t.type)&&I2(),qs(t),null;case 19:if(Cr(Ur),s=t.memoizedState,s===null)return qs(t),null;if(r=(t.flags&128)!==0,a=s.rendering,a===null)if(r)i1(s,!1);else{if(Yn!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(a=N2(e),a!==null){for(t.flags|=128,i1(s,!1),r=a.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=i,i=t.child;i!==null;)s=i,e=r,s.flags&=14680066,a=s.alternate,a===null?(s.childLanes=0,s.lanes=e,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=a.childLanes,s.lanes=a.lanes,s.child=a.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=a.memoizedProps,s.memoizedState=a.memoizedState,s.updateQueue=a.updateQueue,s.type=a.type,e=a.dependencies,s.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),i=i.sibling;return _r(Ur,Ur.current&1|2),t.child}e=e.sibling}s.tail!==null&&dn()>C0&&(t.flags|=128,r=!0,i1(s,!1),t.lanes=4194304)}else{if(!r)if(e=N2(a),e!==null){if(t.flags|=128,r=!0,i=e.updateQueue,i!==null&&(t.updateQueue=i,t.flags|=4),i1(s,!0),s.tail===null&&s.tailMode==="hidden"&&!a.alternate&&!Ir)return qs(t),null}else 2*dn()-s.renderingStartTime>C0&&i!==1073741824&&(t.flags|=128,r=!0,i1(s,!1),t.lanes=4194304);s.isBackwards?(a.sibling=t.child,t.child=a):(i=s.last,i!==null?i.sibling=a:t.child=a,s.last=a)}return s.tail!==null?(t=s.tail,s.rendering=t,s.tail=t.sibling,s.renderingStartTime=dn(),t.sibling=null,i=Ur.current,_r(Ur,r?i&1|2:i&1),t):(qs(t),null);case 22:case 23:return nU(),r=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==r&&(t.flags|=8192),r&&t.mode&1?Ao&1073741824&&(qs(t),t.subtreeFlags&6&&(t.flags|=8192)):qs(t),null;case 24:return null;case 25:return null}throw Error(gt(156,t.tag))}function ace(e,t){switch(UF(t),t.tag){case 1:return oo(t.type)&&I2(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return A0(),Cr(ao),Cr(la),qF(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return XF(t),null;case 13:if(Cr(Ur),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(gt(340));M0()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return Cr(Ur),null;case 4:return A0(),null;case 10:return GF(t.type._context),null;case 22:case 23:return nU(),null;case 24:return null;default:return null}}var aS=!1,ea=!1,oce=typeof WeakSet=="function"?WeakSet:Set,Bt=null;function zv(e,t){var i=e.ref;if(i!==null)if(typeof i=="function")try{i(null)}catch(r){$r(e,t,r)}else i.current=null}function hO(e,t,i){try{i()}catch(r){$r(e,t,r)}}var JV=!1;function lce(e,t){if(YL=C2,e=yQ(),BF(e)){if("selectionStart"in e)var i={start:e.selectionStart,end:e.selectionEnd};else e:{i=(i=e.ownerDocument)&&i.defaultView||window;var r=i.getSelection&&i.getSelection();if(r&&r.rangeCount!==0){i=r.anchorNode;var n=r.anchorOffset,s=r.focusNode;r=r.focusOffset;try{i.nodeType,s.nodeType}catch{i=null;break e}var a=0,o=-1,l=-1,c=0,u=0,h=e,d=null;t:for(;;){for(var f;h!==i||n!==0&&h.nodeType!==3||(o=a+n),h!==s||r!==0&&h.nodeType!==3||(l=a+r),h.nodeType===3&&(a+=h.nodeValue.length),(f=h.firstChild)!==null;)d=h,h=f;for(;;){if(h===e)break t;if(d===i&&++c===n&&(o=a),d===s&&++u===r&&(l=a),(f=h.nextSibling)!==null)break;h=d,d=h.parentNode}h=f}i=o===-1||l===-1?null:{start:o,end:l}}else i=null}i=i||{start:0,end:0}}else i=null;for(QL={focusedElem:e,selectionRange:i},C2=!1,Bt=t;Bt!==null;)if(t=Bt,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,Bt=e;else for(;Bt!==null;){t=Bt;try{var p=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(p!==null){var v=p.memoizedProps,m=p.memoizedState,g=t.stateNode,y=g.getSnapshotBeforeUpdate(t.elementType===t.type?v:Vl(t.type,v),m);g.__reactInternalSnapshotBeforeUpdate=y}break;case 3:var x=t.stateNode.containerInfo;x.nodeType===1?x.textContent="":x.nodeType===9&&x.documentElement&&x.removeChild(x.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(gt(163))}}catch(_){$r(t,t.return,_)}if(e=t.sibling,e!==null){e.return=t.return,Bt=e;break}Bt=t.return}return p=JV,JV=!1,p}function _x(e,t,i){var r=t.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var n=r=r.next;do{if((n.tag&e)===e){var s=n.destroy;n.destroy=void 0,s!==void 0&&hO(t,i,s)}n=n.next}while(n!==r)}}function cC(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var i=t=t.next;do{if((i.tag&e)===e){var r=i.create;i.destroy=r()}i=i.next}while(i!==t)}}function dO(e){var t=e.ref;if(t!==null){var i=e.stateNode;switch(e.tag){case 5:e=i;break;default:e=i}typeof t=="function"?t(e):t.current=e}}function pZ(e){var t=e.alternate;t!==null&&(e.alternate=null,pZ(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[Nc],delete t[pw],delete t[JL],delete t[jle],delete t[Wle])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function mZ(e){return e.tag===5||e.tag===3||e.tag===4}function $V(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||mZ(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function fO(e,t,i){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?i.nodeType===8?i.parentNode.insertBefore(e,t):i.insertBefore(e,t):(i.nodeType===8?(t=i.parentNode,t.insertBefore(e,i)):(t=i,t.appendChild(e)),i=i._reactRootContainer,i!=null||t.onclick!==null||(t.onclick=R2));else if(r!==4&&(e=e.child,e!==null))for(fO(e,t,i),e=e.sibling;e!==null;)fO(e,t,i),e=e.sibling}function pO(e,t,i){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?i.insertBefore(e,t):i.appendChild(e);else if(r!==4&&(e=e.child,e!==null))for(pO(e,t,i),e=e.sibling;e!==null;)pO(e,t,i),e=e.sibling}var As=null,Hl=!1;function Jh(e,t,i){for(i=i.child;i!==null;)gZ(e,t,i),i=i.sibling}function gZ(e,t,i){if(Yc&&typeof Yc.onCommitFiberUnmount=="function")try{Yc.onCommitFiberUnmount(tC,i)}catch{}switch(i.tag){case 5:ea||zv(i,t);case 6:var r=As,n=Hl;As=null,Jh(e,t,i),As=r,Hl=n,As!==null&&(Hl?(e=As,i=i.stateNode,e.nodeType===8?e.parentNode.removeChild(i):e.removeChild(i)):As.removeChild(i.stateNode));break;case 18:As!==null&&(Hl?(e=As,i=i.stateNode,e.nodeType===8?j3(e.parentNode,i):e.nodeType===1&&j3(e,i),cw(e)):j3(As,i.stateNode));break;case 4:r=As,n=Hl,As=i.stateNode.containerInfo,Hl=!0,Jh(e,t,i),As=r,Hl=n;break;case 0:case 11:case 14:case 15:if(!ea&&(r=i.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){n=r=r.next;do{var s=n,a=s.destroy;s=s.tag,a!==void 0&&(s&2||s&4)&&hO(i,t,a),n=n.next}while(n!==r)}Jh(e,t,i);break;case 1:if(!ea&&(zv(i,t),r=i.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=i.memoizedProps,r.state=i.memoizedState,r.componentWillUnmount()}catch(o){$r(i,t,o)}Jh(e,t,i);break;case 21:Jh(e,t,i);break;case 22:i.mode&1?(ea=(r=ea)||i.memoizedState!==null,Jh(e,t,i),ea=r):Jh(e,t,i);break;default:Jh(e,t,i)}}function e6(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var i=e.stateNode;i===null&&(i=e.stateNode=new oce),t.forEach(function(r){var n=vce.bind(null,e,r);i.has(r)||(i.add(r),r.then(n,n))})}}function El(e,t){var i=t.deletions;if(i!==null)for(var r=0;r<i.length;r++){var n=i[r];try{var s=e,a=t,o=a;e:for(;o!==null;){switch(o.tag){case 5:As=o.stateNode,Hl=!1;break e;case 3:As=o.stateNode.containerInfo,Hl=!0;break e;case 4:As=o.stateNode.containerInfo,Hl=!0;break e}o=o.return}if(As===null)throw Error(gt(160));gZ(s,a,n),As=null,Hl=!1;var l=n.alternate;l!==null&&(l.return=null),n.return=null}catch(c){$r(n,t,c)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)vZ(t,e),t=t.sibling}function vZ(e,t){var i=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(El(t,e),wc(e),r&4){try{_x(3,e,e.return),cC(3,e)}catch(v){$r(e,e.return,v)}try{_x(5,e,e.return)}catch(v){$r(e,e.return,v)}}break;case 1:El(t,e),wc(e),r&512&&i!==null&&zv(i,i.return);break;case 5:if(El(t,e),wc(e),r&512&&i!==null&&zv(i,i.return),e.flags&32){var n=e.stateNode;try{sw(n,"")}catch(v){$r(e,e.return,v)}}if(r&4&&(n=e.stateNode,n!=null)){var s=e.memoizedProps,a=i!==null?i.memoizedProps:s,o=e.type,l=e.updateQueue;if(e.updateQueue=null,l!==null)try{o==="input"&&s.type==="radio"&&s.name!=null&&NY(n,s),UL(o,a);var c=UL(o,s);for(a=0;a<l.length;a+=2){var u=l[a],h=l[a+1];u==="style"?jY(n,h):u==="dangerouslySetInnerHTML"?GY(n,h):u==="children"?sw(n,h):SF(n,u,h,c)}switch(o){case"input":LL(n,s);break;case"textarea":kY(n,s);break;case"select":var d=n._wrapperState.wasMultiple;n._wrapperState.wasMultiple=!!s.multiple;var f=s.value;f!=null?t0(n,!!s.multiple,f,!1):d!==!!s.multiple&&(s.defaultValue!=null?t0(n,!!s.multiple,s.defaultValue,!0):t0(n,!!s.multiple,s.multiple?[]:"",!1))}n[pw]=s}catch(v){$r(e,e.return,v)}}break;case 6:if(El(t,e),wc(e),r&4){if(e.stateNode===null)throw Error(gt(162));n=e.stateNode,s=e.memoizedProps;try{n.nodeValue=s}catch(v){$r(e,e.return,v)}}break;case 3:if(El(t,e),wc(e),r&4&&i!==null&&i.memoizedState.isDehydrated)try{cw(t.containerInfo)}catch(v){$r(e,e.return,v)}break;case 4:El(t,e),wc(e);break;case 13:El(t,e),wc(e),n=e.child,n.flags&8192&&(s=n.memoizedState!==null,n.stateNode.isHidden=s,!s||n.alternate!==null&&n.alternate.memoizedState!==null||(iU=dn())),r&4&&e6(e);break;case 22:if(u=i!==null&&i.memoizedState!==null,e.mode&1?(ea=(c=ea)||u,El(t,e),ea=c):El(t,e),wc(e),r&8192){if(c=e.memoizedState!==null,(e.stateNode.isHidden=c)&&!u&&e.mode&1)for(Bt=e,u=e.child;u!==null;){for(h=Bt=u;Bt!==null;){switch(d=Bt,f=d.child,d.tag){case 0:case 11:case 14:case 15:_x(4,d,d.return);break;case 1:zv(d,d.return);var p=d.stateNode;if(typeof p.componentWillUnmount=="function"){r=d,i=d.return;try{t=r,p.props=t.memoizedProps,p.state=t.memoizedState,p.componentWillUnmount()}catch(v){$r(r,i,v)}}break;case 5:zv(d,d.return);break;case 22:if(d.memoizedState!==null){i6(h);continue}}f!==null?(f.return=d,Bt=f):i6(h)}u=u.sibling}e:for(u=null,h=e;;){if(h.tag===5){if(u===null){u=h;try{n=h.stateNode,c?(s=n.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(o=h.stateNode,l=h.memoizedProps.style,a=l!=null&&l.hasOwnProperty("display")?l.display:null,o.style.display=HY("display",a))}catch(v){$r(e,e.return,v)}}}else if(h.tag===6){if(u===null)try{h.stateNode.nodeValue=c?"":h.memoizedProps}catch(v){$r(e,e.return,v)}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===e)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===e)break e;for(;h.sibling===null;){if(h.return===null||h.return===e)break e;u===h&&(u=null),h=h.return}u===h&&(u=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:El(t,e),wc(e),r&4&&e6(e);break;case 21:break;default:El(t,e),wc(e)}}function wc(e){var t=e.flags;if(t&2){try{e:{for(var i=e.return;i!==null;){if(mZ(i)){var r=i;break e}i=i.return}throw Error(gt(160))}switch(r.tag){case 5:var n=r.stateNode;r.flags&32&&(sw(n,""),r.flags&=-33);var s=$V(e);pO(e,s,n);break;case 3:case 4:var a=r.stateNode.containerInfo,o=$V(e);fO(e,o,a);break;default:throw Error(gt(161))}}catch(l){$r(e,e.return,l)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function cce(e,t,i){Bt=e,yZ(e)}function yZ(e,t,i){for(var r=(e.mode&1)!==0;Bt!==null;){var n=Bt,s=n.child;if(n.tag===22&&r){var a=n.memoizedState!==null||aS;if(!a){var o=n.alternate,l=o!==null&&o.memoizedState!==null||ea;o=aS;var c=ea;if(aS=a,(ea=l)&&!c)for(Bt=n;Bt!==null;)a=Bt,l=a.child,a.tag===22&&a.memoizedState!==null?r6(n):l!==null?(l.return=a,Bt=l):r6(n);for(;s!==null;)Bt=s,yZ(s),s=s.sibling;Bt=n,aS=o,ea=c}t6(e)}else n.subtreeFlags&8772&&s!==null?(s.return=n,Bt=s):t6(e)}}function t6(e){for(;Bt!==null;){var t=Bt;if(t.flags&8772){var i=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:ea||cC(5,t);break;case 1:var r=t.stateNode;if(t.flags&4&&!ea)if(i===null)r.componentDidMount();else{var n=t.elementType===t.type?i.memoizedProps:Vl(t.type,i.memoizedProps);r.componentDidUpdate(n,i.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var s=t.updateQueue;s!==null&&NV(t,s,r);break;case 3:var a=t.updateQueue;if(a!==null){if(i=null,t.child!==null)switch(t.child.tag){case 5:i=t.child.stateNode;break;case 1:i=t.child.stateNode}NV(t,a,i)}break;case 5:var o=t.stateNode;if(i===null&&t.flags&4){i=o;var l=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&i.focus();break;case"img":l.src&&(i.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var c=t.alternate;if(c!==null){var u=c.memoizedState;if(u!==null){var h=u.dehydrated;h!==null&&cw(h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(gt(163))}ea||t.flags&512&&dO(t)}catch(d){$r(t,t.return,d)}}if(t===e){Bt=null;break}if(i=t.sibling,i!==null){i.return=t.return,Bt=i;break}Bt=t.return}}function i6(e){for(;Bt!==null;){var t=Bt;if(t===e){Bt=null;break}var i=t.sibling;if(i!==null){i.return=t.return,Bt=i;break}Bt=t.return}}function r6(e){for(;Bt!==null;){var t=Bt;try{switch(t.tag){case 0:case 11:case 15:var i=t.return;try{cC(4,t)}catch(l){$r(t,i,l)}break;case 1:var r=t.stateNode;if(typeof r.componentDidMount=="function"){var n=t.return;try{r.componentDidMount()}catch(l){$r(t,n,l)}}var s=t.return;try{dO(t)}catch(l){$r(t,s,l)}break;case 5:var a=t.return;try{dO(t)}catch(l){$r(t,a,l)}}}catch(l){$r(t,t.return,l)}if(t===e){Bt=null;break}var o=t.sibling;if(o!==null){o.return=t.return,Bt=o;break}Bt=t.return}}var uce=Math.ceil,G2=Fh.ReactCurrentDispatcher,eU=Fh.ReactCurrentOwner,ml=Fh.ReactCurrentBatchConfig,Yi=0,vs=null,Cn=null,zs=0,Ao=0,Bv=Sf(0),Yn=0,ww=null,wm=0,uC=0,tU=0,Sx=null,Za=null,iU=0,C0=1/0,Xu=null,H2=!1,mO=null,ef=null,oS=!1,Bd=null,j2=0,Mx=0,gO=null,WE=-1,XE=0;function Ia(){return Yi&6?dn():WE!==-1?WE:WE=dn()}function tf(e){return e.mode&1?Yi&2&&zs!==0?zs&-zs:qle.transition!==null?(XE===0&&(XE=iQ()),XE):(e=ur,e!==0||(e=window.event,e=e===void 0?16:cQ(e.type)),e):1}function tc(e,t,i,r){if(50<Mx)throw Mx=0,gO=null,Error(gt(185));vb(e,i,r),(!(Yi&2)||e!==vs)&&(e===vs&&(!(Yi&2)&&(uC|=i),Yn===4&&Td(e,zs)),lo(e,r),i===1&&Yi===0&&!(t.mode&1)&&(C0=dn()+500,aC&&Mf()))}function lo(e,t){var i=e.callbackNode;qoe(e,t);var r=T2(e,e===vs?zs:0);if(r===0)i!==null&&dV(i),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(i!=null&&dV(i),t===1)e.tag===0?Xle(n6.bind(null,e)):CQ(n6.bind(null,e)),Gle(function(){!(Yi&6)&&Mf()}),i=null;else{switch(rQ(r)){case 1:i=CF;break;case 4:i=eQ;break;case 16:i=A2;break;case 536870912:i=tQ;break;default:i=A2}i=AZ(i,xZ.bind(null,e))}e.callbackPriority=t,e.callbackNode=i}}function xZ(e,t){if(WE=-1,XE=0,Yi&6)throw Error(gt(327));var i=e.callbackNode;if(a0()&&e.callbackNode!==i)return null;var r=T2(e,e===vs?zs:0);if(r===0)return null;if(r&30||r&e.expiredLanes||t)t=W2(e,r);else{t=r;var n=Yi;Yi|=2;var s=bZ();(vs!==e||zs!==t)&&(Xu=null,C0=dn()+500,tm(e,t));do try{fce();break}catch(o){wZ(e,o)}while(!0);VF(),G2.current=s,Yi=n,Cn!==null?t=0:(vs=null,zs=0,t=Yn)}if(t!==0){if(t===2&&(n=HL(e),n!==0&&(r=n,t=vO(e,n))),t===1)throw i=ww,tm(e,0),Td(e,r),lo(e,dn()),i;if(t===6)Td(e,r);else{if(n=e.current.alternate,!(r&30)&&!hce(n)&&(t=W2(e,r),t===2&&(s=HL(e),s!==0&&(r=s,t=vO(e,s))),t===1))throw i=ww,tm(e,0),Td(e,r),lo(e,dn()),i;switch(e.finishedWork=n,e.finishedLanes=r,t){case 0:case 1:throw Error(gt(345));case 2:wp(e,Za,Xu);break;case 3:if(Td(e,r),(r&130023424)===r&&(t=iU+500-dn(),10<t)){if(T2(e,0)!==0)break;if(n=e.suspendedLanes,(n&r)!==r){Ia(),e.pingedLanes|=e.suspendedLanes&n;break}e.timeoutHandle=KL(wp.bind(null,e,Za,Xu),t);break}wp(e,Za,Xu);break;case 4:if(Td(e,r),(r&4194240)===r)break;for(t=e.eventTimes,n=-1;0<r;){var a=31-ec(r);s=1<<a,a=t[a],a>n&&(n=a),r&=~s}if(r=n,r=dn()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*uce(r/1960))-r,10<r){e.timeoutHandle=KL(wp.bind(null,e,Za,Xu),r);break}wp(e,Za,Xu);break;case 5:wp(e,Za,Xu);break;default:throw Error(gt(329))}}}return lo(e,dn()),e.callbackNode===i?xZ.bind(null,e):null}function vO(e,t){var i=Sx;return e.current.memoizedState.isDehydrated&&(tm(e,t).flags|=256),e=W2(e,t),e!==2&&(t=Za,Za=i,t!==null&&yO(t)),e}function yO(e){Za===null?Za=e:Za.push.apply(Za,e)}function hce(e){for(var t=e;;){if(t.flags&16384){var i=t.updateQueue;if(i!==null&&(i=i.stores,i!==null))for(var r=0;r<i.length;r++){var n=i[r],s=n.getSnapshot;n=n.value;try{if(!rc(s(),n))return!1}catch{return!1}}}if(i=t.child,t.subtreeFlags&16384&&i!==null)i.return=t,t=i;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function Td(e,t){for(t&=~tU,t&=~uC,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var i=31-ec(t),r=1<<i;e[i]=-1,t&=~r}}function n6(e){if(Yi&6)throw Error(gt(327));a0();var t=T2(e,0);if(!(t&1))return lo(e,dn()),null;var i=W2(e,t);if(e.tag!==0&&i===2){var r=HL(e);r!==0&&(t=r,i=vO(e,r))}if(i===1)throw i=ww,tm(e,0),Td(e,t),lo(e,dn()),i;if(i===6)throw Error(gt(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,wp(e,Za,Xu),lo(e,dn()),null}function rU(e,t){var i=Yi;Yi|=1;try{return e(t)}finally{Yi=i,Yi===0&&(C0=dn()+500,aC&&Mf())}}function bm(e){Bd!==null&&Bd.tag===0&&!(Yi&6)&&a0();var t=Yi;Yi|=1;var i=ml.transition,r=ur;try{if(ml.transition=null,ur=1,e)return e()}finally{ur=r,ml.transition=i,Yi=t,!(Yi&6)&&Mf()}}function nU(){Ao=Bv.current,Cr(Bv)}function tm(e,t){e.finishedWork=null,e.finishedLanes=0;var i=e.timeoutHandle;if(i!==-1&&(e.timeoutHandle=-1,Vle(i)),Cn!==null)for(i=Cn.return;i!==null;){var r=i;switch(UF(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&I2();break;case 3:A0(),Cr(ao),Cr(la),qF();break;case 5:XF(r);break;case 4:A0();break;case 13:Cr(Ur);break;case 19:Cr(Ur);break;case 10:GF(r.type._context);break;case 22:case 23:nU()}i=i.return}if(vs=e,Cn=e=rf(e.current,null),zs=Ao=t,Yn=0,ww=null,tU=uC=wm=0,Za=Sx=null,Vp!==null){for(t=0;t<Vp.length;t++)if(i=Vp[t],r=i.interleaved,r!==null){i.interleaved=null;var n=r.next,s=i.pending;if(s!==null){var a=s.next;s.next=n,r.next=a}i.pending=r}Vp=null}return e}function wZ(e,t){do{var i=Cn;try{if(VF(),GE.current=V2,k2){for(var r=Hr.memoizedState;r!==null;){var n=r.queue;n!==null&&(n.pending=null),r=r.next}k2=!1}if(xm=0,us=Hn=Hr=null,bx=!1,vw=0,eU.current=null,i===null||i.return===null){Yn=1,ww=t,Cn=null;break}e:{var s=e,a=i.return,o=i,l=t;if(t=zs,o.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var c=l,u=o,h=u.tag;if(!(u.mode&1)&&(h===0||h===11||h===15)){var d=u.alternate;d?(u.updateQueue=d.updateQueue,u.memoizedState=d.memoizedState,u.lanes=d.lanes):(u.updateQueue=null,u.memoizedState=null)}var f=WV(a);if(f!==null){f.flags&=-257,XV(f,a,o,s,t),f.mode&1&&jV(s,c,t),t=f,l=c;var p=t.updateQueue;if(p===null){var v=new Set;v.add(l),t.updateQueue=v}else p.add(l);break e}else{if(!(t&1)){jV(s,c,t),sU();break e}l=Error(gt(426))}}else if(Ir&&o.mode&1){var m=WV(a);if(m!==null){!(m.flags&65536)&&(m.flags|=256),XV(m,a,o,s,t),NF(T0(l,o));break e}}s=l=T0(l,o),Yn!==4&&(Yn=2),Sx===null?Sx=[s]:Sx.push(s),s=a;do{switch(s.tag){case 3:s.flags|=65536,t&=-t,s.lanes|=t;var g=rZ(s,l,t);UV(s,g);break e;case 1:o=l;var y=s.type,x=s.stateNode;if(!(s.flags&128)&&(typeof y.getDerivedStateFromError=="function"||x!==null&&typeof x.componentDidCatch=="function"&&(ef===null||!ef.has(x)))){s.flags|=65536,t&=-t,s.lanes|=t;var _=nZ(s,o,t);UV(s,_);break e}}s=s.return}while(s!==null)}SZ(i)}catch(M){t=M,Cn===i&&i!==null&&(Cn=i=i.return);continue}break}while(!0)}function bZ(){var e=G2.current;return G2.current=V2,e===null?V2:e}function sU(){(Yn===0||Yn===3||Yn===2)&&(Yn=4),vs===null||!(wm&268435455)&&!(uC&268435455)||Td(vs,zs)}function W2(e,t){var i=Yi;Yi|=2;var r=bZ();(vs!==e||zs!==t)&&(Xu=null,tm(e,t));do try{dce();break}catch(n){wZ(e,n)}while(!0);if(VF(),Yi=i,G2.current=r,Cn!==null)throw Error(gt(261));return vs=null,zs=0,Yn}function dce(){for(;Cn!==null;)_Z(Cn)}function fce(){for(;Cn!==null&&!Uoe();)_Z(Cn)}function _Z(e){var t=EZ(e.alternate,e,Ao);e.memoizedProps=e.pendingProps,t===null?SZ(e):Cn=t,eU.current=null}function SZ(e){var t=e;do{var i=t.alternate;if(e=t.return,t.flags&32768){if(i=ace(i,t),i!==null){i.flags&=32767,Cn=i;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{Yn=6,Cn=null;return}}else if(i=sce(i,t,Ao),i!==null){Cn=i;return}if(t=t.sibling,t!==null){Cn=t;return}Cn=t=e}while(t!==null);Yn===0&&(Yn=5)}function wp(e,t,i){var r=ur,n=ml.transition;try{ml.transition=null,ur=1,pce(e,t,i,r)}finally{ml.transition=n,ur=r}return null}function pce(e,t,i,r){do a0();while(Bd!==null);if(Yi&6)throw Error(gt(327));i=e.finishedWork;var n=e.finishedLanes;if(i===null)return null;if(e.finishedWork=null,e.finishedLanes=0,i===e.current)throw Error(gt(177));e.callbackNode=null,e.callbackPriority=0;var s=i.lanes|i.childLanes;if(Yoe(e,s),e===vs&&(Cn=vs=null,zs=0),!(i.subtreeFlags&2064)&&!(i.flags&2064)||oS||(oS=!0,AZ(A2,function(){return a0(),null})),s=(i.flags&15990)!==0,i.subtreeFlags&15990||s){s=ml.transition,ml.transition=null;var a=ur;ur=1;var o=Yi;Yi|=4,eU.current=null,lce(e,i),vZ(i,e),Ole(QL),C2=!!YL,QL=YL=null,e.current=i,cce(i),Noe(),Yi=o,ur=a,ml.transition=s}else e.current=i;if(oS&&(oS=!1,Bd=e,j2=n),s=e.pendingLanes,s===0&&(ef=null),Goe(i.stateNode),lo(e,dn()),t!==null)for(r=e.onRecoverableError,i=0;i<t.length;i++)n=t[i],r(n.value,{componentStack:n.stack,digest:n.digest});if(H2)throw H2=!1,e=mO,mO=null,e;return j2&1&&e.tag!==0&&a0(),s=e.pendingLanes,s&1?e===gO?Mx++:(Mx=0,gO=e):Mx=0,Mf(),null}function a0(){if(Bd!==null){var e=rQ(j2),t=ml.transition,i=ur;try{if(ml.transition=null,ur=16>e?16:e,Bd===null)var r=!1;else{if(e=Bd,Bd=null,j2=0,Yi&6)throw Error(gt(331));var n=Yi;for(Yi|=4,Bt=e.current;Bt!==null;){var s=Bt,a=s.child;if(Bt.flags&16){var o=s.deletions;if(o!==null){for(var l=0;l<o.length;l++){var c=o[l];for(Bt=c;Bt!==null;){var u=Bt;switch(u.tag){case 0:case 11:case 15:_x(8,u,s)}var h=u.child;if(h!==null)h.return=u,Bt=h;else for(;Bt!==null;){u=Bt;var d=u.sibling,f=u.return;if(pZ(u),u===c){Bt=null;break}if(d!==null){d.return=f,Bt=d;break}Bt=f}}}var p=s.alternate;if(p!==null){var v=p.child;if(v!==null){p.child=null;do{var m=v.sibling;v.sibling=null,v=m}while(v!==null)}}Bt=s}}if(s.subtreeFlags&2064&&a!==null)a.return=s,Bt=a;else e:for(;Bt!==null;){if(s=Bt,s.flags&2048)switch(s.tag){case 0:case 11:case 15:_x(9,s,s.return)}var g=s.sibling;if(g!==null){g.return=s.return,Bt=g;break e}Bt=s.return}}var y=e.current;for(Bt=y;Bt!==null;){a=Bt;var x=a.child;if(a.subtreeFlags&2064&&x!==null)x.return=a,Bt=x;else e:for(a=y;Bt!==null;){if(o=Bt,o.flags&2048)try{switch(o.tag){case 0:case 11:case 15:cC(9,o)}}catch(M){$r(o,o.return,M)}if(o===a){Bt=null;break e}var _=o.sibling;if(_!==null){_.return=o.return,Bt=_;break e}Bt=o.return}}if(Yi=n,Mf(),Yc&&typeof Yc.onPostCommitFiberRoot=="function")try{Yc.onPostCommitFiberRoot(tC,e)}catch{}r=!0}return r}finally{ur=i,ml.transition=t}}return!1}function s6(e,t,i){t=T0(i,t),t=rZ(e,t,1),e=$d(e,t,1),t=Ia(),e!==null&&(vb(e,1,t),lo(e,t))}function $r(e,t,i){if(e.tag===3)s6(e,e,i);else for(;t!==null;){if(t.tag===3){s6(t,e,i);break}else if(t.tag===1){var r=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(ef===null||!ef.has(r))){e=T0(i,e),e=nZ(t,e,1),t=$d(t,e,1),e=Ia(),t!==null&&(vb(t,1,e),lo(t,e));break}}t=t.return}}function mce(e,t,i){var r=e.pingCache;r!==null&&r.delete(t),t=Ia(),e.pingedLanes|=e.suspendedLanes&i,vs===e&&(zs&i)===i&&(Yn===4||Yn===3&&(zs&130023424)===zs&&500>dn()-iU?tm(e,0):tU|=i),lo(e,t)}function MZ(e,t){t===0&&(e.mode&1?(t=K_,K_<<=1,!(K_&130023424)&&(K_=4194304)):t=1);var i=Ia();e=Mh(e,t),e!==null&&(vb(e,t,i),lo(e,i))}function gce(e){var t=e.memoizedState,i=0;t!==null&&(i=t.retryLane),MZ(e,i)}function vce(e,t){var i=0;switch(e.tag){case 13:var r=e.stateNode,n=e.memoizedState;n!==null&&(i=n.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(gt(314))}r!==null&&r.delete(t),MZ(e,i)}var EZ;EZ=function(e,t,i){if(e!==null)if(e.memoizedProps!==t.pendingProps||ao.current)io=!0;else{if(!(e.lanes&i)&&!(t.flags&128))return io=!1,nce(e,t,i);io=!!(e.flags&131072)}else io=!1,Ir&&t.flags&1048576&&PQ(t,z2,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;jE(e,t),e=t.pendingProps;var n=S0(t,la.current);s0(t,i),n=QF(null,t,r,e,n,i);var s=ZF();return t.flags|=1,typeof n=="object"&&n!==null&&typeof n.render=="function"&&n.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,oo(r)?(s=!0,L2(t)):s=!1,t.memoizedState=n.state!==null&&n.state!==void 0?n.state:null,jF(t),n.updater=lC,t.stateNode=n,n._reactInternals=t,nO(t,r,e,i),t=oO(null,t,r,!0,s,i)):(t.tag=0,Ir&&s&&FF(t),Ea(null,t,n,i),t=t.child),t;case 16:r=t.elementType;e:{switch(jE(e,t),e=t.pendingProps,n=r._init,r=n(r._payload),t.type=r,n=t.tag=xce(r),e=Vl(r,e),n){case 0:t=aO(null,t,r,e,i);break e;case 1:t=QV(null,t,r,e,i);break e;case 11:t=qV(null,t,r,e,i);break e;case 14:t=YV(null,t,r,Vl(r.type,e),i);break e}throw Error(gt(306,r,""))}return t;case 0:return r=t.type,n=t.pendingProps,n=t.elementType===r?n:Vl(r,n),aO(e,t,r,n,i);case 1:return r=t.type,n=t.pendingProps,n=t.elementType===r?n:Vl(r,n),QV(e,t,r,n,i);case 3:e:{if(lZ(t),e===null)throw Error(gt(387));r=t.pendingProps,s=t.memoizedState,n=s.element,zQ(e,t),U2(t,r,null,i);var a=t.memoizedState;if(r=a.element,s.isDehydrated)if(s={element:r,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},t.updateQueue.baseState=s,t.memoizedState=s,t.flags&256){n=T0(Error(gt(423)),t),t=ZV(e,t,r,i,n);break e}else if(r!==n){n=T0(Error(gt(424)),t),t=ZV(e,t,r,i,n);break e}else for(Po=Jd(t.stateNode.containerInfo.firstChild),Ro=t,Ir=!0,jl=null,i=LQ(t,null,r,i),t.child=i;i;)i.flags=i.flags&-3|4096,i=i.sibling;else{if(M0(),r===n){t=Eh(e,t,i);break e}Ea(e,t,r,i)}t=t.child}return t;case 5:return BQ(t),e===null&&tO(t),r=t.type,n=t.pendingProps,s=e!==null?e.memoizedProps:null,a=n.children,ZL(r,n)?a=null:s!==null&&ZL(r,s)&&(t.flags|=32),oZ(e,t),Ea(e,t,a,i),t.child;case 6:return e===null&&tO(t),null;case 13:return cZ(e,t,i);case 4:return WF(t,t.stateNode.containerInfo),r=t.pendingProps,e===null?t.child=E0(t,null,r,i):Ea(e,t,r,i),t.child;case 11:return r=t.type,n=t.pendingProps,n=t.elementType===r?n:Vl(r,n),qV(e,t,r,n,i);case 7:return Ea(e,t,t.pendingProps,i),t.child;case 8:return Ea(e,t,t.pendingProps.children,i),t.child;case 12:return Ea(e,t,t.pendingProps.children,i),t.child;case 10:e:{if(r=t.type._context,n=t.pendingProps,s=t.memoizedProps,a=n.value,_r(B2,r._currentValue),r._currentValue=a,s!==null)if(rc(s.value,a)){if(s.children===n.children&&!ao.current){t=Eh(e,t,i);break e}}else for(s=t.child,s!==null&&(s.return=t);s!==null;){var o=s.dependencies;if(o!==null){a=s.child;for(var l=o.firstContext;l!==null;){if(l.context===r){if(s.tag===1){l=mh(-1,i&-i),l.tag=2;var c=s.updateQueue;if(c!==null){c=c.shared;var u=c.pending;u===null?l.next=l:(l.next=u.next,u.next=l),c.pending=l}}s.lanes|=i,l=s.alternate,l!==null&&(l.lanes|=i),iO(s.return,i,t),o.lanes|=i;break}l=l.next}}else if(s.tag===10)a=s.type===t.type?null:s.child;else if(s.tag===18){if(a=s.return,a===null)throw Error(gt(341));a.lanes|=i,o=a.alternate,o!==null&&(o.lanes|=i),iO(a,i,t),a=s.sibling}else a=s.child;if(a!==null)a.return=s;else for(a=s;a!==null;){if(a===t){a=null;break}if(s=a.sibling,s!==null){s.return=a.return,a=s;break}a=a.return}s=a}Ea(e,t,n.children,i),t=t.child}return t;case 9:return n=t.type,r=t.pendingProps.children,s0(t,i),n=xl(n),r=r(n),t.flags|=1,Ea(e,t,r,i),t.child;case 14:return r=t.type,n=Vl(r,t.pendingProps),n=Vl(r.type,n),YV(e,t,r,n,i);case 15:return sZ(e,t,t.type,t.pendingProps,i);case 17:return r=t.type,n=t.pendingProps,n=t.elementType===r?n:Vl(r,n),jE(e,t),t.tag=1,oo(r)?(e=!0,L2(t)):e=!1,s0(t,i),iZ(t,r,n),nO(t,r,n,i),oO(null,t,r,!0,e,i);case 19:return uZ(e,t,i);case 22:return aZ(e,t,i)}throw Error(gt(156,t.tag))};function AZ(e,t){return $Y(e,t)}function yce(e,t,i,r){this.tag=e,this.key=i,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function dl(e,t,i,r){return new yce(e,t,i,r)}function aU(e){return e=e.prototype,!(!e||!e.isReactComponent)}function xce(e){if(typeof e=="function")return aU(e)?1:0;if(e!=null){if(e=e.$$typeof,e===EF)return 11;if(e===AF)return 14}return 2}function rf(e,t){var i=e.alternate;return i===null?(i=dl(e.tag,t,e.key,e.mode),i.elementType=e.elementType,i.type=e.type,i.stateNode=e.stateNode,i.alternate=e,e.alternate=i):(i.pendingProps=t,i.type=e.type,i.flags=0,i.subtreeFlags=0,i.deletions=null),i.flags=e.flags&14680064,i.childLanes=e.childLanes,i.lanes=e.lanes,i.child=e.child,i.memoizedProps=e.memoizedProps,i.memoizedState=e.memoizedState,i.updateQueue=e.updateQueue,t=e.dependencies,i.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},i.sibling=e.sibling,i.index=e.index,i.ref=e.ref,i}function qE(e,t,i,r,n,s){var a=2;if(r=e,typeof e=="function")aU(e)&&(a=1);else if(typeof e=="string")a=5;else e:switch(e){case Av:return im(i.children,n,s,t);case MF:a=8,n|=8;break;case CL:return e=dl(12,i,t,n|2),e.elementType=CL,e.lanes=s,e;case PL:return e=dl(13,i,t,n),e.elementType=PL,e.lanes=s,e;case DL:return e=dl(19,i,t,n),e.elementType=DL,e.lanes=s,e;case BY:return hC(i,n,s,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case OY:a=10;break e;case zY:a=9;break e;case EF:a=11;break e;case AF:a=14;break e;case _d:a=16,r=null;break e}throw Error(gt(130,e==null?e:typeof e,""))}return t=dl(a,i,t,n),t.elementType=e,t.type=r,t.lanes=s,t}function im(e,t,i,r){return e=dl(7,e,r,t),e.lanes=i,e}function hC(e,t,i,r){return e=dl(22,e,r,t),e.elementType=BY,e.lanes=i,e.stateNode={isHidden:!1},e}function J3(e,t,i){return e=dl(6,e,null,t),e.lanes=i,e}function $3(e,t,i){return t=dl(4,e.children!==null?e.children:[],e.key,t),t.lanes=i,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function wce(e,t,i,r,n){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=L3(0),this.expirationTimes=L3(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=L3(0),this.identifierPrefix=r,this.onRecoverableError=n,this.mutableSourceEagerHydrationData=null}function oU(e,t,i,r,n,s,a,o,l){return e=new wce(e,t,i,o,l),t===1?(t=1,s===!0&&(t|=8)):t=0,s=dl(3,null,null,t),e.current=s,s.stateNode=e,s.memoizedState={element:r,isDehydrated:i,cache:null,transitions:null,pendingSuspenseBoundaries:null},jF(s),e}function bce(e,t,i){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Ev,key:r==null?null:""+r,children:e,containerInfo:t,implementation:i}}function TZ(e){if(!e)return ff;e=e._reactInternals;e:{if(km(e)!==e||e.tag!==1)throw Error(gt(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(oo(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(gt(171))}if(e.tag===1){var i=e.type;if(oo(i))return TQ(e,i,t)}return t}function CZ(e,t,i,r,n,s,a,o,l){return e=oU(i,r,!0,e,n,s,a,o,l),e.context=TZ(null),i=e.current,r=Ia(),n=tf(i),s=mh(r,n),s.callback=t??null,$d(i,s,n),e.current.lanes=n,vb(e,n,r),lo(e,r),e}function dC(e,t,i,r){var n=t.current,s=Ia(),a=tf(n);return i=TZ(i),t.context===null?t.context=i:t.pendingContext=i,t=mh(s,a),t.payload={element:e},r=r===void 0?null:r,r!==null&&(t.callback=r),e=$d(n,t,a),e!==null&&(tc(e,n,a,s),VE(e,n,a)),a}function X2(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function a6(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var i=e.retryLane;e.retryLane=i!==0&&i<t?i:t}}function lU(e,t){a6(e,t),(e=e.alternate)&&a6(e,t)}function _ce(){return null}var PZ=typeof reportError=="function"?reportError:function(e){console.error(e)};function cU(e){this._internalRoot=e}fC.prototype.render=cU.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(gt(409));dC(e,t,null,null)};fC.prototype.unmount=cU.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;bm(function(){dC(null,e,null,null)}),t[Sh]=null}};function fC(e){this._internalRoot=e}fC.prototype.unstable_scheduleHydration=function(e){if(e){var t=aQ();e={blockedOn:null,target:e,priority:t};for(var i=0;i<Ad.length&&t!==0&&t<Ad[i].priority;i++);Ad.splice(i,0,e),i===0&&lQ(e)}};function uU(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function pC(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function o6(){}function Sce(e,t,i,r,n){if(n){if(typeof r=="function"){var s=r;r=function(){var c=X2(a);s.call(c)}}var a=CZ(t,r,e,0,null,!1,!1,"",o6);return e._reactRootContainer=a,e[Sh]=a.current,dw(e.nodeType===8?e.parentNode:e),bm(),a}for(;n=e.lastChild;)e.removeChild(n);if(typeof r=="function"){var o=r;r=function(){var c=X2(l);o.call(c)}}var l=oU(e,0,!1,null,null,!1,!1,"",o6);return e._reactRootContainer=l,e[Sh]=l.current,dw(e.nodeType===8?e.parentNode:e),bm(function(){dC(t,l,i,r)}),l}function mC(e,t,i,r,n){var s=i._reactRootContainer;if(s){var a=s;if(typeof n=="function"){var o=n;n=function(){var l=X2(a);o.call(l)}}dC(t,a,e,n)}else a=Sce(i,t,e,n,r);return X2(a)}nQ=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var i=J1(t.pendingLanes);i!==0&&(PF(t,i|1),lo(t,dn()),!(Yi&6)&&(C0=dn()+500,Mf()))}break;case 13:bm(function(){var r=Mh(e,1);if(r!==null){var n=Ia();tc(r,e,1,n)}}),lU(e,1)}};DF=function(e){if(e.tag===13){var t=Mh(e,134217728);if(t!==null){var i=Ia();tc(t,e,134217728,i)}lU(e,134217728)}};sQ=function(e){if(e.tag===13){var t=tf(e),i=Mh(e,t);if(i!==null){var r=Ia();tc(i,e,t,r)}lU(e,t)}};aQ=function(){return ur};oQ=function(e,t){var i=ur;try{return ur=e,t()}finally{ur=i}};kL=function(e,t,i){switch(t){case"input":if(LL(e,i),t=i.name,i.type==="radio"&&t!=null){for(i=e;i.parentNode;)i=i.parentNode;for(i=i.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<i.length;t++){var r=i[t];if(r!==e&&r.form===e.form){var n=sC(r);if(!n)throw Error(gt(90));UY(r),LL(r,n)}}}break;case"textarea":kY(e,i);break;case"select":t=i.value,t!=null&&t0(e,!!i.multiple,t,!1)}};qY=rU;YY=bm;var Mce={usingClientEntryPoint:!1,Events:[xb,Dv,sC,WY,XY,rU]},r1={findFiberByHostInstance:kp,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Ece={bundleType:r1.bundleType,version:r1.version,rendererPackageName:r1.rendererPackageName,rendererConfig:r1.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Fh.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=KY(e),e===null?null:e.stateNode},findFiberByHostInstance:r1.findFiberByHostInstance||_ce,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var lS=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!lS.isDisabled&&lS.supportsFiber)try{tC=lS.inject(Ece),Yc=lS}catch{}}Uo.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Mce;Uo.createPortal=function(e,t){var i=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!uU(t))throw Error(gt(200));return bce(e,t,null,i)};Uo.createRoot=function(e,t){if(!uU(e))throw Error(gt(299));var i=!1,r="",n=PZ;return t!=null&&(t.unstable_strictMode===!0&&(i=!0),t.identifierPrefix!==void 0&&(r=t.identifierPrefix),t.onRecoverableError!==void 0&&(n=t.onRecoverableError)),t=oU(e,1,!1,null,null,i,!1,r,n),e[Sh]=t.current,dw(e.nodeType===8?e.parentNode:e),new cU(t)};Uo.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(gt(188)):(e=Object.keys(e).join(","),Error(gt(268,e)));return e=KY(t),e=e===null?null:e.stateNode,e};Uo.flushSync=function(e){return bm(e)};Uo.hydrate=function(e,t,i){if(!pC(t))throw Error(gt(200));return mC(null,e,t,!0,i)};Uo.hydrateRoot=function(e,t,i){if(!uU(e))throw Error(gt(405));var r=i!=null&&i.hydratedSources||null,n=!1,s="",a=PZ;if(i!=null&&(i.unstable_strictMode===!0&&(n=!0),i.identifierPrefix!==void 0&&(s=i.identifierPrefix),i.onRecoverableError!==void 0&&(a=i.onRecoverableError)),t=CZ(t,null,e,1,i??null,n,!1,s,a),e[Sh]=t.current,dw(e),r)for(e=0;e<r.length;e++)i=r[e],n=i._getVersion,n=n(i._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[i,n]:t.mutableSourceEagerHydrationData.push(i,n);return new fC(t)};Uo.render=function(e,t,i){if(!pC(t))throw Error(gt(200));return mC(null,e,t,!1,i)};Uo.unmountComponentAtNode=function(e){if(!pC(e))throw Error(gt(40));return e._reactRootContainer?(bm(function(){mC(null,null,e,!1,function(){e._reactRootContainer=null,e[Sh]=null})}),!0):!1};Uo.unstable_batchedUpdates=rU;Uo.unstable_renderSubtreeIntoContainer=function(e,t,i,r){if(!pC(i))throw Error(gt(200));if(e==null||e._reactInternals===void 0)throw Error(gt(38));return mC(e,t,i,!1,r)};Uo.version="18.3.1-next-f1338f8080-20240426";function DZ(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(DZ)}catch(e){console.error(e)}}DZ(),DY.exports=Uo;var Ace=DY.exports,RZ,l6=Ace;RZ=l6.createRoot,l6.hydrateRoot;/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function bw(){return bw=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},bw.apply(this,arguments)}var Fd;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})(Fd||(Fd={}));const c6="popstate";function Tce(e){e===void 0&&(e={});function t(r,n){let{pathname:s,search:a,hash:o}=r.location;return xO("",{pathname:s,search:a,hash:o},n.state&&n.state.usr||null,n.state&&n.state.key||"default")}function i(r,n){return typeof n=="string"?n:q2(n)}return Pce(t,i,null,e)}function In(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function IZ(e,t){if(!e){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function Cce(){return Math.random().toString(36).substr(2,8)}function u6(e,t){return{usr:e.state,key:e.key,idx:t}}function xO(e,t,i,r){return i===void 0&&(i=null),bw({pathname:typeof e=="string"?e:e.pathname,search:"",hash:""},typeof t=="string"?ty(t):t,{state:i,key:t&&t.key||r||Cce()})}function q2(e){let{pathname:t="/",search:i="",hash:r=""}=e;return i&&i!=="?"&&(t+=i.charAt(0)==="?"?i:"?"+i),r&&r!=="#"&&(t+=r.charAt(0)==="#"?r:"#"+r),t}function ty(e){let t={};if(e){let i=e.indexOf("#");i>=0&&(t.hash=e.substr(i),e=e.substr(0,i));let r=e.indexOf("?");r>=0&&(t.search=e.substr(r),e=e.substr(0,r)),e&&(t.pathname=e)}return t}function Pce(e,t,i,r){r===void 0&&(r={});let{window:n=document.defaultView,v5Compat:s=!1}=r,a=n.history,o=Fd.Pop,l=null,c=u();c==null&&(c=0,a.replaceState(bw({},a.state,{idx:c}),""));function u(){return(a.state||{idx:null}).idx}function h(){o=Fd.Pop;let m=u(),g=m==null?null:m-c;c=m,l&&l({action:o,location:v.location,delta:g})}function d(m,g){o=Fd.Push;let y=xO(v.location,m,g);c=u()+1;let x=u6(y,c),_=v.createHref(y);try{a.pushState(x,"",_)}catch(M){if(M instanceof DOMException&&M.name==="DataCloneError")throw M;n.location.assign(_)}s&&l&&l({action:o,location:v.location,delta:1})}function f(m,g){o=Fd.Replace;let y=xO(v.location,m,g);c=u();let x=u6(y,c),_=v.createHref(y);a.replaceState(x,"",_),s&&l&&l({action:o,location:v.location,delta:0})}function p(m){let g=n.location.origin!=="null"?n.location.origin:n.location.href,y=typeof m=="string"?m:q2(m);return y=y.replace(/ $/,"%20"),In(g,"No window.location.(origin|href) available to create URL for href: "+y),new URL(y,g)}let v={get action(){return o},get location(){return e(n,a)},listen(m){if(l)throw new Error("A history only accepts one active listener");return n.addEventListener(c6,h),l=m,()=>{n.removeEventListener(c6,h),l=null}},createHref(m){return t(n,m)},createURL:p,encodeLocation(m){let g=p(m);return{pathname:g.pathname,search:g.search,hash:g.hash}},push:d,replace:f,go(m){return a.go(m)}};return v}var h6;(function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"})(h6||(h6={}));function Dce(e,t,i){return i===void 0&&(i="/"),Rce(e,t,i,!1)}function Rce(e,t,i,r){let n=typeof t=="string"?ty(t):t,s=hU(n.pathname||"/",i);if(s==null)return null;let a=LZ(e);Ice(a);let o=null;for(let l=0;o==null&&l<a.length;++l){let c=Hce(s);o=Vce(a[l],c,r)}return o}function LZ(e,t,i,r){t===void 0&&(t=[]),i===void 0&&(i=[]),r===void 0&&(r="");let n=(s,a,o)=>{let l={relativePath:o===void 0?s.path||"":o,caseSensitive:s.caseSensitive===!0,childrenIndex:a,route:s};l.relativePath.startsWith("/")&&(In(l.relativePath.startsWith(r),'Absolute route path "'+l.relativePath+'" nested under path '+('"'+r+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),l.relativePath=l.relativePath.slice(r.length));let c=nf([r,l.relativePath]),u=i.concat(l);s.children&&s.children.length>0&&(In(s.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+c+'".')),LZ(s.children,t,u,c)),!(s.path==null&&!s.index)&&t.push({path:c,score:Nce(c,s.index),routesMeta:u})};return e.forEach((s,a)=>{var o;if(s.path===""||!((o=s.path)!=null&&o.includes("?")))n(s,a);else for(let l of OZ(s.path))n(s,a,l)}),t}function OZ(e){let t=e.split("/");if(t.length===0)return[];let[i,...r]=t,n=i.endsWith("?"),s=i.replace(/\?$/,"");if(r.length===0)return n?[s,""]:[s];let a=OZ(r.join("/")),o=[];return o.push(...a.map(l=>l===""?s:[s,l].join("/"))),n&&o.push(...a),o.map(l=>e.startsWith("/")&&l===""?"/":l)}function Ice(e){e.sort((t,i)=>t.score!==i.score?i.score-t.score:kce(t.routesMeta.map(r=>r.childrenIndex),i.routesMeta.map(r=>r.childrenIndex)))}const Lce=/^:[\w-]+$/,Oce=3,zce=2,Bce=1,Fce=10,Uce=-2,d6=e=>e==="*";function Nce(e,t){let i=e.split("/"),r=i.length;return i.some(d6)&&(r+=Uce),t&&(r+=zce),i.filter(n=>!d6(n)).reduce((n,s)=>n+(Lce.test(s)?Oce:s===""?Bce:Fce),r)}function kce(e,t){return e.length===t.length&&e.slice(0,-1).every((r,n)=>r===t[n])?e[e.length-1]-t[t.length-1]:0}function Vce(e,t,i){let{routesMeta:r}=e,n={},s="/",a=[];for(let o=0;o<r.length;++o){let l=r[o],c=o===r.length-1,u=s==="/"?t:t.slice(s.length)||"/",h=f6({path:l.relativePath,caseSensitive:l.caseSensitive,end:c},u),d=l.route;if(!h&&c&&i&&!r[r.length-1].route.index&&(h=f6({path:l.relativePath,caseSensitive:l.caseSensitive,end:!1},u)),!h)return null;Object.assign(n,h.params),a.push({params:n,pathname:nf([s,h.pathname]),pathnameBase:qce(nf([s,h.pathnameBase])),route:d}),h.pathnameBase!=="/"&&(s=nf([s,h.pathnameBase]))}return a}function f6(e,t){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[i,r]=Gce(e.path,e.caseSensitive,e.end),n=t.match(i);if(!n)return null;let s=n[0],a=s.replace(/(.)\/+$/,"$1"),o=n.slice(1);return{params:r.reduce((c,u,h)=>{let{paramName:d,isOptional:f}=u;if(d==="*"){let v=o[h]||"";a=s.slice(0,s.length-v.length).replace(/(.)\/+$/,"$1")}const p=o[h];return f&&!p?c[d]=void 0:c[d]=(p||"").replace(/%2F/g,"/"),c},{}),pathname:s,pathnameBase:a,pattern:e}}function Gce(e,t,i){t===void 0&&(t=!1),i===void 0&&(i=!0),IZ(e==="*"||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were '+('"'+e.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+e.replace(/\*$/,"/*")+'".'));let r=[],n="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(a,o,l)=>(r.push({paramName:o,isOptional:l!=null}),l?"/?([^\\/]+)?":"/([^\\/]+)"));return e.endsWith("*")?(r.push({paramName:"*"}),n+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):i?n+="\\/*$":e!==""&&e!=="/"&&(n+="(?:(?=\\/|$))"),[new RegExp(n,t?void 0:"i"),r]}function Hce(e){try{return e.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return IZ(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+t+").")),e}}function hU(e,t){if(t==="/")return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let i=t.endsWith("/")?t.length-1:t.length,r=e.charAt(i);return r&&r!=="/"?null:e.slice(i)||"/"}function jce(e,t){t===void 0&&(t="/");let{pathname:i,search:r="",hash:n=""}=typeof e=="string"?ty(e):e;return{pathname:i?i.startsWith("/")?i:Wce(i,t):t,search:Yce(r),hash:Qce(n)}}function Wce(e,t){let i=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(n=>{n===".."?i.length>1&&i.pop():n!=="."&&i.push(n)}),i.length>1?i.join("/"):"/"}function eD(e,t,i,r){return"Cannot include a '"+e+"' character in a manually specified "+("`to."+t+"` field ["+JSON.stringify(r)+"].  Please separate it out to the ")+("`to."+i+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function Xce(e){return e.filter((t,i)=>i===0||t.route.path&&t.route.path.length>0)}function zZ(e,t){let i=Xce(e);return t?i.map((r,n)=>n===i.length-1?r.pathname:r.pathnameBase):i.map(r=>r.pathnameBase)}function BZ(e,t,i,r){r===void 0&&(r=!1);let n;typeof e=="string"?n=ty(e):(n=bw({},e),In(!n.pathname||!n.pathname.includes("?"),eD("?","pathname","search",n)),In(!n.pathname||!n.pathname.includes("#"),eD("#","pathname","hash",n)),In(!n.search||!n.search.includes("#"),eD("#","search","hash",n)));let s=e===""||n.pathname==="",a=s?"/":n.pathname,o;if(a==null)o=i;else{let h=t.length-1;if(!r&&a.startsWith("..")){let d=a.split("/");for(;d[0]==="..";)d.shift(),h-=1;n.pathname=d.join("/")}o=h>=0?t[h]:"/"}let l=jce(n,o),c=a&&a!=="/"&&a.endsWith("/"),u=(s||a===".")&&i.endsWith("/");return!l.pathname.endsWith("/")&&(c||u)&&(l.pathname+="/"),l}const nf=e=>e.join("/").replace(/\/\/+/g,"/"),qce=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),Yce=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,Qce=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e;function Zce(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}const FZ=["post","put","patch","delete"];new Set(FZ);const Kce=["get",...FZ];new Set(Kce);/**
 * React Router v6.30.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function _w(){return _w=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},_w.apply(this,arguments)}const dU=_e.createContext(null),Jce=_e.createContext(null),Vm=_e.createContext(null),gC=_e.createContext(null),Gm=_e.createContext({outlet:null,matches:[],isDataRoute:!1}),UZ=_e.createContext(null);function $ce(e,t){let{relative:i}=t===void 0?{}:t;bb()||In(!1);let{basename:r,navigator:n}=_e.useContext(Vm),{hash:s,pathname:a,search:o}=kZ(e,{relative:i}),l=a;return r!=="/"&&(l=a==="/"?r:nf([r,a])),n.createHref({pathname:l,search:o,hash:s})}function bb(){return _e.useContext(gC)!=null}function _b(){return bb()||In(!1),_e.useContext(gC).location}function NZ(e){_e.useContext(Vm).static||_e.useLayoutEffect(e)}function eue(){let{isDataRoute:e}=_e.useContext(Gm);return e?fue():tue()}function tue(){bb()||In(!1);let e=_e.useContext(dU),{basename:t,future:i,navigator:r}=_e.useContext(Vm),{matches:n}=_e.useContext(Gm),{pathname:s}=_b(),a=JSON.stringify(zZ(n,i.v7_relativeSplatPath)),o=_e.useRef(!1);return NZ(()=>{o.current=!0}),_e.useCallback(function(c,u){if(u===void 0&&(u={}),!o.current)return;if(typeof c=="number"){r.go(c);return}let h=BZ(c,JSON.parse(a),s,u.relative==="path");e==null&&t!=="/"&&(h.pathname=h.pathname==="/"?t:nf([t,h.pathname])),(u.replace?r.replace:r.push)(h,u.state,u)},[t,r,a,s,e])}function kZ(e,t){let{relative:i}=t===void 0?{}:t,{future:r}=_e.useContext(Vm),{matches:n}=_e.useContext(Gm),{pathname:s}=_b(),a=JSON.stringify(zZ(n,r.v7_relativeSplatPath));return _e.useMemo(()=>BZ(e,JSON.parse(a),s,i==="path"),[e,a,s,i])}function iue(e,t){return rue(e,t)}function rue(e,t,i,r){bb()||In(!1);let{navigator:n,static:s}=_e.useContext(Vm),{matches:a}=_e.useContext(Gm),o=a[a.length-1],l=o?o.params:{};o&&o.pathname;let c=o?o.pathnameBase:"/";o&&o.route;let u=_b(),h;if(t){var d;let g=typeof t=="string"?ty(t):t;c==="/"||(d=g.pathname)!=null&&d.startsWith(c)||In(!1),h=g}else h=u;let f=h.pathname||"/",p=f;if(c!=="/"){let g=c.replace(/^\//,"").split("/");p="/"+f.replace(/^\//,"").split("/").slice(g.length).join("/")}let v=!s&&i&&i.matches&&i.matches.length>0?i.matches:Dce(e,{pathname:p}),m=lue(v&&v.map(g=>Object.assign({},g,{params:Object.assign({},l,g.params),pathname:nf([c,n.encodeLocation?n.encodeLocation(g.pathname).pathname:g.pathname]),pathnameBase:g.pathnameBase==="/"?c:nf([c,n.encodeLocation?n.encodeLocation(g.pathnameBase).pathname:g.pathnameBase])})),a,i,r);return t&&m?_e.createElement(gC.Provider,{value:{location:_w({pathname:"/",search:"",hash:"",state:null,key:"default"},h),navigationType:Fd.Pop}},m):m}function nue(){let e=due(),t=Zce(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),i=e instanceof Error?e.stack:null,n={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return _e.createElement(_e.Fragment,null,_e.createElement("h2",null,"Unexpected Application Error!"),_e.createElement("h3",{style:{fontStyle:"italic"}},t),i?_e.createElement("pre",{style:n},i):null,null)}const sue=_e.createElement(nue,null);class aue extends _e.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,i){return i.location!==t.location||i.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:i.error,location:i.location,revalidation:t.revalidation||i.revalidation}}componentDidCatch(t,i){console.error("React Router caught the following error during render",t,i)}render(){return this.state.error!==void 0?_e.createElement(Gm.Provider,{value:this.props.routeContext},_e.createElement(UZ.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function oue(e){let{routeContext:t,match:i,children:r}=e,n=_e.useContext(dU);return n&&n.static&&n.staticContext&&(i.route.errorElement||i.route.ErrorBoundary)&&(n.staticContext._deepestRenderedBoundaryId=i.route.id),_e.createElement(Gm.Provider,{value:t},r)}function lue(e,t,i,r){var n;if(t===void 0&&(t=[]),i===void 0&&(i=null),r===void 0&&(r=null),e==null){var s;if(!i)return null;if(i.errors)e=i.matches;else if((s=r)!=null&&s.v7_partialHydration&&t.length===0&&!i.initialized&&i.matches.length>0)e=i.matches;else return null}let a=e,o=(n=i)==null?void 0:n.errors;if(o!=null){let u=a.findIndex(h=>h.route.id&&(o==null?void 0:o[h.route.id])!==void 0);u>=0||In(!1),a=a.slice(0,Math.min(a.length,u+1))}let l=!1,c=-1;if(i&&r&&r.v7_partialHydration)for(let u=0;u<a.length;u++){let h=a[u];if((h.route.HydrateFallback||h.route.hydrateFallbackElement)&&(c=u),h.route.id){let{loaderData:d,errors:f}=i,p=h.route.loader&&d[h.route.id]===void 0&&(!f||f[h.route.id]===void 0);if(h.route.lazy||p){l=!0,c>=0?a=a.slice(0,c+1):a=[a[0]];break}}}return a.reduceRight((u,h,d)=>{let f,p=!1,v=null,m=null;i&&(f=o&&h.route.id?o[h.route.id]:void 0,v=h.route.errorElement||sue,l&&(c<0&&d===0?(p=!0,m=null):c===d&&(p=!0,m=h.route.hydrateFallbackElement||null)));let g=t.concat(a.slice(0,d+1)),y=()=>{let x;return f?x=v:p?x=m:h.route.Component?x=_e.createElement(h.route.Component,null):h.route.element?x=h.route.element:x=u,_e.createElement(oue,{match:h,routeContext:{outlet:u,matches:g,isDataRoute:i!=null},children:x})};return i&&(h.route.ErrorBoundary||h.route.errorElement||d===0)?_e.createElement(aue,{location:i.location,revalidation:i.revalidation,component:v,error:f,children:y(),routeContext:{outlet:null,matches:g,isDataRoute:!0}}):y()},null)}var VZ=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(VZ||{}),Y2=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(Y2||{});function cue(e){let t=_e.useContext(dU);return t||In(!1),t}function uue(e){let t=_e.useContext(Jce);return t||In(!1),t}function hue(e){let t=_e.useContext(Gm);return t||In(!1),t}function GZ(e){let t=hue(),i=t.matches[t.matches.length-1];return i.route.id||In(!1),i.route.id}function due(){var e;let t=_e.useContext(UZ),i=uue(Y2.UseRouteError),r=GZ(Y2.UseRouteError);return t!==void 0?t:(e=i.errors)==null?void 0:e[r]}function fue(){let{router:e}=cue(VZ.UseNavigateStable),t=GZ(Y2.UseNavigateStable),i=_e.useRef(!1);return NZ(()=>{i.current=!0}),_e.useCallback(function(n,s){s===void 0&&(s={}),i.current&&(typeof n=="number"?e.navigate(n):e.navigate(n,_w({fromRouteId:t},s)))},[e,t])}function pue(e,t){e==null||e.v7_startTransition,e==null||e.v7_relativeSplatPath}function bp(e){In(!1)}function mue(e){let{basename:t="/",children:i=null,location:r,navigationType:n=Fd.Pop,navigator:s,static:a=!1,future:o}=e;bb()&&In(!1);let l=t.replace(/^\/*/,"/"),c=_e.useMemo(()=>({basename:l,navigator:s,static:a,future:_w({v7_relativeSplatPath:!1},o)}),[l,o,s,a]);typeof r=="string"&&(r=ty(r));let{pathname:u="/",search:h="",hash:d="",state:f=null,key:p="default"}=r,v=_e.useMemo(()=>{let m=hU(u,l);return m==null?null:{location:{pathname:m,search:h,hash:d,state:f,key:p},navigationType:n}},[l,u,h,d,f,p,n]);return v==null?null:_e.createElement(Vm.Provider,{value:c},_e.createElement(gC.Provider,{children:i,value:v}))}function gue(e){let{children:t,location:i}=e;return iue(wO(t),i)}new Promise(()=>{});function wO(e,t){t===void 0&&(t=[]);let i=[];return _e.Children.forEach(e,(r,n)=>{if(!_e.isValidElement(r))return;let s=[...t,n];if(r.type===_e.Fragment){i.push.apply(i,wO(r.props.children,s));return}r.type!==bp&&In(!1),!r.props.index||!r.props.children||In(!1);let a={id:r.props.id||s.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(a.children=wO(r.props.children,s)),i.push(a)}),i}/**
 * React Router DOM v6.30.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function bO(){return bO=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},bO.apply(this,arguments)}function vue(e,t){if(e==null)return{};var i={},r=Object.keys(e),n,s;for(s=0;s<r.length;s++)n=r[s],!(t.indexOf(n)>=0)&&(i[n]=e[n]);return i}function yue(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function xue(e,t){return e.button===0&&(!t||t==="_self")&&!yue(e)}const wue=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],bue="6";try{window.__reactRouterVersion=bue}catch{}const _ue="startTransition",p6=moe[_ue];function Sue(e){let{basename:t,children:i,future:r,window:n}=e,s=_e.useRef();s.current==null&&(s.current=Tce({window:n,v5Compat:!0}));let a=s.current,[o,l]=_e.useState({action:a.action,location:a.location}),{v7_startTransition:c}=r||{},u=_e.useCallback(h=>{c&&p6?p6(()=>l(h)):l(h)},[l,c]);return _e.useLayoutEffect(()=>a.listen(u),[a,u]),_e.useEffect(()=>pue(r),[r]),_e.createElement(mue,{basename:t,children:i,location:o.location,navigationType:o.action,navigator:a,future:r})}const Mue=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",Eue=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,oh=_e.forwardRef(function(t,i){let{onClick:r,relative:n,reloadDocument:s,replace:a,state:o,target:l,to:c,preventScrollReset:u,viewTransition:h}=t,d=vue(t,wue),{basename:f}=_e.useContext(Vm),p,v=!1;if(typeof c=="string"&&Eue.test(c)&&(p=c,Mue))try{let x=new URL(window.location.href),_=c.startsWith("//")?new URL(x.protocol+c):new URL(c),M=hU(_.pathname,f);_.origin===x.origin&&M!=null?c=M+_.search+_.hash:v=!0}catch{}let m=$ce(c,{relative:n}),g=Aue(c,{replace:a,state:o,target:l,preventScrollReset:u,relative:n,viewTransition:h});function y(x){r&&r(x),x.defaultPrevented||g(x)}return _e.createElement("a",bO({},d,{href:p||m,onClick:v||s?r:y,ref:i,target:l}))});var m6;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(m6||(m6={}));var g6;(function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"})(g6||(g6={}));function Aue(e,t){let{target:i,replace:r,state:n,preventScrollReset:s,relative:a,viewTransition:o}=t===void 0?{}:t,l=eue(),c=_b(),u=kZ(e,{relative:a});return _e.useCallback(h=>{if(xue(h,i)){h.preventDefault();let d=r!==void 0?r:q2(c)===q2(u);l(e,{replace:d,state:n,preventScrollReset:s,relative:a,viewTransition:o})}},[c,l,u,r,n,i,e,s,a,o])}const fU=_e.createContext({});function pU(e){const t=_e.useRef(null);return t.current===null&&(t.current=e()),t.current}const vC=_e.createContext(null),mU=_e.createContext({transformPagePoint:e=>e,isStatic:!1,reducedMotion:"never"});class Tue extends _e.Component{getSnapshotBeforeUpdate(t){const i=this.props.childRef.current;if(i&&t.isPresent&&!this.props.isPresent){const r=this.props.sizeRef.current;r.height=i.offsetHeight||0,r.width=i.offsetWidth||0,r.top=i.offsetTop,r.left=i.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function Cue({children:e,isPresent:t}){const i=_e.useId(),r=_e.useRef(null),n=_e.useRef({width:0,height:0,top:0,left:0}),{nonce:s}=_e.useContext(mU);return _e.useInsertionEffect(()=>{const{width:a,height:o,top:l,left:c}=n.current;if(t||!r.current||!a||!o)return;r.current.dataset.motionPopId=i;const u=document.createElement("style");return s&&(u.nonce=s),document.head.appendChild(u),u.sheet&&u.sheet.insertRule(`
          [data-motion-pop-id="${i}"] {
            position: absolute !important;
            width: ${a}px !important;
            height: ${o}px !important;
            top: ${l}px !important;
            left: ${c}px !important;
          }
        `),()=>{document.head.removeChild(u)}},[t]),Te.jsx(Tue,{isPresent:t,childRef:r,sizeRef:n,children:_e.cloneElement(e,{ref:r})})}const Pue=({children:e,initial:t,isPresent:i,onExitComplete:r,custom:n,presenceAffectsLayout:s,mode:a})=>{const o=pU(Due),l=_e.useId(),c=_e.useCallback(h=>{o.set(h,!0);for(const d of o.values())if(!d)return;r&&r()},[o,r]),u=_e.useMemo(()=>({id:l,initial:t,isPresent:i,custom:n,onExitComplete:c,register:h=>(o.set(h,!1),()=>o.delete(h))}),s?[Math.random(),c]:[i,c]);return _e.useMemo(()=>{o.forEach((h,d)=>o.set(d,!1))},[i]),_e.useEffect(()=>{!i&&!o.size&&r&&r()},[i]),a==="popLayout"&&(e=Te.jsx(Cue,{isPresent:i,children:e})),Te.jsx(vC.Provider,{value:u,children:e})};function Due(){return new Map}function HZ(e=!0){const t=_e.useContext(vC);if(t===null)return[!0,null];const{isPresent:i,onExitComplete:r,register:n}=t,s=_e.useId();_e.useEffect(()=>{e&&n(s)},[e]);const a=_e.useCallback(()=>e&&r&&r(s),[s,r,e]);return!i&&r?[!1,a]:[!0]}const cS=e=>e.key||"";function v6(e){const t=[];return _e.Children.forEach(e,i=>{_e.isValidElement(i)&&t.push(i)}),t}const gU=typeof window<"u",jZ=gU?_e.useLayoutEffect:_e.useEffect,vU=({children:e,custom:t,initial:i=!0,onExitComplete:r,presenceAffectsLayout:n=!0,mode:s="sync",propagate:a=!1})=>{const[o,l]=HZ(a),c=_e.useMemo(()=>v6(e),[e]),u=a&&!o?[]:c.map(cS),h=_e.useRef(!0),d=_e.useRef(c),f=pU(()=>new Map),[p,v]=_e.useState(c),[m,g]=_e.useState(c);jZ(()=>{h.current=!1,d.current=c;for(let _=0;_<m.length;_++){const M=cS(m[_]);u.includes(M)?f.delete(M):f.get(M)!==!0&&f.set(M,!1)}},[m,u.length,u.join("-")]);const y=[];if(c!==p){let _=[...c];for(let M=0;M<m.length;M++){const S=m[M],T=cS(S);u.includes(T)||(_.splice(M,0,S),y.push(S))}s==="wait"&&y.length&&(_=y),g(v6(_)),v(c);return}const{forceRender:x}=_e.useContext(fU);return Te.jsx(Te.Fragment,{children:m.map(_=>{const M=cS(_),S=a&&!o?!1:c===m||u.includes(M),T=()=>{if(f.has(M))f.set(M,!0);else return;let E=!0;f.forEach(C=>{C||(E=!1)}),E&&(x==null||x(),g(d.current),a&&(l==null||l()),r&&r())};return Te.jsx(Pue,{isPresent:S,initial:!h.current||i?void 0:!1,custom:S?void 0:t,presenceAffectsLayout:n,mode:s,onExitComplete:S?void 0:T,children:_},M)})})},Io=e=>e;let _O=Io;function yU(e){let t;return()=>(t===void 0&&(t=e()),t)}const P0=(e,t,i)=>{const r=t-e;return r===0?1:(i-e)/r},gh=e=>e*1e3,vh=e=>e/1e3,Rue={skipAnimations:!1,useManualTiming:!1};function Iue(e){let t=new Set,i=new Set,r=!1,n=!1;const s=new WeakSet;let a={delta:0,timestamp:0,isProcessing:!1};function o(c){s.has(c)&&(l.schedule(c),e()),c(a)}const l={schedule:(c,u=!1,h=!1)=>{const f=h&&r?t:i;return u&&s.add(c),f.has(c)||f.add(c),c},cancel:c=>{i.delete(c),s.delete(c)},process:c=>{if(a=c,r){n=!0;return}r=!0,[t,i]=[i,t],t.forEach(o),t.clear(),r=!1,n&&(n=!1,l.process(c))}};return l}const uS=["read","resolveKeyframes","update","preRender","render","postRender"],Lue=40;function WZ(e,t){let i=!1,r=!0;const n={delta:0,timestamp:0,isProcessing:!1},s=()=>i=!0,a=uS.reduce((g,y)=>(g[y]=Iue(s),g),{}),{read:o,resolveKeyframes:l,update:c,preRender:u,render:h,postRender:d}=a,f=()=>{const g=performance.now();i=!1,n.delta=r?1e3/60:Math.max(Math.min(g-n.timestamp,Lue),1),n.timestamp=g,n.isProcessing=!0,o.process(n),l.process(n),c.process(n),u.process(n),h.process(n),d.process(n),n.isProcessing=!1,i&&t&&(r=!1,e(f))},p=()=>{i=!0,r=!0,n.isProcessing||e(f)};return{schedule:uS.reduce((g,y)=>{const x=a[y];return g[y]=(_,M=!1,S=!1)=>(i||p(),x.schedule(_,M,S)),g},{}),cancel:g=>{for(let y=0;y<uS.length;y++)a[uS[y]].cancel(g)},state:n,steps:a}}const{schedule:Pr,cancel:pf,state:Ts,steps:tD}=WZ(typeof requestAnimationFrame<"u"?requestAnimationFrame:Io,!0),XZ=_e.createContext({strict:!1}),y6={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},D0={};for(const e in y6)D0[e]={isEnabled:t=>y6[e].some(i=>!!t[i])};function Oue(e){for(const t in e)D0[t]={...D0[t],...e[t]}}const zue=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function Q2(e){return e.startsWith("while")||e.startsWith("drag")&&e!=="draggable"||e.startsWith("layout")||e.startsWith("onTap")||e.startsWith("onPan")||e.startsWith("onLayout")||zue.has(e)}let qZ=e=>!Q2(e);function Bue(e){e&&(qZ=t=>t.startsWith("on")?!Q2(t):e(t))}try{Bue(require("@emotion/is-prop-valid").default)}catch{}function Fue(e,t,i){const r={};for(const n in e)n==="values"&&typeof e.values=="object"||(qZ(n)||i===!0&&Q2(n)||!t&&!Q2(n)||e.draggable&&n.startsWith("onDrag"))&&(r[n]=e[n]);return r}function Uue(e){if(typeof Proxy>"u")return e;const t=new Map,i=(...r)=>e(...r);return new Proxy(i,{get:(r,n)=>n==="create"?e:(t.has(n)||t.set(n,e(n)),t.get(n))})}const yC=_e.createContext({});function Sw(e){return typeof e=="string"||Array.isArray(e)}function xC(e){return e!==null&&typeof e=="object"&&typeof e.start=="function"}const xU=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],wU=["initial",...xU];function wC(e){return xC(e.animate)||wU.some(t=>Sw(e[t]))}function YZ(e){return!!(wC(e)||e.variants)}function Nue(e,t){if(wC(e)){const{initial:i,animate:r}=e;return{initial:i===!1||Sw(i)?i:void 0,animate:Sw(r)?r:void 0}}return e.inherit!==!1?t:{}}function kue(e){const{initial:t,animate:i}=Nue(e,_e.useContext(yC));return _e.useMemo(()=>({initial:t,animate:i}),[x6(t),x6(i)])}function x6(e){return Array.isArray(e)?e.join(" "):e}const Vue=Symbol.for("motionComponentSymbol");function Fv(e){return e&&typeof e=="object"&&Object.prototype.hasOwnProperty.call(e,"current")}function Gue(e,t,i){return _e.useCallback(r=>{r&&e.onMount&&e.onMount(r),t&&(r?t.mount(r):t.unmount()),i&&(typeof i=="function"?i(r):Fv(i)&&(i.current=r))},[t])}const bU=e=>e.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),Hue="framerAppearId",QZ="data-"+bU(Hue),{schedule:_U,cancel:_Ye}=WZ(queueMicrotask,!1),ZZ=_e.createContext({});function jue(e,t,i,r,n){var s,a;const{visualElement:o}=_e.useContext(yC),l=_e.useContext(XZ),c=_e.useContext(vC),u=_e.useContext(mU).reducedMotion,h=_e.useRef(null);r=r||l.renderer,!h.current&&r&&(h.current=r(e,{visualState:t,parent:o,props:i,presenceContext:c,blockInitialAnimation:c?c.initial===!1:!1,reducedMotionConfig:u}));const d=h.current,f=_e.useContext(ZZ);d&&!d.projection&&n&&(d.type==="html"||d.type==="svg")&&Wue(h.current,i,n,f);const p=_e.useRef(!1);_e.useInsertionEffect(()=>{d&&p.current&&d.update(i,c)});const v=i[QZ],m=_e.useRef(!!v&&!(!((s=window.MotionHandoffIsComplete)===null||s===void 0)&&s.call(window,v))&&((a=window.MotionHasOptimisedAnimation)===null||a===void 0?void 0:a.call(window,v)));return jZ(()=>{d&&(p.current=!0,window.MotionIsMounted=!0,d.updateFeatures(),_U.render(d.render),m.current&&d.animationState&&d.animationState.animateChanges())}),_e.useEffect(()=>{d&&(!m.current&&d.animationState&&d.animationState.animateChanges(),m.current&&(queueMicrotask(()=>{var g;(g=window.MotionHandoffMarkAsComplete)===null||g===void 0||g.call(window,v)}),m.current=!1))}),d}function Wue(e,t,i,r){const{layoutId:n,layout:s,drag:a,dragConstraints:o,layoutScroll:l,layoutRoot:c}=t;e.projection=new i(e.latestValues,t["data-framer-portal-id"]?void 0:KZ(e.parent)),e.projection.setOptions({layoutId:n,layout:s,alwaysMeasureLayout:!!a||o&&Fv(o),visualElement:e,animationType:typeof s=="string"?s:"both",initialPromotionConfig:r,layoutScroll:l,layoutRoot:c})}function KZ(e){if(e)return e.options.allowProjection!==!1?e.projection:KZ(e.parent)}function Xue({preloadedFeatures:e,createVisualElement:t,useRender:i,useVisualState:r,Component:n}){var s,a;e&&Oue(e);function o(c,u){let h;const d={..._e.useContext(mU),...c,layoutId:que(c)},{isStatic:f}=d,p=kue(c),v=r(c,f);if(!f&&gU){Yue();const m=Que(d);h=m.MeasureLayout,p.visualElement=jue(n,v,d,t,m.ProjectionNode)}return Te.jsxs(yC.Provider,{value:p,children:[h&&p.visualElement?Te.jsx(h,{visualElement:p.visualElement,...d}):null,i(n,c,Gue(v,p.visualElement,u),v,f,p.visualElement)]})}o.displayName=`motion.${typeof n=="string"?n:`create(${(a=(s=n.displayName)!==null&&s!==void 0?s:n.name)!==null&&a!==void 0?a:""})`}`;const l=_e.forwardRef(o);return l[Vue]=n,l}function que({layoutId:e}){const t=_e.useContext(fU).id;return t&&e!==void 0?t+"-"+e:e}function Yue(e,t){_e.useContext(XZ).strict}function Que(e){const{drag:t,layout:i}=D0;if(!t&&!i)return{};const r={...t,...i};return{MeasureLayout:t!=null&&t.isEnabled(e)||i!=null&&i.isEnabled(e)?r.MeasureLayout:void 0,ProjectionNode:r.ProjectionNode}}const Zue=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function SU(e){return typeof e!="string"||e.includes("-")?!1:!!(Zue.indexOf(e)>-1||/[A-Z]/u.test(e))}function w6(e){const t=[{},{}];return e==null||e.values.forEach((i,r)=>{t[0][r]=i.get(),t[1][r]=i.getVelocity()}),t}function MU(e,t,i,r){if(typeof t=="function"){const[n,s]=w6(r);t=t(i!==void 0?i:e.custom,n,s)}if(typeof t=="string"&&(t=e.variants&&e.variants[t]),typeof t=="function"){const[n,s]=w6(r);t=t(i!==void 0?i:e.custom,n,s)}return t}const SO=e=>Array.isArray(e),Kue=e=>!!(e&&typeof e=="object"&&e.mix&&e.toValue),Jue=e=>SO(e)?e[e.length-1]||0:e,ra=e=>!!(e&&e.getVelocity);function YE(e){const t=ra(e)?e.get():e;return Kue(t)?t.toValue():t}function $ue({scrapeMotionValuesFromProps:e,createRenderState:t,onUpdate:i},r,n,s){const a={latestValues:ehe(r,n,s,e),renderState:t()};return i&&(a.onMount=o=>i({props:r,current:o,...a}),a.onUpdate=o=>i(o)),a}const JZ=e=>(t,i)=>{const r=_e.useContext(yC),n=_e.useContext(vC),s=()=>$ue(e,t,r,n);return i?s():pU(s)};function ehe(e,t,i,r){const n={},s=r(e,{});for(const d in s)n[d]=YE(s[d]);let{initial:a,animate:o}=e;const l=wC(e),c=YZ(e);t&&c&&!l&&e.inherit!==!1&&(a===void 0&&(a=t.initial),o===void 0&&(o=t.animate));let u=i?i.initial===!1:!1;u=u||a===!1;const h=u?o:a;if(h&&typeof h!="boolean"&&!xC(h)){const d=Array.isArray(h)?h:[h];for(let f=0;f<d.length;f++){const p=MU(e,d[f]);if(p){const{transitionEnd:v,transition:m,...g}=p;for(const y in g){let x=g[y];if(Array.isArray(x)){const _=u?x.length-1:0;x=x[_]}x!==null&&(n[y]=x)}for(const y in v)n[y]=v[y]}}}return n}const iy=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],Hm=new Set(iy),$Z=e=>t=>typeof t=="string"&&t.startsWith(e),eK=$Z("--"),the=$Z("var(--"),EU=e=>the(e)?ihe.test(e.split("/*")[0].trim()):!1,ihe=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,tK=(e,t)=>t&&typeof e=="number"?t.transform(e):e,Ah=(e,t,i)=>i>t?t:i<e?e:i,ry={test:e=>typeof e=="number",parse:parseFloat,transform:e=>e},Mw={...ry,transform:e=>Ah(0,1,e)},hS={...ry,default:1},Sb=e=>({test:t=>typeof t=="string"&&t.endsWith(e)&&t.split(" ").length===1,parse:parseFloat,transform:t=>`${t}${e}`}),bd=Sb("deg"),Zc=Sb("%"),oi=Sb("px"),rhe=Sb("vh"),nhe=Sb("vw"),b6={...Zc,parse:e=>Zc.parse(e)/100,transform:e=>Zc.transform(e*100)},she={borderWidth:oi,borderTopWidth:oi,borderRightWidth:oi,borderBottomWidth:oi,borderLeftWidth:oi,borderRadius:oi,radius:oi,borderTopLeftRadius:oi,borderTopRightRadius:oi,borderBottomRightRadius:oi,borderBottomLeftRadius:oi,width:oi,maxWidth:oi,height:oi,maxHeight:oi,top:oi,right:oi,bottom:oi,left:oi,padding:oi,paddingTop:oi,paddingRight:oi,paddingBottom:oi,paddingLeft:oi,margin:oi,marginTop:oi,marginRight:oi,marginBottom:oi,marginLeft:oi,backgroundPositionX:oi,backgroundPositionY:oi},ahe={rotate:bd,rotateX:bd,rotateY:bd,rotateZ:bd,scale:hS,scaleX:hS,scaleY:hS,scaleZ:hS,skew:bd,skewX:bd,skewY:bd,distance:oi,translateX:oi,translateY:oi,translateZ:oi,x:oi,y:oi,z:oi,perspective:oi,transformPerspective:oi,opacity:Mw,originX:b6,originY:b6,originZ:oi},_6={...ry,transform:Math.round},AU={...she,...ahe,zIndex:_6,size:oi,fillOpacity:Mw,strokeOpacity:Mw,numOctaves:_6},ohe={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},lhe=iy.length;function che(e,t,i){let r="",n=!0;for(let s=0;s<lhe;s++){const a=iy[s],o=e[a];if(o===void 0)continue;let l=!0;if(typeof o=="number"?l=o===(a.startsWith("scale")?1:0):l=parseFloat(o)===0,!l||i){const c=tK(o,AU[a]);if(!l){n=!1;const u=ohe[a]||a;r+=`${u}(${c}) `}i&&(t[a]=c)}}return r=r.trim(),i?r=i(t,n?"":r):n&&(r="none"),r}function TU(e,t,i){const{style:r,vars:n,transformOrigin:s}=e;let a=!1,o=!1;for(const l in t){const c=t[l];if(Hm.has(l)){a=!0;continue}else if(eK(l)){n[l]=c;continue}else{const u=tK(c,AU[l]);l.startsWith("origin")?(o=!0,s[l]=u):r[l]=u}}if(t.transform||(a||i?r.transform=che(t,e.transform,i):r.transform&&(r.transform="none")),o){const{originX:l="50%",originY:c="50%",originZ:u=0}=s;r.transformOrigin=`${l} ${c} ${u}`}}const uhe={offset:"stroke-dashoffset",array:"stroke-dasharray"},hhe={offset:"strokeDashoffset",array:"strokeDasharray"};function dhe(e,t,i=1,r=0,n=!0){e.pathLength=1;const s=n?uhe:hhe;e[s.offset]=oi.transform(-r);const a=oi.transform(t),o=oi.transform(i);e[s.array]=`${a} ${o}`}function S6(e,t,i){return typeof e=="string"?e:oi.transform(t+i*e)}function fhe(e,t,i){const r=S6(t,e.x,e.width),n=S6(i,e.y,e.height);return`${r} ${n}`}function CU(e,{attrX:t,attrY:i,attrScale:r,originX:n,originY:s,pathLength:a,pathSpacing:o=1,pathOffset:l=0,...c},u,h){if(TU(e,c,h),u){e.style.viewBox&&(e.attrs.viewBox=e.style.viewBox);return}e.attrs=e.style,e.style={};const{attrs:d,style:f,dimensions:p}=e;d.transform&&(p&&(f.transform=d.transform),delete d.transform),p&&(n!==void 0||s!==void 0||f.transform)&&(f.transformOrigin=fhe(p,n!==void 0?n:.5,s!==void 0?s:.5)),t!==void 0&&(d.x=t),i!==void 0&&(d.y=i),r!==void 0&&(d.scale=r),a!==void 0&&dhe(d,a,o,l,!1)}const PU=()=>({style:{},transform:{},transformOrigin:{},vars:{}}),iK=()=>({...PU(),attrs:{}}),DU=e=>typeof e=="string"&&e.toLowerCase()==="svg";function rK(e,{style:t,vars:i},r,n){Object.assign(e.style,t,n&&n.getProjectionStyles(r));for(const s in i)e.style.setProperty(s,i[s])}const nK=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function sK(e,t,i,r){rK(e,t,void 0,r);for(const n in t.attrs)e.setAttribute(nK.has(n)?n:bU(n),t.attrs[n])}const Z2={};function phe(e){Object.assign(Z2,e)}function aK(e,{layout:t,layoutId:i}){return Hm.has(e)||e.startsWith("origin")||(t||i!==void 0)&&(!!Z2[e]||e==="opacity")}function RU(e,t,i){var r;const{style:n}=e,s={};for(const a in n)(ra(n[a])||t.style&&ra(t.style[a])||aK(a,e)||((r=i==null?void 0:i.getValue(a))===null||r===void 0?void 0:r.liveStyle)!==void 0)&&(s[a]=n[a]);return s}function oK(e,t,i){const r=RU(e,t,i);for(const n in e)if(ra(e[n])||ra(t[n])){const s=iy.indexOf(n)!==-1?"attr"+n.charAt(0).toUpperCase()+n.substring(1):n;r[s]=e[n]}return r}function mhe(e,t){try{t.dimensions=typeof e.getBBox=="function"?e.getBBox():e.getBoundingClientRect()}catch{t.dimensions={x:0,y:0,width:0,height:0}}}const M6=["x","y","width","height","cx","cy","r"],ghe={useVisualState:JZ({scrapeMotionValuesFromProps:oK,createRenderState:iK,onUpdate:({props:e,prevProps:t,current:i,renderState:r,latestValues:n})=>{if(!i)return;let s=!!e.drag;if(!s){for(const o in n)if(Hm.has(o)){s=!0;break}}if(!s)return;let a=!t;if(t)for(let o=0;o<M6.length;o++){const l=M6[o];e[l]!==t[l]&&(a=!0)}a&&Pr.read(()=>{mhe(i,r),Pr.render(()=>{CU(r,n,DU(i.tagName),e.transformTemplate),sK(i,r)})})}})},vhe={useVisualState:JZ({scrapeMotionValuesFromProps:RU,createRenderState:PU})};function lK(e,t,i){for(const r in t)!ra(t[r])&&!aK(r,i)&&(e[r]=t[r])}function yhe({transformTemplate:e},t){return _e.useMemo(()=>{const i=PU();return TU(i,t,e),Object.assign({},i.vars,i.style)},[t])}function xhe(e,t){const i=e.style||{},r={};return lK(r,i,e),Object.assign(r,yhe(e,t)),r}function whe(e,t){const i={},r=xhe(e,t);return e.drag&&e.dragListener!==!1&&(i.draggable=!1,r.userSelect=r.WebkitUserSelect=r.WebkitTouchCallout="none",r.touchAction=e.drag===!0?"none":`pan-${e.drag==="x"?"y":"x"}`),e.tabIndex===void 0&&(e.onTap||e.onTapStart||e.whileTap)&&(i.tabIndex=0),i.style=r,i}function bhe(e,t,i,r){const n=_e.useMemo(()=>{const s=iK();return CU(s,t,DU(r),e.transformTemplate),{...s.attrs,style:{...s.style}}},[t]);if(e.style){const s={};lK(s,e.style,e),n.style={...s,...n.style}}return n}function _he(e=!1){return(i,r,n,{latestValues:s},a)=>{const l=(SU(i)?bhe:whe)(r,s,a,i),c=Fue(r,typeof i=="string",e),u=i!==_e.Fragment?{...c,...l,ref:n}:{},{children:h}=r,d=_e.useMemo(()=>ra(h)?h.get():h,[h]);return _e.createElement(i,{...u,children:d})}}function She(e,t){return function(r,{forwardMotionProps:n}={forwardMotionProps:!1}){const a={...SU(r)?ghe:vhe,preloadedFeatures:e,useRender:_he(n),createVisualElement:t,Component:r};return Xue(a)}}function cK(e,t){if(!Array.isArray(t))return!1;const i=t.length;if(i!==e.length)return!1;for(let r=0;r<i;r++)if(t[r]!==e[r])return!1;return!0}function bC(e,t,i){const r=e.getProps();return MU(r,t,i!==void 0?i:r.custom,e)}const Mhe=yU(()=>window.ScrollTimeline!==void 0);class Ehe{constructor(t){this.stop=()=>this.runAll("stop"),this.animations=t.filter(Boolean)}get finished(){return Promise.all(this.animations.map(t=>"finished"in t?t.finished:t))}getAll(t){return this.animations[0][t]}setAll(t,i){for(let r=0;r<this.animations.length;r++)this.animations[r][t]=i}attachTimeline(t,i){const r=this.animations.map(n=>{if(Mhe()&&n.attachTimeline)return n.attachTimeline(t);if(typeof i=="function")return i(n)});return()=>{r.forEach((n,s)=>{n&&n(),this.animations[s].stop()})}}get time(){return this.getAll("time")}set time(t){this.setAll("time",t)}get speed(){return this.getAll("speed")}set speed(t){this.setAll("speed",t)}get startTime(){return this.getAll("startTime")}get duration(){let t=0;for(let i=0;i<this.animations.length;i++)t=Math.max(t,this.animations[i].duration);return t}runAll(t){this.animations.forEach(i=>i[t]())}flatten(){this.runAll("flatten")}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}class Ahe extends Ehe{then(t,i){return Promise.all(this.animations).then(t).catch(i)}}function IU(e,t){return e?e[t]||e.default||e:void 0}const MO=2e4;function uK(e){let t=0;const i=50;let r=e.next(t);for(;!r.done&&t<MO;)t+=i,r=e.next(t);return t>=MO?1/0:t}function LU(e){return typeof e=="function"}function E6(e,t){e.timeline=t,e.onfinish=null}const OU=e=>Array.isArray(e)&&typeof e[0]=="number",The={linearEasing:void 0};function Che(e,t){const i=yU(e);return()=>{var r;return(r=The[t])!==null&&r!==void 0?r:i()}}const K2=Che(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),hK=(e,t,i=10)=>{let r="";const n=Math.max(Math.round(t/i),2);for(let s=0;s<n;s++)r+=e(P0(0,n-1,s))+", ";return`linear(${r.substring(0,r.length-2)})`};function dK(e){return!!(typeof e=="function"&&K2()||!e||typeof e=="string"&&(e in EO||K2())||OU(e)||Array.isArray(e)&&e.every(dK))}const ex=([e,t,i,r])=>`cubic-bezier(${e}, ${t}, ${i}, ${r})`,EO={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:ex([0,.65,.55,1]),circOut:ex([.55,0,1,.45]),backIn:ex([.31,.01,.66,-.59]),backOut:ex([.33,1.53,.69,.99])};function fK(e,t){if(e)return typeof e=="function"&&K2()?hK(e,t):OU(e)?ex(e):Array.isArray(e)?e.map(i=>fK(i,t)||EO.easeOut):EO[e]}const kl={x:!1,y:!1};function pK(){return kl.x||kl.y}function Phe(e,t,i){var r;if(e instanceof Element)return[e];if(typeof e=="string"){let n=document;const s=(r=void 0)!==null&&r!==void 0?r:n.querySelectorAll(e);return s?Array.from(s):[]}return Array.from(e)}function mK(e,t){const i=Phe(e),r=new AbortController,n={passive:!0,...t,signal:r.signal};return[i,n,()=>r.abort()]}function A6(e){return t=>{t.pointerType==="touch"||pK()||e(t)}}function Dhe(e,t,i={}){const[r,n,s]=mK(e,i),a=A6(o=>{const{target:l}=o,c=t(o);if(typeof c!="function"||!l)return;const u=A6(h=>{c(h),l.removeEventListener("pointerleave",u)});l.addEventListener("pointerleave",u,n)});return r.forEach(o=>{o.addEventListener("pointerenter",a,n)}),s}const gK=(e,t)=>t?e===t?!0:gK(e,t.parentElement):!1,zU=e=>e.pointerType==="mouse"?typeof e.button!="number"||e.button<=0:e.isPrimary!==!1,Rhe=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function Ihe(e){return Rhe.has(e.tagName)||e.tabIndex!==-1}const tx=new WeakSet;function T6(e){return t=>{t.key==="Enter"&&e(t)}}function iD(e,t){e.dispatchEvent(new PointerEvent("pointer"+t,{isPrimary:!0,bubbles:!0}))}const Lhe=(e,t)=>{const i=e.currentTarget;if(!i)return;const r=T6(()=>{if(tx.has(i))return;iD(i,"down");const n=T6(()=>{iD(i,"up")}),s=()=>iD(i,"cancel");i.addEventListener("keyup",n,t),i.addEventListener("blur",s,t)});i.addEventListener("keydown",r,t),i.addEventListener("blur",()=>i.removeEventListener("keydown",r),t)};function C6(e){return zU(e)&&!pK()}function Ohe(e,t,i={}){const[r,n,s]=mK(e,i),a=o=>{const l=o.currentTarget;if(!C6(o)||tx.has(l))return;tx.add(l);const c=t(o),u=(f,p)=>{window.removeEventListener("pointerup",h),window.removeEventListener("pointercancel",d),!(!C6(f)||!tx.has(l))&&(tx.delete(l),typeof c=="function"&&c(f,{success:p}))},h=f=>{u(f,i.useGlobalTarget||gK(l,f.target))},d=f=>{u(f,!1)};window.addEventListener("pointerup",h,n),window.addEventListener("pointercancel",d,n)};return r.forEach(o=>{!Ihe(o)&&o.getAttribute("tabindex")===null&&(o.tabIndex=0),(i.useGlobalTarget?window:o).addEventListener("pointerdown",a,n),o.addEventListener("focus",c=>Lhe(c,n),n)}),s}function zhe(e){return e==="x"||e==="y"?kl[e]?null:(kl[e]=!0,()=>{kl[e]=!1}):kl.x||kl.y?null:(kl.x=kl.y=!0,()=>{kl.x=kl.y=!1})}const vK=new Set(["width","height","top","left","right","bottom",...iy]);let QE;function Bhe(){QE=void 0}const Kc={now:()=>(QE===void 0&&Kc.set(Ts.isProcessing||Rue.useManualTiming?Ts.timestamp:performance.now()),QE),set:e=>{QE=e,queueMicrotask(Bhe)}};function BU(e,t){e.indexOf(t)===-1&&e.push(t)}function FU(e,t){const i=e.indexOf(t);i>-1&&e.splice(i,1)}class UU{constructor(){this.subscriptions=[]}add(t){return BU(this.subscriptions,t),()=>FU(this.subscriptions,t)}notify(t,i,r){const n=this.subscriptions.length;if(n)if(n===1)this.subscriptions[0](t,i,r);else for(let s=0;s<n;s++){const a=this.subscriptions[s];a&&a(t,i,r)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}function yK(e,t){return t?e*(1e3/t):0}const P6=30,Fhe=e=>!isNaN(parseFloat(e));class Uhe{constructor(t,i={}){this.version="11.18.2",this.canTrackVelocity=null,this.events={},this.updateAndNotify=(r,n=!0)=>{const s=Kc.now();this.updatedAt!==s&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(r),this.current!==this.prev&&this.events.change&&this.events.change.notify(this.current),n&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.hasAnimated=!1,this.setCurrent(t),this.owner=i.owner}setCurrent(t){this.current=t,this.updatedAt=Kc.now(),this.canTrackVelocity===null&&t!==void 0&&(this.canTrackVelocity=Fhe(this.current))}setPrevFrameValue(t=this.current){this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt}onChange(t){return this.on("change",t)}on(t,i){this.events[t]||(this.events[t]=new UU);const r=this.events[t].add(i);return t==="change"?()=>{r(),Pr.read(()=>{this.events.change.getSize()||this.stop()})}:r}clearListeners(){for(const t in this.events)this.events[t].clear()}attach(t,i){this.passiveEffect=t,this.stopPassiveEffect=i}set(t,i=!0){!i||!this.passiveEffect?this.updateAndNotify(t,i):this.passiveEffect(t,this.updateAndNotify)}setWithVelocity(t,i,r){this.set(i),this.prev=void 0,this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt-r}jump(t,i=!0){this.updateAndNotify(t),this.prev=t,this.prevUpdatedAt=this.prevFrameValue=void 0,i&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const t=Kc.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||t-this.updatedAt>P6)return 0;const i=Math.min(this.updatedAt-this.prevUpdatedAt,P6);return yK(parseFloat(this.current)-parseFloat(this.prevFrameValue),i)}start(t){return this.stop(),new Promise(i=>{this.hasAnimated=!0,this.animation=t(i),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function Ew(e,t){return new Uhe(e,t)}function Nhe(e,t,i){e.hasValue(t)?e.getValue(t).set(i):e.addValue(t,Ew(i))}function khe(e,t){const i=bC(e,t);let{transitionEnd:r={},transition:n={},...s}=i||{};s={...s,...r};for(const a in s){const o=Jue(s[a]);Nhe(e,a,o)}}function Vhe(e){return!!(ra(e)&&e.add)}function AO(e,t){const i=e.getValue("willChange");if(Vhe(i))return i.add(t)}function xK(e){return e.props[QZ]}const wK=(e,t,i)=>(((1-3*i+3*t)*e+(3*i-6*t))*e+3*t)*e,Ghe=1e-7,Hhe=12;function jhe(e,t,i,r,n){let s,a,o=0;do a=t+(i-t)/2,s=wK(a,r,n)-e,s>0?i=a:t=a;while(Math.abs(s)>Ghe&&++o<Hhe);return a}function Mb(e,t,i,r){if(e===t&&i===r)return Io;const n=s=>jhe(s,0,1,e,i);return s=>s===0||s===1?s:wK(n(s),t,r)}const bK=e=>t=>t<=.5?e(2*t)/2:(2-e(2*(1-t)))/2,_K=e=>t=>1-e(1-t),SK=Mb(.33,1.53,.69,.99),NU=_K(SK),MK=bK(NU),EK=e=>(e*=2)<1?.5*NU(e):.5*(2-Math.pow(2,-10*(e-1))),kU=e=>1-Math.sin(Math.acos(e)),AK=_K(kU),TK=bK(kU),CK=e=>/^0[^.\s]+$/u.test(e);function Whe(e){return typeof e=="number"?e===0:e!==null?e==="none"||e==="0"||CK(e):!0}const Ex=e=>Math.round(e*1e5)/1e5,VU=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function Xhe(e){return e==null}const qhe=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,GU=(e,t)=>i=>!!(typeof i=="string"&&qhe.test(i)&&i.startsWith(e)||t&&!Xhe(i)&&Object.prototype.hasOwnProperty.call(i,t)),PK=(e,t,i)=>r=>{if(typeof r!="string")return r;const[n,s,a,o]=r.match(VU);return{[e]:parseFloat(n),[t]:parseFloat(s),[i]:parseFloat(a),alpha:o!==void 0?parseFloat(o):1}},Yhe=e=>Ah(0,255,e),rD={...ry,transform:e=>Math.round(Yhe(e))},Hp={test:GU("rgb","red"),parse:PK("red","green","blue"),transform:({red:e,green:t,blue:i,alpha:r=1})=>"rgba("+rD.transform(e)+", "+rD.transform(t)+", "+rD.transform(i)+", "+Ex(Mw.transform(r))+")"};function Qhe(e){let t="",i="",r="",n="";return e.length>5?(t=e.substring(1,3),i=e.substring(3,5),r=e.substring(5,7),n=e.substring(7,9)):(t=e.substring(1,2),i=e.substring(2,3),r=e.substring(3,4),n=e.substring(4,5),t+=t,i+=i,r+=r,n+=n),{red:parseInt(t,16),green:parseInt(i,16),blue:parseInt(r,16),alpha:n?parseInt(n,16)/255:1}}const TO={test:GU("#"),parse:Qhe,transform:Hp.transform},Uv={test:GU("hsl","hue"),parse:PK("hue","saturation","lightness"),transform:({hue:e,saturation:t,lightness:i,alpha:r=1})=>"hsla("+Math.round(e)+", "+Zc.transform(Ex(t))+", "+Zc.transform(Ex(i))+", "+Ex(Mw.transform(r))+")"},$s={test:e=>Hp.test(e)||TO.test(e)||Uv.test(e),parse:e=>Hp.test(e)?Hp.parse(e):Uv.test(e)?Uv.parse(e):TO.parse(e),transform:e=>typeof e=="string"?e:e.hasOwnProperty("red")?Hp.transform(e):Uv.transform(e)},Zhe=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function Khe(e){var t,i;return isNaN(e)&&typeof e=="string"&&(((t=e.match(VU))===null||t===void 0?void 0:t.length)||0)+(((i=e.match(Zhe))===null||i===void 0?void 0:i.length)||0)>0}const DK="number",RK="color",Jhe="var",$he="var(",D6="${}",ede=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function Aw(e){const t=e.toString(),i=[],r={color:[],number:[],var:[]},n=[];let s=0;const o=t.replace(ede,l=>($s.test(l)?(r.color.push(s),n.push(RK),i.push($s.parse(l))):l.startsWith($he)?(r.var.push(s),n.push(Jhe),i.push(l)):(r.number.push(s),n.push(DK),i.push(parseFloat(l))),++s,D6)).split(D6);return{values:i,split:o,indexes:r,types:n}}function IK(e){return Aw(e).values}function LK(e){const{split:t,types:i}=Aw(e),r=t.length;return n=>{let s="";for(let a=0;a<r;a++)if(s+=t[a],n[a]!==void 0){const o=i[a];o===DK?s+=Ex(n[a]):o===RK?s+=$s.transform(n[a]):s+=n[a]}return s}}const tde=e=>typeof e=="number"?0:e;function ide(e){const t=IK(e);return LK(e)(t.map(tde))}const mf={test:Khe,parse:IK,createTransformer:LK,getAnimatableNone:ide},rde=new Set(["brightness","contrast","saturate","opacity"]);function nde(e){const[t,i]=e.slice(0,-1).split("(");if(t==="drop-shadow")return e;const[r]=i.match(VU)||[];if(!r)return e;const n=i.replace(r,"");let s=rde.has(t)?1:0;return r!==i&&(s*=100),t+"("+s+n+")"}const sde=/\b([a-z-]*)\(.*?\)/gu,CO={...mf,getAnimatableNone:e=>{const t=e.match(sde);return t?t.map(nde).join(" "):e}},ade={...AU,color:$s,backgroundColor:$s,outlineColor:$s,fill:$s,stroke:$s,borderColor:$s,borderTopColor:$s,borderRightColor:$s,borderBottomColor:$s,borderLeftColor:$s,filter:CO,WebkitFilter:CO},HU=e=>ade[e];function OK(e,t){let i=HU(e);return i!==CO&&(i=mf),i.getAnimatableNone?i.getAnimatableNone(t):void 0}const ode=new Set(["auto","none","0"]);function lde(e,t,i){let r=0,n;for(;r<e.length&&!n;){const s=e[r];typeof s=="string"&&!ode.has(s)&&Aw(s).values.length&&(n=e[r]),r++}if(n&&i)for(const s of t)e[s]=OK(i,n)}const R6=e=>e===ry||e===oi,I6=(e,t)=>parseFloat(e.split(", ")[t]),L6=(e,t)=>(i,{transform:r})=>{if(r==="none"||!r)return 0;const n=r.match(/^matrix3d\((.+)\)$/u);if(n)return I6(n[1],t);{const s=r.match(/^matrix\((.+)\)$/u);return s?I6(s[1],e):0}},cde=new Set(["x","y","z"]),ude=iy.filter(e=>!cde.has(e));function hde(e){const t=[];return ude.forEach(i=>{const r=e.getValue(i);r!==void 0&&(t.push([i,r.get()]),r.set(i.startsWith("scale")?1:0))}),t}const R0={width:({x:e},{paddingLeft:t="0",paddingRight:i="0"})=>e.max-e.min-parseFloat(t)-parseFloat(i),height:({y:e},{paddingTop:t="0",paddingBottom:i="0"})=>e.max-e.min-parseFloat(t)-parseFloat(i),top:(e,{top:t})=>parseFloat(t),left:(e,{left:t})=>parseFloat(t),bottom:({y:e},{top:t})=>parseFloat(t)+(e.max-e.min),right:({x:e},{left:t})=>parseFloat(t)+(e.max-e.min),x:L6(4,13),y:L6(5,14)};R0.translateX=R0.x;R0.translateY=R0.y;const rm=new Set;let PO=!1,DO=!1;function zK(){if(DO){const e=Array.from(rm).filter(r=>r.needsMeasurement),t=new Set(e.map(r=>r.element)),i=new Map;t.forEach(r=>{const n=hde(r);n.length&&(i.set(r,n),r.render())}),e.forEach(r=>r.measureInitialState()),t.forEach(r=>{r.render();const n=i.get(r);n&&n.forEach(([s,a])=>{var o;(o=r.getValue(s))===null||o===void 0||o.set(a)})}),e.forEach(r=>r.measureEndState()),e.forEach(r=>{r.suspendedScrollY!==void 0&&window.scrollTo(0,r.suspendedScrollY)})}DO=!1,PO=!1,rm.forEach(e=>e.complete()),rm.clear()}function BK(){rm.forEach(e=>{e.readKeyframes(),e.needsMeasurement&&(DO=!0)})}function dde(){BK(),zK()}class jU{constructor(t,i,r,n,s,a=!1){this.isComplete=!1,this.isAsync=!1,this.needsMeasurement=!1,this.isScheduled=!1,this.unresolvedKeyframes=[...t],this.onComplete=i,this.name=r,this.motionValue=n,this.element=s,this.isAsync=a}scheduleResolve(){this.isScheduled=!0,this.isAsync?(rm.add(this),PO||(PO=!0,Pr.read(BK),Pr.resolveKeyframes(zK))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:t,name:i,element:r,motionValue:n}=this;for(let s=0;s<t.length;s++)if(t[s]===null)if(s===0){const a=n==null?void 0:n.get(),o=t[t.length-1];if(a!==void 0)t[0]=a;else if(r&&i){const l=r.readValue(i,o);l!=null&&(t[0]=l)}t[0]===void 0&&(t[0]=o),n&&a===void 0&&n.set(t[0])}else t[s]=t[s-1]}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){this.isComplete=!0,this.onComplete(this.unresolvedKeyframes,this.finalKeyframe),rm.delete(this)}cancel(){this.isComplete||(this.isScheduled=!1,rm.delete(this))}resume(){this.isComplete||this.scheduleResolve()}}const FK=e=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(e),fde=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function pde(e){const t=fde.exec(e);if(!t)return[,];const[,i,r,n]=t;return[`--${i??r}`,n]}function UK(e,t,i=1){const[r,n]=pde(e);if(!r)return;const s=window.getComputedStyle(t).getPropertyValue(r);if(s){const a=s.trim();return FK(a)?parseFloat(a):a}return EU(n)?UK(n,t,i+1):n}const NK=e=>t=>t.test(e),mde={test:e=>e==="auto",parse:e=>e},kK=[ry,oi,Zc,bd,nhe,rhe,mde],O6=e=>kK.find(NK(e));class VK extends jU{constructor(t,i,r,n,s){super(t,i,r,n,s,!0)}readKeyframes(){const{unresolvedKeyframes:t,element:i,name:r}=this;if(!i||!i.current)return;super.readKeyframes();for(let l=0;l<t.length;l++){let c=t[l];if(typeof c=="string"&&(c=c.trim(),EU(c))){const u=UK(c,i.current);u!==void 0&&(t[l]=u),l===t.length-1&&(this.finalKeyframe=c)}}if(this.resolveNoneKeyframes(),!vK.has(r)||t.length!==2)return;const[n,s]=t,a=O6(n),o=O6(s);if(a!==o)if(R6(a)&&R6(o))for(let l=0;l<t.length;l++){const c=t[l];typeof c=="string"&&(t[l]=parseFloat(c))}else this.needsMeasurement=!0}resolveNoneKeyframes(){const{unresolvedKeyframes:t,name:i}=this,r=[];for(let n=0;n<t.length;n++)Whe(t[n])&&r.push(n);r.length&&lde(t,r,i)}measureInitialState(){const{element:t,unresolvedKeyframes:i,name:r}=this;if(!t||!t.current)return;r==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=R0[r](t.measureViewportBox(),window.getComputedStyle(t.current)),i[0]=this.measuredOrigin;const n=i[i.length-1];n!==void 0&&t.getValue(r,n).jump(n,!1)}measureEndState(){var t;const{element:i,name:r,unresolvedKeyframes:n}=this;if(!i||!i.current)return;const s=i.getValue(r);s&&s.jump(this.measuredOrigin,!1);const a=n.length-1,o=n[a];n[a]=R0[r](i.measureViewportBox(),window.getComputedStyle(i.current)),o!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=o),!((t=this.removedTransforms)===null||t===void 0)&&t.length&&this.removedTransforms.forEach(([l,c])=>{i.getValue(l).set(c)}),this.resolveNoneKeyframes()}}const z6=(e,t)=>t==="zIndex"?!1:!!(typeof e=="number"||Array.isArray(e)||typeof e=="string"&&(mf.test(e)||e==="0")&&!e.startsWith("url("));function gde(e){const t=e[0];if(e.length===1)return!0;for(let i=0;i<e.length;i++)if(e[i]!==t)return!0}function vde(e,t,i,r){const n=e[0];if(n===null)return!1;if(t==="display"||t==="visibility")return!0;const s=e[e.length-1],a=z6(n,t),o=z6(s,t);return!a||!o?!1:gde(e)||(i==="spring"||LU(i))&&r}const yde=e=>e!==null;function _C(e,{repeat:t,repeatType:i="loop"},r){const n=e.filter(yde),s=t&&i!=="loop"&&t%2===1?0:n.length-1;return!s||r===void 0?n[s]:r}const xde=40;class GK{constructor({autoplay:t=!0,delay:i=0,type:r="keyframes",repeat:n=0,repeatDelay:s=0,repeatType:a="loop",...o}){this.isStopped=!1,this.hasAttemptedResolve=!1,this.createdAt=Kc.now(),this.options={autoplay:t,delay:i,type:r,repeat:n,repeatDelay:s,repeatType:a,...o},this.updateFinishedPromise()}calcStartTime(){return this.resolvedAt?this.resolvedAt-this.createdAt>xde?this.resolvedAt:this.createdAt:this.createdAt}get resolved(){return!this._resolved&&!this.hasAttemptedResolve&&dde(),this._resolved}onKeyframesResolved(t,i){this.resolvedAt=Kc.now(),this.hasAttemptedResolve=!0;const{name:r,type:n,velocity:s,delay:a,onComplete:o,onUpdate:l,isGenerator:c}=this.options;if(!c&&!vde(t,r,n,s))if(a)this.options.duration=0;else{l&&l(_C(t,this.options,i)),o&&o(),this.resolveFinishedPromise();return}const u=this.initPlayback(t,i);u!==!1&&(this._resolved={keyframes:t,finalKeyframe:i,...u},this.onPostResolved())}onPostResolved(){}then(t,i){return this.currentFinishedPromise.then(t,i)}flatten(){this.options.type="keyframes",this.options.ease="linear"}updateFinishedPromise(){this.currentFinishedPromise=new Promise(t=>{this.resolveFinishedPromise=t})}}const Nr=(e,t,i)=>e+(t-e)*i;function nD(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+(t-e)*6*i:i<1/2?t:i<2/3?e+(t-e)*(2/3-i)*6:e}function wde({hue:e,saturation:t,lightness:i,alpha:r}){e/=360,t/=100,i/=100;let n=0,s=0,a=0;if(!t)n=s=a=i;else{const o=i<.5?i*(1+t):i+t-i*t,l=2*i-o;n=nD(l,o,e+1/3),s=nD(l,o,e),a=nD(l,o,e-1/3)}return{red:Math.round(n*255),green:Math.round(s*255),blue:Math.round(a*255),alpha:r}}function J2(e,t){return i=>i>0?t:e}const sD=(e,t,i)=>{const r=e*e,n=i*(t*t-r)+r;return n<0?0:Math.sqrt(n)},bde=[TO,Hp,Uv],_de=e=>bde.find(t=>t.test(e));function B6(e){const t=_de(e);if(!t)return!1;let i=t.parse(e);return t===Uv&&(i=wde(i)),i}const F6=(e,t)=>{const i=B6(e),r=B6(t);if(!i||!r)return J2(e,t);const n={...i};return s=>(n.red=sD(i.red,r.red,s),n.green=sD(i.green,r.green,s),n.blue=sD(i.blue,r.blue,s),n.alpha=Nr(i.alpha,r.alpha,s),Hp.transform(n))},Sde=(e,t)=>i=>t(e(i)),Eb=(...e)=>e.reduce(Sde),RO=new Set(["none","hidden"]);function Mde(e,t){return RO.has(e)?i=>i<=0?e:t:i=>i>=1?t:e}function Ede(e,t){return i=>Nr(e,t,i)}function WU(e){return typeof e=="number"?Ede:typeof e=="string"?EU(e)?J2:$s.test(e)?F6:Cde:Array.isArray(e)?HK:typeof e=="object"?$s.test(e)?F6:Ade:J2}function HK(e,t){const i=[...e],r=i.length,n=e.map((s,a)=>WU(s)(s,t[a]));return s=>{for(let a=0;a<r;a++)i[a]=n[a](s);return i}}function Ade(e,t){const i={...e,...t},r={};for(const n in i)e[n]!==void 0&&t[n]!==void 0&&(r[n]=WU(e[n])(e[n],t[n]));return n=>{for(const s in r)i[s]=r[s](n);return i}}function Tde(e,t){var i;const r=[],n={color:0,var:0,number:0};for(let s=0;s<t.values.length;s++){const a=t.types[s],o=e.indexes[a][n[a]],l=(i=e.values[o])!==null&&i!==void 0?i:0;r[s]=l,n[a]++}return r}const Cde=(e,t)=>{const i=mf.createTransformer(t),r=Aw(e),n=Aw(t);return r.indexes.var.length===n.indexes.var.length&&r.indexes.color.length===n.indexes.color.length&&r.indexes.number.length>=n.indexes.number.length?RO.has(e)&&!n.values.length||RO.has(t)&&!r.values.length?Mde(e,t):Eb(HK(Tde(r,n),n.values),i):J2(e,t)};function jK(e,t,i){return typeof e=="number"&&typeof t=="number"&&typeof i=="number"?Nr(e,t,i):WU(e)(e,t)}const Pde=5;function WK(e,t,i){const r=Math.max(t-Pde,0);return yK(i-e(r),t-r)}const Jr={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},aD=.001;function Dde({duration:e=Jr.duration,bounce:t=Jr.bounce,velocity:i=Jr.velocity,mass:r=Jr.mass}){let n,s,a=1-t;a=Ah(Jr.minDamping,Jr.maxDamping,a),e=Ah(Jr.minDuration,Jr.maxDuration,vh(e)),a<1?(n=c=>{const u=c*a,h=u*e,d=u-i,f=IO(c,a),p=Math.exp(-h);return aD-d/f*p},s=c=>{const h=c*a*e,d=h*i+i,f=Math.pow(a,2)*Math.pow(c,2)*e,p=Math.exp(-h),v=IO(Math.pow(c,2),a);return(-n(c)+aD>0?-1:1)*((d-f)*p)/v}):(n=c=>{const u=Math.exp(-c*e),h=(c-i)*e+1;return-aD+u*h},s=c=>{const u=Math.exp(-c*e),h=(i-c)*(e*e);return u*h});const o=5/e,l=Ide(n,s,o);if(e=gh(e),isNaN(l))return{stiffness:Jr.stiffness,damping:Jr.damping,duration:e};{const c=Math.pow(l,2)*r;return{stiffness:c,damping:a*2*Math.sqrt(r*c),duration:e}}}const Rde=12;function Ide(e,t,i){let r=i;for(let n=1;n<Rde;n++)r=r-e(r)/t(r);return r}function IO(e,t){return e*Math.sqrt(1-t*t)}const Lde=["duration","bounce"],Ode=["stiffness","damping","mass"];function U6(e,t){return t.some(i=>e[i]!==void 0)}function zde(e){let t={velocity:Jr.velocity,stiffness:Jr.stiffness,damping:Jr.damping,mass:Jr.mass,isResolvedFromDuration:!1,...e};if(!U6(e,Ode)&&U6(e,Lde))if(e.visualDuration){const i=e.visualDuration,r=2*Math.PI/(i*1.2),n=r*r,s=2*Ah(.05,1,1-(e.bounce||0))*Math.sqrt(n);t={...t,mass:Jr.mass,stiffness:n,damping:s}}else{const i=Dde(e);t={...t,...i,mass:Jr.mass},t.isResolvedFromDuration=!0}return t}function XK(e=Jr.visualDuration,t=Jr.bounce){const i=typeof e!="object"?{visualDuration:e,keyframes:[0,1],bounce:t}:e;let{restSpeed:r,restDelta:n}=i;const s=i.keyframes[0],a=i.keyframes[i.keyframes.length-1],o={done:!1,value:s},{stiffness:l,damping:c,mass:u,duration:h,velocity:d,isResolvedFromDuration:f}=zde({...i,velocity:-vh(i.velocity||0)}),p=d||0,v=c/(2*Math.sqrt(l*u)),m=a-s,g=vh(Math.sqrt(l/u)),y=Math.abs(m)<5;r||(r=y?Jr.restSpeed.granular:Jr.restSpeed.default),n||(n=y?Jr.restDelta.granular:Jr.restDelta.default);let x;if(v<1){const M=IO(g,v);x=S=>{const T=Math.exp(-v*g*S);return a-T*((p+v*g*m)/M*Math.sin(M*S)+m*Math.cos(M*S))}}else if(v===1)x=M=>a-Math.exp(-g*M)*(m+(p+g*m)*M);else{const M=g*Math.sqrt(v*v-1);x=S=>{const T=Math.exp(-v*g*S),E=Math.min(M*S,300);return a-T*((p+v*g*m)*Math.sinh(E)+M*m*Math.cosh(E))/M}}const _={calculatedDuration:f&&h||null,next:M=>{const S=x(M);if(f)o.done=M>=h;else{let T=0;v<1&&(T=M===0?gh(p):WK(x,M,S));const E=Math.abs(T)<=r,C=Math.abs(a-S)<=n;o.done=E&&C}return o.value=o.done?a:S,o},toString:()=>{const M=Math.min(uK(_),MO),S=hK(T=>_.next(M*T).value,M,30);return M+"ms "+S}};return _}function N6({keyframes:e,velocity:t=0,power:i=.8,timeConstant:r=325,bounceDamping:n=10,bounceStiffness:s=500,modifyTarget:a,min:o,max:l,restDelta:c=.5,restSpeed:u}){const h=e[0],d={done:!1,value:h},f=E=>o!==void 0&&E<o||l!==void 0&&E>l,p=E=>o===void 0?l:l===void 0||Math.abs(o-E)<Math.abs(l-E)?o:l;let v=i*t;const m=h+v,g=a===void 0?m:a(m);g!==m&&(v=g-h);const y=E=>-v*Math.exp(-E/r),x=E=>g+y(E),_=E=>{const C=y(E),A=x(E);d.done=Math.abs(C)<=c,d.value=d.done?g:A};let M,S;const T=E=>{f(d.value)&&(M=E,S=XK({keyframes:[d.value,p(d.value)],velocity:WK(x,E,d.value),damping:n,stiffness:s,restDelta:c,restSpeed:u}))};return T(0),{calculatedDuration:null,next:E=>{let C=!1;return!S&&M===void 0&&(C=!0,_(E),T(E)),M!==void 0&&E>=M?S.next(E-M):(!C&&_(E),d)}}}const Bde=Mb(.42,0,1,1),Fde=Mb(0,0,.58,1),qK=Mb(.42,0,.58,1),Ude=e=>Array.isArray(e)&&typeof e[0]!="number",k6={linear:Io,easeIn:Bde,easeInOut:qK,easeOut:Fde,circIn:kU,circInOut:TK,circOut:AK,backIn:NU,backInOut:MK,backOut:SK,anticipate:EK},V6=e=>{if(OU(e)){_O(e.length===4);const[t,i,r,n]=e;return Mb(t,i,r,n)}else if(typeof e=="string")return _O(k6[e]!==void 0),k6[e];return e};function Nde(e,t,i){const r=[],n=i||jK,s=e.length-1;for(let a=0;a<s;a++){let o=n(e[a],e[a+1]);if(t){const l=Array.isArray(t)?t[a]||Io:t;o=Eb(l,o)}r.push(o)}return r}function kde(e,t,{clamp:i=!0,ease:r,mixer:n}={}){const s=e.length;if(_O(s===t.length),s===1)return()=>t[0];if(s===2&&t[0]===t[1])return()=>t[1];const a=e[0]===e[1];e[0]>e[s-1]&&(e=[...e].reverse(),t=[...t].reverse());const o=Nde(t,r,n),l=o.length,c=u=>{if(a&&u<e[0])return t[0];let h=0;if(l>1)for(;h<e.length-2&&!(u<e[h+1]);h++);const d=P0(e[h],e[h+1],u);return o[h](d)};return i?u=>c(Ah(e[0],e[s-1],u)):c}function Vde(e,t){const i=e[e.length-1];for(let r=1;r<=t;r++){const n=P0(0,t,r);e.push(Nr(i,1,n))}}function Gde(e){const t=[0];return Vde(t,e.length-1),t}function Hde(e,t){return e.map(i=>i*t)}function jde(e,t){return e.map(()=>t||qK).splice(0,e.length-1)}function $2({duration:e=300,keyframes:t,times:i,ease:r="easeInOut"}){const n=Ude(r)?r.map(V6):V6(r),s={done:!1,value:t[0]},a=Hde(i&&i.length===t.length?i:Gde(t),e),o=kde(a,t,{ease:Array.isArray(n)?n:jde(t,n)});return{calculatedDuration:e,next:l=>(s.value=o(l),s.done=l>=e,s)}}const Wde=e=>{const t=({timestamp:i})=>e(i);return{start:()=>Pr.update(t,!0),stop:()=>pf(t),now:()=>Ts.isProcessing?Ts.timestamp:Kc.now()}},Xde={decay:N6,inertia:N6,tween:$2,keyframes:$2,spring:XK},qde=e=>e/100;class XU extends GK{constructor(t){super(t),this.holdTime=null,this.cancelTime=null,this.currentTime=0,this.playbackSpeed=1,this.pendingPlayState="running",this.startTime=null,this.state="idle",this.stop=()=>{if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.teardown();const{onStop:l}=this.options;l&&l()};const{name:i,motionValue:r,element:n,keyframes:s}=this.options,a=(n==null?void 0:n.KeyframeResolver)||jU,o=(l,c)=>this.onKeyframesResolved(l,c);this.resolver=new a(s,o,i,r,n),this.resolver.scheduleResolve()}flatten(){super.flatten(),this._resolved&&Object.assign(this._resolved,this.initPlayback(this._resolved.keyframes))}initPlayback(t){const{type:i="keyframes",repeat:r=0,repeatDelay:n=0,repeatType:s,velocity:a=0}=this.options,o=LU(i)?i:Xde[i]||$2;let l,c;o!==$2&&typeof t[0]!="number"&&(l=Eb(qde,jK(t[0],t[1])),t=[0,100]);const u=o({...this.options,keyframes:t});s==="mirror"&&(c=o({...this.options,keyframes:[...t].reverse(),velocity:-a})),u.calculatedDuration===null&&(u.calculatedDuration=uK(u));const{calculatedDuration:h}=u,d=h+n,f=d*(r+1)-n;return{generator:u,mirroredGenerator:c,mapPercentToKeyframes:l,calculatedDuration:h,resolvedDuration:d,totalDuration:f}}onPostResolved(){const{autoplay:t=!0}=this.options;this.play(),this.pendingPlayState==="paused"||!t?this.pause():this.state=this.pendingPlayState}tick(t,i=!1){const{resolved:r}=this;if(!r){const{keyframes:E}=this.options;return{done:!0,value:E[E.length-1]}}const{finalKeyframe:n,generator:s,mirroredGenerator:a,mapPercentToKeyframes:o,keyframes:l,calculatedDuration:c,totalDuration:u,resolvedDuration:h}=r;if(this.startTime===null)return s.next(0);const{delay:d,repeat:f,repeatType:p,repeatDelay:v,onUpdate:m}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,t):this.speed<0&&(this.startTime=Math.min(t-u/this.speed,this.startTime)),i?this.currentTime=t:this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=Math.round(t-this.startTime)*this.speed;const g=this.currentTime-d*(this.speed>=0?1:-1),y=this.speed>=0?g<0:g>u;this.currentTime=Math.max(g,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=u);let x=this.currentTime,_=s;if(f){const E=Math.min(this.currentTime,u)/h;let C=Math.floor(E),A=E%1;!A&&E>=1&&(A=1),A===1&&C--,C=Math.min(C,f+1),!!(C%2)&&(p==="reverse"?(A=1-A,v&&(A-=v/h)):p==="mirror"&&(_=a)),x=Ah(0,1,A)*h}const M=y?{done:!1,value:l[0]}:_.next(x);o&&(M.value=o(M.value));let{done:S}=M;!y&&c!==null&&(S=this.speed>=0?this.currentTime>=u:this.currentTime<=0);const T=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&S);return T&&n!==void 0&&(M.value=_C(l,this.options,n)),m&&m(M.value),T&&this.finish(),M}get duration(){const{resolved:t}=this;return t?vh(t.calculatedDuration):0}get time(){return vh(this.currentTime)}set time(t){t=gh(t),this.currentTime=t,this.holdTime!==null||this.speed===0?this.holdTime=t:this.driver&&(this.startTime=this.driver.now()-t/this.speed)}get speed(){return this.playbackSpeed}set speed(t){const i=this.playbackSpeed!==t;this.playbackSpeed=t,i&&(this.time=vh(this.currentTime))}play(){if(this.resolver.isScheduled||this.resolver.resume(),!this._resolved){this.pendingPlayState="running";return}if(this.isStopped)return;const{driver:t=Wde,onPlay:i,startTime:r}=this.options;this.driver||(this.driver=t(s=>this.tick(s))),i&&i();const n=this.driver.now();this.holdTime!==null?this.startTime=n-this.holdTime:this.startTime?this.state==="finished"&&(this.startTime=n):this.startTime=r??this.calcStartTime(),this.state==="finished"&&this.updateFinishedPromise(),this.cancelTime=this.startTime,this.holdTime=null,this.state="running",this.driver.start()}pause(){var t;if(!this._resolved){this.pendingPlayState="paused";return}this.state="paused",this.holdTime=(t=this.currentTime)!==null&&t!==void 0?t:0}complete(){this.state!=="running"&&this.play(),this.pendingPlayState=this.state="finished",this.holdTime=null}finish(){this.teardown(),this.state="finished";const{onComplete:t}=this.options;t&&t()}cancel(){this.cancelTime!==null&&this.tick(this.cancelTime),this.teardown(),this.updateFinishedPromise()}teardown(){this.state="idle",this.stopDriver(),this.resolveFinishedPromise(),this.updateFinishedPromise(),this.startTime=this.cancelTime=null,this.resolver.cancel()}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(t){return this.startTime=0,this.tick(t,!0)}}const Yde=new Set(["opacity","clipPath","filter","transform"]);function Qde(e,t,i,{delay:r=0,duration:n=300,repeat:s=0,repeatType:a="loop",ease:o="easeInOut",times:l}={}){const c={[t]:i};l&&(c.offset=l);const u=fK(o,n);return Array.isArray(u)&&(c.easing=u),e.animate(c,{delay:r,duration:n,easing:Array.isArray(u)?"linear":u,fill:"both",iterations:s+1,direction:a==="reverse"?"alternate":"normal"})}const Zde=yU(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),eA=10,Kde=2e4;function Jde(e){return LU(e.type)||e.type==="spring"||!dK(e.ease)}function $de(e,t){const i=new XU({...t,keyframes:e,repeat:0,delay:0,isGenerator:!0});let r={done:!1,value:e[0]};const n=[];let s=0;for(;!r.done&&s<Kde;)r=i.sample(s),n.push(r.value),s+=eA;return{times:void 0,keyframes:n,duration:s-eA,ease:"linear"}}const YK={anticipate:EK,backInOut:MK,circInOut:TK};function efe(e){return e in YK}class G6 extends GK{constructor(t){super(t);const{name:i,motionValue:r,element:n,keyframes:s}=this.options;this.resolver=new VK(s,(a,o)=>this.onKeyframesResolved(a,o),i,r,n),this.resolver.scheduleResolve()}initPlayback(t,i){let{duration:r=300,times:n,ease:s,type:a,motionValue:o,name:l,startTime:c}=this.options;if(!o.owner||!o.owner.current)return!1;if(typeof s=="string"&&K2()&&efe(s)&&(s=YK[s]),Jde(this.options)){const{onComplete:h,onUpdate:d,motionValue:f,element:p,...v}=this.options,m=$de(t,v);t=m.keyframes,t.length===1&&(t[1]=t[0]),r=m.duration,n=m.times,s=m.ease,a="keyframes"}const u=Qde(o.owner.current,l,t,{...this.options,duration:r,times:n,ease:s});return u.startTime=c??this.calcStartTime(),this.pendingTimeline?(E6(u,this.pendingTimeline),this.pendingTimeline=void 0):u.onfinish=()=>{const{onComplete:h}=this.options;o.set(_C(t,this.options,i)),h&&h(),this.cancel(),this.resolveFinishedPromise()},{animation:u,duration:r,times:n,type:a,ease:s,keyframes:t}}get duration(){const{resolved:t}=this;if(!t)return 0;const{duration:i}=t;return vh(i)}get time(){const{resolved:t}=this;if(!t)return 0;const{animation:i}=t;return vh(i.currentTime||0)}set time(t){const{resolved:i}=this;if(!i)return;const{animation:r}=i;r.currentTime=gh(t)}get speed(){const{resolved:t}=this;if(!t)return 1;const{animation:i}=t;return i.playbackRate}set speed(t){const{resolved:i}=this;if(!i)return;const{animation:r}=i;r.playbackRate=t}get state(){const{resolved:t}=this;if(!t)return"idle";const{animation:i}=t;return i.playState}get startTime(){const{resolved:t}=this;if(!t)return null;const{animation:i}=t;return i.startTime}attachTimeline(t){if(!this._resolved)this.pendingTimeline=t;else{const{resolved:i}=this;if(!i)return Io;const{animation:r}=i;E6(r,t)}return Io}play(){if(this.isStopped)return;const{resolved:t}=this;if(!t)return;const{animation:i}=t;i.playState==="finished"&&this.updateFinishedPromise(),i.play()}pause(){const{resolved:t}=this;if(!t)return;const{animation:i}=t;i.pause()}stop(){if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.resolveFinishedPromise(),this.updateFinishedPromise();const{resolved:t}=this;if(!t)return;const{animation:i,keyframes:r,duration:n,type:s,ease:a,times:o}=t;if(i.playState==="idle"||i.playState==="finished")return;if(this.time){const{motionValue:c,onUpdate:u,onComplete:h,element:d,...f}=this.options,p=new XU({...f,keyframes:r,duration:n,type:s,ease:a,times:o,isGenerator:!0}),v=gh(this.time);c.setWithVelocity(p.sample(v-eA).value,p.sample(v).value,eA)}const{onStop:l}=this.options;l&&l(),this.cancel()}complete(){const{resolved:t}=this;t&&t.animation.finish()}cancel(){const{resolved:t}=this;t&&t.animation.cancel()}static supports(t){const{motionValue:i,name:r,repeatDelay:n,repeatType:s,damping:a,type:o}=t;if(!i||!i.owner||!(i.owner.current instanceof HTMLElement))return!1;const{onUpdate:l,transformTemplate:c}=i.owner.getProps();return Zde()&&r&&Yde.has(r)&&!l&&!c&&!n&&s!=="mirror"&&a!==0&&o!=="inertia"}}const tfe={type:"spring",stiffness:500,damping:25,restSpeed:10},ife=e=>({type:"spring",stiffness:550,damping:e===0?2*Math.sqrt(550):30,restSpeed:10}),rfe={type:"keyframes",duration:.8},nfe={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},sfe=(e,{keyframes:t})=>t.length>2?rfe:Hm.has(e)?e.startsWith("scale")?ife(t[1]):tfe:nfe;function afe({when:e,delay:t,delayChildren:i,staggerChildren:r,staggerDirection:n,repeat:s,repeatType:a,repeatDelay:o,from:l,elapsed:c,...u}){return!!Object.keys(u).length}const qU=(e,t,i,r={},n,s)=>a=>{const o=IU(r,e)||{},l=o.delay||r.delay||0;let{elapsed:c=0}=r;c=c-gh(l);let u={keyframes:Array.isArray(i)?i:[null,i],ease:"easeOut",velocity:t.getVelocity(),...o,delay:-c,onUpdate:d=>{t.set(d),o.onUpdate&&o.onUpdate(d)},onComplete:()=>{a(),o.onComplete&&o.onComplete()},name:e,motionValue:t,element:s?void 0:n};afe(o)||(u={...u,...sfe(e,u)}),u.duration&&(u.duration=gh(u.duration)),u.repeatDelay&&(u.repeatDelay=gh(u.repeatDelay)),u.from!==void 0&&(u.keyframes[0]=u.from);let h=!1;if((u.type===!1||u.duration===0&&!u.repeatDelay)&&(u.duration=0,u.delay===0&&(h=!0)),h&&!s&&t.get()!==void 0){const d=_C(u.keyframes,o);if(d!==void 0)return Pr.update(()=>{u.onUpdate(d),u.onComplete()}),new Ahe([])}return!s&&G6.supports(u)?new G6(u):new XU(u)};function ofe({protectedKeys:e,needsAnimating:t},i){const r=e.hasOwnProperty(i)&&t[i]!==!0;return t[i]=!1,r}function QK(e,t,{delay:i=0,transitionOverride:r,type:n}={}){var s;let{transition:a=e.getDefaultTransition(),transitionEnd:o,...l}=t;r&&(a=r);const c=[],u=n&&e.animationState&&e.animationState.getState()[n];for(const h in l){const d=e.getValue(h,(s=e.latestValues[h])!==null&&s!==void 0?s:null),f=l[h];if(f===void 0||u&&ofe(u,h))continue;const p={delay:i,...IU(a||{},h)};let v=!1;if(window.MotionHandoffAnimation){const g=xK(e);if(g){const y=window.MotionHandoffAnimation(g,h,Pr);y!==null&&(p.startTime=y,v=!0)}}AO(e,h),d.start(qU(h,d,f,e.shouldReduceMotion&&vK.has(h)?{type:!1}:p,e,v));const m=d.animation;m&&c.push(m)}return o&&Promise.all(c).then(()=>{Pr.update(()=>{o&&khe(e,o)})}),c}function LO(e,t,i={}){var r;const n=bC(e,t,i.type==="exit"?(r=e.presenceContext)===null||r===void 0?void 0:r.custom:void 0);let{transition:s=e.getDefaultTransition()||{}}=n||{};i.transitionOverride&&(s=i.transitionOverride);const a=n?()=>Promise.all(QK(e,n,i)):()=>Promise.resolve(),o=e.variantChildren&&e.variantChildren.size?(c=0)=>{const{delayChildren:u=0,staggerChildren:h,staggerDirection:d}=s;return lfe(e,t,u+c,h,d,i)}:()=>Promise.resolve(),{when:l}=s;if(l){const[c,u]=l==="beforeChildren"?[a,o]:[o,a];return c().then(()=>u())}else return Promise.all([a(),o(i.delay)])}function lfe(e,t,i=0,r=0,n=1,s){const a=[],o=(e.variantChildren.size-1)*r,l=n===1?(c=0)=>c*r:(c=0)=>o-c*r;return Array.from(e.variantChildren).sort(cfe).forEach((c,u)=>{c.notify("AnimationStart",t),a.push(LO(c,t,{...s,delay:i+l(u)}).then(()=>c.notify("AnimationComplete",t)))}),Promise.all(a)}function cfe(e,t){return e.sortNodePosition(t)}function ufe(e,t,i={}){e.notify("AnimationStart",t);let r;if(Array.isArray(t)){const n=t.map(s=>LO(e,s,i));r=Promise.all(n)}else if(typeof t=="string")r=LO(e,t,i);else{const n=typeof t=="function"?bC(e,t,i.custom):t;r=Promise.all(QK(e,n,i))}return r.then(()=>{e.notify("AnimationComplete",t)})}const hfe=wU.length;function ZK(e){if(!e)return;if(!e.isControllingVariants){const i=e.parent?ZK(e.parent)||{}:{};return e.props.initial!==void 0&&(i.initial=e.props.initial),i}const t={};for(let i=0;i<hfe;i++){const r=wU[i],n=e.props[r];(Sw(n)||n===!1)&&(t[r]=n)}return t}const dfe=[...xU].reverse(),ffe=xU.length;function pfe(e){return t=>Promise.all(t.map(({animation:i,options:r})=>ufe(e,i,r)))}function mfe(e){let t=pfe(e),i=H6(),r=!0;const n=l=>(c,u)=>{var h;const d=bC(e,u,l==="exit"?(h=e.presenceContext)===null||h===void 0?void 0:h.custom:void 0);if(d){const{transition:f,transitionEnd:p,...v}=d;c={...c,...v,...p}}return c};function s(l){t=l(e)}function a(l){const{props:c}=e,u=ZK(e.parent)||{},h=[],d=new Set;let f={},p=1/0;for(let m=0;m<ffe;m++){const g=dfe[m],y=i[g],x=c[g]!==void 0?c[g]:u[g],_=Sw(x),M=g===l?y.isActive:null;M===!1&&(p=m);let S=x===u[g]&&x!==c[g]&&_;if(S&&r&&e.manuallyAnimateOnMount&&(S=!1),y.protectedKeys={...f},!y.isActive&&M===null||!x&&!y.prevProp||xC(x)||typeof x=="boolean")continue;const T=gfe(y.prevProp,x);let E=T||g===l&&y.isActive&&!S&&_||m>p&&_,C=!1;const A=Array.isArray(x)?x:[x];let D=A.reduce(n(g),{});M===!1&&(D={});const{prevResolvedValues:R={}}=y,L={...R,...D},O=Y=>{E=!0,d.has(Y)&&(C=!0,d.delete(Y)),y.needsAnimating[Y]=!0;const z=e.getValue(Y);z&&(z.liveStyle=!1)};for(const Y in L){const z=D[Y],V=R[Y];if(f.hasOwnProperty(Y))continue;let U=!1;SO(z)&&SO(V)?U=!cK(z,V):U=z!==V,U?z!=null?O(Y):d.add(Y):z!==void 0&&d.has(Y)?O(Y):y.protectedKeys[Y]=!0}y.prevProp=x,y.prevResolvedValues=D,y.isActive&&(f={...f,...D}),r&&e.blockInitialAnimation&&(E=!1),E&&(!(S&&T)||C)&&h.push(...A.map(Y=>({animation:Y,options:{type:g}})))}if(d.size){const m={};d.forEach(g=>{const y=e.getBaseTarget(g),x=e.getValue(g);x&&(x.liveStyle=!0),m[g]=y??null}),h.push({animation:m})}let v=!!h.length;return r&&(c.initial===!1||c.initial===c.animate)&&!e.manuallyAnimateOnMount&&(v=!1),r=!1,v?t(h):Promise.resolve()}function o(l,c){var u;if(i[l].isActive===c)return Promise.resolve();(u=e.variantChildren)===null||u===void 0||u.forEach(d=>{var f;return(f=d.animationState)===null||f===void 0?void 0:f.setActive(l,c)}),i[l].isActive=c;const h=a(l);for(const d in i)i[d].protectedKeys={};return h}return{animateChanges:a,setActive:o,setAnimateFunction:s,getState:()=>i,reset:()=>{i=H6(),r=!0}}}function gfe(e,t){return typeof t=="string"?t!==e:Array.isArray(t)?!cK(t,e):!1}function Qf(e=!1){return{isActive:e,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function H6(){return{animate:Qf(!0),whileInView:Qf(),whileHover:Qf(),whileTap:Qf(),whileDrag:Qf(),whileFocus:Qf(),exit:Qf()}}class Ef{constructor(t){this.isMounted=!1,this.node=t}update(){}}class vfe extends Ef{constructor(t){super(t),t.animationState||(t.animationState=mfe(t))}updateAnimationControlsSubscription(){const{animate:t}=this.node.getProps();xC(t)&&(this.unmountControls=t.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:t}=this.node.getProps(),{animate:i}=this.node.prevProps||{};t!==i&&this.updateAnimationControlsSubscription()}unmount(){var t;this.node.animationState.reset(),(t=this.unmountControls)===null||t===void 0||t.call(this)}}let yfe=0;class xfe extends Ef{constructor(){super(...arguments),this.id=yfe++}update(){if(!this.node.presenceContext)return;const{isPresent:t,onExitComplete:i}=this.node.presenceContext,{isPresent:r}=this.node.prevPresenceContext||{};if(!this.node.animationState||t===r)return;const n=this.node.animationState.setActive("exit",!t);i&&!t&&n.then(()=>i(this.id))}mount(){const{register:t}=this.node.presenceContext||{};t&&(this.unmount=t(this.id))}unmount(){}}const wfe={animation:{Feature:vfe},exit:{Feature:xfe}};function Tw(e,t,i,r={passive:!0}){return e.addEventListener(t,i,r),()=>e.removeEventListener(t,i)}function Ab(e){return{point:{x:e.pageX,y:e.pageY}}}const bfe=e=>t=>zU(t)&&e(t,Ab(t));function Ax(e,t,i,r){return Tw(e,t,bfe(i),r)}const j6=(e,t)=>Math.abs(e-t);function _fe(e,t){const i=j6(e.x,t.x),r=j6(e.y,t.y);return Math.sqrt(i**2+r**2)}class KK{constructor(t,i,{transformPagePoint:r,contextWindow:n,dragSnapToOrigin:s=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const h=lD(this.lastMoveEventInfo,this.history),d=this.startEvent!==null,f=_fe(h.offset,{x:0,y:0})>=3;if(!d&&!f)return;const{point:p}=h,{timestamp:v}=Ts;this.history.push({...p,timestamp:v});const{onStart:m,onMove:g}=this.handlers;d||(m&&m(this.lastMoveEvent,h),this.startEvent=this.lastMoveEvent),g&&g(this.lastMoveEvent,h)},this.handlePointerMove=(h,d)=>{this.lastMoveEvent=h,this.lastMoveEventInfo=oD(d,this.transformPagePoint),Pr.update(this.updatePoint,!0)},this.handlePointerUp=(h,d)=>{this.end();const{onEnd:f,onSessionEnd:p,resumeAnimation:v}=this.handlers;if(this.dragSnapToOrigin&&v&&v(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const m=lD(h.type==="pointercancel"?this.lastMoveEventInfo:oD(d,this.transformPagePoint),this.history);this.startEvent&&f&&f(h,m),p&&p(h,m)},!zU(t))return;this.dragSnapToOrigin=s,this.handlers=i,this.transformPagePoint=r,this.contextWindow=n||window;const a=Ab(t),o=oD(a,this.transformPagePoint),{point:l}=o,{timestamp:c}=Ts;this.history=[{...l,timestamp:c}];const{onSessionStart:u}=i;u&&u(t,lD(o,this.history)),this.removeListeners=Eb(Ax(this.contextWindow,"pointermove",this.handlePointerMove),Ax(this.contextWindow,"pointerup",this.handlePointerUp),Ax(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(t){this.handlers=t}end(){this.removeListeners&&this.removeListeners(),pf(this.updatePoint)}}function oD(e,t){return t?{point:t(e.point)}:e}function W6(e,t){return{x:e.x-t.x,y:e.y-t.y}}function lD({point:e},t){return{point:e,delta:W6(e,JK(t)),offset:W6(e,Sfe(t)),velocity:Mfe(t,.1)}}function Sfe(e){return e[0]}function JK(e){return e[e.length-1]}function Mfe(e,t){if(e.length<2)return{x:0,y:0};let i=e.length-1,r=null;const n=JK(e);for(;i>=0&&(r=e[i],!(n.timestamp-r.timestamp>gh(t)));)i--;if(!r)return{x:0,y:0};const s=vh(n.timestamp-r.timestamp);if(s===0)return{x:0,y:0};const a={x:(n.x-r.x)/s,y:(n.y-r.y)/s};return a.x===1/0&&(a.x=0),a.y===1/0&&(a.y=0),a}const $K=1e-4,Efe=1-$K,Afe=1+$K,eJ=.01,Tfe=0-eJ,Cfe=0+eJ;function zo(e){return e.max-e.min}function Pfe(e,t,i){return Math.abs(e-t)<=i}function X6(e,t,i,r=.5){e.origin=r,e.originPoint=Nr(t.min,t.max,e.origin),e.scale=zo(i)/zo(t),e.translate=Nr(i.min,i.max,e.origin)-e.originPoint,(e.scale>=Efe&&e.scale<=Afe||isNaN(e.scale))&&(e.scale=1),(e.translate>=Tfe&&e.translate<=Cfe||isNaN(e.translate))&&(e.translate=0)}function Tx(e,t,i,r){X6(e.x,t.x,i.x,r?r.originX:void 0),X6(e.y,t.y,i.y,r?r.originY:void 0)}function q6(e,t,i){e.min=i.min+t.min,e.max=e.min+zo(t)}function Dfe(e,t,i){q6(e.x,t.x,i.x),q6(e.y,t.y,i.y)}function Y6(e,t,i){e.min=t.min-i.min,e.max=e.min+zo(t)}function Cx(e,t,i){Y6(e.x,t.x,i.x),Y6(e.y,t.y,i.y)}function Rfe(e,{min:t,max:i},r){return t!==void 0&&e<t?e=r?Nr(t,e,r.min):Math.max(e,t):i!==void 0&&e>i&&(e=r?Nr(i,e,r.max):Math.min(e,i)),e}function Q6(e,t,i){return{min:t!==void 0?e.min+t:void 0,max:i!==void 0?e.max+i-(e.max-e.min):void 0}}function Ife(e,{top:t,left:i,bottom:r,right:n}){return{x:Q6(e.x,i,n),y:Q6(e.y,t,r)}}function Z6(e,t){let i=t.min-e.min,r=t.max-e.max;return t.max-t.min<e.max-e.min&&([i,r]=[r,i]),{min:i,max:r}}function Lfe(e,t){return{x:Z6(e.x,t.x),y:Z6(e.y,t.y)}}function Ofe(e,t){let i=.5;const r=zo(e),n=zo(t);return n>r?i=P0(t.min,t.max-r,e.min):r>n&&(i=P0(e.min,e.max-n,t.min)),Ah(0,1,i)}function zfe(e,t){const i={};return t.min!==void 0&&(i.min=t.min-e.min),t.max!==void 0&&(i.max=t.max-e.min),i}const OO=.35;function Bfe(e=OO){return e===!1?e=0:e===!0&&(e=OO),{x:K6(e,"left","right"),y:K6(e,"top","bottom")}}function K6(e,t,i){return{min:J6(e,t),max:J6(e,i)}}function J6(e,t){return typeof e=="number"?e:e[t]||0}const $6=()=>({translate:0,scale:1,origin:0,originPoint:0}),Nv=()=>({x:$6(),y:$6()}),eG=()=>({min:0,max:0}),hn=()=>({x:eG(),y:eG()});function rl(e){return[e("x"),e("y")]}function tJ({top:e,left:t,right:i,bottom:r}){return{x:{min:t,max:i},y:{min:e,max:r}}}function Ffe({x:e,y:t}){return{top:t.min,right:e.max,bottom:t.max,left:e.min}}function Ufe(e,t){if(!t)return e;const i=t({x:e.left,y:e.top}),r=t({x:e.right,y:e.bottom});return{top:i.y,left:i.x,bottom:r.y,right:r.x}}function cD(e){return e===void 0||e===1}function zO({scale:e,scaleX:t,scaleY:i}){return!cD(e)||!cD(t)||!cD(i)}function _p(e){return zO(e)||iJ(e)||e.z||e.rotate||e.rotateX||e.rotateY||e.skewX||e.skewY}function iJ(e){return tG(e.x)||tG(e.y)}function tG(e){return e&&e!=="0%"}function tA(e,t,i){const r=e-i,n=t*r;return i+n}function iG(e,t,i,r,n){return n!==void 0&&(e=tA(e,n,r)),tA(e,i,r)+t}function BO(e,t=0,i=1,r,n){e.min=iG(e.min,t,i,r,n),e.max=iG(e.max,t,i,r,n)}function rJ(e,{x:t,y:i}){BO(e.x,t.translate,t.scale,t.originPoint),BO(e.y,i.translate,i.scale,i.originPoint)}const rG=.999999999999,nG=1.0000000000001;function Nfe(e,t,i,r=!1){const n=i.length;if(!n)return;t.x=t.y=1;let s,a;for(let o=0;o<n;o++){s=i[o],a=s.projectionDelta;const{visualElement:l}=s.options;l&&l.props.style&&l.props.style.display==="contents"||(r&&s.options.layoutScroll&&s.scroll&&s!==s.root&&Vv(e,{x:-s.scroll.offset.x,y:-s.scroll.offset.y}),a&&(t.x*=a.x.scale,t.y*=a.y.scale,rJ(e,a)),r&&_p(s.latestValues)&&Vv(e,s.latestValues))}t.x<nG&&t.x>rG&&(t.x=1),t.y<nG&&t.y>rG&&(t.y=1)}function kv(e,t){e.min=e.min+t,e.max=e.max+t}function sG(e,t,i,r,n=.5){const s=Nr(e.min,e.max,n);BO(e,t,i,s,r)}function Vv(e,t){sG(e.x,t.x,t.scaleX,t.scale,t.originX),sG(e.y,t.y,t.scaleY,t.scale,t.originY)}function nJ(e,t){return tJ(Ufe(e.getBoundingClientRect(),t))}function kfe(e,t,i){const r=nJ(e,i),{scroll:n}=t;return n&&(kv(r.x,n.offset.x),kv(r.y,n.offset.y)),r}const sJ=({current:e})=>e?e.ownerDocument.defaultView:null,Vfe=new WeakMap;class Gfe{constructor(t){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=hn(),this.visualElement=t}start(t,{snapToCursor:i=!1}={}){const{presenceContext:r}=this.visualElement;if(r&&r.isPresent===!1)return;const n=u=>{const{dragSnapToOrigin:h}=this.getProps();h?this.pauseAnimation():this.stopAnimation(),i&&this.snapToCursor(Ab(u).point)},s=(u,h)=>{const{drag:d,dragPropagation:f,onDragStart:p}=this.getProps();if(d&&!f&&(this.openDragLock&&this.openDragLock(),this.openDragLock=zhe(d),!this.openDragLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),rl(m=>{let g=this.getAxisMotionValue(m).get()||0;if(Zc.test(g)){const{projection:y}=this.visualElement;if(y&&y.layout){const x=y.layout.layoutBox[m];x&&(g=zo(x)*(parseFloat(g)/100))}}this.originPoint[m]=g}),p&&Pr.postRender(()=>p(u,h)),AO(this.visualElement,"transform");const{animationState:v}=this.visualElement;v&&v.setActive("whileDrag",!0)},a=(u,h)=>{const{dragPropagation:d,dragDirectionLock:f,onDirectionLock:p,onDrag:v}=this.getProps();if(!d&&!this.openDragLock)return;const{offset:m}=h;if(f&&this.currentDirection===null){this.currentDirection=Hfe(m),this.currentDirection!==null&&p&&p(this.currentDirection);return}this.updateAxis("x",h.point,m),this.updateAxis("y",h.point,m),this.visualElement.render(),v&&v(u,h)},o=(u,h)=>this.stop(u,h),l=()=>rl(u=>{var h;return this.getAnimationState(u)==="paused"&&((h=this.getAxisMotionValue(u).animation)===null||h===void 0?void 0:h.play())}),{dragSnapToOrigin:c}=this.getProps();this.panSession=new KK(t,{onSessionStart:n,onStart:s,onMove:a,onSessionEnd:o,resumeAnimation:l},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:c,contextWindow:sJ(this.visualElement)})}stop(t,i){const r=this.isDragging;if(this.cancel(),!r)return;const{velocity:n}=i;this.startAnimation(n);const{onDragEnd:s}=this.getProps();s&&Pr.postRender(()=>s(t,i))}cancel(){this.isDragging=!1;const{projection:t,animationState:i}=this.visualElement;t&&(t.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:r}=this.getProps();!r&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),i&&i.setActive("whileDrag",!1)}updateAxis(t,i,r){const{drag:n}=this.getProps();if(!r||!dS(t,n,this.currentDirection))return;const s=this.getAxisMotionValue(t);let a=this.originPoint[t]+r[t];this.constraints&&this.constraints[t]&&(a=Rfe(a,this.constraints[t],this.elastic[t])),s.set(a)}resolveConstraints(){var t;const{dragConstraints:i,dragElastic:r}=this.getProps(),n=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(t=this.visualElement.projection)===null||t===void 0?void 0:t.layout,s=this.constraints;i&&Fv(i)?this.constraints||(this.constraints=this.resolveRefConstraints()):i&&n?this.constraints=Ife(n.layoutBox,i):this.constraints=!1,this.elastic=Bfe(r),s!==this.constraints&&n&&this.constraints&&!this.hasMutatedConstraints&&rl(a=>{this.constraints!==!1&&this.getAxisMotionValue(a)&&(this.constraints[a]=zfe(n.layoutBox[a],this.constraints[a]))})}resolveRefConstraints(){const{dragConstraints:t,onMeasureDragConstraints:i}=this.getProps();if(!t||!Fv(t))return!1;const r=t.current,{projection:n}=this.visualElement;if(!n||!n.layout)return!1;const s=kfe(r,n.root,this.visualElement.getTransformPagePoint());let a=Lfe(n.layout.layoutBox,s);if(i){const o=i(Ffe(a));this.hasMutatedConstraints=!!o,o&&(a=tJ(o))}return a}startAnimation(t){const{drag:i,dragMomentum:r,dragElastic:n,dragTransition:s,dragSnapToOrigin:a,onDragTransitionEnd:o}=this.getProps(),l=this.constraints||{},c=rl(u=>{if(!dS(u,i,this.currentDirection))return;let h=l&&l[u]||{};a&&(h={min:0,max:0});const d=n?200:1e6,f=n?40:1e7,p={type:"inertia",velocity:r?t[u]:0,bounceStiffness:d,bounceDamping:f,timeConstant:750,restDelta:1,restSpeed:10,...s,...h};return this.startAxisValueAnimation(u,p)});return Promise.all(c).then(o)}startAxisValueAnimation(t,i){const r=this.getAxisMotionValue(t);return AO(this.visualElement,t),r.start(qU(t,r,0,i,this.visualElement,!1))}stopAnimation(){rl(t=>this.getAxisMotionValue(t).stop())}pauseAnimation(){rl(t=>{var i;return(i=this.getAxisMotionValue(t).animation)===null||i===void 0?void 0:i.pause()})}getAnimationState(t){var i;return(i=this.getAxisMotionValue(t).animation)===null||i===void 0?void 0:i.state}getAxisMotionValue(t){const i=`_drag${t.toUpperCase()}`,r=this.visualElement.getProps(),n=r[i];return n||this.visualElement.getValue(t,(r.initial?r.initial[t]:void 0)||0)}snapToCursor(t){rl(i=>{const{drag:r}=this.getProps();if(!dS(i,r,this.currentDirection))return;const{projection:n}=this.visualElement,s=this.getAxisMotionValue(i);if(n&&n.layout){const{min:a,max:o}=n.layout.layoutBox[i];s.set(t[i]-Nr(a,o,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:t,dragConstraints:i}=this.getProps(),{projection:r}=this.visualElement;if(!Fv(i)||!r||!this.constraints)return;this.stopAnimation();const n={x:0,y:0};rl(a=>{const o=this.getAxisMotionValue(a);if(o&&this.constraints!==!1){const l=o.get();n[a]=Ofe({min:l,max:l},this.constraints[a])}});const{transformTemplate:s}=this.visualElement.getProps();this.visualElement.current.style.transform=s?s({},""):"none",r.root&&r.root.updateScroll(),r.updateLayout(),this.resolveConstraints(),rl(a=>{if(!dS(a,t,null))return;const o=this.getAxisMotionValue(a),{min:l,max:c}=this.constraints[a];o.set(Nr(l,c,n[a]))})}addListeners(){if(!this.visualElement.current)return;Vfe.set(this.visualElement,this);const t=this.visualElement.current,i=Ax(t,"pointerdown",l=>{const{drag:c,dragListener:u=!0}=this.getProps();c&&u&&this.start(l)}),r=()=>{const{dragConstraints:l}=this.getProps();Fv(l)&&l.current&&(this.constraints=this.resolveRefConstraints())},{projection:n}=this.visualElement,s=n.addEventListener("measure",r);n&&!n.layout&&(n.root&&n.root.updateScroll(),n.updateLayout()),Pr.read(r);const a=Tw(window,"resize",()=>this.scalePositionWithinConstraints()),o=n.addEventListener("didUpdate",({delta:l,hasLayoutChanged:c})=>{this.isDragging&&c&&(rl(u=>{const h=this.getAxisMotionValue(u);h&&(this.originPoint[u]+=l[u].translate,h.set(h.get()+l[u].translate))}),this.visualElement.render())});return()=>{a(),i(),s(),o&&o()}}getProps(){const t=this.visualElement.getProps(),{drag:i=!1,dragDirectionLock:r=!1,dragPropagation:n=!1,dragConstraints:s=!1,dragElastic:a=OO,dragMomentum:o=!0}=t;return{...t,drag:i,dragDirectionLock:r,dragPropagation:n,dragConstraints:s,dragElastic:a,dragMomentum:o}}}function dS(e,t,i){return(t===!0||t===e)&&(i===null||i===e)}function Hfe(e,t=10){let i=null;return Math.abs(e.y)>t?i="y":Math.abs(e.x)>t&&(i="x"),i}class jfe extends Ef{constructor(t){super(t),this.removeGroupControls=Io,this.removeListeners=Io,this.controls=new Gfe(t)}mount(){const{dragControls:t}=this.node.getProps();t&&(this.removeGroupControls=t.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Io}unmount(){this.removeGroupControls(),this.removeListeners()}}const aG=e=>(t,i)=>{e&&Pr.postRender(()=>e(t,i))};class Wfe extends Ef{constructor(){super(...arguments),this.removePointerDownListener=Io}onPointerDown(t){this.session=new KK(t,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:sJ(this.node)})}createPanHandlers(){const{onPanSessionStart:t,onPanStart:i,onPan:r,onPanEnd:n}=this.node.getProps();return{onSessionStart:aG(t),onStart:aG(i),onMove:r,onEnd:(s,a)=>{delete this.session,n&&Pr.postRender(()=>n(s,a))}}}mount(){this.removePointerDownListener=Ax(this.node.current,"pointerdown",t=>this.onPointerDown(t))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const ZE={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function oG(e,t){return t.max===t.min?0:e/(t.max-t.min)*100}const n1={correct:(e,t)=>{if(!t.target)return e;if(typeof e=="string")if(oi.test(e))e=parseFloat(e);else return e;const i=oG(e,t.target.x),r=oG(e,t.target.y);return`${i}% ${r}%`}},Xfe={correct:(e,{treeScale:t,projectionDelta:i})=>{const r=e,n=mf.parse(e);if(n.length>5)return r;const s=mf.createTransformer(e),a=typeof n[0]!="number"?1:0,o=i.x.scale*t.x,l=i.y.scale*t.y;n[0+a]/=o,n[1+a]/=l;const c=Nr(o,l,.5);return typeof n[2+a]=="number"&&(n[2+a]/=c),typeof n[3+a]=="number"&&(n[3+a]/=c),s(n)}};class qfe extends _e.Component{componentDidMount(){const{visualElement:t,layoutGroup:i,switchLayoutGroup:r,layoutId:n}=this.props,{projection:s}=t;phe(Yfe),s&&(i.group&&i.group.add(s),r&&r.register&&n&&r.register(s),s.root.didUpdate(),s.addEventListener("animationComplete",()=>{this.safeToRemove()}),s.setOptions({...s.options,onExitComplete:()=>this.safeToRemove()})),ZE.hasEverUpdated=!0}getSnapshotBeforeUpdate(t){const{layoutDependency:i,visualElement:r,drag:n,isPresent:s}=this.props,a=r.projection;return a&&(a.isPresent=s,n||t.layoutDependency!==i||i===void 0?a.willUpdate():this.safeToRemove(),t.isPresent!==s&&(s?a.promote():a.relegate()||Pr.postRender(()=>{const o=a.getStack();(!o||!o.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:t}=this.props.visualElement;t&&(t.root.didUpdate(),_U.postRender(()=>{!t.currentAnimation&&t.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:t,layoutGroup:i,switchLayoutGroup:r}=this.props,{projection:n}=t;n&&(n.scheduleCheckAfterUnmount(),i&&i.group&&i.group.remove(n),r&&r.deregister&&r.deregister(n))}safeToRemove(){const{safeToRemove:t}=this.props;t&&t()}render(){return null}}function aJ(e){const[t,i]=HZ(),r=_e.useContext(fU);return Te.jsx(qfe,{...e,layoutGroup:r,switchLayoutGroup:_e.useContext(ZZ),isPresent:t,safeToRemove:i})}const Yfe={borderRadius:{...n1,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:n1,borderTopRightRadius:n1,borderBottomLeftRadius:n1,borderBottomRightRadius:n1,boxShadow:Xfe};function Qfe(e,t,i){const r=ra(e)?e:Ew(e);return r.start(qU("",r,t,i)),r.animation}function Zfe(e){return e instanceof SVGElement&&e.tagName!=="svg"}const Kfe=(e,t)=>e.depth-t.depth;class Jfe{constructor(){this.children=[],this.isDirty=!1}add(t){BU(this.children,t),this.isDirty=!0}remove(t){FU(this.children,t),this.isDirty=!0}forEach(t){this.isDirty&&this.children.sort(Kfe),this.isDirty=!1,this.children.forEach(t)}}function $fe(e,t){const i=Kc.now(),r=({timestamp:n})=>{const s=n-i;s>=t&&(pf(r),e(s-t))};return Pr.read(r,!0),()=>pf(r)}const oJ=["TopLeft","TopRight","BottomLeft","BottomRight"],epe=oJ.length,lG=e=>typeof e=="string"?parseFloat(e):e,cG=e=>typeof e=="number"||oi.test(e);function tpe(e,t,i,r,n,s){n?(e.opacity=Nr(0,i.opacity!==void 0?i.opacity:1,ipe(r)),e.opacityExit=Nr(t.opacity!==void 0?t.opacity:1,0,rpe(r))):s&&(e.opacity=Nr(t.opacity!==void 0?t.opacity:1,i.opacity!==void 0?i.opacity:1,r));for(let a=0;a<epe;a++){const o=`border${oJ[a]}Radius`;let l=uG(t,o),c=uG(i,o);if(l===void 0&&c===void 0)continue;l||(l=0),c||(c=0),l===0||c===0||cG(l)===cG(c)?(e[o]=Math.max(Nr(lG(l),lG(c),r),0),(Zc.test(c)||Zc.test(l))&&(e[o]+="%")):e[o]=c}(t.rotate||i.rotate)&&(e.rotate=Nr(t.rotate||0,i.rotate||0,r))}function uG(e,t){return e[t]!==void 0?e[t]:e.borderRadius}const ipe=lJ(0,.5,AK),rpe=lJ(.5,.95,Io);function lJ(e,t,i){return r=>r<e?0:r>t?1:i(P0(e,t,r))}function hG(e,t){e.min=t.min,e.max=t.max}function Qo(e,t){hG(e.x,t.x),hG(e.y,t.y)}function dG(e,t){e.translate=t.translate,e.scale=t.scale,e.originPoint=t.originPoint,e.origin=t.origin}function fG(e,t,i,r,n){return e-=t,e=tA(e,1/i,r),n!==void 0&&(e=tA(e,1/n,r)),e}function npe(e,t=0,i=1,r=.5,n,s=e,a=e){if(Zc.test(t)&&(t=parseFloat(t),t=Nr(a.min,a.max,t/100)-a.min),typeof t!="number")return;let o=Nr(s.min,s.max,r);e===s&&(o-=t),e.min=fG(e.min,t,i,o,n),e.max=fG(e.max,t,i,o,n)}function pG(e,t,[i,r,n],s,a){npe(e,t[i],t[r],t[n],t.scale,s,a)}const spe=["x","scaleX","originX"],ape=["y","scaleY","originY"];function mG(e,t,i,r){pG(e.x,t,spe,i?i.x:void 0,r?r.x:void 0),pG(e.y,t,ape,i?i.y:void 0,r?r.y:void 0)}function gG(e){return e.translate===0&&e.scale===1}function cJ(e){return gG(e.x)&&gG(e.y)}function vG(e,t){return e.min===t.min&&e.max===t.max}function ope(e,t){return vG(e.x,t.x)&&vG(e.y,t.y)}function yG(e,t){return Math.round(e.min)===Math.round(t.min)&&Math.round(e.max)===Math.round(t.max)}function uJ(e,t){return yG(e.x,t.x)&&yG(e.y,t.y)}function xG(e){return zo(e.x)/zo(e.y)}function wG(e,t){return e.translate===t.translate&&e.scale===t.scale&&e.originPoint===t.originPoint}class lpe{constructor(){this.members=[]}add(t){BU(this.members,t),t.scheduleRender()}remove(t){if(FU(this.members,t),t===this.prevLead&&(this.prevLead=void 0),t===this.lead){const i=this.members[this.members.length-1];i&&this.promote(i)}}relegate(t){const i=this.members.findIndex(n=>t===n);if(i===0)return!1;let r;for(let n=i;n>=0;n--){const s=this.members[n];if(s.isPresent!==!1){r=s;break}}return r?(this.promote(r),!0):!1}promote(t,i){const r=this.lead;if(t!==r&&(this.prevLead=r,this.lead=t,t.show(),r)){r.instance&&r.scheduleRender(),t.scheduleRender(),t.resumeFrom=r,i&&(t.resumeFrom.preserveOpacity=!0),r.snapshot&&(t.snapshot=r.snapshot,t.snapshot.latestValues=r.animationValues||r.latestValues),t.root&&t.root.isUpdating&&(t.isLayoutDirty=!0);const{crossfade:n}=t.options;n===!1&&r.hide()}}exitAnimationComplete(){this.members.forEach(t=>{const{options:i,resumingFrom:r}=t;i.onExitComplete&&i.onExitComplete(),r&&r.options.onExitComplete&&r.options.onExitComplete()})}scheduleRender(){this.members.forEach(t=>{t.instance&&t.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function cpe(e,t,i){let r="";const n=e.x.translate/t.x,s=e.y.translate/t.y,a=(i==null?void 0:i.z)||0;if((n||s||a)&&(r=`translate3d(${n}px, ${s}px, ${a}px) `),(t.x!==1||t.y!==1)&&(r+=`scale(${1/t.x}, ${1/t.y}) `),i){const{transformPerspective:c,rotate:u,rotateX:h,rotateY:d,skewX:f,skewY:p}=i;c&&(r=`perspective(${c}px) ${r}`),u&&(r+=`rotate(${u}deg) `),h&&(r+=`rotateX(${h}deg) `),d&&(r+=`rotateY(${d}deg) `),f&&(r+=`skewX(${f}deg) `),p&&(r+=`skewY(${p}deg) `)}const o=e.x.scale*t.x,l=e.y.scale*t.y;return(o!==1||l!==1)&&(r+=`scale(${o}, ${l})`),r||"none"}const Sp={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0},ix=typeof window<"u"&&window.MotionDebug!==void 0,uD=["","X","Y","Z"],upe={visibility:"hidden"},bG=1e3;let hpe=0;function hD(e,t,i,r){const{latestValues:n}=t;n[e]&&(i[e]=n[e],t.setStaticValue(e,0),r&&(r[e]=0))}function hJ(e){if(e.hasCheckedOptimisedAppear=!0,e.root===e)return;const{visualElement:t}=e.options;if(!t)return;const i=xK(t);if(window.MotionHasOptimisedAnimation(i,"transform")){const{layout:n,layoutId:s}=e.options;window.MotionCancelOptimisedAnimation(i,"transform",Pr,!(n||s))}const{parent:r}=e;r&&!r.hasCheckedOptimisedAppear&&hJ(r)}function dJ({attachResizeListener:e,defaultParent:t,measureScroll:i,checkIsScrollRoot:r,resetTransform:n}){return class{constructor(a={},o=t==null?void 0:t()){this.id=hpe++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,ix&&(Sp.totalNodes=Sp.resolvedTargetDeltas=Sp.recalculatedProjection=0),this.nodes.forEach(ppe),this.nodes.forEach(xpe),this.nodes.forEach(wpe),this.nodes.forEach(mpe),ix&&window.MotionDebug.record(Sp)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=a,this.root=o?o.root||o:this,this.path=o?[...o.path,o]:[],this.parent=o,this.depth=o?o.depth+1:0;for(let l=0;l<this.path.length;l++)this.path[l].shouldResetTransform=!0;this.root===this&&(this.nodes=new Jfe)}addEventListener(a,o){return this.eventHandlers.has(a)||this.eventHandlers.set(a,new UU),this.eventHandlers.get(a).add(o)}notifyListeners(a,...o){const l=this.eventHandlers.get(a);l&&l.notify(...o)}hasListeners(a){return this.eventHandlers.has(a)}mount(a,o=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=Zfe(a),this.instance=a;const{layoutId:l,layout:c,visualElement:u}=this.options;if(u&&!u.current&&u.mount(a),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),o&&(c||l)&&(this.isLayoutDirty=!0),e){let h;const d=()=>this.root.updateBlockedByResize=!1;e(a,()=>{this.root.updateBlockedByResize=!0,h&&h(),h=$fe(d,250),ZE.hasAnimatedSinceResize&&(ZE.hasAnimatedSinceResize=!1,this.nodes.forEach(SG))})}l&&this.root.registerSharedNode(l,this),this.options.animate!==!1&&u&&(l||c)&&this.addEventListener("didUpdate",({delta:h,hasLayoutChanged:d,hasRelativeTargetChanged:f,layout:p})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const v=this.options.transition||u.getDefaultTransition()||Epe,{onLayoutAnimationStart:m,onLayoutAnimationComplete:g}=u.getProps(),y=!this.targetLayout||!uJ(this.targetLayout,p)||f,x=!d&&f;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||x||d&&(y||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(h,x);const _={...IU(v,"layout"),onPlay:m,onComplete:g};(u.shouldReduceMotion||this.options.layoutRoot)&&(_.delay=0,_.type=!1),this.startAnimation(_)}else d||SG(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=p})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const a=this.getStack();a&&a.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,pf(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(bpe),this.animationId++)}getTransformTemplate(){const{visualElement:a}=this.options;return a&&a.getProps().transformTemplate}willUpdate(a=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&hJ(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let u=0;u<this.path.length;u++){const h=this.path[u];h.shouldResetTransform=!0,h.updateScroll("snapshot"),h.options.layoutRoot&&h.willUpdate(!1)}const{layoutId:o,layout:l}=this.options;if(o===void 0&&!l)return;const c=this.getTransformTemplate();this.prevTransformTemplateValue=c?c(this.latestValues,""):void 0,this.updateSnapshot(),a&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(_G);return}this.isUpdating||this.nodes.forEach(vpe),this.isUpdating=!1,this.nodes.forEach(ype),this.nodes.forEach(dpe),this.nodes.forEach(fpe),this.clearAllSnapshots();const o=Kc.now();Ts.delta=Ah(0,1e3/60,o-Ts.timestamp),Ts.timestamp=o,Ts.isProcessing=!0,tD.update.process(Ts),tD.preRender.process(Ts),tD.render.process(Ts),Ts.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,_U.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(gpe),this.sharedNodes.forEach(_pe)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Pr.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Pr.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let l=0;l<this.path.length;l++)this.path[l].updateScroll();const a=this.layout;this.layout=this.measure(!1),this.layoutCorrected=hn(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:o}=this.options;o&&o.notify("LayoutMeasure",this.layout.layoutBox,a?a.layoutBox:void 0)}updateScroll(a="measure"){let o=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===a&&(o=!1),o){const l=r(this.instance);this.scroll={animationId:this.root.animationId,phase:a,isRoot:l,offset:i(this.instance),wasRoot:this.scroll?this.scroll.isRoot:l}}}resetTransform(){if(!n)return;const a=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,o=this.projectionDelta&&!cJ(this.projectionDelta),l=this.getTransformTemplate(),c=l?l(this.latestValues,""):void 0,u=c!==this.prevTransformTemplateValue;a&&(o||_p(this.latestValues)||u)&&(n(this.instance,c),this.shouldResetTransform=!1,this.scheduleRender())}measure(a=!0){const o=this.measurePageBox();let l=this.removeElementScroll(o);return a&&(l=this.removeTransform(l)),Ape(l),{animationId:this.root.animationId,measuredBox:o,layoutBox:l,latestValues:{},source:this.id}}measurePageBox(){var a;const{visualElement:o}=this.options;if(!o)return hn();const l=o.measureViewportBox();if(!(((a=this.scroll)===null||a===void 0?void 0:a.wasRoot)||this.path.some(Tpe))){const{scroll:u}=this.root;u&&(kv(l.x,u.offset.x),kv(l.y,u.offset.y))}return l}removeElementScroll(a){var o;const l=hn();if(Qo(l,a),!((o=this.scroll)===null||o===void 0)&&o.wasRoot)return l;for(let c=0;c<this.path.length;c++){const u=this.path[c],{scroll:h,options:d}=u;u!==this.root&&h&&d.layoutScroll&&(h.wasRoot&&Qo(l,a),kv(l.x,h.offset.x),kv(l.y,h.offset.y))}return l}applyTransform(a,o=!1){const l=hn();Qo(l,a);for(let c=0;c<this.path.length;c++){const u=this.path[c];!o&&u.options.layoutScroll&&u.scroll&&u!==u.root&&Vv(l,{x:-u.scroll.offset.x,y:-u.scroll.offset.y}),_p(u.latestValues)&&Vv(l,u.latestValues)}return _p(this.latestValues)&&Vv(l,this.latestValues),l}removeTransform(a){const o=hn();Qo(o,a);for(let l=0;l<this.path.length;l++){const c=this.path[l];if(!c.instance||!_p(c.latestValues))continue;zO(c.latestValues)&&c.updateSnapshot();const u=hn(),h=c.measurePageBox();Qo(u,h),mG(o,c.latestValues,c.snapshot?c.snapshot.layoutBox:void 0,u)}return _p(this.latestValues)&&mG(o,this.latestValues),o}setTargetDelta(a){this.targetDelta=a,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(a){this.options={...this.options,...a,crossfade:a.crossfade!==void 0?a.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Ts.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(a=!1){var o;const l=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=l.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=l.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=l.isSharedProjectionDirty);const c=!!this.resumingFrom||this!==l;if(!(a||c&&this.isSharedProjectionDirty||this.isProjectionDirty||!((o=this.parent)===null||o===void 0)&&o.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:h,layoutId:d}=this.options;if(!(!this.layout||!(h||d))){if(this.resolvedRelativeTargetAt=Ts.timestamp,!this.targetDelta&&!this.relativeTarget){const f=this.getClosestProjectingParent();f&&f.layout&&this.animationProgress!==1?(this.relativeParent=f,this.forceRelativeParentToResolveTarget(),this.relativeTarget=hn(),this.relativeTargetOrigin=hn(),Cx(this.relativeTargetOrigin,this.layout.layoutBox,f.layout.layoutBox),Qo(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=hn(),this.targetWithTransforms=hn()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),Dfe(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Qo(this.target,this.layout.layoutBox),rJ(this.target,this.targetDelta)):Qo(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const f=this.getClosestProjectingParent();f&&!!f.resumingFrom==!!this.resumingFrom&&!f.options.layoutScroll&&f.target&&this.animationProgress!==1?(this.relativeParent=f,this.forceRelativeParentToResolveTarget(),this.relativeTarget=hn(),this.relativeTargetOrigin=hn(),Cx(this.relativeTargetOrigin,this.target,f.target),Qo(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}ix&&Sp.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||zO(this.parent.latestValues)||iJ(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var a;const o=this.getLead(),l=!!this.resumingFrom||this!==o;let c=!0;if((this.isProjectionDirty||!((a=this.parent)===null||a===void 0)&&a.isProjectionDirty)&&(c=!1),l&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(c=!1),this.resolvedRelativeTargetAt===Ts.timestamp&&(c=!1),c)return;const{layout:u,layoutId:h}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(u||h))return;Qo(this.layoutCorrected,this.layout.layoutBox);const d=this.treeScale.x,f=this.treeScale.y;Nfe(this.layoutCorrected,this.treeScale,this.path,l),o.layout&&!o.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(o.target=o.layout.layoutBox,o.targetWithTransforms=hn());const{target:p}=o;if(!p){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(dG(this.prevProjectionDelta.x,this.projectionDelta.x),dG(this.prevProjectionDelta.y,this.projectionDelta.y)),Tx(this.projectionDelta,this.layoutCorrected,p,this.latestValues),(this.treeScale.x!==d||this.treeScale.y!==f||!wG(this.projectionDelta.x,this.prevProjectionDelta.x)||!wG(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",p)),ix&&Sp.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(a=!0){var o;if((o=this.options.visualElement)===null||o===void 0||o.scheduleRender(),a){const l=this.getStack();l&&l.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=Nv(),this.projectionDelta=Nv(),this.projectionDeltaWithTransform=Nv()}setAnimationOrigin(a,o=!1){const l=this.snapshot,c=l?l.latestValues:{},u={...this.latestValues},h=Nv();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!o;const d=hn(),f=l?l.source:void 0,p=this.layout?this.layout.source:void 0,v=f!==p,m=this.getStack(),g=!m||m.members.length<=1,y=!!(v&&!g&&this.options.crossfade===!0&&!this.path.some(Mpe));this.animationProgress=0;let x;this.mixTargetDelta=_=>{const M=_/1e3;MG(h.x,a.x,M),MG(h.y,a.y,M),this.setTargetDelta(h),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(Cx(d,this.layout.layoutBox,this.relativeParent.layout.layoutBox),Spe(this.relativeTarget,this.relativeTargetOrigin,d,M),x&&ope(this.relativeTarget,x)&&(this.isProjectionDirty=!1),x||(x=hn()),Qo(x,this.relativeTarget)),v&&(this.animationValues=u,tpe(u,c,this.latestValues,M,y,g)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=M},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(a){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(pf(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Pr.update(()=>{ZE.hasAnimatedSinceResize=!0,this.currentAnimation=Qfe(0,bG,{...a,onUpdate:o=>{this.mixTargetDelta(o),a.onUpdate&&a.onUpdate(o)},onComplete:()=>{a.onComplete&&a.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const a=this.getStack();a&&a.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(bG),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const a=this.getLead();let{targetWithTransforms:o,target:l,layout:c,latestValues:u}=a;if(!(!o||!l||!c)){if(this!==a&&this.layout&&c&&fJ(this.options.animationType,this.layout.layoutBox,c.layoutBox)){l=this.target||hn();const h=zo(this.layout.layoutBox.x);l.x.min=a.target.x.min,l.x.max=l.x.min+h;const d=zo(this.layout.layoutBox.y);l.y.min=a.target.y.min,l.y.max=l.y.min+d}Qo(o,l),Vv(o,u),Tx(this.projectionDeltaWithTransform,this.layoutCorrected,o,u)}}registerSharedNode(a,o){this.sharedNodes.has(a)||this.sharedNodes.set(a,new lpe),this.sharedNodes.get(a).add(o);const c=o.options.initialPromotionConfig;o.promote({transition:c?c.transition:void 0,preserveFollowOpacity:c&&c.shouldPreserveFollowOpacity?c.shouldPreserveFollowOpacity(o):void 0})}isLead(){const a=this.getStack();return a?a.lead===this:!0}getLead(){var a;const{layoutId:o}=this.options;return o?((a=this.getStack())===null||a===void 0?void 0:a.lead)||this:this}getPrevLead(){var a;const{layoutId:o}=this.options;return o?(a=this.getStack())===null||a===void 0?void 0:a.prevLead:void 0}getStack(){const{layoutId:a}=this.options;if(a)return this.root.sharedNodes.get(a)}promote({needsReset:a,transition:o,preserveFollowOpacity:l}={}){const c=this.getStack();c&&c.promote(this,l),a&&(this.projectionDelta=void 0,this.needsReset=!0),o&&this.setOptions({transition:o})}relegate(){const a=this.getStack();return a?a.relegate(this):!1}resetSkewAndRotation(){const{visualElement:a}=this.options;if(!a)return;let o=!1;const{latestValues:l}=a;if((l.z||l.rotate||l.rotateX||l.rotateY||l.rotateZ||l.skewX||l.skewY)&&(o=!0),!o)return;const c={};l.z&&hD("z",a,c,this.animationValues);for(let u=0;u<uD.length;u++)hD(`rotate${uD[u]}`,a,c,this.animationValues),hD(`skew${uD[u]}`,a,c,this.animationValues);a.render();for(const u in c)a.setStaticValue(u,c[u]),this.animationValues&&(this.animationValues[u]=c[u]);a.scheduleRender()}getProjectionStyles(a){var o,l;if(!this.instance||this.isSVG)return;if(!this.isVisible)return upe;const c={visibility:""},u=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,c.opacity="",c.pointerEvents=YE(a==null?void 0:a.pointerEvents)||"",c.transform=u?u(this.latestValues,""):"none",c;const h=this.getLead();if(!this.projectionDelta||!this.layout||!h.target){const v={};return this.options.layoutId&&(v.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,v.pointerEvents=YE(a==null?void 0:a.pointerEvents)||""),this.hasProjected&&!_p(this.latestValues)&&(v.transform=u?u({},""):"none",this.hasProjected=!1),v}const d=h.animationValues||h.latestValues;this.applyTransformsToTarget(),c.transform=cpe(this.projectionDeltaWithTransform,this.treeScale,d),u&&(c.transform=u(d,c.transform));const{x:f,y:p}=this.projectionDelta;c.transformOrigin=`${f.origin*100}% ${p.origin*100}% 0`,h.animationValues?c.opacity=h===this?(l=(o=d.opacity)!==null&&o!==void 0?o:this.latestValues.opacity)!==null&&l!==void 0?l:1:this.preserveOpacity?this.latestValues.opacity:d.opacityExit:c.opacity=h===this?d.opacity!==void 0?d.opacity:"":d.opacityExit!==void 0?d.opacityExit:0;for(const v in Z2){if(d[v]===void 0)continue;const{correct:m,applyTo:g}=Z2[v],y=c.transform==="none"?d[v]:m(d[v],h);if(g){const x=g.length;for(let _=0;_<x;_++)c[g[_]]=y}else c[v]=y}return this.options.layoutId&&(c.pointerEvents=h===this?YE(a==null?void 0:a.pointerEvents)||"":"none"),c}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(a=>{var o;return(o=a.currentAnimation)===null||o===void 0?void 0:o.stop()}),this.root.nodes.forEach(_G),this.root.sharedNodes.clear()}}}function dpe(e){e.updateLayout()}function fpe(e){var t;const i=((t=e.resumeFrom)===null||t===void 0?void 0:t.snapshot)||e.snapshot;if(e.isLead()&&e.layout&&i&&e.hasListeners("didUpdate")){const{layoutBox:r,measuredBox:n}=e.layout,{animationType:s}=e.options,a=i.source!==e.layout.source;s==="size"?rl(h=>{const d=a?i.measuredBox[h]:i.layoutBox[h],f=zo(d);d.min=r[h].min,d.max=d.min+f}):fJ(s,i.layoutBox,r)&&rl(h=>{const d=a?i.measuredBox[h]:i.layoutBox[h],f=zo(r[h]);d.max=d.min+f,e.relativeTarget&&!e.currentAnimation&&(e.isProjectionDirty=!0,e.relativeTarget[h].max=e.relativeTarget[h].min+f)});const o=Nv();Tx(o,r,i.layoutBox);const l=Nv();a?Tx(l,e.applyTransform(n,!0),i.measuredBox):Tx(l,r,i.layoutBox);const c=!cJ(o);let u=!1;if(!e.resumeFrom){const h=e.getClosestProjectingParent();if(h&&!h.resumeFrom){const{snapshot:d,layout:f}=h;if(d&&f){const p=hn();Cx(p,i.layoutBox,d.layoutBox);const v=hn();Cx(v,r,f.layoutBox),uJ(p,v)||(u=!0),h.options.layoutRoot&&(e.relativeTarget=v,e.relativeTargetOrigin=p,e.relativeParent=h)}}}e.notifyListeners("didUpdate",{layout:r,snapshot:i,delta:l,layoutDelta:o,hasLayoutChanged:c,hasRelativeTargetChanged:u})}else if(e.isLead()){const{onExitComplete:r}=e.options;r&&r()}e.options.transition=void 0}function ppe(e){ix&&Sp.totalNodes++,e.parent&&(e.isProjecting()||(e.isProjectionDirty=e.parent.isProjectionDirty),e.isSharedProjectionDirty||(e.isSharedProjectionDirty=!!(e.isProjectionDirty||e.parent.isProjectionDirty||e.parent.isSharedProjectionDirty)),e.isTransformDirty||(e.isTransformDirty=e.parent.isTransformDirty))}function mpe(e){e.isProjectionDirty=e.isSharedProjectionDirty=e.isTransformDirty=!1}function gpe(e){e.clearSnapshot()}function _G(e){e.clearMeasurements()}function vpe(e){e.isLayoutDirty=!1}function ype(e){const{visualElement:t}=e.options;t&&t.getProps().onBeforeLayoutMeasure&&t.notify("BeforeLayoutMeasure"),e.resetTransform()}function SG(e){e.finishAnimation(),e.targetDelta=e.relativeTarget=e.target=void 0,e.isProjectionDirty=!0}function xpe(e){e.resolveTargetDelta()}function wpe(e){e.calcProjection()}function bpe(e){e.resetSkewAndRotation()}function _pe(e){e.removeLeadSnapshot()}function MG(e,t,i){e.translate=Nr(t.translate,0,i),e.scale=Nr(t.scale,1,i),e.origin=t.origin,e.originPoint=t.originPoint}function EG(e,t,i,r){e.min=Nr(t.min,i.min,r),e.max=Nr(t.max,i.max,r)}function Spe(e,t,i,r){EG(e.x,t.x,i.x,r),EG(e.y,t.y,i.y,r)}function Mpe(e){return e.animationValues&&e.animationValues.opacityExit!==void 0}const Epe={duration:.45,ease:[.4,0,.1,1]},AG=e=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(e),TG=AG("applewebkit/")&&!AG("chrome/")?Math.round:Io;function CG(e){e.min=TG(e.min),e.max=TG(e.max)}function Ape(e){CG(e.x),CG(e.y)}function fJ(e,t,i){return e==="position"||e==="preserve-aspect"&&!Pfe(xG(t),xG(i),.2)}function Tpe(e){var t;return e!==e.root&&((t=e.scroll)===null||t===void 0?void 0:t.wasRoot)}const Cpe=dJ({attachResizeListener:(e,t)=>Tw(e,"resize",t),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),dD={current:void 0},pJ=dJ({measureScroll:e=>({x:e.scrollLeft,y:e.scrollTop}),defaultParent:()=>{if(!dD.current){const e=new Cpe({});e.mount(window),e.setOptions({layoutScroll:!0}),dD.current=e}return dD.current},resetTransform:(e,t)=>{e.style.transform=t!==void 0?t:"none"},checkIsScrollRoot:e=>window.getComputedStyle(e).position==="fixed"}),Ppe={pan:{Feature:Wfe},drag:{Feature:jfe,ProjectionNode:pJ,MeasureLayout:aJ}};function PG(e,t,i){const{props:r}=e;e.animationState&&r.whileHover&&e.animationState.setActive("whileHover",i==="Start");const n="onHover"+i,s=r[n];s&&Pr.postRender(()=>s(t,Ab(t)))}class Dpe extends Ef{mount(){const{current:t}=this.node;t&&(this.unmount=Dhe(t,i=>(PG(this.node,i,"Start"),r=>PG(this.node,r,"End"))))}unmount(){}}class Rpe extends Ef{constructor(){super(...arguments),this.isActive=!1}onFocus(){let t=!1;try{t=this.node.current.matches(":focus-visible")}catch{t=!0}!t||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=Eb(Tw(this.node.current,"focus",()=>this.onFocus()),Tw(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function DG(e,t,i){const{props:r}=e;e.animationState&&r.whileTap&&e.animationState.setActive("whileTap",i==="Start");const n="onTap"+(i==="End"?"":i),s=r[n];s&&Pr.postRender(()=>s(t,Ab(t)))}class Ipe extends Ef{mount(){const{current:t}=this.node;t&&(this.unmount=Ohe(t,i=>(DG(this.node,i,"Start"),(r,{success:n})=>DG(this.node,r,n?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const FO=new WeakMap,fD=new WeakMap,Lpe=e=>{const t=FO.get(e.target);t&&t(e)},Ope=e=>{e.forEach(Lpe)};function zpe({root:e,...t}){const i=e||document;fD.has(i)||fD.set(i,{});const r=fD.get(i),n=JSON.stringify(t);return r[n]||(r[n]=new IntersectionObserver(Ope,{root:e,...t})),r[n]}function Bpe(e,t,i){const r=zpe(t);return FO.set(e,i),r.observe(e),()=>{FO.delete(e),r.unobserve(e)}}const Fpe={some:0,all:1};class Upe extends Ef{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:t={}}=this.node.getProps(),{root:i,margin:r,amount:n="some",once:s}=t,a={root:i?i.current:void 0,rootMargin:r,threshold:typeof n=="number"?n:Fpe[n]},o=l=>{const{isIntersecting:c}=l;if(this.isInView===c||(this.isInView=c,s&&!c&&this.hasEnteredView))return;c&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",c);const{onViewportEnter:u,onViewportLeave:h}=this.node.getProps(),d=c?u:h;d&&d(l)};return Bpe(this.node.current,a,o)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:t,prevProps:i}=this.node;["amount","margin","root"].some(Npe(t,i))&&this.startObserver()}unmount(){}}function Npe({viewport:e={}},{viewport:t={}}={}){return i=>e[i]!==t[i]}const kpe={inView:{Feature:Upe},tap:{Feature:Ipe},focus:{Feature:Rpe},hover:{Feature:Dpe}},Vpe={layout:{ProjectionNode:pJ,MeasureLayout:aJ}},UO={current:null},mJ={current:!1};function Gpe(){if(mJ.current=!0,!!gU)if(window.matchMedia){const e=window.matchMedia("(prefers-reduced-motion)"),t=()=>UO.current=e.matches;e.addListener(t),t()}else UO.current=!1}const Hpe=[...kK,$s,mf],jpe=e=>Hpe.find(NK(e)),RG=new WeakMap;function Wpe(e,t,i){for(const r in t){const n=t[r],s=i[r];if(ra(n))e.addValue(r,n);else if(ra(s))e.addValue(r,Ew(n,{owner:e}));else if(s!==n)if(e.hasValue(r)){const a=e.getValue(r);a.liveStyle===!0?a.jump(n):a.hasAnimated||a.set(n)}else{const a=e.getStaticValue(r);e.addValue(r,Ew(a!==void 0?a:n,{owner:e}))}}for(const r in i)t[r]===void 0&&e.removeValue(r);return t}const IG=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class Xpe{scrapeMotionValuesFromProps(t,i,r){return{}}constructor({parent:t,props:i,presenceContext:r,reducedMotionConfig:n,blockInitialAnimation:s,visualState:a},o={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=jU,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const f=Kc.now();this.renderScheduledAt<f&&(this.renderScheduledAt=f,Pr.render(this.render,!1,!0))};const{latestValues:l,renderState:c,onUpdate:u}=a;this.onUpdate=u,this.latestValues=l,this.baseTarget={...l},this.initialValues=i.initial?{...l}:{},this.renderState=c,this.parent=t,this.props=i,this.presenceContext=r,this.depth=t?t.depth+1:0,this.reducedMotionConfig=n,this.options=o,this.blockInitialAnimation=!!s,this.isControllingVariants=wC(i),this.isVariantNode=YZ(i),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(t&&t.current);const{willChange:h,...d}=this.scrapeMotionValuesFromProps(i,{},this);for(const f in d){const p=d[f];l[f]!==void 0&&ra(p)&&p.set(l[f],!1)}}mount(t){this.current=t,RG.set(t,this),this.projection&&!this.projection.instance&&this.projection.mount(t),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((i,r)=>this.bindToMotionValue(r,i)),mJ.current||Gpe(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:UO.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){RG.delete(this.current),this.projection&&this.projection.unmount(),pf(this.notifyUpdate),pf(this.render),this.valueSubscriptions.forEach(t=>t()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const t in this.events)this.events[t].clear();for(const t in this.features){const i=this.features[t];i&&(i.unmount(),i.isMounted=!1)}this.current=null}bindToMotionValue(t,i){this.valueSubscriptions.has(t)&&this.valueSubscriptions.get(t)();const r=Hm.has(t),n=i.on("change",o=>{this.latestValues[t]=o,this.props.onUpdate&&Pr.preRender(this.notifyUpdate),r&&this.projection&&(this.projection.isTransformDirty=!0)}),s=i.on("renderRequest",this.scheduleRender);let a;window.MotionCheckAppearSync&&(a=window.MotionCheckAppearSync(this,t,i)),this.valueSubscriptions.set(t,()=>{n(),s(),a&&a(),i.owner&&i.stop()})}sortNodePosition(t){return!this.current||!this.sortInstanceNodePosition||this.type!==t.type?0:this.sortInstanceNodePosition(this.current,t.current)}updateFeatures(){let t="animation";for(t in D0){const i=D0[t];if(!i)continue;const{isEnabled:r,Feature:n}=i;if(!this.features[t]&&n&&r(this.props)&&(this.features[t]=new n(this)),this.features[t]){const s=this.features[t];s.isMounted?s.update():(s.mount(),s.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):hn()}getStaticValue(t){return this.latestValues[t]}setStaticValue(t,i){this.latestValues[t]=i}update(t,i){(t.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=t,this.prevPresenceContext=this.presenceContext,this.presenceContext=i;for(let r=0;r<IG.length;r++){const n=IG[r];this.propEventSubscriptions[n]&&(this.propEventSubscriptions[n](),delete this.propEventSubscriptions[n]);const s="on"+n,a=t[s];a&&(this.propEventSubscriptions[n]=this.on(n,a))}this.prevMotionValues=Wpe(this,this.scrapeMotionValuesFromProps(t,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue(),this.onUpdate&&this.onUpdate(this)}getProps(){return this.props}getVariant(t){return this.props.variants?this.props.variants[t]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(t){const i=this.getClosestVariantNode();if(i)return i.variantChildren&&i.variantChildren.add(t),()=>i.variantChildren.delete(t)}addValue(t,i){const r=this.values.get(t);i!==r&&(r&&this.removeValue(t),this.bindToMotionValue(t,i),this.values.set(t,i),this.latestValues[t]=i.get())}removeValue(t){this.values.delete(t);const i=this.valueSubscriptions.get(t);i&&(i(),this.valueSubscriptions.delete(t)),delete this.latestValues[t],this.removeValueFromRenderState(t,this.renderState)}hasValue(t){return this.values.has(t)}getValue(t,i){if(this.props.values&&this.props.values[t])return this.props.values[t];let r=this.values.get(t);return r===void 0&&i!==void 0&&(r=Ew(i===null?void 0:i,{owner:this}),this.addValue(t,r)),r}readValue(t,i){var r;let n=this.latestValues[t]!==void 0||!this.current?this.latestValues[t]:(r=this.getBaseTargetFromProps(this.props,t))!==null&&r!==void 0?r:this.readValueFromInstance(this.current,t,this.options);return n!=null&&(typeof n=="string"&&(FK(n)||CK(n))?n=parseFloat(n):!jpe(n)&&mf.test(i)&&(n=OK(t,i)),this.setBaseTarget(t,ra(n)?n.get():n)),ra(n)?n.get():n}setBaseTarget(t,i){this.baseTarget[t]=i}getBaseTarget(t){var i;const{initial:r}=this.props;let n;if(typeof r=="string"||typeof r=="object"){const a=MU(this.props,r,(i=this.presenceContext)===null||i===void 0?void 0:i.custom);a&&(n=a[t])}if(r&&n!==void 0)return n;const s=this.getBaseTargetFromProps(this.props,t);return s!==void 0&&!ra(s)?s:this.initialValues[t]!==void 0&&n===void 0?void 0:this.baseTarget[t]}on(t,i){return this.events[t]||(this.events[t]=new UU),this.events[t].add(i)}notify(t,...i){this.events[t]&&this.events[t].notify(...i)}}class gJ extends Xpe{constructor(){super(...arguments),this.KeyframeResolver=VK}sortInstanceNodePosition(t,i){return t.compareDocumentPosition(i)&2?1:-1}getBaseTargetFromProps(t,i){return t.style?t.style[i]:void 0}removeValueFromRenderState(t,{vars:i,style:r}){delete i[t],delete r[t]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:t}=this.props;ra(t)&&(this.childSubscription=t.on("change",i=>{this.current&&(this.current.textContent=`${i}`)}))}}function qpe(e){return window.getComputedStyle(e)}class Ype extends gJ{constructor(){super(...arguments),this.type="html",this.renderInstance=rK}readValueFromInstance(t,i){if(Hm.has(i)){const r=HU(i);return r&&r.default||0}else{const r=qpe(t),n=(eK(i)?r.getPropertyValue(i):r[i])||0;return typeof n=="string"?n.trim():n}}measureInstanceViewportBox(t,{transformPagePoint:i}){return nJ(t,i)}build(t,i,r){TU(t,i,r.transformTemplate)}scrapeMotionValuesFromProps(t,i,r){return RU(t,i,r)}}class Qpe extends gJ{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=hn}getBaseTargetFromProps(t,i){return t[i]}readValueFromInstance(t,i){if(Hm.has(i)){const r=HU(i);return r&&r.default||0}return i=nK.has(i)?i:bU(i),t.getAttribute(i)}scrapeMotionValuesFromProps(t,i,r){return oK(t,i,r)}build(t,i,r){CU(t,i,this.isSVGTag,r.transformTemplate)}renderInstance(t,i,r,n){sK(t,i,r,n)}mount(t){this.isSVGTag=DU(t.tagName),super.mount(t)}}const Zpe=(e,t)=>SU(e)?new Qpe(t):new Ype(t,{allowProjection:e!==_e.Fragment}),Kpe=She({...wfe,...kpe,...Ppe,...Vpe},Zpe),Mi=Uue(Kpe);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Jpe={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $pe=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),ko=(e,t)=>{const i=_e.forwardRef(({color:r="currentColor",size:n=24,strokeWidth:s=2,absoluteStrokeWidth:a,className:o="",children:l,...c},u)=>_e.createElement("svg",{ref:u,...Jpe,width:n,height:n,stroke:r,strokeWidth:a?Number(s)*24/Number(n):s,className:["lucide",`lucide-${$pe(e)}`,o].join(" "),...c},[...t.map(([h,d])=>_e.createElement(h,d)),...Array.isArray(l)?l:[l]]));return i.displayName=`${e}`,i};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eme=ko("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vJ=ko("Code2",[["path",{d:"m18 16 4-4-4-4",key:"1inbqp"}],["path",{d:"m6 8-4 4 4 4",key:"15zrgr"}],["path",{d:"m14.5 4-5 16",key:"e7oirm"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tme=ko("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LG=ko("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iA=ko("Github",[["path",{d:"M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4",key:"tonef"}],["path",{d:"M9 18c-4.51 2-5-2-7-2",key:"9comsn"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ime=ko("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yJ=ko("Linkedin",[["path",{d:"M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z",key:"c2jq9f"}],["rect",{width:"4",height:"12",x:"2",y:"9",key:"mk3on5"}],["circle",{cx:"4",cy:"4",r:"2",key:"bt5ra8"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xJ=ko("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rme=ko("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nme=ko("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sme=ko("Server",[["rect",{width:"20",height:"8",x:"2",y:"2",rx:"2",ry:"2",key:"ngkwjq"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2",ry:"2",key:"iecqi9"}],["line",{x1:"6",x2:"6.01",y1:"6",y2:"6",key:"16zg32"}],["line",{x1:"6",x2:"6.01",y1:"18",y2:"18",key:"nzw8ys"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ame=ko("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ome=ko("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),lme=()=>{const[e,t]=_e.useState(!1),[i,r]=_e.useState(!0),[n,s]=_e.useState(!1),a=_b();_e.useEffect(()=>{document.documentElement.classList.add("dark")},[]);const o=()=>{r(!i),document.documentElement.classList.toggle("dark")};_e.useEffect(()=>{const u=()=>{s(window.scrollY>20)};return window.addEventListener("scroll",u),()=>window.removeEventListener("scroll",u)},[]);const l=[{title:"Home",path:"/"},{title:"About",path:"/about"},{title:"Skills",path:"/skills"},{title:"Portfolio",path:"/portfolio"},{title:"Contact",path:"/contact"}],c={initial:{scale:1},hover:{scale:1.1,rotate:360,transition:{duration:.5}}};return Te.jsx("header",{className:`fixed w-full top-0 z-50 transition-all duration-300 ${n?"bg-gray-900/90 backdrop-blur-md shadow-lg":"bg-transparent"}`,children:Te.jsxs("nav",{className:"container mx-auto px-6 py-4",children:[Te.jsxs("div",{className:"flex items-center justify-between",children:[Te.jsxs(oh,{to:"/",className:"flex items-center space-x-2",children:[Te.jsx(Mi.div,{variants:c,initial:"initial",whileHover:"hover",children:Te.jsx(vJ,{className:"w-8 h-8 text-[#FF4500]"})}),Te.jsx("span",{className:"text-xl font-bold text-white",children:"Sahal"})]}),Te.jsxs("div",{className:"hidden md:flex items-center space-x-8",children:[l.map(u=>Te.jsxs(oh,{to:u.path,className:`relative text-gray-300 hover:text-[#FF4500] transition-colors ${a.pathname===u.path?"text-[#FF4500]":""}`,children:[u.title,a.pathname===u.path&&Te.jsx(Mi.div,{layoutId:"underline",className:"absolute -bottom-1 left-0 right-0 h-0.5 bg-[#FF4500]"})]},u.path)),Te.jsx(Mi.button,{whileHover:{scale:1.1},whileTap:{scale:.95},onClick:o,className:"p-2 rounded-full hover:bg-gray-800 transition-colors",children:i?Te.jsx(ame,{className:"w-5 h-5 text-gray-300"}):Te.jsx(nme,{className:"w-5 h-5 text-gray-300"})})]}),Te.jsx(Mi.button,{whileTap:{scale:.95},onClick:()=>t(!e),className:"md:hidden p-2 rounded-lg hover:bg-gray-800 transition-colors",children:e?Te.jsx(ome,{className:"w-6 h-6 text-gray-300"}):Te.jsx(rme,{className:"w-6 h-6 text-gray-300"})})]}),Te.jsx(vU,{children:e&&Te.jsx(Mi.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.3},className:"md:hidden overflow-hidden",children:Te.jsxs("div",{className:"py-4 space-y-4",children:[l.map(u=>Te.jsx(Mi.div,{initial:{x:-20,opacity:0},animate:{x:0,opacity:1},transition:{duration:.3},children:Te.jsx(oh,{to:u.path,className:`block px-4 py-2 text-gray-300 hover:bg-gray-800 rounded-lg transition-colors ${a.pathname===u.path?"bg-gray-800":""}`,onClick:()=>t(!1),children:u.title})},u.path)),Te.jsx(Mi.button,{initial:{x:-20,opacity:0},animate:{x:0,opacity:1},onClick:o,className:"w-full px-4 py-2 text-left text-gray-300 hover:bg-gray-800 rounded-lg transition-colors",children:i?"Light Mode":"Dark Mode"})]})})})]})})};function SC(e,t,i,r){return new(i||(i=Promise))(function(n,s){function a(c){try{l(r.next(c))}catch(u){s(u)}}function o(c){try{l(r.throw(c))}catch(u){s(u)}}function l(c){var u;c.done?n(c.value):(u=c.value,u instanceof i?u:new i(function(h){h(u)})).then(a,o)}l((r=r.apply(e,[])).next())})}function sf(e,t){var i,r,n,s,a={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function o(l){return function(c){return function(u){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,r&&(n=2&u[0]?r.return:u[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,u[1])).done)return n;switch(r=0,n&&(u=[2&u[0],n.value]),u[0]){case 0:case 1:n=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(n=a.trys,!((n=n.length>0&&n[n.length-1])||u[0]!==6&&u[0]!==2)){a=0;continue}if(u[0]===3&&(!n||u[1]>n[0]&&u[1]<n[3])){a.label=u[1];break}if(u[0]===6&&a.label<n[1]){a.label=n[1],n=u;break}if(n&&a.label<n[2]){a.label=n[2],a.ops.push(u);break}n[2]&&a.ops.pop(),a.trys.pop();continue}u=t.call(e,a)}catch(h){u=[6,h],r=0}finally{i=n=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([l,c])}}}function NO(e){var t=typeof Symbol=="function"&&Symbol.iterator,i=t&&e[t],r=0;if(i)return i.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Xl(e,t){var i=typeof Symbol=="function"&&e[Symbol.iterator];if(!i)return e;var r,n,s=i.call(e),a=[];try{for(;(t===void 0||t-- >0)&&!(r=s.next()).done;)a.push(r.value)}catch(o){n={error:o}}finally{try{r&&!r.done&&(i=s.return)&&i.call(s)}finally{if(n)throw n.error}}return a}function kc(e,t,i){if(arguments.length===2)for(var r,n=0,s=t.length;n<s;n++)!r&&n in t||(r||(r=Array.prototype.slice.call(t,0,n)),r[n]=t[n]);return e.concat(r||Array.prototype.slice.call(t))}function OG(e,t,i,r,n){for(var s=[],a=5;a<arguments.length;a++)s[a-5]=arguments[a];return SC(this,void 0,void 0,function(){var o,l,c,u,h,d;return sf(this,function(f){switch(f.label){case 0:f.trys.push([0,12,13,14]),o=NO(s),l=o.next(),f.label=1;case 1:if(l.done)return[3,11];switch(c=l.value,typeof c){case"string":return[3,2];case"number":return[3,4];case"function":return[3,6]}return[3,8];case 2:return[4,cme(e,t,c,i,r,n)];case 3:return f.sent(),[3,10];case 4:return[4,wJ(c)];case 5:return f.sent(),[3,10];case 6:return[4,c.apply(void 0,kc([e,t,i,r,n],Xl(s),!1))];case 7:return f.sent(),[3,10];case 8:return[4,c];case 9:f.sent(),f.label=10;case 10:return l=o.next(),[3,1];case 11:return[3,14];case 12:return u=f.sent(),h={error:u},[3,14];case 13:try{l&&!l.done&&(d=o.return)&&d.call(o)}finally{if(h)throw h.error}return[7];case 14:return[2]}})})}function cme(e,t,i,r,n,s){return SC(this,void 0,void 0,function(){var a,o;return sf(this,function(l){switch(l.label){case 0:return a=e.textContent||"",o=function(c,u){var h=Xl(u).slice(0);return kc(kc([],Xl(c),!1),[NaN],!1).findIndex(function(d,f){return h[f]!==d})}(a,i),[4,ume(e,kc(kc([],Xl(dme(a,t,o)),!1),Xl(hme(i,t,o)),!1),r,n,s)];case 1:return l.sent(),[2]}})})}function wJ(e){return SC(this,void 0,void 0,function(){return sf(this,function(t){switch(t.label){case 0:return[4,new Promise(function(i){return setTimeout(i,e)})];case 1:return t.sent(),[2]}})})}function ume(e,t,i,r,n){return SC(this,void 0,void 0,function(){var s,a,o,l,c,u,h,d,f,p,v,m,g;return sf(this,function(y){switch(y.label){case 0:if(s=t,n){for(a=0,o=1;o<t.length;o++)if(l=Xl([t[o-1],t[o]],2),c=l[0],(u=l[1]).length>c.length||u===""){a=o;break}s=t.slice(a,t.length)}y.label=1;case 1:y.trys.push([1,6,7,8]),h=NO(function(x){var _,M,S,T,E,C,A;return sf(this,function(D){switch(D.label){case 0:_=function(R){return sf(this,function(L){switch(L.label){case 0:return[4,{op:function(O){return requestAnimationFrame(function(){return O.textContent=R})},opCode:function(O){var H=O.textContent||"";return R===""||H.length>R.length?"DELETE":"WRITING"}}];case 1:return L.sent(),[2]}})},D.label=1;case 1:D.trys.push([1,6,7,8]),M=NO(x),S=M.next(),D.label=2;case 2:return S.done?[3,5]:(T=S.value,[5,_(T)]);case 3:D.sent(),D.label=4;case 4:return S=M.next(),[3,2];case 5:return[3,8];case 6:return E=D.sent(),C={error:E},[3,8];case 7:try{S&&!S.done&&(A=M.return)&&A.call(M)}finally{if(C)throw C.error}return[7];case 8:return[2]}})}(s)),d=h.next(),y.label=2;case 2:return d.done?[3,5]:(f=d.value,p=f.opCode(e)==="WRITING"?i+i*(Math.random()-.5):r+r*(Math.random()-.5),f.op(e),[4,wJ(p)]);case 3:y.sent(),y.label=4;case 4:return d=h.next(),[3,2];case 5:return[3,8];case 6:return v=y.sent(),m={error:v},[3,8];case 7:try{d&&!d.done&&(g=h.return)&&g.call(h)}finally{if(m)throw m.error}return[7];case 8:return[2]}})})}function hme(e,t,i){var r,n;return i===void 0&&(i=0),sf(this,function(s){switch(s.label){case 0:r=t(e),n=r.length,s.label=1;case 1:return i<n?[4,r.slice(0,++i).join("")]:[3,3];case 2:return s.sent(),[3,1];case 3:return[2]}})}function dme(e,t,i){var r,n;return i===void 0&&(i=0),sf(this,function(s){switch(s.label){case 0:r=t(e),n=r.length,s.label=1;case 1:return n>i?[4,r.slice(0,--n).join("")]:[3,3];case 2:return s.sent(),[3,1];case 3:return[2]}})}var fme="index-module_type__E-SaG";(function(e,t){t===void 0&&(t={});var i=t.insertAt;if(typeof document<"u"){var r=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css",i==="top"&&r.firstChild?r.insertBefore(n,r.firstChild):r.appendChild(n),n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e))}})(`.index-module_type__E-SaG::after {
  content: '|';
  animation: index-module_cursor__PQg0P 1.1s infinite step-start;
}

@keyframes index-module_cursor__PQg0P {
  50% {
    opacity: 0;
  }
}
`);var pme=_e.memo(_e.forwardRef(function(e,t){var i=e.sequence,r=e.repeat,n=e.className,s=e.speed,a=s===void 0?40:s,o=e.deletionSpeed,l=e.omitDeletionAnimation,c=l!==void 0&&l,u=e.preRenderFirstString,h=u!==void 0&&u,d=e.wrapper,f=d===void 0?"span":d,p=e.splitter,v=p===void 0?function(U){return kc([],Xl(U),!1)}:p,m=e.cursor,g=m===void 0||m,y=e.style,x=function(U,k){var X={};for(var re in U)Object.prototype.hasOwnProperty.call(U,re)&&k.indexOf(re)<0&&(X[re]=U[re]);if(U!=null&&typeof Object.getOwnPropertySymbols=="function"){var q=0;for(re=Object.getOwnPropertySymbols(U);q<re.length;q++)k.indexOf(re[q])<0&&Object.prototype.propertyIsEnumerable.call(U,re[q])&&(X[re[q]]=U[re[q]])}return X}(e,["sequence","repeat","className","speed","deletionSpeed","omitDeletionAnimation","preRenderFirstString","wrapper","splitter","cursor","style"]),_=x["aria-label"],M=x["aria-hidden"],S=x.role;o||(o=a);var T=new Array(2).fill(40);[a,o].forEach(function(U,k){switch(typeof U){case"number":T[k]=Math.abs(U-100);break;case"object":var X=U.type,re=U.value;if(typeof re!="number")break;X==="keyStrokeDelayInMs"&&(T[k]=re)}});var E,C,A,D,R,L,O=T[0],H=T[1],j=function(U,k){k===void 0&&(k=null);var X=_e.useRef(k);return _e.useEffect(function(){U&&(typeof U=="function"?U(X.current):U.current=X.current)},[U]),X}(t),Y=fme;E=n?"".concat(g?Y+" ":"").concat(n):g?Y:"",C=_e.useRef(function(){var U,k=i;r===1/0?U=OG:typeof r=="number"&&(k=Array(1+r).fill(i).flat());var X=U?kc(kc([],Xl(k),!1),[U],!1):kc([],Xl(k),!1);return OG.apply(void 0,kc([j.current,v,O,H,c],Xl(X),!1)),function(){j.current}}),A=_e.useRef(),D=_e.useRef(!1),R=_e.useRef(!1),L=Xl(_e.useState(0),2)[1],D.current&&(R.current=!0),_e.useEffect(function(){return D.current||(A.current=C.current(),D.current=!0),L(function(U){return U+1}),function(){R.current&&A.current&&A.current()}},[]);var z=f,V=h?i.find(function(U){return typeof U=="string"})||"":null;return ar.createElement(z,{"aria-hidden":M,"aria-label":_,role:S,style:y,className:E,children:_?ar.createElement("span",{"aria-hidden":"true",ref:j,children:V}):V,ref:_?void 0:j})}),function(e,t){return!0});const mme="modulepreload",gme=function(e){return"/sahal/"+e},zG={},Af=function(t,i,r){let n=Promise.resolve();if(i&&i.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),o=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));n=Promise.allSettled(i.map(l=>{if(l=gme(l),l in zG)return;zG[l]=!0;const c=l.endsWith(".css"),u=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${u}`))return;const h=document.createElement("link");if(h.rel=c?"stylesheet":mme,c||(h.as="script"),h.crossOrigin="",h.href=l,o&&h.setAttribute("nonce",o),document.head.appendChild(h),c)return new Promise((d,f)=>{h.addEventListener("load",d),h.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${l}`)))})}))}function s(a){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=a,window.dispatchEvent(o),!o.defaultPrevented)throw a}return n.then(a=>{for(const o of a||[])o.status==="rejected"&&s(o.reason);return t().catch(s)})};var vme=Object.create,MC=Object.defineProperty,yme=Object.getOwnPropertyDescriptor,xme=Object.getOwnPropertyNames,wme=Object.getPrototypeOf,bme=Object.prototype.hasOwnProperty,_me=(e,t,i)=>t in e?MC(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,jm=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),Sme=(e,t)=>{for(var i in t)MC(e,i,{get:t[i],enumerable:!0})},Mme=(e,t,i,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of xme(t))!bme.call(e,n)&&n!==i&&MC(e,n,{get:()=>t[n],enumerable:!(r=yme(t,n))||r.enumerable});return e},Tf=(e,t,i)=>(i=e!=null?vme(wme(e)):{},Mme(t||!e||!e.__esModule?MC(i,"default",{value:e,enumerable:!0}):i,e)),rx=(e,t,i)=>(_me(e,typeof t!="symbol"?t+"":t,i),i),Eme=jm((e,t)=>{(function(i,r){typeof e=="object"?t.exports=r():typeof define=="function"&&define.amd?define(r):i.Alea=r()})(e,function(){return i.importState=function(n){var s=new i;return s.importState(n),s},i;function i(){return function(n){var s=0,a=0,o=0,l=1;n.length==0&&(n=[+new Date]);var c=r();s=c(" "),a=c(" "),o=c(" ");for(var u=0;u<n.length;u++)s-=c(n[u]),s<0&&(s+=1),a-=c(n[u]),a<0&&(a+=1),o-=c(n[u]),o<0&&(o+=1);c=null;var h=function(){var d=2091639*s+l*23283064365386963e-26;return s=a,a=o,o=d-(l=d|0)};return h.next=h,h.uint32=function(){return h()*4294967296},h.fract53=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.version="Alea 0.9",h.args=n,h.exportState=function(){return[s,a,o,l]},h.importState=function(d){s=+d[0]||0,a=+d[1]||0,o=+d[2]||0,l=+d[3]||0},h}(Array.prototype.slice.call(arguments))}function r(){var n=4022871197,s=function(a){a=a.toString();for(var o=0;o<a.length;o++){n+=a.charCodeAt(o);var l=.02519603282416938*n;n=l>>>0,l-=n,l*=n,n=l>>>0,l-=n,n+=l*4294967296}return(n>>>0)*23283064365386963e-26};return s.version="Mash 0.9",s}})}),bJ=jm((e,t)=>{(function(i,r){typeof e=="object"&&typeof t<"u"?r(e):typeof define=="function"&&define.amd?define(["exports"],r):r((i=typeof globalThis<"u"?globalThis:i||self).SVDJS={})})(e,function(i){i.SVD=function(r,n,s,a,o){if(n=n===void 0||n,s=s===void 0||s,o=1e-64/(a=a||Math.pow(2,-52)),!r)throw new TypeError("Matrix a is not defined");var l,c,u,h,d,f,p,v,m,g,y,x,_=r[0].length,M=r.length;if(M<_)throw new TypeError("Invalid matrix: m < n");for(var S=[],T=[],E=[],C=n==="f"?M:_,A=g=p=0;A<M;A++)T[A]=new Array(C).fill(0);for(A=0;A<_;A++)E[A]=new Array(_).fill(0);var D,R=new Array(_).fill(0);for(A=0;A<M;A++)for(l=0;l<_;l++)T[A][l]=r[A][l];for(A=0;A<_;A++){for(S[A]=p,m=0,u=A+1,l=A;l<M;l++)m+=Math.pow(T[l][A],2);if(m<o)p=0;else for(v=(f=T[A][A])*(p=f<0?Math.sqrt(m):-Math.sqrt(m))-m,T[A][A]=f-p,l=u;l<_;l++){for(m=0,c=A;c<M;c++)m+=T[c][A]*T[c][l];for(f=m/v,c=A;c<M;c++)T[c][l]=T[c][l]+f*T[c][A]}for(R[A]=p,m=0,l=u;l<_;l++)m+=Math.pow(T[A][l],2);if(m<o)p=0;else{for(v=(f=T[A][A+1])*(p=f<0?Math.sqrt(m):-Math.sqrt(m))-m,T[A][A+1]=f-p,l=u;l<_;l++)S[l]=T[A][l]/v;for(l=u;l<M;l++){for(m=0,c=u;c<_;c++)m+=T[l][c]*T[A][c];for(c=u;c<_;c++)T[l][c]=T[l][c]+m*S[c]}}g<(y=Math.abs(R[A])+Math.abs(S[A]))&&(g=y)}if(s)for(A=_-1;0<=A;A--){if(p!==0){for(v=T[A][A+1]*p,l=u;l<_;l++)E[l][A]=T[A][l]/v;for(l=u;l<_;l++){for(m=0,c=u;c<_;c++)m+=T[A][c]*E[c][l];for(c=u;c<_;c++)E[c][l]=E[c][l]+m*E[c][A]}}for(l=u;l<_;l++)E[A][l]=0,E[l][A]=0;E[A][A]=1,p=S[A],u=A}if(n){if(n==="f")for(A=_;A<M;A++){for(l=_;l<M;l++)T[A][l]=0;T[A][A]=1}for(A=_-1;0<=A;A--){for(u=A+1,p=R[A],l=u;l<C;l++)T[A][l]=0;if(p!==0){for(v=T[A][A]*p,l=u;l<C;l++){for(m=0,c=u;c<M;c++)m+=T[c][A]*T[c][l];for(f=m/v,c=A;c<M;c++)T[c][l]=T[c][l]+f*T[c][A]}for(l=A;l<M;l++)T[l][A]=T[l][A]/p}else for(l=A;l<M;l++)T[l][A]=0;T[A][A]=T[A][A]+1}}for(a*=g,c=_-1;0<=c;c--)for(var L=0;L<50;L++){for(D=!1,u=c;0<=u;u--){if(Math.abs(S[u])<=a){D=!0;break}if(Math.abs(R[u-1])<=a)break}if(!D){for(d=0,h=u-(m=1),A=u;A<c+1&&(f=m*S[A],S[A]=d*S[A],!(Math.abs(f)<=a));A++)if(p=R[A],R[A]=Math.sqrt(f*f+p*p),d=p/(v=R[A]),m=-f/v,n)for(l=0;l<M;l++)y=T[l][h],x=T[l][A],T[l][h]=y*d+x*m,T[l][A]=-y*m+x*d}if(x=R[c],u===c){if(x<0&&(R[c]=-x,s))for(l=0;l<_;l++)E[l][c]=-E[l][c];break}for(g=R[u],f=(((y=R[c-1])-x)*(y+x)+((p=S[c-1])-(v=S[c]))*(p+v))/(2*v*y),p=Math.sqrt(f*f+1),f=((g-x)*(g+x)+v*(y/(f<0?f-p:f+p)-v))/g,A=u+(m=d=1);A<c+1;A++){if(p=S[A],y=R[A],v=m*p,p*=d,x=Math.sqrt(f*f+v*v),f=g*(d=f/(S[A-1]=x))+p*(m=v/x),p=-g*m+p*d,v=y*m,y*=d,s)for(l=0;l<_;l++)g=E[l][A-1],x=E[l][A],E[l][A-1]=g*d+x*m,E[l][A]=-g*m+x*d;if(x=Math.sqrt(f*f+v*v),f=(d=f/(R[A-1]=x))*p+(m=v/x)*y,g=-m*p+d*y,n)for(l=0;l<M;l++)y=T[l][A-1],x=T[l][A],T[l][A-1]=y*d+x*m,T[l][A]=-y*m+x*d}S[u]=0,S[c]=f,R[c]=g}for(A=0;A<_;A++)R[A]<a&&(R[A]=0);return{u:T,q:R,v:E}},i.VERSION="1.1.1",Object.defineProperty(i,"__esModule",{value:!0})})}),Ame=jm((e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=i;function i(r){if(r===null||r===!0||r===!1)return NaN;var n=Number(r);return isNaN(n)?n:n<0?Math.ceil(n):Math.floor(n)}t.exports=e.default}),Tme=jm((e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=i;function i(r){var n=new Date(Date.UTC(r.getFullYear(),r.getMonth(),r.getDate(),r.getHours(),r.getMinutes(),r.getSeconds(),r.getMilliseconds()));return n.setUTCFullYear(r.getFullYear()),r.getTime()-n.getTime()}t.exports=e.default}),Cme=jm((e,t)=>{function i(s,a){function o(){this.constructor=s}o.prototype=a.prototype,s.prototype=new o}function r(s,a,o,l){this.message=s,this.expected=a,this.found=o,this.location=l,this.name="SyntaxError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,r)}i(r,Error),r.buildMessage=function(s,a){var o={literal:function(p){return'"'+c(p.text)+'"'},class:function(p){var v="",m;for(m=0;m<p.parts.length;m++)v+=p.parts[m]instanceof Array?u(p.parts[m][0])+"-"+u(p.parts[m][1]):u(p.parts[m]);return"["+(p.inverted?"^":"")+v+"]"},any:function(p){return"any character"},end:function(p){return"end of input"},other:function(p){return p.description}};function l(p){return p.charCodeAt(0).toString(16).toUpperCase()}function c(p){return p.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(v){return"\\x0"+l(v)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(v){return"\\x"+l(v)})}function u(p){return p.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(v){return"\\x0"+l(v)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(v){return"\\x"+l(v)})}function h(p){return o[p.type](p)}function d(p){var v=new Array(p.length),m,g;for(m=0;m<p.length;m++)v[m]=h(p[m]);if(v.sort(),v.length>0){for(m=1,g=1;m<v.length;m++)v[m-1]!==v[m]&&(v[g]=v[m],g++);v.length=g}switch(v.length){case 1:return v[0];case 2:return v[0]+" or "+v[1];default:return v.slice(0,-1).join(", ")+", or "+v[v.length-1]}}function f(p){return p?'"'+c(p)+'"':"end of input"}return"Expected "+d(s)+" but "+f(a)+" found."};function n(s,a){a=a!==void 0?a:{};var o={},l={svg_path:dt},c=dt,u=function(Q){if(!Q)return[];for(var te=[],ye=0;ye<Q.length;ye++)te=te.concat.apply(te,Q[ye]);var ae=te[0];return ae&&ae.code=="m"&&(delete ae.relative,ae.code="M"),te},h=function(Q,te){return bt(Q,te)},d=/^[Mm]/,f=qe(["M","m"],!1,!1),p=function(Q,te,ye){var ae=zt(Q,[te]);return ye&&(ae=ae.concat(zt(Q=="M"?"L":"l",ye[1]))),ae},v=/^[Zz]/,m=qe(["Z","z"],!1,!1),g=function(){return zt("Z")},y=/^[Ll]/,x=qe(["L","l"],!1,!1),_=function(Q,te){return zt(Q,te)},M=/^[Hh]/,S=qe(["H","h"],!1,!1),T=function(Q,te){return zt(Q,te.map(function(ye){return{x:ye}}))},E=/^[Vv]/,C=qe(["V","v"],!1,!1),A=function(Q,te){return zt(Q,te.map(function(ye){return{y:ye}}))},D=/^[Cc]/,R=qe(["C","c"],!1,!1),L=function(Q,te,ye){return{x1:Q.x,y1:Q.y,x2:te.x,y2:te.y,x:ye.x,y:ye.y}},O=/^[Ss]/,H=qe(["S","s"],!1,!1),j=function(Q,te){return{x2:Q.x,y2:Q.y,x:te.x,y:te.y}},Y=/^[Qq]/,z=qe(["Q","q"],!1,!1),V=function(Q,te){return{x1:Q.x,y1:Q.y,x:te.x,y:te.y}},U=/^[Tt]/,k=qe(["T","t"],!1,!1),X=/^[Aa]/,re=qe(["A","a"],!1,!1),q=function(Q,te,ye,ae,Ee,rt){return{rx:Q,ry:te,xAxisRotation:ye,largeArc:ae,sweep:Ee,x:rt.x,y:rt.y}},ee=function(Q,te){return{x:Q,y:te}},$=function(Q){return Q*1},ne=function(Q){return Q.join("")*1},ce=/^[01]/,pe=qe(["0","1"],!1,!1),ge=function(Q){return Q=="1"},we=function(){return""},le=",",ve=ke(",",!1),ie=function(Q){return Q.join("")},Ce=".",Pe=ke(".",!1),Ne=/^[eE]/,be=qe(["e","E"],!1,!1),Le=/^[+\-]/,Fe=qe(["+","-"],!1,!1),K=/^[0-9]/,B=qe([["0","9"]],!1,!1),G=function(Q){return Q.join("")},oe=/^[ \t\n\r]/,fe=qe([" ","	",`
`,"\r"],!1,!1),W=0,Ie=[{line:1,column:1}],Oe=0,Be=[],Re;if("startRule"in a){if(!(a.startRule in l))throw new Error(`Can't start parsing from rule "`+a.startRule+'".');c=l[a.startRule]}function ke(Q,te){return{type:"literal",text:Q,ignoreCase:te}}function qe(Q,te,ye){return{type:"class",parts:Q,inverted:te,ignoreCase:ye}}function Ke(){return{type:"end"}}function it(Q){var te=Ie[Q],ye;if(te)return te;for(ye=Q-1;!Ie[ye];)ye--;for(te=Ie[ye],te={line:te.line,column:te.column};ye<Q;)s.charCodeAt(ye)===10?(te.line++,te.column=1):te.column++,ye++;return Ie[Q]=te,te}function He(Q,te){var ye=it(Q),ae=it(te);return{start:{offset:Q,line:ye.line,column:ye.column},end:{offset:te,line:ae.line,column:ae.column}}}function de(Q){W<Oe||(W>Oe&&(Oe=W,Be=[]),Be.push(Q))}function We(Q,te,ye){return new r(r.buildMessage(Q,te),Q,te,ye)}function dt(){var Q,te,ye,ae,Ee;for(Q=W,te=[],ye=lt();ye!==o;)te.push(ye),ye=lt();if(te!==o)if(ye=J(),ye===o&&(ye=null),ye!==o){for(ae=[],Ee=lt();Ee!==o;)ae.push(Ee),Ee=lt();ae!==o?(te=u(ye),Q=te):(W=Q,Q=o)}else W=Q,Q=o;else W=Q,Q=o;return Q}function J(){var Q,te,ye,ae,Ee,rt;if(Q=W,te=xe(),te!==o){for(ye=[],ae=W,Ee=[],rt=lt();rt!==o;)Ee.push(rt),rt=lt();for(Ee!==o?(rt=xe(),rt!==o?(Ee=[Ee,rt],ae=Ee):(W=ae,ae=o)):(W=ae,ae=o);ae!==o;){for(ye.push(ae),ae=W,Ee=[],rt=lt();rt!==o;)Ee.push(rt),rt=lt();Ee!==o?(rt=xe(),rt!==o?(Ee=[Ee,rt],ae=Ee):(W=ae,ae=o)):(W=ae,ae=o)}ye!==o?(te=h(te,ye),Q=te):(W=Q,Q=o)}else W=Q,Q=o;return Q}function xe(){var Q,te,ye,ae,Ee,rt;if(Q=W,te=ze(),te!==o){for(ye=[],ae=W,Ee=[],rt=lt();rt!==o;)Ee.push(rt),rt=lt();for(Ee!==o?(rt=me(),rt!==o?(Ee=[Ee,rt],ae=Ee):(W=ae,ae=o)):(W=ae,ae=o);ae!==o;){for(ye.push(ae),ae=W,Ee=[],rt=lt();rt!==o;)Ee.push(rt),rt=lt();Ee!==o?(rt=me(),rt!==o?(Ee=[Ee,rt],ae=Ee):(W=ae,ae=o)):(W=ae,ae=o)}ye!==o?(te=h(te,ye),Q=te):(W=Q,Q=o)}else W=Q,Q=o;return Q}function me(){var Q;return Q=Ze(),Q===o&&(Q=Je(),Q===o&&(Q=St(),Q===o&&(Q=vt(),Q===o&&(Q=ui(),Q===o&&(Q=xn(),Q===o&&(Q=ue(),Q===o&&(Q=Ge(),Q===o&&(Q=It())))))))),Q}function ze(){var Q,te,ye,ae,Ee,rt,Ct;if(Q=W,d.test(s.charAt(W))?(te=s.charAt(W),W++):(te=o,de(f)),te!==o){for(ye=[],ae=lt();ae!==o;)ye.push(ae),ae=lt();ye!==o?(ae=Vt(),ae!==o?(Ee=W,rt=si(),rt===o&&(rt=null),rt!==o?(Ct=mt(),Ct!==o?(rt=[rt,Ct],Ee=rt):(W=Ee,Ee=o)):(W=Ee,Ee=o),Ee===o&&(Ee=null),Ee!==o?(te=p(te,ae,Ee),Q=te):(W=Q,Q=o)):(W=Q,Q=o)):(W=Q,Q=o)}else W=Q,Q=o;return Q}function Ze(){var Q,te;return Q=W,v.test(s.charAt(W))?(te=s.charAt(W),W++):(te=o,de(m)),te!==o&&(te=g()),Q=te,Q}function Je(){var Q,te,ye,ae;if(Q=W,y.test(s.charAt(W))?(te=s.charAt(W),W++):(te=o,de(x)),te!==o){for(ye=[],ae=lt();ae!==o;)ye.push(ae),ae=lt();ye!==o?(ae=mt(),ae!==o?(te=_(te,ae),Q=te):(W=Q,Q=o)):(W=Q,Q=o)}else W=Q,Q=o;return Q}function mt(){var Q,te,ye,ae,Ee,rt;if(Q=W,te=Vt(),te!==o){for(ye=[],ae=W,Ee=si(),Ee===o&&(Ee=null),Ee!==o?(rt=Vt(),rt!==o?(Ee=[Ee,rt],ae=Ee):(W=ae,ae=o)):(W=ae,ae=o);ae!==o;)ye.push(ae),ae=W,Ee=si(),Ee===o&&(Ee=null),Ee!==o?(rt=Vt(),rt!==o?(Ee=[Ee,rt],ae=Ee):(W=ae,ae=o)):(W=ae,ae=o);ye!==o?(te=h(te,ye),Q=te):(W=Q,Q=o)}else W=Q,Q=o;return Q}function St(){var Q,te,ye,ae;if(Q=W,M.test(s.charAt(W))?(te=s.charAt(W),W++):(te=o,de(S)),te!==o){for(ye=[],ae=lt();ae!==o;)ye.push(ae),ae=lt();ye!==o?(ae=Mt(),ae!==o?(te=T(te,ae),Q=te):(W=Q,Q=o)):(W=Q,Q=o)}else W=Q,Q=o;return Q}function Mt(){var Q,te,ye,ae,Ee,rt;if(Q=W,te=li(),te!==o){for(ye=[],ae=W,Ee=si(),Ee===o&&(Ee=null),Ee!==o?(rt=li(),rt!==o?(Ee=[Ee,rt],ae=Ee):(W=ae,ae=o)):(W=ae,ae=o);ae!==o;)ye.push(ae),ae=W,Ee=si(),Ee===o&&(Ee=null),Ee!==o?(rt=li(),rt!==o?(Ee=[Ee,rt],ae=Ee):(W=ae,ae=o)):(W=ae,ae=o);ye!==o?(te=h(te,ye),Q=te):(W=Q,Q=o)}else W=Q,Q=o;return Q}function vt(){var Q,te,ye,ae;if(Q=W,E.test(s.charAt(W))?(te=s.charAt(W),W++):(te=o,de(C)),te!==o){for(ye=[],ae=lt();ae!==o;)ye.push(ae),ae=lt();ye!==o?(ae=Mt(),ae!==o?(te=A(te,ae),Q=te):(W=Q,Q=o)):(W=Q,Q=o)}else W=Q,Q=o;return Q}function ui(){var Q,te,ye,ae;if(Q=W,D.test(s.charAt(W))?(te=s.charAt(W),W++):(te=o,de(R)),te!==o){for(ye=[],ae=lt();ae!==o;)ye.push(ae),ae=lt();ye!==o?(ae=hi(),ae!==o?(te=_(te,ae),Q=te):(W=Q,Q=o)):(W=Q,Q=o)}else W=Q,Q=o;return Q}function hi(){var Q,te,ye,ae,Ee,rt;if(Q=W,te=$i(),te!==o){for(ye=[],ae=W,Ee=si(),Ee===o&&(Ee=null),Ee!==o?(rt=$i(),rt!==o?(Ee=[Ee,rt],ae=Ee):(W=ae,ae=o)):(W=ae,ae=o);ae!==o;)ye.push(ae),ae=W,Ee=si(),Ee===o&&(Ee=null),Ee!==o?(rt=$i(),rt!==o?(Ee=[Ee,rt],ae=Ee):(W=ae,ae=o)):(W=ae,ae=o);ye!==o?(te=h(te,ye),Q=te):(W=Q,Q=o)}else W=Q,Q=o;return Q}function $i(){var Q,te,ye,ae,Ee,rt;return Q=W,te=Vt(),te!==o?(ye=si(),ye===o&&(ye=null),ye!==o?(ae=Vt(),ae!==o?(Ee=si(),Ee===o&&(Ee=null),Ee!==o?(rt=Vt(),rt!==o?(te=L(te,ae,rt),Q=te):(W=Q,Q=o)):(W=Q,Q=o)):(W=Q,Q=o)):(W=Q,Q=o)):(W=Q,Q=o),Q}function xn(){var Q,te,ye,ae;if(Q=W,O.test(s.charAt(W))?(te=s.charAt(W),W++):(te=o,de(H)),te!==o){for(ye=[],ae=lt();ae!==o;)ye.push(ae),ae=lt();ye!==o?(ae=Or(),ae!==o?(te=_(te,ae),Q=te):(W=Q,Q=o)):(W=Q,Q=o)}else W=Q,Q=o;return Q}function Or(){var Q,te,ye,ae,Ee,rt;if(Q=W,te=zr(),te!==o){for(ye=[],ae=W,Ee=si(),Ee===o&&(Ee=null),Ee!==o?(rt=zr(),rt!==o?(Ee=[Ee,rt],ae=Ee):(W=ae,ae=o)):(W=ae,ae=o);ae!==o;)ye.push(ae),ae=W,Ee=si(),Ee===o&&(Ee=null),Ee!==o?(rt=zr(),rt!==o?(Ee=[Ee,rt],ae=Ee):(W=ae,ae=o)):(W=ae,ae=o);ye!==o?(te=h(te,ye),Q=te):(W=Q,Q=o)}else W=Q,Q=o;return Q}function zr(){var Q,te,ye,ae;return Q=W,te=Vt(),te!==o?(ye=si(),ye===o&&(ye=null),ye!==o?(ae=Vt(),ae!==o?(te=j(te,ae),Q=te):(W=Q,Q=o)):(W=Q,Q=o)):(W=Q,Q=o),Q}function ue(){var Q,te,ye,ae;if(Q=W,Y.test(s.charAt(W))?(te=s.charAt(W),W++):(te=o,de(z)),te!==o){for(ye=[],ae=lt();ae!==o;)ye.push(ae),ae=lt();ye!==o?(ae=Xe(),ae!==o?(te=_(te,ae),Q=te):(W=Q,Q=o)):(W=Q,Q=o)}else W=Q,Q=o;return Q}function Xe(){var Q,te,ye,ae,Ee,rt;if(Q=W,te=et(),te!==o){for(ye=[],ae=W,Ee=si(),Ee===o&&(Ee=null),Ee!==o?(rt=et(),rt!==o?(Ee=[Ee,rt],ae=Ee):(W=ae,ae=o)):(W=ae,ae=o);ae!==o;)ye.push(ae),ae=W,Ee=si(),Ee===o&&(Ee=null),Ee!==o?(rt=et(),rt!==o?(Ee=[Ee,rt],ae=Ee):(W=ae,ae=o)):(W=ae,ae=o);ye!==o?(te=h(te,ye),Q=te):(W=Q,Q=o)}else W=Q,Q=o;return Q}function et(){var Q,te,ye,ae;return Q=W,te=Vt(),te!==o?(ye=si(),ye===o&&(ye=null),ye!==o?(ae=Vt(),ae!==o?(te=V(te,ae),Q=te):(W=Q,Q=o)):(W=Q,Q=o)):(W=Q,Q=o),Q}function Ge(){var Q,te,ye,ae;if(Q=W,U.test(s.charAt(W))?(te=s.charAt(W),W++):(te=o,de(k)),te!==o){for(ye=[],ae=lt();ae!==o;)ye.push(ae),ae=lt();ye!==o?(ae=nt(),ae!==o?(te=_(te,ae),Q=te):(W=Q,Q=o)):(W=Q,Q=o)}else W=Q,Q=o;return Q}function nt(){var Q,te,ye,ae,Ee,rt;if(Q=W,te=Vt(),te!==o){for(ye=[],ae=W,Ee=si(),Ee===o&&(Ee=null),Ee!==o?(rt=Vt(),rt!==o?(Ee=[Ee,rt],ae=Ee):(W=ae,ae=o)):(W=ae,ae=o);ae!==o;)ye.push(ae),ae=W,Ee=si(),Ee===o&&(Ee=null),Ee!==o?(rt=Vt(),rt!==o?(Ee=[Ee,rt],ae=Ee):(W=ae,ae=o)):(W=ae,ae=o);ye!==o?(te=h(te,ye),Q=te):(W=Q,Q=o)}else W=Q,Q=o;return Q}function It(){var Q,te,ye,ae;if(Q=W,X.test(s.charAt(W))?(te=s.charAt(W),W++):(te=o,de(re)),te!==o){for(ye=[],ae=lt();ae!==o;)ye.push(ae),ae=lt();ye!==o?(ae=jt(),ae!==o?(te=_(te,ae),Q=te):(W=Q,Q=o)):(W=Q,Q=o)}else W=Q,Q=o;return Q}function jt(){var Q,te,ye,ae,Ee,rt;if(Q=W,te=Jt(),te!==o){for(ye=[],ae=W,Ee=si(),Ee===o&&(Ee=null),Ee!==o?(rt=Jt(),rt!==o?(Ee=[Ee,rt],ae=Ee):(W=ae,ae=o)):(W=ae,ae=o);ae!==o;)ye.push(ae),ae=W,Ee=si(),Ee===o&&(Ee=null),Ee!==o?(rt=Jt(),rt!==o?(Ee=[Ee,rt],ae=Ee):(W=ae,ae=o)):(W=ae,ae=o);ye!==o?(te=h(te,ye),Q=te):(W=Q,Q=o)}else W=Q,Q=o;return Q}function Jt(){var Q,te,ye,ae,Ee,rt,Ct,Di,pi,qr,es,xr;return Q=W,te=Ei(),te!==o?(ye=si(),ye===o&&(ye=null),ye!==o?(ae=Ei(),ae!==o?(Ee=si(),Ee===o&&(Ee=null),Ee!==o?(rt=li(),rt!==o?(Ct=si(),Ct!==o?(Di=fi(),Di!==o?(pi=si(),pi===o&&(pi=null),pi!==o?(qr=fi(),qr!==o?(es=si(),es===o&&(es=null),es!==o?(xr=Vt(),xr!==o?(te=q(te,ae,rt,Di,qr,xr),Q=te):(W=Q,Q=o)):(W=Q,Q=o)):(W=Q,Q=o)):(W=Q,Q=o)):(W=Q,Q=o)):(W=Q,Q=o)):(W=Q,Q=o)):(W=Q,Q=o)):(W=Q,Q=o)):(W=Q,Q=o)):(W=Q,Q=o),Q}function Vt(){var Q,te,ye,ae;return Q=W,te=li(),te!==o?(ye=si(),ye===o&&(ye=null),ye!==o?(ae=li(),ae!==o?(te=ee(te,ae),Q=te):(W=Q,Q=o)):(W=Q,Q=o)):(W=Q,Q=o),Q}function Ei(){var Q,te;return Q=W,te=Ue(),te===o&&(te=pt()),te!==o&&(te=$(te)),Q=te,Q}function li(){var Q,te,ye,ae;return Q=W,te=W,ye=De(),ye===o&&(ye=null),ye!==o?(ae=Ue(),ae!==o?(ye=[ye,ae],te=ye):(W=te,te=o)):(W=te,te=o),te===o&&(te=W,ye=De(),ye===o&&(ye=null),ye!==o?(ae=pt(),ae!==o?(ye=[ye,ae],te=ye):(W=te,te=o)):(W=te,te=o)),te!==o&&(te=ne(te)),Q=te,Q}function fi(){var Q,te;return Q=W,ce.test(s.charAt(W))?(te=s.charAt(W),W++):(te=o,de(pe)),te!==o&&(te=ge(te)),Q=te,Q}function si(){var Q,te,ye,ae,Ee;if(Q=W,te=[],ye=lt(),ye!==o)for(;ye!==o;)te.push(ye),ye=lt();else te=o;if(te!==o)if(ye=se(),ye===o&&(ye=null),ye!==o){for(ae=[],Ee=lt();Ee!==o;)ae.push(Ee),Ee=lt();ae!==o?(te=[te,ye,ae],Q=te):(W=Q,Q=o)}else W=Q,Q=o;else W=Q,Q=o;if(Q===o){if(Q=W,te=W,ye=se(),ye!==o){for(ae=[],Ee=lt();Ee!==o;)ae.push(Ee),Ee=lt();ae!==o?(ye=[ye,ae],te=ye):(W=te,te=o)}else W=te,te=o;te!==o&&(te=we()),Q=te}return Q}function se(){var Q;return s.charCodeAt(W)===44?(Q=le,W++):(Q=o,de(ve)),Q}function Ue(){var Q,te,ye,ae;return Q=W,te=W,ye=Qe(),ye!==o?(ae=Ae(),ae===o&&(ae=null),ae!==o?(ye=[ye,ae],te=ye):(W=te,te=o)):(W=te,te=o),te===o&&(te=W,ye=pt(),ye!==o?(ae=Ae(),ae!==o?(ye=[ye,ae],te=ye):(W=te,te=o)):(W=te,te=o)),te!==o&&(te=ie(te)),Q=te,Q}function Qe(){var Q,te,ye,ae,Ee;return Q=W,te=W,ye=pt(),ye===o&&(ye=null),ye!==o?(s.charCodeAt(W)===46?(ae=Ce,W++):(ae=o,de(Pe)),ae!==o?(Ee=pt(),Ee!==o?(ye=[ye,ae,Ee],te=ye):(W=te,te=o)):(W=te,te=o)):(W=te,te=o),te===o&&(te=W,ye=pt(),ye!==o?(s.charCodeAt(W)===46?(ae=Ce,W++):(ae=o,de(Pe)),ae!==o?(ye=[ye,ae],te=ye):(W=te,te=o)):(W=te,te=o)),te!==o&&(te=ie(te)),Q=te,Q}function Ae(){var Q,te,ye,ae,Ee;return Q=W,te=W,Ne.test(s.charAt(W))?(ye=s.charAt(W),W++):(ye=o,de(be)),ye!==o?(ae=De(),ae===o&&(ae=null),ae!==o?(Ee=pt(),Ee!==o?(ye=[ye,ae,Ee],te=ye):(W=te,te=o)):(W=te,te=o)):(W=te,te=o),te!==o&&(te=ie(te)),Q=te,Q}function De(){var Q;return Le.test(s.charAt(W))?(Q=s.charAt(W),W++):(Q=o,de(Fe)),Q}function pt(){var Q,te,ye;if(Q=W,te=[],K.test(s.charAt(W))?(ye=s.charAt(W),W++):(ye=o,de(B)),ye!==o)for(;ye!==o;)te.push(ye),K.test(s.charAt(W))?(ye=s.charAt(W),W++):(ye=o,de(B));else te=o;return te!==o&&(te=G(te)),Q=te,Q}function lt(){var Q,te;return Q=W,oe.test(s.charAt(W))?(te=s.charAt(W),W++):(te=o,de(fe)),te!==o&&(te=we()),Q=te,Q}function bt(Q,te){if(!te)return[Q];for(var ye=[Q],ae=0,Ee=te.length;ae<Ee;ae++)ye[ae+1]=te[ae][1];return ye}var Et={m:"moveto",l:"lineto",h:"horizontal lineto",v:"vertical lineto",c:"curveto",s:"smooth curveto",q:"quadratic curveto",t:"smooth quadratic curveto",a:"elliptical arc",z:"closepath"};for(var Ft in Et)Et[Ft.toUpperCase()]=Et[Ft];function zt(Q,te){te||(te=[{}]);for(var ye=te.length;ye--;){var ae={code:Q,command:Et[Q]};Q==Q.toLowerCase()&&(ae.relative=!0);for(var Ee in te[ye])ae[Ee]=te[ye][Ee];te[ye]=ae}return te}if(Re=c(),Re!==o&&W===s.length)return Re;throw Re!==o&&W<s.length&&de(Ke()),We(Be,Oe<s.length?s.charAt(Oe):null,Oe<s.length?He(Oe,Oe+1):He(Oe,Oe))}t.exports={SyntaxError:r,parse:n}}),_J=jm((e,t)=>{var i=Cme().parse;i.parseSVG=i,i.makeAbsolute=r,t.exports=i;function r(n){var s,a={x:0,y:0},o={x:"x0",y:"y0",x1:"x0",y1:"y0",x2:"x0",y2:"y0"};return n.forEach(function(l){l.command==="moveto"&&(s=l),l.x0=a.x,l.y0=a.y;for(var c in o)c in l&&(l[c]+=l.relative?l[o[c]]:0);"x"in l||(l.x=a.x),"y"in l||(l.y=a.y),l.relative=!1,l.code=l.code.toUpperCase(),l.command=="closepath"&&(l.x=s.x,l.y=s.y),a=l}),n}}),Pme=jm((e,t)=>{t.exports=function(i,r){for(var n=i.split("."),s=r.split("."),a=0;a<3;a++){var o=Number(n[a]),l=Number(s[a]);if(o>l)return 1;if(l>o)return-1;if(!isNaN(o)&&isNaN(l))return 1;if(isNaN(o)&&!isNaN(l))return-1}return 0}}),ny="149",Zo={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},Dme=0,BG=1,Rme=2,YU=1,Ime=2,nx=3,nc=0,ms=1,na=2,Ln=0,nm=1,FG=2,UG=3,NG=4,Lme=5,mv=100,Ome=101,zme=102,kG=103,VG=104,Bme=200,Fme=201,Ume=202,Nme=203,SJ=204,MJ=205,kme=206,Vme=207,Gme=208,Hme=209,jme=210,Wme=0,Xme=1,qme=2,kO=3,Yme=4,Qme=5,Zme=6,Kme=7,EJ=0,Jme=1,$me=2,Jc=0,ege=1,tge=2,ige=3,rge=4,nge=5,AJ=300,_m=301,Sm=302,VO=303,GO=304,Tb=306,lh=1e3,Tr=1001,HO=1002,Ci=1003,GG=1004,pD=1005,bi=1006,sge=1007,I0=1008,ca=1009,age=1010,oge=1011,TJ=1012,lge=1013,ch=1014,or=1015,Th=1016,cge=1017,uge=1018,sm=1020,hge=1021,Lr=1023,dge=1024,fge=1025,am=1026,Mm=1027,KE=1028,pge=1029,rA=1030,mge=1031,CJ=1033,mD=33776,gD=33777,vD=33778,yD=33779,HG=35840,jG=35841,WG=35842,XG=35843,gge=36196,qG=37492,YG=37496,QG=37808,ZG=37809,KG=37810,JG=37811,$G=37812,eH=37813,tH=37814,iH=37815,rH=37816,nH=37817,sH=37818,aH=37819,oH=37820,lH=37821,xD=36492,vge=36283,cH=36284,uH=36285,hH=36286,PJ=2200,DJ=2201,QU=2202,nA=2300,sA=2301,wD=2302,Gv=2400,Hv=2401,aA=2402,ZU=2500,yge=2501,sc=3e3,vi=3001,Uh=3200,RJ=3201,xge=0,wge=1,zc="srgb",oA="srgb-linear",bD=7680,bge=519,jO=35044,_ge=35048,WO="300 es",XO=1035,Vs=class{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});let i=this._listeners;i[e]===void 0&&(i[e]=[]),i[e].indexOf(t)===-1&&i[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;let i=this._listeners;return i[e]!==void 0&&i[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;let i=this._listeners[e];if(i!==void 0){let r=i.indexOf(t);r!==-1&&i.splice(r,1)}}dispatchEvent(e){if(this._listeners===void 0)return;let t=this._listeners[e.type];if(t!==void 0){e.target=this;let i=t.slice(0);for(let r=0,n=i.length;r<n;r++)i[r].call(this,e);e.target=null}}},Ys=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],dH=1234567,Px=Math.PI/180,Cw=180/Math.PI;function gl(){let e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,i=Math.random()*4294967295|0,r=Math.random()*4294967295|0;return(Ys[e&255]+Ys[e>>8&255]+Ys[e>>16&255]+Ys[e>>24&255]+"-"+Ys[t&255]+Ys[t>>8&255]+"-"+Ys[t>>16&15|64]+Ys[t>>24&255]+"-"+Ys[i&63|128]+Ys[i>>8&255]+"-"+Ys[i>>16&255]+Ys[i>>24&255]+Ys[r&255]+Ys[r>>8&255]+Ys[r>>16&255]+Ys[r>>24&255]).toLowerCase()}function Tn(e,t,i){return Math.max(t,Math.min(i,e))}function KU(e,t){return(e%t+t)%t}function Sge(e,t,i,r,n){return r+(e-t)*(n-r)/(i-t)}function Mge(e,t,i){return e!==t?(i-e)/(t-e):0}function Dx(e,t,i){return(1-i)*e+i*t}function Ege(e,t,i,r){return Dx(e,t,1-Math.exp(-i*r))}function Age(e,t=1){return t-Math.abs(KU(e,t*2)-t)}function Tge(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t),e*e*(3-2*e))}function Cge(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t),e*e*e*(e*(e*6-15)+10))}function Pge(e,t){return e+Math.floor(Math.random()*(t-e+1))}function Dge(e,t){return e+Math.random()*(t-e)}function Rge(e){return e*(.5-Math.random())}function Ige(e){e!==void 0&&(dH=e);let t=dH+=1831565813;return t=Math.imul(t^t>>>15,t|1),t^=t+Math.imul(t^t>>>7,t|61),((t^t>>>14)>>>0)/4294967296}function Lge(e){return e*Px}function Oge(e){return e*Cw}function qO(e){return(e&e-1)===0&&e!==0}function IJ(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function lA(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}function zge(e,t,i,r,n){let s=Math.cos,a=Math.sin,o=s(i/2),l=a(i/2),c=s((t+r)/2),u=a((t+r)/2),h=s((t-r)/2),d=a((t-r)/2),f=s((r-t)/2),p=a((r-t)/2);switch(n){case"XYX":e.set(o*u,l*h,l*d,o*c);break;case"YZY":e.set(l*d,o*u,l*h,o*c);break;case"ZXZ":e.set(l*h,l*d,o*u,o*c);break;case"XZX":e.set(o*u,l*p,l*f,o*c);break;case"YXY":e.set(l*f,o*u,l*p,o*c);break;case"ZYZ":e.set(l*p,l*f,o*u,o*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+n)}}function uh(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}function vr(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return Math.round(e*65535);case Uint8Array:return Math.round(e*255);case Int16Array:return Math.round(e*32767);case Int8Array:return Math.round(e*127);default:throw new Error("Invalid component type.")}}var Tt=Object.freeze({__proto__:null,DEG2RAD:Px,RAD2DEG:Cw,ceilPowerOfTwo:IJ,clamp:Tn,damp:Ege,degToRad:Lge,denormalize:uh,euclideanModulo:KU,floorPowerOfTwo:lA,generateUUID:gl,inverseLerp:Mge,isPowerOfTwo:qO,lerp:Dx,mapLinear:Sge,normalize:vr,pingpong:Age,radToDeg:Oge,randFloat:Dge,randFloatSpread:Rge,randInt:Pge,seededRandom:Ige,setQuaternionFromProperEuler:zge,smootherstep:Cge,smoothstep:Tge}),Me=class{constructor(e=0,t=0){Me.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){let t=this.x,i=this.y,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6],this.y=r[1]*t+r[4]*i+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){let i=Math.cos(t),r=Math.sin(t),n=this.x-e.x,s=this.y-e.y;return this.x=n*i-s*r+e.x,this.y=n*r+s*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}},Dn=class{constructor(){Dn.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(e,t,i,r,n,s,a,o,l){let c=this.elements;return c[0]=e,c[1]=r,c[2]=a,c[3]=t,c[4]=n,c[5]=o,c[6]=i,c[7]=s,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){let t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){let t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){let i=e.elements,r=t.elements,n=this.elements,s=i[0],a=i[3],o=i[6],l=i[1],c=i[4],u=i[7],h=i[2],d=i[5],f=i[8],p=r[0],v=r[3],m=r[6],g=r[1],y=r[4],x=r[7],_=r[2],M=r[5],S=r[8];return n[0]=s*p+a*g+o*_,n[3]=s*v+a*y+o*M,n[6]=s*m+a*x+o*S,n[1]=l*p+c*g+u*_,n[4]=l*v+c*y+u*M,n[7]=l*m+c*x+u*S,n[2]=h*p+d*g+f*_,n[5]=h*v+d*y+f*M,n[8]=h*m+d*x+f*S,this}multiplyScalar(e){let t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){let e=this.elements,t=e[0],i=e[1],r=e[2],n=e[3],s=e[4],a=e[5],o=e[6],l=e[7],c=e[8];return t*s*c-t*a*l-i*n*c+i*a*o+r*n*l-r*s*o}invert(){let e=this.elements,t=e[0],i=e[1],r=e[2],n=e[3],s=e[4],a=e[5],o=e[6],l=e[7],c=e[8],u=c*s-a*l,h=a*o-c*n,d=l*n-s*o,f=t*u+i*h+r*d;if(f===0)return this.set(0,0,0,0,0,0,0,0,0);let p=1/f;return e[0]=u*p,e[1]=(r*l-c*i)*p,e[2]=(a*i-r*s)*p,e[3]=h*p,e[4]=(c*t-r*o)*p,e[5]=(r*n-a*t)*p,e[6]=d*p,e[7]=(i*o-l*t)*p,e[8]=(s*t-i*n)*p,this}transpose(){let e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){let t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,r,n,s,a){let o=Math.cos(n),l=Math.sin(n);return this.set(i*o,i*l,-i*(o*s+l*a)+s+e,-r*l,r*o,-r*(-l*s+o*a)+a+t,0,0,1),this}scale(e,t){return this.premultiply(_D.makeScale(e,t)),this}rotate(e){return this.premultiply(_D.makeRotation(-e)),this}translate(e,t){return this.premultiply(_D.makeTranslation(e,t)),this}makeTranslation(e,t){return this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){let t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,i,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){let t=this.elements,i=e.elements;for(let r=0;r<9;r++)if(t[r]!==i[r])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){let i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return new this.constructor().fromArray(this.elements)}},_D=new Dn;function LJ(e){for(let t=e.length-1;t>=0;--t)if(e[t]>=65535)return!0;return!1}var Bge={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function fS(e,t){return new Bge[e](t)}function Pw(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function Fge(e,t,i){return new Promise(function(r,n){function s(){switch(e.clientWaitSync(t,e.SYNC_FLUSH_COMMANDS_BIT,0)){case e.WAIT_FAILED:n();break;case e.TIMEOUT_EXPIRED:setTimeout(s,i);break;default:r()}}setTimeout(s,i)})}function om(e){return e<.04045?e*.0773993808:Math.pow(e*.9478672986+.0521327014,2.4)}function JE(e){return e<.0031308?e*12.92:1.055*Math.pow(e,.41666)-.055}var SD={[zc]:{[oA]:om},[oA]:{[zc]:JE}},ya={legacyMode:!0,get workingColorSpace(){return oA},set workingColorSpace(e){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(e,t,i){if(this.legacyMode||t===i||!t||!i)return e;if(SD[t]&&SD[t][i]!==void 0){let r=SD[t][i];return e.r=r(e.r),e.g=r(e.g),e.b=r(e.b),e}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(e,t){return this.convert(e,this.workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this.workingColorSpace)}},OJ={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Nn={r:0,g:0,b:0},Al={h:0,s:0,l:0},pS={h:0,s:0,l:0};function MD(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+(t-e)*6*i:i<1/2?t:i<2/3?e+(t-e)*6*(2/3-i):e}function mS(e,t){return t.r=e.r,t.g=e.g,t.b=e.b,t}var Yt=class{constructor(e,t,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,t===void 0&&i===void 0?this.set(e):this.setRGB(e,t,i)}set(e){return e&&e.isColor?this.copy(e):typeof e=="number"?this.setHex(e):typeof e=="string"&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=zc){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,ya.toWorkingColorSpace(this,t),this}setRGB(e,t,i,r=ya.workingColorSpace){return this.r=e,this.g=t,this.b=i,ya.toWorkingColorSpace(this,r),this}setHSL(e,t,i,r=ya.workingColorSpace){if(e=KU(e,1),t=Tn(t,0,1),i=Tn(i,0,1),t===0)this.r=this.g=this.b=i;else{let n=i<=.5?i*(1+t):i+t-i*t,s=2*i-n;this.r=MD(s,n,e+1/3),this.g=MD(s,n,e),this.b=MD(s,n,e-1/3)}return ya.toWorkingColorSpace(this,r),this}setStyle(e,t=zc){function i(n){n!==void 0&&parseFloat(n)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let r;if(r=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let n,s=r[1],a=r[2];switch(s){case"rgb":case"rgba":if(n=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return this.r=Math.min(255,parseInt(n[1],10))/255,this.g=Math.min(255,parseInt(n[2],10))/255,this.b=Math.min(255,parseInt(n[3],10))/255,ya.toWorkingColorSpace(this,t),i(n[4]),this;if(n=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return this.r=Math.min(100,parseInt(n[1],10))/100,this.g=Math.min(100,parseInt(n[2],10))/100,this.b=Math.min(100,parseInt(n[3],10))/100,ya.toWorkingColorSpace(this,t),i(n[4]),this;break;case"hsl":case"hsla":if(n=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a)){let o=parseFloat(n[1])/360,l=parseFloat(n[2])/100,c=parseFloat(n[3])/100;return i(n[4]),this.setHSL(o,l,c,t)}break}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(e)){let n=r[1],s=n.length;if(s===3)return this.r=parseInt(n.charAt(0)+n.charAt(0),16)/255,this.g=parseInt(n.charAt(1)+n.charAt(1),16)/255,this.b=parseInt(n.charAt(2)+n.charAt(2),16)/255,ya.toWorkingColorSpace(this,t),this;if(s===6)return this.r=parseInt(n.charAt(0)+n.charAt(1),16)/255,this.g=parseInt(n.charAt(2)+n.charAt(3),16)/255,this.b=parseInt(n.charAt(4)+n.charAt(5),16)/255,ya.toWorkingColorSpace(this,t),this}return e&&e.length>0?this.setColorName(e,t):this}setColorName(e,t=zc){let i=OJ[e.toLowerCase()];return i!==void 0?this.setHex(i,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=om(e.r),this.g=om(e.g),this.b=om(e.b),this}copyLinearToSRGB(e){return this.r=JE(e.r),this.g=JE(e.g),this.b=JE(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=zc){return ya.fromWorkingColorSpace(mS(this,Nn),e),Tn(Nn.r*255,0,255)<<16^Tn(Nn.g*255,0,255)<<8^Tn(Nn.b*255,0,255)<<0}getHexString(e=zc){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=ya.workingColorSpace){ya.fromWorkingColorSpace(mS(this,Nn),t);let i=Nn.r,r=Nn.g,n=Nn.b,s=Math.max(i,r,n),a=Math.min(i,r,n),o,l,c=(a+s)/2;if(a===s)o=0,l=0;else{let u=s-a;switch(l=c<=.5?u/(s+a):u/(2-s-a),s){case i:o=(r-n)/u+(r<n?6:0);break;case r:o=(n-i)/u+2;break;case n:o=(i-r)/u+4;break}o/=6}return e.h=o,e.s=l,e.l=c,e}getRGB(e,t=ya.workingColorSpace){return ya.fromWorkingColorSpace(mS(this,Nn),t),e.r=Nn.r,e.g=Nn.g,e.b=Nn.b,e}getStyle(e=zc){return ya.fromWorkingColorSpace(mS(this,Nn),e),e!==zc?`color(${e} ${Nn.r} ${Nn.g} ${Nn.b})`:`rgb(${Nn.r*255|0},${Nn.g*255|0},${Nn.b*255|0})`}offsetHSL(e,t,i){return this.getHSL(Al),Al.h+=e,Al.s+=t,Al.l+=i,this.setHSL(Al.h,Al.s,Al.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,i){return this.r=e.r+(t.r-e.r)*i,this.g=e.g+(t.g-e.g)*i,this.b=e.b+(t.b-e.b)*i,this}lerpHSL(e,t){this.getHSL(Al),e.getHSL(pS);let i=Dx(Al.h,pS.h,t),r=Dx(Al.s,pS.s,t),n=Dx(Al.l,pS.l,t);return this.setHSL(i,r,n),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}};Yt.NAMES=OJ;var gg,zJ=class{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{gg===void 0&&(gg=Pw("canvas")),gg.width=e.width,gg.height=e.height;let i=gg.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=gg}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){let t=Pw("canvas");t.width=e.width,t.height=e.height;let i=t.getContext("2d");i.drawImage(e,0,0,e.width,e.height);let r=i.getImageData(0,0,e.width,e.height),n=r.data;for(let s=0;s<n.length;s++)n[s]=om(n[s]/255)*255;return i.putImageData(r,0,0),t}else if(e.data){let t=e.data.slice(0);for(let i=0;i<t.length;i++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[i]=Math.floor(om(t[i]/255)*255):t[i]=om(t[i]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}},BJ=class{constructor(t=null){this.isSource=!0,this.uuid=gl(),this.data=t,this.version=0}set needsUpdate(t){t===!0&&this.version++}toJSON(t){let i=t===void 0||typeof t=="string";if(!i&&t.images[this.uuid]!==void 0)return t.images[this.uuid];let r={uuid:this.uuid,url:""},n=this.data;if(n!==null){let s;if(Array.isArray(n)){s=[];for(let a=0,o=n.length;a<o;a++)n[a].isDataTexture?s.push(ED(n[a].image)):s.push(ED(n[a]))}else s=ED(n);r.url=s}return i||(t.images[this.uuid]=r),r}};function ED(e){return typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap?zJ.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}var Uge=0,jr=class extends Vs{constructor(e=jr.DEFAULT_IMAGE,t=jr.DEFAULT_MAPPING,i=Tr,r=Tr,n=bi,s=I0,a=Lr,o=ca,l=jr.DEFAULT_ANISOTROPY,c=sc){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Uge++}),this.uuid=gl(),this.name="",this.source=new BJ(e),this.mipmaps=[],this.mapping=t,this.wrapS=i,this.wrapT=r,this.magFilter=n,this.minFilter=s,this.anisotropy=l,this.format=a,this.internalFormat=null,this.type=o,this.offset=new Me(0,0),this.repeat=new Me(1,1),this.center=new Me(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Dn,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=c,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){let t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];let i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),t||(e.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==AJ)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case lh:e.x=e.x-Math.floor(e.x);break;case Tr:e.x=e.x<0?0:1;break;case HO:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case lh:e.y=e.y-Math.floor(e.y);break;case Tr:e.y=e.y<0?0:1;break;case HO:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}};jr.DEFAULT_IMAGE=null;jr.DEFAULT_MAPPING=AJ;jr.DEFAULT_ANISOTROPY=1;var ai=class{constructor(e=0,t=0,i=0,r=1){ai.prototype.isVector4=!0,this.x=e,this.y=t,this.z=i,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){let t=this.x,i=this.y,r=this.z,n=this.w,s=e.elements;return this.x=s[0]*t+s[4]*i+s[8]*r+s[12]*n,this.y=s[1]*t+s[5]*i+s[9]*r+s[13]*n,this.z=s[2]*t+s[6]*i+s[10]*r+s[14]*n,this.w=s[3]*t+s[7]*i+s[11]*r+s[15]*n,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);let t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,r,n,s=e.elements,a=s[0],o=s[4],l=s[8],c=s[1],u=s[5],h=s[9],d=s[2],f=s[6],p=s[10];if(Math.abs(o-c)<.01&&Math.abs(l-d)<.01&&Math.abs(h-f)<.01){if(Math.abs(o+c)<.1&&Math.abs(l+d)<.1&&Math.abs(h+f)<.1&&Math.abs(a+u+p-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;let m=(a+1)/2,g=(u+1)/2,y=(p+1)/2,x=(o+c)/4,_=(l+d)/4,M=(h+f)/4;return m>g&&m>y?m<.01?(i=0,r=.707106781,n=.707106781):(i=Math.sqrt(m),r=x/i,n=_/i):g>y?g<.01?(i=.707106781,r=0,n=.707106781):(r=Math.sqrt(g),i=x/r,n=M/r):y<.01?(i=.707106781,r=.707106781,n=0):(n=Math.sqrt(y),i=_/n,r=M/n),this.set(i,r,n,t),this}let v=Math.sqrt((f-h)*(f-h)+(l-d)*(l-d)+(c-o)*(c-o));return Math.abs(v)<.001&&(v=1),this.x=(f-h)/v,this.y=(l-d)/v,this.z=(c-o)/v,this.w=Math.acos((a+u+p-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}},Ni=class extends Vs{constructor(e=1,t=1,i={}){super(),this.isWebGLRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new ai(0,0,e,t),this.scissorTest=!1,this.viewport=new ai(0,0,e,t);let r={width:e,height:t,depth:1};this.texture=new jr(r,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=i.generateMipmaps!==void 0?i.generateMipmaps:!1,this.texture.internalFormat=i.internalFormat!==void 0?i.internalFormat:null,this.texture.minFilter=i.minFilter!==void 0?i.minFilter:bi,this.depthBuffer=i.depthBuffer!==void 0?i.depthBuffer:!0,this.stencilBuffer=i.stencilBuffer!==void 0?i.stencilBuffer:!1,this.depthTexture=i.depthTexture!==void 0?i.depthTexture:null,this.samples=i.samples!==void 0?i.samples:0}setSize(e,t,i=1){(this.width!==e||this.height!==t||this.depth!==i)&&(this.width=e,this.height=t,this.depth=i,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=i,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;let t=Object.assign({},e.texture.image);return this.texture.source=new BJ(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}},FJ=class extends jr{constructor(e=null,t=1,i=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:i,depth:r},this.magFilter=Ci,this.minFilter=Ci,this.wrapR=Tr,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},Nge=class extends jr{constructor(e=null,t=1,i=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:i,depth:r},this.magFilter=Ci,this.minFilter=Ci,this.wrapR=Tr,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},UJ=class extends Ni{constructor(e=1,t=1,i=1,r={}){super(e,t,r),this.isWebGLMultipleRenderTargets=!0;let n=this.texture;this.texture=[];for(let s=0;s<i;s++)this.texture[s]=n.clone(),this.texture[s].isRenderTargetTexture=!0}setSize(e,t,i=1){if(this.width!==e||this.height!==t||this.depth!==i){this.width=e,this.height=t,this.depth=i;for(let r=0,n=this.texture.length;r<n;r++)this.texture[r].image.width=e,this.texture[r].image.height=t,this.texture[r].image.depth=i;this.dispose()}return this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t),this}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.texture.length=0;for(let t=0,i=e.texture.length;t<i;t++)this.texture[t]=e.texture[t].clone(),this.texture[t].isRenderTargetTexture=!0;return this}},ri=class{constructor(e=0,t=0,i=0,r=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=i,this._w=r}static slerpFlat(e,t,i,r,n,s,a){let o=i[r+0],l=i[r+1],c=i[r+2],u=i[r+3],h=n[s+0],d=n[s+1],f=n[s+2],p=n[s+3];if(a===0){e[t+0]=o,e[t+1]=l,e[t+2]=c,e[t+3]=u;return}if(a===1){e[t+0]=h,e[t+1]=d,e[t+2]=f,e[t+3]=p;return}if(u!==p||o!==h||l!==d||c!==f){let v=1-a,m=o*h+l*d+c*f+u*p,g=m>=0?1:-1,y=1-m*m;if(y>Number.EPSILON){let _=Math.sqrt(y),M=Math.atan2(_,m*g);v=Math.sin(v*M)/_,a=Math.sin(a*M)/_}let x=a*g;if(o=o*v+h*x,l=l*v+d*x,c=c*v+f*x,u=u*v+p*x,v===1-a){let _=1/Math.sqrt(o*o+l*l+c*c+u*u);o*=_,l*=_,c*=_,u*=_}}e[t]=o,e[t+1]=l,e[t+2]=c,e[t+3]=u}static multiplyQuaternionsFlat(e,t,i,r,n,s){let a=i[r],o=i[r+1],l=i[r+2],c=i[r+3],u=n[s],h=n[s+1],d=n[s+2],f=n[s+3];return e[t]=a*f+c*u+o*d-l*h,e[t+1]=o*f+c*h+l*u-a*d,e[t+2]=l*f+c*d+a*h-o*u,e[t+3]=c*f-a*u-o*h-l*d,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,r){return this._x=e,this._y=t,this._z=i,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){let i=e._x,r=e._y,n=e._z,s=e._order,a=Math.cos,o=Math.sin,l=a(i/2),c=a(r/2),u=a(n/2),h=o(i/2),d=o(r/2),f=o(n/2);switch(s){case"XYZ":this._x=h*c*u+l*d*f,this._y=l*d*u-h*c*f,this._z=l*c*f+h*d*u,this._w=l*c*u-h*d*f;break;case"YXZ":this._x=h*c*u+l*d*f,this._y=l*d*u-h*c*f,this._z=l*c*f-h*d*u,this._w=l*c*u+h*d*f;break;case"ZXY":this._x=h*c*u-l*d*f,this._y=l*d*u+h*c*f,this._z=l*c*f+h*d*u,this._w=l*c*u-h*d*f;break;case"ZYX":this._x=h*c*u-l*d*f,this._y=l*d*u+h*c*f,this._z=l*c*f-h*d*u,this._w=l*c*u+h*d*f;break;case"YZX":this._x=h*c*u+l*d*f,this._y=l*d*u+h*c*f,this._z=l*c*f-h*d*u,this._w=l*c*u-h*d*f;break;case"XZY":this._x=h*c*u-l*d*f,this._y=l*d*u-h*c*f,this._z=l*c*f+h*d*u,this._w=l*c*u+h*d*f;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return t!==!1&&this._onChangeCallback(),this}setFromAxisAngle(e,t){let i=t/2,r=Math.sin(i);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){let t=e.elements,i=t[0],r=t[4],n=t[8],s=t[1],a=t[5],o=t[9],l=t[2],c=t[6],u=t[10],h=i+a+u;if(h>0){let d=.5/Math.sqrt(h+1);this._w=.25/d,this._x=(c-o)*d,this._y=(n-l)*d,this._z=(s-r)*d}else if(i>a&&i>u){let d=2*Math.sqrt(1+i-a-u);this._w=(c-o)/d,this._x=.25*d,this._y=(r+s)/d,this._z=(n+l)/d}else if(a>u){let d=2*Math.sqrt(1+a-i-u);this._w=(n-l)/d,this._x=(r+s)/d,this._y=.25*d,this._z=(o+c)/d}else{let d=2*Math.sqrt(1+u-i-a);this._w=(s-r)/d,this._x=(n+l)/d,this._y=(o+c)/d,this._z=.25*d}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Tn(this.dot(e),-1,1)))}rotateTowards(e,t){let i=this.angleTo(e);if(i===0)return this;let r=Math.min(1,t/i);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){let i=e._x,r=e._y,n=e._z,s=e._w,a=t._x,o=t._y,l=t._z,c=t._w;return this._x=i*c+s*a+r*l-n*o,this._y=r*c+s*o+n*a-i*l,this._z=n*c+s*l+i*o-r*a,this._w=s*c-i*a-r*o-n*l,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);let i=this._x,r=this._y,n=this._z,s=this._w,a=s*e._w+i*e._x+r*e._y+n*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=s,this._x=i,this._y=r,this._z=n,this;let o=1-a*a;if(o<=Number.EPSILON){let d=1-t;return this._w=d*s+t*this._w,this._x=d*i+t*this._x,this._y=d*r+t*this._y,this._z=d*n+t*this._z,this.normalize(),this._onChangeCallback(),this}let l=Math.sqrt(o),c=Math.atan2(l,a),u=Math.sin((1-t)*c)/l,h=Math.sin(t*c)/l;return this._w=s*u+this._w*h,this._x=i*u+this._x*h,this._y=r*u+this._y*h,this._z=n*u+this._z*h,this._onChangeCallback(),this}slerpQuaternions(e,t,i){return this.copy(e).slerp(t,i)}random(){let e=Math.random(),t=Math.sqrt(1-e),i=Math.sqrt(e),r=2*Math.PI*Math.random(),n=2*Math.PI*Math.random();return this.set(t*Math.cos(r),i*Math.sin(n),i*Math.cos(n),t*Math.sin(r))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}},N=class{constructor(t=0,i=0,r=0){N.prototype.isVector3=!0,this.x=t,this.y=i,this.z=r}set(t,i,r){return r===void 0&&(r=this.z),this.x=t,this.y=i,this.z=r,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,i){switch(t){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this}addScaledVector(t,i){return this.x+=t.x*i,this.y+=t.y*i,this.z+=t.z*i,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,i){return this.x=t.x*i.x,this.y=t.y*i.y,this.z=t.z*i.z,this}applyEuler(t){return this.applyQuaternion(fH.setFromEuler(t))}applyAxisAngle(t,i){return this.applyQuaternion(fH.setFromAxisAngle(t,i))}applyMatrix3(t){let i=this.x,r=this.y,n=this.z,s=t.elements;return this.x=s[0]*i+s[3]*r+s[6]*n,this.y=s[1]*i+s[4]*r+s[7]*n,this.z=s[2]*i+s[5]*r+s[8]*n,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){let i=this.x,r=this.y,n=this.z,s=t.elements,a=1/(s[3]*i+s[7]*r+s[11]*n+s[15]);return this.x=(s[0]*i+s[4]*r+s[8]*n+s[12])*a,this.y=(s[1]*i+s[5]*r+s[9]*n+s[13])*a,this.z=(s[2]*i+s[6]*r+s[10]*n+s[14])*a,this}applyQuaternion(t){let i=this.x,r=this.y,n=this.z,s=t.x,a=t.y,o=t.z,l=t.w,c=l*i+a*n-o*r,u=l*r+o*i-s*n,h=l*n+s*r-a*i,d=-s*i-a*r-o*n;return this.x=c*l+d*-s+u*-o-h*-a,this.y=u*l+d*-a+h*-s-c*-o,this.z=h*l+d*-o+c*-a-u*-s,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){let i=this.x,r=this.y,n=this.z,s=t.elements;return this.x=s[0]*i+s[4]*r+s[8]*n,this.y=s[1]*i+s[5]*r+s[9]*n,this.z=s[2]*i+s[6]*r+s[10]*n,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,i){return this.x=Math.max(t.x,Math.min(i.x,this.x)),this.y=Math.max(t.y,Math.min(i.y,this.y)),this.z=Math.max(t.z,Math.min(i.z,this.z)),this}clampScalar(t,i){return this.x=Math.max(t,Math.min(i,this.x)),this.y=Math.max(t,Math.min(i,this.y)),this.z=Math.max(t,Math.min(i,this.z)),this}clampLength(t,i){let r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(i,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this.z+=(t.z-this.z)*i,this}lerpVectors(t,i,r){return this.x=t.x+(i.x-t.x)*r,this.y=t.y+(i.y-t.y)*r,this.z=t.z+(i.z-t.z)*r,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,i){let r=t.x,n=t.y,s=t.z,a=i.x,o=i.y,l=i.z;return this.x=n*l-s*o,this.y=s*a-r*l,this.z=r*o-n*a,this}projectOnVector(t){let i=t.lengthSq();if(i===0)return this.set(0,0,0);let r=t.dot(this)/i;return this.copy(t).multiplyScalar(r)}projectOnPlane(t){return AD.copy(this).projectOnVector(t),this.sub(AD)}reflect(t){return this.sub(AD.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){let i=Math.sqrt(this.lengthSq()*t.lengthSq());if(i===0)return Math.PI/2;let r=this.dot(t)/i;return Math.acos(Tn(r,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){let i=this.x-t.x,r=this.y-t.y,n=this.z-t.z;return i*i+r*r+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,i,r){let n=Math.sin(i)*t;return this.x=n*Math.sin(r),this.y=Math.cos(i)*t,this.z=n*Math.cos(r),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,i,r){return this.x=t*Math.sin(i),this.y=r,this.z=t*Math.cos(i),this}setFromMatrixPosition(t){let i=t.elements;return this.x=i[12],this.y=i[13],this.z=i[14],this}setFromMatrixScale(t){let i=this.setFromMatrixColumn(t,0).length(),r=this.setFromMatrixColumn(t,1).length(),n=this.setFromMatrixColumn(t,2).length();return this.x=i,this.y=r,this.z=n,this}setFromMatrixColumn(t,i){return this.fromArray(t.elements,i*4)}setFromMatrix3Column(t,i){return this.fromArray(t.elements,i*3)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,i=0){return this.x=t[i],this.y=t[i+1],this.z=t[i+2],this}toArray(t=[],i=0){return t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t}fromBufferAttribute(t,i){return this.x=t.getX(i),this.y=t.getY(i),this.z=t.getZ(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){let t=(Math.random()-.5)*2,i=Math.random()*Math.PI*2,r=Math.sqrt(1-t**2);return this.x=r*Math.cos(i),this.y=r*Math.sin(i),this.z=t,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}},AD=new N,fH=new ri,vn=class{constructor(e=new N(1/0,1/0,1/0),t=new N(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,i=1/0,r=1/0,n=-1/0,s=-1/0,a=-1/0;for(let o=0,l=e.length;o<l;o+=3){let c=e[o],u=e[o+1],h=e[o+2];c<t&&(t=c),u<i&&(i=u),h<r&&(r=h),c>n&&(n=c),u>s&&(s=u),h>a&&(a=h)}return this.min.set(t,i,r),this.max.set(n,s,a),this}setFromBufferAttribute(e){let t=1/0,i=1/0,r=1/0,n=-1/0,s=-1/0,a=-1/0;for(let o=0,l=e.count;o<l;o++){let c=e.getX(o),u=e.getY(o),h=e.getZ(o);c<t&&(t=c),u<i&&(i=u),h<r&&(r=h),c>n&&(n=c),u>s&&(s=u),h>a&&(a=h)}return this.min.set(t,i,r),this.max.set(n,s,a),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){let i=Zf.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);let i=e.geometry;if(i!==void 0)if(t&&i.attributes!=null&&i.attributes.position!==void 0){let n=i.attributes.position;for(let s=0,a=n.count;s<a;s++)Zf.fromBufferAttribute(n,s).applyMatrix4(e.matrixWorld),this.expandByPoint(Zf)}else i.boundingBox===null&&i.computeBoundingBox(),TD.copy(i.boundingBox),TD.applyMatrix4(e.matrixWorld),this.union(TD);let r=e.children;for(let n=0,s=r.length;n<s;n++)this.expandByObject(r[n],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,Zf),Zf.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(s1),gS.subVectors(this.max,s1),vg.subVectors(e.a,s1),yg.subVectors(e.b,s1),xg.subVectors(e.c,s1),$h.subVectors(yg,vg),ed.subVectors(xg,yg),Kf.subVectors(vg,xg);let t=[0,-$h.z,$h.y,0,-ed.z,ed.y,0,-Kf.z,Kf.y,$h.z,0,-$h.x,ed.z,0,-ed.x,Kf.z,0,-Kf.x,-$h.y,$h.x,0,-ed.y,ed.x,0,-Kf.y,Kf.x,0];return!CD(t,vg,yg,xg,gS)||(t=[1,0,0,0,1,0,0,0,1],!CD(t,vg,yg,xg,gS))?!1:(vS.crossVectors($h,ed),t=[vS.x,vS.y,vS.z],CD(t,vg,yg,xg,gS))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return Zf.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=this.getSize(Zf).length()*.5,e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(Su[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Su[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Su[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Su[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Su[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Su[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Su[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Su[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Su),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}},Su=[new N,new N,new N,new N,new N,new N,new N,new N],Zf=new N,TD=new vn,vg=new N,yg=new N,xg=new N,$h=new N,ed=new N,Kf=new N,s1=new N,gS=new N,vS=new N,Jf=new N;function CD(e,t,i,r,n){for(let s=0,a=e.length-3;s<=a;s+=3){Jf.fromArray(e,s);let o=n.x*Math.abs(Jf.x)+n.y*Math.abs(Jf.y)+n.z*Math.abs(Jf.z),l=t.dot(Jf),c=i.dot(Jf),u=r.dot(Jf);if(Math.max(-Math.max(l,c,u),Math.min(l,c,u))>o)return!1}return!0}var kge=new vn,a1=new N,PD=new N,uo=class{constructor(e=new N,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){let i=this.center;t!==void 0?i.copy(t):kge.setFromPoints(e).getCenter(i);let r=0;for(let n=0,s=e.length;n<s;n++)r=Math.max(r,i.distanceToSquared(e[n]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){let t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){let i=this.center.distanceToSquared(e);return t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;a1.subVectors(e,this.center);let t=a1.lengthSq();if(t>this.radius*this.radius){let i=Math.sqrt(t),r=(i-this.radius)*.5;this.center.addScaledVector(a1,r/i),this.radius+=r}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(PD.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(a1.copy(e.center).add(PD)),this.expandByPoint(a1.copy(e.center).sub(PD))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}},Mu=new N,DD=new N,yS=new N,td=new N,RD=new N,xS=new N,ID=new N,sy=class{constructor(e=new N,t=new N(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Mu)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);let i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(i).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){let t=Mu.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Mu.copy(this.direction).multiplyScalar(t).add(this.origin),Mu.distanceToSquared(e))}distanceSqToSegment(e,t,i,r){DD.copy(e).add(t).multiplyScalar(.5),yS.copy(t).sub(e).normalize(),td.copy(this.origin).sub(DD);let n=e.distanceTo(t)*.5,s=-this.direction.dot(yS),a=td.dot(this.direction),o=-td.dot(yS),l=td.lengthSq(),c=Math.abs(1-s*s),u,h,d,f;if(c>0)if(u=s*o-a,h=s*a-o,f=n*c,u>=0)if(h>=-f)if(h<=f){let p=1/c;u*=p,h*=p,d=u*(u+s*h+2*a)+h*(s*u+h+2*o)+l}else h=n,u=Math.max(0,-(s*h+a)),d=-u*u+h*(h+2*o)+l;else h=-n,u=Math.max(0,-(s*h+a)),d=-u*u+h*(h+2*o)+l;else h<=-f?(u=Math.max(0,-(-s*n+a)),h=u>0?-n:Math.min(Math.max(-n,-o),n),d=-u*u+h*(h+2*o)+l):h<=f?(u=0,h=Math.min(Math.max(-n,-o),n),d=h*(h+2*o)+l):(u=Math.max(0,-(s*n+a)),h=u>0?n:Math.min(Math.max(-n,-o),n),d=-u*u+h*(h+2*o)+l);else h=s>0?-n:n,u=Math.max(0,-(s*h+a)),d=-u*u+h*(h+2*o)+l;return i&&i.copy(this.direction).multiplyScalar(u).add(this.origin),r&&r.copy(yS).multiplyScalar(h).add(DD),d}intersectSphere(e,t){Mu.subVectors(e.center,this.origin);let i=Mu.dot(this.direction),r=Mu.dot(Mu)-i*i,n=e.radius*e.radius;if(r>n)return null;let s=Math.sqrt(n-r),a=i-s,o=i+s;return a<0&&o<0?null:a<0?this.at(o,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){let t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;let i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){let i=this.distanceToPlane(e);return i===null?null:this.at(i,t)}intersectsPlane(e){let t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,r,n,s,a,o,l=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,h=this.origin;return l>=0?(i=(e.min.x-h.x)*l,r=(e.max.x-h.x)*l):(i=(e.max.x-h.x)*l,r=(e.min.x-h.x)*l),c>=0?(n=(e.min.y-h.y)*c,s=(e.max.y-h.y)*c):(n=(e.max.y-h.y)*c,s=(e.min.y-h.y)*c),i>s||n>r||((n>i||isNaN(i))&&(i=n),(s<r||isNaN(r))&&(r=s),u>=0?(a=(e.min.z-h.z)*u,o=(e.max.z-h.z)*u):(a=(e.max.z-h.z)*u,o=(e.min.z-h.z)*u),i>o||a>r)||((a>i||i!==i)&&(i=a),(o<r||r!==r)&&(r=o),r<0)?null:this.at(i>=0?i:r,t)}intersectsBox(e){return this.intersectBox(e,Mu)!==null}intersectTriangle(e,t,i,r,n){RD.subVectors(t,e),xS.subVectors(i,e),ID.crossVectors(RD,xS);let s=this.direction.dot(ID),a;if(s>0){if(r)return null;a=1}else if(s<0)a=-1,s=-s;else return null;td.subVectors(this.origin,e);let o=a*this.direction.dot(xS.crossVectors(td,xS));if(o<0)return null;let l=a*this.direction.dot(RD.cross(td));if(l<0||o+l>s)return null;let c=-a*td.dot(ID);return c<0?null:this.at(c/s,n)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}},ft=class{constructor(){ft.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(e,t,i,r,n,s,a,o,l,c,u,h,d,f,p,v){let m=this.elements;return m[0]=e,m[4]=t,m[8]=i,m[12]=r,m[1]=n,m[5]=s,m[9]=a,m[13]=o,m[2]=l,m[6]=c,m[10]=u,m[14]=h,m[3]=d,m[7]=f,m[11]=p,m[15]=v,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new ft().fromArray(this.elements)}copy(e){let t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){let t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){let t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){let t=this.elements,i=e.elements,r=1/wg.setFromMatrixColumn(e,0).length(),n=1/wg.setFromMatrixColumn(e,1).length(),s=1/wg.setFromMatrixColumn(e,2).length();return t[0]=i[0]*r,t[1]=i[1]*r,t[2]=i[2]*r,t[3]=0,t[4]=i[4]*n,t[5]=i[5]*n,t[6]=i[6]*n,t[7]=0,t[8]=i[8]*s,t[9]=i[9]*s,t[10]=i[10]*s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){let t=this.elements,i=e.x,r=e.y,n=e.z,s=Math.cos(i),a=Math.sin(i),o=Math.cos(r),l=Math.sin(r),c=Math.cos(n),u=Math.sin(n);if(e.order==="XYZ"){let h=s*c,d=s*u,f=a*c,p=a*u;t[0]=o*c,t[4]=-o*u,t[8]=l,t[1]=d+f*l,t[5]=h-p*l,t[9]=-a*o,t[2]=p-h*l,t[6]=f+d*l,t[10]=s*o}else if(e.order==="YXZ"){let h=o*c,d=o*u,f=l*c,p=l*u;t[0]=h+p*a,t[4]=f*a-d,t[8]=s*l,t[1]=s*u,t[5]=s*c,t[9]=-a,t[2]=d*a-f,t[6]=p+h*a,t[10]=s*o}else if(e.order==="ZXY"){let h=o*c,d=o*u,f=l*c,p=l*u;t[0]=h-p*a,t[4]=-s*u,t[8]=f+d*a,t[1]=d+f*a,t[5]=s*c,t[9]=p-h*a,t[2]=-s*l,t[6]=a,t[10]=s*o}else if(e.order==="ZYX"){let h=s*c,d=s*u,f=a*c,p=a*u;t[0]=o*c,t[4]=f*l-d,t[8]=h*l+p,t[1]=o*u,t[5]=p*l+h,t[9]=d*l-f,t[2]=-l,t[6]=a*o,t[10]=s*o}else if(e.order==="YZX"){let h=s*o,d=s*l,f=a*o,p=a*l;t[0]=o*c,t[4]=p-h*u,t[8]=f*u+d,t[1]=u,t[5]=s*c,t[9]=-a*c,t[2]=-l*c,t[6]=d*u+f,t[10]=h-p*u}else if(e.order==="XZY"){let h=s*o,d=s*l,f=a*o,p=a*l;t[0]=o*c,t[4]=-u,t[8]=l*c,t[1]=h*u+p,t[5]=s*c,t[9]=d*u-f,t[2]=f*u-d,t[6]=a*c,t[10]=p*u+h}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(Vge,e,Gge)}lookAt(e,t,i){let r=this.elements;return _o.subVectors(e,t),_o.lengthSq()===0&&(_o.z=1),_o.normalize(),id.crossVectors(i,_o),id.lengthSq()===0&&(Math.abs(i.z)===1?_o.x+=1e-4:_o.z+=1e-4,_o.normalize(),id.crossVectors(i,_o)),id.normalize(),wS.crossVectors(_o,id),r[0]=id.x,r[4]=wS.x,r[8]=_o.x,r[1]=id.y,r[5]=wS.y,r[9]=_o.y,r[2]=id.z,r[6]=wS.z,r[10]=_o.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){let i=e.elements,r=t.elements,n=this.elements,s=i[0],a=i[4],o=i[8],l=i[12],c=i[1],u=i[5],h=i[9],d=i[13],f=i[2],p=i[6],v=i[10],m=i[14],g=i[3],y=i[7],x=i[11],_=i[15],M=r[0],S=r[4],T=r[8],E=r[12],C=r[1],A=r[5],D=r[9],R=r[13],L=r[2],O=r[6],H=r[10],j=r[14],Y=r[3],z=r[7],V=r[11],U=r[15];return n[0]=s*M+a*C+o*L+l*Y,n[4]=s*S+a*A+o*O+l*z,n[8]=s*T+a*D+o*H+l*V,n[12]=s*E+a*R+o*j+l*U,n[1]=c*M+u*C+h*L+d*Y,n[5]=c*S+u*A+h*O+d*z,n[9]=c*T+u*D+h*H+d*V,n[13]=c*E+u*R+h*j+d*U,n[2]=f*M+p*C+v*L+m*Y,n[6]=f*S+p*A+v*O+m*z,n[10]=f*T+p*D+v*H+m*V,n[14]=f*E+p*R+v*j+m*U,n[3]=g*M+y*C+x*L+_*Y,n[7]=g*S+y*A+x*O+_*z,n[11]=g*T+y*D+x*H+_*V,n[15]=g*E+y*R+x*j+_*U,this}multiplyScalar(e){let t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){let e=this.elements,t=e[0],i=e[4],r=e[8],n=e[12],s=e[1],a=e[5],o=e[9],l=e[13],c=e[2],u=e[6],h=e[10],d=e[14],f=e[3],p=e[7],v=e[11],m=e[15];return f*(+n*o*u-r*l*u-n*a*h+i*l*h+r*a*d-i*o*d)+p*(+t*o*d-t*l*h+n*s*h-r*s*d+r*l*c-n*o*c)+v*(+t*l*u-t*a*d-n*s*u+i*s*d+n*a*c-i*l*c)+m*(-r*a*c-t*o*u+t*a*h+r*s*u-i*s*h+i*o*c)}transpose(){let e=this.elements,t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){let r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=i),this}invert(){let e=this.elements,t=e[0],i=e[1],r=e[2],n=e[3],s=e[4],a=e[5],o=e[6],l=e[7],c=e[8],u=e[9],h=e[10],d=e[11],f=e[12],p=e[13],v=e[14],m=e[15],g=u*v*l-p*h*l+p*o*d-a*v*d-u*o*m+a*h*m,y=f*h*l-c*v*l-f*o*d+s*v*d+c*o*m-s*h*m,x=c*p*l-f*u*l+f*a*d-s*p*d-c*a*m+s*u*m,_=f*u*o-c*p*o-f*a*h+s*p*h+c*a*v-s*u*v,M=t*g+i*y+r*x+n*_;if(M===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);let S=1/M;return e[0]=g*S,e[1]=(p*h*n-u*v*n-p*r*d+i*v*d+u*r*m-i*h*m)*S,e[2]=(a*v*n-p*o*n+p*r*l-i*v*l-a*r*m+i*o*m)*S,e[3]=(u*o*n-a*h*n-u*r*l+i*h*l+a*r*d-i*o*d)*S,e[4]=y*S,e[5]=(c*v*n-f*h*n+f*r*d-t*v*d-c*r*m+t*h*m)*S,e[6]=(f*o*n-s*v*n-f*r*l+t*v*l+s*r*m-t*o*m)*S,e[7]=(s*h*n-c*o*n+c*r*l-t*h*l-s*r*d+t*o*d)*S,e[8]=x*S,e[9]=(f*u*n-c*p*n-f*i*d+t*p*d+c*i*m-t*u*m)*S,e[10]=(s*p*n-f*a*n+f*i*l-t*p*l-s*i*m+t*a*m)*S,e[11]=(c*a*n-s*u*n-c*i*l+t*u*l+s*i*d-t*a*d)*S,e[12]=_*S,e[13]=(c*p*r-f*u*r+f*i*h-t*p*h-c*i*v+t*u*v)*S,e[14]=(f*a*r-s*p*r-f*i*o+t*p*o+s*i*v-t*a*v)*S,e[15]=(s*u*r-c*a*r+c*i*o-t*u*o-s*i*h+t*a*h)*S,this}scale(e){let t=this.elements,i=e.x,r=e.y,n=e.z;return t[0]*=i,t[4]*=r,t[8]*=n,t[1]*=i,t[5]*=r,t[9]*=n,t[2]*=i,t[6]*=r,t[10]*=n,t[3]*=i,t[7]*=r,t[11]*=n,this}getMaxScaleOnAxis(){let e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,r))}makeTranslation(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){let t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){let t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){let t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){let i=Math.cos(t),r=Math.sin(t),n=1-i,s=e.x,a=e.y,o=e.z,l=n*s,c=n*a;return this.set(l*s+i,l*a-r*o,l*o+r*a,0,l*a+r*o,c*a+i,c*o-r*s,0,l*o-r*a,c*o+r*s,n*o*o+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i,r,n,s){return this.set(1,i,n,0,e,1,s,0,t,r,1,0,0,0,0,1),this}compose(e,t,i){let r=this.elements,n=t._x,s=t._y,a=t._z,o=t._w,l=n+n,c=s+s,u=a+a,h=n*l,d=n*c,f=n*u,p=s*c,v=s*u,m=a*u,g=o*l,y=o*c,x=o*u,_=i.x,M=i.y,S=i.z;return r[0]=(1-(p+m))*_,r[1]=(d+x)*_,r[2]=(f-y)*_,r[3]=0,r[4]=(d-x)*M,r[5]=(1-(h+m))*M,r[6]=(v+g)*M,r[7]=0,r[8]=(f+y)*S,r[9]=(v-g)*S,r[10]=(1-(h+p))*S,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,i){let r=this.elements,n=wg.set(r[0],r[1],r[2]).length(),s=wg.set(r[4],r[5],r[6]).length(),a=wg.set(r[8],r[9],r[10]).length();this.determinant()<0&&(n=-n),e.x=r[12],e.y=r[13],e.z=r[14],Tl.copy(this);let o=1/n,l=1/s,c=1/a;return Tl.elements[0]*=o,Tl.elements[1]*=o,Tl.elements[2]*=o,Tl.elements[4]*=l,Tl.elements[5]*=l,Tl.elements[6]*=l,Tl.elements[8]*=c,Tl.elements[9]*=c,Tl.elements[10]*=c,t.setFromRotationMatrix(Tl),i.x=n,i.y=s,i.z=a,this}makePerspective(e,t,i,r,n,s){let a=this.elements,o=2*n/(t-e),l=2*n/(i-r),c=(t+e)/(t-e),u=(i+r)/(i-r),h=-(s+n)/(s-n),d=-2*s*n/(s-n);return a[0]=o,a[4]=0,a[8]=c,a[12]=0,a[1]=0,a[5]=l,a[9]=u,a[13]=0,a[2]=0,a[6]=0,a[10]=h,a[14]=d,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(e,t,i,r,n,s){let a=this.elements,o=1/(t-e),l=1/(i-r),c=1/(s-n),u=(t+e)*o,h=(i+r)*l,d=(s+n)*c;return a[0]=2*o,a[4]=0,a[8]=0,a[12]=-u,a[1]=0,a[5]=2*l,a[9]=0,a[13]=-h,a[2]=0,a[6]=0,a[10]=-2*c,a[14]=-d,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(e){let t=this.elements,i=e.elements;for(let r=0;r<16;r++)if(t[r]!==i[r])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){let i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}},wg=new N,Tl=new ft,Vge=new N(0,0,0),Gge=new N(1,1,1),id=new N,wS=new N,_o=new N,pH=new ft,mH=new ri,Wn=class{constructor(e=0,t=0,i=0,r=Wn.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=i,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,i,r=this._order){return this._x=e,this._y=t,this._z=i,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,i=!0){let r=e.elements,n=r[0],s=r[4],a=r[8],o=r[1],l=r[5],c=r[9],u=r[2],h=r[6],d=r[10];switch(t){case"XYZ":this._y=Math.asin(Tn(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-c,d),this._z=Math.atan2(-s,n)):(this._x=Math.atan2(h,l),this._z=0);break;case"YXZ":this._x=Math.asin(-Tn(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(a,d),this._z=Math.atan2(o,l)):(this._y=Math.atan2(-u,n),this._z=0);break;case"ZXY":this._x=Math.asin(Tn(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-u,d),this._z=Math.atan2(-s,l)):(this._y=0,this._z=Math.atan2(o,n));break;case"ZYX":this._y=Math.asin(-Tn(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(h,d),this._z=Math.atan2(o,n)):(this._x=0,this._z=Math.atan2(-s,l));break;case"YZX":this._z=Math.asin(Tn(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-u,n)):(this._x=0,this._y=Math.atan2(a,d));break;case"XZY":this._z=Math.asin(-Tn(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(h,l),this._y=Math.atan2(a,n)):(this._x=Math.atan2(-c,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,i===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,i){return pH.makeRotationFromQuaternion(e),this.setFromRotationMatrix(pH,t,i)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return mH.setFromEuler(this),this.setFromQuaternion(mH,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}};Wn.DEFAULT_ORDER="XYZ";var JU=class{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}},Hge=0,gH=new N,bg=new ri,Eu=new ft,bS=new N,o1=new N,jge=new N,Wge=new ri,vH=new N(1,0,0),yH=new N(0,1,0),xH=new N(0,0,1),Xge={type:"added"},wH={type:"removed"},rr=class extends Vs{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Hge++}),this.uuid=gl(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=rr.DEFAULT_UP.clone();let e=new N,t=new Wn,i=new ri,r=new N(1,1,1);function n(){i.setFromEuler(t,!1)}function s(){t.setFromQuaternion(i,void 0,!1)}t._onChange(n),i._onChange(s),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new ft},normalMatrix:{value:new Dn}}),this.matrix=new ft,this.matrixWorld=new ft,this.matrixAutoUpdate=rr.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=rr.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new JU,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return bg.setFromAxisAngle(e,t),this.quaternion.multiply(bg),this}rotateOnWorldAxis(e,t){return bg.setFromAxisAngle(e,t),this.quaternion.premultiply(bg),this}rotateX(e){return this.rotateOnAxis(vH,e)}rotateY(e){return this.rotateOnAxis(yH,e)}rotateZ(e){return this.rotateOnAxis(xH,e)}translateOnAxis(e,t){return gH.copy(e).applyQuaternion(this.quaternion),this.position.add(gH.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(vH,e)}translateY(e){return this.translateOnAxis(yH,e)}translateZ(e){return this.translateOnAxis(xH,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Eu.copy(this.matrixWorld).invert())}lookAt(e,t,i){e.isVector3?bS.copy(e):bS.set(e,t,i);let r=this.parent;this.updateWorldMatrix(!0,!1),o1.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Eu.lookAt(o1,bS,this.up):Eu.lookAt(bS,o1,this.up),this.quaternion.setFromRotationMatrix(Eu),r&&(Eu.extractRotation(r.matrixWorld),bg.setFromRotationMatrix(Eu),this.quaternion.premultiply(bg.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(Xge)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}let t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(wH)),this}removeFromParent(){let e=this.parent;return e!==null&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){let t=this.children[e];t.parent=null,t.dispatchEvent(wH)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),Eu.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),Eu.multiply(e.parent.matrixWorld)),e.applyMatrix4(Eu),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let i=0,r=this.children.length;i<r;i++){let n=this.children[i].getObjectByProperty(e,t);if(n!==void 0)return n}}getObjectsByProperty(e,t){let i=[];this[e]===t&&i.push(this);for(let r=0,n=this.children.length;r<n;r++){let s=this.children[r].getObjectsByProperty(e,t);s.length>0&&(i=i.concat(s))}return i}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(o1,e,jge),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(o1,Wge,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);let t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);let t=this.children;for(let i=0,r=t.length;i<r;i++)t[i].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);let t=this.children;for(let i=0,r=t.length;i<r;i++)t[i].traverseVisible(e)}traverseAncestors(e){let t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);let t=this.children;for(let i=0,r=t.length;i<r;i++){let n=t[i];(n.matrixWorldAutoUpdate===!0||e===!0)&&n.updateMatrixWorld(e)}}updateWorldMatrix(e,t){let i=this.parent;if(e===!0&&i!==null&&i.matrixWorldAutoUpdate===!0&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0){let r=this.children;for(let n=0,s=r.length;n<s;n++){let a=r[n];a.matrixWorldAutoUpdate===!0&&a.updateWorldMatrix(!1,!0)}}}toJSON(e){let t=e===void 0||typeof e=="string",i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});let r={};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.castShadow===!0&&(r.castShadow=!0),this.receiveShadow===!0&&(r.receiveShadow=!0),this.visible===!1&&(r.visible=!1),this.frustumCulled===!1&&(r.frustumCulled=!1),this.renderOrder!==0&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(r.instanceColor=this.instanceColor.toJSON()));function n(a,o){return a[o.uuid]===void 0&&(a[o.uuid]=o.toJSON(e)),o.uuid}if(this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=n(e.geometries,this.geometry);let a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){let o=a.shapes;if(Array.isArray(o))for(let l=0,c=o.length;l<c;l++){let u=o[l];n(e.shapes,u)}else n(e.shapes,o)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(n(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){let a=[];for(let o=0,l=this.material.length;o<l;o++)a.push(n(e.materials,this.material[o]));r.material=a}else r.material=n(e.materials,this.material);if(this.children.length>0){r.children=[];for(let a=0;a<this.children.length;a++)r.children.push(this.children[a].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let a=0;a<this.animations.length;a++){let o=this.animations[a];r.animations.push(n(e.animations,o))}}if(t){let a=s(e.geometries),o=s(e.materials),l=s(e.textures),c=s(e.images),u=s(e.shapes),h=s(e.skeletons),d=s(e.animations),f=s(e.nodes);a.length>0&&(i.geometries=a),o.length>0&&(i.materials=o),l.length>0&&(i.textures=l),c.length>0&&(i.images=c),u.length>0&&(i.shapes=u),h.length>0&&(i.skeletons=h),d.length>0&&(i.animations=d),f.length>0&&(i.nodes=f)}return i.object=r,i;function s(a){let o=[];for(let l in a){let c=a[l];delete c.metadata,o.push(c)}return o}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let i=0;i<e.children.length;i++){let r=e.children[i];this.add(r.clone())}return this}};rr.DEFAULT_UP=new N(0,1,0);rr.DEFAULT_MATRIX_AUTO_UPDATE=!0;rr.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;var Cl=new N,Au=new N,LD=new N,Tu=new N,_g=new N,Sg=new N,bH=new N,OD=new N,zD=new N,BD=new N,Rs=class{constructor(e=new N,t=new N,i=new N){this.a=e,this.b=t,this.c=i}static getNormal(e,t,i,r){r.subVectors(i,t),Cl.subVectors(e,t),r.cross(Cl);let n=r.lengthSq();return n>0?r.multiplyScalar(1/Math.sqrt(n)):r.set(0,0,0)}static getBarycoord(e,t,i,r,n){Cl.subVectors(r,t),Au.subVectors(i,t),LD.subVectors(e,t);let s=Cl.dot(Cl),a=Cl.dot(Au),o=Cl.dot(LD),l=Au.dot(Au),c=Au.dot(LD),u=s*l-a*a;if(u===0)return n.set(-2,-1,-1);let h=1/u,d=(l*o-a*c)*h,f=(s*c-a*o)*h;return n.set(1-d-f,f,d)}static containsPoint(e,t,i,r){return this.getBarycoord(e,t,i,r,Tu),Tu.x>=0&&Tu.y>=0&&Tu.x+Tu.y<=1}static getUV(e,t,i,r,n,s,a,o){return this.getBarycoord(e,t,i,r,Tu),o.set(0,0),o.addScaledVector(n,Tu.x),o.addScaledVector(s,Tu.y),o.addScaledVector(a,Tu.z),o}static isFrontFacing(e,t,i,r){return Cl.subVectors(i,t),Au.subVectors(e,t),Cl.cross(Au).dot(r)<0}set(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}setFromPointsAndIndices(e,t,i,r){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,t,i,r){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,i),this.c.fromBufferAttribute(e,r),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Cl.subVectors(this.c,this.b),Au.subVectors(this.a,this.b),Cl.cross(Au).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Rs.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Rs.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,i,r,n){return Rs.getUV(e,this.a,this.b,this.c,t,i,r,n)}containsPoint(e){return Rs.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Rs.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){let i=this.a,r=this.b,n=this.c,s,a;_g.subVectors(r,i),Sg.subVectors(n,i),OD.subVectors(e,i);let o=_g.dot(OD),l=Sg.dot(OD);if(o<=0&&l<=0)return t.copy(i);zD.subVectors(e,r);let c=_g.dot(zD),u=Sg.dot(zD);if(c>=0&&u<=c)return t.copy(r);let h=o*u-c*l;if(h<=0&&o>=0&&c<=0)return s=o/(o-c),t.copy(i).addScaledVector(_g,s);BD.subVectors(e,n);let d=_g.dot(BD),f=Sg.dot(BD);if(f>=0&&d<=f)return t.copy(n);let p=d*l-o*f;if(p<=0&&l>=0&&f<=0)return a=l/(l-f),t.copy(i).addScaledVector(Sg,a);let v=c*f-d*u;if(v<=0&&u-c>=0&&d-f>=0)return bH.subVectors(n,r),a=(u-c)/(u-c+(d-f)),t.copy(r).addScaledVector(bH,a);let m=1/(v+p+h);return s=p*m,a=h*m,t.copy(i).addScaledVector(_g,s).addScaledVector(Sg,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}},qge=0,Cb=class extends Vs{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:qge++}),this.uuid=gl(),this.name="",this.type="Material",this.blending=nm,this.side=nc,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=SJ,this.blendDst=MJ,this.blendEquation=mv,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=kO,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=bge,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=bD,this.stencilZFail=bD,this.stencilZPass=bD,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(let t in e){let i=e[t];if(i===void 0){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}let r=this[t];if(r===void 0){console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.");continue}r&&r.isColor?r.set(i):r&&r.isVector3&&i&&i.isVector3?r.copy(i):this[t]=i}}toJSON(e){let t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});let i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(i.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(i.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==nm&&(i.blending=this.blending),this.side!==nc&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.colorWrite=this.colorWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(i.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=this.premultipliedAlpha),this.forceSinglePass===!0&&(i.forceSinglePass=this.forceSinglePass),this.wireframe===!0&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=this.flatShading),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),this.fog===!1&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData);function r(n){let s=[];for(let a in n){let o=n[a];delete o.metadata,s.push(o)}return s}if(t){let n=r(e.textures),s=r(e.images);n.length>0&&(i.textures=n),s.length>0&&(i.images=s)}return i}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;let t=e.clippingPlanes,i=null;if(t!==null){let r=t.length;i=new Array(r);for(let n=0;n!==r;++n)i[n]=t[n].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}},Ch=class extends Cb{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Yt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=EJ,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}},Mn=new N,_S=new Me,Qt=class{constructor(e,t,i=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=i,this.usage=jO,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let r=0,n=this.itemSize;r<n;r++)this.array[e+r]=t.array[i+r];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,i=this.count;t<i;t++)_S.fromBufferAttribute(this,t),_S.applyMatrix3(e),this.setXY(t,_S.x,_S.y);else if(this.itemSize===3)for(let t=0,i=this.count;t<i;t++)Mn.fromBufferAttribute(this,t),Mn.applyMatrix3(e),this.setXYZ(t,Mn.x,Mn.y,Mn.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)Mn.fromBufferAttribute(this,t),Mn.applyMatrix4(e),this.setXYZ(t,Mn.x,Mn.y,Mn.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)Mn.fromBufferAttribute(this,t),Mn.applyNormalMatrix(e),this.setXYZ(t,Mn.x,Mn.y,Mn.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)Mn.fromBufferAttribute(this,t),Mn.transformDirection(e),this.setXYZ(t,Mn.x,Mn.y,Mn.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=uh(t,this.array)),t}setX(e,t){return this.normalized&&(t=vr(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=uh(t,this.array)),t}setY(e,t){return this.normalized&&(t=vr(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=uh(t,this.array)),t}setZ(e,t){return this.normalized&&(t=vr(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=uh(t,this.array)),t}setW(e,t){return this.normalized&&(t=vr(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=vr(t,this.array),i=vr(i,this.array)),this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,r){return e*=this.itemSize,this.normalized&&(t=vr(t,this.array),i=vr(i,this.array),r=vr(r,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this}setXYZW(e,t,i,r,n){return e*=this.itemSize,this.normalized&&(t=vr(t,this.array),i=vr(i,this.array),r=vr(r,this.array),n=vr(n,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this.array[e+3]=n,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){let e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==jO&&(e.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(e.updateRange=this.updateRange),e}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}},NJ=class extends Qt{constructor(e,t,i){super(new Uint16Array(e),t,i)}},o0=class extends Qt{constructor(e,t,i){super(new Uint32Array(e),t,i)}},_t=class extends Qt{constructor(e,t,i){super(new Float32Array(e),t,i)}},Yge=0,Ko=new ft,FD=new rr,Mg=new N,So=new vn,l1=new vn,ss=new N,Nt=class extends Vs{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Yge++}),this.uuid=gl(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(LJ(e)?o0:NJ)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,i=0){this.groups.push({start:e,count:t,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){let t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);let i=this.attributes.normal;if(i!==void 0){let n=new Dn().getNormalMatrix(e);i.applyNormalMatrix(n),i.needsUpdate=!0}let r=this.attributes.tangent;return r!==void 0&&(r.transformDirection(e),r.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return Ko.makeRotationFromQuaternion(e),this.applyMatrix4(Ko),this}rotateX(e){return Ko.makeRotationX(e),this.applyMatrix4(Ko),this}rotateY(e){return Ko.makeRotationY(e),this.applyMatrix4(Ko),this}rotateZ(e){return Ko.makeRotationZ(e),this.applyMatrix4(Ko),this}translate(e,t,i){return Ko.makeTranslation(e,t,i),this.applyMatrix4(Ko),this}scale(e,t,i){return Ko.makeScale(e,t,i),this.applyMatrix4(Ko),this}lookAt(e){return FD.lookAt(e),FD.updateMatrix(),this.applyMatrix4(FD.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Mg).negate(),this.translate(Mg.x,Mg.y,Mg.z),this}setFromPoints(e){let t=[];for(let i=0,r=e.length;i<r;i++){let n=e[i];t.push(n.x,n.y,n.z||0)}return this.setAttribute("position",new _t(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new vn);let e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new N(-1/0,-1/0,-1/0),new N(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let i=0,r=t.length;i<r;i++){let n=t[i];So.setFromBufferAttribute(n),this.morphTargetsRelative?(ss.addVectors(this.boundingBox.min,So.min),this.boundingBox.expandByPoint(ss),ss.addVectors(this.boundingBox.max,So.max),this.boundingBox.expandByPoint(ss)):(this.boundingBox.expandByPoint(So.min),this.boundingBox.expandByPoint(So.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new uo);let e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new N,1/0);return}if(e){let i=this.boundingSphere.center;if(So.setFromBufferAttribute(e),t)for(let n=0,s=t.length;n<s;n++){let a=t[n];l1.setFromBufferAttribute(a),this.morphTargetsRelative?(ss.addVectors(So.min,l1.min),So.expandByPoint(ss),ss.addVectors(So.max,l1.max),So.expandByPoint(ss)):(So.expandByPoint(l1.min),So.expandByPoint(l1.max))}So.getCenter(i);let r=0;for(let n=0,s=e.count;n<s;n++)ss.fromBufferAttribute(e,n),r=Math.max(r,i.distanceToSquared(ss));if(t)for(let n=0,s=t.length;n<s;n++){let a=t[n],o=this.morphTargetsRelative;for(let l=0,c=a.count;l<c;l++)ss.fromBufferAttribute(a,l),o&&(Mg.fromBufferAttribute(e,l),ss.add(Mg)),r=Math.max(r,i.distanceToSquared(ss))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){let e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}let i=e.array,r=t.position.array,n=t.normal.array,s=t.uv.array,a=r.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Qt(new Float32Array(4*a),4));let o=this.getAttribute("tangent").array,l=[],c=[];for(let C=0;C<a;C++)l[C]=new N,c[C]=new N;let u=new N,h=new N,d=new N,f=new Me,p=new Me,v=new Me,m=new N,g=new N;function y(C,A,D){u.fromArray(r,C*3),h.fromArray(r,A*3),d.fromArray(r,D*3),f.fromArray(s,C*2),p.fromArray(s,A*2),v.fromArray(s,D*2),h.sub(u),d.sub(u),p.sub(f),v.sub(f);let R=1/(p.x*v.y-v.x*p.y);!isFinite(R)||(m.copy(h).multiplyScalar(v.y).addScaledVector(d,-p.y).multiplyScalar(R),g.copy(d).multiplyScalar(p.x).addScaledVector(h,-v.x).multiplyScalar(R),l[C].add(m),l[A].add(m),l[D].add(m),c[C].add(g),c[A].add(g),c[D].add(g))}let x=this.groups;x.length===0&&(x=[{start:0,count:i.length}]);for(let C=0,A=x.length;C<A;++C){let D=x[C],R=D.start,L=D.count;for(let O=R,H=R+L;O<H;O+=3)y(i[O+0],i[O+1],i[O+2])}let _=new N,M=new N,S=new N,T=new N;function E(C){S.fromArray(n,C*3),T.copy(S);let A=l[C];_.copy(A),_.sub(S.multiplyScalar(S.dot(A))).normalize(),M.crossVectors(T,A);let D=M.dot(c[C])<0?-1:1;o[C*4]=_.x,o[C*4+1]=_.y,o[C*4+2]=_.z,o[C*4+3]=D}for(let C=0,A=x.length;C<A;++C){let D=x[C],R=D.start,L=D.count;for(let O=R,H=R+L;O<H;O+=3)E(i[O+0]),E(i[O+1]),E(i[O+2])}}computeVertexNormals(){let e=this.index,t=this.getAttribute("position");if(t!==void 0){let i=this.getAttribute("normal");if(i===void 0)i=new Qt(new Float32Array(t.count*3),3),this.setAttribute("normal",i);else for(let h=0,d=i.count;h<d;h++)i.setXYZ(h,0,0,0);let r=new N,n=new N,s=new N,a=new N,o=new N,l=new N,c=new N,u=new N;if(e)for(let h=0,d=e.count;h<d;h+=3){let f=e.getX(h+0),p=e.getX(h+1),v=e.getX(h+2);r.fromBufferAttribute(t,f),n.fromBufferAttribute(t,p),s.fromBufferAttribute(t,v),c.subVectors(s,n),u.subVectors(r,n),c.cross(u),a.fromBufferAttribute(i,f),o.fromBufferAttribute(i,p),l.fromBufferAttribute(i,v),a.add(c),o.add(c),l.add(c),i.setXYZ(f,a.x,a.y,a.z),i.setXYZ(p,o.x,o.y,o.z),i.setXYZ(v,l.x,l.y,l.z)}else for(let h=0,d=t.count;h<d;h+=3)r.fromBufferAttribute(t,h+0),n.fromBufferAttribute(t,h+1),s.fromBufferAttribute(t,h+2),c.subVectors(s,n),u.subVectors(r,n),c.cross(u),i.setXYZ(h+0,c.x,c.y,c.z),i.setXYZ(h+1,c.x,c.y,c.z),i.setXYZ(h+2,c.x,c.y,c.z);this.normalizeNormals(),i.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeBufferGeometries() instead."),this}normalizeNormals(){let e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)ss.fromBufferAttribute(e,t),ss.normalize(),e.setXYZ(t,ss.x,ss.y,ss.z)}toNonIndexed(){function e(a,o){let l=a.array,c=a.itemSize,u=a.normalized,h=new l.constructor(o.length*c),d=0,f=0;for(let p=0,v=o.length;p<v;p++){a.isInterleavedBufferAttribute?d=o[p]*a.data.stride+a.offset:d=o[p]*c;for(let m=0;m<c;m++)h[f++]=l[d++]}return new Qt(h,c,u)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;let t=new Nt,i=this.index.array,r=this.attributes;for(let a in r){let o=r[a],l=e(o,i);t.setAttribute(a,l)}let n=this.morphAttributes;for(let a in n){let o=[],l=n[a];for(let c=0,u=l.length;c<u;c++){let h=l[c],d=e(h,i);o.push(d)}t.morphAttributes[a]=o}t.morphTargetsRelative=this.morphTargetsRelative;let s=this.groups;for(let a=0,o=s.length;a<o;a++){let l=s[a];t.addGroup(l.start,l.count,l.materialIndex)}return t}toJSON(){let e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){let o=this.parameters;for(let l in o)o[l]!==void 0&&(e[l]=o[l]);return e}e.data={attributes:{}};let t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});let i=this.attributes;for(let o in i){let l=i[o];e.data.attributes[o]=l.toJSON(e.data)}let r={},n=!1;for(let o in this.morphAttributes){let l=this.morphAttributes[o],c=[];for(let u=0,h=l.length;u<h;u++){let d=l[u];c.push(d.toJSON(e.data))}c.length>0&&(r[o]=c,n=!0)}n&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);let s=this.groups;s.length>0&&(e.data.groups=JSON.parse(JSON.stringify(s)));let a=this.boundingSphere;return a!==null&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;let t={};this.name=e.name;let i=e.index;i!==null&&this.setIndex(i.clone(t));let r=e.attributes;for(let l in r){let c=r[l];this.setAttribute(l,c.clone(t))}let n=e.morphAttributes;for(let l in n){let c=[],u=n[l];for(let h=0,d=u.length;h<d;h++)c.push(u[h].clone(t));this.morphAttributes[l]=c}this.morphTargetsRelative=e.morphTargetsRelative;let s=e.groups;for(let l=0,c=s.length;l<c;l++){let u=s[l];this.addGroup(u.start,u.count,u.materialIndex)}let a=e.boundingBox;a!==null&&(this.boundingBox=a.clone());let o=e.boundingSphere;return o!==null&&(this.boundingSphere=o.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,e.parameters!==void 0&&(this.parameters=Object.assign({},e.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}},_H=new ft,Eg=new sy,UD=new uo,c1=new N,u1=new N,h1=new N,ND=new N,SS=new N,MS=new Me,ES=new Me,AS=new Me,kD=new N,TS=new N,yr=class extends rr{constructor(e=new Nt,t=new Ch){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){let e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){let i=e[t[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,n=i.length;r<n;r++){let s=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[s]=r}}}}getVertexPosition(e,t){let i=this.geometry,r=i.attributes.position,n=i.morphAttributes.position,s=i.morphTargetsRelative;t.fromBufferAttribute(r,e);let a=this.morphTargetInfluences;if(n&&a){SS.set(0,0,0);for(let o=0,l=n.length;o<l;o++){let c=a[o],u=n[o];c!==0&&(ND.fromBufferAttribute(u,e),s?SS.addScaledVector(ND,c):SS.addScaledVector(ND.sub(t),c))}t.add(SS)}return this.isSkinnedMesh&&this.boneTransform(e,t),t}raycast(e,t){let i=this.geometry,r=this.material,n=this.matrixWorld;if(r===void 0||(i.boundingSphere===null&&i.computeBoundingSphere(),UD.copy(i.boundingSphere),UD.applyMatrix4(n),e.ray.intersectsSphere(UD)===!1)||(_H.copy(n).invert(),Eg.copy(e.ray).applyMatrix4(_H),i.boundingBox!==null&&Eg.intersectsBox(i.boundingBox)===!1))return;let s,a=i.index,o=i.attributes.position,l=i.attributes.uv,c=i.attributes.uv2,u=i.groups,h=i.drawRange;if(a!==null)if(Array.isArray(r))for(let d=0,f=u.length;d<f;d++){let p=u[d],v=r[p.materialIndex],m=Math.max(p.start,h.start),g=Math.min(a.count,Math.min(p.start+p.count,h.start+h.count));for(let y=m,x=g;y<x;y+=3){let _=a.getX(y),M=a.getX(y+1),S=a.getX(y+2);s=CS(this,v,e,Eg,l,c,_,M,S),s&&(s.faceIndex=Math.floor(y/3),s.face.materialIndex=p.materialIndex,t.push(s))}}else{let d=Math.max(0,h.start),f=Math.min(a.count,h.start+h.count);for(let p=d,v=f;p<v;p+=3){let m=a.getX(p),g=a.getX(p+1),y=a.getX(p+2);s=CS(this,r,e,Eg,l,c,m,g,y),s&&(s.faceIndex=Math.floor(p/3),t.push(s))}}else if(o!==void 0)if(Array.isArray(r))for(let d=0,f=u.length;d<f;d++){let p=u[d],v=r[p.materialIndex],m=Math.max(p.start,h.start),g=Math.min(o.count,Math.min(p.start+p.count,h.start+h.count));for(let y=m,x=g;y<x;y+=3){let _=y,M=y+1,S=y+2;s=CS(this,v,e,Eg,l,c,_,M,S),s&&(s.faceIndex=Math.floor(y/3),s.face.materialIndex=p.materialIndex,t.push(s))}}else{let d=Math.max(0,h.start),f=Math.min(o.count,h.start+h.count);for(let p=d,v=f;p<v;p+=3){let m=p,g=p+1,y=p+2;s=CS(this,r,e,Eg,l,c,m,g,y),s&&(s.faceIndex=Math.floor(p/3),t.push(s))}}}};function Qge(e,t,i,r,n,s,a,o){let l;if(t.side===ms?l=r.intersectTriangle(a,s,n,!0,o):l=r.intersectTriangle(n,s,a,t.side===nc,o),l===null)return null;TS.copy(o),TS.applyMatrix4(e.matrixWorld);let c=i.ray.origin.distanceTo(TS);return c<i.near||c>i.far?null:{distance:c,point:TS.clone(),object:e}}function CS(e,t,i,r,n,s,a,o,l){e.getVertexPosition(a,c1),e.getVertexPosition(o,u1),e.getVertexPosition(l,h1);let c=Qge(e,t,i,r,c1,u1,h1,kD);if(c){n&&(MS.fromBufferAttribute(n,a),ES.fromBufferAttribute(n,o),AS.fromBufferAttribute(n,l),c.uv=Rs.getUV(kD,c1,u1,h1,MS,ES,AS,new Me)),s&&(MS.fromBufferAttribute(s,a),ES.fromBufferAttribute(s,o),AS.fromBufferAttribute(s,l),c.uv2=Rs.getUV(kD,c1,u1,h1,MS,ES,AS,new Me));let u={a,b:o,c:l,normal:new N,materialIndex:0};Rs.getNormal(c1,u1,h1,u.normal),c.face=u}return c}var ac=class extends Nt{constructor(e=1,t=1,i=1,r=1,n=1,s=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:r,heightSegments:n,depthSegments:s};let a=this;r=Math.floor(r),n=Math.floor(n),s=Math.floor(s);let o=[],l=[],c=[],u=[],h=0,d=0;f("z","y","x",-1,-1,i,t,e,s,n,0),f("z","y","x",1,-1,i,t,-e,s,n,1),f("x","z","y",1,1,e,i,t,r,s,2),f("x","z","y",1,-1,e,i,-t,r,s,3),f("x","y","z",1,-1,e,t,i,r,n,4),f("x","y","z",-1,-1,e,t,-i,r,n,5),this.setIndex(o),this.setAttribute("position",new _t(l,3)),this.setAttribute("normal",new _t(c,3)),this.setAttribute("uv",new _t(u,2));function f(p,v,m,g,y,x,_,M,S,T,E){let C=x/S,A=_/T,D=x/2,R=_/2,L=M/2,O=S+1,H=T+1,j=0,Y=0,z=new N;for(let V=0;V<H;V++){let U=V*A-R;for(let k=0;k<O;k++){let X=k*C-D;z[p]=X*g,z[v]=U*y,z[m]=L,l.push(z.x,z.y,z.z),z[p]=0,z[v]=0,z[m]=M>0?1:-1,c.push(z.x,z.y,z.z),u.push(k/S),u.push(1-V/T),j+=1}}for(let V=0;V<T;V++)for(let U=0;U<S;U++){let k=h+U+O*V,X=h+U+O*(V+1),re=h+(U+1)+O*(V+1),q=h+(U+1)+O*V;o.push(k,X,q),o.push(X,re,q),Y+=6}a.addGroup(d,Y,E),d+=Y,h+=j}}static fromJSON(e){return new ac(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}};function L0(e){let t={};for(let i in e){t[i]={};for(let r in e[i]){let n=e[i][r];n&&(n.isColor||n.isMatrix3||n.isMatrix4||n.isVector2||n.isVector3||n.isVector4||n.isTexture||n.isQuaternion)?t[i][r]=n.clone():Array.isArray(n)?t[i][r]=n.slice():t[i][r]=n}}return t}function Sa(e){let t={};for(let i=0;i<e.length;i++){let r=L0(e[i]);for(let n in r)t[n]=r[n]}return t}function Zge(e){let t=[];for(let i=0;i<e.length;i++)t.push(e[i].clone());return t}function kJ(e){return e.getRenderTarget()===null&&e.outputEncoding===vi?zc:oA}var ay={clone:L0,merge:Sa},Kge=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,Jge=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`,ki=class extends Cb{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=Kge,this.fragmentShader=Jge,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=L0(e.uniforms),this.uniformsGroups=Zge(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){let t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(let r in this.uniforms){let n=this.uniforms[r].value;n&&n.isTexture?t.uniforms[r]={type:"t",value:n.toJSON(e).uuid}:n&&n.isColor?t.uniforms[r]={type:"c",value:n.getHex()}:n&&n.isVector2?t.uniforms[r]={type:"v2",value:n.toArray()}:n&&n.isVector3?t.uniforms[r]={type:"v3",value:n.toArray()}:n&&n.isVector4?t.uniforms[r]={type:"v4",value:n.toArray()}:n&&n.isMatrix3?t.uniforms[r]={type:"m3",value:n.toArray()}:n&&n.isMatrix4?t.uniforms[r]={type:"m4",value:n.toArray()}:t.uniforms[r]={value:n}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;let i={};for(let r in this.extensions)this.extensions[r]===!0&&(i[r]=!0);return Object.keys(i).length>0&&(t.extensions=i),t}},Cf=class extends rr{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new ft,this.projectionMatrix=new ft,this.projectionMatrixInverse=new ft}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);let t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}},ta=class extends Cf{constructor(e=50,t=1,i=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){let t=.5*this.getFilmHeight()/e;this.fov=Cw*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){let e=Math.tan(Px*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return Cw*2*Math.atan(Math.tan(Px*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,i,r,n,s){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=n,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=this.near,t=e*Math.tan(Px*.5*this.fov)/this.zoom,i=2*t,r=this.aspect*i,n=-.5*r,s=this.view;if(this.view!==null&&this.view.enabled){let o=s.fullWidth,l=s.fullHeight;n+=s.offsetX*r/o,t-=s.offsetY*i/l,r*=s.width/o,i*=s.height/l}let a=this.filmOffset;a!==0&&(n+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(n,n+r,t,t-i,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){let t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}},Ag=-90,Tg=1,$ge=class extends rr{constructor(e,t,i){super(),this.type="CubeCamera",this.renderTarget=i;let r=new ta(Ag,Tg,e,t);r.layers=this.layers,r.up.set(0,1,0),r.lookAt(1,0,0),this.add(r);let n=new ta(Ag,Tg,e,t);n.layers=this.layers,n.up.set(0,1,0),n.lookAt(-1,0,0),this.add(n);let s=new ta(Ag,Tg,e,t);s.layers=this.layers,s.up.set(0,0,-1),s.lookAt(0,1,0),this.add(s);let a=new ta(Ag,Tg,e,t);a.layers=this.layers,a.up.set(0,0,1),a.lookAt(0,-1,0),this.add(a);let o=new ta(Ag,Tg,e,t);o.layers=this.layers,o.up.set(0,1,0),o.lookAt(0,0,1),this.add(o);let l=new ta(Ag,Tg,e,t);l.layers=this.layers,l.up.set(0,1,0),l.lookAt(0,0,-1),this.add(l)}update(e,t){this.parent===null&&this.updateMatrixWorld();let i=this.renderTarget,[r,n,s,a,o,l]=this.children,c=e.getRenderTarget(),u=e.toneMapping,h=e.xr.enabled;e.toneMapping=Jc,e.xr.enabled=!1;let d=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0),e.render(t,r),e.setRenderTarget(i,1),e.render(t,n),e.setRenderTarget(i,2),e.render(t,s),e.setRenderTarget(i,3),e.render(t,a),e.setRenderTarget(i,4),e.render(t,o),i.texture.generateMipmaps=d,e.setRenderTarget(i,5),e.render(t,l),e.setRenderTarget(c),e.toneMapping=u,e.xr.enabled=h,i.texture.needsPMREMUpdate=!0}},$U=class extends jr{constructor(e,t,i,r,n,s,a,o,l,c){e=e!==void 0?e:[],t=t!==void 0?t:_m,super(e,t,i,r,n,s,a,o,l,c),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}},eve=class extends Ni{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;let i={width:e,height:e,depth:1},r=[i,i,i,i,i,i];this.texture=new $U(r,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:bi}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;let i={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},r=new ac(5,5,5),n=new ki({name:"CubemapFromEquirect",uniforms:L0(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:ms,blending:Ln});n.uniforms.tEquirect.value=t;let s=new yr(r,n),a=t.minFilter;return t.minFilter===I0&&(t.minFilter=bi),new $ge(1,10,this).update(e,s),t.minFilter=a,s.geometry.dispose(),s.material.dispose(),this}clear(e,t,i,r){let n=e.getRenderTarget();for(let s=0;s<6;s++)e.setRenderTarget(this,s),e.clear(t,i,r);e.setRenderTarget(n)}},VD=new N,tve=new N,ive=new Dn,Ka=class{constructor(e=new N(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,r){return this.normal.set(e,t,i),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){let r=VD.subVectors(i,t).cross(tve.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){let e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){let i=e.delta(VD),r=this.normal.dot(i);if(r===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;let n=-(e.start.dot(this.normal)+this.constant)/r;return n<0||n>1?null:t.copy(i).multiplyScalar(n).add(e.start)}intersectsLine(e){let t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){let i=t||ive.getNormalMatrix(e),r=this.coplanarPoint(VD).applyMatrix4(e),n=this.normal.applyMatrix3(i).normalize();return this.constant=-r.dot(n),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}},Cg=new uo,PS=new N,eN=class{constructor(e=new Ka,t=new Ka,i=new Ka,r=new Ka,n=new Ka,s=new Ka){this.planes=[e,t,i,r,n,s]}set(e,t,i,r,n,s){let a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(i),a[3].copy(r),a[4].copy(n),a[5].copy(s),this}copy(e){let t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e){let t=this.planes,i=e.elements,r=i[0],n=i[1],s=i[2],a=i[3],o=i[4],l=i[5],c=i[6],u=i[7],h=i[8],d=i[9],f=i[10],p=i[11],v=i[12],m=i[13],g=i[14],y=i[15];return t[0].setComponents(a-r,u-o,p-h,y-v).normalize(),t[1].setComponents(a+r,u+o,p+h,y+v).normalize(),t[2].setComponents(a+n,u+l,p+d,y+m).normalize(),t[3].setComponents(a-n,u-l,p-d,y-m).normalize(),t[4].setComponents(a-s,u-c,p-f,y-g).normalize(),t[5].setComponents(a+s,u+c,p+f,y+g).normalize(),this}intersectsObject(e){let t=e.geometry;return t.boundingSphere===null&&t.computeBoundingSphere(),Cg.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(Cg)}intersectsSprite(e){return Cg.center.set(0,0,0),Cg.radius=.7071067811865476,Cg.applyMatrix4(e.matrixWorld),this.intersectsSphere(Cg)}intersectsSphere(e){let t=this.planes,i=e.center,r=-e.radius;for(let n=0;n<6;n++)if(t[n].distanceToPoint(i)<r)return!1;return!0}intersectsBox(e){let t=this.planes;for(let i=0;i<6;i++){let r=t[i];if(PS.x=r.normal.x>0?e.max.x:e.min.x,PS.y=r.normal.y>0?e.max.y:e.min.y,PS.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(PS)<0)return!1}return!0}containsPoint(e){let t=this.planes;for(let i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}};function VJ(){let e=null,t=!1,i=null,r=null;function n(s,a){i(s,a),r=e.requestAnimationFrame(n)}return{start:function(){t!==!0&&i!==null&&(r=e.requestAnimationFrame(n),t=!0)},stop:function(){e.cancelAnimationFrame(r),t=!1},setAnimationLoop:function(s){i=s},setContext:function(s){e=s}}}function rve(e,t){let i=t.isWebGL2,r=new WeakMap;function n(c,u){let h=c.array,d=c.usage,f=e.createBuffer();e.bindBuffer(u,f),e.bufferData(u,h,d),c.onUploadCallback();let p;if(h instanceof Float32Array)p=5126;else if(h instanceof Uint16Array)if(c.isFloat16BufferAttribute)if(i)p=5131;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else p=5123;else if(h instanceof Int16Array)p=5122;else if(h instanceof Uint32Array)p=5125;else if(h instanceof Int32Array)p=5124;else if(h instanceof Int8Array)p=5120;else if(h instanceof Uint8Array)p=5121;else if(h instanceof Uint8ClampedArray)p=5121;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+h);return{buffer:f,type:p,bytesPerElement:h.BYTES_PER_ELEMENT,version:c.version}}function s(c,u,h){let d=u.array,f=u.updateRange;e.bindBuffer(h,c),f.count===-1?e.bufferSubData(h,0,d):(i?e.bufferSubData(h,f.offset*d.BYTES_PER_ELEMENT,d,f.offset,f.count):e.bufferSubData(h,f.offset*d.BYTES_PER_ELEMENT,d.subarray(f.offset,f.offset+f.count)),f.count=-1),u.onUploadCallback()}function a(c){return c.isInterleavedBufferAttribute&&(c=c.data),r.get(c)}function o(c){c.isInterleavedBufferAttribute&&(c=c.data);let u=r.get(c);u&&(e.deleteBuffer(u.buffer),r.delete(c))}function l(c,u){if(c.isGLBufferAttribute){let d=r.get(c);(!d||d.version<c.version)&&r.set(c,{buffer:c.buffer,type:c.type,bytesPerElement:c.elementSize,version:c.version});return}c.isInterleavedBufferAttribute&&(c=c.data);let h=r.get(c);h===void 0?r.set(c,n(c,u)):h.version<c.version&&(s(h.buffer,c,u),h.version=c.version)}return{get:a,remove:o,update:l}}var au=class extends Nt{constructor(e=1,t=1,i=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:r};let n=e/2,s=t/2,a=Math.floor(i),o=Math.floor(r),l=a+1,c=o+1,u=e/a,h=t/o,d=[],f=[],p=[],v=[];for(let m=0;m<c;m++){let g=m*h-s;for(let y=0;y<l;y++){let x=y*u-n;f.push(x,-g,0),p.push(0,0,1),v.push(y/a),v.push(1-m/o)}}for(let m=0;m<o;m++)for(let g=0;g<a;g++){let y=g+l*m,x=g+l*(m+1),_=g+1+l*(m+1),M=g+1+l*m;d.push(y,x,M),d.push(x,_,M)}this.setIndex(d),this.setAttribute("position",new _t(f,3)),this.setAttribute("normal",new _t(p,3)),this.setAttribute("uv",new _t(v,2))}static fromJSON(e){return new au(e.width,e.height,e.widthSegments,e.heightSegments)}},nve=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,sve=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,ave=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,ove=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,lve=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,cve=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,uve="vec3 transformed = vec3( position );",hve=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,dve=`vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( V * D );
}
#ifdef USE_IRIDESCENCE
	vec3 BRDF_GGX_Iridescence( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float iridescence, const in vec3 iridescenceFresnel, const in float roughness ) {
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = mix( F_Schlick( f0, f90, dotVH ), iridescenceFresnel, iridescence );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif`,fve=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			 return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float R21 = R12;
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,pve=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = dFdx( surf_pos.xyz );
		vec3 vSigmaY = dFdy( surf_pos.xyz );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,mve=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,gve=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,vve=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,yve=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,xve=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,wve=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,bve=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,_ve=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,Sve=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,Mve=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_v0 0.339
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_v1 0.276
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_v4 0.046
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_v5 0.016
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_v6 0.0038
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,Eve=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,Ave=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,Tve=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,Cve=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,Pve=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,Dve="gl_FragColor = linearToOutputTexel( gl_FragColor );",Rve=`vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,Ive=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,Lve=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,Ove=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,zve=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,Bve=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,Fve=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,Uve=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,Nve=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,kve=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,Vve=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,Gve=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vUv2 );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,Hve=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,jve=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,Wve=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,Xve=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( PHYSICALLY_CORRECT_LIGHTS )
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#else
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,qve=`#if defined( USE_ENVMAP )
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
#endif`,Yve=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,Qve=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,Zve=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,Kve=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,Jve=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULARINTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;
		#endif
		#ifdef USE_SPECULARCOLORMAP
			specularColorFactor *= texture2D( specularColorMap, vUv ).rgb;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEENCOLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEENROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;
	#endif
#endif`,$ve=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	#ifdef USE_IRIDESCENCE
		reflectedLight.directSpecular += irradiance * BRDF_GGX_Iridescence( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness );
	#else
		reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,e0e=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometry.viewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,t0e=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,i0e=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,r0e=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,n0e=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,s0e=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,a0e=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,o0e=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,l0e=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,c0e=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,u0e=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,h0e=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,d0e=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,f0e=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,p0e=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,m0e=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,g0e=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,v0e=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * faceDirection;
			bitangent = bitangent * faceDirection;
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,y0e=`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,x0e=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,w0e=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,b0e=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,_0e=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );
		return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );
	}
#endif`,S0e=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,M0e=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );
	#endif
#endif`,E0e=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,A0e=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,T0e=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha + 0.1;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,C0e=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,P0e=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,D0e=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,R0e=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,I0e=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,L0e=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,O0e=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,z0e=`#if NUM_SPOT_LIGHT_COORDS > 0
  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
  uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,B0e=`#if NUM_SPOT_LIGHT_COORDS > 0
  uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,F0e=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,U0e=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,N0e=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,k0e=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	uniform int boneTextureSize;
	mat4 getBoneMatrix( const in float i ) {
		float j = i * 4.0;
		float x = mod( j, float( boneTextureSize ) );
		float y = floor( j / float( boneTextureSize ) );
		float dx = 1.0 / float( boneTextureSize );
		float dy = 1.0 / float( boneTextureSize );
		y = dy * ( y + 0.5 );
		vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
		vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
		vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
		vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
		mat4 bone = mat4( v1, v2, v3, v4 );
		return bone;
	}
#endif`,V0e=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,G0e=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,H0e=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,j0e=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,W0e=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,X0e=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,q0e=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmission = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmission.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );
#endif`,Y0e=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		#ifdef texture2DLodEXT
			return texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#else
			return texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#endif
	}
	vec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance * radiance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
	}
#endif`,Q0e=`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,Z0e=`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,K0e=`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,J0e=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,$0e=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,eye=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,tye=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`,iye=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,rye=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,nye=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,sye=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,aye=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,oye=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,lye=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,cye=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,uye=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,hye=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,dye=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,fye=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,pye=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,mye=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,gye=`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,vye=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,yye=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,xye=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,wye=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,bye=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,_ye=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,Sye=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,Mye=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Eye=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Aye=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,Tye=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULARINTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
	#ifdef USE_SPECULARCOLORMAP
		uniform sampler2D specularColorMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEENCOLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEENROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Cye=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Pye=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Dye=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,Rye=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,Iye=`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Lye=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,Oye=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,zye=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,yi={alphamap_fragment:nve,alphamap_pars_fragment:sve,alphatest_fragment:ave,alphatest_pars_fragment:ove,aomap_fragment:lve,aomap_pars_fragment:cve,begin_vertex:uve,beginnormal_vertex:hve,bsdfs:dve,iridescence_fragment:fve,bumpmap_pars_fragment:pve,clipping_planes_fragment:mve,clipping_planes_pars_fragment:gve,clipping_planes_pars_vertex:vve,clipping_planes_vertex:yve,color_fragment:xve,color_pars_fragment:wve,color_pars_vertex:bve,color_vertex:_ve,common:Sve,cube_uv_reflection_fragment:Mve,defaultnormal_vertex:Eve,displacementmap_pars_vertex:Ave,displacementmap_vertex:Tve,emissivemap_fragment:Cve,emissivemap_pars_fragment:Pve,encodings_fragment:Dve,encodings_pars_fragment:Rve,envmap_fragment:Ive,envmap_common_pars_fragment:Lve,envmap_pars_fragment:Ove,envmap_pars_vertex:zve,envmap_physical_pars_fragment:qve,envmap_vertex:Bve,fog_vertex:Fve,fog_pars_vertex:Uve,fog_fragment:Nve,fog_pars_fragment:kve,gradientmap_pars_fragment:Vve,lightmap_fragment:Gve,lightmap_pars_fragment:Hve,lights_lambert_fragment:jve,lights_lambert_pars_fragment:Wve,lights_pars_begin:Xve,lights_toon_fragment:Yve,lights_toon_pars_fragment:Qve,lights_phong_fragment:Zve,lights_phong_pars_fragment:Kve,lights_physical_fragment:Jve,lights_physical_pars_fragment:$ve,lights_fragment_begin:e0e,lights_fragment_maps:t0e,lights_fragment_end:i0e,logdepthbuf_fragment:r0e,logdepthbuf_pars_fragment:n0e,logdepthbuf_pars_vertex:s0e,logdepthbuf_vertex:a0e,map_fragment:o0e,map_pars_fragment:l0e,map_particle_fragment:c0e,map_particle_pars_fragment:u0e,metalnessmap_fragment:h0e,metalnessmap_pars_fragment:d0e,morphcolor_vertex:f0e,morphnormal_vertex:p0e,morphtarget_pars_vertex:m0e,morphtarget_vertex:g0e,normal_fragment_begin:v0e,normal_fragment_maps:y0e,normal_pars_fragment:x0e,normal_pars_vertex:w0e,normal_vertex:b0e,normalmap_pars_fragment:_0e,clearcoat_normal_fragment_begin:S0e,clearcoat_normal_fragment_maps:M0e,clearcoat_pars_fragment:E0e,iridescence_pars_fragment:A0e,output_fragment:T0e,packing:C0e,premultiplied_alpha_fragment:P0e,project_vertex:D0e,dithering_fragment:R0e,dithering_pars_fragment:I0e,roughnessmap_fragment:L0e,roughnessmap_pars_fragment:O0e,shadowmap_pars_fragment:z0e,shadowmap_pars_vertex:B0e,shadowmap_vertex:F0e,shadowmask_pars_fragment:U0e,skinbase_vertex:N0e,skinning_pars_vertex:k0e,skinning_vertex:V0e,skinnormal_vertex:G0e,specularmap_fragment:H0e,specularmap_pars_fragment:j0e,tonemapping_fragment:W0e,tonemapping_pars_fragment:X0e,transmission_fragment:q0e,transmission_pars_fragment:Y0e,uv_pars_fragment:Q0e,uv_pars_vertex:Z0e,uv_vertex:K0e,uv2_pars_fragment:J0e,uv2_pars_vertex:$0e,uv2_vertex:eye,worldpos_vertex:tye,background_vert:iye,background_frag:rye,backgroundCube_vert:nye,backgroundCube_frag:sye,cube_vert:aye,cube_frag:oye,depth_vert:lye,depth_frag:cye,distanceRGBA_vert:uye,distanceRGBA_frag:hye,equirect_vert:dye,equirect_frag:fye,linedashed_vert:pye,linedashed_frag:mye,meshbasic_vert:gye,meshbasic_frag:vye,meshlambert_vert:yye,meshlambert_frag:xye,meshmatcap_vert:wye,meshmatcap_frag:bye,meshnormal_vert:_ye,meshnormal_frag:Sye,meshphong_vert:Mye,meshphong_frag:Eye,meshphysical_vert:Aye,meshphysical_frag:Tye,meshtoon_vert:Cye,meshtoon_frag:Pye,points_vert:Dye,points_frag:Rye,shadow_vert:Iye,shadow_frag:Lye,sprite_vert:Oye,sprite_frag:zye},xt={common:{diffuse:{value:new Yt(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new Dn},uv2Transform:{value:new Dn},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Me(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Yt(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Yt(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Dn}},sprite:{diffuse:{value:new Yt(16777215)},opacity:{value:1},center:{value:new Me(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Dn}}},Fc={basic:{uniforms:Sa([xt.common,xt.specularmap,xt.envmap,xt.aomap,xt.lightmap,xt.fog]),vertexShader:yi.meshbasic_vert,fragmentShader:yi.meshbasic_frag},lambert:{uniforms:Sa([xt.common,xt.specularmap,xt.envmap,xt.aomap,xt.lightmap,xt.emissivemap,xt.bumpmap,xt.normalmap,xt.displacementmap,xt.fog,xt.lights,{emissive:{value:new Yt(0)}}]),vertexShader:yi.meshlambert_vert,fragmentShader:yi.meshlambert_frag},phong:{uniforms:Sa([xt.common,xt.specularmap,xt.envmap,xt.aomap,xt.lightmap,xt.emissivemap,xt.bumpmap,xt.normalmap,xt.displacementmap,xt.fog,xt.lights,{emissive:{value:new Yt(0)},specular:{value:new Yt(1118481)},shininess:{value:30}}]),vertexShader:yi.meshphong_vert,fragmentShader:yi.meshphong_frag},standard:{uniforms:Sa([xt.common,xt.envmap,xt.aomap,xt.lightmap,xt.emissivemap,xt.bumpmap,xt.normalmap,xt.displacementmap,xt.roughnessmap,xt.metalnessmap,xt.fog,xt.lights,{emissive:{value:new Yt(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:yi.meshphysical_vert,fragmentShader:yi.meshphysical_frag},toon:{uniforms:Sa([xt.common,xt.aomap,xt.lightmap,xt.emissivemap,xt.bumpmap,xt.normalmap,xt.displacementmap,xt.gradientmap,xt.fog,xt.lights,{emissive:{value:new Yt(0)}}]),vertexShader:yi.meshtoon_vert,fragmentShader:yi.meshtoon_frag},matcap:{uniforms:Sa([xt.common,xt.bumpmap,xt.normalmap,xt.displacementmap,xt.fog,{matcap:{value:null}}]),vertexShader:yi.meshmatcap_vert,fragmentShader:yi.meshmatcap_frag},points:{uniforms:Sa([xt.points,xt.fog]),vertexShader:yi.points_vert,fragmentShader:yi.points_frag},dashed:{uniforms:Sa([xt.common,xt.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:yi.linedashed_vert,fragmentShader:yi.linedashed_frag},depth:{uniforms:Sa([xt.common,xt.displacementmap]),vertexShader:yi.depth_vert,fragmentShader:yi.depth_frag},normal:{uniforms:Sa([xt.common,xt.bumpmap,xt.normalmap,xt.displacementmap,{opacity:{value:1}}]),vertexShader:yi.meshnormal_vert,fragmentShader:yi.meshnormal_frag},sprite:{uniforms:Sa([xt.sprite,xt.fog]),vertexShader:yi.sprite_vert,fragmentShader:yi.sprite_frag},background:{uniforms:{uvTransform:{value:new Dn},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:yi.background_vert,fragmentShader:yi.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:yi.backgroundCube_vert,fragmentShader:yi.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:yi.cube_vert,fragmentShader:yi.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:yi.equirect_vert,fragmentShader:yi.equirect_frag},distanceRGBA:{uniforms:Sa([xt.common,xt.displacementmap,{referencePosition:{value:new N},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:yi.distanceRGBA_vert,fragmentShader:yi.distanceRGBA_frag},shadow:{uniforms:Sa([xt.lights,xt.fog,{color:{value:new Yt(0)},opacity:{value:1}}]),vertexShader:yi.shadow_vert,fragmentShader:yi.shadow_frag}};Fc.physical={uniforms:Sa([Fc.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Me(1,1)},clearcoatNormalMap:{value:null},iridescence:{value:0},iridescenceMap:{value:null},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},sheen:{value:0},sheenColor:{value:new Yt(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new Me},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new Yt(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new Yt(1,1,1)},specularColorMap:{value:null}}]),vertexShader:yi.meshphysical_vert,fragmentShader:yi.meshphysical_frag};var DS={r:0,b:0,g:0};function Bye(e,t,i,r,n,s,a){let o=new Yt(0),l=s===!0?0:1,c,u,h=null,d=0,f=null;function p(m,g){let y=!1,x=g.isScene===!0?g.background:null;x&&x.isTexture&&(x=(g.backgroundBlurriness>0?i:t).get(x));let _=e.xr,M=_.getSession&&_.getSession();M&&M.environmentBlendMode==="additive"&&(x=null),x===null?v(o,l):x&&x.isColor&&(v(x,1),y=!0),(e.autoClear||y)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),x&&(x.isCubeTexture||x.mapping===Tb)?(u===void 0&&(u=new yr(new ac(1,1,1),new ki({name:"BackgroundCubeMaterial",uniforms:L0(Fc.backgroundCube.uniforms),vertexShader:Fc.backgroundCube.vertexShader,fragmentShader:Fc.backgroundCube.fragmentShader,side:ms,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),u.geometry.deleteAttribute("uv"),u.onBeforeRender=function(S,T,E){this.matrixWorld.copyPosition(E.matrixWorld)},Object.defineProperty(u.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(u)),u.material.uniforms.envMap.value=x,u.material.uniforms.flipEnvMap.value=x.isCubeTexture&&x.isRenderTargetTexture===!1?-1:1,u.material.uniforms.backgroundBlurriness.value=g.backgroundBlurriness,u.material.uniforms.backgroundIntensity.value=g.backgroundIntensity,u.material.toneMapped=x.encoding!==vi,(h!==x||d!==x.version||f!==e.toneMapping)&&(u.material.needsUpdate=!0,h=x,d=x.version,f=e.toneMapping),u.layers.enableAll(),m.unshift(u,u.geometry,u.material,0,0,null)):x&&x.isTexture&&(c===void 0&&(c=new yr(new au(2,2),new ki({name:"BackgroundMaterial",uniforms:L0(Fc.background.uniforms),vertexShader:Fc.background.vertexShader,fragmentShader:Fc.background.fragmentShader,side:nc,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),Object.defineProperty(c.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(c)),c.material.uniforms.t2D.value=x,c.material.uniforms.backgroundIntensity.value=g.backgroundIntensity,c.material.toneMapped=x.encoding!==vi,x.matrixAutoUpdate===!0&&x.updateMatrix(),c.material.uniforms.uvTransform.value.copy(x.matrix),(h!==x||d!==x.version||f!==e.toneMapping)&&(c.material.needsUpdate=!0,h=x,d=x.version,f=e.toneMapping),c.layers.enableAll(),m.unshift(c,c.geometry,c.material,0,0,null))}function v(m,g){m.getRGB(DS,kJ(e)),r.buffers.color.setClear(DS.r,DS.g,DS.b,g,a)}return{getClearColor:function(){return o},setClearColor:function(m,g=1){o.set(m),l=g,v(o,l)},getClearAlpha:function(){return l},setClearAlpha:function(m){l=m,v(o,l)},render:p}}function Fye(e,t,i,r){let n=e.getParameter(34921),s=r.isWebGL2?null:t.get("OES_vertex_array_object"),a=r.isWebGL2||s!==null,o={},l=m(null),c=l,u=!1;function h(O,H,j,Y,z){let V=!1;if(a){let U=v(Y,j,H);c!==U&&(c=U,f(c.object)),V=g(O,Y,j,z),V&&y(O,Y,j,z)}else{let U=H.wireframe===!0;(c.geometry!==Y.id||c.program!==j.id||c.wireframe!==U)&&(c.geometry=Y.id,c.program=j.id,c.wireframe=U,V=!0)}z!==null&&i.update(z,34963),(V||u)&&(u=!1,E(O,H,j,Y),z!==null&&e.bindBuffer(34963,i.get(z).buffer))}function d(){return r.isWebGL2?e.createVertexArray():s.createVertexArrayOES()}function f(O){return r.isWebGL2?e.bindVertexArray(O):s.bindVertexArrayOES(O)}function p(O){return r.isWebGL2?e.deleteVertexArray(O):s.deleteVertexArrayOES(O)}function v(O,H,j){let Y=j.wireframe===!0,z=o[O.id];z===void 0&&(z={},o[O.id]=z);let V=z[H.id];V===void 0&&(V={},z[H.id]=V);let U=V[Y];return U===void 0&&(U=m(d()),V[Y]=U),U}function m(O){let H=[],j=[],Y=[];for(let z=0;z<n;z++)H[z]=0,j[z]=0,Y[z]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:H,enabledAttributes:j,attributeDivisors:Y,object:O,attributes:{},index:null}}function g(O,H,j,Y){let z=c.attributes,V=H.attributes,U=0,k=j.getAttributes();for(let X in k)if(k[X].location>=0){let re=z[X],q=V[X];if(q===void 0&&(X==="instanceMatrix"&&O.instanceMatrix&&(q=O.instanceMatrix),X==="instanceColor"&&O.instanceColor&&(q=O.instanceColor)),re===void 0||re.attribute!==q||q&&re.data!==q.data)return!0;U++}return c.attributesNum!==U||c.index!==Y}function y(O,H,j,Y){let z={},V=H.attributes,U=0,k=j.getAttributes();for(let X in k)if(k[X].location>=0){let re=V[X];re===void 0&&(X==="instanceMatrix"&&O.instanceMatrix&&(re=O.instanceMatrix),X==="instanceColor"&&O.instanceColor&&(re=O.instanceColor));let q={};q.attribute=re,re&&re.data&&(q.data=re.data),z[X]=q,U++}c.attributes=z,c.attributesNum=U,c.index=Y}function x(){let O=c.newAttributes;for(let H=0,j=O.length;H<j;H++)O[H]=0}function _(O){M(O,0)}function M(O,H){let j=c.newAttributes,Y=c.enabledAttributes,z=c.attributeDivisors;j[O]=1,Y[O]===0&&(e.enableVertexAttribArray(O),Y[O]=1),z[O]!==H&&((r.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](O,H),z[O]=H)}function S(){let O=c.newAttributes,H=c.enabledAttributes;for(let j=0,Y=H.length;j<Y;j++)H[j]!==O[j]&&(e.disableVertexAttribArray(j),H[j]=0)}function T(O,H,j,Y,z,V){r.isWebGL2===!0&&(j===5124||j===5125)?e.vertexAttribIPointer(O,H,j,z,V):e.vertexAttribPointer(O,H,j,Y,z,V)}function E(O,H,j,Y){if(r.isWebGL2===!1&&(O.isInstancedMesh||Y.isInstancedBufferGeometry)&&t.get("ANGLE_instanced_arrays")===null)return;x();let z=Y.attributes,V=j.getAttributes(),U=H.defaultAttributeValues;for(let k in V){let X=V[k];if(X.location>=0){let re=z[k];if(re===void 0&&(k==="instanceMatrix"&&O.instanceMatrix&&(re=O.instanceMatrix),k==="instanceColor"&&O.instanceColor&&(re=O.instanceColor)),re!==void 0){let q=re.normalized,ee=re.itemSize,$=i.get(re);if($===void 0)continue;let ne=$.buffer,ce=$.type,pe=$.bytesPerElement;if(re.isInterleavedBufferAttribute){let ge=re.data,we=ge.stride,le=re.offset;if(ge.isInstancedInterleavedBuffer){for(let ve=0;ve<X.locationSize;ve++)M(X.location+ve,ge.meshPerAttribute);O.isInstancedMesh!==!0&&Y._maxInstanceCount===void 0&&(Y._maxInstanceCount=ge.meshPerAttribute*ge.count)}else for(let ve=0;ve<X.locationSize;ve++)_(X.location+ve);e.bindBuffer(34962,ne);for(let ve=0;ve<X.locationSize;ve++)T(X.location+ve,ee/X.locationSize,ce,q,we*pe,(le+ee/X.locationSize*ve)*pe)}else{if(re.isInstancedBufferAttribute){for(let ge=0;ge<X.locationSize;ge++)M(X.location+ge,re.meshPerAttribute);O.isInstancedMesh!==!0&&Y._maxInstanceCount===void 0&&(Y._maxInstanceCount=re.meshPerAttribute*re.count)}else for(let ge=0;ge<X.locationSize;ge++)_(X.location+ge);e.bindBuffer(34962,ne);for(let ge=0;ge<X.locationSize;ge++)T(X.location+ge,ee/X.locationSize,ce,q,ee*pe,ee/X.locationSize*ge*pe)}}else if(U!==void 0){let q=U[k];if(q!==void 0)switch(q.length){case 2:e.vertexAttrib2fv(X.location,q);break;case 3:e.vertexAttrib3fv(X.location,q);break;case 4:e.vertexAttrib4fv(X.location,q);break;default:e.vertexAttrib1fv(X.location,q)}}}}S()}function C(){R();for(let O in o){let H=o[O];for(let j in H){let Y=H[j];for(let z in Y)p(Y[z].object),delete Y[z];delete H[j]}delete o[O]}}function A(O){if(o[O.id]===void 0)return;let H=o[O.id];for(let j in H){let Y=H[j];for(let z in Y)p(Y[z].object),delete Y[z];delete H[j]}delete o[O.id]}function D(O){for(let H in o){let j=o[H];if(j[O.id]===void 0)continue;let Y=j[O.id];for(let z in Y)p(Y[z].object),delete Y[z];delete j[O.id]}}function R(){L(),u=!0,c!==l&&(c=l,f(c.object))}function L(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:h,reset:R,resetDefaultState:L,dispose:C,releaseStatesOfGeometry:A,releaseStatesOfProgram:D,initAttributes:x,enableAttribute:_,disableUnusedAttributes:S}}function Uye(e,t,i,r){let n=r.isWebGL2,s;function a(c){s=c}function o(c,u){e.drawArrays(s,c,u),i.update(u,s,1)}function l(c,u,h){if(h===0)return;let d,f;if(n)d=e,f="drawArraysInstanced";else if(d=t.get("ANGLE_instanced_arrays"),f="drawArraysInstancedANGLE",d===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}d[f](s,c,u,h),i.update(u,s,h)}this.setMode=a,this.render=o,this.renderInstances=l}function Nye(e,t,i){let r;function n(){if(r!==void 0)return r;if(t.has("EXT_texture_filter_anisotropic")===!0){let T=t.get("EXT_texture_filter_anisotropic");r=e.getParameter(T.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r}function s(T){if(T==="highp"){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";T="mediump"}return T==="mediump"&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}let a=typeof WebGL2RenderingContext<"u"&&e instanceof WebGL2RenderingContext,o=i.precision!==void 0?i.precision:"highp",l=s(o);l!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",l,"instead."),o=l);let c=a||t.has("WEBGL_draw_buffers"),u=i.logarithmicDepthBuffer===!0,h=e.getParameter(34930),d=e.getParameter(35660),f=e.getParameter(3379),p=e.getParameter(34076),v=e.getParameter(34921),m=e.getParameter(36347),g=e.getParameter(36348),y=e.getParameter(36349),x=d>0,_=a||t.has("OES_texture_float"),M=x&&_,S=a?e.getParameter(36183):0;return{isWebGL2:a,drawBuffers:c,getMaxAnisotropy:n,getMaxPrecision:s,precision:o,logarithmicDepthBuffer:u,maxTextures:h,maxVertexTextures:d,maxTextureSize:f,maxCubemapSize:p,maxAttributes:v,maxVertexUniforms:m,maxVaryings:g,maxFragmentUniforms:y,vertexTextures:x,floatFragmentTextures:_,floatVertexTextures:M,maxSamples:S}}function kye(e){let t=this,i=null,r=0,n=!1,s=!1,a=new Ka,o=new Dn,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(h,d){let f=h.length!==0||d||r!==0||n;return n=d,r=h.length,f},this.beginShadows=function(){s=!0,u(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(h,d){i=u(h,d,0)},this.setState=function(h,d,f){let p=h.clippingPlanes,v=h.clipIntersection,m=h.clipShadows,g=e.get(h);if(!n||p===null||p.length===0||s&&!m)s?u(null):c();else{let y=s?0:r,x=y*4,_=g.clippingState||null;l.value=_,_=u(p,d,x,f);for(let M=0;M!==x;++M)_[M]=i[M];g.clippingState=_,this.numIntersection=v?this.numPlanes:0,this.numPlanes+=y}};function c(){l.value!==i&&(l.value=i,l.needsUpdate=r>0),t.numPlanes=r,t.numIntersection=0}function u(h,d,f,p){let v=h!==null?h.length:0,m=null;if(v!==0){if(m=l.value,p!==!0||m===null){let g=f+v*4,y=d.matrixWorldInverse;o.getNormalMatrix(y),(m===null||m.length<g)&&(m=new Float32Array(g));for(let x=0,_=f;x!==v;++x,_+=4)a.copy(h[x]).applyMatrix4(y,o),a.normal.toArray(m,_),m[_+3]=a.constant}l.value=m,l.needsUpdate=!0}return t.numPlanes=v,t.numIntersection=0,m}}function Vye(e){let t=new WeakMap;function i(a,o){return o===VO?a.mapping=_m:o===GO&&(a.mapping=Sm),a}function r(a){if(a&&a.isTexture&&a.isRenderTargetTexture===!1){let o=a.mapping;if(o===VO||o===GO)if(t.has(a)){let l=t.get(a).texture;return i(l,a.mapping)}else{let l=a.image;if(l&&l.height>0){let c=new eve(l.height/2);return c.fromEquirectangularTexture(e,a),t.set(a,c),a.addEventListener("dispose",n),i(c.texture,a.mapping)}else return null}}return a}function n(a){let o=a.target;o.removeEventListener("dispose",n);let l=t.get(o);l!==void 0&&(t.delete(o),l.dispose())}function s(){t=new WeakMap}return{get:r,dispose:s}}var EC=class extends Cf{constructor(e=-1,t=1,i=1,r=-1,n=.1,s=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=r,this.near=n,this.far=s,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,i,r,n,s){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=n,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,r=(this.top+this.bottom)/2,n=i-e,s=i+e,a=r+t,o=r-t;if(this.view!==null&&this.view.enabled){let l=(this.right-this.left)/this.view.fullWidth/this.zoom,c=(this.top-this.bottom)/this.view.fullHeight/this.zoom;n+=l*this.view.offsetX,s=n+l*this.view.width,a-=c*this.view.offsetY,o=a-c*this.view.height}this.projectionMatrix.makeOrthographic(n,s,a,o,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){let t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}},jv=4,SH=[.125,.215,.35,.446,.526,.582],Lp=20,GD=new EC,MH=new Yt,HD=null,Mp=(1+Math.sqrt(5))/2,Pg=1/Mp,EH=[new N(1,1,1),new N(-1,1,1),new N(1,1,-1),new N(-1,1,-1),new N(0,Mp,Pg),new N(0,Mp,-Pg),new N(Pg,0,Mp),new N(-Pg,0,Mp),new N(Mp,Pg,0),new N(-Mp,Pg,0)],AH=class{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,i=.1,r=100){HD=this._renderer.getRenderTarget(),this._setSize(256);let n=this._allocateTargets();return n.depthBuffer=!0,this._sceneToCubeUV(e,i,r,n),t>0&&this._blur(n,0,0,t),this._applyPMREM(n),this._cleanup(n),n}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=PH(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=CH(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(HD),e.scissorTest=!1,RS(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===_m||e.mapping===Sm?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),HD=this._renderer.getRenderTarget();let i=t||this._allocateTargets();return this._textureToCubeUV(e,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){let e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,i={magFilter:bi,minFilter:bi,generateMipmaps:!1,type:Th,format:Lr,encoding:sc,depthBuffer:!1},r=TH(e,t,i);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=TH(e,t,i);let{_lodMax:n}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=Gye(n)),this._blurMaterial=Hye(n,e,t)}return r}_compileMaterial(e){let t=new yr(this._lodPlanes[0],e);this._renderer.compile(t,GD)}_sceneToCubeUV(e,t,i,r){let n=new ta(90,1,t,i),s=[1,-1,1,1,1,1],a=[1,1,1,-1,-1,-1],o=this._renderer,l=o.autoClear,c=o.toneMapping;o.getClearColor(MH),o.toneMapping=Jc,o.autoClear=!1;let u=new Ch({name:"PMREM.Background",side:ms,depthWrite:!1,depthTest:!1}),h=new yr(new ac,u),d=!1,f=e.background;f?f.isColor&&(u.color.copy(f),e.background=null,d=!0):(u.color.copy(MH),d=!0);for(let p=0;p<6;p++){let v=p%3;v===0?(n.up.set(0,s[p],0),n.lookAt(a[p],0,0)):v===1?(n.up.set(0,0,s[p]),n.lookAt(0,a[p],0)):(n.up.set(0,s[p],0),n.lookAt(0,0,a[p]));let m=this._cubeSize;RS(r,v*m,p>2?m:0,m,m),o.setRenderTarget(r),d&&o.render(h,n),o.render(e,n)}h.geometry.dispose(),h.material.dispose(),o.toneMapping=c,o.autoClear=l,e.background=f}_textureToCubeUV(e,t){let i=this._renderer,r=e.mapping===_m||e.mapping===Sm;r?(this._cubemapMaterial===null&&(this._cubemapMaterial=PH()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=CH());let n=r?this._cubemapMaterial:this._equirectMaterial,s=new yr(this._lodPlanes[0],n),a=n.uniforms;a.envMap.value=e;let o=this._cubeSize;RS(t,0,0,3*o,2*o),i.setRenderTarget(t),i.render(s,GD)}_applyPMREM(e){let t=this._renderer,i=t.autoClear;t.autoClear=!1;for(let r=1;r<this._lodPlanes.length;r++){let n=Math.sqrt(this._sigmas[r]*this._sigmas[r]-this._sigmas[r-1]*this._sigmas[r-1]),s=EH[(r-1)%EH.length];this._blur(e,r-1,r,n,s)}t.autoClear=i}_blur(e,t,i,r,n){let s=this._pingPongRenderTarget;this._halfBlur(e,s,t,i,r,"latitudinal",n),this._halfBlur(s,e,i,i,r,"longitudinal",n)}_halfBlur(e,t,i,r,n,s,a){let o=this._renderer,l=this._blurMaterial;s!=="latitudinal"&&s!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");let c=3,u=new yr(this._lodPlanes[r],l),h=l.uniforms,d=this._sizeLods[i]-1,f=isFinite(n)?Math.PI/(2*d):2*Math.PI/(2*Lp-1),p=n/f,v=isFinite(n)?1+Math.floor(c*p):Lp;v>Lp&&console.warn(`sigmaRadians, ${n}, is too large and will clip, as it requested ${v} samples when the maximum is set to ${Lp}`);let m=[],g=0;for(let S=0;S<Lp;++S){let T=S/p,E=Math.exp(-T*T/2);m.push(E),S===0?g+=E:S<v&&(g+=2*E)}for(let S=0;S<m.length;S++)m[S]=m[S]/g;h.envMap.value=e.texture,h.samples.value=v,h.weights.value=m,h.latitudinal.value=s==="latitudinal",a&&(h.poleAxis.value=a);let{_lodMax:y}=this;h.dTheta.value=f,h.mipInt.value=y-i;let x=this._sizeLods[r],_=3*x*(r>y-jv?r-y+jv:0),M=4*(this._cubeSize-x);RS(t,_,M,3*x,2*x),o.setRenderTarget(t),o.render(u,GD)}};function Gye(e){let t=[],i=[],r=[],n=e,s=e-jv+1+SH.length;for(let a=0;a<s;a++){let o=Math.pow(2,n);i.push(o);let l=1/o;a>e-jv?l=SH[a-e+jv-1]:a===0&&(l=0),r.push(l);let c=1/(o-2),u=-c,h=1+c,d=[u,u,h,u,h,h,u,u,h,h,u,h],f=6,p=6,v=3,m=2,g=1,y=new Float32Array(v*p*f),x=new Float32Array(m*p*f),_=new Float32Array(g*p*f);for(let S=0;S<f;S++){let T=S%3*2/3-1,E=S>2?0:-1,C=[T,E,0,T+2/3,E,0,T+2/3,E+1,0,T,E,0,T+2/3,E+1,0,T,E+1,0];y.set(C,v*p*S),x.set(d,m*p*S);let A=[S,S,S,S,S,S];_.set(A,g*p*S)}let M=new Nt;M.setAttribute("position",new Qt(y,v)),M.setAttribute("uv",new Qt(x,m)),M.setAttribute("faceIndex",new Qt(_,g)),t.push(M),n>jv&&n--}return{lodPlanes:t,sizeLods:i,sigmas:r}}function TH(e,t,i){let r=new Ni(e,t,i);return r.texture.mapping=Tb,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function RS(e,t,i,r,n){e.viewport.set(t,i,r,n),e.scissor.set(t,i,r,n)}function Hye(e,t,i){let r=new Float32Array(Lp),n=new N(0,1,0);return new ki({name:"SphericalGaussianBlur",defines:{n:Lp,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/i,CUBEUV_MAX_MIP:`${e}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:n}},vertexShader:tN(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Ln,depthTest:!1,depthWrite:!1})}function CH(){return new ki({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:tN(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Ln,depthTest:!1,depthWrite:!1})}function PH(){return new ki({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:tN(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Ln,depthTest:!1,depthWrite:!1})}function tN(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function jye(e){let t=new WeakMap,i=null;function r(o){if(o&&o.isTexture){let l=o.mapping,c=l===VO||l===GO,u=l===_m||l===Sm;if(c||u)if(o.isRenderTargetTexture&&o.needsPMREMUpdate===!0){o.needsPMREMUpdate=!1;let h=t.get(o);return i===null&&(i=new AH(e)),h=c?i.fromEquirectangular(o,h):i.fromCubemap(o,h),t.set(o,h),h.texture}else{if(t.has(o))return t.get(o).texture;{let h=o.image;if(c&&h&&h.height>0||u&&h&&n(h)){i===null&&(i=new AH(e));let d=c?i.fromEquirectangular(o):i.fromCubemap(o);return t.set(o,d),o.addEventListener("dispose",s),d.texture}else return null}}}return o}function n(o){let l=0,c=6;for(let u=0;u<c;u++)o[u]!==void 0&&l++;return l===c}function s(o){let l=o.target;l.removeEventListener("dispose",s);let c=t.get(l);c!==void 0&&(t.delete(l),c.dispose())}function a(){t=new WeakMap,i!==null&&(i.dispose(),i=null)}return{get:r,dispose:a}}function Wye(e){let t={};function i(r){if(t[r]!==void 0)return t[r];let n;switch(r){case"WEBGL_depth_texture":n=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=e.getExtension(r)}return t[r]=n,n}return{has:function(r){return i(r)!==null},init:function(r){r.isWebGL2?i("EXT_color_buffer_float"):(i("WEBGL_depth_texture"),i("OES_texture_float"),i("OES_texture_half_float"),i("OES_texture_half_float_linear"),i("OES_standard_derivatives"),i("OES_element_index_uint"),i("OES_vertex_array_object"),i("ANGLE_instanced_arrays")),i("OES_texture_float_linear"),i("EXT_color_buffer_half_float"),i("WEBGL_multisampled_render_to_texture")},get:function(r){let n=i(r);return n===null&&console.warn("THREE.WebGLRenderer: "+r+" extension not supported."),n}}}function Xye(e,t,i,r){let n={},s=new WeakMap;function a(h){let d=h.target;d.index!==null&&t.remove(d.index);for(let p in d.attributes)t.remove(d.attributes[p]);d.removeEventListener("dispose",a),delete n[d.id];let f=s.get(d);f&&(t.remove(f),s.delete(d)),r.releaseStatesOfGeometry(d),d.isInstancedBufferGeometry===!0&&delete d._maxInstanceCount,i.memory.geometries--}function o(h,d){return n[d.id]===!0||(d.addEventListener("dispose",a),n[d.id]=!0,i.memory.geometries++),d}function l(h){let d=h.attributes;for(let p in d)t.update(d[p],34962);let f=h.morphAttributes;for(let p in f){let v=f[p];for(let m=0,g=v.length;m<g;m++)t.update(v[m],34962)}}function c(h){let d=[],f=h.index,p=h.attributes.position,v=0;if(f!==null){let y=f.array;v=f.version;for(let x=0,_=y.length;x<_;x+=3){let M=y[x+0],S=y[x+1],T=y[x+2];d.push(M,S,S,T,T,M)}}else{let y=p.array;v=p.version;for(let x=0,_=y.length/3-1;x<_;x+=3){let M=x+0,S=x+1,T=x+2;d.push(M,S,S,T,T,M)}}let m=new(LJ(d)?o0:NJ)(d,1);m.version=v;let g=s.get(h);g&&t.remove(g),s.set(h,m)}function u(h){let d=s.get(h);if(d){let f=h.index;f!==null&&d.version<f.version&&c(h)}else c(h);return s.get(h)}return{get:o,update:l,getWireframeAttribute:u}}function qye(e,t,i,r){let n=r.isWebGL2,s;function a(d){s=d}let o,l;function c(d){o=d.type,l=d.bytesPerElement}function u(d,f){e.drawElements(s,f,o,d*l),i.update(f,s,1)}function h(d,f,p){if(p===0)return;let v,m;if(n)v=e,m="drawElementsInstanced";else if(v=t.get("ANGLE_instanced_arrays"),m="drawElementsInstancedANGLE",v===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}v[m](s,f,o,d*l,p),i.update(f,s,p)}this.setMode=a,this.setIndex=c,this.render=u,this.renderInstances=h}function Yye(e){let t={geometries:0,textures:0},i={frame:0,calls:0,triangles:0,points:0,lines:0};function r(s,a,o){switch(i.calls++,a){case 4:i.triangles+=o*(s/3);break;case 1:i.lines+=o*(s/2);break;case 3:i.lines+=o*(s-1);break;case 2:i.lines+=o*s;break;case 0:i.points+=o*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",a);break}}function n(){i.frame++,i.calls=0,i.triangles=0,i.points=0,i.lines=0}return{memory:t,render:i,programs:null,autoReset:!0,reset:n,update:r}}function Qye(e,t){return e[0]-t[0]}function Zye(e,t){return Math.abs(t[1])-Math.abs(e[1])}function Kye(e,t,i){let r={},n=new Float32Array(8),s=new WeakMap,a=new ai,o=[];for(let c=0;c<8;c++)o[c]=[c,0];function l(c,u,h,d){let f=c.morphTargetInfluences;if(t.isWebGL2===!0){let p=u.morphAttributes.position||u.morphAttributes.normal||u.morphAttributes.color,v=p!==void 0?p.length:0,m=s.get(u);if(m===void 0||m.count!==v){let x=function(){O.dispose(),s.delete(u),u.removeEventListener("dispose",x)};m!==void 0&&m.texture.dispose();let _=u.morphAttributes.position!==void 0,M=u.morphAttributes.normal!==void 0,S=u.morphAttributes.color!==void 0,T=u.morphAttributes.position||[],E=u.morphAttributes.normal||[],C=u.morphAttributes.color||[],A=0;_===!0&&(A=1),M===!0&&(A=2),S===!0&&(A=3);let D=u.attributes.position.count*A,R=1;D>t.maxTextureSize&&(R=Math.ceil(D/t.maxTextureSize),D=t.maxTextureSize);let L=new Float32Array(D*R*4*v),O=new FJ(L,D,R,v);O.type=or,O.needsUpdate=!0;let H=A*4;for(let j=0;j<v;j++){let Y=T[j],z=E[j],V=C[j],U=D*R*4*j;for(let k=0;k<Y.count;k++){let X=k*H;_===!0&&(a.fromBufferAttribute(Y,k),L[U+X+0]=a.x,L[U+X+1]=a.y,L[U+X+2]=a.z,L[U+X+3]=0),M===!0&&(a.fromBufferAttribute(z,k),L[U+X+4]=a.x,L[U+X+5]=a.y,L[U+X+6]=a.z,L[U+X+7]=0),S===!0&&(a.fromBufferAttribute(V,k),L[U+X+8]=a.x,L[U+X+9]=a.y,L[U+X+10]=a.z,L[U+X+11]=V.itemSize===4?a.w:1)}}m={count:v,texture:O,size:new Me(D,R)},s.set(u,m),u.addEventListener("dispose",x)}let g=0;for(let x=0;x<f.length;x++)g+=f[x];let y=u.morphTargetsRelative?1:1-g;d.getUniforms().setValue(e,"morphTargetBaseInfluence",y),d.getUniforms().setValue(e,"morphTargetInfluences",f),d.getUniforms().setValue(e,"morphTargetsTexture",m.texture,i),d.getUniforms().setValue(e,"morphTargetsTextureSize",m.size)}else{let p=f===void 0?0:f.length,v=r[u.id];if(v===void 0||v.length!==p){v=[];for(let _=0;_<p;_++)v[_]=[_,0];r[u.id]=v}for(let _=0;_<p;_++){let M=v[_];M[0]=_,M[1]=f[_]}v.sort(Zye);for(let _=0;_<8;_++)_<p&&v[_][1]?(o[_][0]=v[_][0],o[_][1]=v[_][1]):(o[_][0]=Number.MAX_SAFE_INTEGER,o[_][1]=0);o.sort(Qye);let m=u.morphAttributes.position,g=u.morphAttributes.normal,y=0;for(let _=0;_<8;_++){let M=o[_],S=M[0],T=M[1];S!==Number.MAX_SAFE_INTEGER&&T?(m&&u.getAttribute("morphTarget"+_)!==m[S]&&u.setAttribute("morphTarget"+_,m[S]),g&&u.getAttribute("morphNormal"+_)!==g[S]&&u.setAttribute("morphNormal"+_,g[S]),n[_]=T,y+=T):(m&&u.hasAttribute("morphTarget"+_)===!0&&u.deleteAttribute("morphTarget"+_),g&&u.hasAttribute("morphNormal"+_)===!0&&u.deleteAttribute("morphNormal"+_),n[_]=0)}let x=u.morphTargetsRelative?1:1-y;d.getUniforms().setValue(e,"morphTargetBaseInfluence",x),d.getUniforms().setValue(e,"morphTargetInfluences",n)}}return{update:l}}function Jye(e,t,i,r){let n=new WeakMap;function s(l){let c=r.render.frame,u=l.geometry,h=t.get(l,u);return n.get(h)!==c&&(t.update(h),n.set(h,c)),l.isInstancedMesh&&(l.hasEventListener("dispose",o)===!1&&l.addEventListener("dispose",o),i.update(l.instanceMatrix,34962),l.instanceColor!==null&&i.update(l.instanceColor,34962)),h}function a(){n=new WeakMap}function o(l){let c=l.target;c.removeEventListener("dispose",o),i.remove(c.instanceMatrix),c.instanceColor!==null&&i.remove(c.instanceColor)}return{update:s,dispose:a}}var GJ=new jr,HJ=new FJ,jJ=new Nge,WJ=new $U,DH=[],RH=[],IH=new Float32Array(16),LH=new Float32Array(9),OH=new Float32Array(4);function oy(e,t,i){let r=e[0];if(r==null||r<=0||r>0)return e;let n=t*i,s=DH[n];if(s===void 0&&(s=new Float32Array(n),DH[n]=s),t!==0){r.toArray(s,0);for(let a=1,o=0;a!==t;++a)o+=i,e[a].toArray(s,o)}return s}function Qn(e,t){if(e.length!==t.length)return!1;for(let i=0,r=e.length;i<r;i++)if(e[i]!==t[i])return!1;return!0}function Zn(e,t){for(let i=0,r=t.length;i<r;i++)e[i]=t[i]}function AC(e,t){let i=RH[t];i===void 0&&(i=new Int32Array(t),RH[t]=i);for(let r=0;r!==t;++r)i[r]=e.allocateTextureUnit();return i}function $ye(e,t){let i=this.cache;i[0]!==t&&(e.uniform1f(this.addr,t),i[0]=t)}function e1e(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y)&&(e.uniform2f(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(Qn(i,t))return;e.uniform2fv(this.addr,t),Zn(i,t)}}function t1e(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z)&&(e.uniform3f(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else if(t.r!==void 0)(i[0]!==t.r||i[1]!==t.g||i[2]!==t.b)&&(e.uniform3f(this.addr,t.r,t.g,t.b),i[0]=t.r,i[1]=t.g,i[2]=t.b);else{if(Qn(i,t))return;e.uniform3fv(this.addr,t),Zn(i,t)}}function i1e(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z||i[3]!==t.w)&&(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(Qn(i,t))return;e.uniform4fv(this.addr,t),Zn(i,t)}}function r1e(e,t){let i=this.cache,r=t.elements;if(r===void 0){if(Qn(i,t))return;e.uniformMatrix2fv(this.addr,!1,t),Zn(i,t)}else{if(Qn(i,r))return;OH.set(r),e.uniformMatrix2fv(this.addr,!1,OH),Zn(i,r)}}function n1e(e,t){let i=this.cache,r=t.elements;if(r===void 0){if(Qn(i,t))return;e.uniformMatrix3fv(this.addr,!1,t),Zn(i,t)}else{if(Qn(i,r))return;LH.set(r),e.uniformMatrix3fv(this.addr,!1,LH),Zn(i,r)}}function s1e(e,t){let i=this.cache,r=t.elements;if(r===void 0){if(Qn(i,t))return;e.uniformMatrix4fv(this.addr,!1,t),Zn(i,t)}else{if(Qn(i,r))return;IH.set(r),e.uniformMatrix4fv(this.addr,!1,IH),Zn(i,r)}}function a1e(e,t){let i=this.cache;i[0]!==t&&(e.uniform1i(this.addr,t),i[0]=t)}function o1e(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y)&&(e.uniform2i(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(Qn(i,t))return;e.uniform2iv(this.addr,t),Zn(i,t)}}function l1e(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z)&&(e.uniform3i(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else{if(Qn(i,t))return;e.uniform3iv(this.addr,t),Zn(i,t)}}function c1e(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z||i[3]!==t.w)&&(e.uniform4i(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(Qn(i,t))return;e.uniform4iv(this.addr,t),Zn(i,t)}}function u1e(e,t){let i=this.cache;i[0]!==t&&(e.uniform1ui(this.addr,t),i[0]=t)}function h1e(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y)&&(e.uniform2ui(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(Qn(i,t))return;e.uniform2uiv(this.addr,t),Zn(i,t)}}function d1e(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z)&&(e.uniform3ui(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else{if(Qn(i,t))return;e.uniform3uiv(this.addr,t),Zn(i,t)}}function f1e(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z||i[3]!==t.w)&&(e.uniform4ui(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(Qn(i,t))return;e.uniform4uiv(this.addr,t),Zn(i,t)}}function p1e(e,t,i){let r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.setTexture2D(t||GJ,n)}function m1e(e,t,i){let r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.setTexture3D(t||jJ,n)}function g1e(e,t,i){let r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.setTextureCube(t||WJ,n)}function v1e(e,t,i){let r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.setTexture2DArray(t||HJ,n)}function y1e(e){switch(e){case 5126:return $ye;case 35664:return e1e;case 35665:return t1e;case 35666:return i1e;case 35674:return r1e;case 35675:return n1e;case 35676:return s1e;case 5124:case 35670:return a1e;case 35667:case 35671:return o1e;case 35668:case 35672:return l1e;case 35669:case 35673:return c1e;case 5125:return u1e;case 36294:return h1e;case 36295:return d1e;case 36296:return f1e;case 35678:case 36198:case 36298:case 36306:case 35682:return p1e;case 35679:case 36299:case 36307:return m1e;case 35680:case 36300:case 36308:case 36293:return g1e;case 36289:case 36303:case 36311:case 36292:return v1e}}function x1e(e,t){e.uniform1fv(this.addr,t)}function w1e(e,t){let i=oy(t,this.size,2);e.uniform2fv(this.addr,i)}function b1e(e,t){let i=oy(t,this.size,3);e.uniform3fv(this.addr,i)}function _1e(e,t){let i=oy(t,this.size,4);e.uniform4fv(this.addr,i)}function S1e(e,t){let i=oy(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,i)}function M1e(e,t){let i=oy(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,i)}function E1e(e,t){let i=oy(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,i)}function A1e(e,t){e.uniform1iv(this.addr,t)}function T1e(e,t){e.uniform2iv(this.addr,t)}function C1e(e,t){e.uniform3iv(this.addr,t)}function P1e(e,t){e.uniform4iv(this.addr,t)}function D1e(e,t){e.uniform1uiv(this.addr,t)}function R1e(e,t){e.uniform2uiv(this.addr,t)}function I1e(e,t){e.uniform3uiv(this.addr,t)}function L1e(e,t){e.uniform4uiv(this.addr,t)}function O1e(e,t,i){let r=this.cache,n=t.length,s=AC(i,n);Qn(r,s)||(e.uniform1iv(this.addr,s),Zn(r,s));for(let a=0;a!==n;++a)i.setTexture2D(t[a]||GJ,s[a])}function z1e(e,t,i){let r=this.cache,n=t.length,s=AC(i,n);Qn(r,s)||(e.uniform1iv(this.addr,s),Zn(r,s));for(let a=0;a!==n;++a)i.setTexture3D(t[a]||jJ,s[a])}function B1e(e,t,i){let r=this.cache,n=t.length,s=AC(i,n);Qn(r,s)||(e.uniform1iv(this.addr,s),Zn(r,s));for(let a=0;a!==n;++a)i.setTextureCube(t[a]||WJ,s[a])}function F1e(e,t,i){let r=this.cache,n=t.length,s=AC(i,n);Qn(r,s)||(e.uniform1iv(this.addr,s),Zn(r,s));for(let a=0;a!==n;++a)i.setTexture2DArray(t[a]||HJ,s[a])}function U1e(e){switch(e){case 5126:return x1e;case 35664:return w1e;case 35665:return b1e;case 35666:return _1e;case 35674:return S1e;case 35675:return M1e;case 35676:return E1e;case 5124:case 35670:return A1e;case 35667:case 35671:return T1e;case 35668:case 35672:return C1e;case 35669:case 35673:return P1e;case 5125:return D1e;case 36294:return R1e;case 36295:return I1e;case 36296:return L1e;case 35678:case 36198:case 36298:case 36306:case 35682:return O1e;case 35679:case 36299:case 36307:return z1e;case 35680:case 36300:case 36308:case 36293:return B1e;case 36289:case 36303:case 36311:case 36292:return F1e}}var N1e=class{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.setValue=y1e(t.type)}},k1e=class{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.size=t.size,this.setValue=U1e(t.type)}},V1e=class{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,i){if(t===void 0)return;let r=this.seq;for(let n=0,s=r.length;n!==s;++n){let a=r[n];a.setValue(e,t[a.id],i)}}},jD=/(\w+)(\])?(\[|\.)?/g;function zH(e,t){e.seq.push(t),e.map[t.id]=t}function G1e(e,t,i){let r=e.name,n=r.length;for(jD.lastIndex=0;;){let s=jD.exec(r),a=jD.lastIndex,o=s[1],l=s[2]==="]",c=s[3];if(l&&(o=o|0),c===void 0||c==="["&&a+2===n){zH(i,c===void 0?new N1e(o,e,t):new k1e(o,e,t));break}else{let u=i.map[o];u===void 0&&(u=new V1e(o),zH(i,u)),i=u}}}var $E=class{constructor(e,t){this.seq=[],this.map={};let i=e.getProgramParameter(t,35718);for(let r=0;r<i;++r){let n=e.getActiveUniform(t,r),s=e.getUniformLocation(t,n.name);G1e(n,s,this)}}setValue(e,t,i,r){let n=this.map[t];n!==void 0&&n.setValue(e,i,r)}setOptional(e,t,i){let r=t[i];r!==void 0&&this.setValue(e,i,r)}static upload(e,t,i,r){for(let n=0,s=t.length;n!==s;++n){let a=t[n],o=i[a.id];o.needsUpdate!==!1&&a.setValue(e,o.value,r)}}static seqWithValue(e,t){let i=[];for(let r=0,n=e.length;r!==n;++r){let s=e[r];s.id in t&&i.push(s)}return i}};function BH(e,t,i){let r=e.createShader(t);return e.shaderSource(r,i),e.compileShader(r),r}var H1e=0;function j1e(e,t){let i=e.split(`
`),r=[],n=Math.max(t-6,0),s=Math.min(t+6,i.length);for(let a=n;a<s;a++){let o=a+1;r.push(`${o===t?">":" "} ${o}: ${i[a]}`)}return r.join(`
`)}function W1e(e){switch(e){case sc:return["Linear","( value )"];case vi:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",e),["Linear","( value )"]}}function FH(e,t,i){let r=e.getShaderParameter(t,35713),n=e.getShaderInfoLog(t).trim();if(r&&n==="")return"";let s=/ERROR: 0:(\d+)/.exec(n);if(s){let a=parseInt(s[1]);return i.toUpperCase()+`

`+n+`

`+j1e(e.getShaderSource(t),a)}else return n}function X1e(e,t){let i=W1e(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+i[0]+i[1]+"; }"}function q1e(e,t){let i;switch(t){case ege:i="Linear";break;case tge:i="Reinhard";break;case ige:i="OptimizedCineon";break;case rge:i="ACESFilmic";break;case nge:i="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),i="Linear"}return"vec3 "+e+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function Y1e(e){return[e.extensionDerivatives||e.envMapCubeUVHeight||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||e.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap||e.transmission)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(sx).join(`
`)}function Q1e(e){let t=[];for(let i in e){let r=e[i];r!==!1&&t.push("#define "+i+" "+r)}return t.join(`
`)}function Z1e(e,t){let i={},r=e.getProgramParameter(t,35721);for(let n=0;n<r;n++){let s=e.getActiveAttrib(t,n),a=s.name,o=1;s.type===35674&&(o=2),s.type===35675&&(o=3),s.type===35676&&(o=4),i[a]={type:s.type,location:e.getAttribLocation(t,a),locationSize:o}}return i}function sx(e){return e!==""}function UH(e,t){let i=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,i).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function NH(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}var K1e=/^[ \t]*#include +<([\w\d./]+)>/gm;function YO(e){return e.replace(K1e,J1e)}function J1e(e,t){let i=yi[t];if(i===void 0)throw new Error("Can not resolve #include <"+t+">");return YO(i)}var $1e=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function kH(e){return e.replace($1e,exe)}function exe(e,t,i,r){let n="";for(let s=parseInt(t);s<parseInt(i);s++)n+=r.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return n}function VH(e){let t="precision "+e.precision+` float;
precision `+e.precision+" int;";return e.precision==="highp"?t+=`
#define HIGH_PRECISION`:e.precision==="mediump"?t+=`
#define MEDIUM_PRECISION`:e.precision==="lowp"&&(t+=`
#define LOW_PRECISION`),t}function txe(e){let t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===YU?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===Ime?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===nx&&(t="SHADOWMAP_TYPE_VSM"),t}function ixe(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case _m:case Sm:t="ENVMAP_TYPE_CUBE";break;case Tb:t="ENVMAP_TYPE_CUBE_UV";break}return t}function rxe(e){let t="ENVMAP_MODE_REFLECTION";if(e.envMap)switch(e.envMapMode){case Sm:t="ENVMAP_MODE_REFRACTION";break}return t}function nxe(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case EJ:t="ENVMAP_BLENDING_MULTIPLY";break;case Jme:t="ENVMAP_BLENDING_MIX";break;case $me:t="ENVMAP_BLENDING_ADD";break}return t}function sxe(e){let t=e.envMapCubeUVHeight;if(t===null)return null;let i=Math.log2(t)-2,r=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,i),7*16)),texelHeight:r,maxMip:i}}function axe(e,t,i,r){let n=e.getContext(),s=i.defines,a=i.vertexShader,o=i.fragmentShader,l=txe(i),c=ixe(i),u=rxe(i),h=nxe(i),d=sxe(i),f=i.isWebGL2?"":Y1e(i),p=Q1e(s),v=n.createProgram(),m,g,y=i.glslVersion?"#version "+i.glslVersion+`
`:"";i.isRawShaderMaterial?(m=[p].filter(sx).join(`
`),m.length>0&&(m+=`
`),g=[f,p].filter(sx).join(`
`),g.length>0&&(g+=`
`)):(m=[VH(i),"#define SHADER_NAME "+i.shaderName,p,i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.supportsVertexTextures?"#define VERTEX_TEXTURES":"",i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+u:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.displacementMap&&i.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularColorMap?"#define USE_SPECULARCOLORMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.sheenColorMap?"#define USE_SHEENCOLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&i.flatShading===!1?"#define USE_MORPHNORMALS":"",i.morphColors&&i.isWebGL2?"#define USE_MORPHCOLORS":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+i.morphTextureStride:"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_COUNT "+i.morphTargetsCount:"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(sx).join(`
`),g=[f,VH(i),"#define SHADER_NAME "+i.shaderName,p,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+c:"",i.envMap?"#define "+u:"",i.envMap?"#define "+h:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoat?"#define USE_CLEARCOAT":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescence?"#define USE_IRIDESCENCE":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularColorMap?"#define USE_SPECULARCOLORMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaTest?"#define USE_ALPHATEST":"",i.sheen?"#define USE_SHEEN":"",i.sheenColorMap?"#define USE_SHEENCOLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",i.toneMapping!==Jc?"#define TONE_MAPPING":"",i.toneMapping!==Jc?yi.tonemapping_pars_fragment:"",i.toneMapping!==Jc?q1e("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",i.opaque?"#define OPAQUE":"",yi.encodings_pars_fragment,X1e("linearToOutputTexel",i.outputEncoding),i.useDepthPacking?"#define DEPTH_PACKING "+i.depthPacking:"",`
`].filter(sx).join(`
`)),a=YO(a),a=UH(a,i),a=NH(a,i),o=YO(o),o=UH(o,i),o=NH(o,i),a=kH(a),o=kH(o),i.isWebGL2&&i.isRawShaderMaterial!==!0&&(y=`#version 300 es
`,m=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+m,g=["#define varying in",i.glslVersion===WO?"":"layout(location = 0) out highp vec4 pc_fragColor;",i.glslVersion===WO?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+g);let x=y+m+a,_=y+g+o,M=BH(n,35633,x),S=BH(n,35632,_);if(n.attachShader(v,M),n.attachShader(v,S),i.index0AttributeName!==void 0?n.bindAttribLocation(v,0,i.index0AttributeName):i.morphTargets===!0&&n.bindAttribLocation(v,0,"position"),n.linkProgram(v),e.debug.checkShaderErrors){let C=n.getProgramInfoLog(v).trim(),A=n.getShaderInfoLog(M).trim(),D=n.getShaderInfoLog(S).trim(),R=!0,L=!0;if(n.getProgramParameter(v,35714)===!1){R=!1;let O=FH(n,M,"vertex"),H=FH(n,S,"fragment");console.error("THREE.WebGLProgram: Shader Error "+n.getError()+" - VALIDATE_STATUS "+n.getProgramParameter(v,35715)+`

Program Info Log: `+C+`
`+O+`
`+H)}else C!==""?console.warn("THREE.WebGLProgram: Program Info Log:",C):(A===""||D==="")&&(L=!1);L&&(this.diagnostics={runnable:R,programLog:C,vertexShader:{log:A,prefix:m},fragmentShader:{log:D,prefix:g}})}n.deleteShader(M),n.deleteShader(S);let T;this.getUniforms=function(){return T===void 0&&(T=new $E(n,v)),T};let E;return this.getAttributes=function(){return E===void 0&&(E=Z1e(n,v)),E},this.destroy=function(){r.releaseStatesOfProgram(this),n.deleteProgram(v),this.program=void 0},this.name=i.shaderName,this.id=H1e++,this.cacheKey=t,this.usedTimes=1,this.program=v,this.vertexShader=M,this.fragmentShader=S,this}var oxe=0,lxe=class{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){let t=e.vertexShader,i=e.fragmentShader,r=this._getShaderStage(t),n=this._getShaderStage(i),s=this._getShaderCacheForMaterial(e);return s.has(r)===!1&&(s.add(r),r.usedTimes++),s.has(n)===!1&&(s.add(n),n.usedTimes++),this}remove(e){let t=this.materialCache.get(e);for(let i of t)i.usedTimes--,i.usedTimes===0&&this.shaderCache.delete(i.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){let t=this.materialCache,i=t.get(e);return i===void 0&&(i=new Set,t.set(e,i)),i}_getShaderStage(e){let t=this.shaderCache,i=t.get(e);return i===void 0&&(i=new cxe(e),t.set(e,i)),i}},cxe=class{constructor(e){this.id=oxe++,this.code=e,this.usedTimes=0}};function uxe(e,t,i,r,n,s,a){let o=new JU,l=new lxe,c=[],u=n.isWebGL2,h=n.logarithmicDepthBuffer,d=n.vertexTextures,f=n.precision,p={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function v(E,C,A,D,R){let L=D.fog,O=R.geometry,H=E.isMeshStandardMaterial?D.environment:null,j=(E.isMeshStandardMaterial?i:t).get(E.envMap||H),Y=j&&j.mapping===Tb?j.image.height:null,z=p[E.type];E.precision!==null&&(f=n.getMaxPrecision(E.precision),f!==E.precision&&console.warn("THREE.WebGLProgram.getParameters:",E.precision,"not supported, using",f,"instead."));let V=O.morphAttributes.position||O.morphAttributes.normal||O.morphAttributes.color,U=V!==void 0?V.length:0,k=0;O.morphAttributes.position!==void 0&&(k=1),O.morphAttributes.normal!==void 0&&(k=2),O.morphAttributes.color!==void 0&&(k=3);let X,re,q,ee;if(z){let ge=Fc[z];X=ge.vertexShader,re=ge.fragmentShader}else X=E.vertexShader,re=E.fragmentShader,l.update(E),q=l.getVertexShaderID(E),ee=l.getFragmentShaderID(E);let $=e.getRenderTarget(),ne=E.alphaTest>0,ce=E.clearcoat>0,pe=E.iridescence>0;return{isWebGL2:u,shaderID:z,shaderName:E.type,vertexShader:X,fragmentShader:re,defines:E.defines,customVertexShaderID:q,customFragmentShaderID:ee,isRawShaderMaterial:E.isRawShaderMaterial===!0,glslVersion:E.glslVersion,precision:f,instancing:R.isInstancedMesh===!0,instancingColor:R.isInstancedMesh===!0&&R.instanceColor!==null,supportsVertexTextures:d,outputEncoding:$===null?e.outputEncoding:$.isXRRenderTarget===!0?$.texture.encoding:sc,map:!!E.map,matcap:!!E.matcap,envMap:!!j,envMapMode:j&&j.mapping,envMapCubeUVHeight:Y,lightMap:!!E.lightMap,aoMap:!!E.aoMap,emissiveMap:!!E.emissiveMap,bumpMap:!!E.bumpMap,normalMap:!!E.normalMap,objectSpaceNormalMap:E.normalMapType===wge,tangentSpaceNormalMap:E.normalMapType===xge,decodeVideoTexture:!!E.map&&E.map.isVideoTexture===!0&&E.map.encoding===vi,clearcoat:ce,clearcoatMap:ce&&!!E.clearcoatMap,clearcoatRoughnessMap:ce&&!!E.clearcoatRoughnessMap,clearcoatNormalMap:ce&&!!E.clearcoatNormalMap,iridescence:pe,iridescenceMap:pe&&!!E.iridescenceMap,iridescenceThicknessMap:pe&&!!E.iridescenceThicknessMap,displacementMap:!!E.displacementMap,roughnessMap:!!E.roughnessMap,metalnessMap:!!E.metalnessMap,specularMap:!!E.specularMap,specularIntensityMap:!!E.specularIntensityMap,specularColorMap:!!E.specularColorMap,opaque:E.transparent===!1&&E.blending===nm,alphaMap:!!E.alphaMap,alphaTest:ne,gradientMap:!!E.gradientMap,sheen:E.sheen>0,sheenColorMap:!!E.sheenColorMap,sheenRoughnessMap:!!E.sheenRoughnessMap,transmission:E.transmission>0,transmissionMap:!!E.transmissionMap,thicknessMap:!!E.thicknessMap,combine:E.combine,vertexTangents:!!E.normalMap&&!!O.attributes.tangent,vertexColors:E.vertexColors,vertexAlphas:E.vertexColors===!0&&!!O.attributes.color&&O.attributes.color.itemSize===4,vertexUvs:!!E.map||!!E.bumpMap||!!E.normalMap||!!E.specularMap||!!E.alphaMap||!!E.emissiveMap||!!E.roughnessMap||!!E.metalnessMap||!!E.clearcoatMap||!!E.clearcoatRoughnessMap||!!E.clearcoatNormalMap||!!E.iridescenceMap||!!E.iridescenceThicknessMap||!!E.displacementMap||!!E.transmissionMap||!!E.thicknessMap||!!E.specularIntensityMap||!!E.specularColorMap||!!E.sheenColorMap||!!E.sheenRoughnessMap,uvsVertexOnly:!(E.map||E.bumpMap||E.normalMap||E.specularMap||E.alphaMap||E.emissiveMap||E.roughnessMap||E.metalnessMap||E.clearcoatNormalMap||E.iridescenceMap||E.iridescenceThicknessMap||E.transmission>0||E.transmissionMap||E.thicknessMap||E.specularIntensityMap||E.specularColorMap||E.sheen>0||E.sheenColorMap||E.sheenRoughnessMap)&&!!E.displacementMap,fog:!!L,useFog:E.fog===!0,fogExp2:L&&L.isFogExp2,flatShading:!!E.flatShading,sizeAttenuation:E.sizeAttenuation,logarithmicDepthBuffer:h,skinning:R.isSkinnedMesh===!0,morphTargets:O.morphAttributes.position!==void 0,morphNormals:O.morphAttributes.normal!==void 0,morphColors:O.morphAttributes.color!==void 0,morphTargetsCount:U,morphTextureStride:k,numDirLights:C.directional.length,numPointLights:C.point.length,numSpotLights:C.spot.length,numSpotLightMaps:C.spotLightMap.length,numRectAreaLights:C.rectArea.length,numHemiLights:C.hemi.length,numDirLightShadows:C.directionalShadowMap.length,numPointLightShadows:C.pointShadowMap.length,numSpotLightShadows:C.spotShadowMap.length,numSpotLightShadowsWithMaps:C.numSpotLightShadowsWithMaps,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:E.dithering,shadowMapEnabled:e.shadowMap.enabled&&A.length>0,shadowMapType:e.shadowMap.type,toneMapping:E.toneMapped?e.toneMapping:Jc,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:E.premultipliedAlpha,doubleSided:E.side===na,flipSided:E.side===ms,useDepthPacking:!!E.depthPacking,depthPacking:E.depthPacking||0,index0AttributeName:E.index0AttributeName,extensionDerivatives:E.extensions&&E.extensions.derivatives,extensionFragDepth:E.extensions&&E.extensions.fragDepth,extensionDrawBuffers:E.extensions&&E.extensions.drawBuffers,extensionShaderTextureLOD:E.extensions&&E.extensions.shaderTextureLOD,rendererExtensionFragDepth:u||r.has("EXT_frag_depth"),rendererExtensionDrawBuffers:u||r.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:u||r.has("EXT_shader_texture_lod"),customProgramCacheKey:E.customProgramCacheKey()}}function m(E){let C=[];if(E.shaderID?C.push(E.shaderID):(C.push(E.customVertexShaderID),C.push(E.customFragmentShaderID)),E.defines!==void 0)for(let A in E.defines)C.push(A),C.push(E.defines[A]);return E.isRawShaderMaterial===!1&&(g(C,E),y(C,E),C.push(e.outputEncoding)),C.push(E.customProgramCacheKey),C.join()}function g(E,C){E.push(C.precision),E.push(C.outputEncoding),E.push(C.envMapMode),E.push(C.envMapCubeUVHeight),E.push(C.combine),E.push(C.vertexUvs),E.push(C.fogExp2),E.push(C.sizeAttenuation),E.push(C.morphTargetsCount),E.push(C.morphAttributeCount),E.push(C.numDirLights),E.push(C.numPointLights),E.push(C.numSpotLights),E.push(C.numSpotLightMaps),E.push(C.numHemiLights),E.push(C.numRectAreaLights),E.push(C.numDirLightShadows),E.push(C.numPointLightShadows),E.push(C.numSpotLightShadows),E.push(C.numSpotLightShadowsWithMaps),E.push(C.shadowMapType),E.push(C.toneMapping),E.push(C.numClippingPlanes),E.push(C.numClipIntersection),E.push(C.depthPacking)}function y(E,C){o.disableAll(),C.isWebGL2&&o.enable(0),C.supportsVertexTextures&&o.enable(1),C.instancing&&o.enable(2),C.instancingColor&&o.enable(3),C.map&&o.enable(4),C.matcap&&o.enable(5),C.envMap&&o.enable(6),C.lightMap&&o.enable(7),C.aoMap&&o.enable(8),C.emissiveMap&&o.enable(9),C.bumpMap&&o.enable(10),C.normalMap&&o.enable(11),C.objectSpaceNormalMap&&o.enable(12),C.tangentSpaceNormalMap&&o.enable(13),C.clearcoat&&o.enable(14),C.clearcoatMap&&o.enable(15),C.clearcoatRoughnessMap&&o.enable(16),C.clearcoatNormalMap&&o.enable(17),C.iridescence&&o.enable(18),C.iridescenceMap&&o.enable(19),C.iridescenceThicknessMap&&o.enable(20),C.displacementMap&&o.enable(21),C.specularMap&&o.enable(22),C.roughnessMap&&o.enable(23),C.metalnessMap&&o.enable(24),C.gradientMap&&o.enable(25),C.alphaMap&&o.enable(26),C.alphaTest&&o.enable(27),C.vertexColors&&o.enable(28),C.vertexAlphas&&o.enable(29),C.vertexUvs&&o.enable(30),C.vertexTangents&&o.enable(31),C.uvsVertexOnly&&o.enable(32),E.push(o.mask),o.disableAll(),C.fog&&o.enable(0),C.useFog&&o.enable(1),C.flatShading&&o.enable(2),C.logarithmicDepthBuffer&&o.enable(3),C.skinning&&o.enable(4),C.morphTargets&&o.enable(5),C.morphNormals&&o.enable(6),C.morphColors&&o.enable(7),C.premultipliedAlpha&&o.enable(8),C.shadowMapEnabled&&o.enable(9),C.physicallyCorrectLights&&o.enable(10),C.doubleSided&&o.enable(11),C.flipSided&&o.enable(12),C.useDepthPacking&&o.enable(13),C.dithering&&o.enable(14),C.specularIntensityMap&&o.enable(15),C.specularColorMap&&o.enable(16),C.transmission&&o.enable(17),C.transmissionMap&&o.enable(18),C.thicknessMap&&o.enable(19),C.sheen&&o.enable(20),C.sheenColorMap&&o.enable(21),C.sheenRoughnessMap&&o.enable(22),C.decodeVideoTexture&&o.enable(23),C.opaque&&o.enable(24),E.push(o.mask)}function x(E){let C=p[E.type],A;if(C){let D=Fc[C];A=ay.clone(D.uniforms)}else A=E.uniforms;return A}function _(E,C){let A;for(let D=0,R=c.length;D<R;D++){let L=c[D];if(L.cacheKey===C){A=L,++A.usedTimes;break}}return A===void 0&&(A=new axe(e,C,E,s),c.push(A)),A}function M(E){if(--E.usedTimes===0){let C=c.indexOf(E);c[C]=c[c.length-1],c.pop(),E.destroy()}}function S(E){l.remove(E)}function T(){l.dispose()}return{getParameters:v,getProgramCacheKey:m,getUniforms:x,acquireProgram:_,releaseProgram:M,releaseShaderCache:S,programs:c,dispose:T}}function hxe(){let e=new WeakMap;function t(s){let a=e.get(s);return a===void 0&&(a={},e.set(s,a)),a}function i(s){e.delete(s)}function r(s,a,o){e.get(s)[a]=o}function n(){e=new WeakMap}return{get:t,remove:i,update:r,dispose:n}}function dxe(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function GH(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function HH(){let e=[],t=0,i=[],r=[],n=[];function s(){t=0,i.length=0,r.length=0,n.length=0}function a(h,d,f,p,v,m){let g=e[t];return g===void 0?(g={id:h.id,object:h,geometry:d,material:f,groupOrder:p,renderOrder:h.renderOrder,z:v,group:m},e[t]=g):(g.id=h.id,g.object=h,g.geometry=d,g.material=f,g.groupOrder=p,g.renderOrder=h.renderOrder,g.z=v,g.group=m),t++,g}function o(h,d,f,p,v,m){let g=a(h,d,f,p,v,m);f.transmission>0?r.push(g):f.transparent===!0?n.push(g):i.push(g)}function l(h,d,f,p,v,m){let g=a(h,d,f,p,v,m);f.transmission>0?r.unshift(g):f.transparent===!0?n.unshift(g):i.unshift(g)}function c(h,d){i.length>1&&i.sort(h||dxe),r.length>1&&r.sort(d||GH),n.length>1&&n.sort(d||GH)}function u(){for(let h=t,d=e.length;h<d;h++){let f=e[h];if(f.id===null)break;f.id=null,f.object=null,f.geometry=null,f.material=null,f.group=null}}return{opaque:i,transmissive:r,transparent:n,init:s,push:o,unshift:l,finish:u,sort:c}}function fxe(){let e=new WeakMap;function t(r,n){let s=e.get(r),a;return s===void 0?(a=new HH,e.set(r,[a])):n>=s.length?(a=new HH,s.push(a)):a=s[n],a}function i(){e=new WeakMap}return{get:t,dispose:i}}function pxe(){let e={};return{get:function(t){if(e[t.id]!==void 0)return e[t.id];let i;switch(t.type){case"DirectionalLight":i={direction:new N,color:new Yt};break;case"SpotLight":i={position:new N,direction:new N,color:new Yt,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new N,color:new Yt,distance:0,decay:0};break;case"HemisphereLight":i={direction:new N,skyColor:new Yt,groundColor:new Yt};break;case"RectAreaLight":i={color:new Yt,position:new N,halfWidth:new N,halfHeight:new N};break}return e[t.id]=i,i}}}function mxe(){let e={};return{get:function(t){if(e[t.id]!==void 0)return e[t.id];let i;switch(t.type){case"DirectionalLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Me};break;case"SpotLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Me};break;case"PointLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Me,shadowCameraNear:1,shadowCameraFar:1e3};break}return e[t.id]=i,i}}}var gxe=0;function vxe(e,t){return(t.castShadow?2:0)-(e.castShadow?2:0)+(t.map?1:0)-(e.map?1:0)}function yxe(e,t){let i=new pxe,r=mxe(),n={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let u=0;u<9;u++)n.probe.push(new N);let s=new N,a=new ft,o=new ft;function l(u,h){let d=0,f=0,p=0;for(let D=0;D<9;D++)n.probe[D].set(0,0,0);let v=0,m=0,g=0,y=0,x=0,_=0,M=0,S=0,T=0,E=0;u.sort(vxe);let C=h!==!0?Math.PI:1;for(let D=0,R=u.length;D<R;D++){let L=u[D],O=L.color,H=L.intensity,j=L.distance,Y=L.shadow&&L.shadow.map?L.shadow.map.texture:null;if(L.isAmbientLight)d+=O.r*H*C,f+=O.g*H*C,p+=O.b*H*C;else if(L.isLightProbe)for(let z=0;z<9;z++)n.probe[z].addScaledVector(L.sh.coefficients[z],H);else if(L.isDirectionalLight){let z=i.get(L);if(z.color.copy(L.color).multiplyScalar(L.intensity*C),L.castShadow){let V=L.shadow,U=r.get(L);U.shadowBias=V.bias,U.shadowNormalBias=V.normalBias,U.shadowRadius=V.radius,U.shadowMapSize=V.mapSize,n.directionalShadow[v]=U,n.directionalShadowMap[v]=Y,n.directionalShadowMatrix[v]=L.shadow.matrix,_++}n.directional[v]=z,v++}else if(L.isSpotLight){let z=i.get(L);z.position.setFromMatrixPosition(L.matrixWorld),z.color.copy(O).multiplyScalar(H*C),z.distance=j,z.coneCos=Math.cos(L.angle),z.penumbraCos=Math.cos(L.angle*(1-L.penumbra)),z.decay=L.decay,n.spot[g]=z;let V=L.shadow;if(L.map&&(n.spotLightMap[T]=L.map,T++,V.updateMatrices(L),L.castShadow&&E++),n.spotLightMatrix[g]=V.matrix,L.castShadow){let U=r.get(L);U.shadowBias=V.bias,U.shadowNormalBias=V.normalBias,U.shadowRadius=V.radius,U.shadowMapSize=V.mapSize,n.spotShadow[g]=U,n.spotShadowMap[g]=Y,S++}g++}else if(L.isRectAreaLight){let z=i.get(L);z.color.copy(O).multiplyScalar(H),z.halfWidth.set(L.width*.5,0,0),z.halfHeight.set(0,L.height*.5,0),n.rectArea[y]=z,y++}else if(L.isPointLight){let z=i.get(L);if(z.color.copy(L.color).multiplyScalar(L.intensity*C),z.distance=L.distance,z.decay=L.decay,L.castShadow){let V=L.shadow,U=r.get(L);U.shadowBias=V.bias,U.shadowNormalBias=V.normalBias,U.shadowRadius=V.radius,U.shadowMapSize=V.mapSize,U.shadowCameraNear=V.camera.near,U.shadowCameraFar=V.camera.far,n.pointShadow[m]=U,n.pointShadowMap[m]=Y,n.pointShadowMatrix[m]=L.shadow.matrix,M++}n.point[m]=z,m++}else if(L.isHemisphereLight){let z=i.get(L);z.skyColor.copy(L.color).multiplyScalar(H*C),z.groundColor.copy(L.groundColor).multiplyScalar(H*C),n.hemi[x]=z,x++}}y>0&&(t.isWebGL2||e.has("OES_texture_float_linear")===!0?(n.rectAreaLTC1=xt.LTC_FLOAT_1,n.rectAreaLTC2=xt.LTC_FLOAT_2):e.has("OES_texture_half_float_linear")===!0?(n.rectAreaLTC1=xt.LTC_HALF_1,n.rectAreaLTC2=xt.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),n.ambient[0]=d,n.ambient[1]=f,n.ambient[2]=p;let A=n.hash;(A.directionalLength!==v||A.pointLength!==m||A.spotLength!==g||A.rectAreaLength!==y||A.hemiLength!==x||A.numDirectionalShadows!==_||A.numPointShadows!==M||A.numSpotShadows!==S||A.numSpotMaps!==T)&&(n.directional.length=v,n.spot.length=g,n.rectArea.length=y,n.point.length=m,n.hemi.length=x,n.directionalShadow.length=_,n.directionalShadowMap.length=_,n.pointShadow.length=M,n.pointShadowMap.length=M,n.spotShadow.length=S,n.spotShadowMap.length=S,n.directionalShadowMatrix.length=_,n.pointShadowMatrix.length=M,n.spotLightMatrix.length=S+T-E,n.spotLightMap.length=T,n.numSpotLightShadowsWithMaps=E,A.directionalLength=v,A.pointLength=m,A.spotLength=g,A.rectAreaLength=y,A.hemiLength=x,A.numDirectionalShadows=_,A.numPointShadows=M,A.numSpotShadows=S,A.numSpotMaps=T,n.version=gxe++)}function c(u,h){let d=0,f=0,p=0,v=0,m=0,g=h.matrixWorldInverse;for(let y=0,x=u.length;y<x;y++){let _=u[y];if(_.isDirectionalLight){let M=n.directional[d];M.direction.setFromMatrixPosition(_.matrixWorld),s.setFromMatrixPosition(_.target.matrixWorld),M.direction.sub(s),M.direction.transformDirection(g),d++}else if(_.isSpotLight){let M=n.spot[p];M.position.setFromMatrixPosition(_.matrixWorld),M.position.applyMatrix4(g),M.direction.setFromMatrixPosition(_.matrixWorld),s.setFromMatrixPosition(_.target.matrixWorld),M.direction.sub(s),M.direction.transformDirection(g),p++}else if(_.isRectAreaLight){let M=n.rectArea[v];M.position.setFromMatrixPosition(_.matrixWorld),M.position.applyMatrix4(g),o.identity(),a.copy(_.matrixWorld),a.premultiply(g),o.extractRotation(a),M.halfWidth.set(_.width*.5,0,0),M.halfHeight.set(0,_.height*.5,0),M.halfWidth.applyMatrix4(o),M.halfHeight.applyMatrix4(o),v++}else if(_.isPointLight){let M=n.point[f];M.position.setFromMatrixPosition(_.matrixWorld),M.position.applyMatrix4(g),f++}else if(_.isHemisphereLight){let M=n.hemi[m];M.direction.setFromMatrixPosition(_.matrixWorld),M.direction.transformDirection(g),m++}}}return{setup:l,setupView:c,state:n}}function jH(e,t){let i=new yxe(e,t),r=[],n=[];function s(){r.length=0,n.length=0}function a(u){r.push(u)}function o(u){n.push(u)}function l(u){i.setup(r,u)}function c(u){i.setupView(r,u)}return{init:s,state:{lightsArray:r,shadowsArray:n,lights:i},setupLights:l,setupLightsView:c,pushLight:a,pushShadow:o}}function xxe(e,t){let i=new WeakMap;function r(s,a=0){let o=i.get(s),l;return o===void 0?(l=new jH(e,t),i.set(s,[l])):a>=o.length?(l=new jH(e,t),o.push(l)):l=o[a],l}function n(){i=new WeakMap}return{get:r,dispose:n}}var XJ=class extends Cb{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=Uh,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}},wxe=class extends Cb{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.referencePosition=new N,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}},bxe=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,_xe=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function Sxe(e,t,i){let r=new eN,n=new Me,s=new Me,a=new ai,o=new XJ({depthPacking:RJ}),l=new wxe,c={},u=i.maxTextureSize,h={[nc]:ms,[ms]:nc,[na]:na},d=new ki({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Me},radius:{value:4}},vertexShader:bxe,fragmentShader:_xe}),f=d.clone();f.defines.HORIZONTAL_PASS=1;let p=new Nt;p.setAttribute("position",new Qt(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));let v=new yr(p,d),m=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=YU,this.render=function(_,M,S){if(m.enabled===!1||m.autoUpdate===!1&&m.needsUpdate===!1||_.length===0)return;let T=e.getRenderTarget(),E=e.getActiveCubeFace(),C=e.getActiveMipmapLevel(),A=e.state;A.setBlending(Ln),A.buffers.color.setClear(1,1,1,1),A.buffers.depth.setTest(!0),A.setScissorTest(!1);for(let D=0,R=_.length;D<R;D++){let L=_[D],O=L.shadow;if(O===void 0){console.warn("THREE.WebGLShadowMap:",L,"has no shadow.");continue}if(O.autoUpdate===!1&&O.needsUpdate===!1)continue;n.copy(O.mapSize);let H=O.getFrameExtents();if(n.multiply(H),s.copy(O.mapSize),(n.x>u||n.y>u)&&(n.x>u&&(s.x=Math.floor(u/H.x),n.x=s.x*H.x,O.mapSize.x=s.x),n.y>u&&(s.y=Math.floor(u/H.y),n.y=s.y*H.y,O.mapSize.y=s.y)),O.map===null){let Y=this.type!==nx?{minFilter:Ci,magFilter:Ci}:{};O.map=new Ni(n.x,n.y,Y),O.map.texture.name=L.name+".shadowMap",O.camera.updateProjectionMatrix()}e.setRenderTarget(O.map),e.clear();let j=O.getViewportCount();for(let Y=0;Y<j;Y++){let z=O.getViewport(Y);a.set(s.x*z.x,s.y*z.y,s.x*z.z,s.y*z.w),A.viewport(a),O.updateMatrices(L,Y),r=O.getFrustum(),x(M,S,O.camera,L,this.type)}O.isPointLightShadow!==!0&&this.type===nx&&g(O,S),O.needsUpdate=!1}m.needsUpdate=!1,e.setRenderTarget(T,E,C)};function g(_,M){let S=t.update(v);d.defines.VSM_SAMPLES!==_.blurSamples&&(d.defines.VSM_SAMPLES=_.blurSamples,f.defines.VSM_SAMPLES=_.blurSamples,d.needsUpdate=!0,f.needsUpdate=!0),_.mapPass===null&&(_.mapPass=new Ni(n.x,n.y)),d.uniforms.shadow_pass.value=_.map.texture,d.uniforms.resolution.value=_.mapSize,d.uniforms.radius.value=_.radius,e.setRenderTarget(_.mapPass),e.clear(),e.renderBufferDirect(M,null,S,d,v,null),f.uniforms.shadow_pass.value=_.mapPass.texture,f.uniforms.resolution.value=_.mapSize,f.uniforms.radius.value=_.radius,e.setRenderTarget(_.map),e.clear(),e.renderBufferDirect(M,null,S,f,v,null)}function y(_,M,S,T,E,C){let A=null,D=S.isPointLight===!0?_.customDistanceMaterial:_.customDepthMaterial;if(D!==void 0)A=D;else if(A=S.isPointLight===!0?l:o,e.localClippingEnabled&&M.clipShadows===!0&&Array.isArray(M.clippingPlanes)&&M.clippingPlanes.length!==0||M.displacementMap&&M.displacementScale!==0||M.alphaMap&&M.alphaTest>0||M.map&&M.alphaTest>0){let R=A.uuid,L=M.uuid,O=c[R];O===void 0&&(O={},c[R]=O);let H=O[L];H===void 0&&(H=A.clone(),O[L]=H),A=H}return A.visible=M.visible,A.wireframe=M.wireframe,C===nx?A.side=M.shadowSide!==null?M.shadowSide:M.side:A.side=M.shadowSide!==null?M.shadowSide:h[M.side],A.alphaMap=M.alphaMap,A.alphaTest=M.alphaTest,A.map=M.map,A.clipShadows=M.clipShadows,A.clippingPlanes=M.clippingPlanes,A.clipIntersection=M.clipIntersection,A.displacementMap=M.displacementMap,A.displacementScale=M.displacementScale,A.displacementBias=M.displacementBias,A.wireframeLinewidth=M.wireframeLinewidth,A.linewidth=M.linewidth,S.isPointLight===!0&&A.isMeshDistanceMaterial===!0&&(A.referencePosition.setFromMatrixPosition(S.matrixWorld),A.nearDistance=T,A.farDistance=E),A}function x(_,M,S,T,E){if(_.visible===!1)return;if(_.layers.test(M.layers)&&(_.isMesh||_.isLine||_.isPoints)&&(_.castShadow||_.receiveShadow&&E===nx)&&(!_.frustumCulled||r.intersectsObject(_))){_.modelViewMatrix.multiplyMatrices(S.matrixWorldInverse,_.matrixWorld);let A=t.update(_),D=_.material;if(Array.isArray(D)){let R=A.groups;for(let L=0,O=R.length;L<O;L++){let H=R[L],j=D[H.materialIndex];if(j&&j.visible){let Y=y(_,j,T,S.near,S.far,E);e.renderBufferDirect(S,null,A,Y,_,H)}}}else if(D.visible){let R=y(_,D,T,S.near,S.far,E);e.renderBufferDirect(S,null,A,R,_,null)}}let C=_.children;for(let A=0,D=C.length;A<D;A++)x(C[A],M,S,T,E)}}function Mxe(e,t,i){let r=i.isWebGL2;function n(){let J=!1,xe=new ai,me=null,ze=new ai(0,0,0,0);return{setMask:function(Ze){me!==Ze&&!J&&(e.colorMask(Ze,Ze,Ze,Ze),me=Ze)},setLocked:function(Ze){J=Ze},setClear:function(Ze,Je,mt,St,Mt){Mt===!0&&(Ze*=St,Je*=St,mt*=St),xe.set(Ze,Je,mt,St),ze.equals(xe)===!1&&(e.clearColor(Ze,Je,mt,St),ze.copy(xe))},reset:function(){J=!1,me=null,ze.set(-1,0,0,0)}}}function s(){let J=!1,xe=null,me=null,ze=null;return{setTest:function(Ze){Ze?ne(2929):ce(2929)},setMask:function(Ze){xe!==Ze&&!J&&(e.depthMask(Ze),xe=Ze)},setFunc:function(Ze){if(me!==Ze){switch(Ze){case Wme:e.depthFunc(512);break;case Xme:e.depthFunc(519);break;case qme:e.depthFunc(513);break;case kO:e.depthFunc(515);break;case Yme:e.depthFunc(514);break;case Qme:e.depthFunc(518);break;case Zme:e.depthFunc(516);break;case Kme:e.depthFunc(517);break;default:e.depthFunc(515)}me=Ze}},setLocked:function(Ze){J=Ze},setClear:function(Ze){ze!==Ze&&(e.clearDepth(Ze),ze=Ze)},reset:function(){J=!1,xe=null,me=null,ze=null}}}function a(){let J=!1,xe=null,me=null,ze=null,Ze=null,Je=null,mt=null,St=null,Mt=null;return{setTest:function(vt){J||(vt?ne(2960):ce(2960))},setMask:function(vt){xe!==vt&&!J&&(e.stencilMask(vt),xe=vt)},setFunc:function(vt,ui,hi){(me!==vt||ze!==ui||Ze!==hi)&&(e.stencilFunc(vt,ui,hi),me=vt,ze=ui,Ze=hi)},setOp:function(vt,ui,hi){(Je!==vt||mt!==ui||St!==hi)&&(e.stencilOp(vt,ui,hi),Je=vt,mt=ui,St=hi)},setLocked:function(vt){J=vt},setClear:function(vt){Mt!==vt&&(e.clearStencil(vt),Mt=vt)},reset:function(){J=!1,xe=null,me=null,ze=null,Ze=null,Je=null,mt=null,St=null,Mt=null}}}let o=new n,l=new s,c=new a,u=new WeakMap,h=new WeakMap,d={},f={},p=new WeakMap,v=[],m=null,g=!1,y=null,x=null,_=null,M=null,S=null,T=null,E=null,C=!1,A=null,D=null,R=null,L=null,O=null,H=e.getParameter(35661),j=!1,Y=0,z=e.getParameter(7938);z.indexOf("WebGL")!==-1?(Y=parseFloat(/^WebGL (\d)/.exec(z)[1]),j=Y>=1):z.indexOf("OpenGL ES")!==-1&&(Y=parseFloat(/^OpenGL ES (\d)/.exec(z)[1]),j=Y>=2);let V=null,U={},k=e.getParameter(3088),X=e.getParameter(2978),re=new ai().fromArray(k),q=new ai().fromArray(X);function ee(J,xe,me){let ze=new Uint8Array(4),Ze=e.createTexture();e.bindTexture(J,Ze),e.texParameteri(J,10241,9728),e.texParameteri(J,10240,9728);for(let Je=0;Je<me;Je++)e.texImage2D(xe+Je,0,6408,1,1,0,6408,5121,ze);return Ze}let $={};$[3553]=ee(3553,3553,1),$[34067]=ee(34067,34069,6),o.setClear(0,0,0,1),l.setClear(1),c.setClear(0),ne(2929),l.setFunc(kO),Pe(!1),Ne(BG),ne(2884),ie(Ln);function ne(J){d[J]!==!0&&(e.enable(J),d[J]=!0)}function ce(J){d[J]!==!1&&(e.disable(J),d[J]=!1)}function pe(J,xe){return f[J]!==xe?(e.bindFramebuffer(J,xe),f[J]=xe,r&&(J===36009&&(f[36160]=xe),J===36160&&(f[36009]=xe)),!0):!1}function ge(J,xe){let me=v,ze=!1;if(J)if(me=p.get(xe),me===void 0&&(me=[],p.set(xe,me)),J.isWebGLMultipleRenderTargets){let Ze=J.texture;if(me.length!==Ze.length||me[0]!==36064){for(let Je=0,mt=Ze.length;Je<mt;Je++)me[Je]=36064+Je;me.length=Ze.length,ze=!0}}else me[0]!==36064&&(me[0]=36064,ze=!0);else me[0]!==1029&&(me[0]=1029,ze=!0);ze&&(i.isWebGL2?e.drawBuffers(me):t.get("WEBGL_draw_buffers").drawBuffersWEBGL(me))}function we(J){return m!==J?(e.useProgram(J),m=J,!0):!1}let le={[mv]:32774,[Ome]:32778,[zme]:32779};if(r)le[kG]=32775,le[VG]=32776;else{let J=t.get("EXT_blend_minmax");J!==null&&(le[kG]=J.MIN_EXT,le[VG]=J.MAX_EXT)}let ve={[Bme]:0,[Fme]:1,[Ume]:768,[SJ]:770,[jme]:776,[Gme]:774,[kme]:772,[Nme]:769,[MJ]:771,[Hme]:775,[Vme]:773};function ie(J,xe,me,ze,Ze,Je,mt,St){if(J===Ln){g===!0&&(ce(3042),g=!1);return}if(g===!1&&(ne(3042),g=!0),J!==Lme){if(J!==y||St!==C){if((x!==mv||S!==mv)&&(e.blendEquation(32774),x=mv,S=mv),St)switch(J){case nm:e.blendFuncSeparate(1,771,1,771);break;case FG:e.blendFunc(1,1);break;case UG:e.blendFuncSeparate(0,769,0,1);break;case NG:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",J);break}else switch(J){case nm:e.blendFuncSeparate(770,771,1,771);break;case FG:e.blendFunc(770,1);break;case UG:e.blendFuncSeparate(0,769,0,1);break;case NG:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",J);break}_=null,M=null,T=null,E=null,y=J,C=St}return}Ze=Ze||xe,Je=Je||me,mt=mt||ze,(xe!==x||Ze!==S)&&(e.blendEquationSeparate(le[xe],le[Ze]),x=xe,S=Ze),(me!==_||ze!==M||Je!==T||mt!==E)&&(e.blendFuncSeparate(ve[me],ve[ze],ve[Je],ve[mt]),_=me,M=ze,T=Je,E=mt),y=J,C=!1}function Ce(J,xe){J.side===na?ce(2884):ne(2884);let me=J.side===ms;xe&&(me=!me),Pe(me),J.blending===nm&&J.transparent===!1?ie(Ln):ie(J.blending,J.blendEquation,J.blendSrc,J.blendDst,J.blendEquationAlpha,J.blendSrcAlpha,J.blendDstAlpha,J.premultipliedAlpha),l.setFunc(J.depthFunc),l.setTest(J.depthTest),l.setMask(J.depthWrite),o.setMask(J.colorWrite);let ze=J.stencilWrite;c.setTest(ze),ze&&(c.setMask(J.stencilWriteMask),c.setFunc(J.stencilFunc,J.stencilRef,J.stencilFuncMask),c.setOp(J.stencilFail,J.stencilZFail,J.stencilZPass)),Le(J.polygonOffset,J.polygonOffsetFactor,J.polygonOffsetUnits),J.alphaToCoverage===!0?ne(32926):ce(32926)}function Pe(J){A!==J&&(J?e.frontFace(2304):e.frontFace(2305),A=J)}function Ne(J){J!==Dme?(ne(2884),J!==D&&(J===BG?e.cullFace(1029):J===Rme?e.cullFace(1028):e.cullFace(1032))):ce(2884),D=J}function be(J){J!==R&&(j&&e.lineWidth(J),R=J)}function Le(J,xe,me){J?(ne(32823),(L!==xe||O!==me)&&(e.polygonOffset(xe,me),L=xe,O=me)):ce(32823)}function Fe(J){J?ne(3089):ce(3089)}function K(J){J===void 0&&(J=33984+H-1),V!==J&&(e.activeTexture(J),V=J)}function B(J,xe,me){me===void 0&&(V===null?me=33984+H-1:me=V);let ze=U[me];ze===void 0&&(ze={type:void 0,texture:void 0},U[me]=ze),(ze.type!==J||ze.texture!==xe)&&(V!==me&&(e.activeTexture(me),V=me),e.bindTexture(J,xe||$[J]),ze.type=J,ze.texture=xe)}function G(){let J=U[V];J!==void 0&&J.type!==void 0&&(e.bindTexture(J.type,null),J.type=void 0,J.texture=void 0)}function oe(){try{e.compressedTexImage2D.apply(e,arguments)}catch(J){console.error("THREE.WebGLState:",J)}}function fe(){try{e.compressedTexImage3D.apply(e,arguments)}catch(J){console.error("THREE.WebGLState:",J)}}function W(){try{e.texSubImage2D.apply(e,arguments)}catch(J){console.error("THREE.WebGLState:",J)}}function Ie(){try{e.texSubImage3D.apply(e,arguments)}catch(J){console.error("THREE.WebGLState:",J)}}function Oe(){try{e.compressedTexSubImage2D.apply(e,arguments)}catch(J){console.error("THREE.WebGLState:",J)}}function Be(){try{e.compressedTexSubImage3D.apply(e,arguments)}catch(J){console.error("THREE.WebGLState:",J)}}function Re(){try{e.texStorage2D.apply(e,arguments)}catch(J){console.error("THREE.WebGLState:",J)}}function ke(){try{e.texStorage3D.apply(e,arguments)}catch(J){console.error("THREE.WebGLState:",J)}}function qe(){try{e.texImage2D.apply(e,arguments)}catch(J){console.error("THREE.WebGLState:",J)}}function Ke(){try{e.texImage3D.apply(e,arguments)}catch(J){console.error("THREE.WebGLState:",J)}}function it(J){re.equals(J)===!1&&(e.scissor(J.x,J.y,J.z,J.w),re.copy(J))}function He(J){q.equals(J)===!1&&(e.viewport(J.x,J.y,J.z,J.w),q.copy(J))}function de(J,xe){let me=h.get(xe);me===void 0&&(me=new WeakMap,h.set(xe,me));let ze=me.get(J);ze===void 0&&(ze=e.getUniformBlockIndex(xe,J.name),me.set(J,ze))}function We(J,xe){let me=h.get(xe).get(J);u.get(xe)!==me&&(e.uniformBlockBinding(xe,me,J.__bindingPointIndex),u.set(xe,me))}function dt(){e.disable(3042),e.disable(2884),e.disable(2929),e.disable(32823),e.disable(3089),e.disable(2960),e.disable(32926),e.blendEquation(32774),e.blendFunc(1,0),e.blendFuncSeparate(1,0,1,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(513),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(519,0,4294967295),e.stencilOp(7680,7680,7680),e.clearStencil(0),e.cullFace(1029),e.frontFace(2305),e.polygonOffset(0,0),e.activeTexture(33984),e.bindFramebuffer(36160,null),r===!0&&(e.bindFramebuffer(36009,null),e.bindFramebuffer(36008,null)),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),d={},V=null,U={},f={},p=new WeakMap,v=[],m=null,g=!1,y=null,x=null,_=null,M=null,S=null,T=null,E=null,C=!1,A=null,D=null,R=null,L=null,O=null,re.set(0,0,e.canvas.width,e.canvas.height),q.set(0,0,e.canvas.width,e.canvas.height),o.reset(),l.reset(),c.reset()}return{buffers:{color:o,depth:l,stencil:c},enable:ne,disable:ce,bindFramebuffer:pe,drawBuffers:ge,useProgram:we,setBlending:ie,setMaterial:Ce,setFlipSided:Pe,setCullFace:Ne,setLineWidth:be,setPolygonOffset:Le,setScissorTest:Fe,activeTexture:K,bindTexture:B,unbindTexture:G,compressedTexImage2D:oe,compressedTexImage3D:fe,texImage2D:qe,texImage3D:Ke,updateUBOMapping:de,uniformBlockBinding:We,texStorage2D:Re,texStorage3D:ke,texSubImage2D:W,texSubImage3D:Ie,compressedTexSubImage2D:Oe,compressedTexSubImage3D:Be,scissor:it,viewport:He,reset:dt}}function Exe(e,t,i,r,n,s,a){let o=n.isWebGL2,l=n.maxTextures,c=n.maxCubemapSize,u=n.maxTextureSize,h=n.maxSamples,d=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,f=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),p=new WeakMap,v,m=new WeakMap,g=!1;try{g=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function y(B,G){return g?new OffscreenCanvas(B,G):Pw("canvas")}function x(B,G,oe,fe){let W=1;if((B.width>fe||B.height>fe)&&(W=fe/Math.max(B.width,B.height)),W<1||G===!0)if(typeof HTMLImageElement<"u"&&B instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&B instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&B instanceof ImageBitmap){let Ie=G?lA:Math.floor,Oe=Ie(W*B.width),Be=Ie(W*B.height);v===void 0&&(v=y(Oe,Be));let Re=oe?y(Oe,Be):v;return Re.width=Oe,Re.height=Be,Re.getContext("2d").drawImage(B,0,0,Oe,Be),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+B.width+"x"+B.height+") to ("+Oe+"x"+Be+")."),Re}else return"data"in B&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+B.width+"x"+B.height+")."),B;return B}function _(B){return qO(B.width)&&qO(B.height)}function M(B){return o?!1:B.wrapS!==Tr||B.wrapT!==Tr||B.minFilter!==Ci&&B.minFilter!==bi}function S(B,G){return B.generateMipmaps&&G&&B.minFilter!==Ci&&B.minFilter!==bi}function T(B){e.generateMipmap(B)}function E(B,G,oe,fe,W=!1){if(o===!1)return G;if(B!==null){if(e[B]!==void 0)return e[B];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+B+"'")}let Ie=G;return G===6403&&(oe===5126&&(Ie=33326),oe===5131&&(Ie=33325),oe===5121&&(Ie=33321)),G===33319&&(oe===5126&&(Ie=33328),oe===5131&&(Ie=33327),oe===5121&&(Ie=33323)),G===6408&&(oe===5126&&(Ie=34836),oe===5131&&(Ie=34842),oe===5121&&(Ie=fe===vi&&W===!1?35907:32856),oe===32819&&(Ie=32854),oe===32820&&(Ie=32855)),(Ie===33325||Ie===33326||Ie===33327||Ie===33328||Ie===34842||Ie===34836)&&t.get("EXT_color_buffer_float"),Ie}function C(B,G,oe){return S(B,oe)===!0||B.isFramebufferTexture&&B.minFilter!==Ci&&B.minFilter!==bi?Math.log2(Math.max(G.width,G.height))+1:B.mipmaps!==void 0&&B.mipmaps.length>0?B.mipmaps.length:B.isCompressedTexture&&Array.isArray(B.image)?G.mipmaps.length:1}function A(B){return B===Ci||B===GG||B===pD?9728:9729}function D(B){let G=B.target;G.removeEventListener("dispose",D),L(G),G.isVideoTexture&&p.delete(G)}function R(B){let G=B.target;G.removeEventListener("dispose",R),H(G)}function L(B){let G=r.get(B);if(G.__webglInit===void 0)return;let oe=B.source,fe=m.get(oe);if(fe){let W=fe[G.__cacheKey];W.usedTimes--,W.usedTimes===0&&O(B),Object.keys(fe).length===0&&m.delete(oe)}r.remove(B)}function O(B){let G=r.get(B);e.deleteTexture(G.__webglTexture);let oe=B.source,fe=m.get(oe);delete fe[G.__cacheKey],a.memory.textures--}function H(B){let G=B.texture,oe=r.get(B),fe=r.get(G);if(fe.__webglTexture!==void 0&&(e.deleteTexture(fe.__webglTexture),a.memory.textures--),B.depthTexture&&B.depthTexture.dispose(),B.isWebGLCubeRenderTarget)for(let W=0;W<6;W++)e.deleteFramebuffer(oe.__webglFramebuffer[W]),oe.__webglDepthbuffer&&e.deleteRenderbuffer(oe.__webglDepthbuffer[W]);else{if(e.deleteFramebuffer(oe.__webglFramebuffer),oe.__webglDepthbuffer&&e.deleteRenderbuffer(oe.__webglDepthbuffer),oe.__webglMultisampledFramebuffer&&e.deleteFramebuffer(oe.__webglMultisampledFramebuffer),oe.__webglColorRenderbuffer)for(let W=0;W<oe.__webglColorRenderbuffer.length;W++)oe.__webglColorRenderbuffer[W]&&e.deleteRenderbuffer(oe.__webglColorRenderbuffer[W]);oe.__webglDepthRenderbuffer&&e.deleteRenderbuffer(oe.__webglDepthRenderbuffer)}if(B.isWebGLMultipleRenderTargets)for(let W=0,Ie=G.length;W<Ie;W++){let Oe=r.get(G[W]);Oe.__webglTexture&&(e.deleteTexture(Oe.__webglTexture),a.memory.textures--),r.remove(G[W])}r.remove(G),r.remove(B)}let j=0;function Y(){j=0}function z(){let B=j;return B>=l&&console.warn("THREE.WebGLTextures: Trying to use "+B+" texture units while this GPU supports only "+l),j+=1,B}function V(B){let G=[];return G.push(B.wrapS),G.push(B.wrapT),G.push(B.wrapR||0),G.push(B.magFilter),G.push(B.minFilter),G.push(B.anisotropy),G.push(B.internalFormat),G.push(B.format),G.push(B.type),G.push(B.generateMipmaps),G.push(B.premultiplyAlpha),G.push(B.flipY),G.push(B.unpackAlignment),G.push(B.encoding),G.join()}function U(B,G){let oe=r.get(B);if(B.isVideoTexture&&Fe(B),B.isRenderTargetTexture===!1&&B.version>0&&oe.__version!==B.version){let fe=B.image;if(fe===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(fe.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{ce(oe,B,G);return}}i.bindTexture(3553,oe.__webglTexture,33984+G)}function k(B,G){let oe=r.get(B);if(B.version>0&&oe.__version!==B.version){ce(oe,B,G);return}i.bindTexture(35866,oe.__webglTexture,33984+G)}function X(B,G){let oe=r.get(B);if(B.version>0&&oe.__version!==B.version){ce(oe,B,G);return}i.bindTexture(32879,oe.__webglTexture,33984+G)}function re(B,G){let oe=r.get(B);if(B.version>0&&oe.__version!==B.version){pe(oe,B,G);return}i.bindTexture(34067,oe.__webglTexture,33984+G)}let q={[lh]:10497,[Tr]:33071,[HO]:33648},ee={[Ci]:9728,[GG]:9984,[pD]:9986,[bi]:9729,[sge]:9985,[I0]:9987};function $(B,G,oe){if(oe?(e.texParameteri(B,10242,q[G.wrapS]),e.texParameteri(B,10243,q[G.wrapT]),(B===32879||B===35866)&&e.texParameteri(B,32882,q[G.wrapR]),e.texParameteri(B,10240,ee[G.magFilter]),e.texParameteri(B,10241,ee[G.minFilter])):(e.texParameteri(B,10242,33071),e.texParameteri(B,10243,33071),(B===32879||B===35866)&&e.texParameteri(B,32882,33071),(G.wrapS!==Tr||G.wrapT!==Tr)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(B,10240,A(G.magFilter)),e.texParameteri(B,10241,A(G.minFilter)),G.minFilter!==Ci&&G.minFilter!==bi&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),t.has("EXT_texture_filter_anisotropic")===!0){let fe=t.get("EXT_texture_filter_anisotropic");if(G.magFilter===Ci||G.minFilter!==pD&&G.minFilter!==I0||G.type===or&&t.has("OES_texture_float_linear")===!1||o===!1&&G.type===Th&&t.has("OES_texture_half_float_linear")===!1)return;(G.anisotropy>1||r.get(G).__currentAnisotropy)&&(e.texParameterf(B,fe.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(G.anisotropy,n.getMaxAnisotropy())),r.get(G).__currentAnisotropy=G.anisotropy)}}function ne(B,G){let oe=!1;B.__webglInit===void 0&&(B.__webglInit=!0,G.addEventListener("dispose",D));let fe=G.source,W=m.get(fe);W===void 0&&(W={},m.set(fe,W));let Ie=V(G);if(Ie!==B.__cacheKey){W[Ie]===void 0&&(W[Ie]={texture:e.createTexture(),usedTimes:0},a.memory.textures++,oe=!0),W[Ie].usedTimes++;let Oe=W[B.__cacheKey];Oe!==void 0&&(W[B.__cacheKey].usedTimes--,Oe.usedTimes===0&&O(G)),B.__cacheKey=Ie,B.__webglTexture=W[Ie].texture}return oe}function ce(B,G,oe){let fe=3553;(G.isDataArrayTexture||G.isCompressedArrayTexture)&&(fe=35866),G.isData3DTexture&&(fe=32879);let W=ne(B,G),Ie=G.source;i.bindTexture(fe,B.__webglTexture,33984+oe);let Oe=r.get(Ie);if(Ie.version!==Oe.__version||W===!0){i.activeTexture(33984+oe),e.pixelStorei(37440,G.flipY),e.pixelStorei(37441,G.premultiplyAlpha),e.pixelStorei(3317,G.unpackAlignment),e.pixelStorei(37443,0);let Be=M(G)&&_(G.image)===!1,Re=x(G.image,Be,!1,u);Re=K(G,Re);let ke=_(Re)||o,qe=s.convert(G.format,G.encoding),Ke=s.convert(G.type),it=E(G.internalFormat,qe,Ke,G.encoding,G.isVideoTexture);$(fe,G,ke);let He,de=G.mipmaps,We=o&&G.isVideoTexture!==!0,dt=Oe.__version===void 0||W===!0,J=C(G,Re,ke);if(G.isDepthTexture)it=6402,o?G.type===or?it=36012:G.type===ch?it=33190:G.type===sm?it=35056:it=33189:G.type===or&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),G.format===am&&it===6402&&G.type!==TJ&&G.type!==ch&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),G.type=ch,Ke=s.convert(G.type)),G.format===Mm&&it===6402&&(it=34041,G.type!==sm&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),G.type=sm,Ke=s.convert(G.type))),dt&&(We?i.texStorage2D(3553,1,it,Re.width,Re.height):i.texImage2D(3553,0,it,Re.width,Re.height,0,qe,Ke,null));else if(G.isDataTexture)if(de.length>0&&ke){We&&dt&&i.texStorage2D(3553,J,it,de[0].width,de[0].height);for(let xe=0,me=de.length;xe<me;xe++)He=de[xe],We?i.texSubImage2D(3553,xe,0,0,He.width,He.height,qe,Ke,He.data):i.texImage2D(3553,xe,it,He.width,He.height,0,qe,Ke,He.data);G.generateMipmaps=!1}else We?(dt&&i.texStorage2D(3553,J,it,Re.width,Re.height),i.texSubImage2D(3553,0,0,0,Re.width,Re.height,qe,Ke,Re.data)):i.texImage2D(3553,0,it,Re.width,Re.height,0,qe,Ke,Re.data);else if(G.isCompressedTexture)if(G.isCompressedArrayTexture){We&&dt&&i.texStorage3D(35866,J,it,de[0].width,de[0].height,Re.depth);for(let xe=0,me=de.length;xe<me;xe++)He=de[xe],G.format!==Lr?qe!==null?We?i.compressedTexSubImage3D(35866,xe,0,0,0,He.width,He.height,Re.depth,qe,He.data,0,0):i.compressedTexImage3D(35866,xe,it,He.width,He.height,Re.depth,0,He.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):We?i.texSubImage3D(35866,xe,0,0,0,He.width,He.height,Re.depth,qe,Ke,He.data):i.texImage3D(35866,xe,it,He.width,He.height,Re.depth,0,qe,Ke,He.data)}else{We&&dt&&i.texStorage2D(3553,J,it,de[0].width,de[0].height);for(let xe=0,me=de.length;xe<me;xe++)He=de[xe],G.format!==Lr?qe!==null?We?i.compressedTexSubImage2D(3553,xe,0,0,He.width,He.height,qe,He.data):i.compressedTexImage2D(3553,xe,it,He.width,He.height,0,He.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):We?i.texSubImage2D(3553,xe,0,0,He.width,He.height,qe,Ke,He.data):i.texImage2D(3553,xe,it,He.width,He.height,0,qe,Ke,He.data)}else if(G.isDataArrayTexture)We?(dt&&i.texStorage3D(35866,J,it,Re.width,Re.height,Re.depth),i.texSubImage3D(35866,0,0,0,0,Re.width,Re.height,Re.depth,qe,Ke,Re.data)):i.texImage3D(35866,0,it,Re.width,Re.height,Re.depth,0,qe,Ke,Re.data);else if(G.isData3DTexture)We?(dt&&i.texStorage3D(32879,J,it,Re.width,Re.height,Re.depth),i.texSubImage3D(32879,0,0,0,0,Re.width,Re.height,Re.depth,qe,Ke,Re.data)):i.texImage3D(32879,0,it,Re.width,Re.height,Re.depth,0,qe,Ke,Re.data);else if(G.isFramebufferTexture){if(dt)if(We)i.texStorage2D(3553,J,it,Re.width,Re.height);else{let xe=Re.width,me=Re.height;for(let ze=0;ze<J;ze++)i.texImage2D(3553,ze,it,xe,me,0,qe,Ke,null),xe>>=1,me>>=1}}else if(de.length>0&&ke){We&&dt&&i.texStorage2D(3553,J,it,de[0].width,de[0].height);for(let xe=0,me=de.length;xe<me;xe++)He=de[xe],We?i.texSubImage2D(3553,xe,0,0,qe,Ke,He):i.texImage2D(3553,xe,it,qe,Ke,He);G.generateMipmaps=!1}else We?(dt&&i.texStorage2D(3553,J,it,Re.width,Re.height),i.texSubImage2D(3553,0,0,0,qe,Ke,Re)):i.texImage2D(3553,0,it,qe,Ke,Re);S(G,ke)&&T(fe),Oe.__version=Ie.version,G.onUpdate&&G.onUpdate(G)}B.__version=G.version}function pe(B,G,oe){if(G.image.length!==6)return;let fe=ne(B,G),W=G.source;i.bindTexture(34067,B.__webglTexture,33984+oe);let Ie=r.get(W);if(W.version!==Ie.__version||fe===!0){i.activeTexture(33984+oe),e.pixelStorei(37440,G.flipY),e.pixelStorei(37441,G.premultiplyAlpha),e.pixelStorei(3317,G.unpackAlignment),e.pixelStorei(37443,0);let Oe=G.isCompressedTexture||G.image[0].isCompressedTexture,Be=G.image[0]&&G.image[0].isDataTexture,Re=[];for(let xe=0;xe<6;xe++)!Oe&&!Be?Re[xe]=x(G.image[xe],!1,!0,c):Re[xe]=Be?G.image[xe].image:G.image[xe],Re[xe]=K(G,Re[xe]);let ke=Re[0],qe=_(ke)||o,Ke=s.convert(G.format,G.encoding),it=s.convert(G.type),He=E(G.internalFormat,Ke,it,G.encoding),de=o&&G.isVideoTexture!==!0,We=Ie.__version===void 0||fe===!0,dt=C(G,ke,qe);$(34067,G,qe);let J;if(Oe){de&&We&&i.texStorage2D(34067,dt,He,ke.width,ke.height);for(let xe=0;xe<6;xe++){J=Re[xe].mipmaps;for(let me=0;me<J.length;me++){let ze=J[me];G.format!==Lr?Ke!==null?de?i.compressedTexSubImage2D(34069+xe,me,0,0,ze.width,ze.height,Ke,ze.data):i.compressedTexImage2D(34069+xe,me,He,ze.width,ze.height,0,ze.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):de?i.texSubImage2D(34069+xe,me,0,0,ze.width,ze.height,Ke,it,ze.data):i.texImage2D(34069+xe,me,He,ze.width,ze.height,0,Ke,it,ze.data)}}}else{J=G.mipmaps,de&&We&&(J.length>0&&dt++,i.texStorage2D(34067,dt,He,Re[0].width,Re[0].height));for(let xe=0;xe<6;xe++)if(Be){de?i.texSubImage2D(34069+xe,0,0,0,Re[xe].width,Re[xe].height,Ke,it,Re[xe].data):i.texImage2D(34069+xe,0,He,Re[xe].width,Re[xe].height,0,Ke,it,Re[xe].data);for(let me=0;me<J.length;me++){let ze=J[me].image[xe].image;de?i.texSubImage2D(34069+xe,me+1,0,0,ze.width,ze.height,Ke,it,ze.data):i.texImage2D(34069+xe,me+1,He,ze.width,ze.height,0,Ke,it,ze.data)}}else{de?i.texSubImage2D(34069+xe,0,0,0,Ke,it,Re[xe]):i.texImage2D(34069+xe,0,He,Ke,it,Re[xe]);for(let me=0;me<J.length;me++){let ze=J[me];de?i.texSubImage2D(34069+xe,me+1,0,0,Ke,it,ze.image[xe]):i.texImage2D(34069+xe,me+1,He,Ke,it,ze.image[xe])}}}S(G,qe)&&T(34067),Ie.__version=W.version,G.onUpdate&&G.onUpdate(G)}B.__version=G.version}function ge(B,G,oe,fe,W){let Ie=s.convert(oe.format,oe.encoding),Oe=s.convert(oe.type),Be=E(oe.internalFormat,Ie,Oe,oe.encoding);r.get(G).__hasExternalTextures||(W===32879||W===35866?i.texImage3D(W,0,Be,G.width,G.height,G.depth,0,Ie,Oe,null):i.texImage2D(W,0,Be,G.width,G.height,0,Ie,Oe,null)),i.bindFramebuffer(36160,B),Le(G)?d.framebufferTexture2DMultisampleEXT(36160,fe,W,r.get(oe).__webglTexture,0,be(G)):(W===3553||W>=34069&&W<=34074)&&e.framebufferTexture2D(36160,fe,W,r.get(oe).__webglTexture,0),i.bindFramebuffer(36160,null)}function we(B,G,oe){if(e.bindRenderbuffer(36161,B),G.depthBuffer&&!G.stencilBuffer){let fe=33189;if(oe||Le(G)){let W=G.depthTexture;W&&W.isDepthTexture&&(W.type===or?fe=36012:W.type===ch&&(fe=33190));let Ie=be(G);Le(G)?d.renderbufferStorageMultisampleEXT(36161,Ie,fe,G.width,G.height):e.renderbufferStorageMultisample(36161,Ie,fe,G.width,G.height)}else e.renderbufferStorage(36161,fe,G.width,G.height);e.framebufferRenderbuffer(36160,36096,36161,B)}else if(G.depthBuffer&&G.stencilBuffer){let fe=be(G);oe&&Le(G)===!1?e.renderbufferStorageMultisample(36161,fe,35056,G.width,G.height):Le(G)?d.renderbufferStorageMultisampleEXT(36161,fe,35056,G.width,G.height):e.renderbufferStorage(36161,34041,G.width,G.height),e.framebufferRenderbuffer(36160,33306,36161,B)}else{let fe=G.isWebGLMultipleRenderTargets===!0?G.texture:[G.texture];for(let W=0;W<fe.length;W++){let Ie=fe[W],Oe=s.convert(Ie.format,Ie.encoding),Be=s.convert(Ie.type),Re=E(Ie.internalFormat,Oe,Be,Ie.encoding),ke=be(G);oe&&Le(G)===!1?e.renderbufferStorageMultisample(36161,ke,Re,G.width,G.height):Le(G)?d.renderbufferStorageMultisampleEXT(36161,ke,Re,G.width,G.height):e.renderbufferStorage(36161,Re,G.width,G.height)}}e.bindRenderbuffer(36161,null)}function le(B,G){if(G&&G.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(i.bindFramebuffer(36160,B),!(G.depthTexture&&G.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!r.get(G.depthTexture).__webglTexture||G.depthTexture.image.width!==G.width||G.depthTexture.image.height!==G.height)&&(G.depthTexture.image.width=G.width,G.depthTexture.image.height=G.height,G.depthTexture.needsUpdate=!0),U(G.depthTexture,0);let oe=r.get(G.depthTexture).__webglTexture,fe=be(G);if(G.depthTexture.format===am)Le(G)?d.framebufferTexture2DMultisampleEXT(36160,36096,3553,oe,0,fe):e.framebufferTexture2D(36160,36096,3553,oe,0);else if(G.depthTexture.format===Mm)Le(G)?d.framebufferTexture2DMultisampleEXT(36160,33306,3553,oe,0,fe):e.framebufferTexture2D(36160,33306,3553,oe,0);else throw new Error("Unknown depthTexture format")}function ve(B){let G=r.get(B),oe=B.isWebGLCubeRenderTarget===!0;if(B.depthTexture&&!G.__autoAllocateDepthBuffer){if(oe)throw new Error("target.depthTexture not supported in Cube render targets");le(G.__webglFramebuffer,B)}else if(oe){G.__webglDepthbuffer=[];for(let fe=0;fe<6;fe++)i.bindFramebuffer(36160,G.__webglFramebuffer[fe]),G.__webglDepthbuffer[fe]=e.createRenderbuffer(),we(G.__webglDepthbuffer[fe],B,!1)}else i.bindFramebuffer(36160,G.__webglFramebuffer),G.__webglDepthbuffer=e.createRenderbuffer(),we(G.__webglDepthbuffer,B,!1);i.bindFramebuffer(36160,null)}function ie(B,G,oe){let fe=r.get(B);G!==void 0&&ge(fe.__webglFramebuffer,B,B.texture,36064,3553),oe!==void 0&&ve(B)}function Ce(B){let G=B.texture,oe=r.get(B),fe=r.get(G);B.addEventListener("dispose",R),B.isWebGLMultipleRenderTargets!==!0&&(fe.__webglTexture===void 0&&(fe.__webglTexture=e.createTexture()),fe.__version=G.version,a.memory.textures++);let W=B.isWebGLCubeRenderTarget===!0,Ie=B.isWebGLMultipleRenderTargets===!0,Oe=_(B)||o;if(W){oe.__webglFramebuffer=[];for(let Be=0;Be<6;Be++)oe.__webglFramebuffer[Be]=e.createFramebuffer()}else{if(oe.__webglFramebuffer=e.createFramebuffer(),Ie)if(n.drawBuffers){let Be=B.texture;for(let Re=0,ke=Be.length;Re<ke;Re++){let qe=r.get(Be[Re]);qe.__webglTexture===void 0&&(qe.__webglTexture=e.createTexture(),a.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(o&&B.samples>0&&Le(B)===!1){let Be=Ie?G:[G];oe.__webglMultisampledFramebuffer=e.createFramebuffer(),oe.__webglColorRenderbuffer=[],i.bindFramebuffer(36160,oe.__webglMultisampledFramebuffer);for(let Re=0;Re<Be.length;Re++){let ke=Be[Re];oe.__webglColorRenderbuffer[Re]=e.createRenderbuffer(),e.bindRenderbuffer(36161,oe.__webglColorRenderbuffer[Re]);let qe=s.convert(ke.format,ke.encoding),Ke=s.convert(ke.type),it=E(ke.internalFormat,qe,Ke,ke.encoding,B.isXRRenderTarget===!0),He=be(B);e.renderbufferStorageMultisample(36161,He,it,B.width,B.height),e.framebufferRenderbuffer(36160,36064+Re,36161,oe.__webglColorRenderbuffer[Re])}e.bindRenderbuffer(36161,null),B.depthBuffer&&(oe.__webglDepthRenderbuffer=e.createRenderbuffer(),we(oe.__webglDepthRenderbuffer,B,!0)),i.bindFramebuffer(36160,null)}}if(W){i.bindTexture(34067,fe.__webglTexture),$(34067,G,Oe);for(let Be=0;Be<6;Be++)ge(oe.__webglFramebuffer[Be],B,G,36064,34069+Be);S(G,Oe)&&T(34067),i.unbindTexture()}else if(Ie){let Be=B.texture;for(let Re=0,ke=Be.length;Re<ke;Re++){let qe=Be[Re],Ke=r.get(qe);i.bindTexture(3553,Ke.__webglTexture),$(3553,qe,Oe),ge(oe.__webglFramebuffer,B,qe,36064+Re,3553),S(qe,Oe)&&T(3553)}i.unbindTexture()}else{let Be=3553;(B.isWebGL3DRenderTarget||B.isWebGLArrayRenderTarget)&&(o?Be=B.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),i.bindTexture(Be,fe.__webglTexture),$(Be,G,Oe),ge(oe.__webglFramebuffer,B,G,36064,Be),S(G,Oe)&&T(Be),i.unbindTexture()}B.depthBuffer&&ve(B)}function Pe(B){let G=_(B)||o,oe=B.isWebGLMultipleRenderTargets===!0?B.texture:[B.texture];for(let fe=0,W=oe.length;fe<W;fe++){let Ie=oe[fe];if(S(Ie,G)){let Oe=B.isWebGLCubeRenderTarget?34067:3553,Be=r.get(Ie).__webglTexture;i.bindTexture(Oe,Be),T(Oe),i.unbindTexture()}}}function Ne(B){if(o&&B.samples>0&&Le(B)===!1){let G=B.isWebGLMultipleRenderTargets?B.texture:[B.texture],oe=B.width,fe=B.height,W=16384,Ie=[],Oe=B.stencilBuffer?33306:36096,Be=r.get(B),Re=B.isWebGLMultipleRenderTargets===!0;if(Re)for(let ke=0;ke<G.length;ke++)i.bindFramebuffer(36160,Be.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064+ke,36161,null),i.bindFramebuffer(36160,Be.__webglFramebuffer),e.framebufferTexture2D(36009,36064+ke,3553,null,0);i.bindFramebuffer(36008,Be.__webglMultisampledFramebuffer),i.bindFramebuffer(36009,Be.__webglFramebuffer);for(let ke=0;ke<G.length;ke++){Ie.push(36064+ke),B.depthBuffer&&Ie.push(Oe);let qe=Be.__ignoreDepthValues!==void 0?Be.__ignoreDepthValues:!1;if(qe===!1&&(B.depthBuffer&&(W|=256),B.stencilBuffer&&(W|=1024)),Re&&e.framebufferRenderbuffer(36008,36064,36161,Be.__webglColorRenderbuffer[ke]),qe===!0&&(e.invalidateFramebuffer(36008,[Oe]),e.invalidateFramebuffer(36009,[Oe])),Re){let Ke=r.get(G[ke]).__webglTexture;e.framebufferTexture2D(36009,36064,3553,Ke,0)}e.blitFramebuffer(0,0,oe,fe,0,0,oe,fe,W,9728),f&&e.invalidateFramebuffer(36008,Ie)}if(i.bindFramebuffer(36008,null),i.bindFramebuffer(36009,null),Re)for(let ke=0;ke<G.length;ke++){i.bindFramebuffer(36160,Be.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064+ke,36161,Be.__webglColorRenderbuffer[ke]);let qe=r.get(G[ke]).__webglTexture;i.bindFramebuffer(36160,Be.__webglFramebuffer),e.framebufferTexture2D(36009,36064+ke,3553,qe,0)}i.bindFramebuffer(36009,Be.__webglMultisampledFramebuffer)}}function be(B){return Math.min(h,B.samples)}function Le(B){let G=r.get(B);return o&&B.samples>0&&t.has("WEBGL_multisampled_render_to_texture")===!0&&G.__useRenderToTexture!==!1}function Fe(B){let G=a.render.frame;p.get(B)!==G&&(p.set(B,G),B.update())}function K(B,G){let oe=B.encoding,fe=B.format,W=B.type;return B.isCompressedTexture===!0||B.isVideoTexture===!0||B.format===XO||oe!==sc&&(oe===vi?o===!1?t.has("EXT_sRGB")===!0&&fe===Lr?(B.format=XO,B.minFilter=bi,B.generateMipmaps=!1):G=zJ.sRGBToLinear(G):(fe!==Lr||W!==ca)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",oe)),G}this.allocateTextureUnit=z,this.resetTextureUnits=Y,this.setTexture2D=U,this.setTexture2DArray=k,this.setTexture3D=X,this.setTextureCube=re,this.rebindTextures=ie,this.setupRenderTarget=Ce,this.updateRenderTargetMipmap=Pe,this.updateMultisampleRenderTarget=Ne,this.setupDepthRenderbuffer=ve,this.setupFrameBufferTexture=ge,this.useMultisampledRTT=Le}function Axe(e,t,i){let r=i.isWebGL2;function n(s,a=null){let o;if(s===ca)return 5121;if(s===cge)return 32819;if(s===uge)return 32820;if(s===age)return 5120;if(s===oge)return 5122;if(s===TJ)return 5123;if(s===lge)return 5124;if(s===ch)return 5125;if(s===or)return 5126;if(s===Th)return r?5131:(o=t.get("OES_texture_half_float"),o!==null?o.HALF_FLOAT_OES:null);if(s===hge)return 6406;if(s===Lr)return 6408;if(s===dge)return 6409;if(s===fge)return 6410;if(s===am)return 6402;if(s===Mm)return 34041;if(s===XO)return o=t.get("EXT_sRGB"),o!==null?o.SRGB_ALPHA_EXT:null;if(s===KE)return 6403;if(s===pge)return 36244;if(s===rA)return 33319;if(s===mge)return 33320;if(s===CJ)return 36249;if(s===mD||s===gD||s===vD||s===yD)if(a===vi)if(o=t.get("WEBGL_compressed_texture_s3tc_srgb"),o!==null){if(s===mD)return o.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(s===gD)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(s===vD)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(s===yD)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(o=t.get("WEBGL_compressed_texture_s3tc"),o!==null){if(s===mD)return o.COMPRESSED_RGB_S3TC_DXT1_EXT;if(s===gD)return o.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(s===vD)return o.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(s===yD)return o.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(s===HG||s===jG||s===WG||s===XG)if(o=t.get("WEBGL_compressed_texture_pvrtc"),o!==null){if(s===HG)return o.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(s===jG)return o.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(s===WG)return o.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(s===XG)return o.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(s===gge)return o=t.get("WEBGL_compressed_texture_etc1"),o!==null?o.COMPRESSED_RGB_ETC1_WEBGL:null;if(s===qG||s===YG)if(o=t.get("WEBGL_compressed_texture_etc"),o!==null){if(s===qG)return a===vi?o.COMPRESSED_SRGB8_ETC2:o.COMPRESSED_RGB8_ETC2;if(s===YG)return a===vi?o.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:o.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(s===QG||s===ZG||s===KG||s===JG||s===$G||s===eH||s===tH||s===iH||s===rH||s===nH||s===sH||s===aH||s===oH||s===lH)if(o=t.get("WEBGL_compressed_texture_astc"),o!==null){if(s===QG)return a===vi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:o.COMPRESSED_RGBA_ASTC_4x4_KHR;if(s===ZG)return a===vi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:o.COMPRESSED_RGBA_ASTC_5x4_KHR;if(s===KG)return a===vi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:o.COMPRESSED_RGBA_ASTC_5x5_KHR;if(s===JG)return a===vi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:o.COMPRESSED_RGBA_ASTC_6x5_KHR;if(s===$G)return a===vi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:o.COMPRESSED_RGBA_ASTC_6x6_KHR;if(s===eH)return a===vi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:o.COMPRESSED_RGBA_ASTC_8x5_KHR;if(s===tH)return a===vi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:o.COMPRESSED_RGBA_ASTC_8x6_KHR;if(s===iH)return a===vi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:o.COMPRESSED_RGBA_ASTC_8x8_KHR;if(s===rH)return a===vi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:o.COMPRESSED_RGBA_ASTC_10x5_KHR;if(s===nH)return a===vi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:o.COMPRESSED_RGBA_ASTC_10x6_KHR;if(s===sH)return a===vi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:o.COMPRESSED_RGBA_ASTC_10x8_KHR;if(s===aH)return a===vi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:o.COMPRESSED_RGBA_ASTC_10x10_KHR;if(s===oH)return a===vi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:o.COMPRESSED_RGBA_ASTC_12x10_KHR;if(s===lH)return a===vi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:o.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(s===xD)if(o=t.get("EXT_texture_compression_bptc"),o!==null){if(s===xD)return a===vi?o.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:o.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;if(s===vge||s===cH||s===uH||s===hH)if(o=t.get("EXT_texture_compression_rgtc"),o!==null){if(s===xD)return o.COMPRESSED_RED_RGTC1_EXT;if(s===cH)return o.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(s===uH)return o.COMPRESSED_RED_GREEN_RGTC2_EXT;if(s===hH)return o.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return s===sm?r?34042:(o=t.get("WEBGL_depth_texture"),o!==null?o.UNSIGNED_INT_24_8_WEBGL:null):e[s]!==void 0?e[s]:null}return{convert:n}}var Txe=class extends ta{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}},hh=class extends rr{constructor(){super(),this.isGroup=!0,this.type="Group"}},Cxe={type:"move"},WD=class{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new hh,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new hh,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new N,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new N),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new hh,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new N,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new N),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){let t=this._hand;if(t)for(let i of e.hand.values())this._getHandJoint(t,i)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,i){let r=null,n=null,s=null,a=this._targetRay,o=this._grip,l=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(l&&e.hand){s=!0;for(let p of e.hand.values()){let v=t.getJointPose(p,i),m=this._getHandJoint(l,p);v!==null&&(m.matrix.fromArray(v.transform.matrix),m.matrix.decompose(m.position,m.rotation,m.scale),m.jointRadius=v.radius),m.visible=v!==null}let c=l.joints["index-finger-tip"],u=l.joints["thumb-tip"],h=c.position.distanceTo(u.position),d=.02,f=.005;l.inputState.pinching&&h>d+f?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&h<=d-f&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else o!==null&&e.gripSpace&&(n=t.getPose(e.gripSpace,i),n!==null&&(o.matrix.fromArray(n.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),n.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(n.linearVelocity)):o.hasLinearVelocity=!1,n.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(n.angularVelocity)):o.hasAngularVelocity=!1));a!==null&&(r=t.getPose(e.targetRaySpace,i),r===null&&n!==null&&(r=n),r!==null&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),r.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(r.linearVelocity)):a.hasLinearVelocity=!1,r.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(r.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(Cxe)))}return a!==null&&(a.visible=r!==null),o!==null&&(o.visible=n!==null),l!==null&&(l.visible=s!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){let i=new hh;i.matrixAutoUpdate=!1,i.visible=!1,e.joints[t.jointName]=i,e.add(i)}return e.joints[t.jointName]}},O0=class extends jr{constructor(e,t,i,r,n,s,a,o,l,c){if(c=c!==void 0?c:am,c!==am&&c!==Mm)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");i===void 0&&c===am&&(i=ch),i===void 0&&c===Mm&&(i=sm),super(null,r,n,s,a,o,c,i,l),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=a!==void 0?a:Ci,this.minFilter=o!==void 0?o:Ci,this.flipY=!1,this.generateMipmaps=!1}},Pxe=class extends Vs{constructor(e,t){super();let i=this,r=null,n=1,s=null,a="local-floor",o=1,l=null,c=null,u=null,h=null,d=null,f=null,p=t.getContextAttributes(),v=null,m=null,g=[],y=[],x=new Set,_=new Map,M=new ta;M.layers.enable(1),M.viewport=new ai;let S=new ta;S.layers.enable(2),S.viewport=new ai;let T=[M,S],E=new Txe;E.layers.enable(1),E.layers.enable(2);let C=null,A=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(k){let X=g[k];return X===void 0&&(X=new WD,g[k]=X),X.getTargetRaySpace()},this.getControllerGrip=function(k){let X=g[k];return X===void 0&&(X=new WD,g[k]=X),X.getGripSpace()},this.getHand=function(k){let X=g[k];return X===void 0&&(X=new WD,g[k]=X),X.getHandSpace()};function D(k){let X=y.indexOf(k.inputSource);if(X===-1)return;let re=g[X];re!==void 0&&re.dispatchEvent({type:k.type,data:k.inputSource})}function R(){r.removeEventListener("select",D),r.removeEventListener("selectstart",D),r.removeEventListener("selectend",D),r.removeEventListener("squeeze",D),r.removeEventListener("squeezestart",D),r.removeEventListener("squeezeend",D),r.removeEventListener("end",R),r.removeEventListener("inputsourceschange",L);for(let k=0;k<g.length;k++){let X=y[k];X!==null&&(y[k]=null,g[k].disconnect(X))}C=null,A=null,e.setRenderTarget(v),d=null,h=null,u=null,r=null,m=null,U.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(k){n=k,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(k){a=k,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||s},this.setReferenceSpace=function(k){l=k},this.getBaseLayer=function(){return h!==null?h:d},this.getBinding=function(){return u},this.getFrame=function(){return f},this.getSession=function(){return r},this.setSession=async function(k){if(r=k,r!==null){if(v=e.getRenderTarget(),r.addEventListener("select",D),r.addEventListener("selectstart",D),r.addEventListener("selectend",D),r.addEventListener("squeeze",D),r.addEventListener("squeezestart",D),r.addEventListener("squeezeend",D),r.addEventListener("end",R),r.addEventListener("inputsourceschange",L),p.xrCompatible!==!0&&await t.makeXRCompatible(),r.renderState.layers===void 0||e.capabilities.isWebGL2===!1){let X={antialias:r.renderState.layers===void 0?p.antialias:!0,alpha:p.alpha,depth:p.depth,stencil:p.stencil,framebufferScaleFactor:n};d=new XRWebGLLayer(r,t,X),r.updateRenderState({baseLayer:d}),m=new Ni(d.framebufferWidth,d.framebufferHeight,{format:Lr,type:ca,encoding:e.outputEncoding,stencilBuffer:p.stencil})}else{let X=null,re=null,q=null;p.depth&&(q=p.stencil?35056:33190,X=p.stencil?Mm:am,re=p.stencil?sm:ch);let ee={colorFormat:32856,depthFormat:q,scaleFactor:n};u=new XRWebGLBinding(r,t),h=u.createProjectionLayer(ee),r.updateRenderState({layers:[h]}),m=new Ni(h.textureWidth,h.textureHeight,{format:Lr,type:ca,depthTexture:new O0(h.textureWidth,h.textureHeight,re,void 0,void 0,void 0,void 0,void 0,void 0,X),stencilBuffer:p.stencil,encoding:e.outputEncoding,samples:p.antialias?4:0});let $=e.properties.get(m);$.__ignoreDepthValues=h.ignoreDepthValues}m.isXRRenderTarget=!0,this.setFoveation(o),l=null,s=await r.requestReferenceSpace(a),U.setContext(r),U.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}};function L(k){for(let X=0;X<k.removed.length;X++){let re=k.removed[X],q=y.indexOf(re);q>=0&&(y[q]=null,g[q].disconnect(re))}for(let X=0;X<k.added.length;X++){let re=k.added[X],q=y.indexOf(re);if(q===-1){for(let $=0;$<g.length;$++)if($>=y.length){y.push(re),q=$;break}else if(y[$]===null){y[$]=re,q=$;break}if(q===-1)break}let ee=g[q];ee&&ee.connect(re)}}let O=new N,H=new N;function j(k,X,re){O.setFromMatrixPosition(X.matrixWorld),H.setFromMatrixPosition(re.matrixWorld);let q=O.distanceTo(H),ee=X.projectionMatrix.elements,$=re.projectionMatrix.elements,ne=ee[14]/(ee[10]-1),ce=ee[14]/(ee[10]+1),pe=(ee[9]+1)/ee[5],ge=(ee[9]-1)/ee[5],we=(ee[8]-1)/ee[0],le=($[8]+1)/$[0],ve=ne*we,ie=ne*le,Ce=q/(-we+le),Pe=Ce*-we;X.matrixWorld.decompose(k.position,k.quaternion,k.scale),k.translateX(Pe),k.translateZ(Ce),k.matrixWorld.compose(k.position,k.quaternion,k.scale),k.matrixWorldInverse.copy(k.matrixWorld).invert();let Ne=ne+Ce,be=ce+Ce,Le=ve-Pe,Fe=ie+(q-Pe),K=pe*ce/be*Ne,B=ge*ce/be*Ne;k.projectionMatrix.makePerspective(Le,Fe,K,B,Ne,be)}function Y(k,X){X===null?k.matrixWorld.copy(k.matrix):k.matrixWorld.multiplyMatrices(X.matrixWorld,k.matrix),k.matrixWorldInverse.copy(k.matrixWorld).invert()}this.updateCamera=function(k){if(r===null)return;E.near=S.near=M.near=k.near,E.far=S.far=M.far=k.far,(C!==E.near||A!==E.far)&&(r.updateRenderState({depthNear:E.near,depthFar:E.far}),C=E.near,A=E.far);let X=k.parent,re=E.cameras;Y(E,X);for(let ee=0;ee<re.length;ee++)Y(re[ee],X);E.matrixWorld.decompose(E.position,E.quaternion,E.scale),k.matrix.copy(E.matrix),k.matrix.decompose(k.position,k.quaternion,k.scale);let q=k.children;for(let ee=0,$=q.length;ee<$;ee++)q[ee].updateMatrixWorld(!0);re.length===2?j(E,M,S):E.projectionMatrix.copy(M.projectionMatrix)},this.getCamera=function(){return E},this.getFoveation=function(){if(!(h===null&&d===null))return o},this.setFoveation=function(k){o=k,h!==null&&(h.fixedFoveation=k),d!==null&&d.fixedFoveation!==void 0&&(d.fixedFoveation=k)},this.getPlanes=function(){return x};let z=null;function V(k,X){if(c=X.getViewerPose(l||s),f=X,c!==null){let re=c.views;d!==null&&(e.setRenderTargetFramebuffer(m,d.framebuffer),e.setRenderTarget(m));let q=!1;re.length!==E.cameras.length&&(E.cameras.length=0,q=!0);for(let ee=0;ee<re.length;ee++){let $=re[ee],ne=null;if(d!==null)ne=d.getViewport($);else{let pe=u.getViewSubImage(h,$);ne=pe.viewport,ee===0&&(e.setRenderTargetTextures(m,pe.colorTexture,h.ignoreDepthValues?void 0:pe.depthStencilTexture),e.setRenderTarget(m))}let ce=T[ee];ce===void 0&&(ce=new ta,ce.layers.enable(ee),ce.viewport=new ai,T[ee]=ce),ce.matrix.fromArray($.transform.matrix),ce.projectionMatrix.fromArray($.projectionMatrix),ce.viewport.set(ne.x,ne.y,ne.width,ne.height),ee===0&&E.matrix.copy(ce.matrix),q===!0&&E.cameras.push(ce)}}for(let re=0;re<g.length;re++){let q=y[re],ee=g[re];q!==null&&ee!==void 0&&ee.update(q,X,l||s)}if(z&&z(k,X),X.detectedPlanes){i.dispatchEvent({type:"planesdetected",data:X.detectedPlanes});let re=null;for(let q of x)X.detectedPlanes.has(q)||(re===null&&(re=[]),re.push(q));if(re!==null)for(let q of re)x.delete(q),_.delete(q),i.dispatchEvent({type:"planeremoved",data:q});for(let q of X.detectedPlanes)if(!x.has(q))x.add(q),_.set(q,X.lastChangedTime),i.dispatchEvent({type:"planeadded",data:q});else{let ee=_.get(q);q.lastChangedTime>ee&&(_.set(q,q.lastChangedTime),i.dispatchEvent({type:"planechanged",data:q}))}}f=null}let U=new VJ;U.setAnimationLoop(V),this.setAnimationLoop=function(k){z=k},this.dispose=function(){}}};function Dxe(e,t){function i(v,m){m.color.getRGB(v.fogColor.value,kJ(e)),m.isFog?(v.fogNear.value=m.near,v.fogFar.value=m.far):m.isFogExp2&&(v.fogDensity.value=m.density)}function r(v,m,g,y,x){m.isMeshBasicMaterial||m.isMeshLambertMaterial?n(v,m):m.isMeshToonMaterial?(n(v,m),u(v,m)):m.isMeshPhongMaterial?(n(v,m),c(v,m)):m.isMeshStandardMaterial?(n(v,m),h(v,m),m.isMeshPhysicalMaterial&&d(v,m,x)):m.isMeshMatcapMaterial?(n(v,m),f(v,m)):m.isMeshDepthMaterial?n(v,m):m.isMeshDistanceMaterial?(n(v,m),p(v,m)):m.isMeshNormalMaterial?n(v,m):m.isLineBasicMaterial?(s(v,m),m.isLineDashedMaterial&&a(v,m)):m.isPointsMaterial?o(v,m,g,y):m.isSpriteMaterial?l(v,m):m.isShadowMaterial?(v.color.value.copy(m.color),v.opacity.value=m.opacity):m.isShaderMaterial&&(m.uniformsNeedUpdate=!1)}function n(v,m){v.opacity.value=m.opacity,m.color&&v.diffuse.value.copy(m.color),m.emissive&&v.emissive.value.copy(m.emissive).multiplyScalar(m.emissiveIntensity),m.map&&(v.map.value=m.map),m.alphaMap&&(v.alphaMap.value=m.alphaMap),m.bumpMap&&(v.bumpMap.value=m.bumpMap,v.bumpScale.value=m.bumpScale,m.side===ms&&(v.bumpScale.value*=-1)),m.displacementMap&&(v.displacementMap.value=m.displacementMap,v.displacementScale.value=m.displacementScale,v.displacementBias.value=m.displacementBias),m.emissiveMap&&(v.emissiveMap.value=m.emissiveMap),m.normalMap&&(v.normalMap.value=m.normalMap,v.normalScale.value.copy(m.normalScale),m.side===ms&&v.normalScale.value.negate()),m.specularMap&&(v.specularMap.value=m.specularMap),m.alphaTest>0&&(v.alphaTest.value=m.alphaTest);let g=t.get(m).envMap;if(g&&(v.envMap.value=g,v.flipEnvMap.value=g.isCubeTexture&&g.isRenderTargetTexture===!1?-1:1,v.reflectivity.value=m.reflectivity,v.ior.value=m.ior,v.refractionRatio.value=m.refractionRatio),m.lightMap){v.lightMap.value=m.lightMap;let _=e.physicallyCorrectLights!==!0?Math.PI:1;v.lightMapIntensity.value=m.lightMapIntensity*_}m.aoMap&&(v.aoMap.value=m.aoMap,v.aoMapIntensity.value=m.aoMapIntensity);let y;m.map?y=m.map:m.specularMap?y=m.specularMap:m.displacementMap?y=m.displacementMap:m.normalMap?y=m.normalMap:m.bumpMap?y=m.bumpMap:m.roughnessMap?y=m.roughnessMap:m.metalnessMap?y=m.metalnessMap:m.alphaMap?y=m.alphaMap:m.emissiveMap?y=m.emissiveMap:m.clearcoatMap?y=m.clearcoatMap:m.clearcoatNormalMap?y=m.clearcoatNormalMap:m.clearcoatRoughnessMap?y=m.clearcoatRoughnessMap:m.iridescenceMap?y=m.iridescenceMap:m.iridescenceThicknessMap?y=m.iridescenceThicknessMap:m.specularIntensityMap?y=m.specularIntensityMap:m.specularColorMap?y=m.specularColorMap:m.transmissionMap?y=m.transmissionMap:m.thicknessMap?y=m.thicknessMap:m.sheenColorMap?y=m.sheenColorMap:m.sheenRoughnessMap&&(y=m.sheenRoughnessMap),y!==void 0&&(y.isWebGLRenderTarget&&(y=y.texture),y.matrixAutoUpdate===!0&&y.updateMatrix(),v.uvTransform.value.copy(y.matrix));let x;m.aoMap?x=m.aoMap:m.lightMap&&(x=m.lightMap),x!==void 0&&(x.isWebGLRenderTarget&&(x=x.texture),x.matrixAutoUpdate===!0&&x.updateMatrix(),v.uv2Transform.value.copy(x.matrix))}function s(v,m){v.diffuse.value.copy(m.color),v.opacity.value=m.opacity}function a(v,m){v.dashSize.value=m.dashSize,v.totalSize.value=m.dashSize+m.gapSize,v.scale.value=m.scale}function o(v,m,g,y){v.diffuse.value.copy(m.color),v.opacity.value=m.opacity,v.size.value=m.size*g,v.scale.value=y*.5,m.map&&(v.map.value=m.map),m.alphaMap&&(v.alphaMap.value=m.alphaMap),m.alphaTest>0&&(v.alphaTest.value=m.alphaTest);let x;m.map?x=m.map:m.alphaMap&&(x=m.alphaMap),x!==void 0&&(x.matrixAutoUpdate===!0&&x.updateMatrix(),v.uvTransform.value.copy(x.matrix))}function l(v,m){v.diffuse.value.copy(m.color),v.opacity.value=m.opacity,v.rotation.value=m.rotation,m.map&&(v.map.value=m.map),m.alphaMap&&(v.alphaMap.value=m.alphaMap),m.alphaTest>0&&(v.alphaTest.value=m.alphaTest);let g;m.map?g=m.map:m.alphaMap&&(g=m.alphaMap),g!==void 0&&(g.matrixAutoUpdate===!0&&g.updateMatrix(),v.uvTransform.value.copy(g.matrix))}function c(v,m){v.specular.value.copy(m.specular),v.shininess.value=Math.max(m.shininess,1e-4)}function u(v,m){m.gradientMap&&(v.gradientMap.value=m.gradientMap)}function h(v,m){v.roughness.value=m.roughness,v.metalness.value=m.metalness,m.roughnessMap&&(v.roughnessMap.value=m.roughnessMap),m.metalnessMap&&(v.metalnessMap.value=m.metalnessMap),t.get(m).envMap&&(v.envMapIntensity.value=m.envMapIntensity)}function d(v,m,g){v.ior.value=m.ior,m.sheen>0&&(v.sheenColor.value.copy(m.sheenColor).multiplyScalar(m.sheen),v.sheenRoughness.value=m.sheenRoughness,m.sheenColorMap&&(v.sheenColorMap.value=m.sheenColorMap),m.sheenRoughnessMap&&(v.sheenRoughnessMap.value=m.sheenRoughnessMap)),m.clearcoat>0&&(v.clearcoat.value=m.clearcoat,v.clearcoatRoughness.value=m.clearcoatRoughness,m.clearcoatMap&&(v.clearcoatMap.value=m.clearcoatMap),m.clearcoatRoughnessMap&&(v.clearcoatRoughnessMap.value=m.clearcoatRoughnessMap),m.clearcoatNormalMap&&(v.clearcoatNormalScale.value.copy(m.clearcoatNormalScale),v.clearcoatNormalMap.value=m.clearcoatNormalMap,m.side===ms&&v.clearcoatNormalScale.value.negate())),m.iridescence>0&&(v.iridescence.value=m.iridescence,v.iridescenceIOR.value=m.iridescenceIOR,v.iridescenceThicknessMinimum.value=m.iridescenceThicknessRange[0],v.iridescenceThicknessMaximum.value=m.iridescenceThicknessRange[1],m.iridescenceMap&&(v.iridescenceMap.value=m.iridescenceMap),m.iridescenceThicknessMap&&(v.iridescenceThicknessMap.value=m.iridescenceThicknessMap)),m.transmission>0&&(v.transmission.value=m.transmission,v.transmissionSamplerMap.value=g.texture,v.transmissionSamplerSize.value.set(g.width,g.height),m.transmissionMap&&(v.transmissionMap.value=m.transmissionMap),v.thickness.value=m.thickness,m.thicknessMap&&(v.thicknessMap.value=m.thicknessMap),v.attenuationDistance.value=m.attenuationDistance,v.attenuationColor.value.copy(m.attenuationColor)),v.specularIntensity.value=m.specularIntensity,v.specularColor.value.copy(m.specularColor),m.specularIntensityMap&&(v.specularIntensityMap.value=m.specularIntensityMap),m.specularColorMap&&(v.specularColorMap.value=m.specularColorMap)}function f(v,m){m.matcap&&(v.matcap.value=m.matcap)}function p(v,m){v.referencePosition.value.copy(m.referencePosition),v.nearDistance.value=m.nearDistance,v.farDistance.value=m.farDistance}return{refreshFogUniforms:i,refreshMaterialUniforms:r}}function Rxe(e,t,i,r){let n={},s={},a=[],o=i.isWebGL2?e.getParameter(35375):0;function l(y,x){let _=x.program;r.uniformBlockBinding(y,_)}function c(y,x){let _=n[y.id];_===void 0&&(p(y),_=u(y),n[y.id]=_,y.addEventListener("dispose",m));let M=x.program;r.updateUBOMapping(y,M);let S=t.render.frame;s[y.id]!==S&&(d(y),s[y.id]=S)}function u(y){let x=h();y.__bindingPointIndex=x;let _=e.createBuffer(),M=y.__size,S=y.usage;return e.bindBuffer(35345,_),e.bufferData(35345,M,S),e.bindBuffer(35345,null),e.bindBufferBase(35345,x,_),_}function h(){for(let y=0;y<o;y++)if(a.indexOf(y)===-1)return a.push(y),y;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function d(y){let x=n[y.id],_=y.uniforms,M=y.__cache;e.bindBuffer(35345,x);for(let S=0,T=_.length;S<T;S++){let E=_[S];if(f(E,S,M)===!0){let C=E.__offset,A=Array.isArray(E.value)?E.value:[E.value],D=0;for(let R=0;R<A.length;R++){let L=A[R],O=v(L);typeof L=="number"?(E.__data[0]=L,e.bufferSubData(35345,C+D,E.__data)):L.isMatrix3?(E.__data[0]=L.elements[0],E.__data[1]=L.elements[1],E.__data[2]=L.elements[2],E.__data[3]=L.elements[0],E.__data[4]=L.elements[3],E.__data[5]=L.elements[4],E.__data[6]=L.elements[5],E.__data[7]=L.elements[0],E.__data[8]=L.elements[6],E.__data[9]=L.elements[7],E.__data[10]=L.elements[8],E.__data[11]=L.elements[0]):(L.toArray(E.__data,D),D+=O.storage/Float32Array.BYTES_PER_ELEMENT)}e.bufferSubData(35345,C,E.__data)}}e.bindBuffer(35345,null)}function f(y,x,_){let M=y.value;if(_[x]===void 0){if(typeof M=="number")_[x]=M;else{let S=Array.isArray(M)?M:[M],T=[];for(let E=0;E<S.length;E++)T.push(S[E].clone());_[x]=T}return!0}else if(typeof M=="number"){if(_[x]!==M)return _[x]=M,!0}else{let S=Array.isArray(_[x])?_[x]:[_[x]],T=Array.isArray(M)?M:[M];for(let E=0;E<S.length;E++){let C=S[E];if(C.equals(T[E])===!1)return C.copy(T[E]),!0}}return!1}function p(y){let x=y.uniforms,_=0,M=16,S=0;for(let T=0,E=x.length;T<E;T++){let C=x[T],A={boundary:0,storage:0},D=Array.isArray(C.value)?C.value:[C.value];for(let R=0,L=D.length;R<L;R++){let O=D[R],H=v(O);A.boundary+=H.boundary,A.storage+=H.storage}if(C.__data=new Float32Array(A.storage/Float32Array.BYTES_PER_ELEMENT),C.__offset=_,T>0){S=_%M;let R=M-S;S!==0&&R-A.boundary<0&&(_+=M-S,C.__offset=_)}_+=A.storage}return S=_%M,S>0&&(_+=M-S),y.__size=_,y.__cache={},this}function v(y){let x={boundary:0,storage:0};return typeof y=="number"?(x.boundary=4,x.storage=4):y.isVector2?(x.boundary=8,x.storage=8):y.isVector3||y.isColor?(x.boundary=16,x.storage=12):y.isVector4?(x.boundary=16,x.storage=16):y.isMatrix3?(x.boundary=48,x.storage=48):y.isMatrix4?(x.boundary=64,x.storage=64):y.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",y),x}function m(y){let x=y.target;x.removeEventListener("dispose",m);let _=a.indexOf(x.__bindingPointIndex);a.splice(_,1),e.deleteBuffer(n[x.id]),delete n[x.id],delete s[x.id]}function g(){for(let y in n)e.deleteBuffer(n[y]);a=[],n={},s={}}return{bind:l,update:c,dispose:g}}function Ixe(){let e=Pw("canvas");return e.style.display="block",e}function qJ(e={}){this.isWebGLRenderer=!0;let t=e.canvas!==void 0?e.canvas:Ixe(),i=e.context!==void 0?e.context:null,r=e.depth!==void 0?e.depth:!0,n=e.stencil!==void 0?e.stencil:!0,s=e.antialias!==void 0?e.antialias:!1,a=e.premultipliedAlpha!==void 0?e.premultipliedAlpha:!0,o=e.preserveDrawingBuffer!==void 0?e.preserveDrawingBuffer:!1,l=e.powerPreference!==void 0?e.powerPreference:"default",c=e.failIfMajorPerformanceCaveat!==void 0?e.failIfMajorPerformanceCaveat:!1,u;i!==null?u=i.getContextAttributes().alpha:u=e.alpha!==void 0?e.alpha:!1;let h=null,d=null,f=[],p=[];this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=sc,this.physicallyCorrectLights=!1,this.toneMapping=Jc,this.toneMappingExposure=1;let v=this,m=!1,g=0,y=0,x=null,_=-1,M=null,S=new ai,T=new ai,E=null,C=t.width,A=t.height,D=1,R=null,L=null,O=new ai(0,0,C,A),H=new ai(0,0,C,A),j=!1,Y=new eN,z=!1,V=!1,U=null,k=new ft,X=new Me,re=new N,q={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function ee(){return x===null?D:1}let $=i;function ne(ue,Xe){for(let et=0;et<ue.length;et++){let Ge=ue[et],nt=t.getContext(Ge,Xe);if(nt!==null)return nt}return null}try{let ue={alpha:!0,depth:r,stencil:n,antialias:s,premultipliedAlpha:a,preserveDrawingBuffer:o,powerPreference:l,failIfMajorPerformanceCaveat:c};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${ny}`),t.addEventListener("webglcontextlost",it,!1),t.addEventListener("webglcontextrestored",He,!1),t.addEventListener("webglcontextcreationerror",de,!1),$===null){let Xe=["webgl2","webgl","experimental-webgl"];if(v.isWebGL1Renderer===!0&&Xe.shift(),$=ne(Xe,ue),$===null)throw ne(Xe)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}$.getShaderPrecisionFormat===void 0&&($.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(ue){throw console.error("THREE.WebGLRenderer: "+ue.message),ue}let ce,pe,ge,we,le,ve,ie,Ce,Pe,Ne,be,Le,Fe,K,B,G,oe,fe,W,Ie,Oe,Be,Re,ke;function qe(){ce=new Wye($),pe=new Nye($,ce,e),ce.init(pe),Be=new Axe($,ce,pe),ge=new Mxe($,ce,pe),we=new Yye,le=new hxe,ve=new Exe($,ce,ge,le,pe,Be,we),ie=new Vye(v),Ce=new jye(v),Pe=new rve($,pe),Re=new Fye($,ce,Pe,pe),Ne=new Xye($,Pe,we,Re),be=new Jye($,Ne,Pe,we),W=new Kye($,pe,ve),G=new kye(le),Le=new uxe(v,ie,Ce,ce,pe,Re,G),Fe=new Dxe(v,le),K=new fxe,B=new xxe(ce,pe),fe=new Bye(v,ie,Ce,ge,be,u,a),oe=new Sxe(v,be,pe),ke=new Rxe($,we,pe,ge),Ie=new Uye($,ce,we,pe),Oe=new qye($,ce,we,pe),we.programs=Le.programs,v.capabilities=pe,v.extensions=ce,v.properties=le,v.renderLists=K,v.shadowMap=oe,v.state=ge,v.info=we}qe();let Ke=new Pxe(v,$);this.xr=Ke,this.getContext=function(){return $},this.getContextAttributes=function(){return $.getContextAttributes()},this.forceContextLoss=function(){let ue=ce.get("WEBGL_lose_context");ue&&ue.loseContext()},this.forceContextRestore=function(){let ue=ce.get("WEBGL_lose_context");ue&&ue.restoreContext()},this.getPixelRatio=function(){return D},this.setPixelRatio=function(ue){ue!==void 0&&(D=ue,this.setSize(C,A,!1))},this.getSize=function(ue){return ue.set(C,A)},this.setSize=function(ue,Xe,et){if(Ke.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}C=ue,A=Xe,t.width=Math.floor(ue*D),t.height=Math.floor(Xe*D),et!==!1&&(t.style.width=ue+"px",t.style.height=Xe+"px"),this.setViewport(0,0,ue,Xe)},this.getDrawingBufferSize=function(ue){return ue.set(C*D,A*D).floor()},this.setDrawingBufferSize=function(ue,Xe,et){C=ue,A=Xe,D=et,t.width=Math.floor(ue*et),t.height=Math.floor(Xe*et),this.setViewport(0,0,ue,Xe)},this.getCurrentViewport=function(ue){return ue.copy(S)},this.getViewport=function(ue){return ue.copy(O)},this.setViewport=function(ue,Xe,et,Ge){ue.isVector4?O.set(ue.x,ue.y,ue.z,ue.w):O.set(ue,Xe,et,Ge),ge.viewport(S.copy(O).multiplyScalar(D).floor())},this.getScissor=function(ue){return ue.copy(H)},this.setScissor=function(ue,Xe,et,Ge){ue.isVector4?H.set(ue.x,ue.y,ue.z,ue.w):H.set(ue,Xe,et,Ge),ge.scissor(T.copy(H).multiplyScalar(D).floor())},this.getScissorTest=function(){return j},this.setScissorTest=function(ue){ge.setScissorTest(j=ue)},this.setOpaqueSort=function(ue){R=ue},this.setTransparentSort=function(ue){L=ue},this.getClearColor=function(ue){return ue.copy(fe.getClearColor())},this.setClearColor=function(){fe.setClearColor.apply(fe,arguments)},this.getClearAlpha=function(){return fe.getClearAlpha()},this.setClearAlpha=function(){fe.setClearAlpha.apply(fe,arguments)},this.clear=function(ue=!0,Xe=!0,et=!0){let Ge=0;ue&&(Ge|=16384),Xe&&(Ge|=256),et&&(Ge|=1024),$.clear(Ge)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",it,!1),t.removeEventListener("webglcontextrestored",He,!1),t.removeEventListener("webglcontextcreationerror",de,!1),K.dispose(),B.dispose(),le.dispose(),ie.dispose(),Ce.dispose(),be.dispose(),Re.dispose(),ke.dispose(),Le.dispose(),Ke.dispose(),Ke.removeEventListener("sessionstart",ze),Ke.removeEventListener("sessionend",Ze),U&&(U.dispose(),U=null),Je.stop()};function it(ue){ue.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),m=!0}function He(){console.log("THREE.WebGLRenderer: Context Restored."),m=!1;let ue=we.autoReset,Xe=oe.enabled,et=oe.autoUpdate,Ge=oe.needsUpdate,nt=oe.type;qe(),we.autoReset=ue,oe.enabled=Xe,oe.autoUpdate=et,oe.needsUpdate=Ge,oe.type=nt}function de(ue){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",ue.statusMessage)}function We(ue){let Xe=ue.target;Xe.removeEventListener("dispose",We),dt(Xe)}function dt(ue){J(ue),le.remove(ue)}function J(ue){let Xe=le.get(ue).programs;Xe!==void 0&&(Xe.forEach(function(et){Le.releaseProgram(et)}),ue.isShaderMaterial&&Le.releaseShaderCache(ue))}this.renderBufferDirect=function(ue,Xe,et,Ge,nt,It){Xe===null&&(Xe=q);let jt=nt.isMesh&&nt.matrixWorld.determinant()<0,Jt=xn(ue,Xe,et,Ge,nt);ge.setMaterial(Ge,jt);let Vt=et.index,Ei=1;Ge.wireframe===!0&&(Vt=Ne.getWireframeAttribute(et),Ei=2);let li=et.drawRange,fi=et.attributes.position,si=li.start*Ei,se=(li.start+li.count)*Ei;It!==null&&(si=Math.max(si,It.start*Ei),se=Math.min(se,(It.start+It.count)*Ei)),Vt!==null?(si=Math.max(si,0),se=Math.min(se,Vt.count)):fi!=null&&(si=Math.max(si,0),se=Math.min(se,fi.count));let Ue=se-si;if(Ue<0||Ue===1/0)return;Re.setup(nt,Ge,Jt,et,Vt);let Qe,Ae=Ie;if(Vt!==null&&(Qe=Pe.get(Vt),Ae=Oe,Ae.setIndex(Qe)),nt.isMesh)Ge.wireframe===!0?(ge.setLineWidth(Ge.wireframeLinewidth*ee()),Ae.setMode(1)):Ae.setMode(4);else if(nt.isLine){let De=Ge.linewidth;De===void 0&&(De=1),ge.setLineWidth(De*ee()),nt.isLineSegments?Ae.setMode(1):nt.isLineLoop?Ae.setMode(2):Ae.setMode(3)}else nt.isPoints?Ae.setMode(0):nt.isSprite&&Ae.setMode(4);if(nt.isInstancedMesh)Ae.renderInstances(si,Ue,nt.count);else if(et.isInstancedBufferGeometry){let De=et._maxInstanceCount!==void 0?et._maxInstanceCount:1/0,pt=Math.min(et.instanceCount,De);Ae.renderInstances(si,Ue,pt)}else Ae.render(si,Ue)},this.compile=function(ue,Xe){function et(Ge,nt,It){Ge.transparent===!0&&Ge.side===na&&Ge.forceSinglePass===!1?(Ge.side=ms,Ge.needsUpdate=!0,hi(Ge,nt,It),Ge.side=nc,Ge.needsUpdate=!0,hi(Ge,nt,It),Ge.side=na):hi(Ge,nt,It)}d=B.get(ue),d.init(),p.push(d),ue.traverseVisible(function(Ge){Ge.isLight&&Ge.layers.test(Xe.layers)&&(d.pushLight(Ge),Ge.castShadow&&d.pushShadow(Ge))}),d.setupLights(v.physicallyCorrectLights),ue.traverse(function(Ge){let nt=Ge.material;if(nt)if(Array.isArray(nt))for(let It=0;It<nt.length;It++){let jt=nt[It];et(jt,ue,Ge)}else et(nt,ue,Ge)}),p.pop(),d=null};let xe=null;function me(ue){xe&&xe(ue)}function ze(){Je.stop()}function Ze(){Je.start()}let Je=new VJ;Je.setAnimationLoop(me),typeof self<"u"&&Je.setContext(self),this.setAnimationLoop=function(ue){xe=ue,Ke.setAnimationLoop(ue),ue===null?Je.stop():Je.start()},Ke.addEventListener("sessionstart",ze),Ke.addEventListener("sessionend",Ze),this.render=function(ue,Xe){if(Xe!==void 0&&Xe.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(m===!0)return;ue.matrixWorldAutoUpdate===!0&&ue.updateMatrixWorld(),Xe.parent===null&&Xe.matrixWorldAutoUpdate===!0&&Xe.updateMatrixWorld(),Ke.enabled===!0&&Ke.isPresenting===!0&&(Ke.cameraAutoUpdate===!0&&Ke.updateCamera(Xe),Xe=Ke.getCamera()),ue.isScene===!0&&ue.onBeforeRender(v,ue,Xe,x),d=B.get(ue,p.length),d.init(),p.push(d),k.multiplyMatrices(Xe.projectionMatrix,Xe.matrixWorldInverse),Y.setFromProjectionMatrix(k),V=this.localClippingEnabled,z=G.init(this.clippingPlanes,V),h=K.get(ue,f.length),h.init(),f.push(h),mt(ue,Xe,0,v.sortObjects),h.finish(),v.sortObjects===!0&&h.sort(R,L),z===!0&&G.beginShadows();let et=d.state.shadowsArray;if(oe.render(et,ue,Xe),z===!0&&G.endShadows(),this.info.autoReset===!0&&this.info.reset(),fe.render(h,ue),d.setupLights(v.physicallyCorrectLights),Xe.isArrayCamera){let Ge=Xe.cameras;for(let nt=0,It=Ge.length;nt<It;nt++){let jt=Ge[nt];St(h,ue,jt,jt.viewport)}}else St(h,ue,Xe);x!==null&&(ve.updateMultisampleRenderTarget(x),ve.updateRenderTargetMipmap(x)),ue.isScene===!0&&ue.onAfterRender(v,ue,Xe),Re.resetDefaultState(),_=-1,M=null,p.pop(),p.length>0?d=p[p.length-1]:d=null,f.pop(),f.length>0?h=f[f.length-1]:h=null};function mt(ue,Xe,et,Ge){if(ue.visible===!1)return;if(ue.layers.test(Xe.layers)){if(ue.isGroup)et=ue.renderOrder;else if(ue.isLOD)ue.autoUpdate===!0&&ue.update(Xe);else if(ue.isLight)d.pushLight(ue),ue.castShadow&&d.pushShadow(ue);else if(ue.isSprite){if(!ue.frustumCulled||Y.intersectsSprite(ue)){Ge&&re.setFromMatrixPosition(ue.matrixWorld).applyMatrix4(k);let It=be.update(ue),jt=ue.material;jt.visible&&h.push(ue,It,jt,et,re.z,null)}}else if((ue.isMesh||ue.isLine||ue.isPoints)&&(ue.isSkinnedMesh&&ue.skeleton.frame!==we.render.frame&&(ue.skeleton.update(),ue.skeleton.frame=we.render.frame),!ue.frustumCulled||Y.intersectsObject(ue))){Ge&&re.setFromMatrixPosition(ue.matrixWorld).applyMatrix4(k);let It=be.update(ue),jt=ue.material;if(Array.isArray(jt)){let Jt=It.groups;for(let Vt=0,Ei=Jt.length;Vt<Ei;Vt++){let li=Jt[Vt],fi=jt[li.materialIndex];fi&&fi.visible&&h.push(ue,It,fi,et,re.z,li)}}else jt.visible&&h.push(ue,It,jt,et,re.z,null)}}let nt=ue.children;for(let It=0,jt=nt.length;It<jt;It++)mt(nt[It],Xe,et,Ge)}function St(ue,Xe,et,Ge){let nt=ue.opaque,It=ue.transmissive,jt=ue.transparent;d.setupLightsView(et),z===!0&&G.setGlobalState(v.clippingPlanes,et),It.length>0&&Mt(nt,Xe,et),Ge&&ge.viewport(S.copy(Ge)),nt.length>0&&vt(nt,Xe,et),It.length>0&&vt(It,Xe,et),jt.length>0&&vt(jt,Xe,et),ge.buffers.depth.setTest(!0),ge.buffers.depth.setMask(!0),ge.buffers.color.setMask(!0),ge.setPolygonOffset(!1)}function Mt(ue,Xe,et){let Ge=pe.isWebGL2;U===null&&(U=new Ni(1,1,{generateMipmaps:!0,type:ce.has("EXT_color_buffer_half_float")?Th:ca,minFilter:I0,samples:Ge&&s===!0?4:0})),v.getDrawingBufferSize(X),Ge?U.setSize(X.x,X.y):U.setSize(lA(X.x),lA(X.y));let nt=v.getRenderTarget();v.setRenderTarget(U),v.clear();let It=v.toneMapping;v.toneMapping=Jc,vt(ue,Xe,et),v.toneMapping=It,ve.updateMultisampleRenderTarget(U),ve.updateRenderTargetMipmap(U),v.setRenderTarget(nt)}function vt(ue,Xe,et){let Ge=Xe.isScene===!0?Xe.overrideMaterial:null;for(let nt=0,It=ue.length;nt<It;nt++){let jt=ue[nt],Jt=jt.object,Vt=jt.geometry,Ei=Ge===null?jt.material:Ge,li=jt.group;Jt.layers.test(et.layers)&&ui(Jt,Xe,et,Vt,Ei,li)}}function ui(ue,Xe,et,Ge,nt,It){ue.onBeforeRender(v,Xe,et,Ge,nt,It),ue.modelViewMatrix.multiplyMatrices(et.matrixWorldInverse,ue.matrixWorld),ue.normalMatrix.getNormalMatrix(ue.modelViewMatrix),nt.onBeforeRender(v,Xe,et,Ge,ue,It),nt.transparent===!0&&nt.side===na&&nt.forceSinglePass===!1?(nt.side=ms,nt.needsUpdate=!0,v.renderBufferDirect(et,Xe,Ge,nt,ue,It),nt.side=nc,nt.needsUpdate=!0,v.renderBufferDirect(et,Xe,Ge,nt,ue,It),nt.side=na):v.renderBufferDirect(et,Xe,Ge,nt,ue,It),ue.onAfterRender(v,Xe,et,Ge,nt,It)}function hi(ue,Xe,et){Xe.isScene!==!0&&(Xe=q);let Ge=le.get(ue),nt=d.state.lights,It=d.state.shadowsArray,jt=nt.state.version,Jt=Le.getParameters(ue,nt.state,It,Xe,et),Vt=Le.getProgramCacheKey(Jt),Ei=Ge.programs;Ge.environment=ue.isMeshStandardMaterial?Xe.environment:null,Ge.fog=Xe.fog,Ge.envMap=(ue.isMeshStandardMaterial?Ce:ie).get(ue.envMap||Ge.environment),Ei===void 0&&(ue.addEventListener("dispose",We),Ei=new Map,Ge.programs=Ei);let li=Ei.get(Vt);if(li!==void 0){if(Ge.currentProgram===li&&Ge.lightsStateVersion===jt)return $i(ue,Jt),li}else Jt.uniforms=Le.getUniforms(ue),ue.onBuild(et,Jt,v),ue.onBeforeCompile(Jt,v),li=Le.acquireProgram(Jt,Vt),Ei.set(Vt,li),Ge.uniforms=Jt.uniforms;let fi=Ge.uniforms;(!ue.isShaderMaterial&&!ue.isRawShaderMaterial||ue.clipping===!0)&&(fi.clippingPlanes=G.uniform),$i(ue,Jt),Ge.needsLights=zr(ue),Ge.lightsStateVersion=jt,Ge.needsLights&&(fi.ambientLightColor.value=nt.state.ambient,fi.lightProbe.value=nt.state.probe,fi.directionalLights.value=nt.state.directional,fi.directionalLightShadows.value=nt.state.directionalShadow,fi.spotLights.value=nt.state.spot,fi.spotLightShadows.value=nt.state.spotShadow,fi.rectAreaLights.value=nt.state.rectArea,fi.ltc_1.value=nt.state.rectAreaLTC1,fi.ltc_2.value=nt.state.rectAreaLTC2,fi.pointLights.value=nt.state.point,fi.pointLightShadows.value=nt.state.pointShadow,fi.hemisphereLights.value=nt.state.hemi,fi.directionalShadowMap.value=nt.state.directionalShadowMap,fi.directionalShadowMatrix.value=nt.state.directionalShadowMatrix,fi.spotShadowMap.value=nt.state.spotShadowMap,fi.spotLightMatrix.value=nt.state.spotLightMatrix,fi.spotLightMap.value=nt.state.spotLightMap,fi.pointShadowMap.value=nt.state.pointShadowMap,fi.pointShadowMatrix.value=nt.state.pointShadowMatrix);let si=li.getUniforms(),se=$E.seqWithValue(si.seq,fi);return Ge.currentProgram=li,Ge.uniformsList=se,li}function $i(ue,Xe){let et=le.get(ue);et.outputEncoding=Xe.outputEncoding,et.instancing=Xe.instancing,et.skinning=Xe.skinning,et.morphTargets=Xe.morphTargets,et.morphNormals=Xe.morphNormals,et.morphColors=Xe.morphColors,et.morphTargetsCount=Xe.morphTargetsCount,et.numClippingPlanes=Xe.numClippingPlanes,et.numIntersection=Xe.numClipIntersection,et.vertexAlphas=Xe.vertexAlphas,et.vertexTangents=Xe.vertexTangents,et.toneMapping=Xe.toneMapping}function xn(ue,Xe,et,Ge,nt){Xe.isScene!==!0&&(Xe=q),ve.resetTextureUnits();let It=Xe.fog,jt=Ge.isMeshStandardMaterial?Xe.environment:null,Jt=x===null?v.outputEncoding:x.isXRRenderTarget===!0?x.texture.encoding:sc,Vt=(Ge.isMeshStandardMaterial?Ce:ie).get(Ge.envMap||jt),Ei=Ge.vertexColors===!0&&!!et.attributes.color&&et.attributes.color.itemSize===4,li=!!Ge.normalMap&&!!et.attributes.tangent,fi=!!et.morphAttributes.position,si=!!et.morphAttributes.normal,se=!!et.morphAttributes.color,Ue=Ge.toneMapped?v.toneMapping:Jc,Qe=et.morphAttributes.position||et.morphAttributes.normal||et.morphAttributes.color,Ae=Qe!==void 0?Qe.length:0,De=le.get(Ge),pt=d.state.lights;if(z===!0&&(V===!0||ue!==M)){let ae=ue===M&&Ge.id===_;G.setState(Ge,ue,ae)}let lt=!1;Ge.version===De.__version?(De.needsLights&&De.lightsStateVersion!==pt.state.version||De.outputEncoding!==Jt||nt.isInstancedMesh&&De.instancing===!1||!nt.isInstancedMesh&&De.instancing===!0||nt.isSkinnedMesh&&De.skinning===!1||!nt.isSkinnedMesh&&De.skinning===!0||De.envMap!==Vt||Ge.fog===!0&&De.fog!==It||De.numClippingPlanes!==void 0&&(De.numClippingPlanes!==G.numPlanes||De.numIntersection!==G.numIntersection)||De.vertexAlphas!==Ei||De.vertexTangents!==li||De.morphTargets!==fi||De.morphNormals!==si||De.morphColors!==se||De.toneMapping!==Ue||pe.isWebGL2===!0&&De.morphTargetsCount!==Ae)&&(lt=!0):(lt=!0,De.__version=Ge.version);let bt=De.currentProgram;lt===!0&&(bt=hi(Ge,Xe,nt));let Et=!1,Ft=!1,zt=!1,Q=bt.getUniforms(),te=De.uniforms;if(ge.useProgram(bt.program)&&(Et=!0,Ft=!0,zt=!0),Ge.id!==_&&(_=Ge.id,Ft=!0),Et||M!==ue){if(Q.setValue($,"projectionMatrix",ue.projectionMatrix),pe.logarithmicDepthBuffer&&Q.setValue($,"logDepthBufFC",2/(Math.log(ue.far+1)/Math.LN2)),M!==ue&&(M=ue,Ft=!0,zt=!0),Ge.isShaderMaterial||Ge.isMeshPhongMaterial||Ge.isMeshToonMaterial||Ge.isMeshStandardMaterial||Ge.envMap){let ae=Q.map.cameraPosition;ae!==void 0&&ae.setValue($,re.setFromMatrixPosition(ue.matrixWorld))}(Ge.isMeshPhongMaterial||Ge.isMeshToonMaterial||Ge.isMeshLambertMaterial||Ge.isMeshBasicMaterial||Ge.isMeshStandardMaterial||Ge.isShaderMaterial)&&Q.setValue($,"isOrthographic",ue.isOrthographicCamera===!0),(Ge.isMeshPhongMaterial||Ge.isMeshToonMaterial||Ge.isMeshLambertMaterial||Ge.isMeshBasicMaterial||Ge.isMeshStandardMaterial||Ge.isShaderMaterial||Ge.isShadowMaterial||nt.isSkinnedMesh)&&Q.setValue($,"viewMatrix",ue.matrixWorldInverse)}if(nt.isSkinnedMesh){Q.setOptional($,nt,"bindMatrix"),Q.setOptional($,nt,"bindMatrixInverse");let ae=nt.skeleton;ae&&(pe.floatVertexTextures?(ae.boneTexture===null&&ae.computeBoneTexture(),Q.setValue($,"boneTexture",ae.boneTexture,ve),Q.setValue($,"boneTextureSize",ae.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}let ye=et.morphAttributes;if((ye.position!==void 0||ye.normal!==void 0||ye.color!==void 0&&pe.isWebGL2===!0)&&W.update(nt,et,Ge,bt),(Ft||De.receiveShadow!==nt.receiveShadow)&&(De.receiveShadow=nt.receiveShadow,Q.setValue($,"receiveShadow",nt.receiveShadow)),Ge.isMeshGouraudMaterial&&Ge.envMap!==null&&(te.envMap.value=Vt,te.flipEnvMap.value=Vt.isCubeTexture&&Vt.isRenderTargetTexture===!1?-1:1),Ft&&(Q.setValue($,"toneMappingExposure",v.toneMappingExposure),De.needsLights&&Or(te,zt),It&&Ge.fog===!0&&Fe.refreshFogUniforms(te,It),Fe.refreshMaterialUniforms(te,Ge,D,A,U),$E.upload($,De.uniformsList,te,ve)),Ge.isShaderMaterial&&Ge.uniformsNeedUpdate===!0&&($E.upload($,De.uniformsList,te,ve),Ge.uniformsNeedUpdate=!1),Ge.isSpriteMaterial&&Q.setValue($,"center",nt.center),Q.setValue($,"modelViewMatrix",nt.modelViewMatrix),Q.setValue($,"normalMatrix",nt.normalMatrix),Q.setValue($,"modelMatrix",nt.matrixWorld),nt.previousModelViewMatrix&&Q.setValue($,"previousModelViewMatrix",nt.previousModelViewMatrix),ue.previousProjectionMatrix&&Q.setValue($,"previousProjectionMatrix",ue.previousProjectionMatrix),Ge.isShaderMaterial||Ge.isRawShaderMaterial){let ae=Ge.uniformsGroups;for(let Ee=0,rt=ae.length;Ee<rt;Ee++)if(pe.isWebGL2){let Ct=ae[Ee];ke.update(Ct,bt),ke.bind(Ct,bt)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return bt}function Or(ue,Xe){ue.ambientLightColor.needsUpdate=Xe,ue.lightProbe.needsUpdate=Xe,ue.directionalLights.needsUpdate=Xe,ue.directionalLightShadows.needsUpdate=Xe,ue.pointLights.needsUpdate=Xe,ue.pointLightShadows.needsUpdate=Xe,ue.spotLights.needsUpdate=Xe,ue.spotLightShadows.needsUpdate=Xe,ue.rectAreaLights.needsUpdate=Xe,ue.hemisphereLights.needsUpdate=Xe}function zr(ue){return ue.isMeshLambertMaterial||ue.isMeshToonMaterial||ue.isMeshPhongMaterial||ue.isMeshStandardMaterial||ue.isShadowMaterial||ue.isShaderMaterial&&ue.lights===!0}this.getActiveCubeFace=function(){return g},this.getActiveMipmapLevel=function(){return y},this.getRenderTarget=function(){return x},this.setRenderTargetTextures=function(ue,Xe,et){le.get(ue.texture).__webglTexture=Xe,le.get(ue.depthTexture).__webglTexture=et;let Ge=le.get(ue);Ge.__hasExternalTextures=!0,Ge.__hasExternalTextures&&(Ge.__autoAllocateDepthBuffer=et===void 0,Ge.__autoAllocateDepthBuffer||ce.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),Ge.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(ue,Xe){let et=le.get(ue);et.__webglFramebuffer=Xe,et.__useDefaultFramebuffer=Xe===void 0},this.setRenderTarget=function(ue,Xe=0,et=0){x=ue,g=Xe,y=et;let Ge=!0,nt=null,It=!1,jt=!1;if(ue){let Jt=le.get(ue);Jt.__useDefaultFramebuffer!==void 0?(ge.bindFramebuffer(36160,null),Ge=!1):Jt.__webglFramebuffer===void 0?ve.setupRenderTarget(ue):Jt.__hasExternalTextures&&ve.rebindTextures(ue,le.get(ue.texture).__webglTexture,le.get(ue.depthTexture).__webglTexture);let Vt=ue.texture;(Vt.isData3DTexture||Vt.isDataArrayTexture||Vt.isCompressedArrayTexture)&&(jt=!0);let Ei=le.get(ue).__webglFramebuffer;ue.isWebGLCubeRenderTarget?(nt=Ei[Xe],It=!0):pe.isWebGL2&&ue.samples>0&&ve.useMultisampledRTT(ue)===!1?nt=le.get(ue).__webglMultisampledFramebuffer:nt=Ei,S.copy(ue.viewport),T.copy(ue.scissor),E=ue.scissorTest}else S.copy(O).multiplyScalar(D).floor(),T.copy(H).multiplyScalar(D).floor(),E=j;if(ge.bindFramebuffer(36160,nt)&&pe.drawBuffers&&Ge&&ge.drawBuffers(ue,nt),ge.viewport(S),ge.scissor(T),ge.setScissorTest(E),It){let Jt=le.get(ue.texture);$.framebufferTexture2D(36160,36064,34069+Xe,Jt.__webglTexture,et)}else if(jt){let Jt=le.get(ue.texture),Vt=Xe||0;$.framebufferTextureLayer(36160,36064,Jt.__webglTexture,et||0,Vt)}_=-1},this.readRenderTargetPixels=function(ue,Xe,et,Ge,nt,It,jt){if(!(ue&&ue.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let Jt=le.get(ue).__webglFramebuffer;if(ue.isWebGLCubeRenderTarget&&jt!==void 0&&(Jt=Jt[jt]),Jt){ge.bindFramebuffer(36160,Jt);try{let Vt=ue.texture,Ei=Vt.format,li=Vt.type;if(Ei!==Lr&&Be.convert(Ei)!==$.getParameter(35739)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}let fi=li===Th&&(ce.has("EXT_color_buffer_half_float")||pe.isWebGL2&&ce.has("EXT_color_buffer_float"));if(li!==ca&&Be.convert(li)!==$.getParameter(35738)&&!(li===or&&(pe.isWebGL2||ce.has("OES_texture_float")||ce.has("WEBGL_color_buffer_float")))&&!fi){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}Xe>=0&&Xe<=ue.width-Ge&&et>=0&&et<=ue.height-nt&&$.readPixels(Xe,et,Ge,nt,Be.convert(Ei),Be.convert(li),It)}finally{let Vt=x!==null?le.get(x).__webglFramebuffer:null;ge.bindFramebuffer(36160,Vt)}}},this.readRenderTargetPixelsAsync=async function(ue,Xe,et,Ge,nt,It,jt){if(!(ue&&ue.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let Jt=le.get(ue).__webglFramebuffer;if(ue.isWebGLCubeRenderTarget&&jt!==void 0&&(Jt=Jt[jt]),Jt){let Vt=ue.texture,Ei=Vt.format,li=Vt.type;if(Xe>=0&&Xe<=ue.width-Ge&&et>=0&&et<=ue.height-nt){ge.bindFramebuffer($.FRAMEBUFFER,Jt);let fi=$.createBuffer();$.bindBuffer($.PIXEL_PACK_BUFFER,fi),$.bufferData($.PIXEL_PACK_BUFFER,It.byteLength,$.STREAM_READ),$.readPixels(Xe,et,Ge,nt,Be.convert(Ei),Be.convert(li),0);let si=x!==null?le.get(x).__webglFramebuffer:null;ge.bindFramebuffer($.FRAMEBUFFER,si);let se=$.fenceSync($.SYNC_GPU_COMMANDS_COMPLETE,0);return $.flush(),await Fge($,se,4),$.bindBuffer($.PIXEL_PACK_BUFFER,fi),$.getBufferSubData($.PIXEL_PACK_BUFFER,0,It),$.deleteBuffer(fi),$.deleteSync(se),It}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")}},this.copyFramebufferToTexture=function(ue,Xe,et=0){let Ge=Math.pow(2,-et),nt=Math.floor(Xe.image.width*Ge),It=Math.floor(Xe.image.height*Ge);ve.setTexture2D(Xe,0),$.copyTexSubImage2D(3553,et,0,0,ue.x,ue.y,nt,It),ge.unbindTexture()},this.copyTextureToTexture=function(ue,Xe,et,Ge=0){let nt=Xe.image.width,It=Xe.image.height,jt=Be.convert(et.format),Jt=Be.convert(et.type);ve.setTexture2D(et,0),$.pixelStorei(37440,et.flipY),$.pixelStorei(37441,et.premultiplyAlpha),$.pixelStorei(3317,et.unpackAlignment),Xe.isDataTexture?$.texSubImage2D(3553,Ge,ue.x,ue.y,nt,It,jt,Jt,Xe.image.data):Xe.isCompressedTexture?$.compressedTexSubImage2D(3553,Ge,ue.x,ue.y,Xe.mipmaps[0].width,Xe.mipmaps[0].height,jt,Xe.mipmaps[0].data):$.texSubImage2D(3553,Ge,ue.x,ue.y,jt,Jt,Xe.image),Ge===0&&et.generateMipmaps&&$.generateMipmap(3553),ge.unbindTexture()},this.copyTextureToTexture3D=function(ue,Xe,et,Ge,nt=0){if(v.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}let It=ue.max.x-ue.min.x+1,jt=ue.max.y-ue.min.y+1,Jt=ue.max.z-ue.min.z+1,Vt=Be.convert(Ge.format),Ei=Be.convert(Ge.type),li;if(Ge.isData3DTexture)ve.setTexture3D(Ge,0),li=32879;else if(Ge.isDataArrayTexture)ve.setTexture2DArray(Ge,0),li=35866;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}$.pixelStorei(37440,Ge.flipY),$.pixelStorei(37441,Ge.premultiplyAlpha),$.pixelStorei(3317,Ge.unpackAlignment);let fi=$.getParameter(3314),si=$.getParameter(32878),se=$.getParameter(3316),Ue=$.getParameter(3315),Qe=$.getParameter(32877),Ae=et.isCompressedTexture?et.mipmaps[0]:et.image;$.pixelStorei(3314,Ae.width),$.pixelStorei(32878,Ae.height),$.pixelStorei(3316,ue.min.x),$.pixelStorei(3315,ue.min.y),$.pixelStorei(32877,ue.min.z),et.isDataTexture||et.isData3DTexture?$.texSubImage3D(li,nt,Xe.x,Xe.y,Xe.z,It,jt,Jt,Vt,Ei,Ae.data):et.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),$.compressedTexSubImage3D(li,nt,Xe.x,Xe.y,Xe.z,It,jt,Jt,Vt,Ae.data)):$.texSubImage3D(li,nt,Xe.x,Xe.y,Xe.z,It,jt,Jt,Vt,Ei,Ae),$.pixelStorei(3314,fi),$.pixelStorei(32878,si),$.pixelStorei(3316,se),$.pixelStorei(3315,Ue),$.pixelStorei(32877,Qe),nt===0&&Ge.generateMipmaps&&$.generateMipmap(li),ge.unbindTexture()},this.initRenderTarget=function(ue){le.get(ue).__webglFramebuffer===void 0&&ve.setupRenderTarget(ue)},this.initTexture=function(ue){ue.isCubeTexture?ve.setTextureCube(ue,0):ue.isData3DTexture?ve.setTexture3D(ue,0):ue.isDataArrayTexture||ue.isCompressedArrayTexture?ve.setTexture2DArray(ue,0):ve.setTexture2D(ue,0),ge.unbindTexture()},this.resetState=function(){g=0,y=0,x=null,ge.reset(),Re.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}var Lxe=class extends qJ{};Lxe.prototype.isWebGL1Renderer=!0;var YJ=class{constructor(e,t=1,i=1e3){this.isFog=!0,this.name="",this.color=new Yt(e),this.near=t,this.far=i}clone(){return new YJ(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}},co=class extends rr{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){let t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(e){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=e}},Oxe=class{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=jO,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=gl()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,i){e*=this.stride,i*=t.stride;for(let r=0,n=this.stride;r<n;r++)this.array[e+r]=t.array[i+r];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=gl()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);let t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(t,this.stride);return i.setUsage(this.usage),i}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=gl()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}},xa=new N,QO=class{constructor(e,t,i,r=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=i,this.normalized=r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,i=this.data.count;t<i;t++)xa.fromBufferAttribute(this,t),xa.applyMatrix4(e),this.setXYZ(t,xa.x,xa.y,xa.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)xa.fromBufferAttribute(this,t),xa.applyNormalMatrix(e),this.setXYZ(t,xa.x,xa.y,xa.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)xa.fromBufferAttribute(this,t),xa.transformDirection(e),this.setXYZ(t,xa.x,xa.y,xa.z);return this}setX(e,t){return this.normalized&&(t=vr(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=vr(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=vr(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=vr(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=uh(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=uh(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=uh(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=uh(t,this.array)),t}setXY(e,t,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=vr(t,this.array),i=vr(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this}setXYZ(e,t,i,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=vr(t,this.array),i=vr(i,this.array),r=vr(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this}setXYZW(e,t,i,r,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=vr(t,this.array),i=vr(i,this.array),r=vr(r,this.array),n=vr(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this.data.array[e+3]=n,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");let t=[];for(let i=0;i<this.count;i++){let r=i*this.data.stride+this.offset;for(let n=0;n<this.itemSize;n++)t.push(this.data.array[r+n])}return new Qt(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new QO(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");let t=[];for(let i=0;i<this.count;i++){let r=i*this.data.stride+this.offset;for(let n=0;n<this.itemSize;n++)t.push(this.data.array[r+n])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}},QJ=class extends rr{constructor(){super(),this.isBone=!0,this.type="Bone"}},Da=class extends jr{constructor(e=null,t=1,i=1,r,n,s,a,o,l=Ci,c=Ci,u,h){super(null,s,a,o,l,c,r,n,u,h),this.isDataTexture=!0,this.image={data:e,width:t,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},WH=new ft,zxe=new ft,iN=class{constructor(e=[],t=[]){this.uuid=gl(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){let e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),t.length===0)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let i=0,r=this.bones.length;i<r;i++)this.boneInverses.push(new ft)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){let i=new ft;this.bones[e]&&i.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(i)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){let i=this.bones[e];i&&i.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){let i=this.bones[e];i&&(i.parent&&i.parent.isBone?(i.matrix.copy(i.parent.matrixWorld).invert(),i.matrix.multiply(i.matrixWorld)):i.matrix.copy(i.matrixWorld),i.matrix.decompose(i.position,i.quaternion,i.scale))}}update(){let e=this.bones,t=this.boneInverses,i=this.boneMatrices,r=this.boneTexture;for(let n=0,s=e.length;n<s;n++){let a=e[n]?e[n].matrixWorld:zxe;WH.multiplyMatrices(a,t[n]),WH.toArray(i,n*16)}r!==null&&(r.needsUpdate=!0)}clone(){return new iN(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=IJ(e),e=Math.max(e,4);let t=new Float32Array(e*e*4);t.set(this.boneMatrices);let i=new Da(t,e,e,Lr,or);return i.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=i,this.boneTextureSize=e,this}getBoneByName(e){for(let t=0,i=this.bones.length;t<i;t++){let r=this.bones[t];if(r.name===e)return r}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let i=0,r=e.bones.length;i<r;i++){let n=e.bones[i],s=t[n];s===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",n),s=new QJ),this.bones.push(s),this.boneInverses.push(new ft().fromArray(e.boneInverses[i]))}return this.init(),this}toJSON(){let e={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;let t=this.bones,i=this.boneInverses;for(let r=0,n=t.length;r<n;r++){let s=t[r];e.bones.push(s.uuid);let a=i[r];e.boneInverses.push(a.toArray())}return e}},Dw=class extends Qt{constructor(e,t,i,r=1){super(e,t,i),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){let e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}},XH=new ft,qH=new ft,IS=[],Bxe=new ft,d1=new yr,Fxe=class extends yr{constructor(e,t,i){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new Dw(new Float32Array(i*16),16),this.instanceColor=null,this.count=i,this.frustumCulled=!1;for(let r=0;r<i;r++)this.setMatrixAt(r,Bxe)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}getColorAt(e,t){t.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,e*16)}raycast(e,t){let i=this.matrixWorld,r=this.count;if(d1.geometry=this.geometry,d1.material=this.material,d1.material!==void 0)for(let n=0;n<r;n++){this.getMatrixAt(n,XH),qH.multiplyMatrices(i,XH),d1.matrixWorld=qH,d1.raycast(e,IS);for(let s=0,a=IS.length;s<a;s++){let o=IS[s];o.instanceId=n,o.object=this,t.push(o)}IS.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new Dw(new Float32Array(this.instanceMatrix.count*3),3)),t.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,e*16)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}},Pf=class extends Cb{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Yt(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}},YH=new N,QH=new N,ZH=new ft,XD=new sy,LS=new uo,cA=class extends rr{constructor(e=new Nt,t=new Pf){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){let e=this.geometry;if(e.index===null){let t=e.attributes.position,i=[0];for(let r=1,n=t.count;r<n;r++)YH.fromBufferAttribute(t,r-1),QH.fromBufferAttribute(t,r),i[r]=i[r-1],i[r]+=YH.distanceTo(QH);e.setAttribute("lineDistance",new _t(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){let i=this.geometry,r=this.matrixWorld,n=e.params.Line.threshold,s=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),LS.copy(i.boundingSphere),LS.applyMatrix4(r),LS.radius+=n,e.ray.intersectsSphere(LS)===!1)return;ZH.copy(r).invert(),XD.copy(e.ray).applyMatrix4(ZH);let a=n/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a,l=new N,c=new N,u=new N,h=new N,d=this.isLineSegments?2:1,f=i.index,p=i.attributes.position;if(f!==null){let v=Math.max(0,s.start),m=Math.min(f.count,s.start+s.count);for(let g=v,y=m-1;g<y;g+=d){let x=f.getX(g),_=f.getX(g+1);if(l.fromBufferAttribute(p,x),c.fromBufferAttribute(p,_),XD.distanceSqToSegment(l,c,h,u)>o)continue;h.applyMatrix4(this.matrixWorld);let M=e.ray.origin.distanceTo(h);M<e.near||M>e.far||t.push({distance:M,point:u.clone().applyMatrix4(this.matrixWorld),index:g,face:null,faceIndex:null,object:this})}}else{let v=Math.max(0,s.start),m=Math.min(p.count,s.start+s.count);for(let g=v,y=m-1;g<y;g+=d){if(l.fromBufferAttribute(p,g),c.fromBufferAttribute(p,g+1),XD.distanceSqToSegment(l,c,h,u)>o)continue;h.applyMatrix4(this.matrixWorld);let x=e.ray.origin.distanceTo(h);x<e.near||x>e.far||t.push({distance:x,point:u.clone().applyMatrix4(this.matrixWorld),index:g,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){let e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){let i=e[t[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,n=i.length;r<n;r++){let s=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[s]=r}}}}},KH=new N,JH=new N,Pb=class extends cA{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){let e=this.geometry;if(e.index===null){let t=e.attributes.position,i=[];for(let r=0,n=t.count;r<n;r+=2)KH.fromBufferAttribute(t,r),JH.fromBufferAttribute(t,r+1),i[r]=r===0?0:i[r-1],i[r+1]=i[r]+KH.distanceTo(JH);e.setAttribute("lineDistance",new _t(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}},Uxe=class extends jr{constructor(e,t,i,r,n,s,a,o,l){super(e,t,i,r,n,s,a,o,l),this.isVideoTexture=!0,this.minFilter=s!==void 0?s:bi,this.magFilter=n!==void 0?n:bi,this.generateMipmaps=!1;let c=this;function u(){c.needsUpdate=!0,e.requestVideoFrameCallback(u)}"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(u)}clone(){return new this.constructor(this.image).copy(this)}update(){let e=this.image;!("requestVideoFrameCallback"in e)&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}},Nxe=class extends jr{constructor(e,t,i,r,n,s,a,o,l){super(e,t,i,r,n,s,a,o,l),this.isCanvasTexture=!0,this.needsUpdate=!0}},hu=class{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){let i=this.getUtoTmapping(e);return this.getPoint(i,t)}getPoints(e=5){let t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return t}getSpacedPoints(e=5){let t=[];for(let i=0;i<=e;i++)t.push(this.getPointAt(i/e));return t}getLength(){let e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;let t=[],i,r=this.getPoint(0),n=0;t.push(0);for(let s=1;s<=e;s++)i=this.getPoint(s/e),n+=i.distanceTo(r),t.push(n),r=i;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){let i=this.getLengths(),r=0,n=i.length,s;t?s=t:s=e*i[n-1];let a=0,o=n-1,l;for(;a<=o;)if(r=Math.floor(a+(o-a)/2),l=i[r]-s,l<0)a=r+1;else if(l>0)o=r-1;else{o=r;break}if(r=o,i[r]===s)return r/(n-1);let c=i[r],u=i[r+1]-c,h=(s-c)/u;return(r+h)/(n-1)}getTangent(e,t){let i=e-1e-4,r=e+1e-4;i<0&&(i=0),r>1&&(r=1);let n=this.getPoint(i),s=this.getPoint(r),a=t||(n.isVector2?new Me:new N);return a.copy(s).sub(n).normalize(),a}getTangentAt(e,t){let i=this.getUtoTmapping(e);return this.getTangent(i,t)}computeFrenetFrames(e,t){let i=new N,r=[],n=[],s=[],a=new N,o=new ft;for(let d=0;d<=e;d++){let f=d/e;r[d]=this.getTangentAt(f,new N)}n[0]=new N,s[0]=new N;let l=Number.MAX_VALUE,c=Math.abs(r[0].x),u=Math.abs(r[0].y),h=Math.abs(r[0].z);c<=l&&(l=c,i.set(1,0,0)),u<=l&&(l=u,i.set(0,1,0)),h<=l&&i.set(0,0,1),a.crossVectors(r[0],i).normalize(),n[0].crossVectors(r[0],a),s[0].crossVectors(r[0],n[0]);for(let d=1;d<=e;d++){if(n[d]=n[d-1].clone(),s[d]=s[d-1].clone(),a.crossVectors(r[d-1],r[d]),a.length()>Number.EPSILON){a.normalize();let f=Math.acos(Tn(r[d-1].dot(r[d]),-1,1));n[d].applyMatrix4(o.makeRotationAxis(a,f))}s[d].crossVectors(r[d],n[d])}if(t===!0){let d=Math.acos(Tn(n[0].dot(n[e]),-1,1));d/=e,r[0].dot(a.crossVectors(n[0],n[e]))>0&&(d=-d);for(let f=1;f<=e;f++)n[f].applyMatrix4(o.makeRotationAxis(r[f],d*f)),s[f].crossVectors(r[f],n[f])}return{tangents:r,normals:n,binormals:s}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){let e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}},TC=class extends hu{constructor(e=0,t=0,i=1,r=1,n=0,s=Math.PI*2,a=!1,o=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=i,this.yRadius=r,this.aStartAngle=n,this.aEndAngle=s,this.aClockwise=a,this.aRotation=o}getPoint(e,t){let i=t||new Me,r=Math.PI*2,n=this.aEndAngle-this.aStartAngle,s=Math.abs(n)<Number.EPSILON;for(;n<0;)n+=r;for(;n>r;)n-=r;n<Number.EPSILON&&(s?n=0:n=r),this.aClockwise===!0&&!s&&(n===r?n=-r:n=n-r);let a=this.aStartAngle+e*n,o=this.aX+this.xRadius*Math.cos(a),l=this.aY+this.yRadius*Math.sin(a);if(this.aRotation!==0){let c=Math.cos(this.aRotation),u=Math.sin(this.aRotation),h=o-this.aX,d=l-this.aY;o=h*c-d*u+this.aX,l=h*u+d*c+this.aY}return i.set(o,l)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){let e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}},kxe=class extends TC{constructor(e,t,i,r,n,s){super(e,t,i,i,r,n,s),this.isArcCurve=!0,this.type="ArcCurve"}};function rN(){let e=0,t=0,i=0,r=0;function n(s,a,o,l){e=s,t=o,i=-3*s+3*a-2*o-l,r=2*s-2*a+o+l}return{initCatmullRom:function(s,a,o,l,c){n(a,o,c*(o-s),c*(l-a))},initNonuniformCatmullRom:function(s,a,o,l,c,u,h){let d=(a-s)/c-(o-s)/(c+u)+(o-a)/u,f=(o-a)/u-(l-a)/(u+h)+(l-o)/h;d*=u,f*=u,n(a,o,d,f)},calc:function(s){let a=s*s,o=a*s;return e+t*s+i*a+r*o}}}var OS=new N,qD=new rN,YD=new rN,QD=new rN,Vxe=class extends hu{constructor(e=[],t=!1,i="centripetal",r=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=i,this.tension=r}getPoint(e,t=new N){let i=t,r=this.points,n=r.length,s=(n-(this.closed?0:1))*e,a=Math.floor(s),o=s-a;this.closed?a+=a>0?0:(Math.floor(Math.abs(a)/n)+1)*n:o===0&&a===n-1&&(a=n-2,o=1);let l,c;this.closed||a>0?l=r[(a-1)%n]:(OS.subVectors(r[0],r[1]).add(r[0]),l=OS);let u=r[a%n],h=r[(a+1)%n];if(this.closed||a+2<n?c=r[(a+2)%n]:(OS.subVectors(r[n-1],r[n-2]).add(r[n-1]),c=OS),this.curveType==="centripetal"||this.curveType==="chordal"){let d=this.curveType==="chordal"?.5:.25,f=Math.pow(l.distanceToSquared(u),d),p=Math.pow(u.distanceToSquared(h),d),v=Math.pow(h.distanceToSquared(c),d);p<1e-4&&(p=1),f<1e-4&&(f=p),v<1e-4&&(v=p),qD.initNonuniformCatmullRom(l.x,u.x,h.x,c.x,f,p,v),YD.initNonuniformCatmullRom(l.y,u.y,h.y,c.y,f,p,v),QD.initNonuniformCatmullRom(l.z,u.z,h.z,c.z,f,p,v)}else this.curveType==="catmullrom"&&(qD.initCatmullRom(l.x,u.x,h.x,c.x,this.tension),YD.initCatmullRom(l.y,u.y,h.y,c.y,this.tension),QD.initCatmullRom(l.z,u.z,h.z,c.z,this.tension));return i.set(qD.calc(o),YD.calc(o),QD.calc(o)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){let r=e.points[t];this.points.push(r.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){let e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){let r=this.points[t];e.points.push(r.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){let r=e.points[t];this.points.push(new N().fromArray(r))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}};function $H(e,t,i,r,n){let s=(r-t)*.5,a=(n-i)*.5,o=e*e,l=e*o;return(2*i-2*r+s+a)*l+(-3*i+3*r-2*s-a)*o+s*e+i}function Gxe(e,t){let i=1-e;return i*i*t}function Hxe(e,t){return 2*(1-e)*e*t}function jxe(e,t){return e*e*t}function Rx(e,t,i,r){return Gxe(e,t)+Hxe(e,i)+jxe(e,r)}function Wxe(e,t){let i=1-e;return i*i*i*t}function Xxe(e,t){let i=1-e;return 3*i*i*e*t}function qxe(e,t){return 3*(1-e)*e*e*t}function Yxe(e,t){return e*e*e*t}function Ix(e,t,i,r,n){return Wxe(e,t)+Xxe(e,i)+qxe(e,r)+Yxe(e,n)}var Zl=class extends hu{constructor(e=new Me,t=new Me,i=new Me,r=new Me){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=i,this.v3=r}getPoint(e,t=new Me){let i=t,r=this.v0,n=this.v1,s=this.v2,a=this.v3;return i.set(Ix(e,r.x,n.x,s.x,a.x),Ix(e,r.y,n.y,s.y,a.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}},e2=class extends hu{constructor(e=new N,t=new N,i=new N,r=new N){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=i,this.v3=r}getPoint(e,t=new N){let i=t,r=this.v0,n=this.v1,s=this.v2,a=this.v3;return i.set(Ix(e,r.x,n.x,s.x,a.x),Ix(e,r.y,n.y,s.y,a.y),Ix(e,r.z,n.z,s.z,a.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}},ic=class extends hu{constructor(e=new Me,t=new Me){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new Me){let i=t;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t){let i=t||new Me;return i.copy(this.v2).sub(this.v1).normalize(),i}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},ZJ=class extends hu{constructor(e=new N,t=new N){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new N){let i=t;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},gf=class extends hu{constructor(e=new Me,t=new Me,i=new Me){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new Me){let i=t,r=this.v0,n=this.v1,s=this.v2;return i.set(Rx(e,r.x,n.x,s.x),Rx(e,r.y,n.y,s.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},Qxe=class extends hu{constructor(e=new N,t=new N,i=new N){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new N){let i=t,r=this.v0,n=this.v1,s=this.v2;return i.set(Rx(e,r.x,n.x,s.x),Rx(e,r.y,n.y,s.y),Rx(e,r.z,n.z,s.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},nN=class extends hu{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new Me){let i=t,r=this.points,n=(r.length-1)*e,s=Math.floor(n),a=n-s,o=r[s===0?s:s-1],l=r[s],c=r[s>r.length-2?r.length-1:s+1],u=r[s>r.length-3?r.length-1:s+2];return i.set($H(a,o.x,l.x,c.x,u.x),$H(a,o.y,l.y,c.y,u.y)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){let r=e.points[t];this.points.push(r.clone())}return this}toJSON(){let e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){let r=this.points[t];e.points.push(r.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){let r=e.points[t];this.points.push(new Me().fromArray(r))}return this}},Zxe=Object.freeze({__proto__:null,ArcCurve:kxe,CatmullRomCurve3:Vxe,CubicBezierCurve:Zl,CubicBezierCurve3:e2,EllipseCurve:TC,LineCurve:ic,LineCurve3:ZJ,QuadraticBezierCurve:gf,QuadraticBezierCurve3:Qxe,SplineCurve:nN}),KJ=class extends hu{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){let e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new ic(t,e))}getPoint(e,t){let i=e*this.getLength(),r=this.getCurveLengths(),n=0;for(;n<r.length;){if(r[n]>=i){let s=r[n]-i,a=this.curves[n],o=a.getLength(),l=o===0?0:1-s/o;return a.getPointAt(l,t)}n++}return null}getLength(){let e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;let e=[],t=0;for(let i=0,r=this.curves.length;i<r;i++)t+=this.curves[i].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){let t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){let t=[],i;for(let r=0,n=this.curves;r<n.length;r++){let s=n[r],a=s.isEllipseCurve?e*2:s.isLineCurve||s.isLineCurve3?1:s.isSplineCurve?e*s.points.length:e,o=s.getPoints(a);for(let l=0;l<o.length;l++){let c=o[l];i&&i.equals(c)||(t.push(c),i=c)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){let r=e.curves[t];this.curves.push(r.clone())}return this.autoClose=e.autoClose,this}toJSON(){let e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,i=this.curves.length;t<i;t++){let r=this.curves[t];e.curves.push(r.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){let r=e.curves[t];this.curves.push(new Zxe[r.type]().fromJSON(r))}return this}},uA=class extends KJ{constructor(e){super(),this.type="Path",this.currentPoint=new Me,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,i=e.length;t<i;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){let i=new ic(this.currentPoint.clone(),new Me(e,t));return this.curves.push(i),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,i,r){let n=new gf(this.currentPoint.clone(),new Me(e,t),new Me(i,r));return this.curves.push(n),this.currentPoint.set(i,r),this}bezierCurveTo(e,t,i,r,n,s){let a=new Zl(this.currentPoint.clone(),new Me(e,t),new Me(i,r),new Me(n,s));return this.curves.push(a),this.currentPoint.set(n,s),this}splineThru(e){let t=[this.currentPoint.clone()].concat(e),i=new nN(t);return this.curves.push(i),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,i,r,n,s){let a=this.currentPoint.x,o=this.currentPoint.y;return this.absarc(e+a,t+o,i,r,n,s),this}absarc(e,t,i,r,n,s){return this.absellipse(e,t,i,i,r,n,s),this}ellipse(e,t,i,r,n,s,a,o){let l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(e+l,t+c,i,r,n,s,a,o),this}absellipse(e,t,i,r,n,s,a,o){let l=new TC(e,t,i,r,n,s,a,o);if(this.curves.length>0){let u=l.getPoint(0);u.equals(this.currentPoint)||this.lineTo(u.x,u.y)}this.curves.push(l);let c=l.getPoint(1);return this.currentPoint.copy(c),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){let e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}},JJ=class extends Nt{constructor(e=[new Me(0,-.5),new Me(.5,0),new Me(0,.5)],t=12,i=0,r=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:i,phiLength:r},t=Math.floor(t),r=Tn(r,0,Math.PI*2);let n=[],s=[],a=[],o=[],l=[],c=1/t,u=new N,h=new Me,d=new N,f=new N,p=new N,v=0,m=0;for(let g=0;g<=e.length-1;g++)switch(g){case 0:v=e[g+1].x-e[g].x,m=e[g+1].y-e[g].y,d.x=m*1,d.y=-v,d.z=m*0,p.copy(d),d.normalize(),o.push(d.x,d.y,d.z);break;case e.length-1:o.push(p.x,p.y,p.z);break;default:v=e[g+1].x-e[g].x,m=e[g+1].y-e[g].y,d.x=m*1,d.y=-v,d.z=m*0,f.copy(d),d.x+=p.x,d.y+=p.y,d.z+=p.z,d.normalize(),o.push(d.x,d.y,d.z),p.copy(f)}for(let g=0;g<=t;g++){let y=i+g*c*r,x=Math.sin(y),_=Math.cos(y);for(let M=0;M<=e.length-1;M++){u.x=e[M].x*x,u.y=e[M].y,u.z=e[M].x*_,s.push(u.x,u.y,u.z),h.x=g/t,h.y=M/(e.length-1),a.push(h.x,h.y);let S=o[3*M+0]*x,T=o[3*M+1],E=o[3*M+0]*_;l.push(S,T,E)}}for(let g=0;g<t;g++)for(let y=0;y<e.length-1;y++){let x=y+g*e.length,_=x,M=x+e.length,S=x+e.length+1,T=x+1;n.push(_,M,T),n.push(S,T,M)}this.setIndex(n),this.setAttribute("position",new _t(s,3)),this.setAttribute("uv",new _t(a,2)),this.setAttribute("normal",new _t(l,3))}static fromJSON(e){return new JJ(e.points,e.segments,e.phiStart,e.phiLength)}},sN=class extends Nt{constructor(e=1,t=1,i=1,r=32,n=1,s=!1,a=0,o=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:r,heightSegments:n,openEnded:s,thetaStart:a,thetaLength:o};let l=this;r=Math.floor(r),n=Math.floor(n);let c=[],u=[],h=[],d=[],f=0,p=[],v=i/2,m=0;g(),s===!1&&(e>0&&y(!0),t>0&&y(!1)),this.setIndex(c),this.setAttribute("position",new _t(u,3)),this.setAttribute("normal",new _t(h,3)),this.setAttribute("uv",new _t(d,2));function g(){let x=new N,_=new N,M=0,S=(t-e)/i;for(let T=0;T<=n;T++){let E=[],C=T/n,A=C*(t-e)+e;for(let D=0;D<=r;D++){let R=D/r,L=R*o+a,O=Math.sin(L),H=Math.cos(L);_.x=A*O,_.y=-C*i+v,_.z=A*H,u.push(_.x,_.y,_.z),x.set(O,S,H).normalize(),h.push(x.x,x.y,x.z),d.push(R,1-C),E.push(f++)}p.push(E)}for(let T=0;T<r;T++)for(let E=0;E<n;E++){let C=p[E][T],A=p[E+1][T],D=p[E+1][T+1],R=p[E][T+1];c.push(C,A,R),c.push(A,D,R),M+=6}l.addGroup(m,M,0),m+=M}function y(x){let _=f,M=new Me,S=new N,T=0,E=x===!0?e:t,C=x===!0?1:-1;for(let D=1;D<=r;D++)u.push(0,v*C,0),h.push(0,C,0),d.push(.5,.5),f++;let A=f;for(let D=0;D<=r;D++){let R=D/r*o+a,L=Math.cos(R),O=Math.sin(R);S.x=E*O,S.y=v*C,S.z=E*L,u.push(S.x,S.y,S.z),h.push(0,C,0),M.x=L*.5+.5,M.y=O*.5*C+.5,d.push(M.x,M.y),f++}for(let D=0;D<r;D++){let R=_+D,L=A+D;x===!0?c.push(L,L+1,R):c.push(L+1,L,R),T+=3}l.addGroup(m,T,x===!0?1:2),m+=T}}static fromJSON(e){return new sN(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}},aN=class extends sN{constructor(e=1,t=1,i=32,r=1,n=!1,s=0,a=Math.PI*2){super(0,e,t,i,r,n,s,a),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:i,heightSegments:r,openEnded:n,thetaStart:s,thetaLength:a}}static fromJSON(e){return new aN(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}},oN=class extends Nt{constructor(e=[],t=[],i=1,r=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:i,detail:r};let n=[],s=[];a(r),l(i),c(),this.setAttribute("position",new _t(n,3)),this.setAttribute("normal",new _t(n.slice(),3)),this.setAttribute("uv",new _t(s,2)),r===0?this.computeVertexNormals():this.normalizeNormals();function a(g){let y=new N,x=new N,_=new N;for(let M=0;M<t.length;M+=3)d(t[M+0],y),d(t[M+1],x),d(t[M+2],_),o(y,x,_,g)}function o(g,y,x,_){let M=_+1,S=[];for(let T=0;T<=M;T++){S[T]=[];let E=g.clone().lerp(x,T/M),C=y.clone().lerp(x,T/M),A=M-T;for(let D=0;D<=A;D++)D===0&&T===M?S[T][D]=E:S[T][D]=E.clone().lerp(C,D/A)}for(let T=0;T<M;T++)for(let E=0;E<2*(M-T)-1;E++){let C=Math.floor(E/2);E%2===0?(h(S[T][C+1]),h(S[T+1][C]),h(S[T][C])):(h(S[T][C+1]),h(S[T+1][C+1]),h(S[T+1][C]))}}function l(g){let y=new N;for(let x=0;x<n.length;x+=3)y.x=n[x+0],y.y=n[x+1],y.z=n[x+2],y.normalize().multiplyScalar(g),n[x+0]=y.x,n[x+1]=y.y,n[x+2]=y.z}function c(){let g=new N;for(let y=0;y<n.length;y+=3){g.x=n[y+0],g.y=n[y+1],g.z=n[y+2];let x=v(g)/2/Math.PI+.5,_=m(g)/Math.PI+.5;s.push(x,1-_)}f(),u()}function u(){for(let g=0;g<s.length;g+=6){let y=s[g+0],x=s[g+2],_=s[g+4],M=Math.max(y,x,_),S=Math.min(y,x,_);M>.9&&S<.1&&(y<.2&&(s[g+0]+=1),x<.2&&(s[g+2]+=1),_<.2&&(s[g+4]+=1))}}function h(g){n.push(g.x,g.y,g.z)}function d(g,y){let x=g*3;y.x=e[x+0],y.y=e[x+1],y.z=e[x+2]}function f(){let g=new N,y=new N,x=new N,_=new N,M=new Me,S=new Me,T=new Me;for(let E=0,C=0;E<n.length;E+=9,C+=6){g.set(n[E+0],n[E+1],n[E+2]),y.set(n[E+3],n[E+4],n[E+5]),x.set(n[E+6],n[E+7],n[E+8]),M.set(s[C+0],s[C+1]),S.set(s[C+2],s[C+3]),T.set(s[C+4],s[C+5]),_.copy(g).add(y).add(x).divideScalar(3);let A=v(_);p(M,C+0,g,A),p(S,C+2,y,A),p(T,C+4,x,A)}}function p(g,y,x,_){_<0&&g.x===1&&(s[y]=g.x-1),x.x===0&&x.z===0&&(s[y]=_/2/Math.PI+.5)}function v(g){return Math.atan2(g.z,-g.x)}function m(g){return Math.atan2(-g.y,Math.sqrt(g.x*g.x+g.z*g.z))}}static fromJSON(e){return new oN(e.vertices,e.indices,e.radius,e.details)}},$J=class extends oN{constructor(e=1,t=0){let i=(1+Math.sqrt(5))/2,r=1/i,n=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-i,0,-r,i,0,r,-i,0,r,i,-r,-i,0,-r,i,0,r,-i,0,r,i,0,-i,0,-r,i,0,-r,-i,0,r,i,0,r],s=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(n,s,e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new $J(e.radius,e.detail)}},hA=class extends uA{constructor(e){super(e),this.uuid=gl(),this.type="Shape",this.holes=[]}getPointsHoles(e){let t=[];for(let i=0,r=this.holes.length;i<r;i++)t[i]=this.holes[i].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){let r=e.holes[t];this.holes.push(r.clone())}return this}toJSON(){let e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,i=this.holes.length;t<i;t++){let r=this.holes[t];e.holes.push(r.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){let r=e.holes[t];this.holes.push(new uA().fromJSON(r))}return this}},Kxe={triangulate:function(e,t,i=2){let r=t&&t.length,n=r?t[0]*i:e.length,s=e$(e,0,n,i,!0),a=[];if(!s||s.next===s.prev)return a;let o,l,c,u,h,d,f;if(r&&(s=iwe(e,t,s,i)),e.length>80*i){o=c=e[0],l=u=e[1];for(let p=i;p<n;p+=i)h=e[p],d=e[p+1],h<o&&(o=h),d<l&&(l=d),h>c&&(c=h),d>u&&(u=d);f=Math.max(c-o,u-l),f=f!==0?32767/f:0}return Rw(s,a,i,o,l,f,0),a}};function e$(e,t,i,r,n){let s,a;if(n===fwe(e,t,i,r)>0)for(s=t;s<i;s+=r)a=ej(s,e[s],e[s+1],a);else for(s=i-r;s>=t;s-=r)a=ej(s,e[s],e[s+1],a);return a&&CC(a,a.next)&&(Lw(a),a=a.next),a}function Em(e,t){if(!e)return e;t||(t=e);let i=e,r;do if(r=!1,!i.steiner&&(CC(i,i.next)||kr(i.prev,i,i.next)===0)){if(Lw(i),i=t=i.prev,i===i.next)break;r=!0}else i=i.next;while(r||i!==t);return t}function Rw(e,t,i,r,n,s,a){if(!e)return;!a&&s&&owe(e,r,n,s);let o=e,l,c;for(;e.prev!==e.next;){if(l=e.prev,c=e.next,s?$xe(e,r,n,s):Jxe(e)){t.push(l.i/i|0),t.push(e.i/i|0),t.push(c.i/i|0),Lw(e),e=c.next,o=c.next;continue}if(e=c,e===o){a?a===1?(e=ewe(Em(e),t,i),Rw(e,t,i,r,n,s,2)):a===2&&twe(e,t,i,r,n,s):Rw(Em(e),t,i,r,n,s,1);break}}}function Jxe(e){let t=e.prev,i=e,r=e.next;if(kr(t,i,r)>=0)return!1;let n=t.x,s=i.x,a=r.x,o=t.y,l=i.y,c=r.y,u=n<s?n<a?n:a:s<a?s:a,h=o<l?o<c?o:c:l<c?l:c,d=n>s?n>a?n:a:s>a?s:a,f=o>l?o>c?o:c:l>c?l:c,p=r.next;for(;p!==t;){if(p.x>=u&&p.x<=d&&p.y>=h&&p.y<=f&&Wv(n,o,s,l,a,c,p.x,p.y)&&kr(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function $xe(e,t,i,r){let n=e.prev,s=e,a=e.next;if(kr(n,s,a)>=0)return!1;let o=n.x,l=s.x,c=a.x,u=n.y,h=s.y,d=a.y,f=o<l?o<c?o:c:l<c?l:c,p=u<h?u<d?u:d:h<d?h:d,v=o>l?o>c?o:c:l>c?l:c,m=u>h?u>d?u:d:h>d?h:d,g=ZO(f,p,t,i,r),y=ZO(v,m,t,i,r),x=e.prevZ,_=e.nextZ;for(;x&&x.z>=g&&_&&_.z<=y;){if(x.x>=f&&x.x<=v&&x.y>=p&&x.y<=m&&x!==n&&x!==a&&Wv(o,u,l,h,c,d,x.x,x.y)&&kr(x.prev,x,x.next)>=0||(x=x.prevZ,_.x>=f&&_.x<=v&&_.y>=p&&_.y<=m&&_!==n&&_!==a&&Wv(o,u,l,h,c,d,_.x,_.y)&&kr(_.prev,_,_.next)>=0))return!1;_=_.nextZ}for(;x&&x.z>=g;){if(x.x>=f&&x.x<=v&&x.y>=p&&x.y<=m&&x!==n&&x!==a&&Wv(o,u,l,h,c,d,x.x,x.y)&&kr(x.prev,x,x.next)>=0)return!1;x=x.prevZ}for(;_&&_.z<=y;){if(_.x>=f&&_.x<=v&&_.y>=p&&_.y<=m&&_!==n&&_!==a&&Wv(o,u,l,h,c,d,_.x,_.y)&&kr(_.prev,_,_.next)>=0)return!1;_=_.nextZ}return!0}function ewe(e,t,i){let r=e;do{let n=r.prev,s=r.next.next;!CC(n,s)&&t$(n,r,r.next,s)&&Iw(n,s)&&Iw(s,n)&&(t.push(n.i/i|0),t.push(r.i/i|0),t.push(s.i/i|0),Lw(r),Lw(r.next),r=e=s),r=r.next}while(r!==e);return Em(r)}function twe(e,t,i,r,n,s){let a=e;do{let o=a.next.next;for(;o!==a.prev;){if(a.i!==o.i&&uwe(a,o)){let l=i$(a,o);a=Em(a,a.next),l=Em(l,l.next),Rw(a,t,i,r,n,s,0),Rw(l,t,i,r,n,s,0);return}o=o.next}a=a.next}while(a!==e)}function iwe(e,t,i,r){let n=[],s,a,o,l,c;for(s=0,a=t.length;s<a;s++)o=t[s]*r,l=s<a-1?t[s+1]*r:e.length,c=e$(e,o,l,r,!1),c===c.next&&(c.steiner=!0),n.push(cwe(c));for(n.sort(rwe),s=0;s<n.length;s++)i=nwe(n[s],i);return i}function rwe(e,t){return e.x-t.x}function nwe(e,t){let i=swe(e,t);if(!i)return t;let r=i$(i,e);return Em(r,r.next),Em(i,i.next)}function swe(e,t){let i=t,r=-1/0,n,s=e.x,a=e.y;do{if(a<=i.y&&a>=i.next.y&&i.next.y!==i.y){let d=i.x+(a-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(d<=s&&d>r&&(r=d,n=i.x<i.next.x?i:i.next,d===s))return n}i=i.next}while(i!==t);if(!n)return null;let o=n,l=n.x,c=n.y,u=1/0,h;i=n;do s>=i.x&&i.x>=l&&s!==i.x&&Wv(a<c?s:r,a,l,c,a<c?r:s,a,i.x,i.y)&&(h=Math.abs(a-i.y)/(s-i.x),Iw(i,e)&&(h<u||h===u&&(i.x>n.x||i.x===n.x&&awe(n,i)))&&(n=i,u=h)),i=i.next;while(i!==o);return n}function awe(e,t){return kr(e.prev,e,t.prev)<0&&kr(t.next,e,e.next)<0}function owe(e,t,i,r){let n=e;do n.z===0&&(n.z=ZO(n.x,n.y,t,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==e);n.prevZ.nextZ=null,n.prevZ=null,lwe(n)}function lwe(e){let t,i,r,n,s,a,o,l,c=1;do{for(i=e,e=null,s=null,a=0;i;){for(a++,r=i,o=0,t=0;t<c&&(o++,r=r.nextZ,!!r);t++);for(l=c;o>0||l>0&&r;)o!==0&&(l===0||!r||i.z<=r.z)?(n=i,i=i.nextZ,o--):(n=r,r=r.nextZ,l--),s?s.nextZ=n:e=n,n.prevZ=s,s=n;i=r}s.nextZ=null,c*=2}while(a>1);return e}function ZO(e,t,i,r,n){return e=(e-i)*n|0,t=(t-r)*n|0,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e|t<<1}function cwe(e){let t=e,i=e;do(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next;while(t!==e);return i}function Wv(e,t,i,r,n,s,a,o){return(n-a)*(t-o)>=(e-a)*(s-o)&&(e-a)*(r-o)>=(i-a)*(t-o)&&(i-a)*(s-o)>=(n-a)*(r-o)}function uwe(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!hwe(e,t)&&(Iw(e,t)&&Iw(t,e)&&dwe(e,t)&&(kr(e.prev,e,t.prev)||kr(e,t.prev,t))||CC(e,t)&&kr(e.prev,e,e.next)>0&&kr(t.prev,t,t.next)>0)}function kr(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function CC(e,t){return e.x===t.x&&e.y===t.y}function t$(e,t,i,r){let n=BS(kr(e,t,i)),s=BS(kr(e,t,r)),a=BS(kr(i,r,e)),o=BS(kr(i,r,t));return!!(n!==s&&a!==o||n===0&&zS(e,i,t)||s===0&&zS(e,r,t)||a===0&&zS(i,e,r)||o===0&&zS(i,t,r))}function zS(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function BS(e){return e>0?1:e<0?-1:0}function hwe(e,t){let i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&t$(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}function Iw(e,t){return kr(e.prev,e,e.next)<0?kr(e,t,e.next)>=0&&kr(e,e.prev,t)>=0:kr(e,t,e.prev)<0||kr(e,e.next,t)<0}function dwe(e,t){let i=e,r=!1,n=(e.x+t.x)/2,s=(e.y+t.y)/2;do i.y>s!=i.next.y>s&&i.next.y!==i.y&&n<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next;while(i!==e);return r}function i$(e,t){let i=new KO(e.i,e.x,e.y),r=new KO(t.i,t.x,t.y),n=e.next,s=t.prev;return e.next=t,t.prev=e,i.next=n,n.prev=i,r.next=i,i.prev=r,s.next=r,r.prev=s,r}function ej(e,t,i,r){let n=new KO(e,t,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function Lw(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function KO(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function fwe(e,t,i,r){let n=0;for(let s=t,a=i-r;s<i;s+=r)n+=(e[a]-e[s])*(e[s+1]+e[a+1]),a=s;return n}var r$=class{static area(e){let t=e.length,i=0;for(let r=t-1,n=0;n<t;r=n++)i+=e[r].x*e[n].y-e[n].x*e[r].y;return i*.5}static isClockWise(e){return r$.area(e)<0}static triangulateShape(e,t){let i=[],r=[],n=[];tj(e),ij(i,e);let s=e.length;t.forEach(tj);for(let o=0;o<t.length;o++)r.push(s),s+=t[o].length,ij(i,t[o]);let a=Kxe.triangulate(i,r);for(let o=0;o<a.length;o+=3)n.push(a.slice(o,o+3));return n}};function tj(e){let t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function ij(e,t){for(let i=0;i<t.length;i++)e.push(t[i].x),e.push(t[i].y)}var n$=class extends oN{constructor(e=1,t=0){let i=(1+Math.sqrt(5))/2,r=[-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],n=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(r,n,e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new n$(e.radius,e.detail)}},l0=class extends Nt{constructor(e=1,t=32,i=16,r=0,n=Math.PI*2,s=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:r,phiLength:n,thetaStart:s,thetaLength:a},t=Math.max(3,Math.floor(t)),i=Math.max(2,Math.floor(i));let o=Math.min(s+a,Math.PI),l=0,c=[],u=new N,h=new N,d=[],f=[],p=[],v=[];for(let m=0;m<=i;m++){let g=[],y=m/i,x=0;m==0&&s==0?x=.5/t:m==i&&o==Math.PI&&(x=-.5/t);for(let _=0;_<=t;_++){let M=_/t;u.x=-e*Math.cos(r+M*n)*Math.sin(s+y*a),u.y=e*Math.cos(s+y*a),u.z=e*Math.sin(r+M*n)*Math.sin(s+y*a),f.push(u.x,u.y,u.z),h.copy(u).normalize(),p.push(h.x,h.y,h.z),v.push(M+x,1-y),g.push(l++)}c.push(g)}for(let m=0;m<i;m++)for(let g=0;g<t;g++){let y=c[m][g+1],x=c[m][g],_=c[m+1][g],M=c[m+1][g+1];(m!==0||s>0)&&d.push(y,x,M),(m!==i-1||o<Math.PI)&&d.push(x,_,M)}this.setIndex(d),this.setAttribute("position",new _t(f,3)),this.setAttribute("normal",new _t(p,3)),this.setAttribute("uv",new _t(v,2))}static fromJSON(e){return new l0(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}},s$=class extends Nt{constructor(e=1,t=.4,i=12,r=48,n=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:i,tubularSegments:r,arc:n},i=Math.floor(i),r=Math.floor(r);let s=[],a=[],o=[],l=[],c=new N,u=new N,h=new N;for(let d=0;d<=i;d++)for(let f=0;f<=r;f++){let p=f/r*n,v=d/i*Math.PI*2;u.x=(e+t*Math.cos(v))*Math.cos(p),u.y=(e+t*Math.cos(v))*Math.sin(p),u.z=t*Math.sin(v),a.push(u.x,u.y,u.z),c.x=e*Math.cos(p),c.y=e*Math.sin(p),h.subVectors(u,c).normalize(),o.push(h.x,h.y,h.z),l.push(f/r),l.push(d/i)}for(let d=1;d<=i;d++)for(let f=1;f<=r;f++){let p=(r+1)*d+f-1,v=(r+1)*(d-1)+f-1,m=(r+1)*(d-1)+f,g=(r+1)*d+f;s.push(p,v,g),s.push(v,m,g)}this.setIndex(s),this.setAttribute("position",new _t(a,3)),this.setAttribute("normal",new _t(o,3)),this.setAttribute("uv",new _t(l,2))}static fromJSON(e){return new s$(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}},a$=class extends Nt{constructor(e=1,t=.4,i=64,r=8,n=2,s=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:i,radialSegments:r,p:n,q:s},i=Math.floor(i),r=Math.floor(r);let a=[],o=[],l=[],c=[],u=new N,h=new N,d=new N,f=new N,p=new N,v=new N,m=new N;for(let y=0;y<=i;++y){let x=y/i*n*Math.PI*2;g(x,n,s,e,d),g(x+.01,n,s,e,f),v.subVectors(f,d),m.addVectors(f,d),p.crossVectors(v,m),m.crossVectors(p,v),p.normalize(),m.normalize();for(let _=0;_<=r;++_){let M=_/r*Math.PI*2,S=-t*Math.cos(M),T=t*Math.sin(M);u.x=d.x+(S*m.x+T*p.x),u.y=d.y+(S*m.y+T*p.y),u.z=d.z+(S*m.z+T*p.z),o.push(u.x,u.y,u.z),h.subVectors(u,d).normalize(),l.push(h.x,h.y,h.z),c.push(y/i),c.push(_/r)}}for(let y=1;y<=i;y++)for(let x=1;x<=r;x++){let _=(r+1)*(y-1)+(x-1),M=(r+1)*y+(x-1),S=(r+1)*y+x,T=(r+1)*(y-1)+x;a.push(_,M,T),a.push(M,S,T)}this.setIndex(a),this.setAttribute("position",new _t(o,3)),this.setAttribute("normal",new _t(l,3)),this.setAttribute("uv",new _t(c,2));function g(y,x,_,M,S){let T=Math.cos(y),E=Math.sin(y),C=_/x*y,A=Math.cos(C);S.x=M*(2+A)*.5*T,S.y=M*(2+A)*E*.5,S.z=M*Math.sin(C)*.5}}static fromJSON(e){return new a$(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}},pwe=class extends ki{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}};function rd(e,t,i){return o$(e)?new e.constructor(e.subarray(t,i!==void 0?i:e.length)):e.slice(t,i)}function FS(e,t,i){return!e||e.constructor===t?e:typeof t.BYTES_PER_ELEMENT=="number"?new t(e):Array.prototype.slice.call(e)}function o$(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function mwe(e){function t(n,s){return e[n]-e[s]}let i=e.length,r=new Array(i);for(let n=0;n!==i;++n)r[n]=n;return r.sort(t),r}function rj(e,t,i){let r=e.length,n=new e.constructor(r);for(let s=0,a=0;a!==r;++s){let o=i[s]*t;for(let l=0;l!==t;++l)n[a++]=e[o+l]}return n}function l$(e,t,i,r){let n=1,s=e[0];for(;s!==void 0&&s[r]===void 0;)s=e[n++];if(s===void 0)return;let a=s[r];if(a!==void 0)if(Array.isArray(a))do a=s[r],a!==void 0&&(t.push(s.time),i.push.apply(i,a)),s=e[n++];while(s!==void 0);else if(a.toArray!==void 0)do a=s[r],a!==void 0&&(t.push(s.time),a.toArray(i,i.length)),s=e[n++];while(s!==void 0);else do a=s[r],a!==void 0&&(t.push(s.time),i.push(a)),s=e[n++];while(s!==void 0)}var PC=class{constructor(e,t,i,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=r!==void 0?r:new t.constructor(i),this.sampleValues=t,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(e){let t=this.parameterPositions,i=this._cachedIndex,r=t[i],n=t[i-1];e:{t:{let s;i:{r:if(!(e<r)){for(let a=i+2;;){if(r===void 0){if(e<n)break r;return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===a)break;if(n=r,r=t[++i],e<r)break t}s=t.length;break i}if(!(e>=n)){let a=t[1];e<a&&(i=2,n=a);for(let o=i-2;;){if(n===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(i===o)break;if(r=n,n=t[--i-1],e>=n)break t}s=i,i=0;break i}break e}for(;i<s;){let a=i+s>>>1;e<t[a]?s=a:i=a+1}if(r=t[i],n=t[i-1],n===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(r===void 0)return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,n,r)}return this.interpolate_(i,n,e,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){let t=this.resultBuffer,i=this.sampleValues,r=this.valueSize,n=e*r;for(let s=0;s!==r;++s)t[s]=i[n+s];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}},gwe=class extends PC{constructor(e,t,i,r){super(e,t,i,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Gv,endingEnd:Gv}}intervalChanged_(e,t,i){let r=this.parameterPositions,n=e-2,s=e+1,a=r[n],o=r[s];if(a===void 0)switch(this.getSettings_().endingStart){case Hv:n=e,a=2*t-i;break;case aA:n=r.length-2,a=t+r[n]-r[n+1];break;default:n=e,a=i}if(o===void 0)switch(this.getSettings_().endingEnd){case Hv:s=e,o=2*i-t;break;case aA:s=1,o=i+r[1]-r[0];break;default:s=e-1,o=t}let l=(i-t)*.5,c=this.valueSize;this._weightPrev=l/(t-a),this._weightNext=l/(o-i),this._offsetPrev=n*c,this._offsetNext=s*c}interpolate_(e,t,i,r){let n=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=e*a,l=o-a,c=this._offsetPrev,u=this._offsetNext,h=this._weightPrev,d=this._weightNext,f=(i-t)/(r-t),p=f*f,v=p*f,m=-h*v+2*h*p-h*f,g=(1+h)*v+(-1.5-2*h)*p+(-.5+h)*f+1,y=(-1-d)*v+(1.5+d)*p+.5*f,x=d*v-d*p;for(let _=0;_!==a;++_)n[_]=m*s[c+_]+g*s[l+_]+y*s[o+_]+x*s[u+_];return n}},c$=class extends PC{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e,t,i,r){let n=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=e*a,l=o-a,c=(i-t)/(r-t),u=1-c;for(let h=0;h!==a;++h)n[h]=s[l+h]*u+s[o+h]*c;return n}},vwe=class extends PC{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e){return this.copySampleValue_(e-1)}},du=class{constructor(e,t,i,r){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=FS(t,this.TimeBufferType),this.values=FS(i,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(e){let t=e.constructor,i;if(t.toJSON!==this.toJSON)i=t.toJSON(e);else{i={name:e.name,times:FS(e.times,Array),values:FS(e.values,Array)};let r=e.getInterpolation();r!==e.DefaultInterpolation&&(i.interpolation=r)}return i.type=e.ValueTypeName,i}InterpolantFactoryMethodDiscrete(e){return new vwe(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new c$(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new gwe(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case nA:t=this.InterpolantFactoryMethodDiscrete;break;case sA:t=this.InterpolantFactoryMethodLinear;break;case wD:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){let i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(i);return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return nA;case this.InterpolantFactoryMethodLinear:return sA;case this.InterpolantFactoryMethodSmooth:return wD}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){let t=this.times;for(let i=0,r=t.length;i!==r;++i)t[i]+=e}return this}scale(e){if(e!==1){let t=this.times;for(let i=0,r=t.length;i!==r;++i)t[i]*=e}return this}trim(e,t){let i=this.times,r=i.length,n=0,s=r-1;for(;n!==r&&i[n]<e;)++n;for(;s!==-1&&i[s]>t;)--s;if(++s,n!==0||s!==r){n>=s&&(s=Math.max(s,1),n=s-1);let a=this.getValueSize();this.times=rd(i,n,s),this.values=rd(this.values,n*a,s*a)}return this}validate(){let e=!0,t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);let i=this.times,r=this.values,n=i.length;n===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let s=null;for(let a=0;a!==n;a++){let o=i[a];if(typeof o=="number"&&isNaN(o)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,o),e=!1;break}if(s!==null&&s>o){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,o,s),e=!1;break}s=o}if(r!==void 0&&o$(r))for(let a=0,o=r.length;a!==o;++a){let l=r[a];if(isNaN(l)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,l),e=!1;break}}return e}optimize(){let e=rd(this.times),t=rd(this.values),i=this.getValueSize(),r=this.getInterpolation()===wD,n=e.length-1,s=1;for(let a=1;a<n;++a){let o=!1,l=e[a],c=e[a+1];if(l!==c&&(a!==1||l!==e[0]))if(r)o=!0;else{let u=a*i,h=u-i,d=u+i;for(let f=0;f!==i;++f){let p=t[u+f];if(p!==t[h+f]||p!==t[d+f]){o=!0;break}}}if(o){if(a!==s){e[s]=e[a];let u=a*i,h=s*i;for(let d=0;d!==i;++d)t[h+d]=t[u+d]}++s}}if(n>0){e[s]=e[n];for(let a=n*i,o=s*i,l=0;l!==i;++l)t[o+l]=t[a+l];++s}return s!==e.length?(this.times=rd(e,0,s),this.values=rd(t,0,s*i)):(this.times=e,this.values=t),this}clone(){let e=rd(this.times,0),t=rd(this.values,0),i=this.constructor,r=new i(this.name,e,t);return r.createInterpolant=this.createInterpolant,r}};du.prototype.TimeBufferType=Float32Array;du.prototype.ValueBufferType=Float32Array;du.prototype.DefaultInterpolation=sA;var ly=class extends du{};ly.prototype.ValueTypeName="bool";ly.prototype.ValueBufferType=Array;ly.prototype.DefaultInterpolation=nA;ly.prototype.InterpolantFactoryMethodLinear=void 0;ly.prototype.InterpolantFactoryMethodSmooth=void 0;var u$=class extends du{};u$.prototype.ValueTypeName="color";var dA=class extends du{};dA.prototype.ValueTypeName="number";var ywe=class extends PC{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e,t,i,r){let n=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=(i-t)/(r-t),l=e*a;for(let c=l+a;l!==c;l+=4)ri.slerpFlat(n,0,s,l-a,s,l,o);return n}},Db=class extends du{InterpolantFactoryMethodLinear(e){return new ywe(this.times,this.values,this.getValueSize(),e)}};Db.prototype.ValueTypeName="quaternion";Db.prototype.DefaultInterpolation=sA;Db.prototype.InterpolantFactoryMethodSmooth=void 0;var cy=class extends du{};cy.prototype.ValueTypeName="string";cy.prototype.ValueBufferType=Array;cy.prototype.DefaultInterpolation=nA;cy.prototype.InterpolantFactoryMethodLinear=void 0;cy.prototype.InterpolantFactoryMethodSmooth=void 0;var fA=class extends du{};fA.prototype.ValueTypeName="vector";var JO=class{constructor(e,t=-1,i,r=ZU){this.name=e,this.tracks=i,this.duration=t,this.blendMode=r,this.uuid=gl(),this.duration<0&&this.resetDuration()}static parse(e){let t=[],i=e.tracks,r=1/(e.fps||1);for(let s=0,a=i.length;s!==a;++s)t.push(wwe(i[s]).scale(r));let n=new this(e.name,e.duration,t,e.blendMode);return n.uuid=e.uuid,n}static toJSON(e){let t=[],i=e.tracks,r={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let n=0,s=i.length;n!==s;++n)t.push(du.toJSON(i[n]));return r}static CreateFromMorphTargetSequence(e,t,i,r){let n=t.length,s=[];for(let a=0;a<n;a++){let o=[],l=[];o.push((a+n-1)%n,a,(a+1)%n),l.push(0,1,0);let c=mwe(o);o=rj(o,1,c),l=rj(l,1,c),!r&&o[0]===0&&(o.push(n),l.push(l[0])),s.push(new dA(".morphTargetInfluences["+t[a].name+"]",o,l).scale(1/i))}return new this(e,-1,s)}static findByName(e,t){let i=e;if(!Array.isArray(e)){let r=e;i=r.geometry&&r.geometry.animations||r.animations}for(let r=0;r<i.length;r++)if(i[r].name===t)return i[r];return null}static CreateClipsFromMorphTargetSequences(e,t,i){let r={},n=/^([\w-]*?)([\d]+)$/;for(let a=0,o=e.length;a<o;a++){let l=e[a],c=l.name.match(n);if(c&&c.length>1){let u=c[1],h=r[u];h||(r[u]=h=[]),h.push(l)}}let s=[];for(let a in r)s.push(this.CreateFromMorphTargetSequence(a,r[a],t,i));return s}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;let i=function(c,u,h,d,f){if(h.length!==0){let p=[],v=[];l$(h,p,v,d),p.length!==0&&f.push(new c(u,p,v))}},r=[],n=e.name||"default",s=e.fps||30,a=e.blendMode,o=e.length||-1,l=e.hierarchy||[];for(let c=0;c<l.length;c++){let u=l[c].keys;if(!(!u||u.length===0))if(u[0].morphTargets){let h={},d;for(d=0;d<u.length;d++)if(u[d].morphTargets)for(let f=0;f<u[d].morphTargets.length;f++)h[u[d].morphTargets[f]]=-1;for(let f in h){let p=[],v=[];for(let m=0;m!==u[d].morphTargets.length;++m){let g=u[d];p.push(g.time),v.push(g.morphTarget===f?1:0)}r.push(new dA(".morphTargetInfluence["+f+"]",p,v))}o=h.length*s}else{let h=".bones["+t[c].name+"]";i(fA,h+".position",u,"pos",r),i(Db,h+".quaternion",u,"rot",r),i(fA,h+".scale",u,"scl",r)}}return r.length===0?null:new this(n,o,r,a)}resetDuration(){let e=this.tracks,t=0;for(let i=0,r=e.length;i!==r;++i){let n=this.tracks[i];t=Math.max(t,n.times[n.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){let e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}};function xwe(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return dA;case"vector":case"vector2":case"vector3":case"vector4":return fA;case"color":return u$;case"quaternion":return Db;case"bool":case"boolean":return ly;case"string":return cy}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}function wwe(e){if(e.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");let t=xwe(e.type);if(e.times===void 0){let i=[],r=[];l$(e.keys,i,r,"value"),e.times=i,e.values=r}return t.parse!==void 0?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}var pA={enabled:!1,files:{},add:function(e,t){this.enabled!==!1&&(this.files[e]=t)},get:function(e){if(this.enabled!==!1)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}},h$=class{constructor(e,t,i){let r=this,n=!1,s=0,a=0,o,l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(c){a++,n===!1&&r.onStart!==void 0&&r.onStart(c,s,a),n=!0},this.itemEnd=function(c){s++,r.onProgress!==void 0&&r.onProgress(c,s,a),s===a&&(n=!1,r.onLoad!==void 0&&r.onLoad())},this.itemError=function(c){r.onError!==void 0&&r.onError(c)},this.resolveURL=function(c){return o?o(c):c},this.setURLModifier=function(c){return o=c,this},this.addHandler=function(c,u){return l.push(c,u),this},this.removeHandler=function(c){let u=l.indexOf(c);return u!==-1&&l.splice(u,2),this},this.getHandler=function(c){for(let u=0,h=l.length;u<h;u+=2){let d=l[u],f=l[u+1];if(d.global&&(d.lastIndex=0),d.test(c))return f}return null}}},bwe=new h$,Rb=class{constructor(e){this.manager=e!==void 0?e:bwe,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){let i=this;return new Promise(function(r,n){i.load(e,r,t,n)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}},Cu={},_we=class extends Error{constructor(e,t){super(e),this.response=t}},$O=class extends Rb{constructor(e){super(e)}load(e,t,i,r){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);let n=pA.get(e);if(n!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(n),this.manager.itemEnd(e)},0),n;if(Cu[e]!==void 0){Cu[e].push({onLoad:t,onProgress:i,onError:r});return}Cu[e]=[],Cu[e].push({onLoad:t,onProgress:i,onError:r});let s=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,o=this.responseType;fetch(s).then(l=>{if(l.status===200||l.status===0){if(l.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||l.body===void 0||l.body.getReader===void 0)return l;let c=Cu[e],u=l.body.getReader(),h=l.headers.get("Content-Length")||l.headers.get("X-File-Size"),d=h?parseInt(h):0,f=d!==0,p=0,v=new ReadableStream({start(m){g();function g(){u.read().then(({done:y,value:x})=>{if(y)m.close();else{p+=x.byteLength;let _=new ProgressEvent("progress",{lengthComputable:f,loaded:p,total:d});for(let M=0,S=c.length;M<S;M++){let T=c[M];T.onProgress&&T.onProgress(_)}m.enqueue(x),g()}})}}});return new Response(v)}else throw new _we(`fetch for "${l.url}" responded with ${l.status}: ${l.statusText}`,l)}).then(l=>{switch(o){case"arraybuffer":return l.arrayBuffer();case"blob":return l.blob();case"document":return l.text().then(c=>new DOMParser().parseFromString(c,a));case"json":return l.json();default:if(a===void 0)return l.text();{let c=/charset="?([^;"\s]*)"?/i.exec(a),u=c&&c[1]?c[1].toLowerCase():void 0,h=new TextDecoder(u);return l.arrayBuffer().then(d=>h.decode(d))}}}).then(l=>{pA.add(e,l);let c=Cu[e];delete Cu[e];for(let u=0,h=c.length;u<h;u++){let d=c[u];d.onLoad&&d.onLoad(l)}}).catch(l=>{let c=Cu[e];if(c===void 0)throw this.manager.itemError(e),l;delete Cu[e];for(let u=0,h=c.length;u<h;u++){let d=c[u];d.onError&&d.onError(l)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}},Swe=class extends Rb{constructor(e){super(e)}load(e,t,i,r){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);let n=this,s=pA.get(e);if(s!==void 0)return n.manager.itemStart(e),setTimeout(function(){t&&t(s),n.manager.itemEnd(e)},0),s;let a=Pw("img");function o(){c(),pA.add(e,this),t&&t(this),n.manager.itemEnd(e)}function l(u){c(),r&&r(u),n.manager.itemError(e),n.manager.itemEnd(e)}function c(){a.removeEventListener("load",o,!1),a.removeEventListener("error",l,!1)}return a.addEventListener("load",o,!1),a.addEventListener("error",l,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(a.crossOrigin=this.crossOrigin),n.manager.itemStart(e),a.src=e,a}},Mwe=class extends Rb{constructor(e){super(e)}load(e,t,i,r){let n=new jr,s=new Swe(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(e,function(a){n.image=a,n.needsUpdate=!0,t!==void 0&&t(n)},i,r),n}},Ib=class extends rr{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new Yt(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){let t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),t}},Ewe=class extends Ib{constructor(e,t,i){super(e,i),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(rr.DEFAULT_UP),this.updateMatrix(),this.groundColor=new Yt(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}},ZD=new ft,nj=new N,sj=new N,lN=class{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Me(512,512),this.map=null,this.mapPass=null,this.matrix=new ft,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new eN,this._frameExtents=new Me(1,1),this._viewportCount=1,this._viewports=[new ai(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){let t=this.camera,i=this.matrix;nj.setFromMatrixPosition(e.matrixWorld),t.position.copy(nj),sj.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(sj),t.updateMatrixWorld(),ZD.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(ZD),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(ZD)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){let e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}},Awe=class extends lN{constructor(){super(new ta(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){let t=this.camera,i=Cw*2*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height,n=e.distance||t.far;(i!==t.fov||r!==t.aspect||n!==t.far)&&(t.fov=i,t.aspect=r,t.far=n,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}},Twe=class extends Ib{constructor(t,i,r=0,n=Math.PI/3,s=0,a=2){super(t,i),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(rr.DEFAULT_UP),this.updateMatrix(),this.target=new rr,this.distance=r,this.angle=n,this.penumbra=s,this.decay=a,this.map=null,this.shadow=new Awe}get power(){return this.intensity*Math.PI}set power(t){this.intensity=t/Math.PI}dispose(){this.shadow.dispose()}copy(t,i){return super.copy(t,i),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}},aj=new ft,f1=new N,KD=new N,Cwe=class extends lN{constructor(){super(new ta(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Me(4,2),this._viewportCount=6,this._viewports=[new ai(2,1,1,1),new ai(0,1,1,1),new ai(3,1,1,1),new ai(1,1,1,1),new ai(3,0,1,1),new ai(1,0,1,1)],this._cubeDirections=[new N(1,0,0),new N(-1,0,0),new N(0,0,1),new N(0,0,-1),new N(0,1,0),new N(0,-1,0)],this._cubeUps=[new N(0,1,0),new N(0,1,0),new N(0,1,0),new N(0,1,0),new N(0,0,1),new N(0,0,-1)]}updateMatrices(e,t=0){let i=this.camera,r=this.matrix,n=e.distance||i.far;n!==i.far&&(i.far=n,i.updateProjectionMatrix()),f1.setFromMatrixPosition(e.matrixWorld),i.position.copy(f1),KD.copy(i.position),KD.add(this._cubeDirections[t]),i.up.copy(this._cubeUps[t]),i.lookAt(KD),i.updateMatrixWorld(),r.makeTranslation(-f1.x,-f1.y,-f1.z),aj.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(aj)}},Pwe=class extends Ib{constructor(e,t,i=0,r=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=r,this.shadow=new Cwe}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}},Dwe=class extends lN{constructor(){super(new EC(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}},Rwe=class extends Ib{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(rr.DEFAULT_UP),this.updateMatrix(),this.target=new rr,this.shadow=new Dwe}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}},d$=class extends Nt{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){let e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}},f$=class extends Rb{constructor(e){super(e)}load(e,t,i,r){let n=this,s=new $O(n.manager);s.setPath(n.path),s.setRequestHeader(n.requestHeader),s.setWithCredentials(n.withCredentials),s.load(e,function(a){try{t(n.parse(JSON.parse(a)))}catch(o){r?r(o):console.error(o),n.manager.itemError(e)}},i,r)}parse(e){let t={},i={};function r(h,d){if(t[d]!==void 0)return t[d];let f=h.interleavedBuffers[d],p=n(h,f.buffer),v=fS(f.type,p),m=new Oxe(v,f.stride);return m.uuid=f.uuid,t[d]=m,m}function n(h,d){if(i[d]!==void 0)return i[d];let f=h.arrayBuffers[d],p=new Uint32Array(f).buffer;return i[d]=p,p}let s=e.isInstancedBufferGeometry?new d$:new Nt,a=e.data.index;if(a!==void 0){let h=fS(a.type,a.array);s.setIndex(new Qt(h,1))}let o=e.data.attributes;for(let h in o){let d=o[h],f;if(d.isInterleavedBufferAttribute){let p=r(e.data,d.data);f=new QO(p,d.itemSize,d.offset,d.normalized)}else{let p=fS(d.type,d.array),v=d.isInstancedBufferAttribute?Dw:Qt;f=new v(p,d.itemSize,d.normalized)}d.name!==void 0&&(f.name=d.name),d.usage!==void 0&&f.setUsage(d.usage),d.updateRange!==void 0&&(f.updateRange.offset=d.updateRange.offset,f.updateRange.count=d.updateRange.count),s.setAttribute(h,f)}let l=e.data.morphAttributes;if(l)for(let h in l){let d=l[h],f=[];for(let p=0,v=d.length;p<v;p++){let m=d[p],g;if(m.isInterleavedBufferAttribute){let y=r(e.data,m.data);g=new QO(y,m.itemSize,m.offset,m.normalized)}else{let y=fS(m.type,m.array);g=new Qt(y,m.itemSize,m.normalized)}m.name!==void 0&&(g.name=m.name),f.push(g)}s.morphAttributes[h]=f}e.data.morphTargetsRelative&&(s.morphTargetsRelative=!0);let c=e.data.groups||e.data.drawcalls||e.data.offsets;if(c!==void 0)for(let h=0,d=c.length;h!==d;++h){let f=c[h];s.addGroup(f.start,f.count,f.materialIndex)}let u=e.data.boundingSphere;if(u!==void 0){let h=new N;u.center!==void 0&&h.fromArray(u.center),s.boundingSphere=new uo(h,u.radius)}return e.name&&(s.name=e.name),e.userData&&(s.userData=e.userData),s}},Iwe=class{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=oj(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){let t=oj();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}};function oj(){return(typeof performance>"u"?Date:performance).now()}var Lwe=class{constructor(e,t,i){this.binding=e,this.valueSize=i;let r,n,s;switch(t){case"quaternion":r=this._slerp,n=this._slerpAdditive,s=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(i*6),this._workIndex=5;break;case"string":case"bool":r=this._select,n=this._select,s=this._setAdditiveIdentityOther,this.buffer=new Array(i*5);break;default:r=this._lerp,n=this._lerpAdditive,s=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(i*5)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=n,this._setIdentity=s,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){let i=this.buffer,r=this.valueSize,n=e*r+r,s=this.cumulativeWeight;if(s===0){for(let a=0;a!==r;++a)i[n+a]=i[a];s=t}else{s+=t;let a=t/s;this._mixBufferRegion(i,n,0,a,r)}this.cumulativeWeight=s}accumulateAdditive(e){let t=this.buffer,i=this.valueSize,r=i*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(t,r,0,e,i),this.cumulativeWeightAdditive+=e}apply(e){let t=this.valueSize,i=this.buffer,r=e*t+t,n=this.cumulativeWeight,s=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,n<1){let o=t*this._origIndex;this._mixBufferRegion(i,r,o,1-n,t)}s>0&&this._mixBufferRegionAdditive(i,r,this._addIndex*t,1,t);for(let o=t,l=t+t;o!==l;++o)if(i[o]!==i[o+t]){a.setValue(i,r);break}}saveOriginalState(){let e=this.binding,t=this.buffer,i=this.valueSize,r=i*this._origIndex;e.getValue(t,r);for(let n=i,s=r;n!==s;++n)t[n]=t[r+n%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){let e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){let e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let i=e;i<t;i++)this.buffer[i]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){let e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[t+i]=this.buffer[e+i]}_select(e,t,i,r,n){if(r>=.5)for(let s=0;s!==n;++s)e[t+s]=e[i+s]}_slerp(e,t,i,r){ri.slerpFlat(e,t,e,t,e,i,r)}_slerpAdditive(e,t,i,r,n){let s=this._workIndex*n;ri.multiplyQuaternionsFlat(e,s,e,t,e,i),ri.slerpFlat(e,t,e,t,e,s,r)}_lerp(e,t,i,r,n){let s=1-r;for(let a=0;a!==n;++a){let o=t+a;e[o]=e[o]*s+e[i+a]*r}}_lerpAdditive(e,t,i,r,n){for(let s=0;s!==n;++s){let a=t+s;e[a]=e[a]+e[i+s]*r}}},cN="\\[\\]\\.:\\/",Owe=new RegExp("["+cN+"]","g"),uN="[^"+cN+"]",zwe="[^"+cN.replace("\\.","")+"]",Bwe=/((?:WC+[\/:])*)/.source.replace("WC",uN),Fwe=/(WCOD+)?/.source.replace("WCOD",zwe),Uwe=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",uN),Nwe=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",uN),kwe=new RegExp("^"+Bwe+Fwe+Uwe+Nwe+"$"),Vwe=["material","materials","bones","map"],Gwe=class{constructor(e,t,i){let r=i||dr.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}getValue(e,t){this.bind();let i=this._targetGroup.nCachedObjects_,r=this._bindings[i];r!==void 0&&r.getValue(e,t)}setValue(e,t){let i=this._bindings;for(let r=this._targetGroup.nCachedObjects_,n=i.length;r!==n;++r)i[r].setValue(e,t)}bind(){let e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()}unbind(){let e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}},dr=class{constructor(e,t,i){this.path=t,this.parsedPath=i||dr.parseTrackName(t),this.node=dr.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,i){return e&&e.isAnimationObjectGroup?new dr.Composite(e,t,i):new dr(e,t,i)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(Owe,"")}static parseTrackName(e){let t=kwe.exec(e);if(t===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);let i={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},r=i.nodeName&&i.nodeName.lastIndexOf(".");if(r!==void 0&&r!==-1){let n=i.nodeName.substring(r+1);Vwe.indexOf(n)!==-1&&(i.nodeName=i.nodeName.substring(0,r),i.objectName=n)}if(i.propertyName===null||i.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return i}static findNode(e,t){if(t===void 0||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){let i=e.skeleton.getBoneByName(t);if(i!==void 0)return i}if(e.children){let i=function(n){for(let s=0;s<n.length;s++){let a=n[s];if(a.name===t||a.uuid===t)return a;let o=i(a.children);if(o)return o}return null},r=i(e.children);if(r)return r}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){let i=this.resolvedProperty;for(let r=0,n=i.length;r!==n;++r)e[t++]=i[r]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){let i=this.resolvedProperty;for(let r=0,n=i.length;r!==n;++r)i[r]=e[t++]}_setValue_array_setNeedsUpdate(e,t){let i=this.resolvedProperty;for(let r=0,n=i.length;r!==n;++r)i[r]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){let i=this.resolvedProperty;for(let r=0,n=i.length;r!==n;++r)i[r]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node,t=this.parsedPath,i=t.objectName,r=t.propertyName,n=t.propertyIndex;if(e||(e=dr.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(i){let l=t.objectIndex;switch(i){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let c=0;c<e.length;c++)if(e[c].name===l){l=c;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[i]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[i]}if(l!==void 0){if(e[l]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[l]}}let s=e[r];if(s===void 0){let l=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+l+"."+r+" but it wasn't found.",e);return}let a=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?a=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(a=this.Versioning.MatrixWorldNeedsUpdate);let o=this.BindingType.Direct;if(n!==void 0){if(r==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[n]!==void 0&&(n=e.morphTargetDictionary[n])}o=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=n}else s.fromArray!==void 0&&s.toArray!==void 0?(o=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(o=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=r;this.getValue=this.GetterByBindingType[o],this.setValue=this.SetterByBindingTypeAndVersioning[o][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}};dr.Composite=Gwe;dr.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};dr.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};dr.prototype.GetterByBindingType=[dr.prototype._getValue_direct,dr.prototype._getValue_array,dr.prototype._getValue_arrayElement,dr.prototype._getValue_toArray];dr.prototype.SetterByBindingTypeAndVersioning=[[dr.prototype._setValue_direct,dr.prototype._setValue_direct_setNeedsUpdate,dr.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[dr.prototype._setValue_array,dr.prototype._setValue_array_setNeedsUpdate,dr.prototype._setValue_array_setMatrixWorldNeedsUpdate],[dr.prototype._setValue_arrayElement,dr.prototype._setValue_arrayElement_setNeedsUpdate,dr.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[dr.prototype._setValue_fromArray,dr.prototype._setValue_fromArray_setNeedsUpdate,dr.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];var Hwe=class{constructor(e,t,i=null,r=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=i,this.blendMode=r;let n=t.tracks,s=n.length,a=new Array(s),o={endingStart:Gv,endingEnd:Gv};for(let l=0;l!==s;++l){let c=n[l].createInterpolant(null);a[l]=c,c.settings=o}this._interpolantSettings=o,this._interpolants=a,this._propertyBindings=new Array(s),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=DJ,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,i){if(e.fadeOut(t),this.fadeIn(t),i){let r=this._clip.duration,n=e._clip.duration,s=n/r,a=r/n;e.warp(1,s,t),this.warp(a,1,t)}return this}crossFadeTo(e,t,i){return e.crossFadeFrom(this,t,i)}stopFading(){let e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,i){let r=this._mixer,n=r.time,s=this.timeScale,a=this._timeScaleInterpolant;a===null&&(a=r._lendControlInterpolant(),this._timeScaleInterpolant=a);let o=a.parameterPositions,l=a.sampleValues;return o[0]=n,o[1]=n+i,l[0]=e/s,l[1]=t/s,this}stopWarping(){let e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,i,r){if(!this.enabled){this._updateWeight(e);return}let n=this._startTime;if(n!==null){let o=(e-n)*i;o<0||i===0?t=0:(this._startTime=null,t=i*o)}t*=this._updateTimeScale(e);let s=this._updateTime(t),a=this._updateWeight(e);if(a>0){let o=this._interpolants,l=this._propertyBindings;switch(this.blendMode){case yge:for(let c=0,u=o.length;c!==u;++c)o[c].evaluate(s),l[c].accumulateAdditive(a);break;case ZU:default:for(let c=0,u=o.length;c!==u;++c)o[c].evaluate(s),l[c].accumulate(r,a)}}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;let i=this._weightInterpolant;if(i!==null){let r=i.evaluate(e)[0];t*=r,e>i.parameterPositions[1]&&(this.stopFading(),r===0&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;let i=this._timeScaleInterpolant;if(i!==null){let r=i.evaluate(e)[0];t*=r,e>i.parameterPositions[1]&&(this.stopWarping(),t===0?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){let t=this._clip.duration,i=this.loop,r=this.time+e,n=this._loopCount,s=i===QU;if(e===0)return n===-1?r:s&&(n&1)===1?t-r:r;if(i===PJ){n===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(r>=t)r=t;else if(r<0)r=0;else{this.time=r;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(n===-1&&(e>=0?(n=0,this._setEndings(!0,this.repetitions===0,s)):this._setEndings(this.repetitions===0,!0,s)),r>=t||r<0){let a=Math.floor(r/t);r-=t*a,n+=Math.abs(a);let o=this.repetitions-n;if(o<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=e>0?t:0,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(o===1){let l=e<0;this._setEndings(l,!l,s)}else this._setEndings(!1,!1,s);this._loopCount=n,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a})}}else this.time=r;if(s&&(n&1)===1)return t-r}return r}_setEndings(e,t,i){let r=this._interpolantSettings;i?(r.endingStart=Hv,r.endingEnd=Hv):(e?r.endingStart=this.zeroSlopeAtStart?Hv:Gv:r.endingStart=aA,t?r.endingEnd=this.zeroSlopeAtEnd?Hv:Gv:r.endingEnd=aA)}_scheduleFading(e,t,i){let r=this._mixer,n=r.time,s=this._weightInterpolant;s===null&&(s=r._lendControlInterpolant(),this._weightInterpolant=s);let a=s.parameterPositions,o=s.sampleValues;return a[0]=n,o[0]=t,a[1]=n+e,o[1]=i,this}},jwe=new Float32Array(1),Wwe=class extends Vs{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){let i=e._localRoot||this._root,r=e._clip.tracks,n=r.length,s=e._propertyBindings,a=e._interpolants,o=i.uuid,l=this._bindingsByRootAndName,c=l[o];c===void 0&&(c={},l[o]=c);for(let u=0;u!==n;++u){let h=r[u],d=h.name,f=c[d];if(f!==void 0)++f.referenceCount,s[u]=f;else{if(f=s[u],f!==void 0){f._cacheIndex===null&&(++f.referenceCount,this._addInactiveBinding(f,o,d));continue}let p=t&&t._propertyBindings[u].binding.parsedPath;f=new Lwe(dr.create(i,d,p),h.ValueTypeName,h.getValueSize()),++f.referenceCount,this._addInactiveBinding(f,o,d),s[u]=f}a[u].resultBuffer=f.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){let i=(e._localRoot||this._root).uuid,r=e._clip.uuid,n=this._actionsByClip[r];this._bindAction(e,n&&n.knownActions[0]),this._addInactiveAction(e,r,i)}let t=e._propertyBindings;for(let i=0,r=t.length;i!==r;++i){let n=t[i];n.useCount++===0&&(this._lendBinding(n),n.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){let t=e._propertyBindings;for(let i=0,r=t.length;i!==r;++i){let n=t[i];--n.useCount===0&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;let e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){let t=e._cacheIndex;return t!==null&&t<this._nActiveActions}_addInactiveAction(e,t,i){let r=this._actions,n=this._actionsByClip,s=n[t];if(s===void 0)s={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,n[t]=s;else{let a=s.knownActions;e._byClipCacheIndex=a.length,a.push(e)}e._cacheIndex=r.length,r.push(e),s.actionByRoot[i]=e}_removeInactiveAction(e){let t=this._actions,i=t[t.length-1],r=e._cacheIndex;i._cacheIndex=r,t[r]=i,t.pop(),e._cacheIndex=null;let n=e._clip.uuid,s=this._actionsByClip,a=s[n],o=a.knownActions,l=o[o.length-1],c=e._byClipCacheIndex;l._byClipCacheIndex=c,o[c]=l,o.pop(),e._byClipCacheIndex=null;let u=a.actionByRoot,h=(e._localRoot||this._root).uuid;delete u[h],o.length===0&&delete s[n],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){let t=e._propertyBindings;for(let i=0,r=t.length;i!==r;++i){let n=t[i];--n.referenceCount===0&&this._removeInactiveBinding(n)}}_lendAction(e){let t=this._actions,i=e._cacheIndex,r=this._nActiveActions++,n=t[r];e._cacheIndex=r,t[r]=e,n._cacheIndex=i,t[i]=n}_takeBackAction(e){let t=this._actions,i=e._cacheIndex,r=--this._nActiveActions,n=t[r];e._cacheIndex=r,t[r]=e,n._cacheIndex=i,t[i]=n}_addInactiveBinding(e,t,i){let r=this._bindingsByRootAndName,n=this._bindings,s=r[t];s===void 0&&(s={},r[t]=s),s[i]=e,e._cacheIndex=n.length,n.push(e)}_removeInactiveBinding(e){let t=this._bindings,i=e.binding,r=i.rootNode.uuid,n=i.path,s=this._bindingsByRootAndName,a=s[r],o=t[t.length-1],l=e._cacheIndex;o._cacheIndex=l,t[l]=o,t.pop(),delete a[n],Object.keys(a).length===0&&delete s[r]}_lendBinding(e){let t=this._bindings,i=e._cacheIndex,r=this._nActiveBindings++,n=t[r];e._cacheIndex=r,t[r]=e,n._cacheIndex=i,t[i]=n}_takeBackBinding(e){let t=this._bindings,i=e._cacheIndex,r=--this._nActiveBindings,n=t[r];e._cacheIndex=r,t[r]=e,n._cacheIndex=i,t[i]=n}_lendControlInterpolant(){let e=this._controlInterpolants,t=this._nActiveControlInterpolants++,i=e[t];return i===void 0&&(i=new c$(new Float32Array(2),new Float32Array(2),1,jwe),i.__cacheIndex=t,e[t]=i),i}_takeBackControlInterpolant(e){let t=this._controlInterpolants,i=e.__cacheIndex,r=--this._nActiveControlInterpolants,n=t[r];e.__cacheIndex=r,t[r]=e,n.__cacheIndex=i,t[i]=n}clipAction(e,t,i){let r=t||this._root,n=r.uuid,s=typeof e=="string"?JO.findByName(r,e):e,a=s!==null?s.uuid:e,o=this._actionsByClip[a],l=null;if(i===void 0&&(s!==null?i=s.blendMode:i=ZU),o!==void 0){let u=o.actionByRoot[n];if(u!==void 0&&u.blendMode===i)return u;l=o.knownActions[0],s===null&&(s=l._clip)}if(s===null)return null;let c=new Hwe(this,s,t,i);return this._bindAction(c,l),this._addInactiveAction(c,a,n),c}existingAction(e,t){let i=t||this._root,r=i.uuid,n=typeof e=="string"?JO.findByName(i,e):e,s=n?n.uuid:e,a=this._actionsByClip[s];return a!==void 0&&a.actionByRoot[r]||null}stopAllAction(){let e=this._actions,t=this._nActiveActions;for(let i=t-1;i>=0;--i)e[i].stop();return this}update(e){e*=this.timeScale;let t=this._actions,i=this._nActiveActions,r=this.time+=e,n=Math.sign(e),s=this._accuIndex^=1;for(let l=0;l!==i;++l)t[l]._update(r,e,n,s);let a=this._bindings,o=this._nActiveBindings;for(let l=0;l!==o;++l)a[l].apply(s);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){let t=this._actions,i=e.uuid,r=this._actionsByClip,n=r[i];if(n!==void 0){let s=n.knownActions;for(let a=0,o=s.length;a!==o;++a){let l=s[a];this._deactivateAction(l);let c=l._cacheIndex,u=t[t.length-1];l._cacheIndex=null,l._byClipCacheIndex=null,u._cacheIndex=c,t[c]=u,t.pop(),this._removeInactiveBindingsForAction(l)}delete r[i]}}uncacheRoot(e){let t=e.uuid,i=this._actionsByClip;for(let s in i){let a=i[s].actionByRoot,o=a[t];o!==void 0&&(this._deactivateAction(o),this._removeInactiveAction(o))}let r=this._bindingsByRootAndName,n=r[t];if(n!==void 0)for(let s in n){let a=n[s];a.restoreOriginalState(),this._removeInactiveBinding(a)}}uncacheAction(e,t){let i=this.existingAction(e,t);i!==null&&(this._deactivateAction(i),this._removeInactiveAction(i))}},ct=class{constructor(e){this.value=e}clone(){return new ct(this.value.clone===void 0?this.value:this.value.clone())}},p$=class{constructor(e,t,i=0,r=1/0){this.ray=new sy(e,t),this.near=i,this.far=r,this.camera=null,this.layers=new JU,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!0,i=[]){return ez(e,this,i,t),i.sort(lj),i}intersectObjects(e,t=!0,i=[]){for(let r=0,n=e.length;r<n;r++)ez(e[r],this,i,t);return i.sort(lj),i}};function lj(e,t){return e.distance-t.distance}function ez(e,t,i,r){if(e.layers.test(t.layers)&&e.raycast(t,i),r===!0){let n=e.children;for(let s=0,a=n.length;s<a;s++)ez(n[s],t,i,!0)}}var cj=class{constructor(e=1,t=0,i=0){return this.radius=e,this.phi=t,this.theta=i,this}set(e,t,i){return this.radius=e,this.phi=t,this.theta=i,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+t*t+i*i),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,i),this.phi=Math.acos(Tn(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}},uj=new Me,hN=class{constructor(e=new Me(1/0,1/0),t=new Me(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){let i=uj.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return uj.copy(e).clamp(this.min,this.max).sub(e).length()}intersect(e){return this.min.max(e.min),this.max.min(e.max),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}},hj=new N,US=new N,vl=class{constructor(e=new N,t=new N){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){hj.subVectors(e,this.start),US.subVectors(this.end,this.start);let i=US.dot(US),r=US.dot(hj)/i;return t&&(r=Tn(r,0,1)),r}closestPointToPoint(e,t,i){let r=this.closestPointToPointParameter(e,t);return this.delta(i).multiplyScalar(r).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}},dj=new N,Xwe=class extends rr{constructor(e,t){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t,this.type="SpotLightHelper";let i=new Nt,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let s=0,a=1,o=32;s<o;s++,a++){let l=s/o*Math.PI*2,c=a/o*Math.PI*2;r.push(Math.cos(l),Math.sin(l),1,Math.cos(c),Math.sin(c),1)}i.setAttribute("position",new _t(r,3));let n=new Pf({fog:!1,toneMapped:!1});this.cone=new Pb(i,n),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1);let e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),dj.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(dj),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}},qwe=class extends yr{constructor(e,t,i){let r=new l0(t,4,2),n=new Ch({wireframe:!0,fog:!1,toneMapped:!1});super(r,n),this.light=e,this.color=i,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}},fj=new N,NS=new N,pj=new N,Ywe=class extends rr{constructor(e,t,i){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,this.type="DirectionalLightHelper",t===void 0&&(t=1);let r=new Nt;r.setAttribute("position",new _t([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));let n=new Pf({fog:!1,toneMapped:!1});this.lightPlane=new cA(r,n),this.add(this.lightPlane),r=new Nt,r.setAttribute("position",new _t([0,0,0,0,0,1],3)),this.targetLine=new cA(r,n),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),fj.setFromMatrixPosition(this.light.matrixWorld),NS.setFromMatrixPosition(this.light.target.matrixWorld),pj.subVectors(NS,fj),this.lightPlane.lookAt(NS),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(NS),this.targetLine.scale.z=pj.length()}},kS=new N,Qr=new Cf,mA=class extends Pb{constructor(e){let t=new Nt,i=new Pf({color:16777215,vertexColors:!0,toneMapped:!1}),r=[],n=[],s={};a("n1","n2"),a("n2","n4"),a("n4","n3"),a("n3","n1"),a("f1","f2"),a("f2","f4"),a("f4","f3"),a("f3","f1"),a("n1","f1"),a("n2","f2"),a("n3","f3"),a("n4","f4"),a("p","n1"),a("p","n2"),a("p","n3"),a("p","n4"),a("u1","u2"),a("u2","u3"),a("u3","u1"),a("c","t"),a("p","c"),a("cn1","cn2"),a("cn3","cn4"),a("cf1","cf2"),a("cf3","cf4");function a(f,p){o(f),o(p)}function o(f){r.push(0,0,0),n.push(0,0,0),s[f]===void 0&&(s[f]=[]),s[f].push(r.length/3-1)}t.setAttribute("position",new _t(r,3)),t.setAttribute("color",new _t(n,3)),super(t,i),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update();let l=new Yt(16755200),c=new Yt(16711680),u=new Yt(43775),h=new Yt(16777215),d=new Yt(3355443);this.setColors(l,c,u,h,d)}setColors(e,t,i,r,n){let s=this.geometry.getAttribute("color");s.setXYZ(0,e.r,e.g,e.b),s.setXYZ(1,e.r,e.g,e.b),s.setXYZ(2,e.r,e.g,e.b),s.setXYZ(3,e.r,e.g,e.b),s.setXYZ(4,e.r,e.g,e.b),s.setXYZ(5,e.r,e.g,e.b),s.setXYZ(6,e.r,e.g,e.b),s.setXYZ(7,e.r,e.g,e.b),s.setXYZ(8,e.r,e.g,e.b),s.setXYZ(9,e.r,e.g,e.b),s.setXYZ(10,e.r,e.g,e.b),s.setXYZ(11,e.r,e.g,e.b),s.setXYZ(12,e.r,e.g,e.b),s.setXYZ(13,e.r,e.g,e.b),s.setXYZ(14,e.r,e.g,e.b),s.setXYZ(15,e.r,e.g,e.b),s.setXYZ(16,e.r,e.g,e.b),s.setXYZ(17,e.r,e.g,e.b),s.setXYZ(18,e.r,e.g,e.b),s.setXYZ(19,e.r,e.g,e.b),s.setXYZ(20,e.r,e.g,e.b),s.setXYZ(21,e.r,e.g,e.b),s.setXYZ(22,e.r,e.g,e.b),s.setXYZ(23,e.r,e.g,e.b),s.setXYZ(24,t.r,t.g,t.b),s.setXYZ(25,t.r,t.g,t.b),s.setXYZ(26,t.r,t.g,t.b),s.setXYZ(27,t.r,t.g,t.b),s.setXYZ(28,t.r,t.g,t.b),s.setXYZ(29,t.r,t.g,t.b),s.setXYZ(30,t.r,t.g,t.b),s.setXYZ(31,t.r,t.g,t.b),s.setXYZ(32,i.r,i.g,i.b),s.setXYZ(33,i.r,i.g,i.b),s.setXYZ(34,i.r,i.g,i.b),s.setXYZ(35,i.r,i.g,i.b),s.setXYZ(36,i.r,i.g,i.b),s.setXYZ(37,i.r,i.g,i.b),s.setXYZ(38,r.r,r.g,r.b),s.setXYZ(39,r.r,r.g,r.b),s.setXYZ(40,n.r,n.g,n.b),s.setXYZ(41,n.r,n.g,n.b),s.setXYZ(42,n.r,n.g,n.b),s.setXYZ(43,n.r,n.g,n.b),s.setXYZ(44,n.r,n.g,n.b),s.setXYZ(45,n.r,n.g,n.b),s.setXYZ(46,n.r,n.g,n.b),s.setXYZ(47,n.r,n.g,n.b),s.setXYZ(48,n.r,n.g,n.b),s.setXYZ(49,n.r,n.g,n.b),s.needsUpdate=!0}update(){let e=this.geometry,t=this.pointMap,i=1,r=1;Qr.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),on("c",t,e,Qr,0,0,-1),on("t",t,e,Qr,0,0,1),on("n1",t,e,Qr,-i,-r,-1),on("n2",t,e,Qr,i,-r,-1),on("n3",t,e,Qr,-i,r,-1),on("n4",t,e,Qr,i,r,-1),on("f1",t,e,Qr,-i,-r,1),on("f2",t,e,Qr,i,-r,1),on("f3",t,e,Qr,-i,r,1),on("f4",t,e,Qr,i,r,1),on("u1",t,e,Qr,i*.7,r*1.1,-1),on("u2",t,e,Qr,-i*.7,r*1.1,-1),on("u3",t,e,Qr,0,r*2,-1),on("cf1",t,e,Qr,-i,0,1),on("cf2",t,e,Qr,i,0,1),on("cf3",t,e,Qr,0,-r,1),on("cf4",t,e,Qr,0,r,1),on("cn1",t,e,Qr,-i,0,-1),on("cn2",t,e,Qr,i,0,-1),on("cn3",t,e,Qr,0,-r,-1),on("cn4",t,e,Qr,0,r,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}};function on(e,t,i,r,n,s,a){kS.set(n,s,a).unproject(r);let o=t[e];if(o!==void 0){let l=i.getAttribute("position");for(let c=0,u=o.length;c<u;c++)l.setXYZ(o[c],kS.x,kS.y,kS.z)}}var gA=class extends Pb{constructor(e,t=16776960){let i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],n=new Nt;n.setIndex(new Qt(i,1)),n.setAttribute("position",new _t(r,3)),super(n,new Pf({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){let t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}},Qwe=class extends Pb{constructor(e=1){let t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],i=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],r=new Nt;r.setAttribute("position",new _t(t,3)),r.setAttribute("color",new _t(i,3));let n=new Pf({vertexColors:!0,toneMapped:!1});super(r,n),this.type="AxesHelper"}setColors(e,t,i){let r=new Yt,n=this.geometry.attributes.color.array;return r.set(e),r.toArray(n,0),r.toArray(n,3),r.set(t),r.toArray(n,6),r.toArray(n,9),r.set(i),r.toArray(n,12),r.toArray(n,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}},th=Zwe();function Zwe(){let e=new ArrayBuffer(4),t=new Float32Array(e),i=new Uint32Array(e),r=new Uint32Array(512),n=new Uint32Array(512);for(let l=0;l<256;++l){let c=l-127;c<-27?(r[l]=0,r[l|256]=32768,n[l]=24,n[l|256]=24):c<-14?(r[l]=1024>>-c-14,r[l|256]=1024>>-c-14|32768,n[l]=-c-1,n[l|256]=-c-1):c<=15?(r[l]=c+15<<10,r[l|256]=c+15<<10|32768,n[l]=13,n[l|256]=13):c<128?(r[l]=31744,r[l|256]=64512,n[l]=24,n[l|256]=24):(r[l]=31744,r[l|256]=64512,n[l]=13,n[l|256]=13)}let s=new Uint32Array(2048),a=new Uint32Array(64),o=new Uint32Array(64);for(let l=1;l<1024;++l){let c=l<<13,u=0;for(;!(c&8388608);)c<<=1,u-=8388608;c&=-8388609,u+=947912704,s[l]=c|u}for(let l=1024;l<2048;++l)s[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)a[l]=l<<23;a[31]=1199570944,a[32]=2147483648;for(let l=33;l<63;++l)a[l]=2147483648+(l-32<<23);a[63]=3347054592;for(let l=1;l<64;++l)l!==32&&(o[l]=1024);return{floatView:t,uint32View:i,baseTable:r,shiftTable:n,mantissaTable:s,exponentTable:a,offsetTable:o}}function Kwe(e){Math.abs(e)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),e=Tn(e,-65504,65504),th.floatView[0]=e;let t=th.uint32View[0],i=t>>23&511;return th.baseTable[i]+((t&8388607)>>th.shiftTable[i])}function Jwe(e){let t=e>>10;return th.uint32View[0]=th.mantissaTable[th.offsetTable[t]+(e&1023)]+th.exponentTable[t],th.floatView[0]}var $we=Object.freeze({__proto__:null,fromHalfFloat:Jwe,toHalfFloat:Kwe});typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:ny}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=ny);var p1=".",dN=Symbol("target"),m$=Symbol("unsubscribe");function tz(e){return e instanceof Date||e instanceof Set||e instanceof Map||e instanceof WeakSet||e instanceof WeakMap||ArrayBuffer.isView(e)}function ebe(e){return(typeof e=="object"?e===null:typeof e!="function")||e instanceof RegExp}var Vc=Array.isArray;function fN(e){return typeof e=="symbol"}var tbe={after:(e,t)=>Vc(e)?e.slice(t.length):t===""?e:e.slice(t.length+1),concat:(e,t)=>Vc(e)?(e=[...e],t&&e.push(t),e):t&&t.toString!==void 0?(e!==""&&(e+=p1),fN(t)?e+t.toString():e+t):e,initial:e=>{if(Vc(e))return e.slice(0,-1);if(e==="")return e;let t=e.lastIndexOf(p1);return t===-1?"":e.slice(0,t)},last:e=>{if(Vc(e))return e[e.length-1]||"";if(e==="")return e;let t=e.lastIndexOf(p1);return t===-1?e:e.slice(t+1)},walk:(e,t)=>{if(Vc(e))for(let i of e)t(i);else if(e!==""){let i=0,r=e.indexOf(p1);if(r===-1)t(e);else for(;i<e.length;)r===-1&&(r=e.length),t(e.slice(i,r)),i=r+1,r=e.indexOf(p1,i)}},get(e,t){return this.walk(t,i=>{e&&(e=e[i])}),e}},sl=tbe;function ibe(e){return typeof e=="object"&&typeof e.next=="function"}function rbe(e,t,i,r,n){let s=e.next;if(t.name==="entries")e.next=function(){let a=s.call(this);return a.done===!1&&(a.value[0]=n(a.value[0],t,a.value[0],r),a.value[1]=n(a.value[1],t,a.value[0],r)),a};else if(t.name==="values"){let a=i[dN].keys();e.next=function(){let o=s.call(this);return o.done===!1&&(o.value=n(o.value,t,a.next().value,r)),o}}else e.next=function(){let a=s.call(this);return a.done===!1&&(a.value=n(a.value,t,a.value,r)),a};return e}function mj(e,t,i){return e.isUnsubscribed||t.ignoreSymbols&&fN(i)||t.ignoreUnderscores&&i.charAt(0)==="_"||"ignoreKeys"in t&&t.ignoreKeys.includes(i)}var nbe=class{constructor(e){this._equals=e,this._proxyCache=new WeakMap,this._pathCache=new WeakMap,this.isUnsubscribed=!1}_getDescriptorCache(){return this._descriptorCache===void 0&&(this._descriptorCache=new WeakMap),this._descriptorCache}_getProperties(e){let t=this._getDescriptorCache(),i=t.get(e);return i===void 0&&(i={},t.set(e,i)),i}_getOwnPropertyDescriptor(e,t){if(this.isUnsubscribed)return Reflect.getOwnPropertyDescriptor(e,t);let i=this._getProperties(e),r=i[t];return r===void 0&&(r=Reflect.getOwnPropertyDescriptor(e,t),i[t]=r),r}getProxy(e,t,i,r){if(this.isUnsubscribed)return e;let n=e[r],s=n||e;this._pathCache.set(s,t);let a=this._proxyCache.get(s);return a===void 0&&(a=n===void 0?new Proxy(e,i):e,this._proxyCache.set(s,a)),a}getPath(e){return this.isUnsubscribed?void 0:this._pathCache.get(e)}isDetached(e,t){return!Object.is(e,sl.get(t,this.getPath(e)))}defineProperty(e,t,i){return Reflect.defineProperty(e,t,i)?(this.isUnsubscribed||(this._getProperties(e)[t]=i),!0):!1}setProperty(e,t,i,r,n){if(!this._equals(n,i)||!(t in e)){let s=this._getOwnPropertyDescriptor(e,t);return s!==void 0&&"set"in s?Reflect.set(e,t,i,r):Reflect.set(e,t,i)}return!0}deleteProperty(e,t,i){if(Reflect.deleteProperty(e,t)){if(!this.isUnsubscribed){let r=this._getDescriptorCache().get(e);r&&(delete r[t],this._pathCache.delete(i))}return!0}return!1}isSameDescriptor(e,t,i){let r=this._getOwnPropertyDescriptor(t,i);return e!==void 0&&r!==void 0&&Object.is(e.value,r.value)&&(e.writable||!1)===(r.writable||!1)&&(e.enumerable||!1)===(r.enumerable||!1)&&(e.configurable||!1)===(r.configurable||!1)&&e.get===r.get&&e.set===r.set}isGetInvariant(e,t){let i=this._getOwnPropertyDescriptor(e,t);return i!==void 0&&i.configurable!==!0&&i.writable!==!0}unsubscribe(){this._descriptorCache=null,this._pathCache=null,this._proxyCache=null,this.isUnsubscribed=!0}};function iz(e){return toString.call(e)==="[object Object]"}function VS(){return!0}function Dg(e,t){return e.length!==t.length||e.some((i,r)=>t[r]!==i)}var g$=new Set(["hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]),sbe=new Set(["concat","includes","indexOf","join","keys","lastIndexOf"]),v$={push:VS,pop:VS,shift:VS,unshift:VS,copyWithin:Dg,reverse:Dg,sort:Dg,splice:Dg,flat:Dg,fill:Dg},abe=new Set([...g$,...sbe,...Object.keys(v$)]);function GS(e,t){if(e.size!==t.size)return!0;for(let i of e)if(!t.has(i))return!0;return!1}var y$=["keys","values","entries"],x$=new Set(["has","toString"]),w$={add:GS,clear:GS,delete:GS,forEach:GS},obe=new Set([...x$,...Object.keys(w$),...y$]);function HS(e,t){if(e.size!==t.size)return!0;let i;for(let[r,n]of e)if(i=t.get(r),i!==n||i===void 0&&!t.has(r))return!0;return!1}var lbe=new Set([...x$,"get"]),b$={set:HS,clear:HS,delete:HS,forEach:HS},cbe=new Set([...lbe,...Object.keys(b$),...y$]),vf=class{constructor(e,t,i,r){this._path=t,this._isChanged=!1,this._clonedCache=new Set,this._hasOnValidate=r,this._changes=r?[]:null,this.clone=t===void 0?e:this._shallowClone(e)}static isHandledMethod(e){return g$.has(e)}_shallowClone(e){let t=e;if(iz(e))t={...e};else if(Vc(e))t=[...e];else if(e instanceof Date)t=new Date(e);else if(e instanceof Set)t=new Set([...e].map(i=>this._shallowClone(i)));else if(e instanceof Map){t=new Map;for(let[i,r]of e.entries())t.set(i,this._shallowClone(r))}return this._clonedCache.add(t),t}preferredThisArg(e,t,i,r){return e?(Vc(r)?this._onIsChanged=v$[t]:r instanceof Set?this._onIsChanged=w$[t]:r instanceof Map&&(this._onIsChanged=b$[t]),r):i}update(e,t,i){let r=sl.after(e,this._path);if(t!=="length"){let n=this.clone;sl.walk(r,s=>{n&&n[s]&&(this._clonedCache.has(n[s])||(n[s]=this._shallowClone(n[s])),n=n[s])}),this._hasOnValidate&&this._changes.push({path:r,property:t,previous:i}),n&&n[t]&&(n[t]=i)}this._isChanged=!0}undo(e){let t;for(let i=this._changes.length-1;i!==-1;i--)t=this._changes[i],sl.get(e,t.path)[t.property]=t.previous}isChanged(e){return this._onIsChanged===void 0?this._isChanged:this._onIsChanged(this.clone,e)}},gj=class extends vf{static isHandledMethod(e){return abe.has(e)}},ube=class extends vf{undo(e){e.setTime(this.clone.getTime())}isChanged(e,t){return!t(this.clone.valueOf(),e.valueOf())}},vj=class extends vf{static isHandledMethod(e){return obe.has(e)}undo(e){for(let t of this.clone)e.add(t);for(let t of e)this.clone.has(t)||e.delete(t)}},yj=class extends vf{static isHandledMethod(e){return cbe.has(e)}undo(e){for(let[t,i]of this.clone.entries())e.set(t,i);for(let t of e.keys())this.clone.has(t)||e.delete(t)}},hbe=class extends vf{constructor(e,t,i,r){super(void 0,t,i,r),this._arg1=i[0],this._weakValue=e.has(this._arg1)}isChanged(e){return this._weakValue!==e.has(this._arg1)}undo(e){this._weakValue&&!e.has(this._arg1)?e.add(this._arg1):e.delete(this._arg1)}},dbe=class extends vf{constructor(e,t,i,r){super(void 0,t,i,r),this._weakKey=i[0],this._weakHas=e.has(this._weakKey),this._weakValue=e.get(this._weakKey)}isChanged(e){return this._weakValue!==e.get(this._weakKey)}undo(e){let t=e.has(this._weakKey);this._weakHas&&!t?e.set(this._weakKey,this._weakValue):!this._weakHas&&t?e.delete(this._weakKey):this._weakValue!==e.get(this._weakKey)&&e.set(this._weakKey,this._weakValue)}},gv=class{constructor(e){this._stack=[],this._hasOnValidate=e}static isHandledType(e){return iz(e)||Vc(e)||tz(e)}static isHandledMethod(e,t){return iz(e)?vf.isHandledMethod(t):Vc(e)?gj.isHandledMethod(t):e instanceof Set?vj.isHandledMethod(t):e instanceof Map?yj.isHandledMethod(t):tz(e)}get isCloning(){return this._stack.length>0}start(e,t,i){let r=vf;Vc(e)?r=gj:e instanceof Date?r=ube:e instanceof Set?r=vj:e instanceof Map?r=yj:e instanceof WeakSet?r=hbe:e instanceof WeakMap&&(r=dbe),this._stack.push(new r(e,t,i,this._hasOnValidate))}update(e,t,i){this._stack[this._stack.length-1].update(e,t,i)}preferredThisArg(e,t,i){let{name:r}=e,n=gv.isHandledMethod(i,r);return this._stack[this._stack.length-1].preferredThisArg(n,r,t,i)}isChanged(e,t,i){return this._stack[this._stack.length-1].isChanged(e,t,i)}undo(e){this._previousClone!==void 0&&this._previousClone.undo(e)}stop(){return this._previousClone=this._stack.pop(),this._previousClone.clone}},fbe={equals:Object.is,isShallow:!1,pathAsArray:!1,ignoreSymbols:!1,ignoreUnderscores:!1,ignoreDetached:!1,details:!1},pN=(e,t,i={})=>{i={...fbe,...i};let r=Symbol("ProxyTarget"),{equals:n,isShallow:s,ignoreDetached:a,details:o}=i,l=new nbe(n),c=typeof i.onValidate=="function",u=new gv(c),h=(y,x,_,M,S)=>!c||u.isCloning||i.onValidate(sl.concat(l.getPath(y),x),_,M,S)===!0,d=(y,x,_,M)=>{!mj(l,i,x)&&!(a&&l.isDetached(y,e))&&f(l.getPath(y),x,_,M)},f=(y,x,_,M,S)=>{u.isCloning?u.update(y,x,M):t(sl.concat(y,x),_,M,S)},p=y=>y&&(y[r]||y),v=(y,x,_,M)=>ebe(y)||_==="constructor"||s&&!gv.isHandledMethod(x,_)||mj(l,i,_)||l.isGetInvariant(x,_)||a&&l.isDetached(x,e)?y:(M===void 0&&(M=l.getPath(x)),l.getProxy(y,sl.concat(M,_),m,r)),m={get(y,x,_){if(fN(x)){if(x===r||x===dN)return y;if(x===m$&&!l.isUnsubscribed&&l.getPath(y).length===0)return l.unsubscribe(),y}let M=tz(y)?Reflect.get(y,x):Reflect.get(y,x,_);return v(M,y,x)},set(y,x,_,M){_=p(_);let S=y[r]||y,T=S[x];if(n(T,_)&&x in y)return!0;let E=h(y,x,_,T);return E&&l.setProperty(S,x,_,M,T)?(d(y,x,y[x],T),!0):!E},defineProperty(y,x,_){if(!l.isSameDescriptor(_,y,x)){let M=y[x];h(y,x,_.value,M)&&l.defineProperty(y,x,_,M)&&d(y,x,_.value,M)}return!0},deleteProperty(y,x){if(!Reflect.has(y,x))return!0;let _=Reflect.get(y,x),M=h(y,x,void 0,_);return M&&l.deleteProperty(y,x,_)?(d(y,x,void 0,_),!0):!M},apply(y,x,_){let M=x[r]||x;if(l.isUnsubscribed)return Reflect.apply(y,M,_);if((o===!1||o!==!0&&!o.includes(y.name))&&gv.isHandledType(M)){let S=sl.initial(l.getPath(y)),T=gv.isHandledMethod(M,y.name);u.start(M,S,_);let E=Reflect.apply(y,u.preferredThisArg(y,x,M),T?_.map(D=>p(D)):_),C=u.isChanged(M,n),A=u.stop();if(gv.isHandledType(E)&&T&&(x instanceof Map&&y.name==="get"&&(S=sl.concat(S,_[0])),E=l.getProxy(E,S,m)),C){let D={name:y.name,args:_,result:E},R=u.isCloning?sl.initial(S):S,L=u.isCloning?sl.last(S):"";h(sl.get(e,R),L,M,A,D)?f(R,L,M,A,D):u.undo(M)}return(x instanceof Map||x instanceof Set)&&ibe(E)?rbe(E,y,x,S,v):E}return Reflect.apply(y,x,_)}},g=l.getProxy(e,i.pathAsArray?[]:"",m);return t=t.bind(g),c&&(i.onValidate=i.onValidate.bind(g)),g};pN.target=e=>e&&e[dN]||e;pN.unsubscribe=e=>e[m$]||e;var xj=pN,pbe=typeof global=="object"&&global&&global.Object===Object&&global,_$=pbe,mbe=typeof self=="object"&&self&&self.Object===Object&&self,gbe=_$||mbe||Function("return this")(),uc=gbe,vbe=uc.Symbol,bl=vbe,S$=Object.prototype,ybe=S$.hasOwnProperty,xbe=S$.toString,m1=bl?bl.toStringTag:void 0;function wbe(e){var t=ybe.call(e,m1),i=e[m1];try{e[m1]=void 0;var r=!0}catch{}var n=xbe.call(e);return r&&(t?e[m1]=i:delete e[m1]),n}var bbe=wbe,_be=Object.prototype,Sbe=_be.toString;function Mbe(e){return Sbe.call(e)}var Ebe=Mbe,Abe="[object Null]",Tbe="[object Undefined]",wj=bl?bl.toStringTag:void 0;function Cbe(e){return e==null?e===void 0?Tbe:Abe:wj&&wj in Object(e)?bbe(e):Ebe(e)}var Wm=Cbe;function Pbe(e){return e!=null&&typeof e=="object"}var Ph=Pbe,Dbe="[object Symbol]";function Rbe(e){return typeof e=="symbol"||Ph(e)&&Wm(e)==Dbe}var Lb=Rbe;function Ibe(e,t){for(var i=-1,r=e==null?0:e.length,n=Array(r);++i<r;)n[i]=t(e[i],i,e);return n}var M$=Ibe,Lbe=Array.isArray,ou=Lbe,Obe=1/0,bj=bl?bl.prototype:void 0,_j=bj?bj.toString:void 0;function E$(e){if(typeof e=="string")return e;if(ou(e))return M$(e,E$)+"";if(Lb(e))return _j?_j.call(e):"";var t=e+"";return t=="0"&&1/e==-Obe?"-0":t}var zbe=E$,Bbe=/\s/;function Fbe(e){for(var t=e.length;t--&&Bbe.test(e.charAt(t)););return t}var Ube=Fbe,Nbe=/^\s+/;function kbe(e){return e&&e.slice(0,Ube(e)+1).replace(Nbe,"")}var Vbe=kbe;function Gbe(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var oc=Gbe,Sj=NaN,Hbe=/^[-+]0x[0-9a-f]+$/i,jbe=/^0b[01]+$/i,Wbe=/^0o[0-7]+$/i,Xbe=parseInt;function qbe(e){if(typeof e=="number")return e;if(Lb(e))return Sj;if(oc(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=oc(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=Vbe(e);var i=jbe.test(e);return i||Wbe.test(e)?Xbe(e.slice(2),i?2:8):Hbe.test(e)?Sj:+e}var Mj=qbe;function Ybe(e){return e}var A$=Ybe,Qbe="[object AsyncFunction]",Zbe="[object Function]",Kbe="[object GeneratorFunction]",Jbe="[object Proxy]";function $be(e){if(!oc(e))return!1;var t=Wm(e);return t==Zbe||t==Kbe||t==Qbe||t==Jbe}var T$=$be,e_e=uc["__core-js_shared__"],JD=e_e,Ej=function(){var e=/[^.]+$/.exec(JD&&JD.keys&&JD.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function t_e(e){return!!Ej&&Ej in e}var i_e=t_e,r_e=Function.prototype,n_e=r_e.toString;function s_e(e){if(e!=null){try{return n_e.call(e)}catch{}try{return e+""}catch{}}return""}var Xm=s_e,a_e=/[\\^$.*+?()[\]{}|]/g,o_e=/^\[object .+?Constructor\]$/,l_e=Function.prototype,c_e=Object.prototype,u_e=l_e.toString,h_e=c_e.hasOwnProperty,d_e=RegExp("^"+u_e.call(h_e).replace(a_e,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function f_e(e){if(!oc(e)||i_e(e))return!1;var t=T$(e)?d_e:o_e;return t.test(Xm(e))}var p_e=f_e;function m_e(e,t){return e==null?void 0:e[t]}var g_e=m_e;function v_e(e,t){var i=g_e(e,t);return p_e(i)?i:void 0}var qm=v_e,y_e=qm(uc,"WeakMap"),rz=y_e,Aj=Object.create,x_e=function(){function e(){}return function(t){if(!oc(t))return{};if(Aj)return Aj(t);e.prototype=t;var i=new e;return e.prototype=void 0,i}}(),w_e=x_e;function b_e(e,t,i){switch(i.length){case 0:return e.call(t);case 1:return e.call(t,i[0]);case 2:return e.call(t,i[0],i[1]);case 3:return e.call(t,i[0],i[1],i[2])}return e.apply(t,i)}var __e=b_e;function S_e(e,t){var i=-1,r=e.length;for(t||(t=Array(r));++i<r;)t[i]=e[i];return t}var M_e=S_e,E_e=800,A_e=16,T_e=Date.now;function C_e(e){var t=0,i=0;return function(){var r=T_e(),n=A_e-(r-i);if(i=r,n>0){if(++t>=E_e)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}var P_e=C_e;function D_e(e){return function(){return e}}var R_e=D_e,I_e=function(){try{var e=qm(Object,"defineProperty");return e({},"",{}),e}catch{}}(),vA=I_e,L_e=vA?function(e,t){return vA(e,"toString",{configurable:!0,enumerable:!1,value:R_e(t),writable:!0})}:A$,O_e=L_e,z_e=P_e(O_e),B_e=z_e;function F_e(e,t){for(var i=-1,r=e==null?0:e.length;++i<r&&t(e[i],i,e)!==!1;);return e}var U_e=F_e,N_e=9007199254740991,k_e=/^(?:0|[1-9]\d*)$/;function V_e(e,t){var i=typeof e;return t=t??N_e,!!t&&(i=="number"||i!="symbol"&&k_e.test(e))&&e>-1&&e%1==0&&e<t}var mN=V_e;function G_e(e,t,i){t=="__proto__"&&vA?vA(e,t,{configurable:!0,enumerable:!0,value:i,writable:!0}):e[t]=i}var C$=G_e;function H_e(e,t){return e===t||e!==e&&t!==t}var gN=H_e,j_e=Object.prototype,W_e=j_e.hasOwnProperty;function X_e(e,t,i){var r=e[t];(!(W_e.call(e,t)&&gN(r,i))||i===void 0&&!(t in e))&&C$(e,t,i)}var vN=X_e;function q_e(e,t,i,r){var n=!i;i||(i={});for(var s=-1,a=t.length;++s<a;){var o=t[s],l=r?r(i[o],e[o],o,i,e):void 0;l===void 0&&(l=e[o]),n?C$(i,o,l):vN(i,o,l)}return i}var Ob=q_e,Tj=Math.max;function Y_e(e,t,i){return t=Tj(t===void 0?e.length-1:t,0),function(){for(var r=arguments,n=-1,s=Tj(r.length-t,0),a=Array(s);++n<s;)a[n]=r[t+n];n=-1;for(var o=Array(t+1);++n<t;)o[n]=r[n];return o[t]=i(a),__e(e,this,o)}}var Q_e=Y_e,Z_e=9007199254740991;function K_e(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=Z_e}var yN=K_e;function J_e(e){return e!=null&&yN(e.length)&&!T$(e)}var P$=J_e,$_e=Object.prototype;function eSe(e){var t=e&&e.constructor,i=typeof t=="function"&&t.prototype||$_e;return e===i}var xN=eSe;function tSe(e,t){for(var i=-1,r=Array(e);++i<e;)r[i]=t(i);return r}var iSe=tSe,rSe="[object Arguments]";function nSe(e){return Ph(e)&&Wm(e)==rSe}var Cj=nSe,D$=Object.prototype,sSe=D$.hasOwnProperty,aSe=D$.propertyIsEnumerable,oSe=Cj(function(){return arguments}())?Cj:function(e){return Ph(e)&&sSe.call(e,"callee")&&!aSe.call(e,"callee")},wN=oSe;function lSe(){return!1}var cSe=lSe,R$=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Pj=R$&&typeof module=="object"&&module&&!module.nodeType&&module,uSe=Pj&&Pj.exports===R$,Dj=uSe?uc.Buffer:void 0,hSe=Dj?Dj.isBuffer:void 0,dSe=hSe||cSe,yA=dSe,fSe="[object Arguments]",pSe="[object Array]",mSe="[object Boolean]",gSe="[object Date]",vSe="[object Error]",ySe="[object Function]",xSe="[object Map]",wSe="[object Number]",bSe="[object Object]",_Se="[object RegExp]",SSe="[object Set]",MSe="[object String]",ESe="[object WeakMap]",ASe="[object ArrayBuffer]",TSe="[object DataView]",CSe="[object Float32Array]",PSe="[object Float64Array]",DSe="[object Int8Array]",RSe="[object Int16Array]",ISe="[object Int32Array]",LSe="[object Uint8Array]",OSe="[object Uint8ClampedArray]",zSe="[object Uint16Array]",BSe="[object Uint32Array]",Er={};Er[CSe]=Er[PSe]=Er[DSe]=Er[RSe]=Er[ISe]=Er[LSe]=Er[OSe]=Er[zSe]=Er[BSe]=!0;Er[fSe]=Er[pSe]=Er[ASe]=Er[mSe]=Er[TSe]=Er[gSe]=Er[vSe]=Er[ySe]=Er[xSe]=Er[wSe]=Er[bSe]=Er[_Se]=Er[SSe]=Er[MSe]=Er[ESe]=!1;function FSe(e){return Ph(e)&&yN(e.length)&&!!Er[Wm(e)]}var USe=FSe;function NSe(e){return function(t){return e(t)}}var bN=NSe,I$=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Lx=I$&&typeof module=="object"&&module&&!module.nodeType&&module,kSe=Lx&&Lx.exports===I$,$D=kSe&&_$.process,VSe=function(){try{var e=Lx&&Lx.require&&Lx.require("util").types;return e||$D&&$D.binding&&$D.binding("util")}catch{}}(),z0=VSe,Rj=z0&&z0.isTypedArray,GSe=Rj?bN(Rj):USe,L$=GSe,HSe=Object.prototype,jSe=HSe.hasOwnProperty;function WSe(e,t){var i=ou(e),r=!i&&wN(e),n=!i&&!r&&yA(e),s=!i&&!r&&!n&&L$(e),a=i||r||n||s,o=a?iSe(e.length,String):[],l=o.length;for(var c in e)(t||jSe.call(e,c))&&!(a&&(c=="length"||n&&(c=="offset"||c=="parent")||s&&(c=="buffer"||c=="byteLength"||c=="byteOffset")||mN(c,l)))&&o.push(c);return o}var O$=WSe;function XSe(e,t){return function(i){return e(t(i))}}var z$=XSe,qSe=z$(Object.keys,Object),YSe=qSe,QSe=Object.prototype,ZSe=QSe.hasOwnProperty;function KSe(e){if(!xN(e))return YSe(e);var t=[];for(var i in Object(e))ZSe.call(e,i)&&i!="constructor"&&t.push(i);return t}var JSe=KSe;function $Se(e){return P$(e)?O$(e):JSe(e)}var _N=$Se;function eMe(e){var t=[];if(e!=null)for(var i in Object(e))t.push(i);return t}var tMe=eMe,iMe=Object.prototype,rMe=iMe.hasOwnProperty;function nMe(e){if(!oc(e))return tMe(e);var t=xN(e),i=[];for(var r in e)r=="constructor"&&(t||!rMe.call(e,r))||i.push(r);return i}var sMe=nMe;function aMe(e){return P$(e)?O$(e,!0):sMe(e)}var jp=aMe,oMe=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,lMe=/^\w*$/;function cMe(e,t){if(ou(e))return!1;var i=typeof e;return i=="number"||i=="symbol"||i=="boolean"||e==null||Lb(e)?!0:lMe.test(e)||!oMe.test(e)||t!=null&&e in Object(t)}var uMe=cMe,hMe=qm(Object,"create"),Ow=hMe;function dMe(){this.__data__=Ow?Ow(null):{},this.size=0}var fMe=dMe;function pMe(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var mMe=pMe,gMe="__lodash_hash_undefined__",vMe=Object.prototype,yMe=vMe.hasOwnProperty;function xMe(e){var t=this.__data__;if(Ow){var i=t[e];return i===gMe?void 0:i}return yMe.call(t,e)?t[e]:void 0}var wMe=xMe,bMe=Object.prototype,_Me=bMe.hasOwnProperty;function SMe(e){var t=this.__data__;return Ow?t[e]!==void 0:_Me.call(t,e)}var MMe=SMe,EMe="__lodash_hash_undefined__";function AMe(e,t){var i=this.__data__;return this.size+=this.has(e)?0:1,i[e]=Ow&&t===void 0?EMe:t,this}var TMe=AMe;function uy(e){var t=-1,i=e==null?0:e.length;for(this.clear();++t<i;){var r=e[t];this.set(r[0],r[1])}}uy.prototype.clear=fMe;uy.prototype.delete=mMe;uy.prototype.get=wMe;uy.prototype.has=MMe;uy.prototype.set=TMe;var Ij=uy;function CMe(){this.__data__=[],this.size=0}var PMe=CMe;function DMe(e,t){for(var i=e.length;i--;)if(gN(e[i][0],t))return i;return-1}var DC=DMe,RMe=Array.prototype,IMe=RMe.splice;function LMe(e){var t=this.__data__,i=DC(t,e);if(i<0)return!1;var r=t.length-1;return i==r?t.pop():IMe.call(t,i,1),--this.size,!0}var OMe=LMe;function zMe(e){var t=this.__data__,i=DC(t,e);return i<0?void 0:t[i][1]}var BMe=zMe;function FMe(e){return DC(this.__data__,e)>-1}var UMe=FMe;function NMe(e,t){var i=this.__data__,r=DC(i,e);return r<0?(++this.size,i.push([e,t])):i[r][1]=t,this}var kMe=NMe;function hy(e){var t=-1,i=e==null?0:e.length;for(this.clear();++t<i;){var r=e[t];this.set(r[0],r[1])}}hy.prototype.clear=PMe;hy.prototype.delete=OMe;hy.prototype.get=BMe;hy.prototype.has=UMe;hy.prototype.set=kMe;var RC=hy,VMe=qm(uc,"Map"),zw=VMe;function GMe(){this.size=0,this.__data__={hash:new Ij,map:new(zw||RC),string:new Ij}}var HMe=GMe;function jMe(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}var WMe=jMe;function XMe(e,t){var i=e.__data__;return WMe(t)?i[typeof t=="string"?"string":"hash"]:i.map}var IC=XMe;function qMe(e){var t=IC(this,e).delete(e);return this.size-=t?1:0,t}var YMe=qMe;function QMe(e){return IC(this,e).get(e)}var ZMe=QMe;function KMe(e){return IC(this,e).has(e)}var JMe=KMe;function $Me(e,t){var i=IC(this,e),r=i.size;return i.set(e,t),this.size+=i.size==r?0:1,this}var eEe=$Me;function dy(e){var t=-1,i=e==null?0:e.length;for(this.clear();++t<i;){var r=e[t];this.set(r[0],r[1])}}dy.prototype.clear=HMe;dy.prototype.delete=YMe;dy.prototype.get=ZMe;dy.prototype.has=JMe;dy.prototype.set=eEe;var LC=dy,tEe="Expected a function";function SN(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(tEe);var i=function(){var r=arguments,n=t?t.apply(this,r):r[0],s=i.cache;if(s.has(n))return s.get(n);var a=e.apply(this,r);return i.cache=s.set(n,a)||s,a};return i.cache=new(SN.Cache||LC),i}SN.Cache=LC;var iEe=SN,rEe=500;function nEe(e){var t=iEe(e,function(r){return i.size===rEe&&i.clear(),r}),i=t.cache;return t}var sEe=nEe,aEe=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,oEe=/\\(\\)?/g,lEe=sEe(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(aEe,function(i,r,n,s){t.push(n?s.replace(oEe,"$1"):r||i)}),t}),cEe=lEe;function uEe(e){return e==null?"":zbe(e)}var hEe=uEe;function dEe(e,t){return ou(e)?e:uMe(e,t)?[e]:cEe(hEe(e))}var fy=dEe,fEe=1/0;function pEe(e){if(typeof e=="string"||Lb(e))return e;var t=e+"";return t=="0"&&1/e==-fEe?"-0":t}var OC=pEe;function mEe(e,t){t=fy(t,e);for(var i=0,r=t.length;e!=null&&i<r;)e=e[OC(t[i++])];return i&&i==r?e:void 0}var B$=mEe;function gEe(e,t){for(var i=-1,r=t.length,n=e.length;++i<r;)e[n+i]=t[i];return e}var MN=gEe,Lj=bl?bl.isConcatSpreadable:void 0;function vEe(e){return ou(e)||wN(e)||!!(Lj&&e&&e[Lj])}var yEe=vEe;function F$(e,t,i,r,n){var s=-1,a=e.length;for(i||(i=yEe),n||(n=[]);++s<a;){var o=e[s];t>0&&i(o)?t>1?F$(o,t-1,i,r,n):MN(n,o):r||(n[n.length]=o)}return n}var xEe=F$;function wEe(e){var t=e==null?0:e.length;return t?xEe(e,1):[]}var bEe=wEe;function _Ee(e){return B_e(Q_e(e,void 0,bEe),e+"")}var U$=_Ee,SEe=z$(Object.getPrototypeOf,Object),EN=SEe,MEe="[object Object]",EEe=Function.prototype,AEe=Object.prototype,N$=EEe.toString,TEe=AEe.hasOwnProperty,CEe=N$.call(Object);function PEe(e){if(!Ph(e)||Wm(e)!=MEe)return!1;var t=EN(e);if(t===null)return!0;var i=TEe.call(t,"constructor")&&t.constructor;return typeof i=="function"&&i instanceof i&&N$.call(i)==CEe}var DEe=PEe;function REe(e,t,i){var r=-1,n=e.length;t<0&&(t=-t>n?0:n+t),i=i>n?n:i,i<0&&(i+=n),n=t>i?0:i-t>>>0,t>>>=0;for(var s=Array(n);++r<n;)s[r]=e[r+t];return s}var IEe=REe;function LEe(){this.__data__=new RC,this.size=0}var OEe=LEe;function zEe(e){var t=this.__data__,i=t.delete(e);return this.size=t.size,i}var BEe=zEe;function FEe(e){return this.__data__.get(e)}var UEe=FEe;function NEe(e){return this.__data__.has(e)}var kEe=NEe,VEe=200;function GEe(e,t){var i=this.__data__;if(i instanceof RC){var r=i.__data__;if(!zw||r.length<VEe-1)return r.push([e,t]),this.size=++i.size,this;i=this.__data__=new LC(r)}return i.set(e,t),this.size=i.size,this}var HEe=GEe;function py(e){var t=this.__data__=new RC(e);this.size=t.size}py.prototype.clear=OEe;py.prototype.delete=BEe;py.prototype.get=UEe;py.prototype.has=kEe;py.prototype.set=HEe;var t2=py;function jEe(e,t){return e&&Ob(t,_N(t),e)}var WEe=jEe;function XEe(e,t){return e&&Ob(t,jp(t),e)}var qEe=XEe,k$=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Oj=k$&&typeof module=="object"&&module&&!module.nodeType&&module,YEe=Oj&&Oj.exports===k$,zj=YEe?uc.Buffer:void 0,Bj=zj?zj.allocUnsafe:void 0;function QEe(e,t){if(t)return e.slice();var i=e.length,r=Bj?Bj(i):new e.constructor(i);return e.copy(r),r}var ZEe=QEe;function KEe(e,t){for(var i=-1,r=e==null?0:e.length,n=0,s=[];++i<r;){var a=e[i];t(a,i,e)&&(s[n++]=a)}return s}var JEe=KEe;function $Ee(){return[]}var V$=$Ee,e2e=Object.prototype,t2e=e2e.propertyIsEnumerable,Fj=Object.getOwnPropertySymbols,i2e=Fj?function(e){return e==null?[]:(e=Object(e),JEe(Fj(e),function(t){return t2e.call(e,t)}))}:V$,AN=i2e;function r2e(e,t){return Ob(e,AN(e),t)}var n2e=r2e,s2e=Object.getOwnPropertySymbols,a2e=s2e?function(e){for(var t=[];e;)MN(t,AN(e)),e=EN(e);return t}:V$,G$=a2e;function o2e(e,t){return Ob(e,G$(e),t)}var l2e=o2e;function c2e(e,t,i){var r=t(e);return ou(e)?r:MN(r,i(e))}var H$=c2e;function u2e(e){return H$(e,_N,AN)}var nz=u2e;function h2e(e){return H$(e,jp,G$)}var j$=h2e,d2e=qm(uc,"DataView"),sz=d2e,f2e=qm(uc,"Promise"),az=f2e,p2e=qm(uc,"Set"),oz=p2e,Uj="[object Map]",m2e="[object Object]",Nj="[object Promise]",kj="[object Set]",Vj="[object WeakMap]",Gj="[object DataView]",g2e=Xm(sz),v2e=Xm(zw),y2e=Xm(az),x2e=Xm(oz),w2e=Xm(rz),Ep=Wm;(sz&&Ep(new sz(new ArrayBuffer(1)))!=Gj||zw&&Ep(new zw)!=Uj||az&&Ep(az.resolve())!=Nj||oz&&Ep(new oz)!=kj||rz&&Ep(new rz)!=Vj)&&(Ep=function(e){var t=Wm(e),i=t==m2e?e.constructor:void 0,r=i?Xm(i):"";if(r)switch(r){case g2e:return Gj;case v2e:return Uj;case y2e:return Nj;case x2e:return kj;case w2e:return Vj}return t});var Bw=Ep,b2e=Object.prototype,_2e=b2e.hasOwnProperty;function S2e(e){var t=e.length,i=new e.constructor(t);return t&&typeof e[0]=="string"&&_2e.call(e,"index")&&(i.index=e.index,i.input=e.input),i}var M2e=S2e,E2e=uc.Uint8Array,xA=E2e;function A2e(e){var t=new e.constructor(e.byteLength);return new xA(t).set(new xA(e)),t}var TN=A2e;function T2e(e,t){var i=t?TN(e.buffer):e.buffer;return new e.constructor(i,e.byteOffset,e.byteLength)}var C2e=T2e,P2e=/\w*$/;function D2e(e){var t=new e.constructor(e.source,P2e.exec(e));return t.lastIndex=e.lastIndex,t}var R2e=D2e,Hj=bl?bl.prototype:void 0,jj=Hj?Hj.valueOf:void 0;function I2e(e){return jj?Object(jj.call(e)):{}}var L2e=I2e;function O2e(e,t){var i=t?TN(e.buffer):e.buffer;return new e.constructor(i,e.byteOffset,e.length)}var z2e=O2e,B2e="[object Boolean]",F2e="[object Date]",U2e="[object Map]",N2e="[object Number]",k2e="[object RegExp]",V2e="[object Set]",G2e="[object String]",H2e="[object Symbol]",j2e="[object ArrayBuffer]",W2e="[object DataView]",X2e="[object Float32Array]",q2e="[object Float64Array]",Y2e="[object Int8Array]",Q2e="[object Int16Array]",Z2e="[object Int32Array]",K2e="[object Uint8Array]",J2e="[object Uint8ClampedArray]",$2e="[object Uint16Array]",eAe="[object Uint32Array]";function tAe(e,t,i){var r=e.constructor;switch(t){case j2e:return TN(e);case B2e:case F2e:return new r(+e);case W2e:return C2e(e,i);case X2e:case q2e:case Y2e:case Q2e:case Z2e:case K2e:case J2e:case $2e:case eAe:return z2e(e,i);case U2e:return new r;case N2e:case G2e:return new r(e);case k2e:return R2e(e);case V2e:return new r;case H2e:return L2e(e)}}var iAe=tAe;function rAe(e){return typeof e.constructor=="function"&&!xN(e)?w_e(EN(e)):{}}var nAe=rAe,sAe="[object Map]";function aAe(e){return Ph(e)&&Bw(e)==sAe}var oAe=aAe,Wj=z0&&z0.isMap,lAe=Wj?bN(Wj):oAe,cAe=lAe,uAe="[object Set]";function hAe(e){return Ph(e)&&Bw(e)==uAe}var dAe=hAe,Xj=z0&&z0.isSet,fAe=Xj?bN(Xj):dAe,pAe=fAe,mAe=1,gAe=2,vAe=4,W$="[object Arguments]",yAe="[object Array]",xAe="[object Boolean]",wAe="[object Date]",bAe="[object Error]",X$="[object Function]",_Ae="[object GeneratorFunction]",SAe="[object Map]",MAe="[object Number]",q$="[object Object]",EAe="[object RegExp]",AAe="[object Set]",TAe="[object String]",CAe="[object Symbol]",PAe="[object WeakMap]",DAe="[object ArrayBuffer]",RAe="[object DataView]",IAe="[object Float32Array]",LAe="[object Float64Array]",OAe="[object Int8Array]",zAe="[object Int16Array]",BAe="[object Int32Array]",FAe="[object Uint8Array]",UAe="[object Uint8ClampedArray]",NAe="[object Uint16Array]",kAe="[object Uint32Array]",wr={};wr[W$]=wr[yAe]=wr[DAe]=wr[RAe]=wr[xAe]=wr[wAe]=wr[IAe]=wr[LAe]=wr[OAe]=wr[zAe]=wr[BAe]=wr[SAe]=wr[MAe]=wr[q$]=wr[EAe]=wr[AAe]=wr[TAe]=wr[CAe]=wr[FAe]=wr[UAe]=wr[NAe]=wr[kAe]=!0;wr[bAe]=wr[X$]=wr[PAe]=!1;function i2(e,t,i,r,n,s){var a,o=t&mAe,l=t&gAe,c=t&vAe;if(i&&(a=n?i(e,r,n,s):i(e)),a!==void 0)return a;if(!oc(e))return e;var u=ou(e);if(u){if(a=M2e(e),!o)return M_e(e,a)}else{var h=Bw(e),d=h==X$||h==_Ae;if(yA(e))return ZEe(e,o);if(h==q$||h==W$||d&&!n){if(a=l||d?{}:nAe(e),!o)return l?l2e(e,qEe(a,e)):n2e(e,WEe(a,e))}else{if(!wr[h])return n?e:{};a=iAe(e,h,o)}}s||(s=new t2);var f=s.get(e);if(f)return f;s.set(e,a),pAe(e)?e.forEach(function(m){a.add(i2(m,t,i,m,e,s))}):cAe(e)&&e.forEach(function(m,g){a.set(g,i2(m,t,i,g,e,s))});var p=c?l?j$:nz:l?jp:_N,v=u?void 0:p(e);return U_e(v||e,function(m,g){v&&(g=m,m=e[g]),vN(a,g,i2(m,t,i,g,e,s))}),a}var Y$=i2,VAe=1,GAe=4;function HAe(e){return Y$(e,VAe|GAe)}var zC=HAe,jAe="__lodash_hash_undefined__";function WAe(e){return this.__data__.set(e,jAe),this}var XAe=WAe;function qAe(e){return this.__data__.has(e)}var YAe=qAe;function wA(e){var t=-1,i=e==null?0:e.length;for(this.__data__=new LC;++t<i;)this.add(e[t])}wA.prototype.add=wA.prototype.push=XAe;wA.prototype.has=YAe;var QAe=wA;function ZAe(e,t){for(var i=-1,r=e==null?0:e.length;++i<r;)if(t(e[i],i,e))return!0;return!1}var KAe=ZAe;function JAe(e,t){return e.has(t)}var $Ae=JAe,eTe=1,tTe=2;function iTe(e,t,i,r,n,s){var a=i&eTe,o=e.length,l=t.length;if(o!=l&&!(a&&l>o))return!1;var c=s.get(e),u=s.get(t);if(c&&u)return c==t&&u==e;var h=-1,d=!0,f=i&tTe?new QAe:void 0;for(s.set(e,t),s.set(t,e);++h<o;){var p=e[h],v=t[h];if(r)var m=a?r(v,p,h,t,e,s):r(p,v,h,e,t,s);if(m!==void 0){if(m)continue;d=!1;break}if(f){if(!KAe(t,function(g,y){if(!$Ae(f,y)&&(p===g||n(p,g,i,r,s)))return f.push(y)})){d=!1;break}}else if(!(p===v||n(p,v,i,r,s))){d=!1;break}}return s.delete(e),s.delete(t),d}var Q$=iTe;function rTe(e){var t=-1,i=Array(e.size);return e.forEach(function(r,n){i[++t]=[n,r]}),i}var nTe=rTe;function sTe(e){var t=-1,i=Array(e.size);return e.forEach(function(r){i[++t]=r}),i}var aTe=sTe,oTe=1,lTe=2,cTe="[object Boolean]",uTe="[object Date]",hTe="[object Error]",dTe="[object Map]",fTe="[object Number]",pTe="[object RegExp]",mTe="[object Set]",gTe="[object String]",vTe="[object Symbol]",yTe="[object ArrayBuffer]",xTe="[object DataView]",qj=bl?bl.prototype:void 0,eR=qj?qj.valueOf:void 0;function wTe(e,t,i,r,n,s,a){switch(i){case xTe:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case yTe:return!(e.byteLength!=t.byteLength||!s(new xA(e),new xA(t)));case cTe:case uTe:case fTe:return gN(+e,+t);case hTe:return e.name==t.name&&e.message==t.message;case pTe:case gTe:return e==t+"";case dTe:var o=nTe;case mTe:var l=r&oTe;if(o||(o=aTe),e.size!=t.size&&!l)return!1;var c=a.get(e);if(c)return c==t;r|=lTe,a.set(e,t);var u=Q$(o(e),o(t),r,n,s,a);return a.delete(e),u;case vTe:if(eR)return eR.call(e)==eR.call(t)}return!1}var bTe=wTe,_Te=1,STe=Object.prototype,MTe=STe.hasOwnProperty;function ETe(e,t,i,r,n,s){var a=i&_Te,o=nz(e),l=o.length,c=nz(t),u=c.length;if(l!=u&&!a)return!1;for(var h=l;h--;){var d=o[h];if(!(a?d in t:MTe.call(t,d)))return!1}var f=s.get(e),p=s.get(t);if(f&&p)return f==t&&p==e;var v=!0;s.set(e,t),s.set(t,e);for(var m=a;++h<l;){d=o[h];var g=e[d],y=t[d];if(r)var x=a?r(y,g,d,t,e,s):r(g,y,d,e,t,s);if(!(x===void 0?g===y||n(g,y,i,r,s):x)){v=!1;break}m||(m=d=="constructor")}if(v&&!m){var _=e.constructor,M=t.constructor;_!=M&&"constructor"in e&&"constructor"in t&&!(typeof _=="function"&&_ instanceof _&&typeof M=="function"&&M instanceof M)&&(v=!1)}return s.delete(e),s.delete(t),v}var ATe=ETe,TTe=1,Yj="[object Arguments]",Qj="[object Array]",jS="[object Object]",CTe=Object.prototype,Zj=CTe.hasOwnProperty;function PTe(e,t,i,r,n,s){var a=ou(e),o=ou(t),l=a?Qj:Bw(e),c=o?Qj:Bw(t);l=l==Yj?jS:l,c=c==Yj?jS:c;var u=l==jS,h=c==jS,d=l==c;if(d&&yA(e)){if(!yA(t))return!1;a=!0,u=!1}if(d&&!u)return s||(s=new t2),a||L$(e)?Q$(e,t,i,r,n,s):bTe(e,t,l,i,r,n,s);if(!(i&TTe)){var f=u&&Zj.call(e,"__wrapped__"),p=h&&Zj.call(t,"__wrapped__");if(f||p){var v=f?e.value():e,m=p?t.value():t;return s||(s=new t2),n(v,m,i,r,s)}}return d?(s||(s=new t2),ATe(e,t,i,r,n,s)):!1}var DTe=PTe;function Z$(e,t,i,r,n){return e===t?!0:e==null||t==null||!Ph(e)&&!Ph(t)?e!==e&&t!==t:DTe(e,t,i,r,Z$,n)}var RTe=Z$;function ITe(e,t){return e!=null&&t in Object(e)}var LTe=ITe;function OTe(e,t,i){t=fy(t,e);for(var r=-1,n=t.length,s=!1;++r<n;){var a=OC(t[r]);if(!(s=e!=null&&i(e,a)))break;e=e[a]}return s||++r!=n?s:(n=e==null?0:e.length,!!n&&yN(n)&&mN(a,n)&&(ou(e)||wN(e)))}var zTe=OTe;function BTe(e,t){return e!=null&&zTe(e,t,LTe)}var FTe=BTe,UTe=function(){return uc.Date.now()},tR=UTe,NTe="Expected a function",kTe=Math.max,VTe=Math.min;function GTe(e,t,i){var r,n,s,a,o,l,c=0,u=!1,h=!1,d=!0;if(typeof e!="function")throw new TypeError(NTe);t=Mj(t)||0,oc(i)&&(u=!!i.leading,h="maxWait"in i,s=h?kTe(Mj(i.maxWait)||0,t):s,d="trailing"in i?!!i.trailing:d);function f(S){var T=r,E=n;return r=n=void 0,c=S,a=e.apply(E,T),a}function p(S){return c=S,o=setTimeout(g,t),u?f(S):a}function v(S){var T=S-l,E=S-c,C=t-T;return h?VTe(C,s-E):C}function m(S){var T=S-l,E=S-c;return l===void 0||T>=t||T<0||h&&E>=s}function g(){var S=tR();if(m(S))return y(S);o=setTimeout(g,v(S))}function y(S){return o=void 0,d&&r?f(S):(r=n=void 0,a)}function x(){o!==void 0&&clearTimeout(o),c=0,r=l=n=o=void 0}function _(){return o===void 0?a:y(tR())}function M(){var S=tR(),T=m(S);if(r=arguments,n=this,l=S,T){if(o===void 0)return p(l);if(h)return clearTimeout(o),o=setTimeout(g,t),f(l)}return o===void 0&&(o=setTimeout(g,t)),a}return M.cancel=x,M.flush=_,M}var Fw=GTe;function HTe(e){var t=e==null?0:e.length;return t?e[t-1]:void 0}var jTe=HTe;function WTe(e,t){return e>t}var XTe=WTe;function qTe(e,t){return t.length<2?e:B$(e,IEe(t,0,-1))}var YTe=qTe;function QTe(e,t){return RTe(e,t)}var CN=QTe;function ZTe(e,t,i){for(var r=-1,n=e.length;++r<n;){var s=e[r],a=t(s);if(a!=null&&(o===void 0?a===a&&!Lb(a):i(a,o)))var o=a,l=s}return l}var KTe=ZTe;function JTe(e){return e&&e.length?KTe(e,A$,XTe):void 0}var $Te=JTe;function eCe(e,t){return t=fy(t,e),e=YTe(e,t),e==null||delete e[OC(jTe(t))]}var tCe=eCe;function iCe(e){return DEe(e)?void 0:e}var rCe=iCe,nCe=1,sCe=2,aCe=4,oCe=U$(function(e,t){var i={};if(e==null)return i;var r=!1;t=M$(t,function(s){return s=fy(s,e),r||(r=s.length>1),s}),Ob(e,j$(e),i),r&&(i=Y$(i,nCe|sCe|aCe,rCe));for(var n=t.length;n--;)tCe(i,t[n]);return i}),lz=oCe;function lCe(e,t,i,r){if(!oc(e))return e;t=fy(t,e);for(var n=-1,s=t.length,a=s-1,o=e;o!=null&&++n<s;){var l=OC(t[n]),c=i;if(l==="__proto__"||l==="constructor"||l==="prototype")return e;if(n!=a){var u=o[l];c=r?r(u,l,o):void 0,c===void 0&&(c=oc(u)?u:mN(t[n+1])?[]:{})}vN(o,l,c),o=o[l]}return e}var cCe=lCe;function uCe(e,t,i){for(var r=-1,n=t.length,s={};++r<n;){var a=t[r],o=B$(e,a);i(o,a)&&cCe(s,fy(a,e),o)}return s}var hCe=uCe;function dCe(e,t){return hCe(e,t,function(i,r){return FTe(e,r)})}var fCe=dCe,pCe=U$(function(e,t){return e==null?{}:fCe(e,t)}),$c=pCe,mCe="Expected a function";function gCe(e,t,i){var r=!0,n=!0;if(typeof e!="function")throw new TypeError(mCe);return oc(i)&&(r="leading"in i?!!i.leading:r,n="trailing"in i?!!i.trailing:n),Fw(e,t,{leading:r,maxWait:t,trailing:n})}var vCe=gCe;function K$(e){for(let t of Object.keys(e))e[t]===void 0&&delete e[t];return e}function _l(e,t){return Object.setPrototypeOf(e,t),e}var yCe=()=>typeof window>"u"?!1:window.navigator.userAgent.toLowerCase().includes(" electron/"),xCe=()=>typeof window>"u"?!1:window.navigator.platform.toUpperCase().includes("MAC"),wCe=()=>typeof window>"u"?!1:/iPad|iPhone|iPod/.test(window.navigator.userAgent)||BC&&"ontouchend"in document,bCe=()=>typeof window>"u"?!1:window.navigator.userAgent.toLowerCase().indexOf("firefox")>-1,_Ce=()=>typeof window>"u"?!1:"ontouchstart"in window||navigator.maxTouchPoints>0,SCe=()=>{if(typeof window>"u")return!1;let e=navigator.userAgent,t=navigator.vendor;return/Safari/i.test(e)&&/Apple Computer/.test(t)},MCe=()=>{if(typeof window>"u")return null;let e=navigator.userAgent.match(/Version\/(\d+\.\d)/);return e&&e[1]},ECe=()=>{if(typeof window>"u")return;let e=new URLSearchParams(window.location.search).get("desktop-app-version");return e?(window.localStorage.setItem("desktop-app-version",e),e):window.localStorage.getItem("desktop-app-version")??"0.0.6"},J$=yCe();J$&&ECe();var BC=xCe(),zb=wCe(),ACe=bCe(),Do=_Ce(),Kj=SCe(),TCe=Number(MCe());function $$(e){return Array.isArray(e)?e:[e]}function eee(e,t){let i=0;for(;i<e.length&&i<t.length;){if(e[i]<t[i])return-1;if(e[i]>t[i])return 1;i+=1}return i!==t.length?-1:i!==e.length?1:0}function WS(e){return BC?e.metaKey:e.ctrlKey}function CCe(e){return e.wheelDeltaY===0||e.deltaY===0?BC&&e.shiftKey&&Math.abs(e.wheelDeltaX)>=120?!1:e.wheelDeltaX?e.wheelDeltaX===-3*e.deltaX||e.wheelDeltaX===-3*window.devicePixelRatio*e.deltaX:e.deltaMode===0:e.wheelDeltaY?e.wheelDeltaY===-3*e.deltaY||e.wheelDeltaY===-3*window.devicePixelRatio*e.deltaY:e.deltaMode===0}var $t=[],bA={},ax={},r2={};function tee(e){$t.includes(e)||$t.push(e)}function c0(e){delete bA[e.pointerId];for(let t=0;t<$t.length;t++)if($t[t].pointerId===e.pointerId){$t.splice(t,1);break}}function PCe(){$t.splice(0,$t.length)}function _A(e){if(e.pointerType!=="touch")return;let t=bA[e.pointerId];t===void 0&&(t={x:0,y:0},bA[e.pointerId]=t),t.x=e.pageX,t.y=e.pageY}function iR(e){let t=e.pointerId===$t[0].pointerId?$t[1]:$t[0];return bA[t.pointerId]}function iee(e){ax[e.key]=!0,r2[e.key]=r2[e.key]===void 0?1:r2[e.key]+1}function ree(e){if(BC&&ax.Meta)for(let t in ax)ax[t]=!1;else ax[e.key]=!1;r2={}}function DCe(e){e.addEventListener("pointerdown",tee,!0),e.addEventListener("pointerdown",_A,!0),e.addEventListener("pointermove",_A,!0),e.addEventListener("pointerup",c0,!0),e.addEventListener("pointercancel",c0,!0),e.addEventListener("pointerleave",c0,!0),window.addEventListener("keydown",iee,!0),window.addEventListener("keyup",ree,!0)}function RCe(e){e.removeEventListener("pointerdown",tee,!0),e.removeEventListener("pointerdown",_A,!0),e.removeEventListener("pointermove",_A,!0),e.removeEventListener("pointerup",c0,!0),e.removeEventListener("pointercancel",c0,!0),e.removeEventListener("pointerleave",c0,!0),window.removeEventListener("keydown",iee,!0),window.removeEventListener("keyup",ree,!0)}var nee,ICe=new Promise(e=>{nee=e}),XS;function LCe(){if(XS)return XS;async function e(){let t="https://unpkg.com/@splinetool/navmesh-wasm@1.9.75/build",i=Af(()=>import("./navmesh-BFd9Mv4x.js"),[]),[r,n]=await Promise.all([i,fetch(`${t}/navmesh.wasm`).then(o=>o.arrayBuffer())]),s=r.default,a=await s({wasmBinary:n});nee(a)}return XS=e(),XS}var see,OCe=new Promise(e=>{see=e}),qS;function zCe(){if(qS)return qS;async function e(){let t=await Af(()=>import("./physics-BM4kW-A5.js"),[]);await t.init(),see(t)}return qS=e(),qS}var qt=class{modifyById(e,t){let i=this;if(i[e]===void 0)throw new Error("not expected");{let r={...i,[e]:t};return Object.setPrototypeOf(r,qt.prototype),r}}add(e,t){var i;return((i=this.runOp({type:1,id:e,data:t}))==null?void 0:i.data)??this}runOp(e){let t=this;if(e.type===1){let i=t[e.id],r;i===void 0?r={type:2,id:e.id}:r={type:1,id:e.id,data:i};let{id:n,data:s}=e,a={...t,[n]:s};return Object.setPrototypeOf(a,qt.prototype),{data:a,actual:e,reverse:r}}else if(e.type===2){let{id:i}=e,r=t[i];if(r===void 0)return null;{let n={...t};return Object.setPrototypeOf(n,qt.prototype),delete n[i],{data:n,actual:e,reverse:{type:1,id:i,data:r}}}}return null}};function PN(e){if(e.deepFreeze!==void 0){e.deepFreeze(e);return}let t=Object.getOwnPropertyNames(e);for(let i of t){let r=e[i];r&&typeof r=="object"&&PN(r)}return Object.freeze(e)}function BCe(e,t){let i=0;for(;i<e.length&&i<t.length;){if(e[i]<t[i])return-1;if(e[i]>t[i])return 1;i+=1}return i!==t.length?-1:i!==e.length?1:0}var aee=class extends Error{};function rR(e){let t={...e};return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),t}function Ud(e,t,i){if(e===void 0?t===void 0?(e=0,t=10):e=t-10:t===void 0&&(t=e+10),e>t){let s=e;e=t,t=s}let r=[],n=1/(i+1);for(let s=0;s<i;s++){let a=e+(t-e)*(s+.75+Math.random()*.5)*n;r.push(a)}return r}function DN(e){return e instanceof Uint8Array||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Float32Array||e instanceof Float64Array}function FCe(){return typeof process<"u"}function oee(e,t){for(let i of e)t(i.id,i.data)!==!0&&oee(i.children,t)}function lee(e,t){if(t(e.id,e.data)!==!0)for(let i of e.children)lee(i,t)}var Is=class extends Array{constructor(...e){super(...e),Object.setPrototypeOf(this,Is.prototype)}deepFreeze(){let e=0;for(;e<this.length;)PN(this[e]),e++}fillCaches0(e,t){this.objCaches.set(e.id,e),this.parentCaches.set(e.id,t);for(let i of e.children)this.fillCaches0(i,e.id)}fillCaches(){if(this.objCaches===void 0){this.objCaches=new Map,this.parentCaches=new Map;for(let e of this)this.fillCaches0(e,null)}}randomId(){this.fillCaches();let e=Array.from(this.objCaches.keys());if(e.length!==0)return e[Math.max(0,Math.floor(Math.random()*e.length)-1)]}nonExistOrDescendantOf(e,t){if(!this.has(e))return!0;for(;e;){let i=this.parent(e);if(i===t)return!0;e=i}return!1}rootAcestor(e){for(;e;){let t=this.parent(e);if(t)e=t;else return e}return e}isDescendantOf(e,t){for(;e;){let i=this.parent(e);if(i===t)return!0;e=i}return!1}data(e){var t;return(t=this.get(e))==null?void 0:t.data}has(e){return this.childrenOf(e)!==void 0}get(e){return this.fillCaches(),this.objCaches.get(e)}childrenOf(e){var t;return e===null?this:(t=this.get(e))==null?void 0:t.children}traverseFrom(e,t){if(e===null)this.traverse(t);else{let i=this.get(e);i&&lee(i,t)}}traverse(e){oee(this,e)}totalSize(){return this.fillCaches(),this.objCaches.size}parent(e){return this.fillCaches(),this.parentCaches.get(e)}childrenArray(e){return e===null?this:this.get(e).children}modifyById(e,t){if(this.get(e)===void 0)throw new Error("not expected");{let i=this.parent(e),r=this.childrenArray(i),n=r.findIndex(a=>a.id===e);if(n<0)throw new Error("not expected");let s=r[n];return r=[...r],r[n]={...s,data:t},this.modifyArrayBy(i,r)}}modifyArrayBy(e,t){let i=e,r=t;for(;i!==null;){let s=r,a=i;if(i=this.parent(i),i===void 0)throw new Error;r=this.childrenArray(i);let o=r.findIndex(l=>l.id===a);if(o<0)throw new Error;r=[...r],r[o]={...r[o],children:s}}Object.setPrototypeOf(r,Is.prototype);let n=r;return n.fillCaches(),n}runOp(e){switch(e.type){case 7:return this.addOp(e);case 8:return this.deleteOp(e);case 9:return this.moveOp(e)}return null}checkDuplicatedIdRec({id:e,children:t}){if(this.get(e)!==void 0)return!0;for(let i of t)if(this.checkDuplicatedIdRec(i))return!0;return!1}addOp(e){let{parent:t,fi:i,id:r,data:n,children:s}=e;if(t!==null&&this.get(t)===void 0||this.checkDuplicatedIdRec(e))return null;{let a=t,o=this.childrenArray(a),l={fi:i,id:r,data:n,children:s};return o=[...o,l],o.sort((c,u)=>c.fi-u.fi),e.localIndex=o.indexOf(l),{data:this.modifyArrayBy(a,o),actual:e,reverse:{type:8,id:r}}}}deleteOp(e){let{id:t}=e;if(this.get(t)===null)return null;{let i=this.parent(t);if(i===void 0)return null;let r=this.childrenArray(i),n=r.findIndex(a=>a.id===t);e.localIndex=n,r=[...r];let s=r.splice(n,1)[0];return{data:this.modifyArrayBy(i,r),actual:e,reverse:{type:7,...s,parent:i}}}}moveOp(e){let{parent:t,fi:i,id:r}=e;if(t!==null&&this.get(t)===void 0)return this.deleteOp({type:8,id:r});if(t!==null){let h=t;for(;h!==null;){if(h===void 0)throw new Error;if(h===r)throw new aee("cyclic tree");h=this.parent(h)}}let n=this.parent(r);if(n===void 0)return null;let s=n,a=this.childrenArray(n),o=a.findIndex(h=>h.id===r);a=[...a];let l=a.splice(o,1)[0],c=this.modifyArrayBy(n,a);n=t,a=c.childrenArray(n);let u=l.fi;return l={...l,fi:i},a=[...a,l],a.sort((h,d)=>h.fi-d.fi),e.localIndex=a.indexOf(l),c=c.modifyArrayBy(n,a),{data:c,actual:e,reverse:{type:9,parent:s,fi:u,id:r}}}previous(e,t){if(t===null){let r=this.childrenArray(e);return r.length===0?null:r[r.length-1].id}let i=null;for(let r of this.childrenArray(e)){if(r.id===t)return i;i=r.id}return null}traverseSortNext(e){let t=this.parent(e);if(t!==void 0){let i=this.childrenArray(t),r=i.findIndex(n=>n.id===e)+1;if(r<i.length)return i[r].id;if(t)return this.traverseSortNext(t)}}sortNext(e){let t=this.childrenArray(e);return t.length>0?t[0].id:this.traverseSortNext(e)}traverseSortPrevious(e){let t=this.childrenArray(e);return t.length>0?this.traverseSortPrevious(t[t.length-1].id):e}sortPrevious(e){let t=this.parent(e);if(t!==void 0){let i=this.childrenArray(t),r=i.findIndex(n=>n.id===e)-1;return r>=0?this.traverseSortPrevious(i[r].id):t}}getAllSorted(e){let t=[];for(let i of e){let r=this.getWithSortKey(i.id);r!==void 0&&t.push({...i,...r})}t.sort((i,r)=>BCe(i.sortKey,r.sortKey));for(let i of t)delete i.sortKey;return t}getWithSortKey(e){var t=e;let i=[],r=this.get(t),n=r;if(r!==void 0){for(;t;)i.splice(0,0,r.fi),t=this.parent(t),t!==null&&(r=this.get(t));return{...n,sortKey:i}}}insertBeforeHelper(e,t,i){return this.insertAfterHelper(e,this.previous(e,t),i)}insertAfterHelper(e,t,i){let r=this.childrenArray(e);if(t===null){if(r.length===0)return Ud(0,i,i);{let n=r[0].fi;return Ud(n-i,n,i)}}else{let n=this.get(t);if(n===void 0||this.parent(t)!==e)throw new Error("illegal args");let s=r.find(a=>a.fi>n.fi);if(s===void 0){let a=r[r.length-1].fi;return Ud(a,a+i,i)}else return Ud(n.fi,s.fi,i)}}},SA;(e=>{function t(i,r){if(r.type!==0)return null;if(Array.isArray(i)){let n=r.props,s={},a=[...i],o=!1;if(n)for(let l of Object.keys(n)){let c=parseInt(l);if(isNaN(c))throw new Error("wrong index");s[l]=a[c],a[c]=n[l],o=!0}return o?{data:a,actual:r,reverse:{type:0,props:s}}:null}else{let n=r.props,s={},a={...i},o=!1;if(n)for(let l of Object.keys(n)){s[l]=a[l];let c=n[l];c===void 0?delete a[l]:a[l]=c,o=!0}return o?{data:a,actual:r,reverse:{type:0,props:s}}:null}}e.runOp=t})(SA||(SA={}));var kt=class extends Array{constructor(...e){super(...e),Object.setPrototypeOf(this,kt.prototype)}deepFreeze(){let e=0;for(;e<this.length;)PN(this[e]),e++}fillCaches0(e){this.objCaches.set(e.id,e)}fillCaches(){if(this.objCaches===void 0){this.objCaches=new Map,Object.getOwnPropertyDescriptor(this,"objCaches").enumerable=!1;for(let e of this)this.fillCaches0(e)}}randomId(){this.fillCaches();let e=Array.from(this.objCaches.keys());if(e.length!==0)return e[Math.max(0,Math.floor(Math.random()*e.length)-1)]}data(e){var t;return(t=this.get(e))==null?void 0:t.data}get(e){return this.fillCaches(),this.objCaches.get(e)}modifyById(e,t){if(this.get(e)===void 0)throw new Error("not expected");{let i=this,r=i.findIndex(s=>s.id===e);if(r<0)throw new Error("not expected");let n=i[r];return i=[...i],i[r]={...n,data:t},this.modifyArrayBy(i)}}modifyArrayBy(e){Object.setPrototypeOf(e,kt.prototype);let t=e;return FCe()||t.fillCaches(),t}runOp(e){switch(e.type){case 4:return this.addOp(e);case 5:return this.deleteOp(e);case 6:return this.moveOp(e)}return null}addOp(e){let{fi:t,id:i,data:r}=e,n=this,s={fi:t,id:i,data:r};return n=[...n,s],n.sort((a,o)=>a.fi-o.fi),e.localIndex=n.indexOf(s),{data:this.modifyArrayBy(n),actual:e,reverse:{type:5,id:i}}}deleteOp(e){let{id:t}=e,i=this,r=i.findIndex(s=>s.id===t);if(r===-1)return null;e.localIndex=r,i=[...i];let n=i.splice(r,1)[0];return{data:this.modifyArrayBy(i),actual:e,reverse:{type:4,...n}}}moveOp(e){let{fi:t,id:i}=e,r=this;r=[...r];let n=r.findIndex(o=>o.id===i);if(n===-1)return null;let s=r[n].fi,a={...r[n],fi:t};return r[n]=a,r.sort((o,l)=>o.fi-l.fi),e.localIndex=r.indexOf(a),{data:this.modifyArrayBy(r),actual:e,reverse:{type:6,fi:s,id:i}}}previous(e){if(e===null)return this.length===0?null:this[this.length-1].id;let t=null;for(let i of this){if(i.id===e)return t;t=i.id}return null}insertBeforeHelper(e,t){return this.insertAfterHelper(this.previous(e),t)}insertAfterHelper(e,t){let i=this;if(e===null){if(i.length===0)return Ud(0,t,t);{let r=i[0].fi;return Ud(r-t,r,t)}}else{let r=this.get(e);if(r===void 0)throw new Error("illegal args");let n=i.find(s=>s.fi>r.fi);if(n===void 0){let s=i[i.length-1].fi;return Ud(s,s+t,t)}else return Ud(r.fi,n.fi,t)}}};function B0(e){return e&&typeof e=="object"&&e instanceof On}var On=class{unusedFunOverridesTable(e){}runOp(e){let t=[],i=this,r=0,n={};for(;r<e.path.length;){if(t.push(i),i=i===void 0?void 0:i[e.path[r]],i!==void 0&&!B0(i))return null;r+=1}i=i?rR(i):new On;for(let[o,l]of Object.entries(e.props)){let c=i[o];n[o]=c,l===void 0?delete i[o]:i[o]=l}for(;r>0;){if(Object.keys(i).length===0){let o=t[r-1];o&&(i=rR(o),delete i[e.path[r-1]])}else{let o=t[r-1];if(o){let l=rR(o);l[e.path[r-1]]=i,i=l}else{let l=new On;l[e.path[r-1]]=i,i=l}}r-=1}let s=Object.setPrototypeOf(i,On.prototype),a={...e,props:n};return{data:s,actual:e,reverse:a}}},af;(e=>{function t(n,s){return Uw(n,s)??n}e.apply=t;function i(n,s){return IN(n,s)}e.merge=i;function r(n,s){let a=0,o=s.path,l=n;for(;a<o.length&&l!==void 0;){if(l=Xn.zoomOnce(l,o[a]),l===void 0)return s;if(!B0(l))return;a+=1}if(l===void 0)return s;if(B0(l))if(s.type===0){let c={...s.props};for(let u of Object.keys(l))delete c[u];return{...s,props:c}}else if(s.type===1||s.type===4||s.type===7){let c=RN([s],l);return c?(console.log(c),c):s}else return s}e.filterOp=r})(af||(af={}));function RN(e,t){if(t===void 0)return;let i=!1,r=e.map(n=>{let s=n.id,a=Uw(n.data,t[s]);if(i=i||a!==void 0,a===void 0&&(a=n.data),n.children){let o=RN(n.children,t);return o!==void 0?i=!0:o=n.children,{...n,id:s,data:a,children:o}}else return{...n,id:s,data:a}});if(i)return r}function UCe(e,t){if(t===void 0)return;let i=!1,r=e.map(n=>{let s=n.id,a=Uw(n.data,t[s]);return i=i||a!==void 0,a===void 0&&(a=n.data),{...n,id:s,data:a}});if(i)return Object.setPrototypeOf(r,Object.getPrototypeOf(e)),r}function Uw(e,t){if(!B0(t))return t;if(e instanceof Is){let i=RN(e,t);return i!==void 0&&Object.setPrototypeOf(i,Object.getPrototypeOf(e)),i}else{if(e instanceof kt)return UCe(e,t);if(Array.isArray(e)){let i=!1,r=e.map((n,s)=>{let a=Uw(n,t[s]);return i=i||a!==void 0,a===void 0&&(a=n),a});return i?(Object.setPrototypeOf(r,Object.getPrototypeOf(e)),r):void 0}else{if(e instanceof On)return IN(e,t);if(e&&typeof e=="object"){let i={},r=!1;for(let[n,s]of Object.entries(e)){let a=Uw(s,t[n]);r=r||a!==void 0,a===void 0&&(a=s),i[n]=a}return r?(Object.setPrototypeOf(i,Object.getPrototypeOf(e)),i):void 0}}}}function IN(e,t){if(e===void 0)return t;if(t===void 0)return e;if(!B0(t))return t;if(!B0(e))return af.apply(e,t);let i=new Set;for(let n of Object.keys(e))i.add(n);for(let n of Object.keys(t))i.add(n);let r=new On;for(let n of i){let s=IN(e===void 0?void 0:e[n],t===void 0?void 0:t[n]);r[n]=s}return r}function NCe(e,t){let i={cur:[],result:[],len:0};return e=Nw(e,t,i)??e,[e,i.result]}function MA(e,t){return e===null?null:(e.cur[e.len]=t,e.len+=1,e)}function EA(e){e&&(e.len-=1)}function kCe(e){if(e===null)return null;e.result.push(e.cur.slice(0,e.len))}function cee(e,t,i){let r=!1,n=e.map(s=>{let a=s.id,o=t[a];if(o!==void 0&&typeof o=="string"&&(r=!0,a=o,i!==null))throw new Error("not supported");let l=Nw(s.data,t,MA(i,a));EA(i),r=r||l!==void 0,l===void 0&&(l=s.data);let c=cee(s.children,t,i);return c!==void 0?r=!0:c=s.children,{...s,id:a,data:l,children:c}});if(r)return n}function VCe(e,t,i){let r=!1,n=e.map(s=>{let a=s.id,o=t[a];if(o!==void 0&&typeof o=="string"&&(r=!0,a=o,i!==null))throw new Error("not supported");let l=Nw(s.data,t,MA(i,a));return EA(i),r=r||l!==void 0,l===void 0&&(l=s.data),{...s,id:a,data:l}});if(r)return Object.setPrototypeOf(n,Object.getPrototypeOf(e)),n}function Nw(e,t,i){if(e instanceof Is){let r=cee(e,t,i);return r!==void 0&&Object.setPrototypeOf(r,Object.getPrototypeOf(e)),r}else{if(e instanceof kt)return VCe(e,t,i);if(Array.isArray(e)){let r=!1,n=e.map((s,a)=>{let o=Nw(s,t,MA(i,a));return EA(i),r=r||o!==void 0,o===void 0&&(o=s),o});return r?(Object.setPrototypeOf(n,Object.getPrototypeOf(e)),n):void 0}else if(e&&typeof e=="object"&&!DN(e)){let r={},n=!1;for(let[s,a]of Object.entries(e))if(s!=="name"&&s!=="variableId"){let o=t[s];if(typeof o=="string"){if(i!==null)throw new Error("not supported");n=!0,s=o}let l=Nw(a,t,MA(i,s));EA(i),n=n||l!==void 0,l===void 0&&(l=a),r[s]=l}else r[s]=a;return n?(Object.setPrototypeOf(r,Object.getPrototypeOf(e)),r):void 0}else if(typeof e=="string"){let r=t[e];return r!==void 0&&kCe(i),r}else return}}var AA;(e=>{function t(i,r){let n=Xn.zoom(r,i.path);if(typeof n=="object"){let s={};for(let a of Object.keys(i.props))s[a]=n[a];return{...i,props:s}}else return{...i,props:{}}}e.replaceProps=t})(AA||(AA={}));var fs;(e=>{function t(l,c){return{...l,path:l.path.slice(c)}}e.drop=t;function i(l,c){var u;return((u=r(l,c))==null?void 0:u.data)??l}e.applySimple=i;function r(l,c){var d,f;let u=c.path;for(var h=[];;){let p;if(l instanceof On&&c.type===0&&(p=l.runOp({...c,path:u.slice(h.length)}),p===null&&(p=void 0)),p===void 0&&h.length===u.length&&(l instanceof Is||l instanceof kt||l instanceof qt?p=l.runOp(c):p=SA.runOp(l,c)),p!==void 0)if(p!==null){let g=p.data;for(let y=h.length-1;y>=0;y--){let x=u[y],_=h[y];if(_ instanceof Is){if(typeof x=="number")throw new Error("illegal arg");g=_.modifyById(x,g)}else if(_ instanceof kt){if(typeof x=="number")throw new Error("illegal arg");g=_.modifyById(x,g)}else if(_ instanceof qt){if(typeof x=="number")throw new Error("illegal arg");g=_.modifyById(x,g)}else if(_ instanceof On){let M={..._,[x]:g};g=Object.setPrototypeOf(M,On.prototype)}else if(typeof _=="object")if(Array.isArray(_)){if(typeof x=="string"&&(x=parseInt(x),isNaN(x)))throw new Error("Invalid path");let M=g;g=[..._],g[x]=M}else g={..._,[x]:g};else return null}return{data:g,actual:{...p.actual,path:u},reverse:{...p.reverse,path:u}}}else return null;let v=u[h.length],m;if(l instanceof Is){if(typeof v=="number")throw new Error("");m=(d=l.get(v))==null?void 0:d.data}else if(l instanceof kt){if(typeof v=="number")throw new Error("");m=(f=l.get(v))==null?void 0:f.data}else l!==null&&(m=l[v]);if(m!==void 0)h.push(l),l=m;else return null}}e.apply=r;function n(l,c){for(let u=0;u<l.length&&u<c.length;u++)if(l[u]!==c[u])return!0;return!1}e.pathDisjoint=n;function s(l,c){if(l.length!==c.length)return!1;for(let u=0;u<l.length;u++)if(l[u]!==c[u])return!1;return!0}e.pathEq=s;function a(l,c){return n(l.path,c.path)}e.commutative=a;function o(l,c){return l.type===0&&c.type===0&&s(l.path,c.path)?Object.keys(l.props).every(u=>c.props[u]!==void 0):!1}e.subsumed=o})(fs||(fs={}));var cz;(e=>{function t(){return[]}e.empty=t;function i(c,u){let h=[];for(let d of c){let[f,...p]=d.path;f===u&&h.push({...d,path:p})}return h}e.removePrefix=i;function r(c,u){return c.map(h=>({...h,path:[u,...h.path]}))}e.addPrefix=r;function n(c,u){return[...c,...u]}e.concat=n;function s(c,u){return[...c.filter(h=>!u.some(d=>fs.subsumed(h,d))),...u]}e.compress=s;function a(c,u){return c.every(h=>u.every(d=>fs.commutative(h,d)))}e.commutative=a;function o(c,u){for(let h of u){let d=l(c,h);d!==null&&(c=d.data)}return c}e.applyAll=o;function l(c,u){var h=c;let d=[],f=[];for(let p of u)try{if(p.type===3||p.type===5&&p.path[p.path.length-1]==="variables"){let v,m,g;if(p.type===3?(v=Xn.zoom(h,[...p.path,p.id]),g=fs.apply(h,{...p,type:2})):(v=Xn.zoom(h,[...p.path,p.id,"value"]),g=fs.apply(h,p)),g!==null){h=g.data;let[y,x]=NCe(h,{[p.id]:v});h=y;for(let _=0;_<x.length;_++){let M=x[_],S=M.pop();if(typeof S=="number"){let T=[S];for(let C=_+1;C<x.length;C++){let A=x[C],D=A[A.length-1];if(typeof D=="number"&&Xn.equal(M,A.slice(0,A.length-1)))T.push(D),x.splice(C,1);else break}let E=Xn.zoom(h,M);m=E.map((C,A)=>T.includes(A)?p.id:C),v=E,S=M.pop()}else{if(S==="alphaOverride"||S==="alpha"){v/=100;let T=v,E=Xn.zoom(h,M.slice(0,M.length-2)),C=E.layers.map(A=>A.id===M[M.length-1]?{...A,data:{...A.data,[S]:T}}:A);Object.setPrototypeOf(C,Object.getPrototypeOf(E.layers)),E.layers=C}m=p.id}d.push({type:0,path:M,props:{[S]:v}}),f.push({type:0,path:M,props:{[S]:m}})}f.push(g.reverse),d.push(g.actual)}}else{let v=fs.apply(h,p);v!==null&&(d.push(v.actual),h=v.data,f.push(v.reverse))}}catch(v){if(v instanceof aee)return null;throw v}return{data:h,actual:d,reverse:f.reverse()}}e.apply=l})(cz||(cz={}));var uee=Symbol(),GCe=Symbol(),FC=Symbol(),Bb=class{reportOp(e,t,i=[]){let r=this;if(t===null)return;r._current=t.data;let n=i;for(;!(r instanceof dee);){let s=r._path,a=r._current;if(s!==""&&n.splice(0,0,s),r=r._parent,r===null)return;r.update(s,a)}r.push(n,e,t.actual,t.reverse)}deleteChildren(e){if(this._children){let t=this._children[e];if(t){let i=t[FC];i&&i(),delete this._children[e]}}}},HCe=class extends Bb{constructor(e,t,i){super(),this._parent=e,this._path=t,this._current=i}update(e,t){if(Array.isArray(this._current)){if(typeof e=="string"&&(e=parseInt(e),isNaN(e)))throw new Error("Invalid path");this._current=[...this._current],this._current[e]=t}else this._current={...this._current,[e]:t}}runOp(e){this.reportOp(e,SA.runOp(this._current,e),e.path)}},jCe=class extends Bb{constructor(e,t,i){super(),this._parent=e,this._path=t,this._current=i}update(e,t){this._current={...this._current,[e]:t},Object.setPrototypeOf(this._current,qt.prototype)}runOp(e){this.reportOp(e,this._current.runOp(e))}},hee={get(e,t){if(t===FC)return()=>{e._parent=null};if(t===uee)return e._current;if(t===GCe)return e;let{_current:i,_children:r}=e;if(t==="push"&&Array.isArray(i))throw new Error("not supported to expand array");let n=r===void 0?void 0:r[t];if(n!==void 0)return n;let s=i[t],a=UC(e,t,s);return a!==s?(r===void 0&&(r={},e._children=r),r[t]=a,a):s},has(e,t){return t in e._current},ownKeys(e){return Reflect.ownKeys(e._current)},defineProperty(){throw Error("not supported")},getPrototypeOf(e){return Object.getPrototypeOf(e._current)},setPrototypeOf(){throw Error("not supported")},getOwnPropertyDescriptor(e,t){let i=e._current,r=Reflect.getOwnPropertyDescriptor(i,t);return r&&{writable:!0,configurable:!0,enumerable:r.enumerable,value:i[t]}}},WCe={...hee,set(e,t,i){let r={type:0,props:{[t]:mn(i)??i}};return e.deleteChildren(t),e.runOp(r),!0},deleteProperty(e,t){let i={type:0,props:{[t]:void 0}};return e.deleteChildren(t),e.runOp(i),!0}},XCe={...hee,set(e,t,i){return i===void 0?this.deleteProperty(e,t):(e.deleteChildren(t),e.runOp({type:1,id:t,data:i})),!0},deleteProperty(e,t){return e.runOp({type:2,id:t}),!0}},LN=class extends Bb{constructor(e,t,i){super(),this._children={},this._parent=e,this._path=t,this._current=i,this[FC]=()=>{this._parent=null}}unproxy(){return this._current}update(e,t){this._current=this._current.modifyById(e,t)}runOp(e){this.reportOp(e,this._current.runOp(e))}randomId(){return this._current.randomId()}isDescendantOf(e,t){return this._current.isDescendantOf(e,t)}childrenOf(e){return this._current.childrenOf(e)}traverse(e){return this._current.traverse(e)}get(e){return this._current.get(e)}parent(e){return this._current.parent(e)}traverse(e){this._current.traverse((t,i)=>{e(t,this.data(t))})}data(e){var a;let{_current:t,_children:i}=this,r=i===void 0?void 0:i[e];if(r!==void 0)return r;let n=(a=t.get(e))==null?void 0:a.data,s=UC(this,e,n);return s!==n?(i===void 0&&(i={},this._children=i),i[e]=s,s):n}add(e,t,i,r,n){this.runOp({type:7,parent:e,fi:t,id:i,data:r,children:n})}move(e,t,i){this.runOp({type:9,parent:e,fi:t,id:i})}insertAfter(e,t,i){let r=this._current.insertAfterHelper(e,t,i.length);for(let n=0;n<i.length;n++){let s=i[n];this.add(e,r[n],s.id,s.data,s.children)}}insertBefore(e,t,i){let r=this._current.insertBeforeHelper(e,t,i.length);for(let n=0;n<i.length;n++){let s=i[n];this.add(e,r[n],s.id,s.data,s.children)}}moveAfter(e,t,i){let r=this._current.insertAfterHelper(e,t,i.length);for(let n=0;n<i.length;n++){let s=i[n];this.move(e,r[n],s)}}moveBefore(e,t,i){let r=this._current.insertBeforeHelper(e,t,i.length);for(let n=0;n<i.length;n++){let s=i[n];this.move(e,r[n],s)}}delete(e){this.deleteChildren(e),this.runOp({type:8,id:e})}sortNext(e){return this._current.sortNext(e)}sortPrevious(e){return this._current.sortPrevious(e)}getAllSorted(e){return this._current.getAllSorted(e)}},ON=class extends Bb{constructor(e,t,i){super(),this._children={},this._parent=e,this._path=t,this._current=i,this[FC]=()=>{this._parent=null}}unproxy(){return this._current}get length(){return this._current.length}forEach(e){let t=this.length;for(let i=0;i<t;i++){let r=this._current[i].id,n=this._current[i].fi;e(this.data(this._current[i].id),r,n)}}find(e){let t=this.length;for(let i=0;i<t;i++){let r=this._current[i].id;if(e(this.data(r),r))return this.get(r)}}update(e,t){this._current=this._current.modifyById(e,t)}randomId(){return this._current.randomId()}get(e){return{...this._current.get(e),data:this.data(e)}}data(e){var a;let{_current:t,_children:i}=this,r=i===void 0?void 0:i[e];if(r!==void 0)return r;let n=(a=t.get(e))==null?void 0:a.data,s=UC(this,e,n);return s!==n?(i===void 0&&(i={},this._children=i),i[e]=s,s):n}runOp(e){this.reportOp(e,this._current.runOp(e))}add(e,t,i){this.runOp({type:4,fi:e,id:t,data:i})}move(e,t){this.runOp({type:6,fi:e,id:t})}insertAfter(e,t){let i=this._current.insertAfterHelper(e,t.length);for(let r=0;r<t.length;r++){let n=t[r];this.add(i[r],n.id,n.data)}}insertBefore(e,t){let i=this._current.insertBeforeHelper(e,t.length);for(let r=0;r<t.length;r++){let n=t[r];this.add(i[r],n.id,n.data)}}moveAfter(e,t){let i=this._current.insertAfterHelper(e,t.length);for(let r=0;r<t.length;r++){let n=t[r];this.move(i[r],n)}}moveBefore(e,t){let i=this._current.insertBeforeHelper(e,t.length);for(let r=0;r<t.length;r++){let n=t[r];this.move(i[r],n)}}delete(e){this.deleteChildren(e),this.runOp({type:5,id:e})}};function nR(e,t,i){if(e.length>0){let r=e[e.length-1];if(r.type===0&&t.type===0&&Xn.equal(r.path,i)){Object.assign(r.props,t.props);return}}e.push({...t,path:i})}var dee=class extends Bb{constructor(e){super(),this.ts=[],this.actual=[],this.reverse=[],this._current=e}update(e,t){if(e!=="")throw new Error("");this._current=t}push(e,t,i,r){nR(this.ts,t,e),nR(this.actual,i,e),nR(this.reverse,r,e)}result(){return{data:this._current,ts:this.ts,actual:this.actual,reverse:this.reverse.reverse()}}};function UC(e,t,i){return i instanceof Is?new LN(e,t,i):i instanceof kt?new ON(e,t,i):i instanceof qt?new Proxy(new jCe(e,t,i),XCe):i!==null&&typeof i=="object"?DN(i)?i:new Proxy(new HCe(e,t,i),WCe):i}function fee(e){let t=new dee(e);return[UC(t,"",e),t]}function kw(e,t){let[i,r]=fee(e);return t(i),r.result()}function mn(e){return e instanceof LN||e instanceof ON?e._current:e!==null&&typeof e=="object"?e[uee]:e}var Xn;(e=>{function t(s,a){if(a.length===s.length)for(var o=0;o<s.length;){if(s[o]!==a[o])return!1;o+=1}else return!1;return!0}e.equal=t;function i(s,a,o){let l=n(o,s);if(l!==void 0&&typeof l=="object"&&l!==null){let c={...a};return Object.keys(l).forEach(u=>{delete c[u]}),c}else return a}e.removeOverridden=i;function r(s,a){if((s instanceof Is||s instanceof LN)&&typeof a=="string"||(s instanceof kt||s instanceof ON)&&typeof a=="string")return s.data(a);if(typeof a=="number"&&Array.isArray(s)||typeof a=="string"&&typeof s=="object"&&s!==null)return s[a]}e.zoomOnce=r;function n(s,a,o=0){for(;o<a.length&&s!==void 0;)s=r(s,a[o]),o+=1;return s}e.zoom=n})(Xn||(Xn={}));function qCe(e,t){let i=[];if(t.length===e.length)for(var r=0;r<e.length;){if(t[r]==="*")i.push(e[r]);else if(e[r]!==t[r])return null;r+=1}else return null;return i}function pr(e,t){let i=[];if(t.length<=e.length)for(var r=0;r<t.length;){if(t[r]==="*")i.push(e[r]);else if(e[r]!==t[r])return null;r+=1}else return null;return i}var pee=class{},Jj=class extends pee{constructor(e){super(),this.id=e}},$j=class extends pee{constructor(e){super(),this.data=e}},uz;try{uz=new TextDecoder}catch{}var Ot,of,Ye=0,$a={},Ji,Nd,al=0,Gc=0,To,yh,Oa=[],ir,e8={useRecords:!1,mapsAsObjects:!0},mee=class{},gee=new mee;gee.name="MessagePack 0xC1";var F0=!1,TA=class{constructor(e){e&&(e.useRecords===!1&&e.mapsAsObjects===void 0&&(e.mapsAsObjects=!0),e.structures?e.structures.sharedLength=e.structures.length:e.getStructures&&((e.structures=[]).uninitialized=!0,e.structures.sharedLength=0)),Object.assign(this,e)}unpack(e,t){if(Ot)return _ee(()=>(dz(),this?this.unpack(e,t):TA.prototype.unpack.call(e8,e,t)));of=t>-1?t:e.length,Ye=0,Gc=0,Nd=null,To=null,Ot=e;try{ir=e.dataView||(e.dataView=new DataView(e.buffer,e.byteOffset,e.byteLength))}catch(i){throw Ot=null,e instanceof Uint8Array?i:new Error("Source must be a Uint8Array or Buffer but was a "+(e&&typeof e=="object"?e.constructor.name:typeof e))}if(this instanceof TA){if($a=this,this.structures)return Ji=this.structures,YS();(!Ji||Ji.length>0)&&(Ji=[])}else $a=e8,(!Ji||Ji.length>0)&&(Ji=[]);return YS()}unpackMultiple(e,t){let i,r=0;try{F0=!0;let n=e.length,s=this?this.unpack(e,n):kC.unpack(e,n);if(t){for(t(s);Ye<n;)if(r=Ye,t(YS())===!1)return}else{for(i=[s];Ye<n;)r=Ye,i.push(YS());return i}}catch(n){throw n.lastPosition=r,n.values=i,n}finally{F0=!1,dz()}}_mergeStructures(e,t){e=e||[];for(let i=0,r=e.length;i<r;i++){let n=e[i];n&&(n.isShared=!0,i>=32&&(n.highByte=i-32>>5))}e.sharedLength=e.length;for(let i in t||[])if(i>=0){let r=e[i],n=t[i];n&&(r&&((e.restoreStructures||(e.restoreStructures=[]))[i]=r),e[i]=n)}return this.structures=e}decode(e,t){return this.unpack(e,t)}};function YS(){try{if(!$a.trusted&&!F0){let t=Ji.sharedLength||0;t<Ji.length&&(Ji.length=t)}let e=en();if(Ye==of)Ji.restoreStructures&&t8(),Ji=null,Ot=null,yh&&(yh=null);else if(Ye>of){let t=new Error("Unexpected end of MessagePack data");throw t.incomplete=!0,t}else if(!F0)throw new Error("Data read, but end of buffer not reached");return e}catch(e){throw Ji.restoreStructures&&t8(),dz(),(e instanceof RangeError||e.message.startsWith("Unexpected end of buffer"))&&(e.incomplete=!0),e}}function t8(){for(let e in Ji.restoreStructures)Ji[e]=Ji.restoreStructures[e];Ji.restoreStructures=null}function en(){let e=Ot[Ye++];if(e<160)if(e<128){if(e<64)return e;{let t=Ji[e&63]||$a.getStructures&&vee()[e&63];return t?(t.read||(t.read=zN(t,e&63)),t.read()):e}}else if(e<144)if(e-=128,$a.mapsAsObjects){let t={};for(let i=0;i<e;i++)t[xee()]=en();return t}else{let t=new Map;for(let i=0;i<e;i++)t.set(en(),en());return t}else{e-=144;let t=new Array(e);for(let i=0;i<e;i++)t[i]=en();return t}else if(e<192){let t=e-160;if(Gc>=Ye)return Nd.slice(Ye-al,(Ye+=t)-al);if(Gc==0&&of<140){let i=t<16?BN(t):yee(t);if(i!=null)return i}return hz(t)}else{let t;switch(e){case 192:return null;case 193:return To?(t=en(),t>0?To[1].slice(To.position1,To.position1+=t):To[0].slice(To.position0,To.position0-=t)):gee;case 194:return!1;case 195:return!0;case 196:return sR(Ot[Ye++]);case 197:return t=ir.getUint16(Ye),Ye+=2,sR(t);case 198:return t=ir.getUint32(Ye),Ye+=4,sR(t);case 199:return $f(Ot[Ye++]);case 200:return t=ir.getUint16(Ye),Ye+=2,$f(t);case 201:return t=ir.getUint32(Ye),Ye+=4,$f(t);case 202:if(t=ir.getFloat32(Ye),$a.useFloat32>2){let i=FN[(Ot[Ye]&127)<<1|Ot[Ye+1]>>7];return Ye+=4,(i*t+(t>0?.5:-.5)>>0)/i}return Ye+=4,t;case 203:return t=ir.getFloat64(Ye),Ye+=8,t;case 204:return Ot[Ye++];case 205:return t=ir.getUint16(Ye),Ye+=2,t;case 206:return t=ir.getUint32(Ye),Ye+=4,t;case 207:return $a.int64AsNumber?(t=ir.getUint32(Ye)*4294967296,t+=ir.getUint32(Ye+4)):t=ir.getBigUint64(Ye),Ye+=8,t;case 208:return ir.getInt8(Ye++);case 209:return t=ir.getInt16(Ye),Ye+=2,t;case 210:return t=ir.getInt32(Ye),Ye+=4,t;case 211:return $a.int64AsNumber?(t=ir.getInt32(Ye)*4294967296,t+=ir.getUint32(Ye+4)):t=ir.getBigInt64(Ye),Ye+=8,t;case 212:if(t=Ot[Ye++],t==114)return a8(Ot[Ye++]&63);{let i=Oa[t];if(i)return i.read?(Ye++,i.read(en())):i.noBuffer?(Ye++,i()):i(Ot.subarray(Ye,++Ye));throw new Error("Unknown extension "+t)}case 213:return t=Ot[Ye],t==114?(Ye++,a8(Ot[Ye++]&63,Ot[Ye++])):$f(2);case 214:return $f(4);case 215:return $f(8);case 216:return $f(16);case 217:return t=Ot[Ye++],Gc>=Ye?Nd.slice(Ye-al,(Ye+=t)-al):QCe(t);case 218:return t=ir.getUint16(Ye),Ye+=2,Gc>=Ye?Nd.slice(Ye-al,(Ye+=t)-al):ZCe(t);case 219:return t=ir.getUint32(Ye),Ye+=4,Gc>=Ye?Nd.slice(Ye-al,(Ye+=t)-al):KCe(t);case 220:return t=ir.getUint16(Ye),Ye+=2,r8(t);case 221:return t=ir.getUint32(Ye),Ye+=4,r8(t);case 222:return t=ir.getUint16(Ye),Ye+=2,n8(t);case 223:return t=ir.getUint32(Ye),Ye+=4,n8(t);default:if(e>=224)return e-256;if(e===void 0){let i=new Error("Unexpected end of MessagePack data");throw i.incomplete=!0,i}throw new Error("Unknown MessagePack token "+e)}}}var YCe=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function zN(e,t){function i(){if(i.count++>2){let n=e.read=new Function("r","return function(){return {"+e.map(s=>YCe.test(s)?s+":r()":"["+JSON.stringify(s)+"]:r()").join(",")+"}}")(en);return e.highByte===0&&(e.read=i8(t,e.read)),n()}let r={};for(let n=0,s=e.length;n<s;n++){let a=e[n];r[a]=en()}return r}return i.count=0,e.highByte===0?i8(t,i):i}var i8=(e,t)=>function(){let i=Ot[Ye++];if(i===0)return t();let r=e<32?-(e+(i<<5)):e+(i<<5),n=Ji[r]||vee()[r];if(!n)throw new Error("Record id is not defined for "+r);return n.read||(n.read=zN(n,e)),n.read()};function vee(){let e=_ee(()=>(Ot=null,$a.getStructures()));return Ji=$a._mergeStructures(e,Ji)}var hz=NC,QCe=NC,ZCe=NC,KCe=NC;function NC(e){let t;if(e<16&&(t=BN(e)))return t;if(e>64&&uz)return uz.decode(Ot.subarray(Ye,Ye+=e));let i=Ye+e,r=[];for(t="";Ye<i;){let n=Ot[Ye++];if(!(n&128))r.push(n);else if((n&224)===192){let s=Ot[Ye++]&63;r.push((n&31)<<6|s)}else if((n&240)===224){let s=Ot[Ye++]&63,a=Ot[Ye++]&63;r.push((n&31)<<12|s<<6|a)}else if((n&248)===240){let s=Ot[Ye++]&63,a=Ot[Ye++]&63,o=Ot[Ye++]&63,l=(n&7)<<18|s<<12|a<<6|o;l>65535&&(l-=65536,r.push(l>>>10&1023|55296),l=56320|l&1023),r.push(l)}else r.push(n);r.length>=4096&&(t+=ls.apply(String,r),r.length=0)}return r.length>0&&(t+=ls.apply(String,r)),t}function r8(e){let t=new Array(e);for(let i=0;i<e;i++)t[i]=en();return t}function n8(e){if($a.mapsAsObjects){let t={};for(let i=0;i<e;i++)t[xee()]=en();return t}else{let t=new Map;for(let i=0;i<e;i++)t.set(en(),en());return t}}var ls=String.fromCharCode;function yee(e){let t=Ye,i=new Array(e);for(let r=0;r<e;r++){let n=Ot[Ye++];if((n&128)>0){Ye=t;return}i[r]=n}return ls.apply(String,i)}function BN(e){if(e<4)if(e<2){if(e===0)return"";{let t=Ot[Ye++];if((t&128)>1){Ye-=1;return}return ls(t)}}else{let t=Ot[Ye++],i=Ot[Ye++];if((t&128)>0||(i&128)>0){Ye-=2;return}if(e<3)return ls(t,i);let r=Ot[Ye++];if((r&128)>0){Ye-=3;return}return ls(t,i,r)}else{let t=Ot[Ye++],i=Ot[Ye++],r=Ot[Ye++],n=Ot[Ye++];if((t&128)>0||(i&128)>0||(r&128)>0||(n&128)>0){Ye-=4;return}if(e<6){if(e===4)return ls(t,i,r,n);{let s=Ot[Ye++];if((s&128)>0){Ye-=5;return}return ls(t,i,r,n,s)}}else if(e<8){let s=Ot[Ye++],a=Ot[Ye++];if((s&128)>0||(a&128)>0){Ye-=6;return}if(e<7)return ls(t,i,r,n,s,a);let o=Ot[Ye++];if((o&128)>0){Ye-=7;return}return ls(t,i,r,n,s,a,o)}else{let s=Ot[Ye++],a=Ot[Ye++],o=Ot[Ye++],l=Ot[Ye++];if((s&128)>0||(a&128)>0||(o&128)>0||(l&128)>0){Ye-=8;return}if(e<10){if(e===8)return ls(t,i,r,n,s,a,o,l);{let c=Ot[Ye++];if((c&128)>0){Ye-=9;return}return ls(t,i,r,n,s,a,o,l,c)}}else if(e<12){let c=Ot[Ye++],u=Ot[Ye++];if((c&128)>0||(u&128)>0){Ye-=10;return}if(e<11)return ls(t,i,r,n,s,a,o,l,c,u);let h=Ot[Ye++];if((h&128)>0){Ye-=11;return}return ls(t,i,r,n,s,a,o,l,c,u,h)}else{let c=Ot[Ye++],u=Ot[Ye++],h=Ot[Ye++],d=Ot[Ye++];if((c&128)>0||(u&128)>0||(h&128)>0||(d&128)>0){Ye-=12;return}if(e<14){if(e===12)return ls(t,i,r,n,s,a,o,l,c,u,h,d);{let f=Ot[Ye++];if((f&128)>0){Ye-=13;return}return ls(t,i,r,n,s,a,o,l,c,u,h,d,f)}}else{let f=Ot[Ye++],p=Ot[Ye++];if((f&128)>0||(p&128)>0){Ye-=14;return}if(e<15)return ls(t,i,r,n,s,a,o,l,c,u,h,d,f,p);let v=Ot[Ye++];if((v&128)>0){Ye-=15;return}return ls(t,i,r,n,s,a,o,l,c,u,h,d,f,p,v)}}}}}function sR(e){return $a.copyBuffers?Uint8Array.prototype.slice.call(Ot,Ye,Ye+=e):Ot.subarray(Ye,Ye+=e)}function $f(e){let t=Ot[Ye++];if(Oa[t])return Oa[t](Ot.subarray(Ye,Ye+=e));throw new Error("Unknown extension type "+t)}var s8=new Array(4096);function xee(){let e=Ot[Ye++];if(e>=160&&e<192){if(e=e-160,Gc>=Ye)return Nd.slice(Ye-al,(Ye+=e)-al);if(!(Gc==0&&of<180))return hz(e)}else return Ye--,en();let t=(e<<5^(e>1?ir.getUint16(Ye):e>0?Ot[Ye]:0))&4095,i=s8[t],r=Ye,n=Ye+e-3,s,a=0;if(i&&i.bytes==e){for(;r<n;){if(s=ir.getUint32(r),s!=i[a++]){r=1879048192;break}r+=4}for(n+=3;r<n;)if(s=Ot[r++],s!=i[a++]){r=1879048192;break}if(r===n)return Ye=r,i.string;n-=3,r=Ye}for(i=[],s8[t]=i,i.bytes=e;r<n;)s=ir.getUint32(r),i.push(s),r+=4;for(n+=3;r<n;)s=Ot[r++],i.push(s);let o=e<16?BN(e):yee(e);return o!=null?i.string=o:i.string=hz(e)}var a8=(e,t)=>{var i=en();let r=e;t!==void 0&&(e=e<32?-((t<<5)+e):(t<<5)+e,i.highByte=t);let n=Ji[e];return n&&n.isShared&&((Ji.restoreStructures||(Ji.restoreStructures=[]))[e]=n),Ji[e]=i,i.read=zN(i,r),i.read()},wee=typeof self=="object"?self:global;Oa[0]=()=>{};Oa[0].noBuffer=!0;Oa[101]=()=>{let e=en();return(wee[e[0]]||Error)(e[1])};Oa[105]=e=>{let t=ir.getUint32(Ye-4);yh||(yh=new Map);let i=Ot[Ye],r;i>=144&&i<160||i==220||i==221?r=[]:r={};let n={target:r};yh.set(t,n);let s=en();return n.used?Object.assign(r,s):(n.target=s,s)};Oa[112]=e=>{let t=ir.getUint32(Ye-4),i=yh.get(t);return i.used=!0,i.target};Oa[115]=()=>new Set(en());var bee=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(e=>e+"Array");Oa[116]=e=>{let t=e[0],i=bee[t];if(!i)throw new Error("Could not find typed array for code "+t);return new wee[i](Uint8Array.prototype.slice.call(e,1).buffer)};Oa[120]=()=>{let e=en();return new RegExp(e[0],e[1])};Oa[98]=e=>{let t=(e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3],i=Ye;Ye+=t-4,To=[en(),en()],To.position0=0,To.position1=0;let r=Ye;Ye=i;try{return en()}finally{Ye=r}};Oa[255]=e=>e.length==4?new Date((e[0]*16777216+(e[1]<<16)+(e[2]<<8)+e[3])*1e3):e.length==8?new Date(((e[0]<<22)+(e[1]<<14)+(e[2]<<6)+(e[3]>>2))/1e6+((e[3]&3)*4294967296+e[4]*16777216+(e[5]<<16)+(e[6]<<8)+e[7])*1e3):e.length==12?new Date(((e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3])/1e6+((e[4]&128?-281474976710656:0)+e[6]*1099511627776+e[7]*4294967296+e[8]*16777216+(e[9]<<16)+(e[10]<<8)+e[11])*1e3):new Date("invalid");function _ee(e){let t=of,i=Ye,r=al,n=Gc,s=Nd,a=yh,o=To,l=new Uint8Array(Ot.slice(0,of)),c=Ji,u=Ji.slice(0,Ji.length),h=$a,d=F0,f=e();return of=t,Ye=i,al=r,Gc=n,Nd=s,yh=a,To=o,Ot=l,F0=d,Ji=c,Ji.splice(0,Ji.length,...u),$a=h,ir=new DataView(Ot.buffer,Ot.byteOffset,Ot.byteLength),f}function dz(){Ot=null,yh=null,Ji=null}function JCe(e){e.unpack?Oa[e.type]=e.unpack:Oa[e.type]=e}var FN=new Array(147);for(let e=0;e<256;e++)FN[e]=+("1e"+Math.floor(45.15-e*.30103));var kC=new TA({useRecords:!1});kC.unpack;kC.unpackMultiple;kC.unpack;var $Ce=new Float32Array(1);new Uint8Array($Ce.buffer,0,4);var n2;try{n2=new TextEncoder}catch{}var CA,UN,VC=typeof Buffer<"u",aR=VC?Buffer.allocUnsafeSlow:Uint8Array,See=VC?Buffer:Uint8Array,o8=VC?4294967296:2144337920,ht,ln,tt=0,bc,_c=null,ePe=/[\u0080-\uFFFF]/,g1=Symbol("record-id"),Mee=class extends TA{constructor(e){super(e),this.offset=0;let t,i,r,n,s,a=0,o=See.prototype.utf8Write?function(S,T,E){return ht.utf8Write(S,T,E)}:n2&&n2.encodeInto?function(S,T){return n2.encodeInto(S,ht.subarray(T)).written}:!1,l=this;e||(e={});let c=e&&e.sequential,u=e.structures||e.saveStructures,h=e.maxSharedStructures;if(h==null&&(h=u?32:0),h>8160)throw new Error("Maximum maxSharedStructure is 8160");let d=e.maxOwnStructures;d==null&&(d=u?32:64),c&&!e.saveStructures&&(this.structures=[]);let f=h>32||d+h>64,p=h+64,v=h+d+64;if(v>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let m=[],g=0,y=0;this.pack=this.encode=function(S,T){if(ht||(ht=new aR(8192),ln=new DataView(ht.buffer,0,8192),tt=0),bc=ht.length-10,bc-tt<2048?(ht=new aR(ht.length),ln=new DataView(ht.buffer,0,ht.length),bc=ht.length-10,tt=0):tt=tt+7&2147483640,t=tt,s=l.structuredClone?new Map:null,l.bundleStrings?(_c=["",""],ht[tt++]=214,ht[tt++]=98,_c.position=tt-t,tt+=4):_c=null,i=l.structures,i){i.uninitialized&&(i=l._mergeStructures(l.getStructures()));let E=i.sharedLength||0;if(E>h)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+i.sharedLength);if(!i.transitions){i.transitions=Object.create(null);for(let C=0;C<E;C++){let A=i[C];if(!A)continue;let D,R=i.transitions;for(let L=0,O=A.length;L<O;L++){let H=A[L];D=R[H],D||(D=R[H]=Object.create(null)),R=D}R[g1]=C+64}a=E}c||(i.nextId=E+64)}r&&(r=!1),n=i||[];try{if(x(S),_c){ln.setUint32(_c.position+t,tt-_c.position-t);let E=_c;_c=null,x(E[0]),x(E[1])}if(l.offset=tt,s&&s.idsToInsert){tt+=s.idsToInsert.length*6,tt>bc&&M(tt),l.offset=tt;let E=iPe(ht.subarray(t,tt),s.idsToInsert);return s=null,E}return T&rPe?(ht.start=t,ht.end=tt,ht):ht.subarray(t,tt)}finally{if(i){if(y<10&&y++,g>1e4)i.transitions=null,y=0,g=0,m.length>0&&(m=[]);else if(m.length>0&&!c){for(let E=0,C=m.length;E<C;E++)m[E][g1]=0;m=[]}if(r&&l.saveStructures){let E=i.sharedLength||h;i.length>E&&(i=i.slice(0,E));let C=ht.subarray(t,tt);return l.saveStructures(i,a)===!1?(l._mergeStructures(l.getStructures()),l.pack(S)):(a=E,C)}}T&nPe&&(tt=t)}};let x=S=>{tt>bc&&(ht=M(tt));var T=typeof S,E;if(T==="string"){let C=S.length;if(_c&&C>=8&&C<4096){let R=ePe.test(S);_c[R?0:1]+=S,ht[tt++]=193,x(R?-C:C);return}let A;C<32?A=1:C<256?A=2:C<65536?A=3:A=5;let D=C*3;if(tt+D>bc&&(ht=M(tt+D)),C<64||!o){let R,L,O,H=tt+A;for(R=0;R<C;R++)L=S.charCodeAt(R),L<128?ht[H++]=L:L<2048?(ht[H++]=L>>6|192,ht[H++]=L&63|128):(L&64512)===55296&&((O=S.charCodeAt(R+1))&64512)===56320?(L=65536+((L&1023)<<10)+(O&1023),R++,ht[H++]=L>>18|240,ht[H++]=L>>12&63|128,ht[H++]=L>>6&63|128,ht[H++]=L&63|128):(ht[H++]=L>>12|224,ht[H++]=L>>6&63|128,ht[H++]=L&63|128);E=H-tt-A}else E=o(S,tt+A,D);E<32?ht[tt++]=160|E:E<256?(A<2&&ht.copyWithin(tt+2,tt+1,tt+1+E),ht[tt++]=217,ht[tt++]=E):E<65536?(A<3&&ht.copyWithin(tt+3,tt+2,tt+2+E),ht[tt++]=218,ht[tt++]=E>>8,ht[tt++]=E&255):(A<5&&ht.copyWithin(tt+5,tt+3,tt+3+E),ht[tt++]=219,ln.setUint32(tt,E),tt+=4),tt+=E}else if(T==="number")if(S>>>0===S)S<64?ht[tt++]=S:S<256?(ht[tt++]=204,ht[tt++]=S):S<65536?(ht[tt++]=205,ht[tt++]=S>>8,ht[tt++]=S&255):(ht[tt++]=206,ln.setUint32(tt,S),tt+=4);else if(S>>0===S)S>=-32?ht[tt++]=256+S:S>=-128?(ht[tt++]=208,ht[tt++]=S+256):S>=-32768?(ht[tt++]=209,ln.setInt16(tt,S),tt+=2):(ht[tt++]=210,ln.setInt32(tt,S),tt+=4);else{let C;if((C=this.useFloat32)>0&&S<4294967296&&S>=-2147483648){ht[tt++]=202,ln.setFloat32(tt,S);let A;if(C<4||(A=S*FN[(ht[tt]&127)<<1|ht[tt+1]>>7])>>0===A){tt+=4;return}else tt--}ht[tt++]=203,ln.setFloat64(tt,S),tt+=8}else if(T==="object")if(!S)ht[tt++]=192;else{if(s){let A=s.get(S);if(A){if(!A.id){let D=s.idsToInsert||(s.idsToInsert=[]);A.id=D.push(A)}ht[tt++]=214,ht[tt++]=112,ln.setUint32(tt,A.id),tt+=4;return}else s.set(S,{offset:tt-t})}let C=S.constructor;if(C===Object)_(S,!0);else if(C===Array){E=S.length,E<16?ht[tt++]=144|E:E<65536?(ht[tt++]=220,ht[tt++]=E>>8,ht[tt++]=E&255):(ht[tt++]=221,ln.setUint32(tt,E),tt+=4);for(let A=0;A<E;A++)x(S[A])}else if(C===Map){E=S.size,E<16?ht[tt++]=128|E:E<65536?(ht[tt++]=222,ht[tt++]=E>>8,ht[tt++]=E&255):(ht[tt++]=223,ln.setUint32(tt,E),tt+=4);for(let[A,D]of S)x(A),x(D)}else{for(let A=0,D=CA.length;A<D;A++){let R=UN[A];if(S instanceof R){let L=CA[A];if(L.write){L.type&&(ht[tt++]=212,ht[tt++]=L.type,ht[tt++]=0),x(L.write.call(this,S));return}let O=ht,H=ln,j=tt;ht=null;let Y;try{Y=L.pack.call(this,S,z=>(ht=O,O=null,tt+=z,tt>bc&&M(tt),{target:ht,targetView:ln,position:tt-z}),x)}finally{O&&(ht=O,ln=H,tt=j,bc=ht.length-10)}Y&&(Y.length+tt>bc&&M(Y.length+tt),tt=tPe(Y,ht,tt,L.type));return}}_(S,!S.hasOwnProperty)}}else if(T==="boolean")ht[tt++]=S?195:194;else if(T==="bigint"){if(S<BigInt(1)<<BigInt(63)&&S>=-(BigInt(1)<<BigInt(63)))ht[tt++]=211,ln.setBigInt64(tt,S);else if(S<BigInt(1)<<BigInt(64)&&S>0)ht[tt++]=207,ln.setBigUint64(tt,S);else if(this.largeBigIntToFloat)ht[tt++]=203,ln.setFloat64(tt,Number(S));else throw new RangeError(S+" was too large to fit in MessagePack 64-bit integer format, set largeBigIntToFloat to convert to float-64");tt+=8}else if(T==="undefined")this.encodeUndefinedAsNil?ht[tt++]=192:(ht[tt++]=212,ht[tt++]=0,ht[tt++]=0);else if(T==="function")x(this.writeFunction&&this.writeFunction());else throw new Error("Unknown type: "+T)},_=this.useRecords===!1?this.variableMapSize?S=>{let T=Object.keys(S),E=T.length;E<16?ht[tt++]=128|E:E<65536?(ht[tt++]=222,ht[tt++]=E>>8,ht[tt++]=E&255):(ht[tt++]=223,ln.setUint32(tt,E),tt+=4);let C;for(let A=0;A<E;A++)x(C=T[A]),x(S[C])}:(S,T)=>{ht[tt++]=222;let E=tt-t;tt+=2;let C=0;for(let A in S)(T||S.hasOwnProperty(A))&&(x(A),x(S[A]),C++);ht[E+++t]=C>>8,ht[E+t]=C&255}:S=>{let T=Object.keys(S),E,C=n.transitions||(n.transitions=Object.create(null)),A=0;for(let R=0,L=T.length;R<L;R++){let O=T[R];E=C[O],E||(E=C[O]=Object.create(null),A++),C=E}let D=C[g1];if(D)D>=96&&f?(ht[tt++]=((D-=96)&31)+96,ht[tt++]=D>>5):ht[tt++]=D;else{D=n.nextId,D||(D=64),D<p&&this.shouldShareStructure&&!this.shouldShareStructure(T)?(D=n.nextOwnId,D<v||(D=p),n.nextOwnId=D+1):(D>=v&&(D=p),n.nextId=D+1);let R=T.highByte=D>=96&&f?D-96>>5:-1;C[g1]=D,n[D-64]=T,D<p?(T.isShared=!0,n.sharedLength=D-63,r=!0,R>=0?(ht[tt++]=(D&31)+96,ht[tt++]=R):ht[tt++]=D):(R>=0?(ht[tt++]=213,ht[tt++]=114,ht[tt++]=(D&31)+96,ht[tt++]=R):(ht[tt++]=212,ht[tt++]=114,ht[tt++]=D),A&&(g+=y*A),m.length>=d&&(m.shift()[g1]=0),m.push(C),x(T))}for(let R=0,L=T.length;R<L;R++)x(S[T[R]])},M=S=>{let T;if(S>16777216){if(S-t>o8)throw new Error("Packed buffer would be larger than maximum buffer size");T=Math.min(o8,Math.round(Math.max((S-t)*(S>67108864?1.25:2),4194304)/4096)*4096)}else T=(Math.max(S-t<<2,ht.length-1)>>12)+1<<12;let E=new aR(T);return ln=new DataView(E.buffer,0,T),ht.copy?ht.copy(E,0,t,S):E.set(ht.slice(t,S)),tt-=t,t=0,bc=E.length-10,ht=E}}useBuffer(e){ht=e,ln=new DataView(ht.buffer,ht.byteOffset,ht.byteLength),tt=0}};UN=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,mee];CA=[{pack(e,t,i){let r=e.getTime()/1e3;if((this.useTimestamp32||e.getMilliseconds()===0)&&r>=0&&r<4294967296){let{target:n,targetView:s,position:a}=t(6);n[a++]=214,n[a++]=255,s.setUint32(a,r)}else if(r>0&&r<17179869184){let{target:n,targetView:s,position:a}=t(10);n[a++]=215,n[a++]=255,s.setUint32(a,e.getMilliseconds()*4e6+(r/1e3/4294967296>>0)),s.setUint32(a+4,r)}else if(isNaN(r)){if(this.onInvalidDate)return t(0),i(this.onInvalidDate());let{target:n,targetView:s,position:a}=t(3);n[a++]=212,n[a++]=255,n[a++]=255}else{let{target:n,targetView:s,position:a}=t(15);n[a++]=199,n[a++]=12,n[a++]=255,s.setUint32(a,e.getMilliseconds()*1e6),s.setBigInt64(a+4,BigInt(Math.floor(r)))}}},{pack(e,t,i){let r=Array.from(e),{target:n,position:s}=t(this.structuredClone?3:0);this.structuredClone&&(n[s++]=212,n[s++]=115,n[s++]=0),i(r)}},{pack(e,t,i){let{target:r,position:n}=t(this.structuredClone?3:0);this.structuredClone&&(r[n++]=212,r[n++]=101,r[n++]=0),i([e.name,e.message])}},{pack(e,t,i){let{target:r,position:n}=t(this.structuredClone?3:0);this.structuredClone&&(r[n++]=212,r[n++]=120,r[n++]=0),i([e.source,e.flags])}},{pack(e,t){this.structuredClone?l8(e,16,t):c8(VC?Buffer.from(e):new Uint8Array(e),t)}},{pack(e,t){let i=e.constructor;i!==See&&this.structuredClone?l8(e,bee.indexOf(i.name),t):c8(e,t)}},{pack(e,t){let{target:i,position:r}=t(1);i[r]=193}}];function l8(e,t,i,r){let n=e.byteLength;if(n+1<256){var{target:s,position:a}=i(4+n);s[a++]=199,s[a++]=n+1}else if(n+1<65536){var{target:s,position:a}=i(5+n);s[a++]=200,s[a++]=n+1>>8,s[a++]=n+1&255}else{var{target:s,position:a,targetView:o}=i(7+n);s[a++]=201,o.setUint32(a,n+1),a+=4}s[a++]=116,s[a++]=t,s.set(new Uint8Array(e.buffer,e.byteOffset,e.byteLength),a)}function c8(e,t){let i=e.byteLength;var r,n;if(i<256){var{target:r,position:n}=t(i+2);r[n++]=196,r[n++]=i}else if(i<65536){var{target:r,position:n}=t(i+3);r[n++]=197,r[n++]=i>>8,r[n++]=i&255}else{var{target:r,position:n,targetView:s}=t(i+5);r[n++]=198,s.setUint32(n,i),n+=4}r.set(e,n)}function tPe(e,t,i,r){let n=e.length;switch(n){case 1:t[i++]=212;break;case 2:t[i++]=213;break;case 4:t[i++]=214;break;case 8:t[i++]=215;break;case 16:t[i++]=216;break;default:n<256?(t[i++]=199,t[i++]=n):n<65536?(t[i++]=200,t[i++]=n>>8,t[i++]=n&255):(t[i++]=201,t[i++]=n>>24,t[i++]=n>>16&255,t[i++]=n>>8&255,t[i++]=n&255)}return t[i++]=r,t.set(e,i),i+=n,i}function iPe(e,t){let i,r=t.length*6,n=e.length-r;for(t.sort((s,a)=>s.offset>a.offset?1:-1);i=t.pop();){let s=i.offset,a=i.id;e.copyWithin(s+r,s,n),r-=6;let o=s+r;e[o++]=214,e[o++]=105,e[o++]=a>>24,e[o++]=a>>16&255,e[o++]=a>>8&255,e[o++]=a&255,n=s}return e}function my(e){if(e.Class){if(!e.pack&&!e.write)throw new Error("Extension has no pack or write function");if(e.pack&&!e.type)throw new Error("Extension has no type (numeric code to identify the extension)");UN.unshift(e.Class),CA.unshift(e)}JCe(e)}var Eee=new Mee({useRecords:!1});Eee.pack;Eee.pack;var rPe=512,nPe=1024,u8=new Mee({structuredClone:!0});my({Class:qt.prototype.constructor,type:1,write(e){return{...e}},read(e){return Object.setPrototypeOf(e,qt.prototype),e}});my({Class:kt.prototype.constructor,type:2,write(e){return[...e]},read(e){return Object.setPrototypeOf(e,kt.prototype),e}});my({Class:Is.prototype.constructor,type:3,write(e){return[...e]},read(e){return Object.setPrototypeOf(e,Is.prototype),e}});my({Class:Jj.prototype.constructor,type:4,write(e){return e.id},read(e){return new Jj(e)}});my({Class:$j.prototype.constructor,type:5,write(e){return e.data},read(e){return new $j(e)}});my({Class:On.prototype.constructor,type:6,write(e){return{...e}},read(e){return Object.setPrototypeOf(e,On.prototype),e}});function sPe(e){var t=0;if(e.length===0)return t;for(let i=0;i<e.length;i++){let r=e[i];t=(t<<5)-t+r,t=t&t}return t}function fz(e){if(DN(e))return e;if(Array.isArray(e))return e.map(fz);if(typeof e=="object"&&e!==null){let t={};for(let i of Object.keys(e).sort())t[i]=fz(e[i]);return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),t}else return e}var pz;(e=>{function t(n){return u8.pack(n)}e.serialize=t;function i(n){return u8.unpack(n)}e.deserialize=i;function r(n){return sPe(t(fz(n))).toString()}e.checksum=r})(pz||(pz={}));var h8;(e=>{function t(r){return r.type==="Conditional"?r.condition.type==="Distance"?"Distance":"StateChange":r.type}e.toEventUIType=t;function i(r){return r==="Distance"||r==="StateChange"?"Conditional":r}e.fromEventUIType=i})(h8||(h8={}));function d8(e){return e==="MouseDown"||e==="MouseUp"||e==="KeyDown"||e==="KeyUp"||e==="Collision"||e==="Trigger"}var Qs={LookAt:[],Follow:["Create"],DragDrop:["Transition","Animation","Audio","Particles","Create","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],MouseHover:["Transition","Animation","Particles","Create","Destroy","SwitchCamera","SceneTransition","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],Scroll:["Transition","Animation","Create","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],Start:["Transition","Animation","Audio","Particles","Video","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],Conditional:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],MouseDown:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],MouseUp:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],MousePress:["Transition","Animation","Audio","Particles","Video","Link","Create","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],KeyDown:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],KeyUp:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],KeyPress:["Transition","Animation","Audio","Particles","Video","Link","Create","SwitchCamera","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],GameControl:["Transition","Animation","Audio","Particles","Create","Conditional"],Collision:["Transition","Animation","Audio","Particles","Video","Create","Destroy","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],Trigger:["Transition","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],Resize:["Transition","Animation","Audio","Particles","Video","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],VariableChange:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],API:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],WEBHOOK:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],AIAssistantListener:["SetVariable"],AIAssistantTrigger:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"]},f8;(e=>{function t(r){return r.type==="MouseDown"||r.type==="MouseUp"||r.type==="MousePress"||r.type==="KeyDown"||r.type==="KeyUp"||r.type==="KeyPress"}e.is=t;function i(r){return r==="MouseDown"||r==="MouseUp"||r==="MousePress"?{type:r,mode:"Object",disabled:!1,actions:new kt}:{type:r,disabled:!1,key:void 0,actions:new kt}}e.defaultData=i})(f8||(f8={}));var PA;(e=>{function t(i){return{type:"Property",value:[i??null,"position","x"]}}e.propertyDefaultData=t,e.valueDefaultData={type:"Literal",value:0}})(PA||(PA={}));var mz;(e=>{function t(n){return{type:"Comparison",operator:"==",lOperand:PA.propertyDefaultData(n),rOperand:{...PA.valueDefaultData}}}e.comparisonDefaultData=t;function i(n){return{type:"Distance",toObject:n??null,fromObject:n??null,distance:200}}e.distanceDefaultData=i;function r(n,s){return{type:"State",object:n??null,state:s??null}}e.stateDefaultData=r})(mz||(mz={}));var p8;(e=>{function t(i){return i.find(r=>r==="ifActions"||r==="elseActions")!==void 0}e.isConditionalSubActions=t})(p8||(p8={}));var m8;(e=>{function t(r){return r.type==="Conditional"}e.is=t;function i(r){return{type:"Conditional",disabled:!1,inActions:new kt,outActions:new kt,condition:mz.distanceDefaultData(r)}}e.defaultData=i})(m8||(m8={}));var g8;(e=>e.defaultData={type:"DragDrop",cursor:"hand",disabled:!1,dampingFactor:1,objects:[],snapTo:"center",snapSurfaceMode:"bbox",snapSurfaceOffset:0,dropOn:"all",autoOrient:!0,dropDestinations:[],plane:"adaptive",planeMode:"locked",referenceFrame:"global",limits:[-1/0,1/0,-1/0,1/0,-1/0,1/0],drop:!1,resetOnSnapFail:!1,snapSpeed:20,resetSpeed:20,dragDropActions:{drag:new kt,drop:new kt}})(g8||(g8={}));var gz;(e=>e.defaultData={type:"Follow",disabled:!1,maxDelta:0,dampingFactor:1,target:"cursor",plane:"custom",resetOnPointerLeave:!0,resetAfterDistanceLimit:!0,enabledTranslation:[!0,!0,!0],limitDistanceEnabled:!1,limitDistance:1e3,snapDelay:0,resetSpeed:5,actions:new kt})(gz||(gz={}));var vz;(e=>e.defaultData={type:"LookAt",disabled:!1,distance:1e3,dampingFactor:1,target:"cursor",tilt:"up",axis:"z",plane:"custom",resetOnPointerLeave:!0,resetAfterDistanceLimit:!0,enabledRotation:[!0,!0,!0],limitDistanceEnabled:!1,limitDistance:1e3,snapDelay:0,resetSpeed:5})(vz||(vz={}));var v8;(e=>{function t(r){return r.type==="MouseHover"}e.is=t;function i(){return{type:"MouseHover",disabled:!1,actions:new kt}}e.defaultData=i})(v8||(v8={}));var y8;(e=>{function t(r){return r.type==="Scroll"}e.is=t;function i(){return{type:"Scroll",disabled:!1,steps:100,trigger:"load",startFrom:"enter",enterAnchor:"top",startOffset:0,endAfter:400,actions:new kt}}e.defaultData=i})(y8||(y8={}));var x8;(e=>{function t(r){return r.type==="Start"}e.is=t;function i(){return{type:"Start",disabled:!1,actions:new kt}}e.defaultData=i})(x8||(x8={}));var w8;(e=>{function t(r){return r.type==="Collision"}e.is=t;function i(){return{type:"Collision",disabled:!1,target:"character",actions:new kt}}e.defaultData=i})(w8||(w8={}));var b8;(e=>{function t(r){return r.type==="Trigger"}e.is=t;function i(r,n){return{type:"Trigger",disabled:!1,target:"all",triggeringObjects:[],actions:new kt,triggerZone:"box",position:n.toArray(),rotation:[0,0,0],size:r.toArray(),radius:r.length()/2,helperVisible:!0}}e.defaultData=i})(b8||(b8={}));var yz;(e=>{e.defaultSizes={mobile:[480,480],tablet:[768,768],desktop:[1200,1200],custom:[769,1200]};function t(a){return a.type==="Resize"}e.is=t;function i(a){return typeof a=="string"?a:"custom"}e.sizeToDevice=i;function r(a){return typeof a=="string"?[...e.defaultSizes[a]]:[...a]}e.deviceToSize=r;function n(){let a={size:"mobile",operator:"<",actions:new kt},o={size:"tablet",operator:"<",actions:new kt},l={size:[...e.defaultSizes.custom],operator:"<>",actions:new kt},c=new kt;return c.push({id:Tt.generateUUID(),fi:0,data:a},{id:Tt.generateUUID(),fi:1,data:o},{id:Tt.generateUUID(),fi:2,data:l}),{type:"Resize",disabled:!1,orientation:"horizontal",breakpoints:c}}e.defaultData=n;function s(){return{size:[...e.defaultSizes.custom],operator:"<>",actions:new kt}}e.defaultBreakpointData=s})(yz||(yz={}));var xz;(e=>{e.propertyPaths={Position:["position"],"Position X":["position","x"],"Position Y":["position","y"],"Position Z":["position","z"],Rotation:["rotation"],"Rotation X":["rotation","x"],"Rotation Y":["rotation","y"],"Rotation Z":["rotation","z"],Scale:["scale"],"Scale X":["scale","x"],"Scale Y":["scale","y"],"Scale Z":["scale","z"],Width:["width"],Height:["height"],Depth:["depth"],"Mouse Position X":["mouse","x"],"Mouse Position Y":["mouse","y"],"Mouse Pressed":["mouse","pressed"],"Screen Width":["mouse","width"],"Screen Height":["mouse","height"],"Hit Position X":["raycast","x"],"Hit Position Y":["raycast","y"],"Hit Position Z":["raycast","z"],"Hit Object Position X":["raycast","objX"],"Hit Object Position Y":["raycast","objY"],"Hit Object Position Z":["raycast","objZ"]};function t(r){return r.type==="VariableChange"}e.is=t;function i(){return{disabled:!1,type:"VariableChange",actions:new kt,variableId:"",objectId:null,property:"Position X"}}e.defaultData=i})(xz||(xz={}));var _8;(e=>{function t(r){return r.type==="API"}e.is=t;function i(){return{disabled:!1,type:"API",successActions:new kt,errorActions:new kt,userAPIId:""}}e.defaultData=i})(_8||(_8={}));var S8;(e=>{function t(r){return r.type==="WEBHOOK"}e.is=t;function i(){return{disabled:!1,type:"WEBHOOK",actions:new kt,userWebhookId:""}}e.defaultData=i})(S8||(S8={}));var M8;(e=>{function t(r){return r.type==="AIAssistantListener"}e.is=t;function i(){return{disabled:!1,type:"AIAssistantListener",actions:new kt,analysis:"average",analysisRange:[0,71],analysisSingle:0}}e.defaultData=i})(M8||(M8={}));var E8;(e=>{function t(r){return r.type==="AIAssistantTrigger"}e.is=t;function i(){return{disabled:!1,description:"",type:"AIAssistantTrigger",actions:new kt}}e.defaultData=i})(E8||(E8={}));var gy="personal camera",Ox="a218fcc3-276b-49b9-b485-49037fd14f5f",aPe=2960946,Bo=5526619,dh;(e=>{function t(p,v){return p[0]===v[0]&&p[1]===v[1]}e.isEqual=t;function i(p,v,m){return[p[0]+(v[0]-p[0])*m,p[1]+(v[1]-p[1])*m]}e.lerp=i;function r(p,v){return[p[0]+v[0],p[1]+v[1]]}e.add=r;function n(p,v){return[p[0]-v[0],p[1]-v[1]]}e.sub=n;function s(p,v){return[p[0]*v[0],p[1]*v[1]]}e.multiply=s;function a(p,v){return[p[0]/v[0],p[1]/v[1]]}e.divide=a;function o(p,v){return Math.pow(v[0]-p[0],2)+Math.pow(v[1]-p[1],2)}e.distanceSquared=o;function l(p,v){return Math.sqrt(o(p,v))}e.distance=l;function c(p,v){return p[0]*v[0]+p[1]*v[1]}e.dot=c;function u(p,v){return[p[0]*v,p[1]*v]}e.scalarMultiply=u;function h(p,v,m){let g=e.sub(v,p),y=e.sub(m,p),x=e.dot(g,y)/e.dot(g,g),_=e.scalarMultiply(g,x);return e.add(p,_)}e.projectionOnto=h;function d(p,v,m){return l(p,h(p,v,m))}e.projectionOntoDistance=d;function f(p,v){return[(p[0]+v[0])*.5,(p[1]+v[1])*.5]}e.center=f})(dh||(dh={}));var lm;(e=>{function t(l,c){return l[0]===c[0]&&l[1]===c[1]&&l[2]===c[2]}e.isEqual=t;function i(l,c){return[l[0]+c[0],l[1]+c[1],l[2]+c[2]]}e.add=i;function r(l,c){return[l[0]-c[0],l[1]-c[1],l[2]-c[2]]}e.sub=r;function n(l,c){return[l[0]/c[0],l[1]/c[1],l[2]/c[2]]}e.div=n;function s(l,c){return[l[0]*c[0],l[1]*c[1],l[2]*c[2]]}e.mul=s;function a(l,c){return Math.hypot(l[0]-c[0],l[1]-c[1],l[2]-c[2])}e.dist=a;function o(l,c,u){return[l[0]+(c[0]-l[0])*u,l[1]+(c[1]-l[1])*u,l[2]+(c[2]-l[2])*u]}e.lerp=o})(lm||(lm={}));var DA;(e=>{function t(r,n){return r[0]===n[0]&&r[1]===n[1]&&r[2]===n[2]&&r[3]===n[3]}e.isEqual=t;function i(r,n,s){return[r[0]+(n[0]-r[0])*s,r[1]+(n[1]-r[1])*s,r[2]+(n[2]-r[2])*s,r[3]+(n[3]-r[3])*s]}e.lerp=i})(DA||(DA={}));var A8;(e=>{let t=180/Math.PI,i=Math.PI/180;function r(o){return typeof o=="number"?o*t:o}function n(o){return typeof o=="number"?o*i:o}function s(o){return[r(o[0]),r(o[1]),r(o[2])]}e.radToDeg=s;function a(o){return[n(o[0]),n(o[1]),n(o[2])]}e.degToRad=a})(A8||(A8={}));var U0;(e=>{e.identity=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];function t(n,s){for(let a=0;a<16;a++)if(n[a]!==s[a])return!1;return!0}e.isEqual=t;function i(n){return n??e.identity}e.simplify=i;function r(n,s){let a=s.slice(0);for(var o=0,l=s.length;o<l;o+=3){let c=n[3]*s[o]+n[7]*s[o+1]+n[11]*s[o+2]+n[15];a[o]=(n[0]*s[o]+n[4]*s[o+1]+n[8]*s[o+2]+n[12])/c,a[o+1]=(n[1]*s[o]+n[5]*s[o+1]+n[9]*s[o+2]+n[13])/c,a[o+2]=(n[2]*s[o]+n[6]*s[o+1]+n[10]*s[o+2]+n[14])/c}return a}e.applyMatrix4=r})(U0||(U0={}));var Ds;(e=>{function t(c){return typeof c=="object"&&typeof c.r=="number"&&typeof c.g=="number"&&typeof c.b=="number"}e.isRGB=t,e.white={r:1,g:1,b:1},e.red={r:1,g:0,b:0},e.black={r:0,g:0,b:0};function i(c){return{r:Math.round(c.r*255),g:Math.round(c.g*255),b:Math.round(c.b*255),a:1}}e.toRgb255a1=i;function r(c){return{r:c.r,g:c.g,b:c.b}}e.clone=r;function n(c){return c=Math.floor(c),{r:(c>>16&255)/255,g:(c>>8&255)/255,b:(c&255)/255}}e.fromHex=n;function s(c){return Math.round(c.r*255)*65536+Math.round(c.g*255)*256+Math.round(c.b*255)}e.toHex=s;function a(c,u){return c.r===u.r&&c.g===u.g&&c.b===u.b}e.equals=a;function o(c,u){return c.r.toFixed(2)===u.r.toFixed(2)&&c.g.toFixed(2)===u.g.toFixed(2)&&c.b.toFixed(2)===u.b.toFixed(2)}e.equalsFixed=o;function l(c,u,h){return{r:c.r+(u.r-c.r)*h,g:c.g+(u.g-c.g)*h,b:c.b+(u.b-c.b)*h}}e.lerp=l})(Ds||(Ds={}));var cr;(e=>{e.white={...Ds.white,a:1},e.transparent={...Ds.white,a:0};function t(l){return{r:l[0],g:l[1],b:l[2],a:l[3]}}e.from0to1=t;function i(l,c){return{...Ds.fromHex(l),a:c}}e.fromHexAndA=i;function r(l){return{r:Math.round(l.r*255),g:Math.round(l.g*255),b:Math.round(l.b*255),a:l.a}}e.toRgb255a1=r;function n(l,c){return Ds.equals(l,c)&&l.a===c.a}e.equals=n;function s(l,c){return Ds.equalsFixed(l,c)&&l.a.toFixed(2)===c.a.toFixed(2)}e.equalsFixed=s;function a(l,c,u){return{r:l.r+(c.r-l.r)*u,g:l.g+(c.g-l.g)*u,b:l.b+(c.b-l.b)*u,a:l.a+(c.a-l.a)*u}}e.lerp=a;function o({r:l,g:c,b:u,a:h}=e.white){return`rgba(${l*255}, ${c*255}, ${u*255}, ${h})`}e.toStyle=o})(cr||(cr={}));var wz;(e=>e.identity={position:[0,0,0],rotation:[0,0,0],scale:[1,1,1]})(wz||(wz={}));var T8;(e=>e.defaultData={mass:1,stiffness:80,damping:10,velocity:0})(T8||(T8={}));var C8;(e=>e.defaultData={control1:[.5,0],control2:[.5,1]})(C8||(C8={}));var Md;(e=>(e.linear=[0,0,1,1],e.ease=[.25,.1,.25,1],e.easeIn=[.42,0,1,1],e.easeOut=[0,0,.58,1],e.easeInOut=[.42,0,.58,1]))(Md||(Md={}));function P8(e){return typeof e=="string"&&e.length===36?/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e):!1}var Am;(e=>{e.all=["PerspectiveCamera","OrthographicCamera"];function t(i){return e.all.includes(i)}e.is=t})(Am||(Am={}));var N0;(e=>{e.DefaultUp=[0,1,0],e.DefaultTargetOffset=1e3,e.defaultData={far:1e5,type:"OrthographicCamera",perspective:{near:70,fov:45,zoom:1},orthographic:{near:-1e5,zoom:1},up:e.DefaultUp,isUpVectorFlipped:!1,targetOffset:e.DefaultTargetOffset};function t(i){var r,n;return i.type==="PerspectiveCamera"?((r=i.perspective)==null?void 0:r.zoom)??1:((n=i.orthographic)==null?void 0:n.zoom)??1}e.getZoom=t})(N0||(N0={}));var kd;(e=>{function t(r,n=.1){return{disabled:!1,type:"linear",hideBase:!1,count:3,radial:{radius:Math.max(r[0],r[1])*2,start:0,end:360,alignment:!1,axis:"y",scale:[1,1,1],rotation:[0,0,0],position:[0,0,0]},toObject:{object:"",spreadType:"random",scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],axis:"x",seed:0,count:99,align:"normal"},linear:{scale:[1,1,1],rotation:[0,0,0],position:[r[0]+r[0]*n,0,0]},grid:{count:[2,2,2],size:r.map(s=>s*(1+n)),useCenter:!0},randomness:!1,randomnessObject:{strength:100,scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],movement:1,seed:0,freqScale:10,noiseType:"perlin"}}}e.defaultData=t;function i(r,n){let s={...r};if(Aee.forEach(a=>{Object.assign(s,{[a]:n[a]??r[a]})}),s.radial={...r.radial},n.radial){let a=r.radial,o=n.radial;Tee.forEach(l=>{Object.assign(s.radial,{[l]:o[l]??a[l]})})}if(s.linear={...r.linear},n.linear){let a=r.linear,o=n.linear;Cee.forEach(l=>{Object.assign(s.linear,{[l]:o[l]??a[l]})})}if(s.grid={...r.grid},n.grid){let a=r.grid,o=n.grid;Pee.forEach(l=>{Object.assign(s.grid,{[l]:o[l]??a[l]})})}if(s.toObject={...r.toObject},n.toObject){let a=r.toObject,o=n.toObject;Dee.forEach(l=>{Object.assign(s.toObject,{[l]:o[l]??a[l]})})}if(s.randomnessObject={...r.randomnessObject},n.randomnessObject){let a=r.randomnessObject,o=n.randomnessObject;Ree.forEach(l=>{Object.assign(s.randomnessObject,{[l]:o[l]??a[l]})})}return s}e.merge=i})(kd||(kd={}));var bz;(e=>{e.defaultData={radial:{},linear:{},grid:{},toObject:{},randomnessObject:{}};let t=["radial","linear","grid","toObject","randomnessObject"];function i(r,n){let s=[];r.count!==void 0&&s.push({type:0,path:n,props:{count:r.count}});for(let a of t){let o=r[a];o&&Object.keys(o).length>0&&s.push({type:0,path:[...n,a],props:o})}return s}e.toOps=i})(bz||(bz={}));var Aee=["count"],Tee=["radius","start","end","position","scale","rotation"],Cee=["position","scale","rotation"],Pee=["count","size"],Dee=["count","position","scale","rotation"],Ree=["strength","scale","rotation","position","movement","seed","freqScale"],_z;(e=>{e.all=["PointLight","SpotLight","DirectionalLight","HemisphereLight"];function t(i){return e.all.includes(i)}e.is=t})(_z||(_z={}));var Sz;(e=>{function t(r){return i(r)}e.defaultData=t;function i(r){if(r==="PointLight")return{type:r,color:cr.white,intensity:1,distance:2e3,decay:1,shadows:!0,shadowResolution:1024,shadowRadius:1,penumbraSize:.5,depth:1e5};if(r==="SpotLight")return{type:r,color:cr.white,intensity:1,distance:2e3,decay:1,shadows:!0,penumbra:0,angle:30/180*Math.PI,depth:1e5,penumbraSize:.5,shadowResolution:1024,shadowRadius:1};if(r==="DirectionalLight")return{type:r,color:cr.white,intensity:1,shadows:!0,size:2e3,depth:1e5,penumbraSize:.5,shadowResolution:1024,shadowRadius:1};throw new Error("not implemented")}})(Sz||(Sz={}));var RA;(e=>(e.defaultShapeData={type:"PlaneEmitterShape",size:[100,100,100]},e.defaultCollisionData={colliderEntityId:null,collisionBounce:.75},e.defaultData={renderMaterial:{type:"particleMaterial",color:{r:1,g:.2,b:.545,a:1},color2:{r:.945,g:.714,b:.184,a:1},coloring:"gradient",ease:"linearFadeOut",easeSize:"linearFadeOut",transparent:!0,size:[40,40],texture:"pt_default_particle",spriteRotation:[0,0]},birthRatePerSec:50,gravity:1,noiseStrength:0,noiseScale:0,noiseSeed:1,noiseType:"curl",randomRotation:0,randomScale:.2,randomMass:.5,rootObjectType:"instancedMesh",life:1,direction:[0,0,0],directionMode:"axis",speed:10,shape:e.defaultShapeData,autoPlay:!0,emitTimeDelay:0,emitTimeCycle:"infinity",emitTimeDuration:1,...e.defaultCollisionData}))(RA||(RA={}));var k0;(e=>e.defaultData={enabled:"visibility",fusedBody:!0,rigidBody:"positioned",density:1,pointMass:0,gravityScale:1,friction:.5,damping:0,restitution:.2,colliderType:"convex",enabledRotation:[!0,!0,!0],enabledTranslation:[!0,!0,!0]})(k0||(k0={}));var Mz;(e=>{e.defaultData={castShadow:!0,receiveShadow:!0};function t(i,r){return i.castShadow===r.castShadow&&i.receiveShadow===r.receiveShadow}e.equals=t})(Mz||(Mz={}));var Ez;(e=>{e.defaultData={flatShading:!1,wireframe:!1,side:0};function t(i,r){return i.flatShading===r.flatShading&&i.side===r.side&&i.wireframe===r.wireframe}e.equals=t})(Ez||(Ez={}));var Az;(e=>e.defaultData={...Ez.defaultData,...Mz.defaultData})(Az||(Az={}));var D8;(e=>{function t(i,r){var s,a;let n=[];if("material"in i){let o=typeof i.material=="string"?r.materials[i.material]??((s=r.lib.materials[i.material])==null?void 0:s.asset):i.material;o&&n.push(o)}else if("materials"in i)for(let o of i.materials){let l=typeof o=="string"?r.materials[o]??((a=r.lib.materials[o])==null?void 0:a.asset):o;l&&n.push(l)}return n}e.getMaterialData=t})(D8||(D8={}));var IA;(e=>(e.defaultVideo={data:"",thumb:"/_assets/_videos/catThumb.png",type:"video",name:"Cat video"},e.maxSize=3e7))(IA||(IA={}));var R8;(e=>{function t(i){return i==="texture"||i==="video"||i==="color"||i==="depth"||i==="normal"||i==="gradient"||i==="noise"||i==="fresnel"||i==="rainbow"||i==="toon"||i==="outline"||i==="particle"||i==="transmission"||i==="matcap"||i==="displace"||i==="pattern"||i==="light"}e.is=t})(R8||(R8={}));function oPe(e){return e.type!=="displace"}var I8;(e=>{function t(i){return i==="phong"||i==="toon"||i==="lambert"||i==="physical"}e.is=t})(I8||(I8={}));var Iee=["mode","gradientType","noiseType","displacementType","projection","cnormal","crop","axis","side"],lPe=["wrapping","image","video","name","minFilter","magFilter"],cs;(e=>{function t(s,a){let{texture:o,...l}=a;if(Object.assign(s,l),o){let c=s.texture;c&&Object.assign(c,o)}}e.patch=t;function i(s,a){return s==="light"&&a?r(a):n(s)}e.defaultData=i;function r(s){let a={mode:0,isMask:!1,visible:!0,bumpMap:void 0,bumpMapIntensity:5,roughnessMap:void 0,alphaOverride:1};switch(s){case"phong":return{...a,category:"phong",specular:{r:.2,g:.2,b:.2},shininess:5,type:"light",visible:!0,mode:0,occlusion:!0,alpha:.6};case"toon":return{...a,category:"toon",specular:{r:.2,g:.2,b:.2},shininess:10,type:"light",alpha:1};case"lambert":return{...a,category:"lambert",emissive:{r:0,g:0,b:0},type:"light",alpha:1,visible:!0,mode:0,occlusion:!0};case"physical":return{...a,category:"physical",roughness:.2,metalness:.2,reflectivity:.2,type:"light",alpha:1,visible:!0,mode:0,occlusion:!0}}}function n(s){let a={alpha:1,mode:0,isMask:!1,visible:!0};switch(s){case"texture":return{...a,type:"texture",size:[128,128],blending:0,axis:"x",side:2,projection:0,texture:{image:"image_0",wrapping:1e3,repeat:[1,1],offset:[0,0],rotation:0,minFilter:1008,magFilter:1006},crop:!1};case"video":return{...a,type:"video",size:[128,128],blending:0,axis:"x",side:2,projection:0,texture:{video:IA.defaultVideo,wrapping:1001,repeat:[1,1],offset:[0,0],rotation:0,minFilter:1008,magFilter:1006},crop:!1};case"color":return{...a,type:"color",color:Ds.fromHex(Bo)};case"depth":return{...a,type:"depth",gradientType:1,smooth:!1,isVector:!0,isWorldSpace:!1,origin:[0,0,0],direction:[1,0,0],colors:[[1,1,1,1],[0,0,0,1]],steps:[0,1],near:50,far:200};case"normal":return{...a,type:"normal",cnormal:[1,1,1]};case"gradient":return{...a,type:"gradient",gradientType:0,smooth:!1,colors:[[0,0,0,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1]],steps:[0,1,1,1,1,1,1,1,1,1],num:2,angle:0,offset:[0,0],morph:[0,0]};case"noise":return{...a,type:"noise",size:[100,100,100],noiseType:0,scale:1,move:1,colorA:{...Ds.fromHex(6710886),a:1},colorB:{...Ds.fromHex(6710886),a:1},colorC:{...Ds.fromHex(16777215),a:1},colorD:{...Ds.fromHex(16777215),a:1},distortion:[1,1],fA:[1.7,9.2],fB:[8.3,2.8],voronoiStyle:0,highCut:1,lowCut:0,smoothness:.3,seed:0,quality:1};case"fresnel":return{...a,type:"fresnel",color:cr.fromHexAndA(16777215,1),bias:.1,scale:1,intensity:2,factor:1};case"rainbow":return{...a,type:"rainbow",filmThickness:30,movement:0,wavelengths:[0,0,0],noiseStrength:0,noiseScale:1,offset:[0,0,0]};case"toon":return{...a,type:"toon",positioning:2,colors:[[0,0,0,1],[.5,.5,.5,1],[.5,.5,.5,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1]],steps:[0,.475,.525,1,1,1,1,1,1,1],num:4,source:[0,1e3,0],isWorldSpace:!0,noiseStrength:0,noiseScale:1,shadowColor:cr.fromHexAndA(0,0),offset:[0,0,0]};case"outline":return{...a,type:"outline",outlineColor:cr.fromHexAndA(0,1),contourColor:cr.fromHexAndA(0,1),outlineWidth:2,contourWidth:5,outlineThreshold:.4,contourThreshold:0,outlineSmoothing:0,contourFrequency:10,contourDirection:[0,1,0],positionalLines:!1,compensation:!0};case"matcap":return{...a,type:"matcap",texture:{image:"matcap_0",wrapping:1001,repeat:[1,1],offset:[0,0],rotation:0,minFilter:1008,magFilter:1006}};case"transmission":return{...a,type:"transmission",thickness:10,ior:1.5,roughness:1};case"displace":return{visible:!0,type:"displace",displacementType:"noise",noiseType:0,scale:10,movement:1,offset:[0,0,0],intensity:8,voronoiStyle:0,smoothness:.3,seed:0,highCut:1,lowCut:0,quality:1};case"pattern":return{...a,type:"pattern",style:0,projection:0,axis:"y",blending:0,offset:[0,0],colorA:{...Ds.fromHex(0),a:1},colorB:{...Ds.fromHex(16777215),a:1},frequency:[10,10],size:.5,variation:0,smoothness:.5,zigzag:0,rotation:0,vertical:[0,1],horizontal:[0,1],sides:6}}}})(cs||(cs={}));var ps;(e=>{function t(u){return!u.layers.some(h=>h.data.type==="texture"&&h.data.projection!==0||h.data.type==="depth"&&!h.data.isWorldSpace||h.data.type==="noise"||h.data.type==="displace")}e.isMergable=t;function i(u){let h="";return u.layers.forEach(d=>{Object.entries(d.data).forEach(([f,p])=>{h+=`${f}${p}`,Array.isArray(p)?p.forEach(v=>h+=`${v}`):typeof p=="object"?Object.values(p).forEach(v=>{typeof v=="number"?h+=`${v.toFixed(4)}`:h+=`${v}`}):h+=`${p}`})}),h}e.getHash=i;function r(){return{layers:new kt}}e.defaultEmptyData=r;function n(u="layer1",h="layer2"){return a("phong",u,h)}e.defaultData=n;function s(u,h){return{...u,name:h}}e.withName=s;function a(u,h="layer1",d="layer2"){let f=new kt;return f.push({fi:0,data:cs.defaultData("light",u),id:h}),f.push({fi:1,data:cs.defaultData("color"),id:d}),{layers:f}}e.defaultTwoLayerData=a;function o(u){let h=cs.defaultData("texture");u&&Object.assign(h.texture,{image:u});let d=new kt;return d.push({fi:0,data:h,id:"layer1"}),d.push({fi:1,data:{...cs.defaultData("transmission"),alpha:1},id:"layer2"}),d.push({fi:2,data:{...cs.defaultData("light","lambert"),alpha:0},id:"layer3"}),{layers:d}}e.defaultUIObjectMaterial=o;function l(u,h="phong",d="layer1",f="layer2"){let p=cs.defaultData("texture");Object.assign(p.texture,{image:u});let v=new kt;return v.push({fi:0,data:p,id:d}),v.push({fi:1,data:cs.defaultData("light",h),id:f}),{layers:v}}e.defaultTwoLayerTextureData=l;function c(u,h="phong",d="layer1",f="layer2"){let p=cs.defaultData("video");Object.assign(p.texture,{video:u});let v=new kt;return v.push({fi:0,data:p,id:d}),v.push({fi:1,data:cs.defaultData("light",h),id:f}),{layers:v}}e.defaultTwoLayerVideoTextureData=c})(ps||(ps={}));var LA;(e=>{function t(){return{points:new kt,roundness:0,shapeHoles:[],isClosed:!1}}e.defaultData=t})(LA||(LA={}));var OA;(e=>{function t(){return{points:new kt,lastInsertionPlane:null,subdivisions:12,isClosed:!1}}e.defaultData=t})(OA||(OA={}));var Lee={type:"Ellipse",width:50,height:50,spikes:16,angle:360,innerRadius:0},Tz;(e=>{function t(i,r){let n={...i};return zee.forEach(s=>{Object.assign(n,{[s]:r[s]??i[s]})}),n}e.merge=t})(Tz||(Tz={}));var Oee={shape:Lee,depth:1,offset:0,bevel:50,bevelSides:6,angle:0,twist:0,startScale:1,endScale:1,capType:"flat"},zee=["depth","offset","angle","twist","startScale","endScale"],zA;(e=>{function t(r){return r==="PolygonGeometry"||r==="RectangleGeometry"||r==="StarGeometry"||r==="TriangleGeometry"||r==="EllipseGeometry"||r==="UIGeometry"}e.is2DParametricMesh=t;function i(r){return r==="PolygonGeometry"||r==="PolygonGeometry"||r==="RectangleGeometry"||r==="StarGeometry"||r==="TriangleGeometry"||r==="EllipseGeometry"||r==="PathGeometry"||r==="VectorGeometry"||r==="ConeGeometry"||r==="CubeGeometry"||r==="CylinderGeometry"||r==="DodecahedronGeometry"||r==="HelixGeometry"||r==="IcosahedronGeometry"||r==="LatheGeometry"||r==="PyramidGeometry"||r==="SphereGeometry"||r==="PlaneGeometry"||r==="BackdropGeometry"||r==="TorusGeometry"||r==="TorusKnotGeometry"||r==="BooleanGeometry"||r==="TextGeometry"||r==="InputGeometry"}e.isParametricMesh=i})(zA||(zA={}));var Cz;(e=>{function t(i,r){let n={...i};return Object.assign(n,r),n.type==="PathGeometry"&&"extrusion"in r&&r.extrusion&&(n.extrusion={...i.extrusion},Object.assign(n.extrusion,Tz.merge(n.extrusion,r.extrusion))),n}e.merge=t})(Cz||(Cz={}));var Cd;(e=>{function t(i){if(i==="RectangleGeometry")return{width:320,height:320,type:i,cornerRadius:[0,0,0,0],cornerType:0,depth:0,extrudeBevelSize:0,extrudeBevelSegments:1};if(i==="UIGeometry")return{type:i,frame:"",cornerRadius:[0,0,0,0],cornerType:0,width:1,height:1};if(i==="PathGeometry")return{type:i,width:1,height:1,depth:1,path:OA.defaultData(),extrusion:Oee};if(i==="VectorGeometry")return{width:1,height:1,type:i,subdivisions:12,shape:LA.defaultData(),depth:0,extrudeBevelSize:0,extrudeBevelSegments:1};if(i==="BooleanGeometry")return{type:i,operation:2,width:0,height:0,depth:0,phongAngle:35};if(i==="ShapeBlendGeometry")return{type:i,width:0,height:0,depth:0,resolutionLevel:6,blendRange:100,useChildrenColors:!1};if(i==="TextGeometry")return{type:i,width:100,height:100,depth:0,horizontalAlign:1,verticalAlign:1,fontSize:16,lineHeight:1.2,letterSpacing:0,text:{textValue:""},textTransform:1,font:"Roboto_regular",editable:!1,extrudeBevelSize:0,extrudeBevelSegments:1};if(i==="InputGeometry")return{...e.defaultData("TextGeometry"),type:i,editable:!0};if(i==="SphereGeometry")return{type:"SphereGeometry",width:100,height:100,depth:100,widthSegments:64,heightSegments:64,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:180};throw new Error("not implemented")}e.defaultData=t})(Cd||(Cd={}));var oR=["width","height","depth"],Pz;(e=>e.defaultData={enabled:!1,useBackgroundColor:!1,color:Ds.white,near:.1,far:2e3})(Pz||(Pz={}));var BA;(e=>{let t={opacity:1,blendFunction:13,enabled:!1};e.defaultData={enabled:!1,pixelation:{...t,blendFunction:16,granularity:15},bloom:{...t,blendFunction:16,intensity:1,blurScale:1,luminanceThreshold:.25,luminanceSmoothing:.025,kernelSize:3},chromaticAberration:{...t,offset:[2,2]},vignette:{...t,darkness:1,offset:0},hueSaturation:{...t,hue:3,saturation:0},brightnessContrast:{...t,brightness:.25,contrast:0},depthOfField:{...t,focusDistance:100,focalLength:20,bokehScale:5},noise:{...t,blendFunction:16}}})(BA||(BA={}));var Dz;(e=>e.defaultData={softShadowQuality:"low"})(Dz||(Dz={}));var Rz;(e=>e.defaultData={enabled:!0,color:{r:.8274509803921568,g:.8274509803921568,b:.8274509803921568},intensity:.75})(Rz||(Rz={}));var Iz;(e=>e.defaultData={occlusion:!1,aoFullRes:!1,radius:256,bias:.5,aoColor:{r:.19607843137254902,g:.19607843137254902,b:.19607843137254902}})(Iz||(Iz={}));var V0;(e=>e.defaultData={usePhysics:!1,gravity:-10})(V0||(V0={}));var Lz;(e=>e.defaultData={playCamera:gy,gameControlObject:null})(Lz||(Lz={}));var Oz;(e=>e.defaultData={backgroundColor:cr.fromHexAndA(aPe,1),postprocessing:BA.defaultData,fog:Pz.defaultData,globalPhysics:V0.defaultData,ambient:Rz.defaultData,ao:Iz.defaultData,shadow:Dz.defaultData,publish:Lz.defaultData})(Oz||(Oz={}));var zz;(e=>e.defaultData={colliderType:"box",size:[100,100,100],colliderHelperVisible:!0,forceType:"collider",forceRange:"global",forceIntensity:.5,forceDambing:.95})(zz||(zz={}));var L8;(e=>{function t(r){return r==="Component"||r==="Instance"}e.isComponentRelated=t;function i(r){return r==="Empty"||r==="Instance"}e.isEmptyOrComponent=i})(L8||(L8={}));var G0;(e=>{e.identity={...wz.identity,hiddenMatrix:U0.identity};function t(n){return{position:n.position,rotation:n.rotation,scale:n.scale,hiddenMatrix:n.hiddenMatrix}}e.fromObject=t;function i(n,s){return{position:(s==null?void 0:s.position)||n.position,rotation:(s==null?void 0:s.rotation)||n.rotation,scale:(s==null?void 0:s.scale)||n.scale,hiddenMatrix:(s==null?void 0:s.hiddenMatrix)||n.hiddenMatrix}}e.merge=i;function r(n,s){return K$({position:lm.isEqual(n.position,s.position)?void 0:s.position,rotation:lm.isEqual(n.rotation,s.rotation)?void 0:s.rotation,scale:lm.isEqual(n.scale,s.scale)?null:s.scale,hiddenMatrix:U0.isEqual(n.hiddenMatrix,s.hiddenMatrix)?void 0:s.hiddenMatrix})}e.diff=r})(G0||(G0={}));var qn;(e=>e.defaultData={states:new kt,events:new kt,visible:!0,raycastLock:!1,physics:k0.defaultData,pathSnapping:{pathId:null,slide:0,offset:0,orientation:"tangential"},...G0.identity,cloner:null})(qn||(qn={}));var Bz;(e=>e.defaultData={type:"Empty",...qn.defaultData})(Bz||(Bz={}));var O8;(e=>e.defaultData={type:"ParticleCollider",...zz.defaultData,...qn.defaultData})(O8||(O8={}));var z8;(e=>e.defaultData={type:"Component",...qn.defaultData})(z8||(z8={}));var B8;(e=>e.defaultData={type:"Particle",...qn.defaultData,...RA.defaultData})(B8||(B8={}));var Pd;(e=>e.defaultData={type:"Mesh",...qn.defaultData,...Az.defaultData})(Pd||(Pd={}));var Vw;(e=>e.defaultData={...qn.defaultData,...G0.identity,position:[0,0,N0.DefaultTargetOffset],...N0.defaultData})(Vw||(Vw={}));var Fz;(e=>{function t(i){return{...qn.defaultData,...Sz.defaultData(i)}}e.defaultData=t,e.defaultDirectionalLightData={...e.defaultData("DirectionalLight"),position:[200,300,300],name:"Directional Light",intensity:.7}})(Fz||(Fz={}));var FA;(e=>{function t(r,n,s=0){for(;s<n.length;){let a=r?r[n[s]]:void 0;if(n.length===s+1)return a;if(a)r=a.descendants,s+=1;else return}}e.resolveWithDes=t;function i(r,n,s=0){let a=t(r,n,s);if(a){let o=Object.keys(a);if(o.length===1&&o[0]==="descendants")return}return a}e.resolve=i})(FA||(FA={}));var Vd;(e=>{e.rootOverrideProps=["physics","events"],e.compositeNonOptionalOverrideProps=["geometry"],e.compositeEntireOverrideOverrideProps=["material"];function t(r,n){return{...qn.defaultData,...n,component:r,overrides:new On,physics:void 0,events:void 0,type:"Instance"}}e.ofComponent=t;function i(r){let n=G0.fromObject(r.data);return t(r.id,n)}e.fromComponentData=i})(Vd||(Vd={}));var H0;(e=>{e.defaultData={type:"Page",...qn.defaultData,physics:{...k0.defaultData,fusedBody:!1},...Oz.defaultData,camera:Vw.defaultData};function t(i){return i.uiScene!==void 0}e.isUIPage=t})(H0||(H0={}));var Uz;(e=>(e.defaultCamera={position:[0,0,1e3],scale:[1,1,1],rotation:[0,0,0],hiddenMatrix:U0.identity,name:"Play Camera",visible:!0,raycastLock:!1,physics:k0.defaultData,states:new kt,events:new kt,cloner:null,pathSnapping:{pathId:null,orientation:"tangential",slide:0,offset:0},...N0.defaultData},e.KeysByResetCategory={States:["states"],Events:["events"],Material:["material","materials"],Geometry:["geometry"],Position:["position"],Rotation:["rotation"],Scale:["scale"],Transform:["position","scale","rotation","hiddenMatrix"],Name:["name"],Visibility:["visible","raycastLock","flatShading","wireframe","side"],Shadows:["castShadow","receiveShadow"],Cloner:["cloner"],Physics:["physics"]},e.defaultMeshObject={name:"Rectangle",...qn.defaultData,...Pd.defaultData,geometry:Cd.defaultData("RectangleGeometry"),material:ps.defaultTwoLayerData("phong","layer1","layer2")},e.defaultBooleanObject={name:"Boolean",...qn.defaultData,...Pd.defaultData,geometry:Cd.defaultData("BooleanGeometry"),material:ps.defaultTwoLayerData("phong","layer1","layer2")},e.defaultShapeBlendObject={name:"Shape Blend",...qn.defaultData,...Pd.defaultData,geometry:Cd.defaultData("ShapeBlendGeometry"),material:ps.defaultTwoLayerData("phong","layer1","layer2")},e.defaultTextObject={name:"Text",...qn.defaultData,...Pd.defaultData,geometry:Cd.defaultData("TextGeometry"),material:ps.defaultTwoLayerData("phong","layer1","layer2")},e.defaultInputObject={name:"Input",...qn.defaultData,...Pd.defaultData,geometry:Cd.defaultData("InputGeometry"),material:ps.defaultTwoLayerData("phong","layer1","layer2")}))(Uz||(Uz={}));var Wp;(e=>{function t(s,a){let o={name:a};return s.type==="Mesh"?(o.geometry={},"material"in s&&(o.material={layers:new On}),"materials"in s&&(o.materials=s.materials.map(l=>({layers:new On})))):Am.is(s.type)&&(o.perspective={},o.orthographic={}),o}e.newEmpty=t;function i(s,a){if(a===void 0)return s;let o={...s};return"material"in o&&"material"in a&&a.material&&(o.material=kw(o.material,l=>{if(typeof l!="string")for(let[c,u]of Object.entries(a.material.layers)){let h=l.layers.data(c);h&&cs.patch(h,u)}}).data),o.materials&&a.materials&&(o.materials=kw(o.materials,l=>{var c,u;for(let h=0;h<o.materials.length;h++){let d=a.materials[h];if(typeof d!="string")for(let[f,p]of Object.entries(d.layers)){let v=(u=(c=l[h])==null?void 0:c.layers)==null?void 0:u.data(f);v&&cs.patch(v,p)}}}).data),o}function r(s,a){let o,l=[],c={orthographic:0,perspective:0,geometry:0};function u(h,d){for(let[f,p]of Object.entries(d.layers)){let{texture:v,...m}=p;if(v!==void 0&&Object.keys(v).length>0){let g={path:[...h,"layers",f,"texture"],props:v,type:0};l.push(g)}if(Object.keys(m).length>0){let g={path:[...h,"layers",f],props:m,type:0};l.push(g)}}}for(let[h,d]of Object.entries(a))if(h!=="name")if(h==="cloner")l.push(...bz.toOps(d,["cloner"]));else if(h==="pathSnapping")l.push({path:[h],props:{slide:d.slide,offset:d.offset},type:0});else if(h==="material")u(["material"],d);else if(h==="materials")for(let[f,p]of Object.entries(d))u(["materials",f],p);else if(c[h]===0){if(h==="geometry"&&d.extrusion!==void 0){let f={path:[h,"extrusion"],props:d.extrusion,type:0};l.push(f),d={...d},delete d.extrusion}if(Object.keys(d).length>0){let f={path:[h],props:d,type:0};l.push(f)}}else o===void 0&&(o={path:[],props:{},type:0},l.push(o)),o.props[h]=d;return l}e.toOps=r;function n(s,a){var l,c,u,h,d,f;if(a===void 0)return s;let o={...s};if(Object.assign(o,G0.merge(o,a)),Object.assign(o,{pathSnapping:Object.assign({},o.pathSnapping,{slide:((l=a.pathSnapping)==null?void 0:l.slide)??((c=o.pathSnapping)==null?void 0:c.slide)??0,offset:((u=a.pathSnapping)==null?void 0:u.offset)??((h=o.pathSnapping)==null?void 0:h.offset)??0})}),Am.is(s.type)){o.orthographic={...o.orthographic},o.perspective={...o.perspective};let p=a;((d=p.orthographic)==null?void 0:d.zoom)!==void 0&&(o.orthographic.zoom=p.orthographic.zoom),((f=p.perspective)==null?void 0:f.zoom)!==void 0&&(o.perspective.zoom=p.perspective.zoom),p.isUpVectorFlipped!==void 0&&(o.isUpVectorFlipped=p.isUpVectorFlipped),p.targetOffset!==void 0&&(o.targetOffset=p.targetOffset)}else if(s.type==="Mesh")"geometry"in a&&Object.assign(o,{geometry:Cz.merge(o.geometry,a.geometry)}),(a.material||a.materials)&&(o=i(o,a)),o.cloner&&"cloner"in a&&Object.assign(o,{cloner:kd.merge(o.cloner,a.cloner)});else if(s.type==="Empty")o.cloner&&"cloner"in a&&Object.assign(o,{cloner:kd.merge(o.cloner,a.cloner)});else if(_z.is(s.type)){let p=a;p.intensity!==void 0&&(o.intensity=p.intensity),p.color!==void 0&&(typeof p.color=="string"?o.color=p.color:o.color=Ds.clone(p.color))}return o}e.patch=n})(Wp||(Wp={}));var UA;(e=>e.defaultData={enablePan:!0,enableZoom:!0,enableRotate:!0,enableDamping:!0,rotationLimitsMode:0,rotationVerticalOffset:{min:Math.PI/4,max:Math.PI/4},rotationHorizontalOffset:{min:Math.PI/4,max:Math.PI/4},rotationSoftLimit:2,panLimitsMode:0,panVerticalOffset:{min:250,max:250},panHorizontalOffset:{min:250,max:250},panSoftLimit:2,zoomLimitsEnabled:!1,zoomLimits:{min:.1,max:2},autoRotate:!1,autoRotateSpeed:2,autoRotateClockwise:!0,hoverRotatePanMode:0,hoverRotatePanStrength:20,hoverRotateDamping:.125,isTouchZoom:!0,orbitTouches:2,panTouches:3,resetHoverEffectOnPointerLeave:!0})(UA||(UA={}));var Gd;(e=>e.defaultData={orbitControls:UA.defaultData,playPage:Ox,withBackground:!0,preventScroll:!1,preventTouchScroll:!1,hideCursor:!1,mouseEventTarget:"canvas",joystickSizeAndXYOffset:Array(12).fill(0).map((t,i)=>{let r=0,n=0;return i<5?n=-30:i<10&&(n=30),i===0||i===10||i===5?r=30:(i===4||i===11||i===9)&&(r=-30),[120,[r,n],"show"]}),settings:{image:{format:"jpg",ratio:1},video:{format:"mp4",imageFormat:"jpg",fps:30,mbps:80,ratio:Math.max(1,typeof window<"u"?Math.floor(window.devicePixelRatio):1),stopMode:"manual",duration:5e3},web:{logo:!0,compress:!0,preset:1,preload:!0,hint:!1,imageQuality:70}},stopRaycast:!0,hdTransmission:!1})(Gd||(Gd={}));var Nz;(e=>e.defaultData={id:"basic",label:"Basic",style:"None",prompt:""})(Nz||(Nz={}));var kz;(e=>e.defaultData={weather:0,shadows:0,lightOrigin:0,temperature:0,sun:0,camera:0,environment:0,particles:0,nature:0,floor:0})(kz||(kz={}));var Xp;(e=>(e.defaultData=()=>({mode:"line-art-both",prompt:"",negativePrompt:"",style:{...Nz.defaultData},isRandomSeed:!0,seed:e.generateSeed(),guessMode:!1,advanced:!1,steps:20,guidanceScale:7.5,controlNetScale:1,modifiers:kz.defaultData}),e.generateSeed=()=>Math.round(Math.random()*1e5)))(Xp||(Xp={}));var Gw;(e=>{function t(r){return r.find(n=>n.data.type==="Page"&&n.data.globalPhysics.usePhysics)!==void 0}e.physicsEnabled=t;function i(r,n,s){r.scene.objects.traverseFrom(n,(a,o)=>{var l;if(o.type==="Instance"){let c=(l=VA.getComponentData(r,o.component))==null?void 0:l.data;c&&s(a,o,c.events)}else s(a,o,o.events)})}e.traverseModuleInstances=i})(Gw||(Gw={}));var qp;(e=>{e.TRASH_CAN_ID="830a2708-8ed9-49cf-a68e-085299892222",e.defaultLight={fi:-1,data:Fz.defaultDirectionalLightData,id:"830a2708-8ed9-49cf-a68e-085299899103",children:[]};function t(n=!0,s=[]){let a=[],o=Uz.defaultMeshObject;n&&(a.push({...e.defaultLight}),a.push({fi:1,id:"7ba78968-2a55-48f2-b14c-5191da3e075e",data:o,children:[]})),a.push(...s);let l=new Is;return l.push({fi:1,id:Ox,data:{...H0.defaultData,name:"Scene 1"},children:a}),l}e.createDefaultObjectTreeWithPage=t,e.defaultData={objects:t(),publish:Gd.defaultData,styles:Xp.defaultData()},e.emptyDataWithoutPage=function(){return{objects:new Is,publish:Gd.defaultData,styles:Xp.defaultData()}},e.emptyDataWithPage=function(n=!0){return{objects:t(n),publish:Gd.defaultData,styles:Xp.defaultData()}},e.emptyData=function(){return{objects:new Is,publish:{...Gd.defaultData},styles:Xp.defaultData()}};function i(n){return{...e.defaultData,objects:_l(n,Is.prototype)}}e.withObjs=i;function r(n,s){return i([{id:n,data:s,children:[],fi:0}])}e.withObj=r})(qp||(qp={}));var zx;(e=>e.defaultData={preset:"fullscreen",allowResponsive:!1,size:[512,512],coords:[0,0],sceneScale:1,color:{r:0,g:0,b:0,a:.5}})(zx||(zx={}));var Vz;(e=>(e.defaultData=t=>({url:t,name:"New Webhook",parametersSchemas:new kt}),e.defaultParameterValueByType=t=>t==="number"?0:t==="boolean"?!1:""))(Vz||(Vz={}));var F8;(e=>e.defaultData=(t,i="GET")=>({url:t,method:i,name:"New API",headers:new kt,queries:new kt,autoStart:!0}))(F8||(F8={}));var Ls;(e=>{function t(a){return a.textValue!==void 0}e.isTextValue=t;function i(a){return typeof a=="number"}e.isNumber=i;function r(a){return typeof a=="boolean"}e.isBoolean=r;function n(a){return t(a)?"string":r(a)?"boolean":"number"}e.typeOfVariable=n;function s(a){return e.isTextValue(a)?Array.isArray(a.textValue)?a.textValue.map(o=>o.toString().padStart(a.padding??2,"0")).join(a.deliminator??":")+(a.suffix!==void 0?" "+a.suffix:""):a.textValue.toString():e.isBoolean(a)?a?"True":"False":e.isNumber(a)?parseFloat(a.toFixed(3)).toString():a.toString()}e.getDisplayedValue=s})(Ls||(Ls={}));var Gz;(e=>e.all=["images","videos","colors","audios","particles","fonts","materials","variables"])(Gz||(Gz={}));var U8;(e=>e.all=[...Gz.all,"components"])(U8||(U8={}));var N8;(e=>{function t(){return{images:new qt,videos:new qt,colors:new qt,audios:new qt,particles:new qt,fonts:new qt,materials:new qt,components:new qt,variables:new qt,userAPIs:new qt,userWebhooks:new qt}}e.defaultData=t})(N8||(N8={}));var Dh;(e=>{function t(){return{images:new qt,videos:new qt,colors:new qt,audios:new qt,particles:new qt,fonts:new qt,materials:new qt,components:new qt,variables:new qt,userAPIs:new qt,userWebhooks:new qt}}e.defaultData=t})(Dh||(Dh={}));var ol;(e=>{function t(){let a={};return a["89b10010-844c-11ec-a8a3-0242ac120002"]={r:.5,g:.5,b:.5,a:1,name:"Default Color"},_l(a,qt.prototype)}e.defaultColors=t;function i(){return _l({},qt.prototype)}e.defaultImages=i;function r(){return{catelogs:new qt,materials:new qt,images:new qt,videos:new qt,colors:new qt,audios:new qt,particles:new qt,fonts:new qt,variables:new kt,userAPIs:new qt,userWebhooks:new qt,lib:Dh.defaultData()}}e.emptyData=r;function n(a){switch(a){case"number":return{value:0,name:"Number"};case"boolean":return{value:!1,name:"Boolean"};case"string":return{value:{textValue:"String value"},name:"String"};case"time":let o=[0,0,0];return{name:"Time",value:{textValue:o,deliminator:":",padding:2,suffix:"AM"},dynamicVariableType:"time",format:"HH:mm:ss",format12h24h:"12ampm",timeZone:null,hasEnd:!1,endValue:{textValue:o,deliminator:":",padding:2,suffix:"AM"},autoStart:!0,repeat:!1};case"counter":return{name:"Counter",value:0,dynamicVariableType:"counter",updateInterval:1e3,increment:1,autoStart:!0,hasEnd:!0,endValue:60,repeat:!0,randomStart:!1,range:[0,100],decimals:0};case"random":return{name:"Random",value:0,dynamicVariableType:"random",updateInterval:1e3,increment:1,autoStart:!0,isStatic:!1,hasEnd:!0,endValue:60,repeat:!0,min:0,max:100,decimals:0};default:console.error("Unknown variable type",a)}}e.defaultVariables=n;function s(a,o){if(o.format==="HH:mm:ss"){let l=Math.floor(a/3600),c=Math.floor((a-l*3600)/60),u=Math.round(a-l*3600-c*60);return{textValue:[l,c,u]}}else if(o.format==="mm:ss"){let l=Math.floor(a/60),c=Math.round(a-l*60);return{textValue:[l,c]}}else return o.format==="number"?a=Math.round(a):a=Math.round(a*1e3)/1e3,a}e.getFormattedTimerTime=s})(ol||(ol={}));var NA;(e=>e.list=["idle","move","jump","run"])(NA||(NA={}));var kA;(e=>(e.defaultColliderData={type:"capsule",height:200,radius:50,position:[0,0,0],rotation:[0,0,0]},e.defaultDataThirdPerson={moveMode:"walk",forwardDirection:"+z",speedTranslate:1e3,speedRotate:100,runMultiplier:2,rotationMode:"normal",rotBy:"keys",rotByTouch:"drag",delayPos:[.3,.3],delayRot:[.3,.3],keyAssignments:[["moveNegZ","W"],["moveNegX","A"],["movePosZ","S"],["movePosX","D"],["rotPosX",""],["rotPosY",""],["rotNegX",""],["rotNegY",""],["jump","Space"],["run",""],["none","Ctrl"]],touchControl:!0,joystickPosLoc:5,joystickRotLoc:11,jumpTouchButtonLoc:9,collider:e.defaultColliderData,colliderHelperVisible:!0,collisionEnabled:!0,jumpPower:100,resetYPosition:3e3,alignToGround:!1,autoOrientMove:!0,orientWith:"camera",orientMode:"radial",delayPosCamera:.3,delayRotCamera:.3,camera:"",cameraXAxis:"Limit",cameraYAxis:"Free",cameraRotXLimits:[0,Math.PI/2],cameraRotYLimits:[-Math.PI/2,Math.PI/2],gameActions:{idle:new kt,move:new kt,jump:new kt,run:new kt},navmesh:{enabled:!1,ch:6,cs:6,walkableClimb:5,walkableHeight:1,walkableRadius:0,zones:"all",objects:[],helperVisible:!0,destinationHelperRadius:0,destinationHelperColor:cr.fromHexAndA(3728051,1)}}))(kA||(kA={}));function k8(e){e.layers.forEach(t=>{if(t.type==="depth"&&t.colorA!==void 0){let i=t.colorA,r=t.colorB,n=[[i.r,i.g,i.b,i.a],[r.r,r.g,r.b,r.a]],s=[0,1];for(let o=2;o<10;o++)n.push(n[1]),s.push(1);let a={...$c(mn(t),"type","visible","isVector","isWorldSpace","origin","alpha","mode"),near:Math.max(0,t.near),far:Math.max(0,t.far),colors:n,steps:s,num:2,direction:[1,0,0],smooth:!1,gradientType:1};Object.assign(t,a)}else if(t.type==="depth"&&t.gradientType===1&&(t.near<0||t.far<0)){let i={...mn(t),near:Math.max(t.near,0),far:Math.max(t.far,0)};Object.assign(t,i)}})}function Dd(e,t){Object.values(e.shared.materials).forEach(i=>t(i))}function Rd(e,t){e.scene.objects.traverse((i,r)=>{"materials"in r?r.materials.forEach((n,s)=>{n===void 0&&(r.materials[s]=ps.defaultData(),n=r.materials[s]),typeof n!="string"&&t(n)}):"material"in r?typeof r.material!="string"&&(r.material===void 0&&(r.material=ps.defaultData()),t(r.material)):r.type==="Mesh"&&(r.material===void 0&&(r.material=ps.defaultData()),t(r.material)),"overrides"in r&&Object.values(r.overrides).forEach(n=>{n.material&&typeof n.material!="string"&&Object.getPrototypeOf(n.material)!==On.prototype&&t(n.material)})})}function cPe(e){Object.assign(e.scene.publish,{orbitControls:{...UA.defaultData,...mn(e.scene.publish.orbitControls)}})}function uPe(e){Object.assign(e.scene.publish.settings,{video:{...Gd.defaultData.settings.video,...mn(e.scene.publish.settings.video)}})}function hPe(e){function t(i){if(i.layers){for(let r of Object.values(i.layers))if(r){for(let[n,s]of Object.entries(r))if((Iee.includes(n)||typeof s=="boolean")&&delete r[n],n==="texture")for(let[a,o]of Object.entries(s))(lPe.includes(a)||typeof o=="boolean")&&delete s[a]}}}e.scene.objects.traverse((i,r)=>{r.states.forEach(n=>{let s=n;s.material?t(s.material):s.materials&&s.materials.forEach(a=>{t(a)})})})}function dPe(e){e.scene.publish.withBackground=!0}function fPe(e){e.scene.publish.settings.web={compress:!0,preload:!0,preset:1,logo:!0,hint:!1}}function pPe(e){e.scene.objects.traverse((t,i)=>{let r=i.cloner;r&&(r.radial.scale=r.radial.scale.map(n=>n+1),r.linear.scale=r.linear.scale.map(n=>n+1))})}function mPe(e){e.scene.objects.traverse((t,i)=>{let r=i.geometry;r&&(r.type==="DodecahedronGeometry"||r.type==="IcosahedronGeometry")&&(r.detail=Math.round(r.detail))})}function gPe(e){e.scene.objects.traverse((t,i)=>{let r=e.scene.objects.unproxy().parent(t);if(r){let n=mn(e.scene.objects.data(r));n&&n.type==="Mesh"&&n.geometry.type==="BooleanGeometry"&&i.type==="Mesh"&&(i.visible=mn(i).booleanExclude!==!0)}})}function vPe(e){e.scene.objects.traverse((t,i)=>{if(i.type==="Mesh"){let r=i;i.geometry.type==="NonParametricGeometry"?r.material!==void 0&&delete r.material:r.materials!==void 0&&delete r.materials}})}function yPe(e){function t(r){Object.setPrototypeOf(r,On.prototype),r.texture&&Object.setPrototypeOf(r.texture,On.prototype)}function i(r){Object.setPrototypeOf(r,On.prototype);for(let n in r)t(r[n])}e.scene.objects.traverse((r,n)=>{n.states.forEach(s=>{let a=s;if(a.material){let o=mn(a.material).layers;i(o),a.material.layers=o}if(a.materials)for(let o=0;o<a.materials.length;o++){let l=a.materials[o],c=mn(l).layers;i(c),l.layers=c}})})}function V8(e){e.layers===void 0&&Object.assign(e,ps.defaultTwoLayerData("lambert"))}function lR(e){!e.layers||e.layers.forEach(t=>{if(t.type==="depth"&&t.colors.length===10){let i=[...t.colors];i.push(t.colors[9]);let r=[...t.steps];r.push(t.steps[9]);let n={...mn(t),colors:i,steps:r};Object.assign(t,n)}})}function xPe(e){e.scene.objects.traverse((t,i)=>{i.type==="Mesh"&&(i.geometry.type==="BooleanGeometry"||i.geometry.type==="SubdivGeometry")&&(i.geometry.phongAngle=35)})}function G8(e){e.scene.objects.traverse((t,i)=>{"materials"in i?i.materials.forEach(r=>{typeof r!="string"&&lR(r)}):"material"in i&&typeof i.material!="string"&&lR(i.material)}),Object.values(e.shared.materials).forEach(t=>lR(t))}function wPe(e){e.scene.environment.ambientLight.softShadows=!1,e.scene.environment.ambientLight.softShadowQuality="low",e.scene.objects.traverse((t,i)=>{(i.type==="DirectionalLight"||i.type==="SpotLight")&&(i.shadowResolution=1024,i.shadowRadius=1,i.depth=1e5)}),e.shared.penumbraSize=new Array(5).fill(.5)}function bPe(e){e.shared.audios=_l({},qt.prototype)}function _Pe(e){e.shared.videos=_l({},qt.prototype)}function SPe(e){let t=e.shared.materials;Object.entries(t).forEach(([i,r])=>{if(!r.layers){let n={name:"Untitled Material",layers:[{fi:0,data:{type:"light",category:"phong",alpha:.6,visible:!0,mode:0,specular:{r:.2,g:.2,b:.2},shininess:5},id:"layer1"},{fi:1,data:{type:"color",alpha:1,visible:!0,mode:0,color:{r:.2823529411764706,g:.2823529411764706,b:.30196078431372547}},id:"layer2"}]};Object.assign(t,{[i]:n})}})}function MPe(e){Object.entries(mn(e.shared.images)).filter(t=>t[1].asset===!1).map(t=>t[0]).forEach(t=>{delete e.shared.images[t]}),Object.entries(mn(e.shared.audios)).filter(t=>t[1].asset===!1).map(t=>t[0]).forEach(t=>{delete e.shared.audios[t]})}function EPe(e){e.scene.publish.settings.web.preload=!1}function H8(e){e.layers&&e.layers.forEach(t=>{t.type==="depth"&&t.num!==void 0&&(t.colors=t.colors.slice(0,t.num),t.steps=t.steps.slice(0,t.num),delete t.num)})}function j8(e){e.layers&&e.layers.forEach(t=>{oPe(t)&&t.isMask===void 0&&(t.isMask=!1),(t.type==="texture"||t.type==="video")&&t.blending===void 0&&(t.blending=0),(t.type==="noise"||t.type==="displace"&&t.displacementType==="noise")&&(t.voronoiStyle===void 0&&(t.voronoiStyle=0),t.highCut===void 0&&(t.highCut=1),t.lowCut===void 0&&(t.lowCut=0),t.smoothness===void 0&&(t.smoothness=.3),t.seed===void 0&&(t.seed=0),t.quality===void 0&&(t.quality=1))})}function APe(e){e.shared.fonts=_l({},qt.prototype)}function TPe(e){return e.replace(".typeface","").replace(/optimer/gi,"open sans").replace("space_mono","space mono").replace(/alma_mono/gi,"varela round").replace(/droid_sans_mono/gi,"noto sans mono").replace(/droid_sans|gentilis|gnomon_(simple|foreground)|helvetiker/gi,"roboto").replace(/droid_serif/gi,"roboto slab").replace("_sans"," sans").replace("crimson_text","crimson text").replace("medium_medium","medium").replace("fatface_fatface","fatface").replace("100hairline","thin").replace("200thin","extralight").replace("300light","light").replace("500medium","medium").replace("600semi","semibold").replace("800heavy","extrabold").replace("900black","black").replace(/bodoni_(11|16|24|36|48|72|96)([^_])/gi,"bodoni_$1_$2").replace(/bodoni_(11|16|24|36|48|72|96)/gi,"bodoni moda").replace(/(thin|hairline)(_regular)?/gi,"100").replace(/(extra|ultra)light(_regular)?/gi,"200").replace(/light(_regular)?/gi,"300").replace(/_book|_normal|_roman/gi,"_regular").replace(/medium(_regular)?/gi,"500").replace(/(semi|demi)bold(_regular)?/gi,"600").replace(/(extra|ultra)bold(_regular)?/gi,"800").replace(/bold(_regular)?/gi,"700").replace(/(black|heavy|fatface)(_regular)?/gi,"900").replace(/([1-9]00)_italic/gi,"$1italic").replace(/regularitalic/gi,"italic").replace(/regularitalic/gi,"italic").split(" ").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" ")}function CPe(e){let t=[];e.scene.objects.traverse((i,r)=>{let n=r;if(n.type==="TextFrame"){let s=ps.defaultTwoLayerData("phong"),a=typeof n.color=="string"?e.shared.colors[n.color]:n.color;s.layers[1].data.color={r:a.r,g:a.g,b:a.b},s.layers[1].data.alpha=n.alpha;let o=TPe(n.font);e.shared.fonts[o]===void 0&&(e.shared.fonts[o]={name:o});let l={name:n.name,...qn.defaultData,...Pd.defaultData,flatShading:!1,wireframe:!1,geometry:{...Cd.defaultData("TextGeometry"),width:n.width,height:n.height,font:o,depth:0,horizontalAlign:n.horizontalAlign,verticalAlign:n.verticalAlign,fontSize:n.fontSize*1.40625,lineHeight:n.lineHeight/1.40625,letterSpacing:n.letterSpacing-1,text:n.text,textTransform:n.textTransform,extrudeBevelSize:0,extrudeBevelSegments:1},material:s,states:mn(n.states),events:mn(n.events),visible:n.visible,raycastLock:n.raycastLock,position:n.position,rotation:n.rotation,scale:n.scale,hiddenMatrix:n.hiddenMatrix},c=mn(e.scene.objects).parent(i);e.scene.objects.insertAfter(c??null,i,[{id:i+"new",data:l,children:[]}]),t.push(i)}}),t.forEach(i=>{e.scene.objects.delete(i)})}function PPe(e){let t={0:"MouseDown",1:"MouseUp",2:"MouseHover",5:"KeyDown",6:"KeyUp",7:"Start",9:"LookAt",10:"Follow",11:"Scroll",12:"Audio",13:"GameControl"};e.scene.objects.traverse((i,r)=>{r.events.forEach(n=>{if(t[Number(n.type)])if(Object.assign(n,{type:t[Number(n.type)]}),n.type==="Audio"&&"audioEvent"in n&&(Object.assign(n,{playAudio:n.audioEvent}),delete n.audioEvent),n.type==="GameControl")Object.assign(n,{gameActions:{idle:new kt,move:new kt,jump:new kt}});else{let s=new kt;Object.assign(n,{actions:s}),(n.type==="MouseDown"||n.type==="MouseUp"||n.type==="KeyDown"||n.type==="KeyUp")&&"url"in n&&s.push({fi:0,id:Tt.generateUUID(),data:{type:"Link",url:n.url,delay:0}}),"targets"in n&&(n.targets.forEach((a,o,l)=>{let c={state:void 0,repeat:0,delay:0,delayDirection:void 0,direction:"normal",duration:0,easing:4},u={easing:a.easing,duration:a.duration};a.easing===6?Object.assign(u,$c(a,"mass","stiffness","damping","velocity")):a.easing===5&&Object.assign(u,{control1:{...a.control1},control2:{...a.control2}});let h={repeat:a.repeat?-1:0,delay:a.delay,delayDirection:a.delayDirection,direction:a.cycle&&a.rewind?"pingpong-rewind":a.cycle?"pingpong":"normal"},d={state:a.state,...h,...u},f={allowSlerp:!0,type:"Transition",object:a.object,repeat:0,delay:0,delayDirection:void 0,direction:"normal",tweens:new kt({fi:0,id:Tt.generateUUID(),data:c},{fi:1,id:Tt.generateUUID(),data:d})};s.push({fi:l,id:o,data:f})}),delete n.targets)}})})}function DPe(e){e.scene.objects.traverse((t,i)=>{function r(n,s){var l;let a=new kt,o=[];if(i.events.forEach((c,u,h)=>{if(c.type==="Audio"&&c.trigger===s){let d;o.push(u),c.interaction==="play"?d={...$c(c,"interaction","audio","delay","volume","loop"),triggerAfter:"after"in c?c.after:void 0,toggle:"after"in c?c.toggle:void 0,type:"Audio"}:(c.interaction==="pause"||c.interaction==="stop")&&(d={...$c(c,"interaction","delay","object","playAudio"),type:"Audio"}),d&&a.push({fi:h,id:u,data:d})}}),o.forEach(c=>i.events.delete(c)),a.length){let c=(l=i.events.find(u=>u.type===n))==null?void 0:l.data;c?"actions"in c&&c.actions.insertBefore(null,a):i.events.insertBefore(null,[{id:Tt.generateUUID(),data:{type:n,actions:a}}])}}r("Start","start"),r("MouseDown","mouseDown"),r("MouseUp","mouseUp"),r("KeyDown","keyDown"),r("KeyUp","keyUp")})}function W8(e){var i;let t=(i=e.layers.find(r=>r.type==="light"))==null?void 0:i.data;if((t==null?void 0:t.category)==="basic"){let r=cs.defaultData("light","phong"),n=t;Object.assign(n,r),n.visible=!1}}function X8(e){Dd(e,W8),Rd(e,W8)}function RPe(e){e.scene.objects.traverse((t,i)=>{i.type==="Mesh"&&i.geometry.type==="SubdivGeometry"&&(i.geometry.scaleBaked||(i.geometry.scaleBaked=[1,1,1]))})}function IPe(e){e.scene.objects.traverse((t,i)=>{(i.type==="Empty"||i.type==="Mesh")&&i.cloner&&!i.cloner.randomnessObject&&!i.cloner.toObject&&!i.cloner.randomness&&(i.cloner={...i.cloner,toObject:{object:"",spreadType:"random",scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],axis:"x",seed:0,count:99,align:"normal"},randomness:!1,randomnessObject:{strength:100,scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],movement:1,seed:0,freqScale:10,noiseType:"perlin"}})})}function LPe(e){e.scene.objects.traverse((t,i)=>{i.type==="Mesh"&&i.geometry.type==="NonParametricGeometry"&&!("material"in i)&&!("materials"in i)&&(i.material=ps.defaultTwoLayerData("phong"))})}function OPe(e){e.scene.publish.orbitControls.autoZoom===void 0&&(e.scene.publish.orbitControls.autoZoom=!1),e.scene.objects.traverse((t,i)=>{(i.type==="OrthographicCamera"||i.type==="PerspectiveCamera")&&(i.orthographic.autoZoom===void 0&&(i.orthographic.autoZoom=!1),i.orthographic.autoZoomFrustumSize===void 0&&(i.orthographic.autoZoomFrustumSize=790))})}function zPe(e){e.scene.objects.traverse((t,i)=>{i.pathSnapping===void 0&&(i.pathSnapping={pathId:null,slide:0,offset:0,orientation:"tangential"}),i.pathSnapping.offset===void 0&&(i.pathSnapping.offset=0)})}function BPe(e){e.scene.publish.mouseEventTarget===void 0&&(e.scene.publish.mouseEventTarget="canvas"),e.scene.publish.settings.web.hint===void 0&&(e.scene.publish.settings.web.hint=!1)}function FPe(e){let{video:t}=e.scene.publish.settings;t.format==="gif"&&t.fps>48&&(t.fps=15)}function UPe(e){e.scene.objects.traverse((t,i)=>{i.events.forEach(r=>{r.type==="GameControl"&&(r.resetYPosition=Math.abs(r.resetYPosition-i.position[1]))})})}function NPe(e){let t=e.scene.environment.usePhysics;e.scene.objects.traverse((i,r)=>{t&&r.physics===null?r.collision=!1:r.collision="visibility"})}function kPe(e){e.scene.objects.traverse((t,i)=>{i.events.forEach(r=>{r.type==="GameControl"&&(r.navmesh=kA.defaultDataThirdPerson.navmesh)})})}function VPe(e){e.scene.styles||(e.scene.styles=Xp.defaultData())}function q8(e){e.layers.forEach(t=>{t.type==="light"&&t.category!=="toon"&&t.occlusion===void 0&&(t.occlusion=!0)})}function GPe(e){e.scene.environment.ambientLight.occlusion===void 0&&(e.scene.environment.ambientLight.occlusion=!1),e.scene.environment.ambientLight.aoFullRes===void 0&&(e.scene.environment.ambientLight.aoFullRes=!1),e.scene.environment.ambientLight.radius===void 0&&(e.scene.environment.ambientLight.radius=256),e.scene.environment.ambientLight.bias===void 0&&(e.scene.environment.ambientLight.bias=.5),e.scene.environment.ambientLight.aoColor===void 0&&(e.scene.environment.ambientLight.aoColor={r:.19607843137254902,g:.19607843137254902,b:.19607843137254902}),Rd(e,q8),Dd(e,q8)}function HPe(e){e.scene.objects.traverse((t,i)=>{i.events.forEach(r=>{r.type==="GameControl"&&Object.assign(r.gameActions,{run:new kt})})})}function jPe(e){e.scene.objects.traverse((t,i)=>{i.events.forEach(r=>{r.type==="GameControl"&&(r.keyAssignments=[...r.keyAssignments,["run",""],["none","Ctrl"]])})})}function Y8(e){e.layers&&e.layers.forEach(t=>{t.type==="light"&&t.bumpMapIntensity===void 0&&(t.bumpMapIntensity=5)})}function WPe(e,t){if(t<1&&(Rd(e,k8),Dd(e,k8),e.schema=1),t<2&&(cPe(e),e.schema=2),t<3&&(hPe(e),e.schema=3),t<4&&(dPe(e),e.schema=4),t<5&&(fPe(e),e.schema=5),t<6&&(pPe(e),e.schema=6),t<7&&(mPe(e),e.schema=7),t<8&&(e.schema=8),t<9&&(G8(e),e.schema=9),t<10&&(xPe(e),e.schema=10),t<11&&(wPe(e),e.schema=11),t<12&&(G8(e),e.schema=12),t<13&&(bPe(e),e.schema=13),t<14&&(SPe(e),e.schema=14),t<15&&(MPe(e),e.schema=15),t<16&&(EPe(e),e.schema=16),t<17&&(Rd(e,H8),Dd(e,H8),e.schema=17),t<18&&(Rd(e,V8),Dd(e,V8),e.schema=18),t<19&&(uPe(e),e.schema=19),t<20&&(APe(e),CPe(e),e.schema=20),t<21&&(PPe(e),DPe(e),e.schema=21),t<22&&(X8(e),e.schema=22),t<23&&(RPe(e),e.schema=23),t<24&&(IPe(e),e.schema=24),(t<25||e.shared.videos===void 0)&&(_Pe(e),t<25&&(e.schema=25)),t<26&&(gPe(e),e.schema=26),t<27&&(vPe(e),e.schema=27),t<28&&(X8(e),e.schema=28),t<29&&(yPe(e),e.schema=29),t<30&&(LPe(e),e.schema=30),t<31&&(OPe(e),e.schema=31),t<33&&(zPe(e),e.schema=33),t<34&&(BPe(e),e.schema=34),t<35&&(FPe(e),e.schema=35),t<36&&(UPe(e),e.schema=36),t<37&&(NPe(e),e.schema=37),t<38&&(Rd(e,j8),Dd(e,j8),e.schema=38),t<39&&(kPe(e),e.schema=39),t<40&&(VPe(e),e.schema=40),t<41&&(GPe(e),e.schema=41),t<42&&(HPe(e),e.schema=42),t<43&&(jPe(e),e.schema=43),t<99){Rd(e,Y8),Dd(e,Y8),e.scene.publish.playCamera===null&&(e.scene.publish.playCamera=gy);let i=mn(e.scene.objects),r=e.scene.objects;e.scene.publish.playPage=Ox,r.insertBefore(null,null,[{id:Ox,data:{...H0.defaultData,backgroundColor:e.scene.backgroundColor,fog:e.scene.fog,postprocessing:e.scene.postprocessing,ao:$c(e.scene.environment.ambientLight,"occlusion","aoFullRes","radius","bias","aoColor"),publish:{playCamera:e.scene.publish.playCamera,gameControlObject:e.scene.publish.gameControlObject},shadow:$c(e.scene.environment.ambientLight,"softShadowQuality"),globalPhysics:{...V0.defaultData,...$c(e.scene.environment,"usePhysics","gravity")},camera:mn(e.scene.ownerCamera)??H0.defaultData.camera,name:"Scene"},children:[]}]);for(let a of i)a.id!==qp.TRASH_CAN_ID&&r.move(Ox,a.fi,a.id);let n=0,s=0;e.shared.penumbraSize&&e.scene.objects.traverse((a,o)=>{o.type==="DirectionalLight"?(o.penumbraSize=e.shared.penumbraSize[Math.min(n,2)],n+=1):o.type==="SpotLight"&&(o.penumbraSize=e.shared.penumbraSize[3+Math.min(s,1)],s+=1),(o.physics===void 0||o.physics===null)&&o.type!=="Instance"&&(o.physics={},Object.assign(o.physics,k0.defaultData)),o.physics!==void 0&&o.physics!==null&&(o.physics.enabled=o.collision??"visibility",delete o.collision)}),e.schema=99}}function Q8(e){e.layers&&e.layers.forEach(t=>{t.type==="light"&&t.alphaOverride===void 0&&(t.alphaOverride=1)})}function XPe(e){e.scene.objects.traverse((t,i)=>{let r=i.geometry;r&&r.type==="PathGeometry"&&(r.extrusion.capType="flat",r.extrusion.bevel=50,r.extrusion.bevelSides=6,r.extrusion.shape.type==="Custom"&&(r.extrusion.shape.shapeQuality="low"))})}function qPe(e){var t;Array.isArray(mn(e.events))&&((t=e.events)==null||t.forEach(i=>{"disabled"in i||(i.disabled=!1),(i.type==="MouseDown"||i.type==="MouseUp"||i.type==="MousePress")&&(i.mode=i.mode||"Object")}))}var vv=180/Math.PI;function Z8(e){e.rotation=e.rotation.slice(0,3).map(t=>t*vv)}function Bee(e){var i,r;Z8(e),e.type==="Page"&&Z8(e.camera),(i=e.states)==null||i.forEach(n=>{n.rotation===void 0||n.rotation===null||(n.rotation=n.rotation.slice(0,3).map(s=>s*vv))});let t=e.geometry;t&&t.type==="SphereGeometry"&&(t.thetaLength=(t.thetaLength??180)*vv),t&&t.type==="TorusGeometry"&&(t.arc=t.arc*vv),t&&t.type==="PathGeometry"&&(t.extrusion.angle*=vv,t.extrusion.twist*=vv),e.type==="Mesh"&&e.geometry.type==="TextGeometry"&&(e.geometry.text={textValue:e.geometry.text}),Array.isArray(mn(e.events))&&((r=e.events)==null||r.forEach(n=>{(n.type==="MouseDown"||n.type==="MouseUp"||n.type==="MousePress"||n.type==="KeyDown"||n.type==="KeyUp"||n.type==="KeyPress"||n.type==="Collision"||n.type==="Trigger")&&(n.runMode=n.toggle?"Toggle":"Repeat")}))}function YPe(e){e.shared.variables=_l({},qt.prototype)}function QPe(e){let t=mn(e.shared.variables);e.shared.variables=_l(Object.entries(t??{}).map(([i,r],n)=>({fi:n,id:i,data:r})),kt.prototype)}var Zu=115;function Fee(e,t){t(e.data);for(let i of e.children)Fee(i,t)}function ZPe(e){let t=e.schema??104;t!==Zu&&t<105&&(Fee(e.asset,Bee),e.schema=105)}function KPe(e){e.shared.particles=_l({},qt.prototype),e.shared.lib&&(e.shared.lib.particles=Dh.defaultData().particles)}function JPe(e){e.scene.objects.traverse((t,i)=>{i.type==="Particle"&&typeof i.renderMaterial.size=="number"&&Object.assign(i.renderMaterial,{size:[i.renderMaterial.size,i.renderMaterial.size]})})}function $Pe(e){e.scene.objects.traverse((t,i)=>{i.type==="Page"&&(i.postprocessing.depthOfField.focusDistance=100,i.postprocessing.depthOfField.focalLength=20,i.postprocessing.depthOfField.bokehScale=5)})}function e3e(e){e.scene.objects.traverse((t,i)=>{var r;Array.isArray(mn(i.events))!==!1&&((r=i.events)==null||r.forEach(n=>{var a,o,l,c,u,h,d,f,p,v,m;let s=n.runMode;n.type==="MouseDown"||n.type==="MouseUp"||n.type==="KeyDown"||n.type==="KeyUp"||n.type==="Collision"||n.type==="Trigger"?(a=n.actions)==null||a.forEach(g=>{g.type==="Transition"&&(g.runMode=s??"Repeat"),(g.type==="Animation"||g.type==="SwitchCamera")&&(g.runMode=s==="Toggle"?"Toggle":"Normal")}):n.type==="MouseHover"||n.type==="MousePress"||n.type==="KeyPress"?(o=n.actions)==null||o.forEach(g=>{(g.type==="Transition"||g.type==="Animation"||g.type==="SwitchCamera")&&(g.runMode="Toggle")}):n.type==="GameControl"?(delete n.actions,Object.keys(n.gameActions).forEach(g=>{var y;(y=n.gameActions[g])==null||y.forEach(x=>{x.type==="Transition"&&(x.runMode="Repeat"),x.type==="Animation"&&(x.runMode="Normal")})})):n.type==="DragDrop"?(delete n.actions,(c=(l=n.dragDropActions)==null?void 0:l.drag)==null||c.forEach(g=>{(g.type==="Transition"||g.type==="Animation"||g.type==="SwitchCamera")&&(g.runMode="Toggle")}),(h=(u=n.dragDropActions)==null?void 0:u.drop)==null||h.forEach(g=>{(g.type==="Transition"||g.type==="Animation"||g.type==="SwitchCamera")&&(g.runMode="Toggle")})):n.type==="Resize"?(delete n.actions,(d=n.breakpoints)==null||d.forEach(g=>{var y;(y=g.actions)==null||y.forEach(x=>{(x.type==="Transition"||x.type==="Animation"||x.type==="SwitchCamera")&&(x.runMode="Toggle")})})):n.type==="Start"?(f=n.actions)==null||f.forEach(g=>{g.type==="Transition"&&(g.runMode="Once"),(g.type==="Animation"||g.type==="SwitchCamera")&&(g.runMode="Normal")}):n.type==="VariableChange"||n.type==="Scroll"?(p=n.actions)==null||p.forEach(g=>{g.type==="Transition"&&(g.runMode="Repeat"),(g.type==="Animation"||g.type==="SwitchCamera")&&(g.runMode="Normal")}):n.type==="Conditional"&&(delete n.actions,(v=n.inActions)==null||v.forEach(g=>{g.type==="Transition"&&(g.runMode="Repeat"),(g.type==="Animation"||g.type==="SwitchCamera")&&(g.runMode="Normal")}),(m=n.outActions)==null||m.forEach(g=>{g.type==="Transition"&&(g.runMode="Repeat"),(g.type==="Animation"||g.type==="SwitchCamera")&&(g.runMode="Normal")}))}))})}function t3e(e){e.shared.userAPIs=_l({},qt.prototype),e.shared.userWebhooks=_l({},qt.prototype),e.shared.lib&&(e.shared.lib.userAPIs=Dh.defaultData().userAPIs,e.shared.lib.userWebhooks=Dh.defaultData().userWebhooks)}function Uee(e){let t=e.schema??0;if(t!==Zu){console.warn("updating from ",t,"to ",Zu),WPe(e,t),t<100&&(e.scene.publish.joystickSizeAndXYOffset===void 0&&(e.scene.publish.joystickSizeAndXYOffset=Gd.defaultData.joystickSizeAndXYOffset),e.schema=100),t<101&&(Rd(e,Q8),Dd(e,Q8),e.schema=101),t<102&&(XPe(e),e.schema=102),t<104&&(e.shared.catelogs=new qt,e.shared.lib=Dh.defaultData(),e.schema=104),t<105&&(YPe(e),e.scene.objects.traverse((i,r)=>{Bee(r)}),e.schema=105);for(let i of Object.values(e.shared.lib.components))ZPe(i);t<106&&(QPe(e),e.schema=106),t<107&&(e.shared.lib.variables=Dh.defaultData().variables,e.schema=107),t<109&&(KPe(e),e.schema=109),t<110&&(JPe(e),e.schema=110),t<111&&(e.scene.objects.traverse((i,r)=>{qPe(r)}),e.schema=111),t<112&&($Pe(e),e.schema=112),t<113&&(e3e(e),e.schema=113),t<114&&(e.scene.publish.settings.web.imageQuality===void 0&&(e.scene.publish.settings.web.imageQuality=70),e.schema=114),t<115&&(t3e(e),e.schema=115)}}var VA;(e=>{e.defaultData={schema:Zu,scene:qp.defaultData,frames:new qt().add("72fc2993-2da3-4b6b-96ac-2879db3a28bd",zx.defaultData),shared:{...ol.emptyData(),colors:ol.defaultColors()}},e.emptyDataForImports=function(){let s=qp.emptyDataWithPage();return{schema:Zu,scene:s,frames:new qt().add("72fc2993-2da3-4b6b-96ac-2879db3a28bd",zx.defaultData),shared:{...ol.emptyData(),colors:ol.defaultColors(),images:ol.defaultImages()}}},e.emptyData=function(){return{schema:Zu,scene:qp.emptyDataWithPage(),frames:new qt().add("72fc2993-2da3-4b6b-96ac-2879db3a28bd",zx.defaultData),shared:ol.emptyData()}},e.clipboard2dData=function(){return{schema:Zu,scene:qp.emptyData(),frames:new qt,shared:ol.emptyData()}},e.collabHelper={...cz,updateSchema(s){return(s.schema??0)<Zu?kw(s,Uee):(s.schema??0)-Zu}};function t(s){let a=e.collabHelper.updateSchema(s);return typeof a=="number"?a===0?s:null:a.data}e.updateSchemaDirectly=t;function i(s){return{...s,shared:{...s.shared,lib:Dh.defaultData()}}}e.withoutLib=i;function r(s,a){let o=s.scene.objects.get(a);if(o&&o.data.type==="Component")return o;{let l=s.shared.lib.components[a];if(l)return l.asset}}e.getComponentData=r;function n(s){let a=Object.values(s.shared.userAPIs);for(let o of a){let l=o.headers;for(let c of l)if(c.data.key.toLowerCase()==="authorization"&&c.data.value!=="")return!0}return!1}e.hasSensitiveData=n})(VA||(VA={}));var Hz;(e=>e.emptyImage={data:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVQYV2NgYAAAAAMAAWgmWQ0AAAAASUVORK5CYII=",name:"empty"})(Hz||(Hz={}));var K8;(e=>{function t(i){return!0}e.is=t})(K8||(K8={}));var GA;(e=>{e.defaultData={position:[0,0],scale:[1,1],rotation:0,shear:[0,0]};function t(r,n){return{position:(n==null?void 0:n.position)??r.position,rotation:(n==null?void 0:n.rotation)??r.rotation,scale:(n==null?void 0:n.scale)??r.scale,shear:(n==null?void 0:n.shear)??r.shear}}e.merge=t;function i(r,n){return K$({position:dh.isEqual(r.position,n.position)?void 0:n.position,rotation:r.rotation===n.rotation?void 0:n.rotation,scale:dh.isEqual(r.scale,n.scale)?void 0:n.scale,shear:r.shear&&n.shear&&dh.isEqual(r.shear,n.shear)?void 0:n.shear})}e.diff=i})(GA||(GA={}));var jz;(e=>e.defaultData={horizontalConstraint:0,verticalConstraint:0})(jz||(jz={}));var J8;(e=>e.defaultData={direction:"row",wrap:"unwrap",align:"top-left",gap:10,rowGap:10,autoGap:!1,autoRowGap:!1,leftPadding:8,rightPadding:8,topPadding:8,bottomPadding:8})(J8||(J8={}));var HA;(e=>e.defaultData={opacity:1,fill:{color:cr.fromHexAndA(Bo,1),enabled:!0},stroke:{color:cr.from0to1([0,0,0,1]),thickness:1,enabled:!1,mode:"inside"},layerBlur:{radius:2,enabled:!1},backgroundBlur:{radius:2,enabled:!1},dropShadow:{offset:[10,10],blurRadius:10,color:cr.from0to1([0,0,0,1]),enabled:!1,spread:0},innerShadow:{offset:[10,10],blurRadius:10,color:cr.from0to1([0,0,0,1]),enabled:!1,spread:0}})(HA||(HA={}));var Yp;(e=>{function t(a,o){return{name:o}}e.newEmpty=t;function i(a,o){if(o===void 0)return a;let l={...a},c=["width","height","cornerRadius"];for(let u of c)u in l&&u in o&&o[u]!==void 0&&Object.assign(l,{[u]:o[u]});return l}function r(a,o){if(o===void 0)return a;let l={...a};return"fill"in l&&"fill"in o&&o.fill!==void 0&&Object.assign(l,{fill:{...l.fill,...o.fill}}),"stroke"in l&&"stroke"in o&&o.stroke!==void 0&&Object.assign(l,{stroke:{...l.stroke,...o.stroke}}),"layerBlur"in l&&"layerBlur"in o&&o.layerBlur!==void 0&&Object.assign(l,{layerBlur:{...l.layerBlur,...o.layerBlur}}),"backgroundBlur"in l&&"backgroundBlur"in o&&o.backgroundBlur!==void 0&&Object.assign(l,{backgroundBlur:{...l.backgroundBlur,...o.backgroundBlur}}),"dropShadow"in l&&"dropShadow"in o&&o.dropShadow!==void 0&&Object.assign(l,{dropShadow:{...l.dropShadow,...o.dropShadow}}),"innerShadow"in l&&"innerShadow"in o&&o.innerShadow!==void 0&&Object.assign(l,{innerShadow:{...l.innerShadow,...o.innerShadow}}),l}function n(a,o){if(o===void 0)return a;let l={...a};return Object.assign(l,GA.merge(l,o)),l=i(l,o),l=r(l,o),l}e.patch=n;function s(a,o){let l,c=[];for(let[u,h]of Object.entries(o))u!=="name"&&(l===void 0&&(l={path:[],props:{},type:0},c.push(l)),l.props[u]=h);return c}e.toOps=s})(Yp||(Yp={}));var Hw;(e=>e.defaultData={...GA.defaultData,...jz.defaultData,states:new kt,events:new kt,visible:!0,raycastLock:!1})(Hw||(Hw={}));var j0;(e=>e.defaultData={...Hw.defaultData,...HA.defaultData})(j0||(j0={}));var jA;(e=>e.defaultData={cornerRadius:[0,0,0,0]})(jA||(jA={}));var Wz;(e=>e.defaultData={...j0.defaultData,type:"ellipse2d",width:100,height:100,name:"Ellipse"})(Wz||(Wz={}));var jw;(e=>e.defaultData={...j0.defaultData,...jA.defaultData,type:"rectangle2d",width:100,height:100,name:"Rectangle"})(jw||(jw={}));var Xz;(e=>e.defaultData={...j0.defaultData,type:"text2d",width:100,height:100,fontSize:12,lineHeight:1.2,letterSpacing:0,text:{textValue:"Hello world"},horizontalAlign:1,verticalAlign:1,textTransform:1,font:"Roboto_regular",name:"Text"})(Xz||(Xz={}));var qz;(e=>e.defaultData={...j0.defaultData,type:"path2d",path:"",name:"Path"})(qz||(qz={}));var $8;(e=>{function t(i){return i.type==="ellipse2d"||i.type==="rectangle2d"||i.type==="text2d"||i.type==="vector2d"||i.type==="path2d"}e.is=t})($8||($8={}));var WA;(e=>e.defaultData={...Hw.defaultData,name:"Group",type:"group2d"})(WA||(WA={}));var Yz;(e=>e.defaultData=()=>({...Hw.defaultData,...jA.defaultData,...HA.defaultData,name:"Frame",type:"frame2d",clipped:!0,width:200,height:200,fill:{color:cr.fromHexAndA(4737101,1),enabled:!0},stroke:{color:cr.fromHexAndA(0,1),thickness:1,enabled:!1,mode:"inside"},backgroundBlur:{radius:2,enabled:!1},layerBlur:{radius:2,enabled:!1}}))(Yz||(Yz={}));var cm;(e=>{function t(a){switch(a){case"rectangle2d":return{...jw.defaultData};case"ellipse2d":return{...Wz.defaultData};case"text2d":return{...Xz.defaultData};case"vector2d":return{...jw.defaultData};case"path2d":return{...qz.defaultData};case"frame2d":return{...Yz.defaultData()};case"group2d":return{...WA.defaultData}}}e.defaultData=t;function i(a){return"width"in a&&"height"in a?[typeof a.width=="number"?a.width*.5:0,typeof a.height=="number"?a.height*.5:0]:[0,0]}e.getPivot=i;function r(a){return a.type==="rectangle2d"||a.type==="ellipse2d"||a.type==="text2d"||a.type==="frame2d"}e.isResizeable=r;function n(a){return a.type==="frame2d"&&a.autoLayout!==void 0}e.isAutoLayoutable=n;function s(a){return a.type==="rectangle2d"||a.type==="frame2d"}e.hasCorners=s})(cm||(cm={}));var Qz;(e=>(e.defaultData={name:"UI",type:"scene2d",objects:new Is},e.emptyData=function(){return{type:"scene2d",objects:new Is}}))(Qz||(Qz={}));function Qp(e,t=!1){let i=e[0].index!==null,r=new Set(Object.keys(e[0].attributes)),n=new Set(Object.keys(e[0].morphAttributes)),s={},a={},o=e[0].morphTargetsRelative,l=new Nt,c=0;for(let u=0;u<e.length;++u){let h=e[u],d=0;if(i!==(h.index!==null))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(let f in h.attributes){if(!r.has(f))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+'. All geometries must have compatible attributes; make sure "'+f+'" attribute exists among all geometries, or in none of them.'),null;s[f]===void 0&&(s[f]=[]),s[f].push(h.attributes[f]),d++}if(d!==r.size)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+". Make sure all geometries have the same number of attributes."),null;if(o!==h.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(let f in h.morphAttributes){if(!n.has(f))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+".  .morphAttributes must be consistent throughout all geometries."),null;a[f]===void 0&&(a[f]=[]),a[f].push(h.morphAttributes[f])}if(t){let f;if(i)f=h.index.count;else if(h.attributes.position!==void 0)f=h.attributes.position.count;else return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+". The geometry must have either an index or a position attribute"),null;l.addGroup(c,f,u),c+=f}}if(i){let u=0,h=[];for(let d=0;d<e.length;++d){let f=e[d].index;for(let p=0;p<f.count;++p)h.push(f.getX(p)+u);u+=e[d].attributes.position.count}l.setIndex(h)}for(let u in s){let h=eW(s[u]);if(!h)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+u+" attribute."),null;l.setAttribute(u,h)}for(let u in a){let h=a[u][0].length;if(h===0)break;l.morphAttributes=l.morphAttributes||{},l.morphAttributes[u]=[];for(let d=0;d<h;++d){let f=[];for(let v=0;v<a[u].length;++v)f.push(a[u][v][d]);let p=eW(f);if(!p)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+u+" morphAttribute."),null;l.morphAttributes[u].push(p)}}return l}function eW(e){let t,i,r,n=0;for(let o=0;o<e.length;++o){let l=e[o];if(l.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(t===void 0&&(t=l.array.constructor),t!==l.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(i===void 0&&(i=l.itemSize),i!==l.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(r===void 0&&(r=l.normalized),r!==l.normalized)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;n+=l.array.length}let s=new t(n),a=0;for(let o=0;o<e.length;++o)s.set(e[o].array,a),a+=e[o].array.length;return new Qt(s,i,r)}var i3e=Math.pow(2,-24),QS=class{constructor(){}};function Hc(e,t,i){return i.min.x=t[e],i.min.y=t[e+1],i.min.z=t[e+2],i.max.x=t[e+3],i.max.y=t[e+4],i.max.z=t[e+5],i}function tW(e){let t=-1,i=-1/0;for(let r=0;r<3;r++){let n=e[r+3]-e[r];n>i&&(i=n,t=r)}return t}function iW(e,t){t.set(e)}function rW(e,t,i){let r,n;for(let s=0;s<3;s++){let a=s+3;r=e[s],n=t[s],i[s]=r<n?r:n,r=e[a],n=t[a],i[a]=r>n?r:n}}function ZS(e,t,i){for(let r=0;r<3;r++){let n=t[e+2*r],s=t[e+2*r+1],a=n-s,o=n+s;a<i[r]&&(i[r]=a),o>i[r+3]&&(i[r+3]=o)}}function v1(e){let t=e[3]-e[0],i=e[4]-e[1],r=e[5]-e[2];return 2*(t*i+i*r+r*t)}function r3e(e,t){if(!e.index){let i=e.attributes.position.count,r=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,n;i>65535?n=new Uint32Array(new r(4*i)):n=new Uint16Array(new r(2*i)),e.setIndex(new Qt(n,1));for(let s=0;s<i;s++)n[s]=s}}function n3e(e){if(!e.groups||!e.groups.length)return[{offset:0,count:e.index.count/3}];let t=[],i=new Set;for(let n of e.groups)i.add(n.start),i.add(n.start+n.count);let r=Array.from(i.values()).sort((n,s)=>n-s);for(let n=0;n<r.length-1;n++){let s=r[n],a=r[n+1];t.push({offset:s/3,count:(a-s)/3})}return t}function cR(e,t,i,r,n=null){let s=1/0,a=1/0,o=1/0,l=-1/0,c=-1/0,u=-1/0,h=1/0,d=1/0,f=1/0,p=-1/0,v=-1/0,m=-1/0,g=n!==null;for(let y=t*6,x=(t+i)*6;y<x;y+=6){let _=e[y+0],M=e[y+1],S=_-M,T=_+M;S<s&&(s=S),T>l&&(l=T),g&&_<h&&(h=_),g&&_>p&&(p=_);let E=e[y+2],C=e[y+3],A=E-C,D=E+C;A<a&&(a=A),D>c&&(c=D),g&&E<d&&(d=E),g&&E>v&&(v=E);let R=e[y+4],L=e[y+5],O=R-L,H=R+L;O<o&&(o=O),H>u&&(u=H),g&&R<f&&(f=R),g&&R>m&&(m=R)}r[0]=s,r[1]=a,r[2]=o,r[3]=l,r[4]=c,r[5]=u,g&&(n[0]=h,n[1]=d,n[2]=f,n[3]=p,n[4]=v,n[5]=m)}function s3e(e,t,i,r){let n=1/0,s=1/0,a=1/0,o=-1/0,l=-1/0,c=-1/0;for(let u=t*6,h=(t+i)*6;u<h;u+=6){let d=e[u+0];d<n&&(n=d),d>o&&(o=d);let f=e[u+2];f<s&&(s=f),f>l&&(l=f);let p=e[u+4];p<a&&(a=p),p>c&&(c=p)}r[0]=n,r[1]=s,r[2]=a,r[3]=o,r[4]=l,r[5]=c}function a3e(e,t,i,r,n){let s=i,a=i+r-1,o=n.pos,l=n.axis*2;for(;;){for(;s<=a&&t[s*6+l]<o;)s++;for(;s<=a&&t[a*6+l]>=o;)a--;if(s<a){for(let c=0;c<3;c++){let u=e[s*3+c];e[s*3+c]=e[a*3+c],e[a*3+c]=u;let h=t[s*6+c*2+0];t[s*6+c*2+0]=t[a*6+c*2+0],t[a*6+c*2+0]=h;let d=t[s*6+c*2+1];t[s*6+c*2+1]=t[a*6+c*2+1],t[a*6+c*2+1]=d}s++,a--}else return s}}var Vu=32,o3e=(e,t)=>e.candidate-t.candidate,nd=new Array(Vu).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),KS=new Float32Array(6);function l3e(e,t,i,r,n,s){let a=-1,o=0;if(s===0)a=tW(t),a!==-1&&(o=(t[a]+t[a+3])/2);else if(s===1)a=tW(e),a!==-1&&(o=c3e(i,r,n,a));else if(s===2){let l=v1(e),c=1.25*n,u=r*6,h=(r+n)*6;for(let d=0;d<3;d++){let f=t[d],p=(t[d+3]-f)/Vu;if(n<Vu/4){let v=[...nd];v.length=n;let m=0;for(let y=u;y<h;y+=6,m++){let x=v[m];x.candidate=i[y+2*d],x.count=0;let{bounds:_,leftCacheBounds:M,rightCacheBounds:S}=x;for(let T=0;T<3;T++)S[T]=1/0,S[T+3]=-1/0,M[T]=1/0,M[T+3]=-1/0,_[T]=1/0,_[T+3]=-1/0;ZS(y,i,_)}v.sort(o3e);let g=n;for(let y=0;y<g;y++){let x=v[y];for(;y+1<g&&v[y+1].candidate===x.candidate;)v.splice(y+1,1),g--}for(let y=u;y<h;y+=6){let x=i[y+2*d];for(let _=0;_<g;_++){let M=v[_];x>=M.candidate?ZS(y,i,M.rightCacheBounds):(ZS(y,i,M.leftCacheBounds),M.count++)}}for(let y=0;y<g;y++){let x=v[y],_=x.count,M=n-x.count,S=x.leftCacheBounds,T=x.rightCacheBounds,E=0;_!==0&&(E=v1(S)/l);let C=0;M!==0&&(C=v1(T)/l);let A=1+1.25*(E*_+C*M);A<c&&(a=d,c=A,o=x.candidate)}}else{for(let g=0;g<Vu;g++){let y=nd[g];y.count=0,y.candidate=f+p+g*p;let x=y.bounds;for(let _=0;_<3;_++)x[_]=1/0,x[_+3]=-1/0}for(let g=u;g<h;g+=6){let y=~~((i[g+2*d]-f)/p);y>=Vu&&(y=Vu-1);let x=nd[y];x.count++,ZS(g,i,x.bounds)}let v=nd[Vu-1];iW(v.bounds,v.rightCacheBounds);for(let g=Vu-2;g>=0;g--){let y=nd[g],x=nd[g+1];rW(y.bounds,x.rightCacheBounds,y.rightCacheBounds)}let m=0;for(let g=0;g<Vu-1;g++){let y=nd[g],x=y.count,_=y.bounds,M=nd[g+1].rightCacheBounds;x!==0&&(m===0?iW(_,KS):rW(_,KS,KS)),m+=x;let S=0,T=0;m!==0&&(S=v1(KS)/l);let E=n-m;E!==0&&(T=v1(M)/l);let C=1+1.25*(S*m+T*E);C<c&&(a=d,c=C,o=y.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${s} used.`);return{axis:a,pos:o}}function c3e(e,t,i,r){let n=0;for(let s=t,a=t+i;s<a;s++)n+=e[s*6+r*2];return n/i}function u3e(e,t){let i=e.attributes.position,r=e.index.array,n=r.length/3,s=new Float32Array(n*6),a=i.normalized,o=i.array,l=i.offset||0,c=3;i.isInterleavedBufferAttribute&&(c=i.data.stride);let u=["getX","getY","getZ"];for(let h=0;h<n;h++){let d=h*3,f=h*6,p,v,m;a?(p=r[d+0],v=r[d+1],m=r[d+2]):(p=r[d+0]*c+l,v=r[d+1]*c+l,m=r[d+2]*c+l);for(let g=0;g<3;g++){let y,x,_;a?(y=i[u[g]](p),x=i[u[g]](v),_=i[u[g]](m)):(y=o[p+g],x=o[v+g],_=o[m+g]);let M=y;x<M&&(M=x),_<M&&(M=_);let S=y;x>S&&(S=x),_>S&&(S=_);let T=(S-M)/2,E=g*2;s[f+E+0]=M+T,s[f+E+1]=T+(Math.abs(M)+T)*i3e,M<t[g]&&(t[g]=M),S>t[g+3]&&(t[g+3]=S)}}return s}function h3e(e,t){function i(g){d&&d(g/f)}function r(g,y,x,_=null,M=0){if(!p&&M>=l&&(p=!0,c&&(console.warn(`MeshBVH: Max depth of ${l} reached when generating BVH. Consider increasing maxDepth.`),console.warn(e))),x<=u||M>=l)return i(y+x),g.offset=y,g.count=x,g;let S=l3e(g.boundingData,_,a,y,x,h);if(S.axis===-1)return i(y+x),g.offset=y,g.count=x,g;let T=a3e(o,a,y,x,S);if(T===y||T===y+x)i(y+x),g.offset=y,g.count=x;else{g.splitAxis=S.axis;let E=new QS,C=y,A=T-y;g.left=E,E.boundingData=new Float32Array(6),cR(a,C,A,E.boundingData,s),r(E,C,A,s,M+1);let D=new QS,R=T,L=x-A;g.right=D,D.boundingData=new Float32Array(6),cR(a,R,L,D.boundingData,s),r(D,R,L,s,M+1)}return g}r3e(e,t);let n=new Float32Array(6),s=new Float32Array(6),a=u3e(e,n),o=e.index.array,l=t.maxDepth,c=t.verbose,u=t.maxLeafTris,h=t.strategy,d=t.onProgress,f=e.index.count/3,p=!1,v=[],m=n3e(e);if(m.length===1){let g=m[0],y=new QS;y.boundingData=n,s3e(a,g.offset,g.count,s),r(y,g.offset,g.count,s),v.push(y)}else for(let g of m){let y=new QS;y.boundingData=new Float32Array(6),cR(a,g.offset,g.count,y.boundingData,s),r(y,g.offset,g.count,s),v.push(y)}return v}function d3e(e,t){let i=h3e(e,t),r,n,s,a=[],o=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let u=0;u<i.length;u++){let h=i[u],d=l(h),f=new o(32*d);r=new Float32Array(f),n=new Uint32Array(f),s=new Uint16Array(f),c(0,h),a.push(f)}return a;function l(u){return u.count?1:1+l(u.left)+l(u.right)}function c(u,h){let d=u/4,f=u/2,p=!!h.count,v=h.boundingData;for(let m=0;m<6;m++)r[d+m]=v[m];if(p){let m=h.offset,g=h.count;return n[d+6]=m,s[f+14]=g,s[f+15]=65535,u+32}else{let m=h.left,g=h.right,y=h.splitAxis,x;if(x=c(u+32,m),x/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return n[d+6]=x/4,x=c(x,g),n[d+7]=y,x}}}var Rh=class{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(e,t){let i=1/0,r=-1/0;for(let n=0,s=e.length;n<s;n++){let a=e[n][t];i=a<i?a:i,r=a>r?a:r}this.min=i,this.max=r}setFromPoints(e,t){let i=1/0,r=-1/0;for(let n=0,s=t.length;n<s;n++){let a=t[n],o=e.dot(a);i=o<i?o:i,r=o>r?o:r}this.min=i,this.max=r}isSeparated(e){return this.min>e.max||e.min>this.max}};Rh.prototype.setFromBox=function(){let e=new N;return function(t,i){let r=i.min,n=i.max,s=1/0,a=-1/0;for(let o=0;o<=1;o++)for(let l=0;l<=1;l++)for(let c=0;c<=1;c++){e.x=r.x*o+n.x*(1-o),e.y=r.y*l+n.y*(1-l),e.z=r.z*c+n.z*(1-c);let u=t.dot(e);s=Math.min(u,s),a=Math.max(u,a)}this.min=s,this.max=a}}();var f3e=function(){let e=new N,t=new N,i=new N;return function(r,n,s){let a=r.start,o=e,l=n.start,c=t;i.subVectors(a,l),e.subVectors(r.end,r.start),t.subVectors(n.end,n.start);let u=i.dot(c),h=c.dot(o),d=c.dot(c),f=i.dot(o),p=o.dot(o)*d-h*h,v,m;p!==0?v=(u*h-f*d)/p:v=0,m=(u+v*h)/d,s.x=v,s.y=m}}(),NN=function(){let e=new Me,t=new N,i=new N;return function(r,n,s,a){f3e(r,n,e);let o=e.x,l=e.y;if(o>=0&&o<=1&&l>=0&&l<=1){r.at(o,s),n.at(l,a);return}else if(o>=0&&o<=1){l<0?n.at(0,a):n.at(1,a),r.closestPointToPoint(a,!0,s);return}else if(l>=0&&l<=1){o<0?r.at(0,s):r.at(1,s),n.closestPointToPoint(s,!0,a);return}else{let c;o<0?c=r.start:c=r.end;let u;l<0?u=n.start:u=n.end;let h=t,d=i;if(r.closestPointToPoint(u,!0,t),n.closestPointToPoint(c,!0,i),h.distanceToSquared(u)<=d.distanceToSquared(c)){s.copy(h),a.copy(u);return}else{s.copy(c),a.copy(d);return}}}}(),p3e=function(){let e=new N,t=new N,i=new Ka,r=new vl;return function(n,s){let{radius:a,center:o}=n,{a:l,b:c,c:u}=s;if(r.start=l,r.end=c,r.closestPointToPoint(o,!0,e).distanceTo(o)<=a||(r.start=l,r.end=u,r.closestPointToPoint(o,!0,e).distanceTo(o)<=a)||(r.start=c,r.end=u,r.closestPointToPoint(o,!0,e).distanceTo(o)<=a))return!0;let h=s.getPlane(i);if(Math.abs(h.distanceToPoint(o))<=a){let d=h.projectPoint(o,t);if(s.containsPoint(d))return!0}return!1}}(),m3e=1e-15;function Rg(e){return Math.abs(e)<m3e}var Ih=class extends Rs{constructor(...e){super(...e),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new N),this.satBounds=new Array(4).fill().map(()=>new Rh),this.points=[this.a,this.b,this.c],this.sphere=new uo,this.plane=new Ka,this.needsUpdate=!0}intersectsSphere(e){return p3e(e,this)}update(){let e=this.a,t=this.b,i=this.c,r=this.points,n=this.satAxes,s=this.satBounds,a=n[0],o=s[0];this.getNormal(a),o.setFromPoints(a,r);let l=n[1],c=s[1];l.subVectors(e,t),c.setFromPoints(l,r);let u=n[2],h=s[2];u.subVectors(t,i),h.setFromPoints(u,r);let d=n[3],f=s[3];d.subVectors(i,e),f.setFromPoints(d,r),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(a,e),this.needsUpdate=!1}};Ih.prototype.closestPointToSegment=function(){let e=new N,t=new N,i=new vl;return function(r,n=null,s=null){let{start:a,end:o}=r,l=this.points,c,u=1/0;for(let h=0;h<3;h++){let d=(h+1)%3;i.start.copy(l[h]),i.end.copy(l[d]),NN(i,r,e,t),c=e.distanceToSquared(t),c<u&&(u=c,n&&n.copy(e),s&&s.copy(t))}return this.closestPointToPoint(a,e),c=a.distanceToSquared(e),c<u&&(u=c,n&&n.copy(e),s&&s.copy(a)),this.closestPointToPoint(o,e),c=o.distanceToSquared(e),c<u&&(u=c,n&&n.copy(e),s&&s.copy(o)),Math.sqrt(u)}}();Ih.prototype.intersectsTriangle=function(){let e=new Ih,t=new Array(3),i=new Array(3),r=new Rh,n=new Rh,s=new N,a=new N,o=new N,l=new N,c=new vl,u=new vl,h=new vl;return function(d,f=null,p=!1){this.needsUpdate&&this.update(),d.isExtendedTriangle?d.needsUpdate&&d.update():(e.copy(d),e.update(),d=e);let v=this.plane,m=d.plane;if(Math.abs(v.normal.dot(m.normal))>1-1e-10){let g=this.satBounds,y=this.satAxes;i[0]=d.a,i[1]=d.b,i[2]=d.c;for(let M=0;M<4;M++){let S=g[M],T=y[M];if(r.setFromPoints(T,i),S.isSeparated(r))return!1}let x=d.satBounds,_=d.satAxes;t[0]=this.a,t[1]=this.b,t[2]=this.c;for(let M=0;M<4;M++){let S=x[M],T=_[M];if(r.setFromPoints(T,t),S.isSeparated(r))return!1}for(let M=0;M<4;M++){let S=y[M];for(let T=0;T<4;T++){let E=_[T];if(s.crossVectors(S,E),r.setFromPoints(s,t),n.setFromPoints(s,i),r.isSeparated(n))return!1}}return f&&(p||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),f.start.set(0,0,0),f.end.set(0,0,0)),!0}else{let g=this.points,y=!1,x=0;for(let L=0;L<3;L++){let O=g[L],H=g[(L+1)%3];c.start.copy(O),c.end.copy(H),c.delta(a);let j=y?u.start:u.end,Y=Rg(m.distanceToPoint(O));if(Rg(m.normal.dot(a))&&Y){u.copy(c),x=2;break}if((m.intersectLine(c,j)||Y)&&!Rg(j.distanceTo(H))){if(x++,y)break;y=!0}}if(x===1&&d.containsPoint(u.end))return f&&(f.start.copy(u.end),f.end.copy(u.end)),!0;if(x!==2)return!1;let _=d.points,M=!1,S=0;for(let L=0;L<3;L++){let O=_[L],H=_[(L+1)%3];c.start.copy(O),c.end.copy(H),c.delta(o);let j=M?h.start:h.end,Y=Rg(v.distanceToPoint(O));if(Rg(v.normal.dot(o))&&Y){h.copy(c),S=2;break}if((v.intersectLine(c,j)||Y)&&!Rg(j.distanceTo(H))){if(S++,M)break;M=!0}}if(S===1&&this.containsPoint(h.end))return f&&(f.start.copy(h.end),f.end.copy(h.end)),!0;if(S!==2)return!1;if(u.delta(a),h.delta(o),a.dot(o)<0){let L=h.start;h.start=h.end,h.end=L}let T=u.start.dot(a),E=u.end.dot(a),C=h.start.dot(a),A=h.end.dot(a),D=E<C,R=T<A;return T!==A&&C!==E&&D===R?!1:(f&&(l.subVectors(u.start,h.start),l.dot(a)>0?f.start.copy(u.start):f.start.copy(h.start),l.subVectors(u.end,h.end),l.dot(a)<0?f.end.copy(u.end):f.end.copy(h.end)),!0)}}}();Ih.prototype.distanceToPoint=function(){let e=new N;return function(t){return this.closestPointToPoint(t,e),t.distanceTo(e)}}();Ih.prototype.distanceToTriangle=function(){let e=new N,t=new N,i=["a","b","c"],r=new vl,n=new vl;return function(s,a=null,o=null){let l=a||o?r:null;if(this.intersectsTriangle(s,l))return(a||o)&&(a&&l.getCenter(a),o&&l.getCenter(o)),0;let c=1/0;for(let u=0;u<3;u++){let h,d=i[u],f=s[d];this.closestPointToPoint(f,e),h=f.distanceToSquared(e),h<c&&(c=h,a&&a.copy(e),o&&o.copy(f));let p=this[d];s.closestPointToPoint(p,e),h=p.distanceToSquared(e),h<c&&(c=h,a&&a.copy(p),o&&o.copy(e))}for(let u=0;u<3;u++){let h=i[u],d=i[(u+1)%3];r.set(this[h],this[d]);for(let f=0;f<3;f++){let p=i[f],v=i[(f+1)%3];n.set(s[p],s[v]),NN(r,n,e,t);let m=e.distanceToSquared(t);m<c&&(c=m,a&&a.copy(e),o&&o.copy(t))}}return Math.sqrt(c)}}();var lu=class{constructor(e,t,i){this.isOrientedBox=!0,this.min=new N,this.max=new N,this.matrix=new ft,this.invMatrix=new ft,this.points=new Array(8).fill().map(()=>new N),this.satAxes=new Array(3).fill().map(()=>new N),this.satBounds=new Array(3).fill().map(()=>new Rh),this.alignedSatBounds=new Array(3).fill().map(()=>new Rh),this.needsUpdate=!1,e&&this.min.copy(e),t&&this.max.copy(t),i&&this.matrix.copy(i)}set(e,t,i){this.min.copy(e),this.max.copy(t),this.matrix.copy(i),this.needsUpdate=!0}copy(e){this.min.copy(e.min),this.max.copy(e.max),this.matrix.copy(e.matrix),this.needsUpdate=!0}};lu.prototype.update=function(){return function(){let e=this.matrix,t=this.min,i=this.max,r=this.points;for(let l=0;l<=1;l++)for(let c=0;c<=1;c++)for(let u=0;u<=1;u++){let h=1*l|2*c|4*u,d=r[h];d.x=l?i.x:t.x,d.y=c?i.y:t.y,d.z=u?i.z:t.z,d.applyMatrix4(e)}let n=this.satBounds,s=this.satAxes,a=r[0];for(let l=0;l<3;l++){let c=s[l],u=n[l],h=1<<l,d=r[h];c.subVectors(a,d),u.setFromPoints(c,r)}let o=this.alignedSatBounds;o[0].setFromPointsField(r,"x"),o[1].setFromPointsField(r,"y"),o[2].setFromPointsField(r,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1}}();lu.prototype.intersectsBox=function(){let e=new Rh;return function(t){this.needsUpdate&&this.update();let i=t.min,r=t.max,n=this.satBounds,s=this.satAxes,a=this.alignedSatBounds;if(e.min=i.x,e.max=r.x,a[0].isSeparated(e)||(e.min=i.y,e.max=r.y,a[1].isSeparated(e))||(e.min=i.z,e.max=r.z,a[2].isSeparated(e)))return!1;for(let o=0;o<3;o++){let l=s[o],c=n[o];if(e.setFromBox(l,t),c.isSeparated(e))return!1}return!0}}();lu.prototype.intersectsTriangle=function(){let e=new Ih,t=new Array(3),i=new Rh,r=new Rh,n=new N;return function(s){this.needsUpdate&&this.update(),s.isExtendedTriangle?s.needsUpdate&&s.update():(e.copy(s),e.update(),s=e);let a=this.satBounds,o=this.satAxes;t[0]=s.a,t[1]=s.b,t[2]=s.c;for(let h=0;h<3;h++){let d=a[h],f=o[h];if(i.setFromPoints(f,t),d.isSeparated(i))return!1}let l=s.satBounds,c=s.satAxes,u=this.points;for(let h=0;h<3;h++){let d=l[h],f=c[h];if(i.setFromPoints(f,u),d.isSeparated(i))return!1}for(let h=0;h<3;h++){let d=o[h];for(let f=0;f<4;f++){let p=c[f];if(n.crossVectors(d,p),i.setFromPoints(n,t),r.setFromPoints(n,u),i.isSeparated(r))return!1}}return!0}}();lu.prototype.closestPointToPoint=function(){return function(e,t){return this.needsUpdate&&this.update(),t.copy(e).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),t}}();lu.prototype.distanceToPoint=function(){let e=new N;return function(t){return this.closestPointToPoint(t,e),t.distanceTo(e)}}();lu.prototype.distanceToBox=function(){let e=["x","y","z"],t=new Array(12).fill().map(()=>new vl),i=new Array(12).fill().map(()=>new vl),r=new N,n=new N;return function(s,a=0,o=null,l=null){if(this.needsUpdate&&this.update(),this.intersectsBox(s))return(o||l)&&(s.getCenter(n),this.closestPointToPoint(n,r),s.closestPointToPoint(r,n),o&&o.copy(r),l&&l.copy(n)),0;let c=a*a,u=s.min,h=s.max,d=this.points,f=1/0;for(let v=0;v<8;v++){let m=d[v];n.copy(m).clamp(u,h);let g=m.distanceToSquared(n);if(g<f&&(f=g,o&&o.copy(m),l&&l.copy(n),g<c))return Math.sqrt(g)}let p=0;for(let v=0;v<3;v++)for(let m=0;m<=1;m++)for(let g=0;g<=1;g++){let y=(v+1)%3,x=(v+2)%3,_=m<<y|g<<x,M=1<<v|m<<y|g<<x,S=d[_],T=d[M];t[p].set(S,T);let E=e[v],C=e[y],A=e[x],D=i[p],R=D.start,L=D.end;R[E]=u[E],R[C]=m?u[C]:h[C],R[A]=g?u[A]:h[C],L[E]=h[E],L[C]=m?u[C]:h[C],L[A]=g?u[A]:h[C],p++}for(let v=0;v<=1;v++)for(let m=0;m<=1;m++)for(let g=0;g<=1;g++){n.x=v?h.x:u.x,n.y=m?h.y:u.y,n.z=g?h.z:u.z,this.closestPointToPoint(n,r);let y=n.distanceToSquared(r);if(y<f&&(f=y,o&&o.copy(r),l&&l.copy(n),y<c))return Math.sqrt(y)}for(let v=0;v<12;v++){let m=t[v];for(let g=0;g<12;g++){let y=i[g];NN(m,y,r,n);let x=r.distanceToSquared(n);if(x<f&&(f=x,o&&o.copy(r),l&&l.copy(n),x<c))return Math.sqrt(x)}}return Math.sqrt(f)}}();var Ig=new N,Lg=new N,Og=new N,JS=new Me,$S=new Me,eM=new Me,nW=new N,sW=new N,aW=new N,tM=new N;function g3e(e,t,i,r,n,s){let a;return s===ms?a=e.intersectTriangle(r,i,t,!0,n):a=e.intersectTriangle(t,i,r,s!==na,n),a===null?null:{distance:e.origin.distanceTo(n),point:n.clone()}}function v3e(e,t,i,r,n,s,a,o,l){Ig.fromBufferAttribute(t,s),Lg.fromBufferAttribute(t,a),Og.fromBufferAttribute(t,o);let c=g3e(e,Ig,Lg,Og,tM,l);if(c){r&&(JS.fromBufferAttribute(r,s),$S.fromBufferAttribute(r,a),eM.fromBufferAttribute(r,o),c.uv=Rs.getInterpolation(tM,Ig,Lg,Og,JS,$S,eM,new Me)),n&&(JS.fromBufferAttribute(n,s),$S.fromBufferAttribute(n,a),eM.fromBufferAttribute(n,o),c.uv1=Rs.getInterpolation(tM,Ig,Lg,Og,JS,$S,eM,new Me)),i&&(nW.fromBufferAttribute(i,s),sW.fromBufferAttribute(i,a),aW.fromBufferAttribute(i,o),c.normal=Rs.getInterpolation(tM,Ig,Lg,Og,nW,sW,aW,new N),c.normal.dot(e.direction)>0&&c.normal.multiplyScalar(-1));let u={a:s,b:a,c:o,normal:new N,materialIndex:0};Rs.getNormal(Ig,Lg,Og,u.normal),c.face=u,c.faceIndex=s}return c}function Nee(e,t,i,r,n){let s=r*3,a=e.index.getX(s),o=e.index.getX(s+1),l=e.index.getX(s+2),{position:c,normal:u,uv:h,uv1:d}=e.attributes,f=v3e(i,c,u,h,d,a,o,l,t);return f?(f.faceIndex=r,n&&n.push(f),f):null}function y3e(e,t,i,r,n,s){for(let a=r,o=r+n;a<o;a++)Nee(e,t,i,a,s)}function x3e(e,t,i,r,n){let s=1/0,a=null;for(let o=r,l=r+n;o<l;o++){let c=Nee(e,t,i,o);c&&c.distance<s&&(a=c,s=c.distance)}return a}function Uc(e,t,i,r){let n=e.a,s=e.b,a=e.c,o=t,l=t+1,c=t+2;i&&(o=i.getX(t),l=i.getX(t+1),c=i.getX(t+2)),n.x=r.getX(o),n.y=r.getY(o),n.z=r.getZ(o),s.x=r.getX(l),s.y=r.getY(l),s.z=r.getZ(l),a.x=r.getX(c),a.y=r.getY(c),a.z=r.getZ(c)}function oW(e,t,i,r,n,s,a){let o=i.index,l=i.attributes.position;for(let c=e,u=t+e;c<u;c++)if(Uc(a,c*3,o,l),a.needsUpdate=!0,r(a,c,n,s))return!0;return!1}var kee=class{constructor(e){this._getNewPrimitive=e,this._primitives=[]}getPrimitive(){let e=this._primitives;return e.length===0?this._getNewPrimitive():e.pop()}releasePrimitive(e){this._primitives.push(e)}};function Id(e,t){return t[e+15]===65535}function u0(e,t){return t[e+6]}function Ww(e,t){return t[e+14]}function Xw(e){return e+8}function qw(e,t){return t[e+6]}function w3e(e,t){return t[e+7]}var Xv=new vn,XA=new N,b3e=["x","y","z"];function Zz(e,t,i,r,n){let s=e*2,a=vy,o=lf,l=cf;if(Id(s,o)){let c=u0(e,l),u=Ww(s,o);y3e(t,i,r,c,u,n)}else{let c=Xw(e);qA(c,a,r,XA)&&Zz(c,t,i,r,n);let u=qw(e,l);qA(u,a,r,XA)&&Zz(u,t,i,r,n)}}function Kz(e,t,i,r){let n=e*2,s=vy,a=lf,o=cf;if(Id(n,a)){let l=u0(e,o),c=Ww(n,a);return x3e(t,i,r,l,c)}else{let l=w3e(e,o),c=b3e[l],u=r.direction[c]>=0,h,d;u?(h=Xw(e),d=qw(e,o)):(h=qw(e,o),d=Xw(e));let f=qA(h,s,r,XA)?Kz(h,t,i,r):null;if(f){let v=f.point[c];if(u?v<=s[d+l]:v>=s[d+l+3])return f}let p=qA(d,s,r,XA)?Kz(d,t,i,r):null;return f&&p?f.distance<=p.distance?f:p:f||p||null}}var _3e=function(){let e,t,i=[],r=new kee(()=>new vn);return function(...s){e=r.getPrimitive(),t=r.getPrimitive(),i.push(e,t);let a=n(...s);r.releasePrimitive(e),r.releasePrimitive(t),i.pop(),i.pop();let o=i.length;return o>0&&(t=i[o-1],e=i[o-2]),a};function n(s,a,o,l,c=null,u=0,h=0){function d(y){let x=y*2,_=lf,M=cf;for(;!Id(x,_);)y=Xw(y),x=y*2;return u0(y,M)}function f(y){let x=y*2,_=lf,M=cf;for(;!Id(x,_);)y=qw(y,M),x=y*2;return u0(y,M)+Ww(x,_)}let p=s*2,v=vy,m=lf,g=cf;if(Id(p,m)){let y=u0(s,g),x=Ww(p,m);return Hc(s,v,e),l(y,x,!1,h,u+s,e)}else{let y=Xw(s),x=qw(s,g),_=y,M=x,S,T,E,C;if(c&&(E=e,C=t,Hc(_,v,E),Hc(M,v,C),S=c(E),T=c(C),T<S)){_=x,M=y;let j=S;S=T,T=j,E=C}E||(E=e,Hc(_,v,E));let A=Id(_*2,m),D=o(E,A,S,h+1,u+_),R;if(D===2){let j=d(_),Y=f(_)-j;R=l(j,Y,!0,h+1,u+_,E)}else R=D&&n(_,a,o,l,c,u,h+1);if(R)return!0;C=t,Hc(M,v,C);let L=Id(M*2,m),O=o(C,L,T,h+1,u+M),H;if(O===2){let j=d(M),Y=f(M)-j;H=l(j,Y,!0,h+1,u+M,C)}else H=O&&n(M,a,o,l,c,u,h+1);return!!H}}}(),S3e=function(){let e=new Ih,t=new Ih,i=new ft,r=new lu,n=new lu;return function s(a,o,l,c,u=null){let h=a*2,d=vy,f=lf,p=cf;if(u===null&&(l.boundingBox||l.computeBoundingBox(),r.set(l.boundingBox.min,l.boundingBox.max,c),u=r),Id(h,f)){let v=o,m=v.index,g=v.attributes.position,y=l.index,x=l.attributes.position,_=u0(a,p),M=Ww(h,f);if(i.copy(c).invert(),l.boundsTree)return Hc(a,d,n),n.matrix.copy(i),n.needsUpdate=!0,l.boundsTree.shapecast({intersectsBounds:S=>n.intersectsBox(S),intersectsTriangle:S=>{S.a.applyMatrix4(c),S.b.applyMatrix4(c),S.c.applyMatrix4(c),S.needsUpdate=!0;for(let T=_*3,E=(M+_)*3;T<E;T+=3)if(Uc(t,T,m,g),t.needsUpdate=!0,S.intersectsTriangle(t))return!0;return!1}});for(let S=_*3,T=M+_*3;S<T;S+=3){Uc(e,S,m,g),e.a.applyMatrix4(i),e.b.applyMatrix4(i),e.c.applyMatrix4(i),e.needsUpdate=!0;for(let E=0,C=y.count;E<C;E+=3)if(Uc(t,E,y,x),t.needsUpdate=!0,e.intersectsTriangle(t))return!0}}else{let v=a+8,m=p[a+6];return Hc(v,d,Xv),!!(u.intersectsBox(Xv)&&s(v,o,l,c,u)||(Hc(m,d,Xv),u.intersectsBox(Xv)&&s(m,o,l,c,u)))}}}();function qA(e,t,i,r){return Hc(e,t,Xv),i.intersectBox(Xv,r)}var Jz=[],s2,vy,lf,cf;function ox(e){s2&&Jz.push(s2),s2=e,vy=new Float32Array(e),lf=new Uint16Array(e),cf=new Uint32Array(e)}function iM(){s2=null,vy=null,lf=null,cf=null,Jz.length&&ox(Jz.pop())}var uR=Symbol("skip tree generation"),hR=new vn,dR=new vn,zg=new ft,ep=new lu,y1=new lu,x1=new N,rM=new N,M3e=new N,E3e=new N,A3e=new N,lW=new vn,Sc=new kee(()=>new Ih),Bx=class{static serialize(e,t={}){if(t.isBufferGeometry)return console.warn("MeshBVH.serialize: The arguments for the function have changed. See documentation for new signature."),Bx.serialize(arguments[0],{cloneBuffers:arguments[2]===void 0?!0:arguments[2]});t={cloneBuffers:!0,...t};let i=e.geometry,r=e._roots,n=i.getIndex(),s;return t.cloneBuffers?s={roots:r.map(a=>a.slice()),index:n.array.slice()}:s={roots:r,index:n.array},s}static deserialize(e,t,i={}){if(typeof i=="boolean")return console.warn("MeshBVH.deserialize: The arguments for the function have changed. See documentation for new signature."),Bx.deserialize(arguments[0],arguments[1],{setIndex:arguments[2]===void 0?!0:arguments[2]});i={setIndex:!0,...i};let{index:r,roots:n}=e,s=new Bx(t,{...i,[uR]:!0});if(s._roots=n,i.setIndex){let a=t.getIndex();if(a===null){let o=new Qt(e.index,1,!1);t.setIndex(o)}else a.array!==r&&(a.array.set(r),a.needsUpdate=!0)}return s}constructor(e,t={}){if(e.isBufferGeometry){if(e.index&&e.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.")}else throw new Error("MeshBVH: Only BufferGeometries are supported.");if(t=Object.assign({strategy:0,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,[uR]:!1},t),t.useSharedArrayBuffer&&typeof SharedArrayBuffer>"u")throw new Error("MeshBVH: SharedArrayBuffer is not available.");this._roots=null,t[uR]||(this._roots=d3e(e,t),!e.boundingBox&&t.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new vn))),this.geometry=e}refit(e=null){e&&Array.isArray(e)&&(e=new Set(e));let t=this.geometry,i=t.index.array,r=t.attributes.position,n,s,a,o,l=0,c=this._roots;for(let h=0,d=c.length;h<d;h++)n=c[h],s=new Uint32Array(n),a=new Uint16Array(n),o=new Float32Array(n),u(0,l),l+=n.byteLength;function u(h,d,f=!1){let p=h*2;if(a[p+15]===65535){let v=s[h+6],m=a[p+14],g=1/0,y=1/0,x=1/0,_=-1/0,M=-1/0,S=-1/0;for(let T=3*v,E=3*(v+m);T<E;T++){let C=i[T],A=r.getX(C),D=r.getY(C),R=r.getZ(C);A<g&&(g=A),A>_&&(_=A),D<y&&(y=D),D>M&&(M=D),R<x&&(x=R),R>S&&(S=R)}return o[h+0]!==g||o[h+1]!==y||o[h+2]!==x||o[h+3]!==_||o[h+4]!==M||o[h+5]!==S?(o[h+0]=g,o[h+1]=y,o[h+2]=x,o[h+3]=_,o[h+4]=M,o[h+5]=S,!0):!1}else{let v=h+8,m=s[h+6],g=v+d,y=m+d,x=f,_=!1,M=!1;e?x||(_=e.has(g),M=e.has(y),x=!_&&!M):(_=!0,M=!0);let S=x||_,T=x||M,E=!1;S&&(E=u(v,d,x));let C=!1;T&&(C=u(m,d,x));let A=E||C;if(A)for(let D=0;D<3;D++){let R=v+D,L=m+D,O=o[R],H=o[R+3],j=o[L],Y=o[L+3];o[h+D]=O<j?O:j,o[h+D+3]=H>Y?H:Y}return A}}}traverse(e,t=0){let i=this._roots[t],r=new Uint32Array(i),n=new Uint16Array(i);s(0);function s(a,o=0){let l=a*2,c=n[l+15]===65535;if(c){let u=r[a+6],h=n[l+14];e(o,c,new Float32Array(i,a*4,6),u,h)}else{let u=a+8,h=r[a+6],d=r[a+7];e(o,c,new Float32Array(i,a*4,6),d)||(s(u,o+1),s(h,o+1))}}}raycast(e,t=nc){let i=this._roots,r=this.geometry,n=[],s=t.isMaterial,a=Array.isArray(t),o=r.groups,l=s?t.side:t;for(let c=0,u=i.length;c<u;c++){let h=a?t[o[c].materialIndex].side:l,d=n.length;if(ox(i[c]),Zz(0,r,h,e,n),iM(),a){let f=o[c].materialIndex;for(let p=d,v=n.length;p<v;p++)n[p].face.materialIndex=f}}return n}raycastFirst(e,t=nc){let i=this._roots,r=this.geometry,n=t.isMaterial,s=Array.isArray(t),a=null,o=r.groups,l=n?t.side:t;for(let c=0,u=i.length;c<u;c++){let h=s?t[o[c].materialIndex].side:l;ox(i[c]);let d=Kz(0,r,h,e);iM(),d!=null&&(a==null||d.distance<a.distance)&&(a=d,s&&(d.face.materialIndex=o[c].materialIndex))}return a}intersectsGeometry(e,t){let i=this.geometry,r=!1;for(let n of this._roots)if(ox(n),r=S3e(0,i,e,t),iM(),r)break;return r}shapecast(e,t,i){let r=this.geometry;if(e instanceof Function){if(t){let h=t;t=(d,f,p,v)=>{let m=f*3;return h(d,m,m+1,m+2,p,v)}}e={boundsTraverseOrder:i,intersectsBounds:e,intersectsTriangle:t,intersectsRange:null},console.warn("MeshBVH: Shapecast function signature has changed and now takes an object of callbacks as a second argument. See docs for new signature.")}let n=Sc.getPrimitive(),{boundsTraverseOrder:s,intersectsBounds:a,intersectsRange:o,intersectsTriangle:l}=e;if(o&&l){let h=o;o=(d,f,p,v,m)=>h(d,f,p,v,m)?!0:oW(d,f,r,l,p,v,n)}else o||(l?o=(h,d,f,p)=>oW(h,d,r,l,f,p,n):o=(h,d,f)=>f);let c=!1,u=0;for(let h of this._roots){if(ox(h),c=_3e(0,r,a,o,s,u),iM(),c)break;u+=h.byteLength}return Sc.releasePrimitive(n),c}bvhcast(e,t,i){let{intersectsRanges:r,intersectsTriangles:n}=i,s=this.geometry.index,a=this.geometry.attributes.position,o=e.geometry.index,l=e.geometry.attributes.position;zg.copy(t).invert();let c=Sc.getPrimitive(),u=Sc.getPrimitive();if(n){let d=function(f,p,v,m,g,y,x,_){for(let M=v,S=v+m;M<S;M++){Uc(u,M*3,o,l),u.a.applyMatrix4(t),u.b.applyMatrix4(t),u.c.applyMatrix4(t),u.needsUpdate=!0;for(let T=f,E=f+p;T<E;T++)if(Uc(c,T*3,s,a),c.needsUpdate=!0,n(c,u,T,M,g,y,x,_))return!0}return!1};if(r){let f=r;r=function(p,v,m,g,y,x,_,M){return f(p,v,m,g,y,x,_,M)?!0:d(p,v,m,g,y,x,_,M)}}else r=d}e.getBoundingBox(dR),dR.applyMatrix4(t);let h=this.shapecast({intersectsBounds:d=>dR.intersectsBox(d),intersectsRange:(d,f,p,v,m,g)=>(hR.copy(g),hR.applyMatrix4(zg),e.shapecast({intersectsBounds:y=>hR.intersectsBox(y),intersectsRange:(y,x,_,M,S)=>r(d,f,y,x,v,m,M,S)}))});return Sc.releasePrimitive(c),Sc.releasePrimitive(u),h}intersectsBox(e,t){return ep.set(e.min,e.max,t),ep.needsUpdate=!0,this.shapecast({intersectsBounds:i=>ep.intersectsBox(i),intersectsTriangle:i=>ep.intersectsTriangle(i)})}intersectsSphere(e){return this.shapecast({intersectsBounds:t=>e.intersectsBox(t),intersectsTriangle:t=>t.intersectsSphere(e)})}closestPointToGeometry(e,t,i={},r={},n=0,s=1/0){e.boundingBox||e.computeBoundingBox(),ep.set(e.boundingBox.min,e.boundingBox.max,t),ep.needsUpdate=!0;let a=this.geometry,o=a.attributes.position,l=a.index,c=e.attributes.position,u=e.index,h=Sc.getPrimitive(),d=Sc.getPrimitive(),f=rM,p=M3e,v=null,m=null;r&&(v=E3e,m=A3e);let g=1/0,y=null,x=null;return zg.copy(t).invert(),y1.matrix.copy(zg),this.shapecast({boundsTraverseOrder:_=>ep.distanceToBox(_),intersectsBounds:(_,M,S)=>S<g&&S<s?(M&&(y1.min.copy(_.min),y1.max.copy(_.max),y1.needsUpdate=!0),!0):!1,intersectsRange:(_,M)=>{if(e.boundsTree)return e.boundsTree.shapecast({boundsTraverseOrder:S=>y1.distanceToBox(S),intersectsBounds:(S,T,E)=>E<g&&E<s,intersectsRange:(S,T)=>{for(let E=S*3,C=(S+T)*3;E<C;E+=3){Uc(d,E,u,c),d.a.applyMatrix4(t),d.b.applyMatrix4(t),d.c.applyMatrix4(t),d.needsUpdate=!0;for(let A=_*3,D=(_+M)*3;A<D;A+=3){Uc(h,A,l,o),h.needsUpdate=!0;let R=h.distanceToTriangle(d,f,v);if(R<g&&(p.copy(f),m&&m.copy(v),g=R,y=A/3,x=E/3),R<n)return!0}}}});{let S=u?u.count:c.count;for(let T=0,E=S;T<E;T+=3){Uc(d,T,u,c),d.a.applyMatrix4(t),d.b.applyMatrix4(t),d.c.applyMatrix4(t),d.needsUpdate=!0;for(let C=_*3,A=(_+M)*3;C<A;C+=3){Uc(h,C,l,o),h.needsUpdate=!0;let D=h.distanceToTriangle(d,f,v);if(D<g&&(p.copy(f),m&&m.copy(v),g=D,y=C/3,x=T/3),D<n)return!0}}}}}),Sc.releasePrimitive(h),Sc.releasePrimitive(d),g===1/0?null:(i.point?i.point.copy(p):i.point=p.clone(),i.distance=g,i.faceIndex=y,r&&(r.point?r.point.copy(m):r.point=m.clone(),r.point.applyMatrix4(zg),p.applyMatrix4(zg),r.distance=p.sub(r.point).length(),r.faceIndex=x),i)}closestPointToPoint(e,t={},i=0,r=1/0){let n=i*i,s=r*r,a=1/0,o=null;if(this.shapecast({boundsTraverseOrder:c=>(x1.copy(e).clamp(c.min,c.max),x1.distanceToSquared(e)),intersectsBounds:(c,u,h)=>h<a&&h<s,intersectsTriangle:(c,u)=>{c.closestPointToPoint(e,x1);let h=e.distanceToSquared(x1);return h<a&&(rM.copy(x1),a=h,o=u),h<n}}),a===1/0)return null;let l=Math.sqrt(a);return t.point?t.point.copy(rM):t.point=rM.clone(),t.distance=l,t.faceIndex=o,t}getBoundingBox(e){return e.makeEmpty(),this._roots.forEach(t=>{Hc(0,new Float32Array(t),lW),e.union(lW)}),e}},$z=Tf(Eme()),T3e=.5*(Math.sqrt(3)-1),w1=(3-Math.sqrt(3))/6,C3e=1/3,Mc=1/6,Fx=e=>Math.floor(e)|0,cW=new Float64Array([1,1,-1,1,1,-1,-1,-1,1,0,-1,0,1,0,-1,0,0,1,0,-1,0,1,0,-1]),fR=new Float64Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]);function P3e(e=Math.random){let t=Vee(e),i=new Float64Array(t).map(n=>cW[n%12*2]),r=new Float64Array(t).map(n=>cW[n%12*2+1]);return function(n,s){let a=0,o=0,l=0,c=(n+s)*T3e,u=Fx(n+c),h=Fx(s+c),d=(u+h)*w1,f=u-d,p=h-d,v=n-f,m=s-p,g,y;v>m?(g=1,y=0):(g=0,y=1);let x=v-g+w1,_=m-y+w1,M=v-1+2*w1,S=m-1+2*w1,T=u&255,E=h&255,C=.5-v*v-m*m;if(C>=0){let R=T+t[E],L=i[R],O=r[R];C*=C,a=C*C*(L*v+O*m)}let A=.5-x*x-_*_;if(A>=0){let R=T+g+t[E+y],L=i[R],O=r[R];A*=A,o=A*A*(L*x+O*_)}let D=.5-M*M-S*S;if(D>=0){let R=T+1+t[E+1],L=i[R],O=r[R];D*=D,l=D*D*(L*M+O*S)}return 70*(a+o+l)}}function D3e(e=Math.random){let t=Vee(e),i=new Float64Array(t).map(s=>fR[s%12*3]),r=new Float64Array(t).map(s=>fR[s%12*3+1]),n=new Float64Array(t).map(s=>fR[s%12*3+2]);return function(s,a,o){let l,c,u,h,d=(s+a+o)*C3e,f=Fx(s+d),p=Fx(a+d),v=Fx(o+d),m=(f+p+v)*Mc,g=f-m,y=p-m,x=v-m,_=s-g,M=a-y,S=o-x,T,E,C,A,D,R;_>=M?M>=S?(T=1,E=0,C=0,A=1,D=1,R=0):_>=S?(T=1,E=0,C=0,A=1,D=0,R=1):(T=0,E=0,C=1,A=1,D=0,R=1):M<S?(T=0,E=0,C=1,A=0,D=1,R=1):_<S?(T=0,E=1,C=0,A=0,D=1,R=1):(T=0,E=1,C=0,A=1,D=1,R=0);let L=_-T+Mc,O=M-E+Mc,H=S-C+Mc,j=_-A+2*Mc,Y=M-D+2*Mc,z=S-R+2*Mc,V=_-1+3*Mc,U=M-1+3*Mc,k=S-1+3*Mc,X=f&255,re=p&255,q=v&255,ee=.6-_*_-M*M-S*S;if(ee<0)l=0;else{let pe=X+t[re+t[q]];ee*=ee,l=ee*ee*(i[pe]*_+r[pe]*M+n[pe]*S)}let $=.6-L*L-O*O-H*H;if($<0)c=0;else{let pe=X+T+t[re+E+t[q+C]];$*=$,c=$*$*(i[pe]*L+r[pe]*O+n[pe]*H)}let ne=.6-j*j-Y*Y-z*z;if(ne<0)u=0;else{let pe=X+A+t[re+D+t[q+R]];ne*=ne,u=ne*ne*(i[pe]*j+r[pe]*Y+n[pe]*z)}let ce=.6-V*V-U*U-k*k;if(ce<0)h=0;else{let pe=X+1+t[re+1+t[q+1]];ce*=ce,h=ce*ce*(i[pe]*V+r[pe]*U+n[pe]*k)}return 32*(l+c+u+h)}}function Vee(e){let t=new Uint8Array(512);for(let i=0;i<512/2;i++)t[i]=i;for(let i=0;i<512/2-1;i++){let r=i+~~(e()*(256-i)),n=t[i];t[i]=t[r],t[r]=n}for(let i=256;i<512;i++)t[i]=t[i-256];return t}var Pl=new Rs,R3e=class{constructor(e){this.weightAttribute=null;let t=e.geometry;if(!t.isBufferGeometry||t.attributes.position.itemSize!==3)throw new Error("THREE.MeshSurfaceSampler: Requires BufferGeometry triangle mesh.");t.index&&(t=t.toNonIndexed()),this.geometry=t,this.randomFunction=Math.random,this.positionAttribute=this.geometry.getAttribute("position"),this.distribution=null}build(){let e=this.positionAttribute,t=new Float32Array(e.count/3);for(let r=0;r<e.count;r+=3){let n=1;Pl.a.fromBufferAttribute(e,r),Pl.b.fromBufferAttribute(e,r+1),Pl.c.fromBufferAttribute(e,r+2),n*=Pl.getArea(),t[r/3]=n}this.distribution=new Float32Array(e.count/3);let i=0;for(let r=0;r<t.length;r++)i+=t[r],this.distribution[r]=i;return this}setRandomGenerator(e){return this.randomFunction=e,this}sample(e,t){if(this.distribution){let i=this.distribution[this.distribution.length-1],r=this.binarySearch(this.randomFunction()*i);return this.sampleFace(r,e,t)}}binarySearch(e){if(!this.distribution)return 0;let t=this.distribution,i=0,r=t.length-1,n=-1;for(;i<=r;){let s=Math.ceil((i+r)/2);if(s===0||t[s-1]<=e&&t[s]>e){n=s;break}else e<t[s]?r=s-1:i=s+1}return n}sampleFace(e,t,i){let r=this.randomFunction(),n=this.randomFunction();return r+n>1&&(r=1-r,n=1-n),Pl.a.fromBufferAttribute(this.positionAttribute,e*3),Pl.b.fromBufferAttribute(this.positionAttribute,e*3+1),Pl.c.fromBufferAttribute(this.positionAttribute,e*3+2),t.set(0,0,0).addScaledVector(Pl.a,r).addScaledVector(Pl.b,n).addScaledVector(Pl.c,1-(r+n)),Pl.getNormal(i),this}},I3e=Tf(bJ()),L3e=new ft,O3e=new ft,z3e=new ft,Tm;(e=>{function t(i){return i&&i.__isSPEObject}e.is=t})(Tm||(Tm={}));var kN=e=>class extends e{constructor(){super(...arguments),this.previousModelViewMatrix=new ft,this.copyPreviousMatrix=!0,this.hiddenMatrix=new ft,this.matrixWorldRigid=new ft,this.shearScale=new ft,this.shearScaleInv=new ft}get __isSPEObject(){return!0}isDescendantOf(t){t instanceof rr&&(t=t.uuid);let i=this;for(;i.parent;){if(i.parent.uuid===t)return!0;i=i.parent}return!1}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.parent===null?this.matrixWorld.multiplyMatrices(this.hiddenMatrix,this.matrix):(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.hiddenMatrix),this.matrixWorld.multiplyMatrices(this.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,t=!0);for(let i of this.children)i.updateMatrixWorld(t)}updateWorldMatrix(t,i){let r=this.parent;if(t&&r!==null&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.multiplyMatrices(this.hiddenMatrix,this.matrix):(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.hiddenMatrix),this.matrixWorld.multiplyMatrices(this.matrixWorld,this.matrix)),i)for(let n of this.children)n.updateWorldMatrix(!1,!0)}traverseChildren(t,i=0){for(let r of this.children)Tm.is(r)&&r.traverseObject(t,i+1)}traverseObject(t,i=0){if(t(this,i)!==!0)for(let r of this.children)Tm.is(r)&&r.traverseObject(t,i+1)}updateMatrixWorldSVD(){let t=this.matrixWorld.elements,i=[[t[0],t[4],t[8]],[t[1],t[5],t[9]],[t[2],t[6],t[10]]],{u:r,v:n,q:s}=(0,I3e.SVD)(i),a=L3e.set(r[0][0],r[0][1],r[0][2],0,r[1][0],r[1][1],r[1][2],0,r[2][0],r[2][1],r[2][2],0,0,0,0,1),o=O3e.set(n[0][0],n[0][1],n[0][2],0,n[1][0],n[1][1],n[1][2],0,n[2][0],n[2][1],n[2][2],0,0,0,0,1),l=z3e.copy(o).transpose();this.shearScale.makeScale(s[0],s[1],s[2]).multiply(l).premultiply(o),this.shearScaleInv.copy(this.shearScale).invert(),this.matrixWorldRigid.multiplyMatrices(a,l).copyPosition(this.matrixWorld),s.every(c=>Math.abs(s[0]-c)<.01)?this.hasNonUniformScale=!1:this.hasNonUniformScale=!0}attach(t,i){this.updateWorldMatrix(!0,!1);let r=new ft().copy(this.matrixWorld).invert();return t.parent!==null&&(t.parent.updateWorldMatrix(!0,!1),r.multiply(t.parent.matrixWorld)),"hiddenMatrix"in t&&t.hiddenMatrix instanceof ft?t.hiddenMatrix.premultiply(r):t.applyMatrix4(r),t.updateWorldMatrix(!1,!1),this.add(t),i!==void 0&&(this.children.pop(),this.children.splice(i,0,t)),this}copy(t,i=!1){return super.copy(t,i),this.hasNonUniformScale=t.hasNonUniformScale,this}onAfterRender(t,i,r,n,s,a){this.copyPreviousMatrix&&this.previousModelViewMatrix.copy(this.modelViewMatrix)}},B3e=class extends kN(rr){},F3e=e=>e.type==="Mesh",Os=class extends B3e{constructor(e){super(),this.object=e,this.matrixAutoUpdate=!1,this.hasNonUniformScale=e.hasNonUniformScale}raycast(e,t){}expand(){let e=0,t=this.object.entityChildren(e);for(;t;){let i=this.children[e];(i==null?void 0:i.object)!==t&&(i&&this.remove(i),i=new Os(t),this.add(i),this.children.splice(e,0,this.children.pop()),i.matrixWorldNeedsUpdate=!0,i.matrixAutoUpdate=!1,i.matrix=t.matrix,i.hiddenMatrix=t.hiddenMatrix),i.expand(),e+=1,t=this.object.entityChildren(e)}for(;this.children.length>e;)this.remove(this.children[e])}get visible(){var e;return this.playModeVisible!==void 0?this.playModeVisible:this.object.visible||this.object.dataPatched.visible&&((e=this.object.dataPatched.cloner)==null?void 0:e.hideBase)===!0}set visible(e){}get castShadow(){return this.object.castShadow}set castShadow(e){}get receiveShadow(){return this.object.receiveShadow}set receiveShadow(e){}get isMesh(){return F3e(this.object)}get isLight(){return this.object.isLight}get layers(){return this.object.layers}set layers(e){}get isCamera(){return!1}get geometry(){if(this.object.geometry)return this.object.geometry}get material(){if(this.object.material)return this.object.material}},Op=new N,zp=new N,h0=new ft,Gee=[new N(-1,1,1),new N(-1,-1,1),new N(1,-1,1),new N(1,1,1),new N(-1,1,-1),new N(-1,-1,-1),new N(1,-1,-1),new N(1,1,-1)],U3e=[[0,3],[1,2],[5,6],[4,7],[0,1],[3,2],[7,6],[4,5],[0,4],[1,5],[2,6],[3,7]],N3e=[[0,2],[7,5],[4,1],[3,6],[4,3],[1,6]],uW=(e,t,i)=>{e.updateEntityBoxSize(Op,zp),h0.copy(t).multiply(e.matrixWorld),zp.x===0&&zp.y===0&&zp.z===0?i.push(new N(Op.x,Op.y,Op.z).applyMatrix4(h0)):Gee.forEach(r=>{i.push(r.clone().multiply(zp).add(Op).applyMatrix4(h0))})},hW=class extends vn{constructor(){super(...arguments),this.matrix=new ft,this.vertices=[],this.faces=[],this.edges=[],this.centerEdges=[]}copy(e){return super.copy(e),this.matrix.copy(e.matrix),this.vertices=e.vertices.map(t=>t.clone()),this.faces=e.faces.map(t=>t.clone()),this.edges=e.edges.map(t=>t.clone()),this.centerEdges=e.centerEdges.map(t=>t.clone()),this}setFromObjectSize(e,t=!1){e.updateWorldMatrix(!1,t),this.makeEmpty(),this.matrix.copy(e.matrixWorld);let i=new ft().copy(e.matrixWorld).invert();return this.expandByObjectSize(e,i,t)}expandByObjectSize(e,t,i=!1){let r=[];return i===!0?e.traverseEntity(n=>{if(n.visible||n.cloner&&n.data.visible){if(!("geometry"in n)){r.push(new N);return}uW(n,t,r)}}):uW(e,t,r),this.setFromPoints(r)}getCenter(e){return e=super.getCenter(e),e.applyMatrix4(this.matrix),e}getPositionToCenter(e){return e=super.getCenter(e),e.applyMatrix4(h0.copy(this.matrix).setPosition(0,0,0)),e}computeVertices(){this.getSize(zp).multiplyScalar(.5),this.getCenter(Op),h0.copy(this.matrix).setPosition(Op),this.vertices=Gee.map(e=>e.clone().multiply(zp).applyMatrix4(h0))}computeEdges(){this.vertices.length>0&&this.computeVertices(),this.edges=U3e.map(([e,t])=>new vl(this.vertices[e],this.vertices[t])),this.centerEdges=this.edges.map(e=>e.getCenter(new N))}computeFaces(){this.vertices.length>0&&this.computeVertices(),this.faces=N3e.map(([e,t])=>this.vertices[e].clone().add(this.vertices[t]).multiplyScalar(.5))}},Hd={Cloner:()=>{},changeEntityProptotype:()=>{},createEntity:()=>{}},k3e=class extends KJ{constructor(){super()}getPoints(e=12){let t=[],i,r=this.getCurveLengths(),n=r[r.length-1]/r.length;for(let s=0,a=this.curves;s<a.length;s++){let o=a[s],l=s===0?r[s]:r[s]-r[s-1],c=Math.ceil(e*l/n),u=o.getPoints(c);for(let h=0;h<u.length;h++){let d=u[h];i&&i.equals(d)||(t.push(d),i=d)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}},eB=.001;function tB(e,t,i){return t.clone().sub(e).cross(t.clone().sub(i)).length()<=eB}function pR(e,t){let i=new N(...e.position),r=new N(...e.controlNext.position),n=new N(...t.controlPrevious.position),s=new N(...t.position);return tB(i,r,s)&&tB(i,n,s)}function Hee(e){let t=e.points.map(u=>new N(...u.data.position)),i=[e.points[0]],r=new N(...i[0].data.position);for(let u=0;u<e.points.length-1;u++)tB(r,t[u],t[u+1])||(i.push(e.points[u]),r=t[u]);i.push(e.points[e.points.length-1]);let n=e.isClosed,s=i.length-(n?0:1),a=i.length,o=[];for(let u=0;u<a;u++){let h=i[u].data,d=new N(...h.position),f=new N(...h.controlPrevious.position),p=new N(...h.controlNext.position),v={position:d,baseRoundness:h.roundness,controlPrevious:f,controlNext:p};if(h.roundness===0||!e.isClosed&&(u===0||u===a-1)){o[u]={...v,removedLength:0};continue}let m=n&&u==0?a-1:u-1,g=n&&u==a-1?0:u+1,y=i[m].data,x=i[g].data,_=new N(...y.position),M=new N(...x.position),S=_.clone().sub(d).normalize(),T=M.clone().sub(d).normalize();Object.assign(v,{prevDir:S,nextDir:T});let E=pR(y,h),C=pR(h,x);if(!E||!C)o[u]={...v,removedLength:0};else{let A=S.clone().add(T).normalize(),D=A.clone().cross(S).length()/S.dot(A);o[u]={...v,tan:D,removedLength:h.roundness/D}}}for(let u=0;u<s;u++){let h=u,d=n&&u===a-1?0:u+1,f=o[h],p=o[d];if(f.removedLength!==0||p.removedLength!==0){let v=f.position.distanceTo(p.position);f.removedLength=Math.min(f.removedLength,v/2),p.removedLength=Math.min(p.removedLength,v/2)}}let l=[];for(let u=0;u<s;u++){let h=u,d=n&&u===a-1?0:u+1,f=o[h],p=o[d],v=null;if(!pR(i[h].data,i[d].data))f.position.distanceTo(p.position)>eB&&(v=new e2(f.position,f.controlNext,p.controlPrevious,p.position));else{let m=f.position.clone(),g=p.position.clone();(f.removedLength!==0||p.removedLength!==0)&&(f.nextDir&&m.add(f.nextDir.clone().setLength(f.removedLength)),p.prevDir&&g.add(p.prevDir.clone().setLength(p.removedLength))),m.distanceTo(g)>eB&&(v=new e2(m,m.clone().lerp(g,.3),g.clone().lerp(m,.3),g))}l[2*u+1]=v}for(let u=0;u<a;u++){let h=o[u];if(h.removedLength===0){l[2*u]=null;continue}let d=h.position,f=h.prevDir.clone().multiplyScalar(h.removedLength).add(d),p=h.nextDir.clone().multiplyScalar(h.removedLength).add(d),v=h.tan*h.removedLength,m=h.prevDir.clone().add(h.nextDir).normalize(),g=f.clone().lerp(p,.5),y=f.distanceTo(p)/2,x=m.clone().multiplyScalar(Math.sqrt(Math.pow(v,2)-Math.pow(y,2))).add(g),_=m.clone().multiplyScalar(-v).add(x),M=d.distanceTo(_)/d.distanceTo(g),S=h.prevDir.clone().multiplyScalar(M*d.distanceTo(f)).add(d),T=S.clone().lerp(_,2),E=f.clone().lerp(S,4/3),C=p.clone().lerp(T,4/3);l[2*u]=new e2(f,E,C,p)}let c=new k3e;return l.forEach(u=>{u&&c.add(u)}),c}var Fi;(e=>{function t(i){return i&&i.__isEntity}e.is=t})(Fi||(Fi={}));var Ku=e=>Fi.is(e),V3e={type:"completeState",isfromEntity:!0},G3e=["x","y","z"],mR=new N,H3e=new N().set(0,1,0),VN=e=>class extends kN(e){constructor(){super(...arguments),this.raycastLock=!1,this.scaleLock=!1,this.disposed=!1,this.stateSelection=null,this.destroyedInAction=!1,this.instances=[],this.prevState=null,this.currentState=null,this.reversibleToState=null,this.currentTransitionEvent=null,this.previousAction=null,this._singleBBox=new hW,this._recursiveBBox=new hW,this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0,this._needApplyPathSnapping=!0,this.attachedPaths=new Set}get __isEntity(){return!0}entityChildren(t){let i=this.children[t];if(Fi.is(i))return i}entityChildrenCount(){let t=this.children.length;for(;t--;)if(Fi.is(this.children[t]))return t+1;return 0}get isConcreteEntity(){return typeof this.identity=="string"}get isVirtualEntity(){return typeof this.identity!="string"}get isInstanceRoot(){return this.isConcreteEntity&&this.data.type==="Instance"}nearestInstanceSelfOrParent(){let t=this;for(;t.data.type!=="Instance";){let i=t.parent;if(Fi.is(i))t=i;else return}return t}forInstancesRec(t){this.instances.forEach(i=>{i.disposed||t(i),i.forInstancesRec(t)})}super_Entity(t,i){typeof t=="string"&&(this.uuid=t),this.identity=t,this.data=i,this.matrixAutoUpdate=!1,this.dataPatched=this.data}changeSelectedState(t,i,r=!1){if(!(this.data.states.length===0&&!r)){for(let n of this.data.states)Wp.toOps(this.data,n.data).forEach(s=>{let a=AA.replaceProps(s,this.data);this.dataPatched=this.data,this.updateByPatchedOp(a,this.data,i)});if(t!==null){let n=this.data.states.data(t);n&&(this.dataPatched=Wp.patch(this.data,n),Wp.toOps(this.data,n).forEach(s=>{this.updateByPatchedOp(s,this.dataPatched,i)}))}r&&this.updateTransformState(this.dataPatched,i),this.stateSelection=t,this.updatePathSnapping(this.dataPatched.pathSnapping)}}get singleBBox(){return this.singleBBoxNeedsUpdate&&(this.singleBBoxNeedsUpdate=!1,this._singleBBox.setFromObjectSize(this,!1),this._singleBBox.computeVertices(),this._singleBBox.computeEdges(),this._singleBBox.computeFaces()),this._singleBBox}get recursiveBBox(){return this.recursiveBBoxNeedsUpdate&&(this.recursiveBBoxNeedsUpdate=!1,this._recursiveBBox.setFromObjectSize(this,!0),this._recursiveBBox.computeVertices(),this._recursiveBBox.computeEdges(),this._recursiveBBox.computeFaces()),this._recursiveBBox}updateEntityBoxSize(t,i){t.setScalar(0),i.setScalar(0)}resetBBoxNeedsUpdateSelf(){this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0}resetBBoxNeedsUpdate(){this.resetBBoxNeedsUpdateSelf(),this.traverseAncestors(t=>{Ku(t)&&t.resetBBoxNeedsUpdateSelf()}),this.traverseEntity(t=>{t.resetBBoxNeedsUpdateSelf()})}find(t){let i;return this.traverseEntity(r=>{r.uuid===t&&(i=r)}),i}traverseSortNextHelper(){let t=this.parent;if(t){let i=t.children,r=i.indexOf(this)+1;if(Fi.is(i[r]))return i[r];if(Fi.is(t))return t.traverseSortNextHelper()}}sortNext(){let t=this.children;return this.children.length>0&&Fi.is(this.children[0])?t[0]:this.traverseSortNextHelper()}goUp(t){let i=this;for(;t>0&&i!==null;)i=i.parent,t-=1;return i}hasAnccestorOrSelf(t){return this===t||this.hasAnccestor(t)}hasAnccestor(t){let i=this.parent;for(;i;){if(t===i)return!0;i=i.parent}return!1}countToAccestor(t){let i=0,r=this;for(;r!==t;){if(r===null)return-1;r=r.parent,i+=1}return i}forEachEntity(t){for(let i of this.children)Ku(i)&&t(i)}traverseEntityAncestors(t){this.traverseAncestors(i=>{Fi.is(i)&&t(i)})}traverseConcreteEntity(t,i=0){if(t(this,i)!==!0)for(let r of this.children)Ku(r)&&r.isConcreteEntity&&r.traverseEntity(t,i+1)}traverseEntity(t,i=0){if(t(this,i)!==!0)for(let r of this.children)Ku(r)&&r.traverseEntity(t,i+1)}traverseVisibleEntity(t){t(this);for(let i of this.children)Ku(i)&&i.visible&&i.traverseVisibleEntity(t)}updateMatrix(){super.updateMatrix(),this.cloner&&this.cloner.onObjUpdateMatrix(),this.dispatchEvent({type:"updateMatrix"})}updateMatrixWorld(t){super.updateMatrixWorld(t),this.dispatchEvent({type:"updateMatrixWorld"})}copy(t,i=!1){return super.copy(t,i),this.dataPatched=t.dataPatched,this.raycastLock=t.raycastLock,this.scaleLock=t.scaleLock,this.hiddenMatrix.copy(t.hiddenMatrix),this}hasEntityChild(){return this.children.some(t=>Ku(t))}isAncestorOf(t){if(this.uuid===t)return!1;let i=!1;return this.traverseEntity(r=>{r.uuid===t&&(i=!0)}),i}toObjectTransformState(t=[]){this.updateWorldMatrix(!0,!1);let i={position:this.position.toArray(),rotation:[this.rotation.x*Tt.RAD2DEG,this.rotation.y*Tt.RAD2DEG,this.rotation.z*Tt.RAD2DEG],scale:this.scale.toArray(),hiddenMatrix:this.hiddenMatrix.toArray()};return lz(i,t)}getTransformValues(t,i,r){return i[t].map((n,s)=>(r==null?void 0:r.shared.getVariable(n,[this.uuid,t,G3e[s]]))??n)}updateTransformState(t,i){let r=!1;return t.position&&(this.position.fromArray(this.getTransformValues("position",t,i)),r=!0),t.rotation&&(mR.fromArray(this.getTransformValues("rotation",t,i)).multiplyScalar(Tt.DEG2RAD),this.rotation.setFromVector3(mR),r=!0),t.scale&&(this.scale.fromArray(this.getTransformValues("scale",t,i)),r=!0),t.hiddenMatrix!==void 0&&(r=!0,this.hiddenMatrix.fromArray(t.hiddenMatrix??U0.identity)),r&&(this.updateMatrix(),this.resetBBoxNeedsUpdate(),this.invalidateClonerTransform(this),this.traverseEntityAncestors(n=>{n.invalidateClonerTransform(this)})),t.position&&t.rotation&&t.scale&&t.hiddenMatrix!==void 0&&this.updateWorldMatrix(!1,!0),r}onVariableUpdate(t=!1){if(t){this.resetBBoxNeedsUpdate();return}this.updateMatrix(),this.resetBBoxNeedsUpdate(),this.invalidateClonerTransform(this),this.traverseEntityAncestors(i=>{i.invalidateClonerTransform(this)})}dispose(){this.disposed=!0,this.cloner&&(this.cloner.removeFromParent(),this.cloner=void 0)}disposeChildrenRecursively(){for(let t of this.children)Fi.is(t)&&t.disposeRecursively()}disposeRecursively(){this.dispose(),this.children.forEach(t=>{Fi.is(t)&&t.disposeRecursively()})}toState(t=[]){let i={name:this.name,visible:this.visible,raycastLock:this.raycastLock,...this.toObjectTransformState(t)};return lz(i,t)}updateByObjUpdateOp(t,i){t!==void 0&&this.updateByOp({type:0,props:t,path:[]},{...this.data,...t},i,!1)}updateByOp(t,i,r,n){let s=this.data;this.data=i;let a=t,o=pr(t.path,["states","*"]);if(o!==null){if(t.type===0){let[l]=o;if((this==null?void 0:this.stateSelection)===l){let c={...t.props};if(delete c.name,Object.values(t.props).some(u=>u===void 0)){let u=this.data;if(u!==void 0){let h=Xn.zoom(u,t.path.slice(2));if(h)for(let d in t.props)t.props[d]===void 0&&d in h&&(c[d]=h[d])}}a={...t,props:c,path:t.path.slice(2)}}}}else if(t.type===0){let l=this.stateSelection?this.data.states.data(this.stateSelection):void 0;if(l!==void 0){if(t.props.name!==void 0&&l.name){let{name:u,...h}=l;l=h}if(t.props.material!==void 0&&"material"in l){let{material:u,...h}=l;l=h}let c=Xn.removeOverridden(t.path,t.props,l);a={...t,props:c}}}if(this.updateByPatchedOpBase(a,Wp.patch(this.data,this.stateSelection?this.data.states.data(this.stateSelection):void 0),r),pr(t.path,["overrides"])){let l=[],c=[...t.path];for(l.push(c[1]),c.splice(0,2);c.length>0&&c[0]==="descendants";)l.push(c[1]),c.splice(0,2);if(l[l.length-1]===void 0){if(t.type===0)for(let u of Object.keys(t.props)){l[l.length-1]=u;let h=r.scene.findInstance([this.uuid,...l]);h&&(h.overrideData=t.props[u],h.updateState(af.apply(h.component.data,h.overrideData),r))}}else{let u=r.scene.findInstance([this.uuid,...l]);if(u){let h=Xn.zoom(u.component.data,c);if(t={...t,path:c},t.type===0){let d=t.props;if(h)for(let[f,p]of Object.entries(t.props))p===void 0&&(d===t.props&&(d={...t.props}),d[f]=h[f]);t={...t,props:d}}u.overrideData=FA.resolve(i.overrides,l),u.updateByOp(t,fs.applySimple(u.data,t),r,!1)}}}else if(this.instances.length>0){let l;if(t.path.length===0&&t.type===0){let c;for(let u of Vd.rootOverrideProps)u in t.props&&(c===void 0&&(c={}),c[u]=t.props[u]);c&&(l={...t,props:c})}else for(let c of Vd.rootOverrideProps)if(pr(t.path,[c])){l=t;break}l!==void 0&&this.instances.forEach(c=>{if(c.isInstanceRoot){let u=af.filterOp(c.overrideData,l);u&&c.updateByOp(u,fs.applySimple(c.data,u),r,!0)}}),this.instances.forEach(c=>{if(!c.isInstanceRoot){let u=af.filterOp(c.overrideData,t);if(u){let h;s===c.data&&t===u?h=i:h=fs.applySimple(c.data,u),c.updateByOp(u,h,r,!0)}}})}}updateByPatchedOpBase(t,i,r){if(this.dataPatched=i,t.path.length===0&&t.type===0)t.props.type!==void 0&&!Am.is(t.props.type)&&Hd.changeEntityProptotype(this,i,r);else if(t.path.length===1&&t.path[0]==="geometry"&&t.type===0&&"type"in t.props){Hd.changeEntityProptotype(this,i,r);for(let n of this.children)Fi.is(n)&&n.updateVisible(r.scene)}this.updateByPatchedOp(t,i,r)}updateByPatchedOp(t,i,r){var n;if(t.path.length===0&&t.type===0?this.updateState(t.props,r):t.type===0&&("resolutionLevel"in t.props||"useChildrenColors"in t.props)&&this.updateState(i,r),t.path[0]==="morphTargetInfluences"&&t.type===0){let s=(n=i.morphTargetInfluences.get(t.path[1]))==null?void 0:n.data.name;s&&this.updateMorphInfluences(s,r.shared.getVariable(t.props.value,[this.uuid,"morphTargetInfluences",s]))}if(pr(t.path,["pathSnapping"])!==null&&this.updatePathSnapping(i.pathSnapping),pr(t.path,["cloner"])!==null){let s=fs.drop(t,1);s.path.length===0&&s.type===0&&s.props.disabled===!0?this.setFromClonerState(null,r):this.cloner?this.cloner.updateState(i.cloner,r.scene):(this.setFromClonerState(i.cloner,r),this.expandCloner(r.scene)),this.updateVisible(r.scene)}}updatePathSnapping(t=this.dataPatched.pathSnapping){this._updatedPathSnapping=t,this._needApplyPathSnapping=!0}get updatedPathSnapping(){return this._updatedPathSnapping}applyPathSnapping(t){var p,v,m,g,y;let i=((p=this._updatedPathSnapping)==null?void 0:p.pathId)??this.dataPatched.pathSnapping.pathId,r=((v=this._updatedPathSnapping)==null?void 0:v.slide)??this.dataPatched.pathSnapping.slide??0,n=((m=this._updatedPathSnapping)==null?void 0:m.offset)??this.dataPatched.pathSnapping.offset??0,s=((g=this._updatedPathSnapping)==null?void 0:g.orientation)??this.dataPatched.pathSnapping.orientation;if(i===null)return;let a=t.find(i);if(!a||this._needApplyPathSnapping===!1)return;this._needApplyPathSnapping=!1;let o=a.data;if(o.geometry.path.points.length<=1)return;let l=Hee(o.geometry.path),c=(r+n)%1;r+n===1&&c===0&&(c=1);let u=null;try{u=l.curves.length?l.getPointAt(c):null}catch{}if(u===null)return;let h=this.parent?(y=this.parent)==null?void 0:y.matrixWorld:new ft;a.updateMatrixWorld();let d=new ft().multiplyMatrices(h.clone().invert(),a.matrixWorld);u.applyMatrix4(d);let f={position:u.toArray(),rotation:o.rotation};if(s==="tangential"){let x=new ft().extractRotation(a.matrixWorld),_=l.getTangentAt(c).applyMatrix4(x).add(u),M=new ft().lookAt(u,_,H3e),S=mR.setFromEuler(new Wn().setFromRotationMatrix(M)).multiplyScalar(Tt.RAD2DEG);f={...f,rotation:S.toArray()}}this.updateTransformState(f),this.traverseEntity(x=>{x._cameraType&&x.dispatchEvent(V3e)})}updateVisible(t){var r;if(this.visible=this.dataPatched.visible&&(!this.dataPatched.cloner||(this.dataPatched.cloner.disabled??!1)||((r=this.dataPatched.cloner)==null?void 0:r.hideBase)!==!0),!t)return;let i=!1;this.traverseEntity(n=>{if(n.data.type==="Splat")return i=!0,!0}),i&&t.reloadSplats()}updateState_Entity(t,i){t.name!==void 0&&(this.name=t.name),t.raycastLock!==void 0&&(this.raycastLock=t.raycastLock),t.visible!==void 0&&(this.updateVisible(i==null?void 0:i.scene),this.resetBBoxNeedsUpdate()),i&&"cloner"in t&&t.cloner!==void 0&&(this.setFromClonerState(t.cloner,i),this.updateVisible(i.scene)),this.updateTransformState(t,i)}get attachedSurfaceCloners(){return this.children.filter(t=>t instanceof Hd.Cloner&&t.parameters.type==="toObject")}setFromClonerState(t,i){this.disposed||(t===null||t.disabled?(this.cloner&&this.cloner.removeFromParent(),this.cloner=void 0):this.cloner===void 0?(this.cloner=new Hd.Cloner(this,t),i.scene.addPendingExpandCloner(this)):this.cloner.updateState(t,i.scene))}expandCloner(t){!this.disposed&&this.cloner&&this.cloner.expandClones(t)}invalidateClonerTransform(t){this.cloner&&this.cloner.invalidateTransform(t)}requestRender(){this.dispatchEvent({type:"requestRender"})}},jee=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var l,c;let i=(l=e.parameters)==null?void 0:l.radiusTop,r=(c=e.parameters)==null?void 0:c.radiusBottom,n=Object.assign({},(t==null?void 0:t.parameters)??{width:100,radialSegments:64,heightSegments:1,openEnded:!1,thetaStart:0,thetaLength:360,cornerRadius:8,cornerSegments:8,hollow:0},e.parameters);n.thetaLength=Tt.clamp(n.thetaLength,0,360);let s=n.width/2,a=n.radiusTop??s,o=n.radiusBottom??s;if(a===o?(a=s,o=s):a>o?(a=s,o=o*s/a):(a=a*s/o,o=s),n.shapeBlendNode){a=i??s,o=r??s;let u=Math.max(a,o)*2;n.width=u,n.depth=u}return{parameters:Object.assign(n,{width:Math.abs(n.width),height:Math.abs(n.height??n.width),depth:Math.abs(n.depth??n.width),radiusTop:a,radiusBottom:o})}}static build(e){let{width:t,depth:i,height:r,radialSegments:n,heightSegments:s,openEnded:a,thetaStart:o,thetaLength:l,radiusTop:c,radiusBottom:u,cornerRadius:h,cornerSegments:d,hollow:f}=e.parameters,p;return l===0?(p=new Nt,p.setAttribute("position",new _t([],3))):h||f?p=new Wee(c,u,r,n,s,a,o,l*Math.PI/180,h,h,d,f):p=new sN(c,u,r,n,s,a,o,l*Math.PI/180),p.scale(1,1,i/t),Object.assign(p,{userData:{...e,type:"CylinderGeometry"}})}};function sd(e,t,i){i.x=e.x*t.x,i.y=e.y,i.z=e.x*t.y}function dW(e){return new Me(e.y,-e.x)}var Wee=class extends Nt{constructor(e,t,i,r,n,s,a,o,l,c,u,h,d=!1){super(),this.type="RoundedCylinderBufferGeometry",e=e!==void 0?e:1,t=t!==void 0?t:1,i=i||1,r=Math.floor(r)||8,n=Math.floor(n)||1,s=s!==void 0?s:!1,a=a!==void 0?a:0,o=o!==void 0?o:Math.PI*2,s&&(l=0,c=0);let f=[],p=[],v=[],m=[],g=0,y=i/2,x=new N,_=new N;d&&e==0&&(e=l),d&&t==0&&(t=c);let M=new Me(e,y),S=new Me(t,-y),T=null,E=null,C=null,A=null,D=M.clone().sub(S),R=0,L=0,O=0;h>0&&(R=Math.min(e,t)*(1-h),L=e-R,O=t-R);let H=M.clone();H.x-=R;let j=Math.PI-D.angle(),Y=D.angle(),z=Math.tan(Y/2),V=Math.tan(j/2),U=z+V,k=h?U:V,X=h?U:z;if(l=Math.min(l,(e-L)/k,D.length()/U),c=Math.min(c,(t-O)/X,D.length()/U),l>0){let ce=l/z;T=M.clone().sub(new Me(ce,l)),h&&(C=T.clone(),C.x-=R-U*l),M.sub(D.clone().setLength(ce))}if(c>0){let ce=c/V;E=S.clone().sub(new Me(ce,-c)),S.add(D.clone().setLength(ce)),h&&(A=E.clone(),A.x-=R-U*c,H.sub(D.clone().setLength(ce)))}D=M.clone().sub(S);let re=D.length()<.5,q=[];for(let ce=0;ce<=r;ce++){let pe=[],ge=ce/r,we=ge*o+a,le=new Me(Math.sin(we),Math.cos(we));A&&E?(ee(pe,ge,le,j,c,A,-1,!0),ee(pe,ge,le,Y,c,E,-1,!1)):E?($(pe,le,E.x,0,-1),ee(pe,ge,le,Y,c,E,-1,!1)):s||$(pe,le,t,O,-1);let ve=dW(D).normalize();if(sd(ve,le,x),!re)for(let ie=0;ie<=n;ie++){let Ce=ie/n,Pe=D.clone().multiplyScalar(Ce).add(S);sd(Pe,le,_),p.push(_.x,_.y,_.z),v.push(x.x,x.y,x.z),m.push(ge,.5+_.y/i),pe.push(g++)}if(C&&T?(ee(pe,ge,le,j,l,T,1,!1),ee(pe,ge,le,Y,l,C,1,!0)):T?(ee(pe,ge,le,j,l,T,1,!1),$(pe,le,T.x,0,1)):s||$(pe,le,e,L,1),h&&!re){let ie=dW(D).multiplyScalar(-1).normalize();sd(ie,le,x);for(let Ce=0;Ce<=n;Ce++){let Pe=Ce/n,Ne=D.clone().multiplyScalar(-Pe).add(H);sd(Ne,le,_),p.push(_.x,_.y,_.z),v.push(x.x,x.y,x.z),m.push(ge,.5+_.y/i),pe.push(g++)}}h&&!s&&pe.push(pe[0]),q.push(pe)}for(let ce=0;ce<q.length-1;ce++)for(let pe=0;pe<q[0].length-1;pe++){if(s&&h&&pe==n)continue;let ge=q[ce][pe],we=q[ce+1][pe],le=q[ce+1][pe+1],ve=q[ce][pe+1],ie=p[le*3+0],Ce=p[le*3+2];f.push(ge,we,ve),(ie!=0||Ce!=0)&&f.push(we,le,ve)}o<Math.PI*2&&(ne(-1,q[0],a),ne(1,q[q.length-1],a+o)),this.setIndex(f),this.setAttribute("position",new _t(p,3)),this.setAttribute("normal",new _t(v,3)),this.setAttribute("uv",new _t(m,2));function ee(ce,pe,ge,we,le,ve,ie,Ce){for(let Pe=0;Pe<u+1;Pe++){let Ne=Pe/u,be=ie<0?Ne:1-Ne;Ce&&(be-=1),be*=we;let Le=new Me(Math.sin(be),Math.cos(be)*ie),Fe=Le.clone().multiplyScalar(le).add(ve);sd(Fe,ge,_),p.push(_.x,_.y,_.z),sd(Le,ge,x),v.push(x.x,x.y,x.z),m.push(pe,.5+_.y/i),ce.push(g++)}}function $(ce,pe,ge,we,le){let ve=new N,ie=new Me,Ce=[ge,we];le<0&&Ce.reverse();for(let Pe of Ce)ie.set(Pe,y*le),sd(ie,pe,ve),p.push(ve.x,ve.y,ve.z),v.push(0,le,0),m.push(.5,.5),ce.push(g++)}function ne(ce,pe,ge){let we=new Me(Math.sin(ge),Math.cos(ge)),le=new Me(-Math.cos(ge),Math.sin(ge)),ve=new N,ie=ce<0?(Ne,be,Le)=>f.push(Ne,be,Le):(Ne,be,Le)=>f.push(Ne,Le,be),Ce=new Me((e+t+L+O)/4,0);sd(Ce,we,ve),p.push(ve.x,ve.y,ve.z),v.push(le.x,0,le.y),m.push(.5,.5);let Pe=g++;for(let Ne of pe){let be=p.slice(Ne*3,Ne*3+3);p.push(...be),v.push(le.x,0,le.y);let Le=m.slice(Ne*2,Ne*2+2);m.push(...Le),g++}for(let Ne=Pe+1;Ne<g-1;Ne++)ie(Pe,Ne,Ne+1);ie(Pe,g-1,Pe+1)}}},j3e=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,radialSegments:32,heightSegments:8,openEnded:!1,thetaStart:0,thetaLength:360,cornerRadiusTop:8,cornerRadiusBottom:8,cornerSegments:8},e.parameters);return i.thetaLength=Tt.clamp(i.thetaLength,0,360),{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,depth:i,height:r,radialSegments:n,heightSegments:s,openEnded:a,thetaStart:o,thetaLength:l,cornerRadiusTop:c,cornerRadiusBottom:u,cornerSegments:h}=e.parameters,d;return l===0?(d=new Nt,d.setAttribute("position",new _t([],3))):c>0||u>0||l<360?d=new Wee(0,t/2,r,n,s,a,o,l*Math.PI/180,c,u,h,0,!0):d=new aN(t/2,r,n,s,a),d.scale(1,1,i/t),Object.assign(d,{userData:{...e,type:"ConeGeometry"}})}},W3e=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,widthSegments:1,heightSegments:1,depthSegments:1,cornerRadius:8,cornerSegments:8},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,height:i,depth:r,widthSegments:n,heightSegments:s,depthSegments:a,cornerRadius:o,cornerSegments:l}=e.parameters,c;return o===0?c=new ac(t,i,r,n,s,a):c=new X3e(t,i,r,n,s,a,o,l),Object.assign(c,{userData:{...e,type:"CubeGeometry"}})}},gR=Math.PI/2,X3e=class extends Nt{constructor(e=1,t=1,i=1,r=1,n=1,s=1,a=0,o=4){super(),this.type="BoxGeometry",r=Math.floor(r),n=Math.floor(n),s=Math.floor(s),o=Math.floor(o),a=Math.min(a,e/2,t/2,i/2);let l=[],c=[],u=[],h=[],d=0;f("z","y","x",-1,-1,i,t,e,s,n),f("z","y","x",1,-1,i,t,-e,s,n),f("x","z","y",1,1,e,i,t,r,s),f("x","z","y",1,-1,e,i,-t,r,s),f("x","y","z",1,-1,e,t,i,r,n),f("x","y","z",-1,-1,e,t,-i,r,n),a>0&&(p("z","y","x",-1,-1,1,i,t,e,s),p("z","y","x",1,-1,-1,i,t,e,s),p("z","y","x",-1,1,-1,i,t,e,s),p("z","y","x",1,1,1,i,t,e,s),p("x","y","z",-1,-1,-1,e,t,i,r),p("x","y","z",1,-1,1,e,t,i,r),p("x","y","z",-1,1,1,e,t,i,r),p("x","y","z",1,1,-1,e,t,i,r),p("y","x","z",-1,-1,1,t,e,i,n),p("y","x","z",1,-1,-1,t,e,i,n),p("y","x","z",1,1,1,t,e,i,n),p("y","x","z",-1,1,-1,t,e,i,n),v(1,1,1),v(-1,1,1),v(1,-1,1),v(-1,-1,1),v(1,1,-1),v(-1,1,-1),v(1,-1,-1),v(-1,-1,-1)),this.setIndex(l),this.setAttribute("position",new _t(c,3)),this.setAttribute("normal",new _t(u,3)),this.setAttribute("uv",new _t(h,2));function f(m,g,y,x,_,M,S,T,E,C){let A=(M-2*a)/E,D=(S-2*a)/C,R=M/2-a,L=S/2-a,O=T/2,H=E+1,j=C+1,Y=0,z=new N;for(let V=0;V<j;V++){let U=V*D-L;for(let k=0;k<H;k++){let X=k*A-R;z[m]=X*x,z[g]=U*_,z[y]=O,c.push(z.x,z.y,z.z),z[m]=0,z[g]=0,z[y]=T>0?1:-1,u.push(z.x,z.y,z.z),h.push(k/E),h.push(1-V/C),Y+=1}}for(let V=0;V<C;V++)for(let U=0;U<E;U++){let k=d+U+H*V,X=d+U+H*(V+1),re=d+(U+1)+H*(V+1),q=d+(U+1)+H*V;l.push(k,X,q),l.push(X,re,q)}d+=Y}function p(m,g,y,x,_,M,S,T,E,C){let A=(S-2*a)/C,D=S/2-a,R=T/2-a,L=E/2,O=C+1,H=0,j=new N,Y=new N;for(let z=0;z<o+1;z++){let V=z/o*gR,U=Math.sin(V)*a,k=(1-Math.cos(V))*a,X=Math.sin(V),re=Math.cos(V);j[g]=(R+U)*_,j[y]=(L-k)*M,Y[m]=0,Y[g]=X*Math.sign(j[g]),Y[y]=re*Math.sign(j[y]);for(let q=0;q<O;q++){let ee=q*A-D;j[m]=ee*x,c.push(j.x,j.y,j.z),u.push(Y.x,Y.y,Y.z),h.push(q/C),h.push(0),H+=1}}for(let z=0;z<o;z++)for(let V=0;V<C;V++){let U=d+V+O*z,k=d+V+O*(z+1),X=d+(V+1)+O*(z+1),re=d+(V+1)+O*z;l.push(U,k,re),l.push(k,X,re)}d+=H}function v(m,g,y){let x=new N,_=new N(e/2,t/2,i/2);_.subScalar(a);let M=[],S=m*g*y>0?(E,C,A)=>l.push(E,C,A):(E,C,A)=>l.push(E,A,C);for(let E=0;E<=o;E++){let C=[],A=gR*(1-E/o),D=Math.cos(A),R=Math.sin(A),L=0;for(let O=0;O<=E;O++){let H=Math.cos(L),j=Math.sin(L);x.x=D*H,x.y=R,x.z=D*j;let Y=_.clone().addScaledVector(x,a);c.push(m*Y.x,g*Y.y,y*Y.z),u.push(m*x.x,g*x.y,y*x.z),h.push(0,0),C.push(d++),L+=gR/E}M.push(C)}let T=M.length-1;for(let E=0;E<T;E++){let C=M[E],A=M[E+1],D=C.length-1;S(C[0],A[1],A[0]);for(let R=1;R<=D;R++)S(C[R-1],C[R],A[R]),S(C[R],A[R+1],A[R])}}}},GN=class extends Nt{constructor(e=[],t=[],i="",r=1,n=.2,s=4){super(),this.type="PolyhedronGeometryRound";let a=[],o=[],l=[];c(),u(),this.setAttribute("position",new _t(a,3)),this.setAttribute("normal",new _t(l,3)),this.setAttribute("uv",new _t(o,2));return;function c(){var Y;n=Math.min(1-1e-5,n),n==0&&(s=0);let h={IcosahedronGeometry:5,DodecahedronGeometry:3,HexahedronGeometry:3,OctahedronGeometry:4,TetrahedronGeometry:3}[i],d=new N,f=d.clone(),p=new Rs,v=n*r,m=r-v,g=s+1,y=new N,x=(z,V)=>y.subVectors(z,V).normalize(),_=(z,V)=>Array(z).fill(void 0).map(V),M=_(e.length/3,(z,V)=>new N().fromArray(e,V*3).setLength(r)),S=[],T=1e6;for(let z=0;z<M.length;z++){let V=M[z],U=[],k,X,re,q=1e10,ee=-1;for(;(ee=t.indexOf(z,ee+1))!=-1;){let pe=ee-ee%3;k=t[pe+(ee+1)%3],X=t[pe+(ee+2)%3],re=V.distanceToSquared(M[k]),q=Math.min(q,re),U.push([k,X,re])}q+=1e-6;let $=[],ne=0,ce=U.length;for(let pe=0;pe<ce;pe++){[k,X,re]=U[ne];let ge=((Y=S[k])==null?void 0:Y.includes(z))==!0;re<=q&&$.push(k+ +ge*T),ne=U.findIndex(we=>we[0]==X)}S.push($)}let E=[];{let z=0,V=0,U,k,X=h==3;for(let re=0;re<=s;re++){U=re*(re+1)/2,k=(re+1)*(re+2)/2;for(let q=0;q<s-re;q++)[z,V]=[U+q+re+2,k+q+re+3],E.push(U,k,...X?[V,U]:[z,k],V,z),[U,k]=[z,V];E.push(U,k,U+s+2)}}let C=d.clone(),A=d.clone(),D=d.clone(),R=d.clone(),L=d.clone(),O=[],H=_(M.length,()=>_(h,()=>d.clone()));for(let z=0;z<M.length;z++){d.copy(M[z]).normalize(),C.copy(d).multiplyScalar(m);let V=S[z];for(let $=0;$<V.length;$++){let ne=V[$],ce=V[($+1)%h];p.setFromPointsAndIndices(M,z,ne%T,ce%T),p.b.sub(p.a).setLength(1e10).add(p.a),p.c.sub(p.a).setLength(1e10).add(p.a),p.closestPointToPoint(C,H[z][$])}let U=[],k=[],X=[],re=new N;s==0&&[...H[z]].reduce(($,ne)=>$.add(ne),re).multiplyScalar(1/h);for(let $=0;$<h;$++){let ne=[],ce=($-1+h)%h,pe=H[z][ce],ge=H[z][$];d.copy(pe).sub(C),f.copy(ge).sub(C);let we=C.angleTo(d),le=d.angleTo(f),ve=Math.cos(we)*v;s==0?A.copy(re):A.copy(C).setLength(m+ve),k.push(ve);let ie=[A,pe,ge];for(let Ce=0;Ce<2;Ce++){let Pe=ie[Ce],Ne=ie[Ce+1];R.subVectors(Pe,C),L.subVectors(Ne,C),D.crossVectors(R,L).normalize();for(let be=0;be<g;be++){let Le=[we,le][Ce]*be/g;d.copy(R).applyAxisAngle(D,Le).add(C),U.push(d.clone()),Ce&&(x(d,C),ne.push([be==0?Pe:d.clone(),y.clone()]))}Ce&&(x(Ne,C),ne.push([Ne,y.clone()]))}X.push(ne)}O.push(X);let q=2*g,ee=2;for(let $=0;$<h;$++){let ne=q*$,ce=q*(($+1)%h),pe=[U[ne]];for(let we=1;we<g;we++){R=U[ne+we],L=U[ce+we],pe.push(R);for(let le=1,ve=we-ee+1;le<=ve;le++)d.lerpVectors(R,L,le/(ve+1)),d.sub(C).setLength(k[$]).add(C),pe.push(d.clone());pe.push(L)}for(let we=0;we<g;we++)pe.push(U[we+g+ne]);pe.push(U[ce+g]);let ge=E.map(we=>pe[we]);a.push(...ge.map(we=>[we.x,we.y,we.z]).flat()),l.push(...ge.map(we=>(x(we,C),[y.x,y.y,y.z])).flat())}}let j=[];for(let z=0;z<S.length;z++)for(let V=0;V<h;V++){let U=S[z][V];if(U<T){let k=S[U].findIndex(q=>q%T==z),X=O[z][V],re=O[U][k];for(let q=0;q<g;q++){let ee=X[q],$=re[g-q],ne=X[q+1],ce=re[g-(q+1)];[ee,$,ne,ne,$,ce].forEach(pe=>{a.push(pe[0].x,pe[0].y,pe[0].z),l.push(pe[1].x,pe[1].y,pe[1].z)})}j.push(X[0][0],re[g][0],X[g][0],re[0][0])}}for(;j.length;){let z,V,U,k;[z,V]=j.splice(0,2);let X=[z];for(;z!=V;)X.push(V),U=j.indexOf(V),k=U%2,V=j.splice(U-k,2)[1-k];y.subVectors(X[0],X[1]).cross(d.subVectors(X[0],X[2])).normalize();let re=y.dot(X[0])<0;re&&y.negate();for(let q=1;q<=X.length-2;q++)[X[q+ +re],X[q+1-+re],X[0]].forEach(ee=>{a.push(ee.x,ee.y,ee.z),l.push(y.x,y.y,y.z)})}}function u(){let h=new N;for(let S=0;S<a.length;S+=3){h.x=a[S+0],h.y=a[S+1],h.z=a[S+2];let T=_(h)/2/Math.PI+.5,E=M(h)/Math.PI+.5;o.push(T,1-E)}let d=new N,f=new N,p=new N,v=new N,m=new Me,g=new Me,y=new Me,x=(S,T,E,C)=>{C<0&&S.x===1&&(o[T]=S.x-1),E.x===0&&E.z===0&&(o[T]=C/2/Math.PI+.5)};for(let S=0,T=0;S<a.length;S+=9,T+=6){d.set(a[S+0],a[S+1],a[S+2]),f.set(a[S+3],a[S+4],a[S+5]),p.set(a[S+6],a[S+7],a[S+8]),m.set(o[T+0],o[T+1]),g.set(o[T+2],o[T+3]),y.set(o[T+4],o[T+5]),v.copy(d).add(f).add(p).divideScalar(3);let E=_(v);x(m,T+0,d,E),x(g,T+2,f,E),x(y,T+4,p,E)}for(let S=0;S<o.length;S+=6){let T=o[S+0],E=o[S+2],C=o[S+4],A=Math.max(T,E,C),D=Math.min(T,E,C);A>.9&&D<.1&&(T<.2&&(o[S+0]+=1),E<.2&&(o[S+2]+=1),C<.2&&(o[S+4]+=1))}function _(S){return Math.atan2(S.z,-S.x)}function M(S){return Math.atan2(-S.y,Math.sqrt(S.x*S.x+S.z*S.z))}}}static fromJSON(e){return new GN(e.vertices,e.indices,e.radius,e.corner,e.cornerSides)}},q3e=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,detail:0,corner:0,cornerSides:4},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,height:i,depth:r,detail:n,corner:s,cornerSides:a}=e.parameters,o=n===0&&s!==0?new Xee(t*.5,s,a):new $J(t*.5,n);return o.scale(1,i/t,r/t),Object.assign(o,{userData:{...e,type:"DodecahedronGeometry"}})}},Xee=class extends GN{constructor(e=1,t=.2,i=4){let r=(1+Math.sqrt(5))/2,n=1/r,s=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-r,0,-n,r,0,n,-r,0,n,r,-n,-r,0,-n,r,0,n,-r,0,n,r,0,-r,0,-n,r,0,-n,-r,0,n,r,0,n],a=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],o="DodecahedronGeometry";super(s,a,o,e,t,i),this.type=o}static fromJSON(e){return new Xee(e.radius,e.corner,e.cornerSides)}},b1=1e-12,HN=class{constructor(e){this.position=new Me,this.startPosition=new Me,this.uuid=Tt.generateUUID(),this.position=e.clone()}start(){this.reset()}reset(){this.startPosition.copy(this.position)}applyOffset(e){this.position.copy(this.startPosition).add(e)}copy(e){return this.position.copy(e.position),this.startPosition.copy(e.startPosition),this}clone(){return new HN(this.position).copy(this)}toJSON(){return[this.position.x,this.position.y]}},iB=class extends HN{constructor(e){super(e.position),this.parent=e}copy(e){return super.copy(e),this}clone(){return new iB(this.parent).copy(this)}},d0=class extends HN{constructor(e,t){super(t),this.controls=[],this.roundness=0,this.areControlsDirectionsMirrored=!0,this.uuid=e,this.controls.push(new iB(this),new iB(this))}static create(e,t){let i=new d0(e,new Me(...t.position));return i.controls[0].position.set(...t.controlPrevious.position),i.controls[1].position.set(...t.controlNext.position),i.roundness=t.roundness,i.areControlsDirectionsMirrored=t.areControlsDirectionsMirrored,i}getOppositeControl(e){let t=this.controls.indexOf(e);return t===0?this.controls[1]:t===1?this.controls[0]:null}applyOffsetToControls(e,t=1){for(let i=0,r=this.controls.length;i<r;i++){let n=this.controls[i];this.position.distanceTo(n.position)<=t?n.position.copy(this.position):n.applyOffset(e)}}controlsMoved(){return!(this.position.equals(this.controls[0].position)&&this.position.equals(this.controls[1].position))}copy(e){return super.copy(e),this.controls[0].copy(e.controls[0]),this.controls[1].copy(e.controls[1]),this.roundness=e.roundness,this.uuid=e.uuid,this}clone(){return new d0(this.uuid,this.position).copy(this)}toJSON(){return super.toJSON().concat(this.controls[0].toJSON(),this.controls[1].toJSON(),[this.roundness])}computeTangents(){var i,r;let e=(i=this.curveBefore)==null?void 0:i.getTangentAt(1),t=(r=this.curveAfter)==null?void 0:r.getTangentAt(0);return[e,t]}computeNormals(e=new Me,t=new Me){let[i,r]=this.computeTangents();return i&&r&&(fW(i,e),fW(r,t)),[e,t]}computeTangent(e=new Me){let[t,i]=this.computeTangents();return t&&i&&e.copy(t).add(i).normalize(),e}computeNormal(e=new Me){let[t,i]=this.computeNormals();return e.copy(t).add(i).normalize(),e}};function fW(e,t=new Me){let i=e.length();return t.set(-e.y/i,e.x/i)}var jN=e=>e,yy=new Me,GC=new Me,Y3e=new Me,Q3e=new Me,Z3e=new Me,K3e=new Me,qee=new N,Yee=new N;function J3e(e){let t=new Me;t.addVectors(e.v0,yy.subVectors(e.v1,e.v0).multiplyScalar(2/3));let i=new Me;return i.addVectors(e.v2,GC.subVectors(e.v1,e.v2).multiplyScalar(2/3)),new Zl(e.v0,t,i,e.v2)}function lx(e,t,i=Number.EPSILON){return Math.abs(e-t)<i}function $3e(e,t,i=Number.EPSILON){return e.distanceTo(t)<i}function eDe(e,t,i=Number.EPSILON){return e.distanceTo(t)<i}function Qee(e,t,i){let r=Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)),n=Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2)),s=Math.sqrt(Math.pow(i.x-e.x,2)+Math.pow(i.y-e.y,2));return Math.acos((n*n+r*r-s*s)/(2*n*r))}function tDe(e,t,i){return mW(e,t)&&mW(t,i)&&rB(e.position,t.position,i.position)}function rB(e,t,i){return yy.copy(t).sub(e).cross(GC.copy(i).sub(e))===0}function iDe(e,t,i,r,n){let s=Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)),a=(e.y+t.y)/2,o=(e.x+t.x)/2,l=Math.sqrt(Math.pow(i,2)-Math.pow(s/2,2))*(e.y-t.y)/s,c=Math.sqrt(Math.pow(i,2)-Math.pow(s/2,2))*(t.x-e.x)/s;return r.set(o+l,a+c),n.set(o-l,a-c),[r,n]}function rDe(e,t,i){let r=e.distanceTo(i),n=t.distanceTo(i);return r<n?t:e}function nDe(e,t,i,r,n,s){let a=t.x-e.x,o=t.y-e.y,l=i.x-e.x,c=i.y-e.y,u=Math.sqrt((a+l)*(a+l)+(o+c)*(o+c)),h;return Qee(t,e,i)>Math.PI&&(u*=-1),lx(c,o)?h=(o+c)*(r/u-.5)*8/3/(a-l):h=(a+l)*(r/u-.5)*8/3/(c-o),n.set(t.x-h*o,t.y+h*a),s.set(i.x+h*c,i.y-h*l),[n,s]}function pW(e,t){return e.position.equals(e.controls[1].position)&&t.position.equals(t.controls[0].position)}function mW(e,t){return rB(e.position,e.controls[1].position,t.position)&&rB(e.position,t.controls[0].position,t.position)}function sDe(e,t,i,r,n=.5){let s=yy.subVectors(t,e).multiplyScalar(n).add(e),a=GC.subVectors(i,t).multiplyScalar(n).add(t),o=Y3e.subVectors(r,i).multiplyScalar(n).add(i),l=s,c=Q3e.subVectors(a,s).multiplyScalar(n).add(s),u=Z3e.subVectors(o,a).multiplyScalar(n).add(a),h=o,d=K3e.subVectors(u,c).multiplyScalar(n).add(c);return[e.x,e.y,l.x,l.y,c.x,c.y,d.x,d.y,u.x,u.y,h.x,h.y,r.x,r.y]}function aDe(e,t,i=12,r=!0){let n=Yee.set(0,0,0),s,a=0;for(let o=0;o<t.length;o++){let l=jN(t[o]),c=yy,u=um(l,i);for(let h=0;h<=u;h++)if(l instanceof Zl||l instanceof gf||l instanceof ic){if(l.getPoint(h/u,c),n.set(c.x,c.y,0),s!==void 0&&eDe(s,n))continue;s===void 0&&(s=qee),s.copy(n),e.setXYZ(a,n.x,n.y,n.z),a++}}return r&&a>1&&!(e.getX(a-1)===e.getX(0)&&e.getY(a-1)===e.getY(0)&&e.getZ(a-1)===e.getZ(0))&&(e.setXYZ(a,e.getX(0),e.getY(0),e.getZ(0)),a++),e}function oDe(e,t,i,r=12,n=!0){let s=Yee.set(0,0,0),a=0,o=[];for(let l=0;l<t.length;l++){if(i[l]===!1)continue;let c,u=jN(t[l]),h=yy,d=um(u,r);o.push(d);for(let f=0;f<=d;f++)if(u instanceof Zl||u instanceof gf||u instanceof ic){if(u.getPoint(f/d,h),s.set(h.x,h.y,0),c==null?void 0:c.equals(s))continue;c===void 0?c=qee:(e.setXYZ(a,c.x,c.y,c.z),a++,e.setXYZ(a,s.x,s.y,s.z),a++),c.copy(s)}}return n&&a>1&&!(e.getX(a-1)===e.getX(0)&&e.getY(a-1)===e.getY(0)&&e.getZ(a-1)===e.getZ(0))&&(e.setXYZ(a,e.getX(0),e.getY(0),e.getZ(0)),a++),o}function gW(e,t=12,i=!1){let r=[];for(let n=0,s=e.length;n<s;n++){let a=e[n],o=0;if(i&&a.roundedCurveCorner!==void 0){let l=um(a.roundedCurveCorner,t)*.5;n>0&&(r[n-1]+=l),o+=l}a.curveAfter!==void 0&&(o+=um(a.curveAfter,t)),r.push(o)}return e.length>0&&i&&e[0].roundedCurveCorner!==void 0&&(r[e.length-1]+=um(e[0].roundedCurveCorner,t)*.5),r}function um(e,t=12){return e&&e instanceof TC?t*2:e&&(e instanceof ic||e instanceof ZJ)?1:e&&e instanceof nN?t*e.points.length:t}function lDe(e,t,i=12,r=!0){let n,s=0;for(let a=0;a<t.length;a++){let o=jN(t[a]),l=um(o,i),c=yy;for(let u=0;u<=l;u++)if(o instanceof Zl||o instanceof gf||o instanceof ic){if(o.getPoint(u/l,c),n!==void 0&&$3e(n,c,b1))continue;n===void 0&&(n=GC),n.copy(c),e.push(c.x,c.y),s++}}return lx(e[0],e[e.length-2],b1)&&lx(e[1],e[e.length-1],b1)&&(e.pop(),e.pop()),r&&s>1&&!(lx(e[s-1],e[1],b1)&&lx(e[s-2],e[0],b1))&&(e.push(e[0],e[1]),s++),e}var vR=new Me,cDe=new Me,uDe=new Me,hDe=new Me,dDe=new Me,fDe=new Me,tn=class extends hA{constructor(e=100,t=100){super(),this.points=[],this.shapeHoles=[],this.plane=new Ka(new N(0,0,-1)),this.subdivision=0,this.controlSnapDistance=4,this.pointIDs=0,this.isMesh2D=!1,this.isText=!1,this._roundness=0,this.isClosed=!1,this.useCubicForRoundedCorners=!0,this.uuid=Tt.generateUUID(),this.needsUpdate=!1,this.roundedCurves=[],this._width=e,this._height=t}static createFromState(e,t,i){let r=new tn;return r.isClosed=e.isClosed,r.points=e.points.map(n=>d0.create(n.id,n.data)),typeof e.roundness=="number"&&(r.roundness=e.roundness),r.shapeHoles=e.shapeHoles.map(n=>tn.createFromState(n)),t!==void 0&&i!==void 0&&r.applySize(t,i),r.update(),r}get width(){return this._width}get height(){return this._height}get roundness(){return this._roundness}set roundness(e){if(this._roundness!==e){this._roundness=e;for(let t=0,i=this.points.length;t<i;t++)this.points[t].roundness=e;this.needsUpdate=!0}}getPointsIndexesByIds(e){return e.map(t=>this.getPointIndexById(t)).filter(t=>t>=0)}getPointIndexById(e){let t=this.points.length,i=this.points.findIndex(r=>r.uuid===e);if(i<0){let r=t;for(let n=0,s=this.shapeHoles.length;n<s;n++){let a=this.shapeHoles[n],o=a.points.length,l=a.getPointIndexById(e);if(l<0)r+=o;else return l+r}}return i}getLineIndexById(e){return this.getPointIndexById(e)}getBezierPoint(e){if(e<=this.points.length-1)return this.points[e];if(this.shapeHoles.length>0){let t=this.points.length;for(let i=0,r=this.shapeHoles.length;i<r;i++){let n=this.shapeHoles[i],s=e-t;if(s<=n.points.length-1)return n.points[s];t+=n.points.length}}throw new Error("This shape does not have a point for this index: "+e)}getBezierPointIndex(e){let t=this.points.indexOf(e);if(t>=0)return t;if(t=this.points.length,this.shapeHoles.length>0)for(let i=0,r=this.shapeHoles.length;i<r;i++){let n=this.shapeHoles[i],s=n.points.indexOf(e);if(s>=0)return t+s;t+=n.points.length}return-1}getAllPoints(){let e=[].concat(...this.shapeHoles.map(t=>t.points));return[...this.points,...e]}applySize(e,t){e===0&&(e=.001),t===0&&(t=.001),this._width=e,this._height=t}applyScale(e,t){let i=vR.set(e,t);for(let r=0,n=this.points.length;r<n;r++){let s=this.points[r];s.position.multiply(i),s.controls[0].position.multiply(i),s.controls[1].position.multiply(i)}for(let r=0,n=this.shapeHoles.length;r<n;r++)this.shapeHoles[r].applyScale(e,t);this._update()}createPoint(e,t=0,i=Tt.generateUUID()){let r;e instanceof Me?r=e:r=new Me(e,t);let n=new d0(i,r);return n.roundness=this.roundness,n}addPoint(e){this.points.push(e),this.needsUpdate=!0}addPointAt(e,t){this.points.splice(t,0,e),this.needsUpdate=!0}getPointByUuid(e){for(let t=0,i=this.points.length;t<i;t++){let r=this.points[t];if(r.uuid===e)return r}for(let t=0,i=this.shapeHoles.length;t<i;t++){let r=this.shapeHoles[t].getPointByUuid(e);if(r)return r}}getFirstPoint(){return this.points[0]}getLastPoint(){return this.points[this.points.length-1]}removePoint(e){let t=this.points.indexOf(e);t>=0&&this.points.splice(t,1),this.needsUpdate=!0}removePointById(e){let t=this.points.find(i=>i.uuid===e);t&&this.removePoint(t)}update(){for(let e=0,t=this.shapeHoles.length;e<t;e++)this.shapeHoles[e].update();this._update()}extractShapePointsToBuffer(e,t=12,i=!1){this.subdivision=t,this.curveDivisions===void 0&&this.computeCurveDivisions(t);let r=i?this.roundedCurveDivisions:this.curveDivisions;return aDe(e,i?this.roundedCurves:this.curves,t,this.autoClose),r.reduce((n,s)=>n+s,0)+1}computeCurveDivisions(e=12){return this.curveDivisions=gW(this.points,e,!1),this.roundedCurveDivisions=gW(this.points,e,!0),this.curveDivisions}extractFilteredShapePointsToBuffer(e,t,i=12){return oDe(e,this.curves,t,i,this.autoClose).reduce((r,n)=>r+n,0)*2}extractShapePointsToFlatArray(e,t=12){return this.subdivision=t,this.curveDivisions===void 0&&this.computeCurveDivisions(t),lDe(e,this.roundedCurves,t,this.autoClose)}getCurveIndexFromVertexId(e,t=!1){let i=0;this.curveDivisions===void 0&&this.computeCurveDivisions(this.subdivision);let r=t?this.roundedCurveDivisions:this.curveDivisions,n=0;t&&this.points[0].roundedCurveCorner!==void 0&&(n=um(this.points[0].roundedCurveCorner,this.subdivision)*.5);let s=e-n;s<0&&(s+=r.reduce((a,o)=>a+o,0));for(let a=0,o=r.length;a<o;a++){let l=r[a];if(s<i+l)return[a,(s-i+1)/l];i+=l}return[0,1]}getCurveT(e,t,i){let r=this.points[e],n=this.points[e>=this.points.length-1?0:e+1],s=this.curveDivisions,a=s[e];if(pW(r,n)){let l=r.position.distanceTo(n.position);return r.position.distanceTo(vR.set(i.x,i.y))/l}let o=0;for(let l=0;l<e;l++)o+=s[l];return(t-o)/a}dispose(){}_applyCurveForPoint(e,t){pW(t,e)?this.lineTo(e.position.x,e.position.y):this.bezierCurveTo(t.controls[1].position.x,t.controls[1].position.y,e.controls[0].position.x,e.controls[0].position.y,e.position.x,e.position.y);let i=this.curves[this.curves.length-1];e.curveBefore=i,t.curveAfter=i;let r=i.clone();e.roundedCurveBefore=r,t.roundedCurveAfter=r,e.roundedCurveCorner=void 0,this.roundedCurves.push(r)}_update(){if(this.curves=[],this.roundedCurves=[],!this.points.length)return;for(let t=0,i=this.points.length;t<i;t++){let r=this.points[t];if(t===0)this.moveTo(r.position.x,r.position.y);else{let n=this.points[t-1];this._applyCurveForPoint(r,n)}}let e=this.getLastPoint();if(e!=null&&e.curveAfter&&(e.curveAfter=void 0),this.isClosed){let t=this.points[0],i=this.points[this.points.length-1];this._applyCurveForPoint(t,i)}if(this.points.length>2){let t=0;for(let i=0,r=this.points.length;i<r;i++){let n=this.points[i],s=this.points[i-1]??this.points[this.points.length-1],a=this.points[i+1]??this.points[0],o=n.roundness,l=s&&a&&tDe(s,n,a);if(!n.controlsMoved()&&o>0&&!l){let c=n.curveBefore,u=n.curveAfter;if(c===void 0||u===void 0)continue;let h=n.roundedCurveBefore,d=n.roundedCurveAfter,f=c.getLength(),p=u.getLength(),v=Math.min(o,f*.499),m=Math.min(o,p*.499),g=Math.min(v,m),y=1-g/f,x=g/p,_=c.getPointAt(y,vR),M=u.getPointAt(x,cDe);this._subSplitCurve(c,h,y,_,void 0),this._subSplitCurve(u,d,x,void 0,M);let S;if(this.useCubicForRoundedCorners){let T=Qee(_,n.position,M)/2,E=Math.tan(T)*_.distanceTo(n.position),[C,A]=iDe(_,M,E,uDe,hDe),D=rDe(C,A,n.position),[R,L]=nDe(D,_,M,E,dDe,fDe);S=new Zl(_.clone(),R.clone(),L.clone(),M.clone())}else S=new gf(_.clone(),n.position.clone(),M.clone());n.roundedCurveCorner=S,this.roundedCurves.splice(i+t,0,S),t++}}}}_subSplitCurve(e,t,i,r,n){if(e instanceof ic)r!==void 0&&t.v2.copy(r),n!==void 0&&t.v1.copy(n);else{let s=e,a=t,o=s.getUtoTmapping(i,0),l=sDe(s.v0,s.v1,s.v2,s.v3,o);return r!==void 0&&(a.v0.set(l[0],l[1]),a.v1.set(l[2],l[3]),a.v2.set(l[4],l[5]),a.v3.set(l[6],l[7])),n!==void 0&&(a.v0.set(l[6],l[7]),a.v1.set(l[8],l[9]),a.v2.set(l[10],l[11]),a.v3.set(l[12],l[13])),a}return t}clone(){let e=new tn(this._width,this._height);return e.points=this.points.map(t=>t.clone()),e.isClosed=this.isClosed,e.roundness=this.roundness,e.isMesh2D=this.isMesh2D,e.shapeHoles=this.shapeHoles.map(t=>t.clone()),e}toJSON(){return{points:this.points.reduce((e,t)=>e.concat(t.toJSON()),[]),shapeHoles:this.shapeHoles.map(e=>e.toJSON()),isClosed:this.isClosed,roundness:this.roundness}}fromJSON(e){var i;this.points=[],this.pointIDs=0;let t=e.points.length/7;for(let r=0;r<t;r++){let n=r*7,s=e.points[n+0],a=e.points[n+1],o=e.points[n+2],l=e.points[n+3],c=e.points[n+4],u=e.points[n+5],h=e.points[n+6],d=new d0(Tt.generateUUID(),new Me(s,a));d.controls[0].position.set(o,l),d.controls[1].position.set(c,u),d.roundness=h,this.points.push(d)}return this.shapeHoles=(i=e.shapeHoles)!=null&&i.length?e.shapeHoles.map(r=>{let n=new tn;return n.fromJSON(r),n}):[],this.isClosed=e.isClosed,this._roundness=e.roundness,this._update(),this}fromShape(e,t=!1){this.isText=t;let i=(n,s)=>{s instanceof Zl&&s.v3.equals(n.position)&&n.controls[0].position.copy(s.v2)},r=n=>{let s=[],a,o;for(a=0,o=n.length;a<o;a++)n[a]instanceof gf&&(n[a]=J3e(n[a]));for(a=0,o=n.length;a<o;a++){let u=n[a],h=a>0?n[a-1]:null,d;u instanceof Zl?(d=this.createPoint(u.v0),d.controls[1].position.copy(u.v1)):u instanceof ic&&(d=this.createPoint(u.v1)),d!==void 0&&(h!==null&&i(d,h),s.push(d))}let l=n[n.length-1],c=!1;return l instanceof Zl?l.v3.equals(s[0].position)&&(s[0].controls[0].position.copy(l.v2),c=!0):l instanceof ic&&l.v2.equals(s[0].position)&&(c=!0),this.isClosed=c,s};return this.points=r(e.curves),e instanceof hA&&(this.shapeHoles=e.holes.map(n=>{let s=new tn;return s.fromShape(n),s})),this.update(),this}updatePoint(e,t){let i=this.getPointByUuid(e);i&&(t.position!==void 0&&i.position.fromArray(t.position),t.roundness!==void 0&&(i.roundness=t.roundness),t.areControlsDirectionsMirrored!==void 0&&(i.areControlsDirectionsMirrored=t.areControlsDirectionsMirrored),this.needsUpdate=!0)}updatePreviousControl(e,t){var r;let i=(r=this.getPointByUuid(e))==null?void 0:r.controls[0];i&&(t.position&&i.position.fromArray(t.position),this.needsUpdate=!0)}updateNextControl(e,t){var r;let i=(r=this.getPointByUuid(e))==null?void 0:r.controls[1];i&&(t.position&&i.position.fromArray(t.position),this.needsUpdate=!0)}},nB=Math.PI*2;function yR({x:e,y:t},i,r,n,s){return{x:e*i+n,y:t*r+s}}function pDe(e,t){let i=t===1.5707963267948966?.551915024494:t===-1.5707963267948966?-.551915024494:1.3333333333333333*Math.tan(t/4),r=Math.cos(e),n=Math.sin(e),s=Math.cos(e+t),a=Math.sin(e+t);return[{x:r-n*i,y:n+r*i},{x:s+a*i,y:a-s*i},{x:s,y:a}]}function vW(e,t,i,r){let n=e*r-t*i<0?-1:1,s=Math.min(1,Math.max(-1,e*i+t*r));return n*Math.acos(s)}function mDe(e,t,i,r,n,s,a,o,l,c){let u=Math.pow(n,2),h=Math.pow(s,2),d=Math.pow(a,2),f=Math.pow(o,2),p=u*h-u*f-h*d;p<0&&(p=0),p/=u*f+h*d,p=Math.sqrt(p)*(l===c?-1:1);let v=p*n/s*o,m=p*-s/n*a,g=v+(e+i)/2,y=m+(t+r)/2,x=(a-v)/n,_=(o-m)/s,M=(-a-v)/n,S=(-o-m)/s,T=vW(1,0,x,_),E=vW(x,_,M,S);return!c&&E>0&&(E-=nB),c&&E<0&&(E+=nB),{centerx:g,centery:y,ang1:T,ang2:E}}function gDe({px:e,py:t,cx:i,cy:r,rx:n,ry:s,largeArcFlag:a,sweepFlag:o}){let l=[];if(n===0||s===0)return[];let c=(e-i)/2,u=(t-r)/2;if(c===0&&u===0)return[];n=Math.abs(n),s=Math.abs(s);let h=Math.pow(c,2)/Math.pow(n,2)+Math.pow(u,2)/Math.pow(s,2);h>1&&(n*=Math.sqrt(h),s*=Math.sqrt(h));let d=mDe(e,t,i,r,n,s,c,u,a,o),{ang1:f,ang2:p}=d,{centerx:v,centery:m}=d,g=Math.abs(p)/(nB/4);Math.abs(1-g)<1e-7&&(g=1);let y=Math.max(Math.ceil(g),1);p/=y;for(let x=0;x<y;x++)l.push(pDe(f,p)),f+=p;return l.map(x=>{let{x:_,y:M}=yR(x[0],n,s,v,m),{x:S,y:T}=yR(x[1],n,s,v,m),{x:E,y:C}=yR(x[2],n,s,v,m);return{x1:_,y1:M,x2:S,y2:T,x:E,y:C}})}var lr;(function(e){e[e.ODD=0]="ODD",e[e.NONZERO=1]="NONZERO",e[e.POSITIVE=2]="POSITIVE",e[e.NEGATIVE=3]="NEGATIVE",e[e.ABS_GEQ_TWO=4]="ABS_GEQ_TWO"})(lr||(lr={}));var Pn;(function(e){e[e.POLYGONS=0]="POLYGONS",e[e.CONNECTED_POLYGONS=1]="CONNECTED_POLYGONS",e[e.BOUNDARY_CONTOURS=2]="BOUNDARY_CONTOURS"})(Pn||(Pn={}));function ii(e,t){if(!e)throw t||"Assertion Failed!"}var Xt=function(){function e(){}return e.vertEq=function(t,i){return t.s===i.s&&t.t===i.t},e.vertLeq=function(t,i){return t.s<i.s||t.s===i.s&&t.t<=i.t},e.transLeq=function(t,i){return t.t<i.t||t.t===i.t&&t.s<=i.s},e.edgeGoesLeft=function(t){return e.vertLeq(t.Dst,t.Org)},e.edgeGoesRight=function(t){return e.vertLeq(t.Org,t.Dst)},e.vertL1dist=function(t,i){return Math.abs(t.s-i.s)+Math.abs(t.t-i.t)},e.edgeEval=function(t,i,r){ii(e.vertLeq(t,i)&&e.vertLeq(i,r));var n=i.s-t.s,s=r.s-i.s;return n+s>0?n<s?i.t-t.t+(t.t-r.t)*(n/(n+s)):i.t-r.t+(r.t-t.t)*(s/(n+s)):0},e.edgeSign=function(t,i,r){ii(e.vertLeq(t,i)&&e.vertLeq(i,r));var n=i.s-t.s,s=r.s-i.s;return n+s>0?(i.t-r.t)*n+(i.t-t.t)*s:0},e.transEval=function(t,i,r){ii(e.transLeq(t,i)&&e.transLeq(i,r));var n=i.t-t.t,s=r.t-i.t;return n+s>0?n<s?i.s-t.s+(t.s-r.s)*(n/(n+s)):i.s-r.s+(r.s-t.s)*(s/(n+s)):0},e.transSign=function(t,i,r){ii(e.transLeq(t,i)&&e.transLeq(i,r));var n=i.t-t.t,s=r.t-i.t;return n+s>0?(i.s-r.s)*n+(i.s-t.s)*s:0},e.vertCCW=function(t,i,r){return t.s*(i.t-r.t)+i.s*(r.t-t.t)+r.s*(t.t-i.t)>=0},e.interpolate=function(t,i,r,n){return t=t<0?0:t,r=r<0?0:r,t<=r?r===0?(i+n)/2:i+(n-i)*(t/(t+r)):n+(i-n)*(r/(t+r))},e.intersect=function(t,i,r,n,s){var a,o,l;e.vertLeq(t,i)||(l=t,t=i,i=l),e.vertLeq(r,n)||(l=r,r=n,n=l),e.vertLeq(t,r)||(l=t,t=r,r=l,l=i,i=n,n=l),e.vertLeq(r,i)?e.vertLeq(i,n)?(a=e.edgeEval(t,r,i),o=e.edgeEval(r,i,n),a+o<0&&(a=-a,o=-o),s.s=e.interpolate(a,r.s,o,i.s)):(a=e.edgeSign(t,r,i),o=-e.edgeSign(t,n,i),a+o<0&&(a=-a,o=-o),s.s=e.interpolate(a,r.s,o,n.s)):s.s=(r.s+i.s)/2,e.transLeq(t,i)||(l=t,t=i,i=l),e.transLeq(r,n)||(l=r,r=n,n=l),e.transLeq(t,r)||(l=t,t=r,r=l,l=i,i=n,n=l),e.transLeq(r,i)?e.transLeq(i,n)?(a=e.transEval(t,r,i),o=e.transEval(r,i,n),a+o<0&&(a=-a,o=-o),s.t=e.interpolate(a,r.t,o,i.t)):(a=e.transSign(t,r,i),o=-e.transSign(t,n,i),a+o<0&&(a=-a,o=-o),s.t=e.interpolate(a,r.t,o,n.t)):s.t=(r.t+i.t)/2},e}(),_1=function(){function e(){this.next=null,this.prev=null,this.anEdge=null,this.trail=null,this.n=0,this.marked=!1,this.inside=!1}return e}(),nM=function(){function e(t){this.side=t,this.next=null,this.Org=null,this.Sym=null,this.Onext=null,this.Lnext=null,this.Lface=null,this.activeRegion=null,this.winding=0}return Object.defineProperty(e.prototype,"Rface",{get:function(){return this.Sym.Lface},set:function(t){this.Sym.Lface=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Dst",{get:function(){return this.Sym.Org},set:function(t){this.Sym.Org=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Oprev",{get:function(){return this.Sym.Lnext},set:function(t){this.Sym.Lnext=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Lprev",{get:function(){return this.Onext.Sym},set:function(t){this.Onext.Sym=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Dprev",{get:function(){return this.Lnext.Sym},set:function(t){this.Lnext.Sym=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Rprev",{get:function(){return this.Sym.Onext},set:function(t){this.Sym.Onext=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Dnext",{get:function(){return this.Sym.Onext.Sym},set:function(t){this.Sym.Onext.Sym=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Rnext",{get:function(){return this.Sym.Lnext.Sym},set:function(t){this.Sym.Lnext.Sym=t},enumerable:!0,configurable:!0}),e}(),yv=function(){function e(){this.next=null,this.prev=null,this.anEdge=null,this.coords=[0,0,0],this.s=0,this.t=0,this.pqHandle=0,this.n=0,this.idx=0}return e}(),yW=function(){function e(){var t=new yv,i=new _1,r=new nM(0),n=new nM(1);t.next=t.prev=t,t.anEdge=null,i.next=i.prev=i,r.next=r,r.Sym=n,n.next=n,n.Sym=r,this.vHead=t,this.fHead=i,this.eHead=r,this.eHeadSym=n}return e.prototype.makeEdge_=function(t){var i=new nM(0),r=new nM(1);t.Sym.side<t.side&&(t=t.Sym);var n=t.Sym.next;return r.next=n,n.Sym.next=i,i.next=t,t.Sym.next=r,i.Sym=r,i.Onext=i,i.Lnext=r,i.Org=null,i.Lface=null,i.winding=0,i.activeRegion=null,r.Sym=i,r.Onext=r,r.Lnext=i,r.Org=null,r.Lface=null,r.winding=0,r.activeRegion=null,i},e.prototype.splice_=function(t,i){var r=t.Onext,n=i.Onext;r.Sym.Lnext=i,n.Sym.Lnext=t,t.Onext=n,i.Onext=r},e.prototype.makeVertex_=function(t,i,r){var n=t;ii(n,"Vertex can't be null!");var s=r.prev;n.prev=s,s.next=n,n.next=r,r.prev=n,n.anEdge=i;var a=i;do a.Org=n,a=a.Onext;while(a!==i)},e.prototype.makeFace_=function(t,i,r){var n=t;ii(n,"Face can't be null");var s=r.prev;n.prev=s,s.next=n,n.next=r,r.prev=n,n.anEdge=i,n.trail=null,n.marked=!1,n.inside=r.inside;var a=i;do a.Lface=n,a=a.Lnext;while(a!==i)},e.prototype.killEdge_=function(t){t.Sym.side<t.side&&(t=t.Sym);var i=t.next,r=t.Sym.next;i.Sym.next=r,r.Sym.next=i},e.prototype.killVertex_=function(t,i){var r=t.anEdge,n=r;do n.Org=i,n=n.Onext;while(n!==r);var s=t.prev,a=t.next;a.prev=s,s.next=a},e.prototype.killFace_=function(t,i){var r=t.anEdge,n=r;do n.Lface=i,n=n.Lnext;while(n!==r);var s=t.prev,a=t.next;a.prev=s,s.next=a},e.prototype.makeEdge=function(){var t=new yv,i=new yv,r=new _1,n=this.makeEdge_(this.eHead);return this.makeVertex_(t,n,this.vHead),this.makeVertex_(i,n.Sym,this.vHead),this.makeFace_(r,n,this.fHead),n},e.prototype.splice=function(t,i){var r=!1,n=!1;if(t!==i){if(i.Org!==t.Org&&(n=!0,this.killVertex_(i.Org,t.Org)),i.Lface!==t.Lface&&(r=!0,this.killFace_(i.Lface,t.Lface)),this.splice_(i,t),!n){var s=new yv;this.makeVertex_(s,i,t.Org),t.Org.anEdge=t}if(!r){var a=new _1;this.makeFace_(a,i,t.Lface),t.Lface.anEdge=t}}},e.prototype.delete=function(t){var i=t.Sym,r=!1;if(t.Lface!==t.Rface&&(r=!0,this.killFace_(t.Lface,t.Rface)),t.Onext===t)this.killVertex_(t.Org,null);else if(t.Rface.anEdge=t.Oprev,t.Org.anEdge=t.Onext,this.splice_(t,t.Oprev),!r){var n=new _1;this.makeFace_(n,t,t.Lface)}i.Onext===i?(this.killVertex_(i.Org,null),this.killFace_(i.Lface,null)):(t.Lface.anEdge=i.Oprev,i.Org.anEdge=i.Onext,this.splice_(i,i.Oprev)),this.killEdge_(t)},e.prototype.addEdgeVertex=function(t){var i=this.makeEdge_(t),r=i.Sym;this.splice_(i,t.Lnext),i.Org=t.Dst;var n=new yv;return this.makeVertex_(n,r,i.Org),i.Lface=r.Lface=t.Lface,i},e.prototype.splitEdge=function(t){var i=this.addEdgeVertex(t),r=i.Sym;return this.splice_(t.Sym,t.Sym.Oprev),this.splice_(t.Sym,r),t.Dst=r.Org,r.Dst.anEdge=r.Sym,r.Rface=t.Rface,r.winding=t.winding,r.Sym.winding=t.Sym.winding,r.idx=t.idx,r.Sym.idx=t.Sym.idx,r},e.prototype.connect=function(t,i){var r=!1,n=this.makeEdge_(t),s=n.Sym;if(i.Lface!==t.Lface&&(r=!0,this.killFace_(i.Lface,t.Lface)),this.splice_(n,t.Lnext),this.splice_(s,i),n.Org=t.Dst,s.Org=i.Org,n.Lface=s.Lface=t.Lface,t.Lface.anEdge=s,!r){var a=new _1;this.makeFace_(a,n,t.Lface)}return n},e.prototype.zapFace=function(t){var i=t.anEdge,r,n,s,a,o;n=i.Lnext;do r=n,n=r.Lnext,r.Lface=null,r.Rface===null&&(r.Onext===r?this.killVertex_(r.Org,null):(r.Org.anEdge=r.Onext,this.splice_(r,r.Oprev)),s=r.Sym,s.Onext===s?this.killVertex_(s.Org,null):(s.Org.anEdge=s.Onext,this.splice_(s,s.Oprev)),this.killEdge_(r));while(r!=i);a=t.prev,o=t.next,o.prev=a,a.next=o},e.prototype.countFaceVerts_=function(t){var i=t.anEdge,r=0;do r++,i=i.Lnext;while(i!==t.anEdge);return r},e.prototype.mergeConvexFaces=function(t){var i,r,n,s,a,o,l;for(i=this.fHead.next;i!==this.fHead;i=i.next)if(i.inside)for(r=i.anEdge,a=r.Org;n=r.Lnext,s=r.Sym,s&&s.Lface&&s.Lface.inside&&(o=this.countFaceVerts_(i),l=this.countFaceVerts_(s.Lface),o+l-2<=t&&Xt.vertCCW(r.Lprev.Org,r.Org,s.Lnext.Lnext.Org)&&Xt.vertCCW(s.Lprev.Org,s.Org,r.Lnext.Lnext.Org)&&(n=s.Lnext,this.delete(s),r=null,s=null)),!(r&&r.Lnext.Org===a);)r=n;return!0},e.prototype.check=function(){var t=this.fHead,i=this.vHead,r=this.eHead,n,s,a,o,l,c;for(s=t,s=t;(n=s.next)!==t;s=n){ii(n.prev===s),l=n.anEdge;do ii(l.Sym!==l),ii(l.Sym.Sym===l),ii(l.Lnext.Onext.Sym===l),ii(l.Onext.Sym.Lnext===l),ii(l.Lface===n),l=l.Lnext;while(l!==n.anEdge)}for(ii(n.prev===s&&n.anEdge===null),o=i,o=i;(a=o.next)!==i;o=a){ii(a.prev===o),l=a.anEdge;do ii(l.Sym!==l),ii(l.Sym.Sym===l),ii(l.Lnext.Onext.Sym===l),ii(l.Onext.Sym.Lnext===l),ii(l.Org===a),l=l.Onext;while(l!==a.anEdge)}for(ii(a.prev===o&&a.anEdge===null),c=r,c=r;(l=c.next)!==r;c=l)ii(l.Sym.next===c.Sym),ii(l.Sym!==l),ii(l.Sym.Sym===l),ii(l.Org!==null),ii(l.Dst!==null),ii(l.Lnext.Onext.Sym===l),ii(l.Onext.Sym.Lnext===l);ii(l.Sym.next===c.Sym&&l.Sym===this.eHeadSym&&l.Sym.Sym===l&&l.Org===null&&l.Dst===null&&l.Lface===null&&l.Rface===null)},e}(),xW=function(){function e(){this.handle=null}return e}(),wW=function(){function e(){this.key=null,this.node=0}return e}(),vDe=function(){function e(t,i){this.leq=i,this.max=0,this.nodes=[],this.handles=[],this.initialized=!1,this.freeList=0,this.size=0,this.max=t,this.nodes=[],this.handles=[];for(var r=0;r<t+1;r++)this.nodes[r]=new xW,this.handles[r]=new wW;this.initialized=!1,this.nodes[1].handle=1,this.handles[1].key=null}return e.prototype.floatDown_=function(t){var i=this.nodes,r=this.handles,n,s,a;for(n=i[t].handle;;){if(a=t<<1,a<this.size&&this.leq(r[i[a+1].handle].key,r[i[a].handle].key)&&++a,ii(a<=this.max),s=i[a].handle,a>this.size||this.leq(r[n].key,r[s].key)){i[t].handle=n,r[n].node=t;break}i[t].handle=s,r[s].node=t,t=a}},e.prototype.floatUp_=function(t){var i=this.nodes,r=this.handles,n,s,a;for(n=i[t].handle;;){if(a=t>>1,s=i[a].handle,a===0||this.leq(r[s].key,r[n].key)){i[t].handle=n,r[n].node=t;break}i[t].handle=s,r[s].node=t,t=a}},e.prototype.init=function(){for(var t=this.size;t>=1;--t)this.floatDown_(t);this.initialized=!0},e.prototype.min=function(){return this.handles[this.nodes[1].handle].key},e.prototype.insert=function(t){var i,r;if(i=++this.size,i*2>this.max){this.max*=2;var n,s;for(s=this.nodes.length,this.nodes.length=this.max+1,n=s;n<this.nodes.length;n++)this.nodes[n]=new xW;for(s=this.handles.length,this.handles.length=this.max+1,n=s;n<this.handles.length;n++)this.handles[n]=new wW}return this.freeList===0?r=i:(r=this.freeList,this.freeList=this.handles[r].node),this.nodes[i].handle=r,this.handles[r].node=i,this.handles[r].key=t,this.initialized&&this.floatUp_(i),r},e.prototype.extractMin=function(){var t=this.nodes,i=this.handles,r=t[1].handle,n=i[r].key;return this.size>0&&(t[1].handle=t[this.size].handle,i[t[1].handle].node=1,i[r].key=null,i[r].node=this.freeList,this.freeList=r,--this.size,this.size>0&&this.floatDown_(1)),n},e.prototype.delete=function(t){var i=this.nodes,r=this.handles,n;ii(t>=1&&t<=this.max&&r[t].key!==null),n=r[t].node,i[n].handle=i[this.size].handle,r[i[n].handle].node=n,--this.size,n<=this.size&&(n<=1||this.leq(r[i[n>>1].handle].key,r[i[n].handle].key)?this.floatDown_(n):this.floatUp_(n)),r[t].key=null,r[t].node=this.freeList,this.freeList=t},e}(),xR=function(){function e(){this.eUp=null,this.nodeUp=null,this.windingNumber=0,this.inside=!1,this.sentinel=!1,this.dirty=!1,this.fixUpperEdge=!1}return e}(),bW=function(){function e(){this.key=null,this.next=null,this.prev=null}return e}(),yDe=function(){function e(t,i){this.frame=t,this.leq=i,this.head=new bW,this.head.next=this.head,this.head.prev=this.head}return e.prototype.min=function(){return this.head.next},e.prototype.max=function(){return this.head.prev},e.prototype.insert=function(t){return this.insertBefore(this.head,t)},e.prototype.search=function(t){var i=this.head;do i=i.next;while(i.key!==null&&!this.leq(this.frame,t,i.key));return i},e.prototype.insertBefore=function(t,i){do t=t.prev;while(t.key!==null&&!this.leq(this.frame,t.key,i));var r=new bW;return r.key=i,r.next=t.next,t.next.prev=r,r.prev=t,t.next=r,r},e.prototype.delete=function(t){t.next.prev=t.prev,t.prev.next=t.next},e}(),xDe=function(){function e(){}return e.regionBelow=function(t){return t.nodeUp.prev.key},e.regionAbove=function(t){return t.nodeUp.next.key},e.debugEvent=function(t){},e.addWinding=function(t,i){t.winding+=i.winding,t.Sym.winding+=i.Sym.winding},e.edgeLeq=function(t,i,r){var n=t.event,s=i.eUp,a=r.eUp;if(s.Dst===n)return a.Dst===n?Xt.vertLeq(s.Org,a.Org)?Xt.edgeSign(a.Dst,s.Org,a.Org)<=0:Xt.edgeSign(s.Dst,a.Org,s.Org)>=0:Xt.edgeSign(a.Dst,n,a.Org)<=0;if(a.Dst===n)return Xt.edgeSign(s.Dst,n,s.Org)>=0;var o=Xt.edgeEval(s.Dst,n,s.Org),l=Xt.edgeEval(a.Dst,n,a.Org);return o>=l},e.deleteRegion=function(t,i){i.fixUpperEdge&&ii(i.eUp.winding===0),i.eUp.activeRegion=null,t.dict.delete(i.nodeUp)},e.fixUpperEdge=function(t,i,r){ii(i.fixUpperEdge),t.mesh.delete(i.eUp),i.fixUpperEdge=!1,i.eUp=r,r.activeRegion=i},e.topLeftRegion=function(t,i){var r=i.eUp.Org,n;do i=e.regionAbove(i);while(i.eUp.Org===r);if(i.fixUpperEdge){if(n=t.mesh.connect(e.regionBelow(i).eUp.Sym,i.eUp.Lnext),n===null)return null;e.fixUpperEdge(t,i,n),i=e.regionAbove(i)}return i},e.topRightRegion=function(t){var i=t.eUp.Dst;do t=e.regionAbove(t);while(t.eUp.Dst===i);return t},e.addRegionBelow=function(t,i,r){var n=new xR;return n.eUp=r,n.nodeUp=t.dict.insertBefore(i.nodeUp,n),n.fixUpperEdge=!1,n.sentinel=!1,n.dirty=!1,r.activeRegion=n,n},e.isWindingInside=function(t,i){switch(t.windingRule){case lr.ODD:return(i&1)!==0;case lr.NONZERO:return i!==0;case lr.POSITIVE:return i>0;case lr.NEGATIVE:return i<0;case lr.ABS_GEQ_TWO:return i>=2||i<=-2}throw new Error("Invalid winding rulle")},e.computeWinding=function(t,i){i.windingNumber=e.regionAbove(i).windingNumber+i.eUp.winding,i.inside=e.isWindingInside(t,i.windingNumber)},e.finishRegion=function(t,i){var r=i.eUp,n=r.Lface;n.inside=i.inside,n.anEdge=r,e.deleteRegion(t,i)},e.finishLeftRegions=function(t,i,r){for(var n,s=null,a=i,o=i.eUp;a!==r;){if(a.fixUpperEdge=!1,s=e.regionBelow(a),n=s.eUp,n.Org!=o.Org){if(!s.fixUpperEdge){e.finishRegion(t,a);break}n=t.mesh.connect(o.Lprev,n.Sym),e.fixUpperEdge(t,s,n)}o.Onext!==n&&(t.mesh.splice(n.Oprev,n),t.mesh.splice(o,n)),e.finishRegion(t,a),o=s.eUp,a=s}return o},e.addRightEdges=function(t,i,r,n,s,a){var o,l,c,u,h=!0;c=r;do ii(Xt.vertLeq(c.Org,c.Dst)),e.addRegionBelow(t,i,c.Sym),c=c.Onext;while(c!==n);for(s===null&&(s=e.regionBelow(i).eUp.Rprev),l=i,u=s;o=e.regionBelow(l),c=o.eUp.Sym,c.Org===u.Org;)c.Onext!==u&&(t.mesh.splice(c.Oprev,c),t.mesh.splice(u.Oprev,c)),o.windingNumber=l.windingNumber-c.winding,o.inside=e.isWindingInside(t,o.windingNumber),l.dirty=!0,!h&&e.checkForRightSplice(t,l)&&(e.addWinding(c,u),e.deleteRegion(t,l),t.mesh.delete(u)),h=!1,l=o,u=c;l.dirty=!0,ii(l.windingNumber-c.winding===o.windingNumber),a&&e.walkDirtyRegions(t,l)},e.spliceMergeVertices=function(t,i,r){t.mesh.splice(i,r)},e.vertexWeights=function(t,i,r){var n=Xt.vertL1dist(i,t),s=Xt.vertL1dist(r,t),a=.5*s/(n+s),o=.5*n/(n+s);t.coords[0]+=a*i.coords[0]+o*r.coords[0],t.coords[1]+=a*i.coords[1]+o*r.coords[1],t.coords[2]+=a*i.coords[2]+o*r.coords[2]},e.getIntersectData=function(t,i,r,n,s,a){i.coords[0]=i.coords[1]=i.coords[2]=0,i.idx=-1,e.vertexWeights(i,r,n),e.vertexWeights(i,s,a)},e.checkForRightSplice=function(t,i){var r=e.regionBelow(i),n=i.eUp,s=r.eUp;if(Xt.vertLeq(n.Org,s.Org)){if(Xt.edgeSign(s.Dst,n.Org,s.Org)>0)return!1;Xt.vertEq(n.Org,s.Org)?n.Org!==s.Org&&(t.pq.delete(n.Org.pqHandle),e.spliceMergeVertices(t,s.Oprev,n)):(t.mesh.splitEdge(s.Sym),t.mesh.splice(n,s.Oprev),i.dirty=r.dirty=!0)}else{if(Xt.edgeSign(n.Dst,s.Org,n.Org)<0)return!1;e.regionAbove(i).dirty=i.dirty=!0,t.mesh.splitEdge(n.Sym),t.mesh.splice(s.Oprev,n)}return!0},e.checkForLeftSplice=function(t,i){var r=e.regionBelow(i),n=i.eUp,s=r.eUp,a;if(ii(!Xt.vertEq(n.Dst,s.Dst)),Xt.vertLeq(n.Dst,s.Dst)){if(Xt.edgeSign(n.Dst,s.Dst,n.Org)<0)return!1;e.regionAbove(i).dirty=i.dirty=!0,a=t.mesh.splitEdge(n),t.mesh.splice(s.Sym,a),a.Lface.inside=i.inside}else{if(Xt.edgeSign(s.Dst,n.Dst,s.Org)>0)return!1;i.dirty=r.dirty=!0,a=t.mesh.splitEdge(s),t.mesh.splice(n.Lnext,s.Sym),a.Rface.inside=i.inside}return!0},e.checkForIntersect=function(t,i){var r=e.regionBelow(i),n=i.eUp,s=r.eUp,a=n.Org,o=s.Org,l=n.Dst,c=s.Dst,u,h,d=new yv,f,p;if(ii(!Xt.vertEq(c,l)),ii(Xt.edgeSign(l,t.event,a)<=0),ii(Xt.edgeSign(c,t.event,o)>=0),ii(a!==t.event&&o!==t.event),ii(!i.fixUpperEdge&&!r.fixUpperEdge),a===o||(u=Math.min(a.t,l.t),h=Math.max(o.t,c.t),u>h))return!1;if(Xt.vertLeq(a,o)){if(Xt.edgeSign(c,a,o)>0)return!1}else if(Xt.edgeSign(l,o,a)<0)return!1;return e.debugEvent(t),Xt.intersect(l,a,c,o,d),ii(Math.min(a.t,l.t)<=d.t),ii(d.t<=Math.max(o.t,c.t)),ii(Math.min(c.s,l.s)<=d.s),ii(d.s<=Math.max(o.s,a.s)),Xt.vertLeq(d,t.event)&&(d.s=t.event.s,d.t=t.event.t),f=Xt.vertLeq(a,o)?a:o,Xt.vertLeq(f,d)&&(d.s=f.s,d.t=f.t),Xt.vertEq(d,a)||Xt.vertEq(d,o)?(e.checkForRightSplice(t,i),!1):!Xt.vertEq(l,t.event)&&Xt.edgeSign(l,t.event,d)>=0||!Xt.vertEq(c,t.event)&&Xt.edgeSign(c,t.event,d)<=0?c===t.event?(t.mesh.splitEdge(n.Sym),t.mesh.splice(s.Sym,n),i=e.topLeftRegion(t,i),n=e.regionBelow(i).eUp,e.finishLeftRegions(t,e.regionBelow(i),r),e.addRightEdges(t,i,n.Oprev,n,n,!0),!0):l===t.event?(t.mesh.splitEdge(s.Sym),t.mesh.splice(n.Lnext,s.Oprev),r=i,i=e.topRightRegion(i),p=e.regionBelow(i).eUp.Rprev,r.eUp=s.Oprev,s=e.finishLeftRegions(t,r,null),e.addRightEdges(t,i,s.Onext,n.Rprev,p,!0),!0):(Xt.edgeSign(l,t.event,d)>=0&&(e.regionAbove(i).dirty=i.dirty=!0,t.mesh.splitEdge(n.Sym),n.Org.s=t.event.s,n.Org.t=t.event.t),Xt.edgeSign(c,t.event,d)<=0&&(i.dirty=r.dirty=!0,t.mesh.splitEdge(s.Sym),s.Org.s=t.event.s,s.Org.t=t.event.t),!1):(t.mesh.splitEdge(n.Sym),t.mesh.splitEdge(s.Sym),t.mesh.splice(s.Oprev,n),n.Org.s=d.s,n.Org.t=d.t,n.Org.pqHandle=t.pq.insert(n.Org),e.getIntersectData(t,n.Org,a,l,o,c),e.regionAbove(i).dirty=i.dirty=r.dirty=!0,!1)},e.walkDirtyRegions=function(t,i){for(var r=e.regionBelow(i),n,s;;){for(;r.dirty;)i=r,r=e.regionBelow(r);if(!i.dirty&&(r=i,i=e.regionAbove(i),i===null||!i.dirty))return;if(i.dirty=!1,n=i.eUp,s=r.eUp,n.Dst!==s.Dst&&e.checkForLeftSplice(t,i)&&(r.fixUpperEdge?(e.deleteRegion(t,r),t.mesh.delete(s),r=e.regionBelow(i),s=r.eUp):i.fixUpperEdge&&(e.deleteRegion(t,i),t.mesh.delete(n),i=e.regionAbove(r),n=i.eUp)),n.Org!==s.Org)if(n.Dst!==s.Dst&&!i.fixUpperEdge&&!r.fixUpperEdge&&(n.Dst===t.event||s.Dst===t.event)){if(e.checkForIntersect(t,i))return}else e.checkForRightSplice(t,i);n.Org===s.Org&&n.Dst===s.Dst&&(e.addWinding(s,n),e.deleteRegion(t,i),t.mesh.delete(n),i=e.regionAbove(r))}},e.connectRightVertex=function(t,i,r){var n,s=r.Onext,a=e.regionBelow(i),o=i.eUp,l=a.eUp,c=!1;if(o.Dst!==l.Dst&&e.checkForIntersect(t,i),Xt.vertEq(o.Org,t.event)&&(t.mesh.splice(s.Oprev,o),i=e.topLeftRegion(t,i),s=e.regionBelow(i).eUp,e.finishLeftRegions(t,e.regionBelow(i),a),c=!0),Xt.vertEq(l.Org,t.event)&&(t.mesh.splice(r,l.Oprev),r=e.finishLeftRegions(t,a,null),c=!0),c){e.addRightEdges(t,i,r.Onext,s,s,!0);return}Xt.vertLeq(l.Org,o.Org)?n=l.Oprev:n=o,n=t.mesh.connect(r.Lprev,n),e.addRightEdges(t,i,n,n.Onext,n.Onext,!1),n.Sym.activeRegion.fixUpperEdge=!0,e.walkDirtyRegions(t,i)},e.connectLeftDegenerate=function(t,i,r){var n,s,a,o,l;if(n=i.eUp,Xt.vertEq(n.Org,r)){ii(!1),e.spliceMergeVertices(t,n,r.anEdge);return}if(!Xt.vertEq(n.Dst,r)){t.mesh.splitEdge(n.Sym),i.fixUpperEdge&&(t.mesh.delete(n.Onext),i.fixUpperEdge=!1),t.mesh.splice(r.anEdge,n),e.sweepEvent(t,r);return}ii(!1),i=e.topRightRegion(i),l=e.regionBelow(i),a=l.eUp.Sym,s=o=a.Onext,l.fixUpperEdge&&(ii(s!==a),e.deleteRegion(t,l),t.mesh.delete(a),a=s.Oprev),t.mesh.splice(r.anEdge,a),Xt.edgeGoesLeft(s)||(s=null),e.addRightEdges(t,i,a.Onext,o,s,!0)},e.connectLeftVertex=function(t,i){var r,n,s,a,o,l,c=new xR;if(c.eUp=i.anEdge.Sym,r=t.dict.search(c).key,n=e.regionBelow(r),!!n){if(a=r.eUp,o=n.eUp,Xt.edgeSign(a.Dst,i,a.Org)===0){e.connectLeftDegenerate(t,r,i);return}if(s=Xt.vertLeq(o.Dst,a.Dst)?r:n,r.inside||s.fixUpperEdge){if(s===r)l=t.mesh.connect(i.anEdge.Sym,a.Lnext);else{var u=t.mesh.connect(o.Dnext,i.anEdge);l=u.Sym}s.fixUpperEdge?e.fixUpperEdge(t,s,l):e.computeWinding(t,e.addRegionBelow(t,r,l)),e.sweepEvent(t,i)}else e.addRightEdges(t,r,i.anEdge,i.anEdge,null,!0)}},e.sweepEvent=function(t,i){t.event=i,e.debugEvent(t);for(var r=i.anEdge;r.activeRegion===null;)if(r=r.Onext,r===i.anEdge){e.connectLeftVertex(t,i);return}var n=e.topLeftRegion(t,r.activeRegion);ii(n!==null);var s=e.regionBelow(n),a=s.eUp,o=e.finishLeftRegions(t,s,null);o.Onext===a?e.connectRightVertex(t,n,o):e.addRightEdges(t,n,o.Onext,a,a,!0)},e.addSentinel=function(t,i,r,n){var s=new xR,a=t.mesh.makeEdge();a.Org.s=r,a.Org.t=n,a.Dst.s=i,a.Dst.t=n,t.event=a.Dst,s.eUp=a,s.windingNumber=0,s.inside=!1,s.fixUpperEdge=!1,s.sentinel=!0,s.dirty=!1,s.nodeUp=t.dict.insert(s)},e.initEdgeDict=function(t){t.dict=new yDe(t,e.edgeLeq);var i=t.bmax[0]-t.bmin[0],r=t.bmax[1]-t.bmin[1],n=t.bmin[0]-i,s=t.bmax[0]+i,a=t.bmin[1]-r,o=t.bmax[1]+r;e.addSentinel(t,n,s,a),e.addSentinel(t,n,s,o)},e.doneEdgeDict=function(t){for(var i,r=0;(i=t.dict.min().key)!==null;)i.sentinel||(ii(i.fixUpperEdge),ii(++r===1)),ii(i.windingNumber===0),e.deleteRegion(t,i)},e.removeDegenerateEdges=function(t){var i,r,n,s=t.mesh.eHead;for(i=s.next;i!==s;i=r)r=i.next,n=i.Lnext,Xt.vertEq(i.Org,i.Dst)&&i.Lnext.Lnext!==i&&(e.spliceMergeVertices(t,n,i),t.mesh.delete(i),i=n,n=i.Lnext),n.Lnext===i&&(n!==i&&((n===r||n===r.Sym)&&(r=r.next),t.mesh.delete(n)),(i===r||i===r.Sym)&&(r=r.next),t.mesh.delete(i))},e.initPriorityQ=function(t){var i,r,n,s=0;for(n=t.mesh.vHead,r=n.next;r!==n;r=r.next)s++;for(s+=8,i=t.pq=new vDe(s,Xt.vertLeq),n=t.mesh.vHead,r=n.next;r!==n;r=r.next)r.pqHandle=i.insert(r);return r!==n?!1:(i.init(),!0)},e.donePriorityQ=function(t){t.pq=null},e.removeDegenerateFaces=function(t,i){var r,n,s;for(r=i.fHead.next;r!==i.fHead;r=n)n=r.next,s=r.anEdge,ii(s.Lnext!==s),s.Lnext.Lnext===s&&(e.addWinding(s.Onext,s),t.mesh.delete(s));return!0},e.computeInterior=function(t,i){i===void 0&&(i=!0);var r,n;if(e.removeDegenerateEdges(t),!e.initPriorityQ(t))return!1;for(e.initEdgeDict(t);(r=t.pq.extractMin())!==null;){for(;n=t.pq.min(),!(n===null||!Xt.vertEq(n,r));)n=t.pq.extractMin(),e.spliceMergeVertices(t,r.anEdge,n.anEdge);e.sweepEvent(t,r)}return t.event=t.dict.min().key.eUp.Org,e.debugEvent(t),e.doneEdgeDict(t),e.donePriorityQ(t),e.removeDegenerateFaces(t,t.mesh)?(i&&t.mesh.check(),!0):!1},e}(),wDe=function(){function e(){this.mesh=new yW,this.normal=[0,0,0],this.sUnit=[0,0,0],this.tUnit=[0,0,0],this.bmin=[0,0],this.bmax=[0,0],this.windingRule=lr.ODD,this.dict=null,this.pq=null,this.event=null,this.vertexIndexCounter=0,this.vertices=[],this.vertexIndices=[],this.vertexCount=0,this.elements=[],this.elementCount=0}return e.prototype.dot_=function(t,i){return t[0]*i[0]+t[1]*i[1]+t[2]*i[2]},e.prototype.normalize_=function(t){var i=t[0]*t[0]+t[1]*t[1]+t[2]*t[2];if(!i)throw"Zero-size vector!";i=Math.sqrt(i),t[0]/=i,t[1]/=i,t[2]/=i},e.prototype.longAxis_=function(t){var i=0;return Math.abs(t[1])>Math.abs(t[0])&&(i=1),Math.abs(t[2])>Math.abs(t[i])&&(i=2),i},e.prototype.computeNormal_=function(t){var i,r,n,s,a,o,l=[0,0,0],c=[0,0,0],u=[0,0,0],h=[0,0,0],d=[0,0,0],f=[null,null,null],p=[null,null,null],v=this.mesh.vHead;i=v.next;for(var m=0;m<3;++m)s=i.coords[m],c[m]=s,p[m]=i,l[m]=s,f[m]=i;for(i=v.next;i!==v;i=i.next)for(var g=0;g<3;++g)s=i.coords[g],s<c[g]&&(c[g]=s,p[g]=i),s>l[g]&&(l[g]=s,f[g]=i);var y=0;if(l[1]-c[1]>l[0]-c[0]&&(y=1),l[2]-c[2]>l[y]-c[y]&&(y=2),c[y]>=l[y]){t[0]=0,t[1]=0,t[2]=1;return}for(o=0,r=p[y],n=f[y],u[0]=r.coords[0]-n.coords[0],u[1]=r.coords[1]-n.coords[1],u[2]=r.coords[2]-n.coords[2],i=v.next;i!==v;i=i.next)h[0]=i.coords[0]-n.coords[0],h[1]=i.coords[1]-n.coords[1],h[2]=i.coords[2]-n.coords[2],d[0]=u[1]*h[2]-u[2]*h[1],d[1]=u[2]*h[0]-u[0]*h[2],d[2]=u[0]*h[1]-u[1]*h[0],a=d[0]*d[0]+d[1]*d[1]+d[2]*d[2],a>o&&(o=a,t[0]=d[0],t[1]=d[1],t[2]=d[2]);o<=0&&(t[0]=t[1]=t[2]=0,t[this.longAxis_(u)]=1)},e.prototype.checkOrientation_=function(){for(var t=this.mesh.fHead,i,r=this.mesh.vHead,n,s=0,a=t.next;a!==t;a=a.next)if(n=a.anEdge,!(n.winding<=0))do s+=(n.Org.s-n.Dst.s)*(n.Org.t+n.Dst.t),n=n.Lnext;while(n!==a.anEdge);if(s<0){for(i=r.next;i!==r;i=i.next)i.t=-i.t;this.tUnit[0]=-this.tUnit[0],this.tUnit[1]=-this.tUnit[1],this.tUnit[2]=-this.tUnit[2]}},e.prototype.projectPolygon_=function(){var t=this.mesh.vHead,i=[0,0,0],r,n,s=!1;i[0]=this.normal[0],i[1]=this.normal[1],i[2]=this.normal[2],!i[0]&&!i[1]&&!i[2]&&(this.computeNormal_(i),s=!0),r=this.sUnit,n=this.tUnit;var a=this.longAxis_(i);r[a]=0,r[(a+1)%3]=1,r[(a+2)%3]=0,n[a]=0,n[(a+1)%3]=0,n[(a+2)%3]=i[a]>0?1:-1;for(var o=t.next;o!==t;o=o.next)o.s=this.dot_(o.coords,r),o.t=this.dot_(o.coords,n);s&&this.checkOrientation_();for(var l=!0,c=t.next;c!==t;c=c.next)l?(this.bmin[0]=this.bmax[0]=c.s,this.bmin[1]=this.bmax[1]=c.t,l=!1):(c.s<this.bmin[0]&&(this.bmin[0]=c.s),c.s>this.bmax[0]&&(this.bmax[0]=c.s),c.t<this.bmin[1]&&(this.bmin[1]=c.t),c.t>this.bmax[1]&&(this.bmax[1]=c.t))},e.prototype.addWinding_=function(t,i){t.winding+=i.winding,t.Sym.winding+=i.Sym.winding},e.prototype.tessellateMonoRegion_=function(t,i){var r,n;if(r=i.anEdge,!(r.Lnext!==r&&r.Lnext.Lnext!==r))throw"Mono region invalid";for(;Xt.vertLeq(r.Dst,r.Org);r=r.Lprev);for(;Xt.vertLeq(r.Org,r.Dst);r=r.Lnext);n=r.Lprev;for(var s=void 0;r.Lnext!==n;)if(Xt.vertLeq(r.Dst,n.Org)){for(;n.Lnext!==r&&(Xt.edgeGoesLeft(n.Lnext)||Xt.edgeSign(n.Org,n.Dst,n.Lnext.Dst)<=0);)s=t.connect(n.Lnext,n),n=s.Sym;n=n.Lprev}else{for(;n.Lnext!==r&&(Xt.edgeGoesRight(r.Lprev)||Xt.edgeSign(r.Dst,r.Org,r.Lprev.Org)>=0);)s=t.connect(r,r.Lprev),r=s.Sym;r=r.Lnext}if(n.Lnext===r)throw"Mono region invalid";for(;n.Lnext.Lnext!==r;)s=t.connect(n.Lnext,n),n=s.Sym;return!0},e.prototype.tessellateInterior_=function(t){for(var i,r=t.fHead.next;r!==t.fHead;r=i)if(i=r.next,r.inside&&!this.tessellateMonoRegion_(t,r))return!1;return!0},e.prototype.discardExterior_=function(t){for(var i,r=t.fHead.next;r!==t.fHead;r=i)i=r.next,r.inside||t.zapFace(r)},e.prototype.setWindingNumber_=function(t,i,r){for(var n,s=t.eHead.next;s!==t.eHead;s=n)n=s.next,s.Rface.inside!==s.Lface.inside?s.winding=s.Lface.inside?i:-i:r?t.delete(s):s.winding=0},e.prototype.getNeighbourFace_=function(t){return!t.Rface||!t.Rface.inside?-1:t.Rface.n},e.prototype.outputPolymesh_=function(t,i,r,n){var s,a=0,o=0,l;r>3&&t.mergeConvexFaces(r);for(var c=t.vHead.next;c!==t.vHead;c=c.next)c.n=-1;for(var u=t.fHead.next;u!==t.fHead;u=u.next)if(u.n=-1,!!u.inside){s=u.anEdge,l=0;do{var c=s.Org;c.n===-1&&(c.n=o,o++),l++,s=s.Lnext}while(s!==u.anEdge);if(l>r)throw"Face vertex greater that support polygon";u.n=a,++a}this.elementCount=a,i===Pn.CONNECTED_POLYGONS&&(a*=2),this.elements=[],this.elements.length=a*r,this.vertexCount=o,this.vertices=[],this.vertices.length=o*n,this.vertexIndices=[],this.vertexIndices.length=o;for(var c=t.vHead.next;c!==t.vHead;c=c.next)if(c.n!==-1){var h=c.n*n;this.vertices[h+0]=c.coords[0],this.vertices[h+1]=c.coords[1],n>2&&(this.vertices[h+2]=c.coords[2]),this.vertexIndices[c.n]=c.idx}for(var d=0,u=t.fHead.next;u!==t.fHead;u=u.next)if(u.inside){s=u.anEdge,l=0;do{var c=s.Org;this.elements[d++]=c.n,l++,s=s.Lnext}while(s!==u.anEdge);for(var f=l;f<r;++f)this.elements[d++]=-1;if(i===Pn.CONNECTED_POLYGONS){s=u.anEdge;do this.elements[d++]=this.getNeighbourFace_(s),s=s.Lnext;while(s!==u.anEdge);for(var p=l;p<r;++p)this.elements[d++]=-1}}},e.prototype.outputContours_=function(t,i){var r,n,s=0,a=0;this.vertexCount=0,this.elementCount=0;for(var o=t.fHead.next;o!==t.fHead;o=o.next)if(o.inside){n=r=o.anEdge;do this.vertexCount++,r=r.Lnext;while(r!==n);this.elementCount++}this.elements=[],this.elements.length=this.elementCount*2,this.vertices=[],this.vertices.length=this.vertexCount*i,this.vertexIndices=[],this.vertexIndices.length=this.vertexCount;var l=0,c=0,u=0;s=0;for(var o=t.fHead.next;o!==t.fHead;o=o.next)if(o.inside){a=0,n=r=o.anEdge;do this.vertices[l++]=r.Org.coords[0],this.vertices[l++]=r.Org.coords[1],i>2&&(this.vertices[l++]=r.Org.coords[2]),this.vertexIndices[c++]=this.vertexIdCallback?this.vertexIdCallback(r):r.Org.idx,a++,r=r.Lnext;while(r!==n);this.elements[u++]=s,this.elements[u++]=a,s+=a}},e.prototype.addContour=function(t,i){this.mesh===null&&(this.mesh=new yW),t<2&&(t=2),t>3&&(t=3);for(var r=null,n=0;n<i.length;n+=t)r===null?(r=this.mesh.makeEdge(),this.mesh.splice(r,r.Sym)):(this.mesh.splitEdge(r),r=r.Lnext),r.Org.coords[0]=i[n+0],r.Org.coords[1]=i[n+1],t>2?r.Org.coords[2]=i[n+2]:r.Org.coords[2]=0,r.Org.idx=this.vertexIndexCounter++,this.edgeCreateCallback&&this.edgeCreateCallback(r),r.winding=1,r.Sym.winding=-1},e.prototype.tesselate=function(t,i,r,n,s,a){if(t===void 0&&(t=lr.ODD),i===void 0&&(i=Pn.POLYGONS),a===void 0&&(a=!0),this.vertices=[],this.elements=[],this.vertexIndices=[],this.vertexIndexCounter=0,s&&(this.normal[0]=s[0],this.normal[1]=s[1],this.normal[2]=s[2]),this.windingRule=t,n<2&&(n=2),n>3&&(n=3),!this.mesh)return!1;this.projectPolygon_(),xDe.computeInterior(this,a);var o=this.mesh;return i===Pn.BOUNDARY_CONTOURS?this.setWindingNumber_(o,1,!0):this.tessellateInterior_(o),a&&o.check(),i===Pn.BOUNDARY_CONTOURS?this.outputContours_(o,n):this.outputPolymesh_(o,i,r,n),!0},e}();function jd(e){var t=e.windingRule,i=t===void 0?lr.ODD:t,r=e.elementType,n=r===void 0?Pn.POLYGONS:r,s=e.polySize,a=s===void 0?3:s,o=e.vertexSize,l=o===void 0?2:o,c=e.normal,u=c===void 0?[0,0,1]:c,h=e.contours,d=h===void 0?[]:h,f=e.strict,p=f===void 0?!0:f,v=e.debug,m=v===void 0?!1:v;if(!d&&p)throw new Error("Contours can't be empty");if(d){var g=new wDe;e.edgeCreateCallback&&(g.edgeCreateCallback=e.edgeCreateCallback),e.vertexIdCallback&&(g.vertexIdCallback=e.vertexIdCallback);for(var y=0;y<d.length;y++)g.addContour(l||2,d[y]);return g.tesselate(i,n,a,l,u,p),{vertices:g.vertices,vertexIndices:g.vertexIndices,vertexCount:g.vertexCount,elements:g.elements,elementCount:g.elementCount,mesh:m?g.mesh:void 0}}}lr.ODD;lr.NONZERO;lr.POSITIVE;lr.NEGATIVE;lr.ABS_GEQ_TWO;Pn.POLYGONS;Pn.CONNECTED_POLYGONS;Pn.BOUNDARY_CONTOURS;var sB=class{constructor(e=256,t=!1){this.capacity=e,this.size=0,this.debug=t,this.debug&&console.log(`allocating with cap ${e}`);let i=e*sB.eSize;this.buffer=new ArrayBuffer(i);let r=Float32Array.BYTES_PER_ELEMENT,n=0;this.positions=new Float32Array(this.buffer,n*r,3*e),n+=3*e,this.normals=new Float32Array(this.buffer,n*r,3*e),n+=3*e,this.uvs=new Float32Array(this.buffer,n*r,2*e)}realloc(e,t=!1){if(e<this.size)throw Error("cannot shrink buffer");if(e<=this.capacity&&!t)return;this.debug&&console.log(`resizing from ${this.capacity}  ${e}`);let i=e*sB.eSize,r=new ArrayBuffer(i),n=Float32Array.BYTES_PER_ELEMENT,s=0,a=new Float32Array(r,s*n,3*e);s+=3*e;let o=new Float32Array(r,s*n,3*e);s+=3*e;let l=new Float32Array(r,s*n,2*e);t?(a.set(this.positions.subarray(0,this.size*3)),o.set(this.normals.subarray(0,this.size*3)),l.set(this.uvs.subarray(0,this.size*2))):(a.set(this.positions),o.set(this.normals),l.set(this.uvs)),this.buffer=r,this.positions=a,this.normals=o,this.uvs=l,this.capacity=e}get(e=1){let t=this.size+e;if(t>this.capacity){let r=this.capacity;for(;t>r;)r*=2;this.realloc(r)}let i=this.size;return this.size=t,i}reserve(e){let t=this.size+e;t>this.capacity&&this.realloc(t)}shrink(){this.debug&&console.log(`shrinking ${this.capacity}  ${this.size}`),this.realloc(this.size,!0)}},Zee=sB;Zee.eSize=8*Float32Array.BYTES_PER_ELEMENT;var bDe=class{constructor(e=[],t=(i,r)=>i<r?-1:i>r?1:0){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let i=(this.length>>1)-1;i>=0;i--)this._down(i)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;let e=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){let{data:t,compare:i}=this,r=t[e];for(;e>0;){let n=e-1>>1,s=t[n];if(i(r,s)>=0)break;t[e]=s,e=n}t[e]=r}_down(e){let{data:t,compare:i}=this,r=this.length>>1,n=t[e];for(;e<r;){let s=(e<<1)+1,a=s+1;if(a<this.length&&i(t[a],t[s])<0&&(s=a),i(t[s],n)>=0)break;t[e]=t[s],e=s}t[e]=n}};function _De(e,t,i=1,r=!1){let n=1/0,s=1/0,a=-1/0,o=-1/0;for(let[y,x]of e[0])y<n&&(n=y),x<s&&(s=x),y>a&&(a=y),x>o&&(o=x);let l=a-n,c=o-s,u=Math.max(i,Math.min(l,c));if(u===i){let y=[n,s];return y.distance=0,y.distance}let h=new bDe([],(y,x)=>x.max-y.max),d=MDe(e),f=new YA(n+l/2,s+c/2,0,e);f.d>d.d&&(d=f);let p=2;function v(y,x,_){let M=new YA(y,x,_,e);if(p++,M.max>d.d+i&&h.push(M),M.d>d.d&&(d=M,r&&console.log(`found best ${Math.round(1e4*M.d)/1e4} after ${p} probes`),d.d>t))return t}let m=u/2;for(let y=n;y<a;y+=u)for(let x=s;x<o;x+=u)v(y+m,x+m,m);for(;h.length;){let{max:y,x,y:_,h:M}=h.pop();if(y-d.d<=i)break;m=M/2,v(x-m,_-m,m),v(x+m,_-m,m),v(x-m,_+m,m),v(x+m,_+m,m)}r&&console.log(`num probes: ${p}
best distance: ${d.d}`);let g=[d.x,d.y];return g.distance=d.d,g.distance}function YA(e,t,i,r){this.x=e,this.y=t,this.h=i,this.d=SDe(e,t,r),this.max=this.d+this.h*Math.SQRT2}function SDe(e,t,i){let r=!1,n=1/0;for(let s of i)for(let a=0,o=s.length,l=o-1;a<o;l=a++){let c=s[a],u=s[l];c[1]>t!=u[1]>t&&e<(u[0]-c[0])*(t-c[1])/(u[1]-c[1])+c[0]&&(r=!r),n=Math.min(n,EDe(e,t,c,u))}return n===0?0:(r?1:-1)*Math.sqrt(n)}function MDe(e){let t=0,i=0,r=0,n=e[0];for(let a=0,o=n.length,l=o-1;a<o;l=a++){let c=n[a],u=n[l],h=c[0]*u[1]-u[0]*c[1];i+=(c[0]+u[0])*h,r+=(c[1]+u[1])*h,t+=h*3}let s=new YA(i/t,r/t,0,e);return t===0||s.d<0?new YA(n[0][0],n[0][1],0,e):s}function EDe(e,t,i,r){let n=i[0],s=i[1],a=r[0]-n,o=r[1]-s;if(a!==0||o!==0){let l=((e-n)*a+(t-s)*o)/(a*a+o*o);l>1?(n=r[0],s=r[1]):l>0&&(n+=a*l,s+=o*l)}return a=e-n,o=t-s,a*a+o*o}var WN={vertices:[160,160,-160,160,-160,-160,160,-160],vertexIndices:[1,0,3,2],vertexCount:4,elements:[0,4],elementCount:1,mesh:void 0},Kee={vertices:[],vertexIndices:[],vertexCount:0,elements:[],elementCount:0,mesh:void 0},Jee={vertices:[-160,160,160,-160,160,160,-160,-160],vertexIndices:[1,3,0,2],vertexCount:4,elements:[0,1,2,1,0,3],elementCount:2,mesh:void 0},wR=(e,t)=>([i,r])=>(r<i&&(r+=t),(e>=i?e:e+t)<=r),XN=class extends Nt{constructor(e,t,i=0,r=12,n=3,s=lr.ODD,a=!1){super(),this.forPathBevel=a,this.type="ShapeGeometry",this.vertexCache={},this._shape=e,this._depth=t,this._curveSegments=r,this._bevelSegmentsInput=n;let o=this._shape.extractShapePointsToFlatArray([],r),l=this._shape.shapeHoles.map(C=>{let A=C.extractShapePointsToFlatArray([],r),D=[];for(let R=A.length-1;R>=1;R-=2){let L=A[R-1],O=A[R-0];D.push(L,O)}return D}),c=[],u=[];for(let C=0;C<o.length;C+=2)u.push([o[C],o[C+1]]);c.push(u);for(let C=0;C<l.length;C++){let A=l[C],D=[];for(let R=0;R<A.length;R+=2)D.push([A[R],A[R+1]]);c.push(D)}let h;e.isText?h=new hN().setFromPoints(e.points.map(C=>C.position)).getSize(new Me).length()*.1:c[0].length===0?h=i:i>0?h=_De(c,i):h=1e-5,i<=0?(this._bevel=0,this._bevelSegments=0):(this._bevel=Math.min(i,h,t/2),this._bevelSegments=Math.floor(n));let d;try{d=jd({windingRule:s,elementType:Pn.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[o]})}catch{d=WN}let f;try{f=jd({windingRule:lr.ODD,elementType:Pn.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[...l]})}catch{f=Kee}if(!d)throw new Error("error generating geometry");let p=d.elementCount;if(f){d.elementCount+=f.elementCount;for(let C=0;C<f.elements.length;C++){let A=f.elements[C],D=C%2===0?d.vertexCount:0;d.elements.push(A+D)}for(let C=0;C<f.vertexIndices.length;C++){let A=f.vertexIndices[C],D=d.vertexCount;d.vertexIndices.push(A+D)}for(let C=0;C<f.vertices.length;C++){let A=f.vertices[C];d.vertices.push(A)}}let v=1/0,m=-1/0,g=1/0,y=-1/0;for(let C=0,A=d.vertexCount;C<A;C++){let D=C*2,R=d.vertices[D+0],L=d.vertices[D+1];R<v&&(v=R),R>m&&(m=R),L<g&&(g=L),L>y&&(y=L)}this._minX=v,this._minY=g,this._width=m-v,this._height=y-g,this._buffer=new Zee(this._computeBufferEstimatedSize(d));let x=[],_=[];for(let C=d.elementCount-1;C>=0;C--){let A=C>=p,D=C*2,R=d.elements[D+0],L=d.elements[D+1],O=R+L,H={start:R,count:L,normals:[],continuous:[],concave:[]},j=R,Y=O-1,z=R+1,V=this._shape.roundedCurves.length;do{let q=j-R,ee=d.vertices[Y*2+0],$=d.vertices[Y*2+1],ne=d.vertices[j*2+0],ce=d.vertices[j*2+1],pe=d.vertices[z*2+0],ge=d.vertices[z*2+1],we=ne-ee,le=ce-$,ve=Math.sqrt(we*we+le*le);we/=ve,le/=ve;let ie=ne-pe,Ce=ce-ge,Pe=Math.sqrt(ie*ie+Ce*Ce);ie/=Pe,Ce/=Pe,H.normals[q*2+0]=-Ce,H.normals[q*2+1]=ie,H.concave[q]=we*Ce-le*ie>0;let Ne=d.vertexIndices[j];if(Array.isArray(Ne))H.continuous[q]=!1;else{let[be,Le]=this._shape.getCurveIndexFromVertexId(Ne-1,!0);if(Le>0&&Le<1)H.continuous[q]=!0;else{let Fe=Le===1?be+1:be-1;Fe=(Fe+V)%V;let K=Le===1?0:1,B=this._shape.roundedCurves[be].getTangent(Le),G=this._shape.roundedCurves[Fe].getTangent(K);H.continuous[q]=B.dot(G)>.95}}A&&(H.normals[q*2+0]*=-1,H.normals[q*2+1]*=-1),[Y,j,z]=[j,z,z+1],z>=O&&(z-=L)}while(z!==R+1);let U=[];U.push({bevelI:0,angle:0,size:0,boundary:{vertices:d.vertices.slice(R*2,O*2),vertexCount:L,vertexIndices:new Array(L).fill(!0).map((q,ee)=>[ee,ee]),elements:[0,L],elementCount:1,mesh:null},reverseMap:[],insetPoints:d.vertices.slice(R*2,O*2)});let k=0;for(let q=1;q<=this._bevelSegments;q++){let ee=q/this._bevelSegments*Math.PI/2,$=(1-Math.cos(ee))*this._bevel,ne=[],ce=[],pe=0;for(let we=0;we<L;we++){let le=we*2,ve=(we-1+L)%L*2,ie=d.vertices[H.start*2+le+0],Ce=d.vertices[H.start*2+le+1],Pe=-H.normals[ve+0]*$,Ne=-H.normals[ve+1]*$,be=-H.normals[le+0]*$,Le=-H.normals[le+1]*$;if(H.concave[we]||!H.concave[we]&&A){let Fe=Math.atan2(Ne,Pe),K=Math.atan2(Le,be);K>Fe&&(K-=Math.PI*2);let B=K-Fe;if(H.continuous[we]||A){let G=Fe+B/2,oe=Math.cos(G)*$,fe=Math.sin(G)*$;ne[2*pe+0]=ie+oe*(A?-1:1),ne[2*pe+1]=Ce+fe*(A?-1:1),ce[pe]=we,pe++}else{let G=Math.max(1,Math.floor(r/4*Math.abs(B)/Math.PI));for(let oe=0;oe<=G;oe++){let fe=Fe+B*(oe/G),W=Math.cos(fe)*$,Ie=Math.sin(fe)*$;ne[2*pe+0]=ie+W,ne[2*pe+1]=Ce+Ie,ce[pe]=we,pe++}}}else ne[2*pe+0]=ie+Pe,ne[2*pe+1]=Ce+Ne,ce[pe]=we,pe++,ne[2*pe+0]=ie,ne[2*pe+1]=Ce,ce[pe]=we,pe++,ne[2*pe+0]=ie+be,ne[2*pe+1]=Ce+Le,ce[pe]=we,pe++}let ge=jd({windingRule:lr.POSITIVE,elementType:Pn.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[ne],edgeCreateCallback:we=>{let le=we.Org.idx,ve=ce[le],ie=ce[(le+1)%ce.length];we.idx=[ve,ie],we.Sym.idx=[ie,ve]},vertexIdCallback:we=>{let le=we.Lprev.idx;return[le?le[1]:0,we.idx?we.idx[0]:0]}});if(!ge)throw console.log("Error"),new Error(`error generating bevel geometry for ${q}'th loop`);if(!ge.vertexCount){let we=(q-1)/this._bevelSegments*Math.PI/2;k=(1-Math.sin(we))*this._bevel;break}for(let we=0;we<ge.vertexIndices.length;we++){let[le,ve]=ge.vertexIndices[we];if(le===ve)continue;let ie=ve;ve<le&&(ie+=L);for(let Ce=le;Ce<ie;Ce++){let Pe=Ce%L,Ne=(Ce+1)%L;if(!H.continuous[Pe]||!H.continuous[Ne]){ge.vertexIndices[we]=[le,Pe],ge.vertexIndices.splice(we+1,0,[Ne,ve]),ge.vertices.splice((we+1)*2,0,ge.vertices[we*2],ge.vertices[we*2+1]);break}}}U.push({bevelI:q,angle:ee,size:$,boundary:ge,reverseMap:ce,insetPoints:ne})}let X=(q,ee,$)=>{let ne=0,ce=q.boundary.vertexIndices.length;for(;ne<ce&&$(q.boundary.vertexIndices[ee]);)ee=(ee+1)%ce,ne++;return ne},re=x.length;for(let q=1;q<U.length;q++){let ee=U[q-1],$=U[q],ne=ee.boundary.vertexIndices.length,ce=$.boundary.vertexIndices.length;if(!ne||!ce)break;let pe=H.concave.length,ge=0,we=wR(ge,L);for(;!ee.boundary.vertexIndices.filter(we).length||!$.boundary.vertexIndices.filter(we).length;)ge++,we=wR(ge,L);let le=ee.boundary.vertexIndices.findIndex(we),ve=$.boundary.vertexIndices.findIndex(we);do le=(le+1)%ne;while(we(ee.boundary.vertexIndices[le]));do ve=(ve+1)%ce;while(we($.boundary.vertexIndices[ve]));ge=(ge+1)%L;let ie=ge,Ce=0,Pe=this._buildBevelVert(H,ee,(le-1+ne)%ne,void 0,Ce),Ne=this._buildBevelVert(H,$,(ve-1+ce)%ce,void 0,Ce),be=Pe,Le=Ne,Fe,K,B=!1;do{Ce=(ge||pe)/pe,we=wR(ge,L);let G=X(ee,le,we),oe=X($,ve,we),fe=B;if(B=!1,G&&!oe){for(let W=0;W<G;W++)Fe=this._buildBevelVert(H,ee,(le+W)%ne,W/(G-1),Ce),x.push(be.topN,Fe.topP,Le.topN),a===!1&&x.push(Fe.bottomP,be.bottomN,Le.bottomN),be=Fe;B=!0}else if(!G&&oe)for(let W=0;W<oe;W++)K=this._buildBevelVert(H,$,(ve+W)%ce,W/(oe-1),Ce),x.push(Le.topN,be.topP,K.topP),a===!1&&x.push(be.bottomP,Le.bottomN,K.bottomP),Le=K;else if(G&&oe)if(Fe=this._buildBevelVert(H,ee,le,0,Ce),K=this._buildBevelVert(H,$,ve,0,Ce),fe?(x.push(be.topN,K.topP,Le.topN),x.push(be.topN,Fe.topP,K.topP),a===!1&&(x.push(K.bottomP,be.bottomN,Le.bottomN),x.push(K.bottomP,Fe.bottomP,be.bottomN))):(x.push(Le.topN,be.topN,Fe.topP),x.push(Le.topN,Fe.topP,K.topP),a===!1&&(x.push(Fe.bottomP,be.bottomN,Le.bottomN),x.push(Fe.bottomP,Le.bottomN,K.bottomP))),be=Fe,Le=K,G===oe)for(let W=1;W<G;W++)Fe=this._buildBevelVert(H,ee,(le+W)%ne,W/(G-1),Ce),K=this._buildBevelVert(H,$,(ve+W)%ce,W/(oe-1),Ce),x.push(be.topN,Fe.topP,Le.topN),x.push(Le.topN,Fe.topP,K.topP),a===!1&&(x.push(Fe.bottomP,be.bottomN,Le.bottomN),x.push(Fe.bottomP,Le.bottomN,K.bottomP)),be=Fe,Le=K;else if(G>oe){let W=G/oe,Ie=0;for(let Oe=1;Oe<G;Oe++)Fe=this._buildBevelVert(H,ee,(le+Oe)%ne,Oe/(G-1),Ce),x.push(be.topN,Fe.topP,Le.topN),a===!1&&x.push(Fe.bottomP,be.bottomN,Le.bottomN),be=Fe,Oe>(Ie+1)*W&&(Ie++,K=this._buildBevelVert(H,$,(ve+Ie)%ce,Ie/(oe-1),Ce),x.push(Le.topN,Fe.topP,K.topP),a===!1&&x.push(Fe.bottomP,Le.bottomN,K.bottomP),Le=K)}else{let W=oe/G,Ie=0;for(let Oe=1;Oe<oe;Oe++)K=this._buildBevelVert(H,$,(ve+Oe)%ce,Oe/(oe-1),Ce),x.push(Le.topN,Fe.topP,K.topP),a===!1&&x.push(Fe.bottomP,Le.bottomN,K.bottomP),Le=K,Oe>(Ie+1)*W&&(Ie++,Fe=this._buildBevelVert(H,ee,(le+Ie)%ne,Ie/(G-1),Ce),x.push(be.topN,Fe.topP,Le.topN),a===!1&&x.push(Fe.bottomP,be.bottomN,Le.bottomN),be=Fe)}le=(le+G)%ne,ve=(ve+oe)%ce,ge=(ge+1)%pe}while(ge!==ie)}if(a===!1&&this._depth>this._bevel*2&&this._buildWall(U,H,x),A){let q=[];for(let ee=x.length-1;ee>=re+2;ee-=3){let $=x[ee-2],ne=x[ee-1],ce=x[ee-0];q.push(ce,ne,$)}x.splice(re,x.length-re,...q)}if(A){let q=[];for(let ee=U[U.length-1].boundary.vertices.length-1;ee>=1;ee-=2){let $=U[U.length-1].boundary.vertices[ee-1],ne=U[U.length-1].boundary.vertices[ee-0];q.push($,ne)}_.push(q)}if(!A){let q=U[U.length-1],ee;try{ee=jd({windingRule:U.length>1?lr.POSITIVE:lr.ODD,elementType:Pn.POLYGONS,vertexSize:2,strict:!0,contours:[q.insetPoints,..._]})}catch{ee=Jee}if(!ee)throw new Error("Error generating geometry for surface");l.length===0&&this._bevel<h&&Object.assign(this,{useNgonForTopBottomFaceDuringBake:!0});for(let $=0;$<ee.elementCount*3;$+=3){let ne=this._buildSurfaceVert(ee,ee.elements[$+0],k),ce=this._buildSurfaceVert(ee,ee.elements[$+1],k),pe=this._buildSurfaceVert(ee,ee.elements[$+2],k);x.push(ne.top,ce.top,pe.top),a===!1&&x.push(pe.bottom,ce.bottom,ne.bottom)}}this.vertexCache={}}this._buffer.shrink();let M=new Qt(Uint32Array.from(x),1),S=new Qt(this._buffer.positions,3),T=new Qt(this._buffer.normals,3),E=new Qt(this._buffer.uvs,2);S.needsUpdate=!0,T.needsUpdate=!0,E.needsUpdate=!0,M.needsUpdate=!0,this.setAttribute("position",S),this.setAttribute("normal",T),this.setAttribute("uv",E),this.setIndex(M)}_computeBufferEstimatedSize(e){return e.vertexCount*2*(2+this._bevelSegments)}_buildWall(e,t,i){let r=e[0];for(let n=0,s=r.boundary.vertexCount;n<s;n++){let a=this._buildBevelVert(t,r,n),o=this._buildBevelVert(t,r,(n+1)%s);i.push(o.topP,a.topN,a.bottomN),i.push(o.topP,a.bottomN,o.bottomP)}}_buildSurfaceVert(e,t,i){let r=t.toString();if(r in this.vertexCache)return this.vertexCache[r];let n=e.vertices[t*2+0],s=e.vertices[t*2+1],a=(n-this._minX)/this._width,o=(s-this._minY)/this._height;this.forPathBevel&&(o=1);let l=this._buffer.get(this.forPathBevel?1:2),c=l*3,u=l*2,h={top:l+0,bottom:l+1};return this._buffer.positions[c+0]=n,this._buffer.positions[c+1]=s,this._buffer.positions[c+2]=this.forPathBevel?this._bevel:this._depth-i,this._buffer.normals[c+0]=0,this._buffer.normals[c+1]=0,this._buffer.normals[c+2]=1,this._buffer.uvs[u+0]=a,this._buffer.uvs[u+1]=o,this.forPathBevel===!1&&(this._buffer.positions[c+3]=n,this._buffer.positions[c+4]=s,this._buffer.positions[c+5]=i,this._buffer.normals[c+3]=0,this._buffer.normals[c+4]=0,this._buffer.normals[c+5]=-1,this._buffer.uvs[u+2]=a,this._buffer.uvs[u+3]=o),this.vertexCache[r]=h,h}_buildBevelVert(e,t,i,r=1,n){let s=`${t.bevelI}:${i}`;if(s in this.vertexCache&&n!==0&&n!==1&&(!n||n===this.vertexCache[s].pathBevelUCoord))return this.vertexCache[s];let[a,o]=t.boundary.vertexIndices[i],l,c,u,h;a!==o?(c=a,l=o,h=!1,u=e.continuous[c]&&e.continuous[l]):(l=a,c=(l-1+e.count)%e.count,h=e.concave[l]&&t.bevelI>0,u=e.continuous[l]||h);let d=Math.cos(t.angle),f=Math.sin(t.angle),p=i*2,v=l*2,m=c*2,g=t.boundary.vertices[p+0],y=t.boundary.vertices[p+1],x=(1-f)*this._bevel,_=(g-this._minX)/this._width,M=(y-this._minY)/this._height;this.forPathBevel&&(n!==void 0&&(_=n),M=1);let S=e.normals[v+0],T=e.normals[v+1],E=e.normals[m+0],C=e.normals[m+1];if(h){let O=E-S,H=C-T;S=S+O*(1-r),T=T+H*(1-r);let j=Math.sqrt(S*S+T*T);S/=j,T/=j}let A=this.forPathBevel?this._buffer.get(u?1:2):this._buffer.get(u?2:4),D=A*3,R=A*2,L={i,fi:l,topP:A+0,topN:A+0,bottomP:A+1,bottomN:A+1,pathBevelUCoord:n};return this._buffer.positions[D+0]=g,this._buffer.positions[D+1]=y,this._buffer.positions[D+2]=(this.forPathBevel?this._bevel:this._depth)-x,this._buffer.normals[D+0]=S*d,this._buffer.normals[D+1]=T*d,this._buffer.normals[D+2]=f,this._buffer.uvs[R+0]=_,this._buffer.uvs[R+1]=M,this.forPathBevel===!1&&(this._buffer.positions[D+3]=g,this._buffer.positions[D+4]=y,this._buffer.positions[D+5]=x,this._buffer.normals[D+3]=S*d,this._buffer.normals[D+4]=T*d,this._buffer.normals[D+5]=-f,this._buffer.uvs[R+2]=M,this._buffer.uvs[R+3]=_),u||(this.forPathBevel?(A+=1,D+=3,R+=2):(A+=2,D+=6,R+=4),L.topP=A+0,L.bottomP=A+1,this._buffer.positions[D+0]=g,this._buffer.positions[D+1]=y,this._buffer.positions[D+2]=(this.forPathBevel?this._bevel:this._depth)-x,this._buffer.normals[D+0]=E*d,this._buffer.normals[D+1]=C*d,this._buffer.normals[D+2]=f,this._buffer.uvs[R+0]=_,this._buffer.uvs[R+1]=M,this.forPathBevel===!1&&(this._buffer.positions[D+3]=g,this._buffer.positions[D+4]=y,this._buffer.positions[D+5]=x,this._buffer.normals[D+3]=E*d,this._buffer.normals[D+4]=C*d,this._buffer.normals[D+5]=-f,this._buffer.uvs[R+2]=M,this._buffer.uvs[R+3]=_)),this.vertexCache[s]=L,L}clone(){let e=new XN(this._shape,this._depth,this._bevel,this._curveSegments,this._bevelSegmentsInput);return e.userData=zC(this.userData),e}},$ee=class extends Nt{constructor(e,t=12,i={}){super(),this.type="ShapeGeometry",this.windingRule=lr.ODD,this.elementType=Pn.POLYGONS,this.polySize=3,this.vertexSize=2,this.strict=!0,this._shape=e,this._curveSegments=t,this._triangulationOptions=Object.assign({windingRule:lr.ODD,elementType:Pn.POLYGONS,polySize:3,vertexSize:2,strict:!0},i);let r=this._shape.extractShapePointsToFlatArray([],this._curveSegments),n=this._shape.shapeHoles.map(d=>d.extractShapePointsToFlatArray([],this._curveSegments)),s,a=!0,o=!0,l,c;for(let d=0,f=r.length/2;d<f;d++){let p=d*2,v=r[p+0],m=r[p+1];if(l!==void 0&&v!==l&&(a=!1),c!==void 0&&m!==c&&(o=!1),l=v,c=m,!a&&!o)break}if(!a&&!o)try{s=jd({contours:[r,...n],windingRule:this._triangulationOptions.windingRule,elementType:this._triangulationOptions.elementType,polySize:this._triangulationOptions.polySize,vertexSize:this._triangulationOptions.vertexSize,strict:this._triangulationOptions.strict})}catch{s=WN}let u=(s==null?void 0:s.vertexCount)??1,h=(s==null?void 0:s.elementCount)??1;if(this._positionAttribute=new Qt(new Float32Array(u*3),3),this._normalAttribute=new Qt(new Float32Array(u*3),3),this._uvAttribute=new Qt(new Float32Array(u*2),2),this._indexAttribute=new Qt(new Uint32Array(h*3),1),s){let d=1/0,f=-1/0,p=1/0,v=-1/0;for(let y=0,x=u;y<x;y++){let _=y*2,M=s.vertices[_+0],S=s.vertices[_+1];M<d&&(d=M),M>f&&(f=M),S<p&&(p=S),S>v&&(v=S)}let m=f-d,g=v-p;for(let y=0,x=u;y<x;y++){let _=y*2,M=s.vertices[_+0],S=s.vertices[_+1],T=(M-d)/m,E=(S-p)/g;this._positionAttribute.setXYZ(y,M,S,0),this._normalAttribute.setXYZ(y,0,0,1),this._uvAttribute.setXY(y,T,E)}for(let y=0,x=h;y<x;y++){let _=y*3,M=s.elements[_+0],S=s.elements[_+1],T=s.elements[_+2];this._indexAttribute.setX(_+0,M),this._indexAttribute.setX(_+1,S),this._indexAttribute.setX(_+2,T)}}this.setAttribute("position",this._positionAttribute),this.setAttribute("normal",this._normalAttribute),this.setAttribute("uv",this._uvAttribute),this.setIndex(this._indexAttribute),this.setDrawRange(0,((s==null?void 0:s.elementCount)??1)*3)}clone(){let e=new $ee(this._shape,this._curveSegments);return e.userData=zC(this.userData),e}},ete=class extends XN{constructor(e,t,i=0,r=12,n=3,s=lr.ODD){super(e,t,i,r,n,s),this.type="ShapeGeometry"}_computeBufferEstimatedSize(e){return e.vertexCount*2*(2+this._bevelSegments)}_buildWall(e,t,i){let r=e[0];for(let n=0,s=r.boundary.vertexCount;n<s;n++){let a=this._buildBevelVert(t,r,n),o=this._buildBevelVert(t,r,(n+1)%s);i.push(o.topP,a.topN,a.bottomN),i.push(o.topP,a.bottomN,o.bottomP)}}clone(){let e=new ete(this._shape,this._depth,this._bevel,this._curveSegments,this._bevelSegmentsInput);return e.userData=zC(this.userData),e}},Ym=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var c,u;let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,subdivisions:40,roundness:0,extrudeBevelSize:0,extrudeBevelSegments:3,windingRule:lr.ODD},e.parameters),r=Math.abs(i.width),n=Math.abs(i.height??i.width),s=Math.abs(i.depth??0),a=e.shape??(t==null?void 0:t.shape),o=(a==null?void 0:a.roundness)??i.roundness;a!==void 0&&(a instanceof tn?(a.width!==r||a.height!==n)&&a.applySize(r,n):a=new tn(r,n).fromJSON(a),((c=e.parameters)==null?void 0:c.roundness)!==void 0&&((u=e.parameters)==null?void 0:u.roundness)>0&&a.update());let l=a??new tn(r,n);return{parameters:Object.assign(i,{width:r,height:n,depth:s,roundness:o}),shape:l}}static build(e){let{depth:t,extrudeBevelSize:i,extrudeBevelSegments:r,subdivisions:n,roundness:s,windingRule:a}=e.parameters;e.shape.roundness=s;let o;return t<=0?o=new $ee(e.shape,n,{windingRule:a}):o=new ete(e.shape,t,i,n,r,a),Object.assign(o,{userData:{...e,type:"VectorGeometry"}})}},tte=Math.PI*2,qN=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,depth:0,spikes:64,angle:360,innerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:1},e.parameters);return i.angle=Tt.clamp(i.angle,0,360),{shape:e.shape&&e.shape instanceof tn?e.shape:new tn,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)})}}static build(e){let{width:t,height:i,spikes:r,angle:n,innerRadius:s,depth:a,extrudeBevelSize:o,extrudeBevelSegments:l}=e.parameters,c=e.shape,u=t*.5,h=i*.5,d=ADe(c,u,h,n*Math.PI/180,r,s);c.isClosed=!0,c.update();let f;return n===0?(f=new Nt,f.setAttribute("position",new _t([],3))):f=Ym.create({shape:c,parameters:{subdivisions:d,depth:a,extrudeBevelSize:o,extrudeBevelSegments:l}}),Object.assign(f,{userData:{...e,type:"EllipseGeometry"}})}};function ADe(e,t,i,r,n,s){if(r>=tte)return n>30||n%4===0?(CDe(e,t,i,s),Math.round(n/4)):_W(e,r,n,t,i,s);r=Math.max(r,.001);let a={x:0,y:i},o=r+Math.PI*.5,l={x:Math.cos(o)*t,y:Math.sin(o)*i},c=gDe({px:a.x,py:a.y,cx:l.x,cy:l.y,rx:t,ry:i,largeArcFlag:r>Math.PI,sweepFlag:!0});return n>30||n%c.length===0?TDe(e,a.x,a.y,c,n,t,i,s):_W(e,r,n,t,i,s)}function TDe(e,t,i,r,n,s,a,o){let l=Math.round(n/r.length);e.addPoint(f0(t,i));for(let c=0,u=r.length;c<u;c++){let h=r[c],d=e.points[c],f=f0(h.x,h.y);d.controls[1].position.set(h.x1,h.y1),f.controls[0].position.set(h.x2,h.y2),e.addPoint(f)}return o>0?ite(e,s,a,o):e.addPoint(f0(0,0)),l}function _W(e,t,i,r,n,s){let a=-t/i;for(let o=0;o<=i;o++){let l=a*o,c=Math.sin(l)*r,u=Math.cos(l)*n;e.addPoint(f0(c,u))}return t<tte?s>0?ite(e,r,n,s):e.addPoint(f0(0,0)):(e.removePoint(e.points[e.points.length-1]),s>0&&rte(e,r,n,s)),1}function CDe(e,t,i,r=0,n=0,s=0){let a=.5522847498,o=t*a,l=i*a;e.addPoint(sM(n-t,s,n-t,s-l,n-t,s+l)),e.addPoint(sM(n,s+i,n-o,s+i,n+o,s+i)),e.addPoint(sM(n+t,s,n+t,s+l,n+t,s-l)),e.addPoint(sM(n,s-i,n+o,s-i,n-o,s-i)),r>0&&rte(e,t,i,r)}function f0(e,t){return new d0(Tt.generateUUID(),new Me(e,t))}function sM(e,t,i,r,n,s){let a=f0(e,t);return a.controls[0].position.set(i,r),a.controls[1].position.set(n,s),a}function ite(e,t,i,r){nte(e,t,i,r).forEach(n=>e.addPoint(n))}function rte(e,t,i,r){let n=nte(e,t,i,r),s=new tn;n.forEach(a=>s.addPoint(a)),s.isClosed=!0,e.shapeHoles.push(s)}function nte(e,t,i,r){let n=r*t/100,s=n*(Math.abs(i)/Math.abs(t)),a=new Me(n/t,s/i),o=e.points.map(l=>{let c=l.clone();return c.uuid=Tt.generateUUID(),c}).reverse();return o.forEach(l=>{l.position.multiply(a);let c=l.controls[0].position.clone().multiply(a),u=l.controls[1].position.clone().multiply(a);l.controls[0].position.copy(u),l.controls[1].position.copy(c)}),o}var PDe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,revolutions:2,segments:40,pathRadius:10,pathType:0,pathSegments:30,cornerRadius:30,cornerSegments:4},e.parameters),r=Math.abs(i.width),n=Math.abs(i.height??r),s=Math.abs(i.depth??r),a=Math.abs(Math.min(r,s))/2;return{parameters:Object.assign(i,{width:r,height:n,depth:s,radius:a,segments:Math.round(i.segments),pathSegments:Math.round(i.pathSegments),cornerSegments:Math.round(i.cornerSegments)})}}static build(e){let{width:t,height:i,depth:r,radius:n,revolutions:s,segments:a,pathRadius:o,pathType:l,pathSegments:c,cornerRadius:u,cornerSegments:h}=e.parameters,d=new ste(!1,t,i,r,n,s,a,o,l,c,u,h);return Object.assign(d,{userData:{...e,type:"HelixGeometry"}})}},bR=new o0([0,0,0],1),ste=class extends Nt{constructor(e=!0,t=1,i=1,r=1,n=1,s=1,a=1,o=1,l=1,c=1,u=1,h=1){if(super(),s===0)return;let d=e&&s===1;d&&(h=0),u>100&&(u=100),u===0&&(h=0);let f=()=>new N,p=new N,v=f(),m=f(),g=f(),y,x,_,M,S,T,E,C,A=f(),D=f(),R=f(),L=f(),O=f(),H=f(),j=f(),Y=f(),z=i-2*o+.001,V=z/s,U=Math.ceil(a*s),k=U+1,X=z/U,re=-z/2,q=c+1,ee=2*Math.PI/c,$=Math.PI/2/h,ne=.01,ce=Math.min((1-u/100)*o,o-ne),pe=o-ce,ge=0,we=2,le=h*we+we,ve=q*le/we,ie=ve+q*k,Ce=Math.max(0,q*(k+le)),[Pe,Ne,be]=[3,3,2].map(Re=>Array(Ce*Re).fill(0)),Le=[],Fe=n-o;function K(Re,ke){let qe=Math.PI/2;T=ke*X,C=2*Math.PI*(T%V)/V+qe,T+=re,E=Math.sin(C)*Fe,S=Math.cos(C)*Fe,e?Re.set(S,E,T):Re.set(S,T,E)}K(p,-1e-10),K(v,0),A.copy(p),K(p,1);let B=p.distanceTo(v),G=d?0:pe+ce,oe=B*U+2*G,fe=ce,W=oe-G;for(let Re=0;Re<=U;Re++){K(m,Re),Y.subVectors(m,A).normalize(),A.copy(m),H.copy(m).setComponent(+e+1,0).normalize(),j.crossVectors(Y,H).normalize();let ke=Re===0,qe=Re===U,Ke=ke?3*Math.PI/2:$,it=ke?fe:W,He=ke?q:ie,de=ke?0:Ce-q,We=Y.clone().multiplyScalar(ke?-pe:pe).add(m),dt=Y.clone().multiplyScalar(ke?-1:1).normalize();for(let J=0;J<q;J++){let xe=J*ee;if(D.addVectors(p.copy(H).multiplyScalar(o*Math.cos(xe)),v.copy(j).multiplyScalar(o*Math.sin(xe))),R.copy(D).normalize(),ke||qe){d||(ge=de+J,[0,1,2].forEach(me=>{Pe[ge*3+me]=We.getComponent(me),Ne[ge*3+me]=dt.getComponent(me)}),be[ge*2]=+qe,be[ge*2+1]=J/c),v.copy(R).multiplyScalar(ce),g.addVectors(m,v);for(let me=0;me<h;me++){let ze=me*$+Ke;L.addVectors(p.copy(Y).multiplyScalar(pe*Math.sin(ze)),v.copy(R).multiplyScalar(pe*Math.cos(ze))),O.copy(L).normalize(),v.addVectors(g,L),L.normalize(),ge=He+me*q+J,[0,1,2].forEach(Je=>{Pe[ge*3+Je]=v.getComponent(Je),Ne[ge*3+Je]=O.getComponent(Je)});let Ze=+ke+Math.sin(ze);be[ge*2]=(it+pe*Ze)/oe,be[ge*2+1]=J/c}}v.addVectors(m,D),ge=ve+Re*q+J,[0,1,2].forEach(me=>{Pe[ge*3+me]=v.getComponent(me),Ne[ge*3+me]=R.getComponent(me)}),be[ge*2]=(G+Re*B)/oe,be[ge*2+1]=J/c}}let Ie=k+2*h+we,[Oe,Be]=[+d,Ie-1];for(let Re=Oe;Re<=Be-1;Re++){let ke=d&&Re===Be-1;for(let qe=0;qe<q-1;qe++)y=Re*q+qe,x=y+1,_=(ke?qe:y)+q,M=(ke?qe+1:x)+q,Re===0?Le.push(x,M,_):Re===Ie-2?Le.push(y,x,_):Le.push(y,x,_,x,M,_)}this.setIndex(Le),this.setAttribute("position",new _t(Pe,3)),this.setAttribute("normal",new _t(Ne,3)),this.setAttribute("uv",new _t(be,2))}getClosedTorusIndicesForBooleanOrSubdiv(){let e=this.userData.parameters,t=Math.ceil(e.tubularSegments),i=e.radialSegments+1,r=Array.from(this.getIndex().array),n,s,a,o,l=6*(t-1)*e.radialSegments,c=t,u=c===t;for(let h=0;h<e.radialSegments;h++)n=c*i+h,s=n+1,a=(u?h:n)+i,o=(u?h+1:s)+i,r[l++]=n,r[l++]=s,r[l++]=a,r[l++]=s,r[l++]=o,r[l++]=a;return r.length=l,bR.array=r,bR.count=r.length,bR}},DDe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,detail:0,corner:0,cornerSides:4},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,height:i,depth:r,detail:n,corner:s,cornerSides:a}=e.parameters,o=n===0&&s!==0?new ate(t*.5,s,a):new n$(t*.5,n);return o.scale(1,i/t,r/t),Object.assign(o,{userData:{...e,type:"IcosahedronGeometry"}})}},ate=class extends GN{constructor(e=1,t=.2,i=4){let r=(1+Math.sqrt(5))/2,n=[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1],s=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],a="IcosahedronGeometry";super(n,s,a,e,t,i),this.type=a}static fromJSON(e){return new ate(e.radius,e.corner,e.cornerSides)}},RDe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var r;(((r=e.parameters)==null?void 0:r.points)??[]).forEach(n=>{Array.isArray(n)&&(n.x=n[0],n.y=n[1])});let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,segments:64,verticalSegments:64,points:[{x:0,y:-50,id:0},{x:50,y:-50,id:1},{x:50,y:50,id:2},{x:0,y:50,id:3}]},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{points:t,segments:i,verticalSegments:r}=e.parameters,n=new hA;n.moveTo(t[0].x,t[0].y),n.bezierCurveTo(t[1].x,t[1].y,t[2].x,t[2].y,t[3].x,t[3].y);let s=new JJ(n.extractPoints(r).shape,i);return s.rotateZ(Math.PI),Object.assign(s,{userData:{...e,type:"LatheGeometry"}})}},Ec=new ft,_R=new rr,aM=new N,QA=class extends Vs{constructor(){super(),this.uuid=Tt.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}applyMatrix4(e){let t=new Dn().getNormalMatrix(e);for(let i=0,r=this.vertices.length;i<r;i++)this.vertices[i].applyMatrix4(e);for(let i=0,r=this.faces.length;i<r;i++){let n=this.faces[i];n.normal.applyMatrix3(t).normalize();for(let s=0,a=n.vertexNormals.length;s<a;s++)n.vertexNormals[s].applyMatrix3(t).normalize()}return this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this}rotateX(e){return Ec.makeRotationX(e),this.applyMatrix4(Ec),this}rotateY(e){return Ec.makeRotationY(e),this.applyMatrix4(Ec),this}rotateZ(e){return Ec.makeRotationZ(e),this.applyMatrix4(Ec),this}translate(e,t,i){return Ec.makeTranslation(e,t,i),this.applyMatrix4(Ec),this}scale(e,t,i){return Ec.makeScale(e,t,i),this.applyMatrix4(Ec),this}lookAt(e){return _R.lookAt(e),_R.updateMatrix(),this.applyMatrix4(_R.matrix),this}fromBufferGeometry(e){let t=this,i=e.index!==null?e.index:void 0,r=e.attributes;if(r.position===void 0)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;let n=r.position,s=r.normal,a=r.color,o=r.uv,l=r.uv2;l!==void 0&&(this.faceVertexUvs[1]=[]);for(let h=0;h<n.count;h++)t.vertices.push(new N().fromBufferAttribute(n,h)),a!==void 0&&t.colors.push(new Yt().fromBufferAttribute(a,h));function c(h,d,f,p){let v=a===void 0?[]:[t.colors[h].clone(),t.colors[d].clone(),t.colors[f].clone()],m=s===void 0?[]:[new N().fromBufferAttribute(s,h),new N().fromBufferAttribute(s,d),new N().fromBufferAttribute(s,f)],g=new aB(h,d,f,m,v,p);t.faces.push(g),o!==void 0&&t.faceVertexUvs[0].push([new Me().fromBufferAttribute(o,h),new Me().fromBufferAttribute(o,d),new Me().fromBufferAttribute(o,f)]),l!==void 0&&t.faceVertexUvs[1].push([new Me().fromBufferAttribute(l,h),new Me().fromBufferAttribute(l,d),new Me().fromBufferAttribute(l,f)])}let u=e.groups;if(u.length>0)for(let h=0;h<u.length;h++){let d=u[h],f=d.start,p=d.count;for(let v=f,m=f+p;v<m;v+=3)i!==void 0?c(i.getX(v),i.getX(v+1),i.getX(v+2),d.materialIndex):c(v,v+1,v+2,d.materialIndex)}else if(i!==void 0)for(let h=0;h<i.count;h+=3)c(i.getX(h),i.getX(h+1),i.getX(h+2));else for(let h=0;h<n.count;h+=3)c(h,h+1,h+2);return this.computeFaceNormals(),e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(aM).negate(),this.translate(aM.x,aM.y,aM.z),this}normalize(){this.computeBoundingSphere();let e=this.boundingSphere.center,t=this.boundingSphere.radius,i=t===0?1:1/t,r=new ft;return r.set(i,0,0,-i*e.x,0,i,0,-i*e.y,0,0,i,-i*e.z,0,0,0,1),this.applyMatrix4(r),this}computeFaceNormals(){let e=new N,t=new N;for(let i=0,r=this.faces.length;i<r;i++){let n=this.faces[i],s=this.vertices[n.a],a=this.vertices[n.b],o=this.vertices[n.c];e.subVectors(o,a),t.subVectors(s,a),e.cross(t),e.normalize(),n.normal.copy(e)}}computeVertexNormals(e=!0){let t=new Array(this.vertices.length);for(let i=0,r=this.vertices.length;i<r;i++)t[i]=new N;if(e){let i=new N,r=new N;for(let n=0,s=this.faces.length;n<s;n++){let a=this.faces[n],o=this.vertices[a.a],l=this.vertices[a.b],c=this.vertices[a.c];i.subVectors(c,l),r.subVectors(o,l),i.cross(r),t[a.a].add(i),t[a.b].add(i),t[a.c].add(i)}}else{this.computeFaceNormals();for(let i=0,r=this.faces.length;i<r;i++){let n=this.faces[i];t[n.a].add(n.normal),t[n.b].add(n.normal),t[n.c].add(n.normal)}}for(let i=0,r=this.vertices.length;i<r;i++)t[i].normalize();for(let i=0,r=this.faces.length;i<r;i++){let n=this.faces[i],s=n.vertexNormals;s.length===3?(s[0].copy(t[n.a]),s[1].copy(t[n.b]),s[2].copy(t[n.c])):(s[0]=t[n.a].clone(),s[1]=t[n.b].clone(),s[2]=t[n.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)}computeFlatVertexNormals(){this.computeFaceNormals();for(let e=0,t=this.faces.length;e<t;e++){let i=this.faces[e],r=i.vertexNormals;r.length===3?(r[0].copy(i.normal),r[1].copy(i.normal),r[2].copy(i.normal)):(r[0]=i.normal.clone(),r[1]=i.normal.clone(),r[2]=i.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)}computeMorphNormals(){for(let t=0,i=this.faces.length;t<i;t++){let r=this.faces[t];r.__originalFaceNormal?r.__originalFaceNormal.copy(r.normal):r.__originalFaceNormal=r.normal.clone(),r.__originalVertexNormals||(r.__originalVertexNormals=[]);for(let n=0,s=r.vertexNormals.length;n<s;n++)r.__originalVertexNormals[n]?r.__originalVertexNormals[n].copy(r.vertexNormals[n]):r.__originalVertexNormals[n]=r.vertexNormals[n].clone()}let e=new QA;e.faces=this.faces;for(let t=0,i=this.morphTargets.length;t<i;t++){if(!this.morphNormals[t]){this.morphNormals[t]={},this.morphNormals[t].faceNormals=[],this.morphNormals[t].vertexNormals=[];let n=this.morphNormals[t].faceNormals,s=this.morphNormals[t].vertexNormals;for(let a=0,o=this.faces.length;a<o;a++){let l=new N,c={a:new N,b:new N,c:new N};n.push(l),s.push(c)}}let r=this.morphNormals[t];e.vertices=this.morphTargets[t].vertices,e.computeFaceNormals(),e.computeVertexNormals();for(let n=0,s=this.faces.length;n<s;n++){let a=this.faces[n],o=r.faceNormals[n],l=r.vertexNormals[n];o.copy(a.normal),l.a.copy(a.vertexNormals[0]),l.b.copy(a.vertexNormals[1]),l.c.copy(a.vertexNormals[2])}}for(let t=0,i=this.faces.length;t<i;t++){let r=this.faces[t];r.normal=r.__originalFaceNormal,r.vertexNormals=r.__originalVertexNormals}}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new vn),this.boundingBox.setFromPoints(this.vertices)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new uo),this.boundingSphere.setFromPoints(this.vertices)}merge(e,t,i=0){if(!(e&&e.isGeometry)){console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e);return}let r,n=this.vertices.length,s=this.vertices,a=e.vertices,o=this.faces,l=e.faces,c=this.colors,u=e.colors;t!==void 0&&(r=new Dn().getNormalMatrix(t));for(let h=0,d=a.length;h<d;h++){let f=a[h].clone();t!==void 0&&f.applyMatrix4(t),s.push(f)}for(let h=0,d=u.length;h<d;h++)c.push(u[h].clone());for(let h=0,d=l.length;h<d;h++){let f=l[h],p,v,m=f.vertexNormals,g=f.vertexColors,y=new aB(f.a+n,f.b+n,f.c+n);y.normal.copy(f.normal),r!==void 0&&y.normal.applyMatrix3(r).normalize();for(let x=0,_=m.length;x<_;x++)p=m[x].clone(),r!==void 0&&p.applyMatrix3(r).normalize(),y.vertexNormals.push(p);y.color.copy(f.color);for(let x=0,_=g.length;x<_;x++)v=g[x],y.vertexColors.push(v.clone());y.materialIndex=f.materialIndex+i,o.push(y)}for(let h=0,d=e.faceVertexUvs.length;h<d;h++){let f=e.faceVertexUvs[h];this.faceVertexUvs[h]===void 0&&(this.faceVertexUvs[h]=[]);for(let p=0,v=f.length;p<v;p++){let m=f[p],g=[];for(let y=0,x=m.length;y<x;y++)g.push(m[y].clone());this.faceVertexUvs[h].push(g)}}}mergeMesh(e){if(!(e&&e.isMesh)){console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e);return}e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)}mergeVertices(e=4){let t={},i=[],r=[],n=Math.pow(10,e);for(let o=0,l=this.vertices.length;o<l;o++){let c=this.vertices[o],u=Math.round(c.x*n)+"_"+Math.round(c.y*n)+"_"+Math.round(c.z*n);t[u]===void 0?(t[u]=o,i.push(this.vertices[o]),r[o]=i.length-1):r[o]=r[t[u]]}let s=[];for(let o=0,l=this.faces.length;o<l;o++){let c=this.faces[o];c.a=r[c.a],c.b=r[c.b],c.c=r[c.c];let u=[c.a,c.b,c.c];for(let h=0;h<3;h++)if(u[h]===u[(h+1)%3]){s.push(o);break}}for(let o=s.length-1;o>=0;o--){let l=s[o];this.faces.splice(l,1);for(let c=0,u=this.faceVertexUvs.length;c<u;c++)this.faceVertexUvs[c].splice(l,1)}let a=this.vertices.length-i.length;return this.vertices=i,a}setFromPoints(e){this.vertices=[];for(let t=0,i=e.length;t<i;t++){let r=e[t];this.vertices.push(new N(r.x,r.y,r.z||0))}return this}sortFacesByMaterialIndex(){let e=this.faces,t=e.length;for(let o=0;o<t;o++)e[o]._id=o;function i(o,l){return o.materialIndex-l.materialIndex}e.sort(i);let r=this.faceVertexUvs[0],n=this.faceVertexUvs[1],s,a;r&&r.length===t&&(s=[]),n&&n.length===t&&(a=[]);for(let o=0;o<t;o++){let l=e[o]._id;s&&s.push(r[l]),a&&a.push(n[l])}s&&(this.faceVertexUvs[0]=s),a&&(this.faceVertexUvs[1]=a)}toJSON(){let e={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),this.parameters!==void 0){let f=this.parameters;for(let p in f)f[p]!==void 0&&(e[p]=f[p]);return e}let t=[];for(let f=0;f<this.vertices.length;f++){let p=this.vertices[f];t.push(p.x,p.y,p.z)}let i=[],r=[],n={},s=[],a={},o=[],l={};for(let f=0;f<this.faces.length;f++){let p=this.faces[f],v=!0,m=!1,g=this.faceVertexUvs[0][f]!==void 0,y=p.normal.length()>0,x=p.vertexNormals.length>0,_=p.color.r!==1||p.color.g!==1||p.color.b!==1,M=p.vertexColors.length>0,S=0;if(S=c(S,0,0),S=c(S,1,v),S=c(S,2,m),S=c(S,3,g),S=c(S,4,y),S=c(S,5,x),S=c(S,6,_),S=c(S,7,M),i.push(S),i.push(p.a,p.b,p.c),i.push(p.materialIndex),g){let T=this.faceVertexUvs[0][f];i.push(d(T[0]),d(T[1]),d(T[2]))}if(y&&i.push(u(p.normal)),x){let T=p.vertexNormals;i.push(u(T[0]),u(T[1]),u(T[2]))}if(_&&i.push(h(p.color)),M){let T=p.vertexColors;i.push(h(T[0]),h(T[1]),h(T[2]))}}function c(f,p,v){return v?f|1<<p:f&~(1<<p)}function u(f){let p=f.x.toString()+f.y.toString()+f.z.toString();return n[p]!==void 0||(n[p]=r.length/3,r.push(f.x,f.y,f.z)),n[p]}function h(f){let p=f.r.toString()+f.g.toString()+f.b.toString();return a[p]!==void 0||(a[p]=s.length,s.push(f.getHex())),a[p]}function d(f){let p=f.x.toString()+f.y.toString();return l[p]!==void 0||(l[p]=o.length/2,o.push(f.x,f.y)),l[p]}return e.data={},e.data.vertices=t,e.data.normals=r,s.length>0&&(e.data.colors=s),o.length>0&&(e.data.uvs=[o]),e.data.faces=i,e}clone(){return new QA().copy(this)}copy(e){this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;let t=e.vertices;for(let h=0,d=t.length;h<d;h++)this.vertices.push(t[h].clone());let i=e.colors;for(let h=0,d=i.length;h<d;h++)this.colors.push(i[h].clone());let r=e.faces;for(let h=0,d=r.length;h<d;h++)this.faces.push(r[h].clone());for(let h=0,d=e.faceVertexUvs.length;h<d;h++){let f=e.faceVertexUvs[h];this.faceVertexUvs[h]===void 0&&(this.faceVertexUvs[h]=[]);for(let p=0,v=f.length;p<v;p++){let m=f[p],g=[];for(let y=0,x=m.length;y<x;y++){let _=m[y];g.push(_.clone())}this.faceVertexUvs[h].push(g)}}let n=e.morphTargets;for(let h=0,d=n.length;h<d;h++){let f={};if(f.name=n[h].name,n[h].vertices!==void 0){f.vertices=[];for(let p=0,v=n[h].vertices.length;p<v;p++)f.vertices.push(n[h].vertices[p].clone())}if(n[h].normals!==void 0){f.normals=[];for(let p=0,v=n[h].normals.length;p<v;p++)f.normals.push(n[h].normals[p].clone())}this.morphTargets.push(f)}let s=e.morphNormals;for(let h=0,d=s.length;h<d;h++){let f={};if(s[h].vertexNormals!==void 0){f.vertexNormals=[];for(let p=0,v=s[h].vertexNormals.length;p<v;p++){let m=s[h].vertexNormals[p],g={};g.a=m.a.clone(),g.b=m.b.clone(),g.c=m.c.clone(),f.vertexNormals.push(g)}}if(s[h].faceNormals!==void 0){f.faceNormals=[];for(let p=0,v=s[h].faceNormals.length;p<v;p++)f.faceNormals.push(s[h].faceNormals[p].clone())}this.morphNormals.push(f)}let a=e.skinWeights;for(let h=0,d=a.length;h<d;h++)this.skinWeights.push(a[h].clone());let o=e.skinIndices;for(let h=0,d=o.length;h<d;h++)this.skinIndices.push(o[h].clone());let l=e.lineDistances;for(let h=0,d=l.length;h<d;h++)this.lineDistances.push(l[h]);let c=e.boundingBox;c!==null&&(this.boundingBox=c.clone());let u=e.boundingSphere;return u!==null&&(this.boundingSphere=u.clone()),this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this}toBufferGeometry(){let e=new IDe().fromGeometry(this),t=new Nt,i=new Float32Array(e.vertices.length*3);if(t.setAttribute("position",oM.call(new Qt(i,3),e.vertices)),e.normals.length>0){let r=new Float32Array(e.normals.length*3);t.setAttribute("normal",oM.call(new Qt(r,3),e.normals))}if(e.colors.length>0){let r=new Float32Array(e.colors.length*3);t.setAttribute("color",SW.call(new Qt(r,3),e.colors))}if(e.uvs.length>0){let r=new Float32Array(e.uvs.length*2);t.setAttribute("uv",MW.call(new Qt(r,2),e.uvs))}if(e.uvs2.length>0){let r=new Float32Array(e.uvs2.length*2);t.setAttribute("uv2",MW.call(new Qt(r,2),e.uvs2))}t.groups=e.groups;for(let r in e.morphTargets){let n=[],s=e.morphTargets[r];for(let a=0,o=s.length;a<o;a++){let l=s[a],c=new _t(l.data.length*3,3);c.name=l.name,n.push(oM.call(c,l.data))}t.morphAttributes[r]=n}if(e.skinIndices.length>0){let r=new _t(e.skinIndices.length*4,4);t.setAttribute("skinIndex",EW.call(r,e.skinIndices))}if(e.skinWeights.length>0){let r=new _t(e.skinWeights.length*4,4);t.setAttribute("skinWeight",EW.call(r,e.skinWeights))}return e.boundingSphere!==null&&(t.boundingSphere=e.boundingSphere.clone()),e.boundingBox!==null&&(t.boundingBox=e.boundingBox.clone()),t}computeTangents(){console.error("THREE.Geometry: .computeTangents() has been removed.")}computeLineDistances(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")}applyMatrix(e){return console.warn("THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}dispose(){this.dispatchEvent({type:"dispose"})}static createBufferGeometryFromObject(e){let t=new Nt,i=e.geometry;if(e.isPoints||e.isLine){let r=new _t(i.vertices.length*3,3),n=new _t(i.colors.length*3,3);if(t.setAttribute("position",oM.call(r,i.vertices)),t.setAttribute("color",SW.call(n,i.colors)),i.lineDistances&&i.lineDistances.length===i.vertices.length){let s=new _t(i.lineDistances.length,1);t.setAttribute("lineDistance",LDe.call(s,i.lineDistances))}i.boundingSphere!==null&&(t.boundingSphere=i.boundingSphere.clone()),i.boundingBox!==null&&(t.boundingBox=i.boundingBox.clone())}else e.isMesh&&(t=i.toBufferGeometry());return t}};QA.prototype.isGeometry=!0;var IDe=class{constructor(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}computeGroups(e){let t=[],i,r,n,s=e.faces;for(r=0;r<s.length;r++){let a=s[r];a.materialIndex!==n&&(n=a.materialIndex,i!==void 0&&(i.count=r*3-i.start,t.push(i)),i={start:r*3,materialIndex:n})}i!==void 0&&(i.count=r*3-i.start,t.push(i)),this.groups=t}fromGeometry(e){let t=e.faces,i=e.vertices,r=e.faceVertexUvs,n=r[0]&&r[0].length>0,s=r[1]&&r[1].length>0,a=e.morphTargets,o=a.length,l;if(o>0){l=[];for(let m=0;m<o;m++)l[m]={name:a[m].name,data:[]};this.morphTargets.position=l}let c=e.morphNormals,u=c.length,h;if(u>0){h=[];for(let m=0;m<u;m++)h[m]={name:c[m].name,data:[]};this.morphTargets.normal=h}let d=e.skinIndices,f=e.skinWeights,p=d.length===i.length,v=f.length===i.length;i.length>0&&t.length===0&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(let m=0;m<t.length;m++){let g=t[m];this.vertices.push(i[g.a],i[g.b],i[g.c]);let y=g.vertexNormals;if(y.length===3)this.normals.push(y[0],y[1],y[2]);else{let _=g.normal;this.normals.push(_,_,_)}let x=g.vertexColors;if(x.length===3)this.colors.push(x[0],x[1],x[2]);else{let _=g.color;this.colors.push(_,_,_)}if(n===!0){let _=r[0][m];_!==void 0?this.uvs.push(_[0],_[1],_[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",m),this.uvs.push(new Me,new Me,new Me))}if(s===!0){let _=r[1][m];_!==void 0?this.uvs2.push(_[0],_[1],_[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",m),this.uvs2.push(new Me,new Me,new Me))}for(let _=0;_<o;_++){let M=a[_].vertices;l[_].data.push(M[g.a],M[g.b],M[g.c])}for(let _=0;_<u;_++){let M=c[_].vertexNormals[m];h[_].data.push(M.a,M.b,M.c)}p&&this.skinIndices.push(d[g.a],d[g.b],d[g.c]),v&&this.skinWeights.push(f[g.a],f[g.b],f[g.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),this}},aB=class{constructor(e,t,i,r,n,s=0){this.a=e,this.b=t,this.c=i,this.normal=r&&r.isVector3?r:new N,this.vertexNormals=Array.isArray(r)?r:[],this.color=n&&n.isColor?n:new Yt,this.vertexColors=Array.isArray(n)?n:[],this.materialIndex=s}clone(){return new this.constructor().copy(this)}copy(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(let t=0,i=e.vertexNormals.length;t<i;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(let t=0,i=e.vertexColors.length;t<i;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}};function LDe(e){return this.array.set(e),this}function SW(e){let t=this.array,i=0;for(let r=0,n=e.length;r<n;r++){let s=e[r];s===void 0&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r),s=new Yt),t[i++]=s.r,t[i++]=s.g,t[i++]=s.b}return this}function MW(e){let t=this.array,i=0;for(let r=0,n=e.length;r<n;r++){let s=e[r];s===void 0&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r),s=new Me),t[i++]=s.x,t[i++]=s.y}return this}function oM(e){let t=this.array,i=0;for(let r=0,n=e.length;r<n;r++){let s=e[r];s===void 0&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r),s=new N),t[i++]=s.x,t[i++]=s.y,t[i++]=s.z}return this}function EW(e){let t=this.array,i=0;for(let r=0,n=e.length;r<n;r++){let s=e[r];s===void 0&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r),s=new ai),t[i++]=s.x,t[i++]=s.y,t[i++]=s.z,t[i++]=s.w}return this}var ODe=["a","b","c"];function zDe(e,t){switch(t){case"c":return e.c;case"b":return e.b;case"a":default:return e.a}}function SR(e,t,i){let r=Math.min(e,t),n=Math.max(e,t),s=r+"_"+n;return i.get(s)}function MR(e,t,i,r,n,s){let a=Math.min(e,t),o=Math.max(e,t),l=a+"_"+o,c;if(r.has(l))c=r.get(l);else{let u=i[a],h=i[o];c={a:u,b:h,newEdge:null,faces:[]},r.set(l,c)}c.faces.push(n),s[e].edges.push(c),s[t].edges.push(c)}function BDe(e,t,i,r){let n,s,a;for(n=0,s=e.length;n<s;n++)i[n]={edges:[]};for(n=0,s=t.length;n<s;n++)a=t[n],MR(a.a,a.b,e,r,a,i),MR(a.b,a.c,e,r,a,i),MR(a.c,a.a,e,r,a,i)}function lM(e,t,i,r,n){e.push(new aB(t,i,r,void 0,void 0,n))}function Bg(e,t){return Math.abs(t-e)/2+Math.min(e,t)}function cM(e,t,i,r){e.push([t.clone(),i.clone(),r.clone()])}var FDe=class{constructor(e=1){this.subdivisions=e}modify(e){e instanceof Nt?e=new QA().fromBufferGeometry(e):e=e.clone(),e.mergeVertices();let t=this.subdivisions;for(;t-- >0;)this._smooth(e);return e.computeFaceNormals(),e.computeVertexNormals(),e}_smooth(e){let t=new N,i,r,n,s,a,o=e.vertices,l=e.faces,c=e.faceVertexUvs[0],u=c!==void 0&&c.length>0,h=[],d=new Map;BDe(o,l,h,d);let f=[],p,v,m,g,y,x,_;for(let ne of Array.from(d.keys())){for(v=d.get(ne),m=new N,y=3/8,x=1/8,_=v.faces.length,_!=2&&(y=.5,x=0,_!=1),m.addVectors(v.a,v.b).multiplyScalar(y),t.set(0,0,0),s=0;s<_;s++){for(g=v.faces[s],a=0;a<3&&(p=o[zDe(g,ODe[a])],!(p!==v.a&&p!==v.b));a++);p&&t.add(p)}t.multiplyScalar(x),m.add(t),v.newEdge=f.length,f.push(m)}let M,S,T,E,C,A,D,R=[];for(r=0,n=o.length;r<n;r++){for(A=o[r],C=h[r].edges,i=C.length,i==3?M=3/16:i>3&&(M=3/(8*i)),S=1-i*Number(M),T=M,i<=2&&(i==2?(S=3/4,T=1/8):i==1||i==0),D=A.clone().multiplyScalar(S),t.set(0,0,0),s=0;s<i;s++)E=C[s],p=E.a!==A?E.a:E.b,t.add(p);t.multiplyScalar(Number(T)),D.add(t),R.push(D)}let L=R.concat(f),O=R.length,H,j,Y,z=[],V=[],U,k,X,re,q=new Me,ee=new Me,$=new Me;for(r=0,n=l.length;r<n;r++)g=l[r],H=Number(SR(g.a,g.b,d).newEdge)+O,j=Number(SR(g.b,g.c,d).newEdge)+O,Y=Number(SR(g.c,g.a,d).newEdge)+O,lM(z,H,j,Y,g.materialIndex),lM(z,g.a,H,Y,g.materialIndex),lM(z,g.b,j,H,g.materialIndex),lM(z,g.c,Y,j,g.materialIndex),u&&(U=c[r],k=U[0],X=U[1],re=U[2],q.set(Bg(k.x,X.x),Bg(k.y,X.y)),ee.set(Bg(X.x,re.x),Bg(X.y,re.y)),$.set(Bg(k.x,re.x),Bg(k.y,re.y)),cM(V,q,ee,$),cM(V,k,q,$),cM(V,X,ee,q),cM(V,re,$,ee));e.vertices=L,e.faces=z,u&&(e.faceVertexUvs[0]=V)}},kn=new N,UDe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=e.geometry??(t==null?void 0:t.geometry)??new Nt().copy(new ac(100,100,100)),r;t===void 0?(i.computeBoundingBox(),i.boundingBox.getSize(kn),r={width:kn.x,height:kn.y,depth:kn.z,subdivisions:0}):r=t.parameters;let n={...r,...e.parameters};return{parameters:{width:Math.abs(n.width),height:Math.abs(n.height),depth:Math.abs(n.depth),subdivisions:Math.abs(n.subdivisions)},geometry:i}}static build(e){let{width:t,height:i,depth:r,subdivisions:n}=e.parameters,s=e.geometry??new Nt().copy(new ac(100,100,100)),a=s.userData.parameters;a===void 0?(s.computeBoundingBox(),s.boundingBox.getSize(kn)):kn.set(a.width,a.height,a.depth),(t!==kn.x||i!==kn.y||r!==kn.z)&&s.scale(kn.x===0?1:t/kn.x,kn.y===0?1:i/kn.y,kn.z===0?1:r/kn.z);let o=s.originalGeometry;try{n>0?(o===void 0||(a==null?void 0:a.subdivisions)!==n)&&(o===void 0&&(o=s),s=new FDe(n).modify(o).toBufferGeometry()):(o!==void 0&&(s=o),o=void 0,s.getAttribute("normal")===void 0&&s.computeVertexNormals())}catch{o!==void 0&&(s=o),o=void 0,s.getAttribute("normal")===void 0&&s.computeVertexNormals()}return o!==void 0&&Object.assign(s,{originalGeometry:o}),delete e.geometry,Object.assign(s,{userData:{...e,type:"NonParametricGeometry"}})}static loadFromUrl(e,t,i){new f$(i).load(e,r=>{let n=this.normalizeInputs({geometry:r});r.boundingBox.getSize(kn);let s=100/kn.x;Object.assign(n.parameters,{width:100,height:kn.y*s,depth:kn.z*s}),t(this.build(n))})}},ote=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,depth:0,spikes:5,cornerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:3},e.parameters);return{shape:e.shape&&e.shape instanceof tn?e.shape:new tn,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)})}}static build(e){let{width:t,height:i,spikes:r,cornerRadius:n,depth:s,extrudeBevelSize:a,extrudeBevelSegments:o}=e.parameters,l=e.shape,c=t*.5,u=i*.5,h=0,d=0,f=2*Math.PI/r;for(let v=0;v<r;v++){let m=f*v,g=h+Math.sin(m)*c,y=d+Math.cos(m)*u;l.addPoint(l.createPoint(g,y))}l.isClosed=!0;for(let v=0,m=l.points.length;v<m;v++)l.points[v].roundness=n;l.roundness=n,l.update();let p=Ym.create({shape:l,parameters:{roundness:n,depth:s,extrudeBevelSize:a,extrudeBevelSegments:o}});return Object.assign(p,{userData:{...e,type:"PolygonGeometry"}})}},NDe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,radialSegments:4,heightSegments:1,cornerRadius:0,cornerSegments:8,openEnded:!1},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,height:i,depth:r,radialSegments:n,heightSegments:s,openEnded:a,cornerRadius:o,cornerSegments:l}=e.parameters,c=new VDe(t*.5,i,n,s,a,o,l);return c.scale(1,1,r/t),Object.assign(c,{userData:{...e,type:"PyramidGeometry"}})}};function S1(e,t,i){i.x=e.x*t.x,i.y=e.y,i.z=e.x*t.y}function ER(e,t,i,r,n,s){let a=t.clone().sub(e),o=i.clone().sub(e),l=a.angleTo(o);if(a.normalize(),o.normalize(),r===n){let c=a.add(o).normalize();s.copy(e).addScaledVector(c,r/Math.sin(l/2))}else{let c=a.angleTo(o);s.copy(e),s.addScaledVector(a,n/Math.sin(c)),s.addScaledVector(o,r/Math.sin(c))}}function kDe(e,t,i){let r=e.clone().sub(t),n=i.clone().sub(t);return r.projectOnVector(n),r.add(t)}var VDe=class extends Nt{constructor(e=.5,t=1,i=4,r=1,n=!1,s=0,a=4){super(),i=Math.floor(Math.max(3,i)),r=Math.floor(r),a=Math.floor(a);let o=[],l=[],c=[],u=[],h=0,d=t/2,f=Math.PI/i,p=e*Math.cos(Math.PI/i),v=2*Math.PI/i,m=(i-2)*Math.PI/i,g=Math.PI-m,y=new N(0,-d,0),x=new N(0,d,0),_=new Me(e,-d),M=new Me(p,-d),S=new Me(0,x.y).sub(M),T=new Me(0,x.y).sub(_),E=new Me(S.y,-S.x).normalize(),C=new Me(T.y,-T.x).normalize(),A=e*Math.cos(Math.PI/i)*Math.tan((Math.PI-S.angle())/2)-1e-8;s=Math.min(s,A);let D;{let Y=new N(E.x,E.y,0),z=new N(Math.cos(v)*Y.x,Y.y,Math.sin(v)*Y.x);D=Y.angleTo(z)}let R=s/Math.tan((Math.PI-S.angle())/2),L=s/Math.tan((Math.PI-D)/2),O=new N;if(!n){l.push(y.x,y.y,y.z),c.push(0,-1,0),u.push(0,0);let Y=h++,z=[],V=_.clone(),U=R/Math.cos(Math.PI/i);V.x-=U;for(let k=0;k<i;k++){let X=k/i*Math.PI*2+f,re=new Me(Math.sin(X),Math.cos(X));S1(V,re,O),l.push(O.x,O.y,O.z),c.push(0,-1,0),u.push(0,0),z.push(h++)}for(let k=0;k<z.length;k++)o.push(z[k],Y,z[(k+1)%z.length])}{let Y=new N,z=new N,V=new N,U=new N,k=new N,X=new N;for(let re=0;re<i;re++){let q=re/i*Math.PI*2+f,ee=(re+.5)/i*Math.PI*2+f,$=(re+1)/i*Math.PI*2+f,ne=new Me(Math.sin(q),Math.cos(q)),ce=new Me(Math.sin(ee),Math.cos(ee)),pe=new Me(Math.sin($),Math.cos($));S1(_,ne,z),S1(_,pe,V),S1(E,ce,Y),ER(x,z,V,L,L,U),l.push(U.x,U.y,U.z),ER(z,x,V,L,R,k),l.push(k.x,k.y,k.z),ER(V,z,x,R,L,X),l.push(X.x,X.y,X.z),c.push(Y.x,Y.y,Y.z),c.push(Y.x,Y.y,Y.z),c.push(Y.x,Y.y,Y.z),u.push(0,0),u.push(0,0),u.push(0,0);let ge=h++,we=h++,le=h++;if(o.push(ge,we,le),s>0){{let Ce=z.clone().add(V).multiplyScalar(.5),Pe=x.clone().sub(Ce).normalize(),Ne=y.clone().sub(Ce).normalize().add(Pe).normalize().multiplyScalar(-1),be=X.clone().sub(k);H(Ce,be,Ne,S.angle())}let ve,ie;{let Ce=new N;S1(C,pe,Ce);let Pe=X.clone().add(U).multiplyScalar(.5);Pe=kDe(Pe,V,x);let Ne=X.clone().sub(U);[ve,ie]=H(Pe,Ne,Ce,D,U.y)}{let Ce=ve,Pe=Ce.clone().setY(0).normalize(),Ne=new N(0,-1,0),be=Pe.clone().cross(Ne);j(Ce,Pe,Ne,be)}{let Ce=S.angle(),Pe=Math.PI-Ce,Ne=x.clone();Ne.y-=s/Math.sin(Ce-Math.PI/2);let be=new N,Le=[];for(let K=0;K<a;K++){let B=[],G=Math.PI/2-Pe*K/a,oe=Math.cos(G),fe=Math.sin(G),W=ee;for(let Ie=0;Ie<=K;Ie++){let Oe=Math.cos(W),Be=Math.sin(W);Y.x=oe*Be,Y.y=fe,Y.z=oe*Oe,be.copy(Ne).addScaledVector(Y,s),l.push(be.x,be.y,be.z),c.push(Y.x,Y.y,Y.z),u.push(0,0),B.push(h++),W+=Math.PI*2/K/i}Le.push(B)}ie.reverse(),Le.push(ie);let Fe=Le.length-1;for(let K=0;K<Fe;K++){let B=Le[K],G=Le[K+1],oe=B.length-1;o.push(G[1],B[0],G[0]);for(let fe=1;fe<=oe;fe++)o.push(B[fe],B[fe-1],G[fe]),o.push(G[fe+1],B[fe],G[fe])}}}}}this.setIndex(o),this.setAttribute("position",new _t(l,3)),this.setAttribute("normal",new _t(c,3)),this.setAttribute("uv",new _t(u,2));function H(Y,z,V,U,k){let X=-U/2,re=(Math.PI-U)/2,q=z.clone().normalize().cross(V);Y.addScaledVector(V,-s/Math.sin(re));let ee=new N,$=new N,ne=1,ce=h,pe=[];for(let ge=0;ge<=a;ge++){let we=X+ge/a*U;$.set(0,0,0),$.addScaledVector(q,Math.sin(we)),$.addScaledVector(V,Math.cos(we));for(let le=0;le<=ne;le++){let ve=le/ne-.5;if(ee.copy(Y),ee.addScaledVector(z,ve),ee.addScaledVector($,s),k!=null){let ie=Math.max(0,ee.y-k);ee.addScaledVector(z,-ie/z.y)}l.push(ee.x,ee.y,ee.z),c.push($.x,$.y,$.z),u.push(0,0),le===0&&pe.push(h),h++}}for(let ge=0;ge<a;ge++)for(let we=0;we<ne;we++){let le=ce+we+(ne+1)*ge,ve=le+(ne+1),ie=ve+1,Ce=le+1;o.push(le,ve,Ce),o.push(ve,ie,Ce)}return[Y.clone().addScaledVector(z,.5),pe]}function j(Y,z,V,U){let k=Math.PI/2,X=T.angle()-k,re=[],q=new N,ee=new N;for(let ne=0;ne<=a;ne++){let ce=[],pe=ne/a;for(let ge=0;ge<=ne;ge++){let we=((ne?ge/ne:0)-.5)*g,le=Math.cos(we),ve=Math.sin(we),ie=Math.atan(Math.tan(X)*le),Ce=(k+ie)*pe,Pe=Math.cos(Ce),Ne=Math.sin(Ce);q.set(0,0,0),q.addScaledVector(z,Ne*le),q.addScaledVector(V,Pe),q.addScaledVector(U,Ne*ve),ee.copy(Y).addScaledVector(q,s),l.push(ee.x,ee.y,ee.z),c.push(q.x,q.y,q.z),u.push(0,0),ce.push(h++)}re.push(ce)}let $=re.length-1;for(let ne=0;ne<$;ne++){let ce=re[ne],pe=re[ne+1],ge=ce.length-1;o.push(ce[0],pe[1],pe[0]);for(let we=1;we<=ge;we++)o.push(ce[we-1],ce[we],pe[we]),o.push(ce[we],pe[we+1],pe[we])}}}},YN=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,depth:0,cornerRadius:[0,0,0,0],cornerType:1,extrudeBevelSize:0,extrudeBevelSegments:1},e.parameters),r=Object.assign((t==null?void 0:t.ui)??{enabledIndieCorners:!1},e.ui);return{shape:e.shape&&e.shape instanceof tn?e.shape:new tn,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)}),ui:r}}static build(e){let t=e.shape,{width:i,height:r,cornerRadius:n,cornerType:s,depth:a,extrudeBevelSize:o,extrudeBevelSegments:l}=e.parameters,c={x:i*.5,y:r*.5},u={x:-c.x,y:-c.y},h={x:c.x,y:c.y};function d(_,M,S){return M>i&&S>r?Math.min(_*i/M,_*r/S):M>i?_*i/M:S>r?_*r/S:_}let f=[];f[0]=n[0]===0?0:d(n[0],n[0]+n[3],n[0]+n[1]),f[1]=n[1]===0?0:d(n[1],n[1]+n[2],n[1]+n[0]),f[2]=n[2]===0?0:d(n[2],n[2]+n[1],n[2]+n[3]),f[3]=n[3]===0?0:d(n[3],n[3]+n[0],n[3]+n[2]);let p=u.x,v=h.x,m=h.y,g=u.y;t.addPoint(t.createPoint(p,m)),t.addPoint(t.createPoint(v,m)),t.addPoint(t.createPoint(v,g)),t.addPoint(t.createPoint(p,g)),t.isClosed=!0;let y=!0;for(let _=0,M=t.points.length;_<M;_++)t.points[_].roundness=f[_],_>0&&f[_]!==f[_-1]&&(y=!1);y&&(t.roundness=f[0]),t.useCubicForRoundedCorners=s!==1,t.update();let x=Ym.create({shape:t,parameters:{depth:a,extrudeBevelSize:o,extrudeBevelSegments:l}});return Object.assign(x,{userData:{...e,type:"RectangleGeometry"}})}},GDe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,widthSegments:64,heightSegments:64,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:180},e.parameters);return i.thetaLength=Tt.clamp(i.thetaLength,0,180),{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t=100,height:i=t,depth:r=t,widthSegments:n=64,heightSegments:s=64,phiStart:a,phiLength:o,thetaStart:l,thetaLength:c}=e.parameters,u;return c===0?(u=new Nt,u.setAttribute("position",new _t([],3))):u=new l0(.5*t,n,s,a,o,l,c*Tt.DEG2RAD),u.scale(1,i/t,r/t),Object.assign(u,{userData:{...e,type:"SphereGeometry"}})}},HDe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,depth:0,widthSegments:8,heightSegments:8},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:0})}}static build(e){let{width:t=100,height:i=t,widthSegments:r=8,heightSegments:n=8}=e.parameters,s=new au(t,i,r,n);return s.scale(1,1,1),Object.assign(s,{userData:{...e,type:"PlaneGeometry"}})}},jDe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,angle:90,cornerRadius:24,cornerSegments:8},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,height:i,depth:r,angle:n,cornerRadius:s,cornerSegments:a}=e.parameters,o=new WDe(t,i,r,n,s,a);return Object.assign(o,{userData:{...e,type:"BackdropGeometry"}})}},WDe=class extends Nt{constructor(e=1,t=1,i=1,r=90,n=10,s=24){super(),this.type="BackdropGeometry";let a=[],o=[],l=[],c=.001;n==0&&(s=1),s=Math.max(1,Math.floor(s)),n=Math.min(n,100),r=Math.min(180-c,r),r*=Math.PI/180;let u=[],h=Math.PI/2,d=(ne=0,ce=0,pe=0)=>new N(ne,ce,pe),f=d(),p=d(),[v,m,g]=[t/2,e/2,i/2],y=-m,x=+m,[_,M,S]=[d(y,-v,+g),d(y,-v,-g),d(y,+v,-g)],T=(ne,ce=!1)=>Math.sin(ne-Math.PI/(1+ +ce)),E=(ne,ce=!1)=>Math.cos(ne-Math.PI/(1+ +ce));S.y=Math.sin(r)*t-v;let C=Math.cos(r)*t-g,A=_.z-c;r<=h?(S.z=Math.min(C,A),S.z==A&&(S.y-=(C-A)/Math.tan(h-r))):M.z=Math.min(M.z-C-g,_.z-c),f.subVectors(_,M),p.subVectors(S,M);let D=Math.min(f.length(),p.length())*n/100,R=D*Math.tan(r/2),L=D/Math.cos(r/2),O=f.clone().normalize().add(p.normalize()).setLength(L).add(M);f.set(0,T(r,!0),E(r,!0)),u.push([S,f.clone()]);let H=(Math.PI-r)/s;for(let ne=0;ne<=s;ne++){let ce=h+r+ne*H;f.set(0,Math.sin(ce)*R,Math.cos(ce)*R),f.add(O),p.set(0,T(ce),E(ce)),u.push([f.clone(),p.clone()])}u.push([_,d(0,1,0)]);let j=Math.sin(H/2)*R*2,Y=u.length-1,z=u[0][0].distanceTo(u[1][0]),V=u[Y-1][0].distanceTo(u[Y][0]),U=z+j*s+V;u[0].push(1);for(let ne=0;ne<=s;ne++)u[ne+1].push(1-(z+ne*j)/U);u[Y].push(0);let[k,X,re]=u[0],q,ee,$;for(let ne=1;ne<u.length;ne++)[q,ee,$]=u[ne],a.push(y,k.y,k.z,y,q.y,q.z,x,k.y,k.z,x,k.y,k.z,y,q.y,q.z,x,q.y,q.z),o.push(0,X.y,X.z,0,ee.y,ee.z,0,X.y,X.z,0,X.y,X.z,0,ee.y,ee.z,0,ee.y,ee.z),l.push(0,re,0,$,1,re,1,re,0,$,1,$),[k,X,re]=[q,ee,$];this.setAttribute("position",new _t(a,3)),this.setAttribute("normal",new _t(o,3)),this.setAttribute("uv",new _t(l,2))}},lte=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,depth:0,innerRadiusPercent:38.19,spikes:5,cornerRadius:0,angle:360,extrudeBevelSize:0,extrudeBevelSegments:1},e.parameters);return{shape:e.shape&&e.shape instanceof tn?e.shape:new tn,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)})}}static build(e){let{width:t,height:i,innerRadiusPercent:r,spikes:n,cornerRadius:s,angle:a,depth:o,extrudeBevelSize:l,extrudeBevelSegments:c}=e.parameters,u=e.shape,h=t*.5,d=i*.5,f=0,p=0,v=a*Math.PI/360/n,m=Math.PI/2*3*-1,g=h*r/100,y=d*r/100;if(n===3&&r===50){v=2*Math.PI/n;for(let _=0;_<n;_++){let M=v*_,S=f+Math.sin(M)*h,T=p+Math.cos(M)*d;u.addPoint(u.createPoint(S,T))}}else for(let _=0;_<n;_++){let M=f+Math.cos(m)*h,S=p+Math.sin(m)*d;u.addPoint(u.createPoint(M,S)),m+=v,M=f+Math.cos(m)*g,S=p+Math.sin(m)*y,u.addPoint(u.createPoint(M,S)),m+=v}u.isClosed=!0;for(let _=0,M=u.points.length;_<M;_++)u.points[_].roundness=s;u.roundness=s,u.update();let x=Ym.create({shape:u,parameters:{roundness:s,depth:o,extrudeBevelSize:l,extrudeBevelSegments:c}});return Object.assign(x,{userData:{...e,type:"StarGeometry"}})}},XDe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,depth:0},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)})}}static build(e){let{width:t,height:i}=e.parameters,r=new au(t,i);return Object.assign(r,{userData:{...e,type:"TextFrameGeometry"}})}},qDe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,radialSegments:32,tubularSegments:64,arc:360,cornerRadius:30,cornerSegments:8},e.parameters),r=Math.abs(i.width),n=Math.abs(i.height??i.width);i.shapeBlendNode&&(n=r);let s=Math.round(Math.abs(i.depth??i.width*.25));return{parameters:Object.assign(i,{width:r,height:n,depth:s})}}static build(e){let{width:t,height:i,depth:r,radialSegments:n,tubularSegments:s,arc:a,cornerRadius:o,cornerSegments:l}=e.parameters,c=YDe(t,i,r,t*.5,a,s,0,0,n,o,l);return c.scale(1,i/t,1),Object.assign(c,{userData:{...e,type:"TorusGeometry"}})}};function YDe(e,t,i,r,n,s,a,o,l,c,u){[t,i]=[i,t],a=t/2;let h=Tt.clamp(n/360,0,1);if(h===0){let d=new Nt;return d.setAttribute("position",new _t([],3)),d}return h===1&&(c=0),new ste(!0,e,t,i,r,h,s,a,o,l,c,u)}var QDe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,tubularSegments:64,radialSegments:32,p:2,q:3},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width),tube:i.tube??i.width*.125})}}static build(e){let{width:t,tube:i,tubularSegments:r,radialSegments:n,p:s,q:a}=e.parameters,o=t*.5;o!==i&&(o-=i);let l=new a$(o,i,r,n,s,a);return Object.assign(l,{userData:{...e,type:"TorusKnotGeometry"}})}},ZDe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,depth:0,spikes:5,cornerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:1,isRect:!1},e.parameters);return{shape:e.shape&&e.shape instanceof tn?e.shape:new tn,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width*(i.isRect?1:Math.sqrt(3)/2)),depth:Math.abs(i.depth??0)})}}static build(e){let{width:t=100,height:i,cornerRadius:r,depth:n,extrudeBevelSize:s,extrudeBevelSegments:a,isRect:o}=e.parameters,l=e.shape,c=t*.5,u=i*.5;o?(l.addPoint(l.createPoint(-c,u)),l.addPoint(l.createPoint(c,-u)),l.addPoint(l.createPoint(-c,-u))):(l.addPoint(l.createPoint(0,u)),l.addPoint(l.createPoint(c,-u)),l.addPoint(l.createPoint(-c,-u))),l.isClosed=!0;for(let d=0,f=l.points.length;d<f;d++)l.points[d].roundness=r;l.roundness=r,l.update();let h=Ym.create({shape:l,parameters:{roundness:r,depth:n,extrudeBevelSize:s,extrudeBevelSegments:a}});return Object.assign(h,{userData:{...e,type:"TriangleGeometry"}})}};function KDe(e,t){let i=2*Math.PI;return(e%i+i)%i===(t%i+i)%i}function JDe(e){return/^(rgba)?\(\s*(\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+(?:\.\d+)?))?\s*\)$/.exec(e.toLowerCase())}function $De(e,t,i){let r,n,s,a=Math.floor(e*6),o=e*6-a,l=i*(1-t),c=i*(1-o*t),u=i*(1-(1-o)*t);switch(a%6){case 0:r=i,n=u,s=l;break;case 1:r=c,n=i,s=l;break;case 2:r=l,n=i,s=u;break;case 3:r=l,n=c,s=i;break;case 4:r=u,n=l,s=i;break;case 5:default:r=i,n=l,s=c;break}return{r:r*255,g:n*255,b:s*255}}function eRe(e,t,i){e/=255,t/=255,i/=255;let r=Math.max(e,t,i),n=Math.min(e,t,i),s=r,a=r-n,o=r==0?0:a/r,l;if(r==n)l=0;else{switch(r){case e:l=(t-i)/a+(t<i?6:0);break;case t:l=(i-e)/a+2;break;case i:default:l=(e-t)/a+4;break}l/=6}return{h:l,s:o,v:s}}function tRe(e){return e=Math.floor(e),{r:e>>16&255,g:e>>8&255,b:e&255}}function iRe(e,t,i){return(e<<16)+(t<<8)+i}function rRe(e,t,i){return e=Math.round(e),t=Math.round(t),i=Math.round(i),"#"+[e,t,i].map(r=>r.toString(16).padStart(2,"0")).join("").toUpperCase()}function nRe(e){let t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;e=e.replace(t,(r,n,s,a)=>String(n+n+s+s+a+a));let i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return i?{r:parseInt(i[1],16),g:parseInt(i[2],16),b:parseInt(i[3],16)}:null}var sRe={parseRgba:JDe,hsvToRgb:$De,rgbToHsv:eRe,hexToRgb:tRe,rgbToHex:iRe,rgbToHexString:rRe,hexStringToRgb:nRe},aRe=class{add(e,t,i){if(typeof arguments[0]!="string")for(let r in arguments[0])this.add(r,arguments[0][r],arguments[1]);else(Array.isArray(e)?e:[e]).forEach(function(r){this[r]=this[r]||[],t&&this[r][i?"unshift":"push"](t)},this)}run(e,t){this[e]=this[e]||[],this[e].forEach(function(i){i.call(t&&t.context?t.context:t,t)})}},oRe=class{constructor(e){this.jsep=e,this.registered={}}register(...e){e.forEach(t=>{if(typeof t!="object"||!t.name||!t.init)throw new Error("Invalid JSEP plugin format");this.registered[t.name]||(t.init(this.jsep),this.registered[t.name]=t)})}},at=class{static get version(){return"1.3.8"}static toString(){return"JavaScript Expression Parser (JSEP) v"+at.version}static addUnaryOp(e){return at.max_unop_len=Math.max(e.length,at.max_unop_len),at.unary_ops[e]=1,at}static addBinaryOp(e,t,i){return at.max_binop_len=Math.max(e.length,at.max_binop_len),at.binary_ops[e]=t,i?at.right_associative.add(e):at.right_associative.delete(e),at}static addIdentifierChar(e){return at.additional_identifier_chars.add(e),at}static addLiteral(e,t){return at.literals[e]=t,at}static removeUnaryOp(e){return delete at.unary_ops[e],e.length===at.max_unop_len&&(at.max_unop_len=at.getMaxKeyLen(at.unary_ops)),at}static removeAllUnaryOps(){return at.unary_ops={},at.max_unop_len=0,at}static removeIdentifierChar(e){return at.additional_identifier_chars.delete(e),at}static removeBinaryOp(e){return delete at.binary_ops[e],e.length===at.max_binop_len&&(at.max_binop_len=at.getMaxKeyLen(at.binary_ops)),at.right_associative.delete(e),at}static removeAllBinaryOps(){return at.binary_ops={},at.max_binop_len=0,at}static removeLiteral(e){return delete at.literals[e],at}static removeAllLiterals(){return at.literals={},at}get char(){return this.expr.charAt(this.index)}get code(){return this.expr.charCodeAt(this.index)}constructor(e){this.expr=e,this.index=0}static parse(e){return new at(e).parse()}static getMaxKeyLen(e){return Math.max(0,...Object.keys(e).map(t=>t.length))}static isDecimalDigit(e){return e>=48&&e<=57}static binaryPrecedence(e){return at.binary_ops[e]||0}static isIdentifierStart(e){return e>=65&&e<=90||e>=97&&e<=122||e>=128&&!at.binary_ops[String.fromCharCode(e)]||at.additional_identifier_chars.has(String.fromCharCode(e))}static isIdentifierPart(e){return at.isIdentifierStart(e)||at.isDecimalDigit(e)}throwError(e){let t=new Error(e+" at character "+this.index);throw t.index=this.index,t.description=e,t}runHook(e,t){if(at.hooks[e]){let i={context:this,node:t};return at.hooks.run(e,i),i.node}return t}searchHook(e){if(at.hooks[e]){let t={context:this};return at.hooks[e].find(function(i){return i.call(t.context,t),t.node}),t.node}}gobbleSpaces(){let e=this.code;for(;e===at.SPACE_CODE||e===at.TAB_CODE||e===at.LF_CODE||e===at.CR_CODE;)e=this.expr.charCodeAt(++this.index);this.runHook("gobble-spaces")}parse(){this.runHook("before-all");let e=this.gobbleExpressions(),t=e.length===1?e[0]:{type:at.COMPOUND,body:e};return this.runHook("after-all",t)}gobbleExpressions(e){let t=[],i,r;for(;this.index<this.expr.length;)if(i=this.code,i===at.SEMCOL_CODE||i===at.COMMA_CODE)this.index++;else if(r=this.gobbleExpression())t.push(r);else if(this.index<this.expr.length){if(i===e)break;this.throwError('Unexpected "'+this.char+'"')}return t}gobbleExpression(){let e=this.searchHook("gobble-expression")||this.gobbleBinaryExpression();return this.gobbleSpaces(),this.runHook("after-expression",e)}gobbleBinaryOp(){this.gobbleSpaces();let e=this.expr.substr(this.index,at.max_binop_len),t=e.length;for(;t>0;){if(at.binary_ops.hasOwnProperty(e)&&(!at.isIdentifierStart(this.code)||this.index+e.length<this.expr.length&&!at.isIdentifierPart(this.expr.charCodeAt(this.index+e.length))))return this.index+=t,e;e=e.substr(0,--t)}return!1}gobbleBinaryExpression(){let e,t,i,r,n,s,a,o,l;if(s=this.gobbleToken(),!s||(t=this.gobbleBinaryOp(),!t))return s;for(n={value:t,prec:at.binaryPrecedence(t),right_a:at.right_associative.has(t)},a=this.gobbleToken(),a||this.throwError("Expected expression after "+t),r=[s,n,a];t=this.gobbleBinaryOp();){if(i=at.binaryPrecedence(t),i===0){this.index-=t.length;break}n={value:t,prec:i,right_a:at.right_associative.has(t)},l=t;let c=u=>n.right_a&&u.right_a?i>u.prec:i<=u.prec;for(;r.length>2&&c(r[r.length-2]);)a=r.pop(),t=r.pop().value,s=r.pop(),e={type:at.BINARY_EXP,operator:t,left:s,right:a},r.push(e);e=this.gobbleToken(),e||this.throwError("Expected expression after "+l),r.push(n,e)}for(o=r.length-1,e=r[o];o>1;)e={type:at.BINARY_EXP,operator:r[o-1].value,left:r[o-2],right:e},o-=2;return e}gobbleToken(){let e,t,i,r;if(this.gobbleSpaces(),r=this.searchHook("gobble-token"),r)return this.runHook("after-token",r);if(e=this.code,at.isDecimalDigit(e)||e===at.PERIOD_CODE)return this.gobbleNumericLiteral();if(e===at.SQUOTE_CODE||e===at.DQUOTE_CODE)r=this.gobbleStringLiteral();else if(e===at.OBRACK_CODE)r=this.gobbleArray();else{for(t=this.expr.substr(this.index,at.max_unop_len),i=t.length;i>0;){if(at.unary_ops.hasOwnProperty(t)&&(!at.isIdentifierStart(this.code)||this.index+t.length<this.expr.length&&!at.isIdentifierPart(this.expr.charCodeAt(this.index+t.length)))){this.index+=i;let n=this.gobbleToken();return n||this.throwError("missing unaryOp argument"),this.runHook("after-token",{type:at.UNARY_EXP,operator:t,argument:n,prefix:!0})}t=t.substr(0,--i)}at.isIdentifierStart(e)?(r=this.gobbleIdentifier(),at.literals.hasOwnProperty(r.name)?r={type:at.LITERAL,value:at.literals[r.name],raw:r.name}:r.name===at.this_str&&(r={type:at.THIS_EXP})):e===at.OPAREN_CODE&&(r=this.gobbleGroup())}return r?(r=this.gobbleTokenProperty(r),this.runHook("after-token",r)):this.runHook("after-token",!1)}gobbleTokenProperty(e){this.gobbleSpaces();let t=this.code;for(;t===at.PERIOD_CODE||t===at.OBRACK_CODE||t===at.OPAREN_CODE||t===at.QUMARK_CODE;){let i;if(t===at.QUMARK_CODE){if(this.expr.charCodeAt(this.index+1)!==at.PERIOD_CODE)break;i=!0,this.index+=2,this.gobbleSpaces(),t=this.code}this.index++,t===at.OBRACK_CODE?(e={type:at.MEMBER_EXP,computed:!0,object:e,property:this.gobbleExpression()},this.gobbleSpaces(),t=this.code,t!==at.CBRACK_CODE&&this.throwError("Unclosed ["),this.index++):t===at.OPAREN_CODE?e={type:at.CALL_EXP,arguments:this.gobbleArguments(at.CPAREN_CODE),callee:e}:(t===at.PERIOD_CODE||i)&&(i&&this.index--,this.gobbleSpaces(),e={type:at.MEMBER_EXP,computed:!1,object:e,property:this.gobbleIdentifier()}),i&&(e.optional=!0),this.gobbleSpaces(),t=this.code}return e}gobbleNumericLiteral(){let e="",t,i;for(;at.isDecimalDigit(this.code);)e+=this.expr.charAt(this.index++);if(this.code===at.PERIOD_CODE)for(e+=this.expr.charAt(this.index++);at.isDecimalDigit(this.code);)e+=this.expr.charAt(this.index++);if(t=this.char,t==="e"||t==="E"){for(e+=this.expr.charAt(this.index++),t=this.char,(t==="+"||t==="-")&&(e+=this.expr.charAt(this.index++));at.isDecimalDigit(this.code);)e+=this.expr.charAt(this.index++);at.isDecimalDigit(this.expr.charCodeAt(this.index-1))||this.throwError("Expected exponent ("+e+this.char+")")}return i=this.code,at.isIdentifierStart(i)?this.throwError("Variable names cannot start with a number ("+e+this.char+")"):(i===at.PERIOD_CODE||e.length===1&&e.charCodeAt(0)===at.PERIOD_CODE)&&this.throwError("Unexpected period"),{type:at.LITERAL,value:parseFloat(e),raw:e}}gobbleStringLiteral(){let e="",t=this.index,i=this.expr.charAt(this.index++),r=!1;for(;this.index<this.expr.length;){let n=this.expr.charAt(this.index++);if(n===i){r=!0;break}else if(n==="\\")switch(n=this.expr.charAt(this.index++),n){case"n":e+=`
`;break;case"r":e+="\r";break;case"t":e+="	";break;case"b":e+="\b";break;case"f":e+="\f";break;case"v":e+="\v";break;default:e+=n}else e+=n}return r||this.throwError('Unclosed quote after "'+e+'"'),{type:at.LITERAL,value:e,raw:this.expr.substring(t,this.index)}}gobbleIdentifier(){let e=this.code,t=this.index;for(at.isIdentifierStart(e)?this.index++:this.throwError("Unexpected "+this.char);this.index<this.expr.length&&(e=this.code,at.isIdentifierPart(e));)this.index++;return{type:at.IDENTIFIER,name:this.expr.slice(t,this.index)}}gobbleArguments(e){let t=[],i=!1,r=0;for(;this.index<this.expr.length;){this.gobbleSpaces();let n=this.code;if(n===e){i=!0,this.index++,e===at.CPAREN_CODE&&r&&r>=t.length&&this.throwError("Unexpected token "+String.fromCharCode(e));break}else if(n===at.COMMA_CODE){if(this.index++,r++,r!==t.length){if(e===at.CPAREN_CODE)this.throwError("Unexpected token ,");else if(e===at.CBRACK_CODE)for(let s=t.length;s<r;s++)t.push(null)}}else if(t.length!==r&&r!==0)this.throwError("Expected comma");else{let s=this.gobbleExpression();(!s||s.type===at.COMPOUND)&&this.throwError("Expected comma"),t.push(s)}}return i||this.throwError("Expected "+String.fromCharCode(e)),t}gobbleGroup(){this.index++;let e=this.gobbleExpressions(at.CPAREN_CODE);if(this.code===at.CPAREN_CODE)return this.index++,e.length===1?e[0]:e.length?{type:at.SEQUENCE_EXP,expressions:e}:!1;this.throwError("Unclosed (")}gobbleArray(){return this.index++,{type:at.ARRAY_EXP,elements:this.gobbleArguments(at.CBRACK_CODE)}}},lRe=new aRe;Object.assign(at,{hooks:lRe,plugins:new oRe(at),COMPOUND:"Compound",SEQUENCE_EXP:"SequenceExpression",IDENTIFIER:"Identifier",MEMBER_EXP:"MemberExpression",LITERAL:"Literal",THIS_EXP:"ThisExpression",CALL_EXP:"CallExpression",UNARY_EXP:"UnaryExpression",BINARY_EXP:"BinaryExpression",ARRAY_EXP:"ArrayExpression",TAB_CODE:9,LF_CODE:10,CR_CODE:13,SPACE_CODE:32,PERIOD_CODE:46,COMMA_CODE:44,SQUOTE_CODE:39,DQUOTE_CODE:34,OPAREN_CODE:40,CPAREN_CODE:41,OBRACK_CODE:91,CBRACK_CODE:93,QUMARK_CODE:63,SEMCOL_CODE:59,COLON_CODE:58,unary_ops:{"-":1,"!":1,"~":1,"+":1},binary_ops:{"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10},right_associative:new Set,additional_identifier_chars:new Set(["$","_"]),literals:{true:!0,false:!1,null:null},this_str:"this"});at.max_unop_len=at.getMaxKeyLen(at.unary_ops);at.max_binop_len=at.getMaxKeyLen(at.binary_ops);var W0=e=>new at(e).parse(),cRe=Object.getOwnPropertyNames(at);cRe.forEach(e=>{W0[e]===void 0&&e!=="prototype"&&(W0[e]=at[e])});W0.Jsep=at;var uRe="ConditionalExpression",hRe={name:"ternary",init(e){e.hooks.add("after-expression",function(t){if(t.node&&this.code===e.QUMARK_CODE){this.index++;let i=t.node,r=this.gobbleExpression();if(r||this.throwError("Expected expression"),this.gobbleSpaces(),this.code===e.COLON_CODE){this.index++;let n=this.gobbleExpression();if(n||this.throwError("Expected expression"),t.node={type:uRe,test:i,consequent:r,alternate:n},i.operator&&e.binary_ops[i.operator]<=.9){let s=i;for(;s.right.operator&&e.binary_ops[s.right.operator]<=.9;)s=s.right;t.node.test=s.right,s.right=t.node,t.node=i}}else this.throwError("Expected :")}})}};W0.plugins.register(hRe);function HC(e){return{all:e=e||new Map,on:function(t,i){var r=e.get(t);r?r.push(i):e.set(t,[i])},off:function(t,i){var r=e.get(t);r&&(i?r.splice(r.indexOf(i)>>>0,1):e.set(t,[]))},emit:function(t,i){var r=e.get(t);r&&r.slice().map(function(n){n(i)}),(r=e.get("*"))&&r.slice().map(function(n){n(t,i)})}}}var cte=class{constructor(e,t,i){var r;this.id=e,this.userAPI=t,this.result=void 0,this.error="null",this.isPrefetched=!1,this.isLoading=!1,this.isLoaded=!1,this.prefetchPromise=new Promise(n=>n()),this.emitter=HC(),this._innerCallUserAPI=async n=>{var s,a,o;this.emitter.emit("start",{userAPIId:this.id}),this.isLoading=!0,this.isLoading=!1;try{this.result=await gRe(this.userAPI,n),this.error="null",this.emitter.emit("success",{userAPIId:this.id})}catch(l){let c=((o=(a=(s=l.message)==null?void 0:s.split("_:_"))==null?void 0:a[0])==null?void 0:o.replace("status:",""))??"null";this.error=c,this.result=null,this.emitter.emit("error",{userAPIId:this.id})}this.isLoading=!1,this.isPrefetched=!0,this.isLoaded=!0},((r=t==null?void 0:t.integration)==null?void 0:r.type)==="OpenAI"?this.result={content:""}:t.method==="GET"&&t.url!==""&&(this.prefetchPromise=this.prefetch(i)),this._debouncedCallUserAPI=this._innerCallUserAPI,this._updateDebouncedCallUserAPI(),this._debouncedPrefetch=Fw(this.prefetch,1e3,{trailing:!0})}_updateDebouncedCallUserAPI(){this._debouncedCallUserAPI=this.userAPI.debounce!==void 0&&this.userAPI.debounce>0?Fw(this._innerCallUserAPI,this.userAPI.debounce,{leading:!0,trailing:!0}):this._innerCallUserAPI}async prefetch(e){await this.callUserAPI(e)}async callUserAPI(e){await this._debouncedCallUserAPI(e)}update(e,t,i=!0){this.userAPI=e,this._updateDebouncedCallUserAPI(),this.userAPI.url!==""&&this.userAPI.method==="GET"&&i&&this._debouncedPrefetch(t)}retrieveValue(e){if(this.result)try{return Xn.zoom(this.result,e)}catch(t){console.error(t)}}retrieveZoomedKeyValues(e){if(this.result){let t=e&&e.length?Xn.zoom(this.result,e):this.result;if(mRe(t))return Object.entries(t);if(pRe(t))return t.map((i,r)=>[r.toString(),i]);throw fRe(t)?new Error("This path points to a value, use retrieveValue() instead. "+(e==null?void 0:e.join("."))):new Error("Path error"+(e==null?void 0:e.join(".")))}}dispose(){}on(e,t){this.emitter.on(e,t)}off(e,t){this.emitter.off(e,t)}get autostart(){return this.userAPI.autoStart}};function dRe(e){let t=new Headers;return e.headers.forEach(i=>{i.data.key!==""&&t.append(i.data.key,i.data.value)}),t}function fRe(e){return typeof e=="string"||typeof e=="number"||typeof e=="boolean"||e===null}function pRe(e){return Array.isArray(e)}function mRe(e){return typeof e=="object"&&e!==null}async function gRe(e,t,i=new AbortController){var l,c,u,h;let r,n=e.url,s=((l=e.proxy)==null?void 0:l.enabled)??!1,a;if(((c=e.integration)==null?void 0:c.type)==="OpenAI"){let d=cx(e.integration.prompt===""?[]:JSON.parse(e.integration.prompt),t),f=e.integration.behavior===""?[]:cx(JSON.parse(e.integration.behavior),t);a=`{
		"model": "${e.integration.model}",
		"messages": [${e.integration.useBehavior?`
		{
			"role": "system",
			"content": "${f}"
		},`:""}
		{
			"role": "user",
			"content": "${d}"
		}
		]
	}`}if(s){n=`https://apis.spline.design/file/${e.proxy.fileId}/external-api/request?uuidexternalapi=${e.proxy.proxyId}`;let d;a!==void 0?d=a:e.method==="POST"&&e.body&&(d=cx(JSON.parse(e.body),t)),d!==void 0&&(n+=`&data=${encodeURIComponent(d.replace(/(\r\n|\n|\r|\t)/gm,""))}`)}else((u=e.integration)==null?void 0:u.type)==="OpenAI"?r=a:e.method==="POST"&&e.body&&(r=cx(JSON.parse(e.body),t));let o=await fetch(n,{method:s?"GET":e.method,headers:s?void 0:dRe(e),signal:i.signal,body:r});if(!o.ok)throw new Error("status:"+o.status+"_:_"+o.statusText);if(((h=e.integration)==null?void 0:h.type)==="OpenAI"){let d=await o.json();return s&&(d=d.response),{content:d.choices[0].message.content}}else{let d=await o.json();return s&&(d=d.response),d}}var ute=(e,t)=>{if(typeof e=="string"){let i=t.getVariable(e);if(i)return ute(i,t)}return Ls.isBoolean(e)?Ls.getDisplayedValue(e).toLowerCase():Ls.getDisplayedValue(e)},cx=(e,t)=>e.map((i,r)=>{if("text"in i)return i.text;if("type"in i){if(i.type==="paragraph")return(r>0?`
`:"")+cx(i.children,t);if(i.type==="variable"){let n=t.getVariable(i.variableId);if(n!==void 0)return ute(n,t)}}return""}).join(""),vRe=["+","-","*","/","(",")","==","!=",">","<",">=","<=","and","or","!","%","^",","],yRe=["0","1","2","3","4","5","6","7","8","9","."],xRe=["sin","cos","tan","asin","acos","atan","atan2","sqrt","abs","log","exp","floor","ceil","round","min","max","random"];function wRe(e){return typeof e!="string"?!1:!isNaN(e)&&!isNaN(parseFloat(e))}W0.addBinaryOp("^",11,!0);function hte(e,t,i="number"){let r="";for(let a=0;a<e.length;a++){let o=e[a];if("objType"in o&&o.objType==="api"){let l=JSON.parse(o.id),c=l[0],u=t.getUserAPI(c);if(u!==void 0&&u instanceof cte){let h=u.retrieveValue(l.slice(1));h!==void 0&&(r+=h)}continue}if("objType"in o&&o.objType==="webhook"){let l=JSON.parse(o.id),[c,u]=l,h=t.getUserWebhook(c);if(h!==void 0){let d=h.getParameterValue(u);d!==void 0&&(r+=d)}continue}if("objType"in o&&o.objType==="aiAssistant"){let l=t.openAIRealtime;if("objId"in o&&o.objId!==void 0){let c;if(t.scene.data.objects.traverse((u,h)=>{var f;let d=(f=h.events)==null?void 0:f.find(p=>p.id===o.objId);d&&(c=d)}),c!==void 0&&c.data.type==="AIAssistantListener"){let u=l==null?void 0:l.computeAnalysisForListenerEvent(c.data);if(u!==void 0){r+=u;continue}}}r+=(l==null?void 0:l.voice)??0;continue}if("id"in o){let l=e[a-1];if(a>0&&"id"in l){console.error("Two variables in a row",e);return}let c=t.getVariable(o.id),u=Ls.getDisplayedValue(c);i==="number"&&Ls.isTextValue(c)&&Array.isArray(c.textValue)&&c.textValue.length===1?u=parseFloat(u).toString():i==="boolean"&&Ls.isBoolean(c)?u=c?"true":"false":i==="boolean"&&Ls.isTextValue(c)&&!Array.isArray(c.textValue)&&(u='"'+u+'"'),r+=u;continue}else if(i==="string"){o.name!=='"'&&(o.name!=="+"||o.escaped)&&(r+=o.name),o.name==="+"&&!o.escaped&&r[r.length-1]==="\\"&&(r=r.slice(0,-1)+o.name);continue}if(o.name==="and"){r+="&&";continue}if(o.name==="or"){r+="||";continue}if(o.name==="True"){r+="true";continue}if(o.name==="False"){r+="false";continue}if(i==="boolean"&&!wRe(o.name)&&!yRe.includes(o.name)&&!vRe.includes(o.name)&&!xRe.includes(o.name.replace(/\($/g,""))){r+='"'+o.name+'"';continue}r+=o.name}if(i==="string")return r;if(e.length===0){if(i==="number")return 0;if(i==="boolean")return!1}let n;try{n=W0(r)}catch(a){console.error(r,a);return}let s;try{s=ji(n)}catch(a){console.error(r,n,a)}return s}function ji(e){switch(e.type){case"BinaryExpression":switch(e.operator){case"==":return+(ji(e.left)===ji(e.right));case"!=":return+(ji(e.left)!==ji(e.right));case">":return+(ji(e.left)>ji(e.right));case">=":return+(ji(e.left)>=ji(e.right));case"<":return+(ji(e.left)<ji(e.right));case"<=":return+(ji(e.left)<=ji(e.right));case"+":return ji(e.left)+ji(e.right);case"-":return ji(e.left)-ji(e.right);case"*":return ji(e.left)*ji(e.right);case"/":return ji(e.left)/ji(e.right);case"%":return ji(e.left)%ji(e.right);case"&&":return ji(e.left)&&ji(e.right);case"||":return ji(e.left)||ji(e.right);case"^":return Math.pow(ji(e.left),ji(e.right));default:throw new Error("Unknown operator: "+e.operator)}case"UnaryExpression":switch(e.operator){case"-":return-ji(e.argument);case"!":return+!ji(e.argument);default:throw new Error("Unknown operator: "+e.operator)}case"Identifier":throw new Error("Unknown identifier: "+e.name);case"Literal":return e.value;case"CallExpression":if(e.callee.type==="Identifier"){if(e.callee.name==="random"){let t=0,i=1;if(e.arguments.length>=1)try{t=ji(e.arguments[0])}catch(r){console.warn(r)}if(e.arguments.length>=2)try{i=ji(e.arguments[1])}catch(r){console.warn(r)}return t=Math.min(i,t),i=Math.max(i,t),t+Math.random()*(i-t)}return Math[e.callee.name].apply(null,e.arguments.map(ji))}else throw new Error("Unknown node");default:throw new Error("Unknown node type: "+e.type)}}var bRe=new ft,_Re=new ft;function SRe(e,t,i){let r=[new N,new N,new N],n=[new N,new N,new N];return e.extractBasis(r[0],r[1],r[2]),t.extractBasis(n[0],n[1],n[2]),r.forEach((s,a)=>{let o=n[a],l=Tt.lerp(s.length(),o.length(),i);s.lerp(o,i).setLength(l)}),new ft().makeBasis(r[0],r[1],r[2])}var MRe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,height:100,depth:1,subdivisions:12,roundness:0,extrudeBevelSize:0,extrudeBevelSegments:3},e.parameters),r=Math.abs(i.width),n=Math.abs(i.height??i.width),s=Math.abs(i.depth??0),a=(t==null?void 0:t.shapeData)??qN.create({parameters:Lee}).userData.shape;return{path:e.path??OA.defaultData(),parameters:Object.assign(i,{width:r,height:n,depth:s,extrusion:{...Oee,...i.extrusion}}),shapeData:a}}static build(e){if(e.path.points.length>=2){let t=new ERe(e);return Object.assign(t,{userData:{...e,type:"PathGeometry"}})}else return Object.assign(new Nt,{userData:{...e,type:"PathGeometry"}})}},ERe=class extends Nt{constructor(e){super(),this.type="PathExtrusionGeometry",this.inputs=e,this.build()}_isGeometryClosed(){return this.inputs.path.isClosed&&this.inputs.parameters.extrusion.depth===1}_isOpenEnded(){let e=this.inputs.parameters.extrusion;return!(this.inputs.path.isClosed&&e.depth===1)||!KDe(e.twist,0)||e.startScale!==e.endScale}build(){let e=this._extractPathPoints();if(e.length<2)return;let t=this._computeBasisMatrices(e),{depth:i,offset:r}=this.inputs.parameters.extrusion;i=Math.max(0,Math.min(i,1)),r=Math.max(0,Math.min(r,1));let n=this.inputs.path.isClosed?e.length:e.length-1,s=Math.floor(r*n),a=this.inputs.path.isClosed?Math.ceil((i+r)*n):Math.ceil(Math.min(1,i+r)*n),o=Math.min(Math.max(2,a-s+1),n+2),l=[],c=[];for(let Y=0;Y<o;Y++){let z=this.inputs.path.isClosed?(Y+s)%e.length:Math.min(Y+s,e.length-1);l.push(e[z].clone()),c.push(t[z].clone())}let u=(Y,z,V)=>{l[Y]=l[Y].clone().lerp(l[z],V),c[Y]=SRe(c[Y],c[z],V)},h=0,d=r*n%1;(!this.inputs.path.isClosed||i<=1)&&(d||r===0)&&(h=d,u(0,1,h));let f=0,p=(r+i)*n%1;if((this.inputs.path.isClosed&&i<=1||!this.inputs.path.isClosed&&r+i<1)&&p&&(f=p,u(l.length-1,l.length-2,1-f)),i===0){let Y=l.length-1;l[Y].copy(l[0]),c[Y].copy(c[0])}this._applyPathModifiers(c,h,f);let{bevel:v,bevelSides:m}=this.inputs.parameters.extrusion,g=v>0?this.inputs.parameters.extrusion.capType:"flat",y=5;this.inputs.parameters.extrusion.shape.type==="Custom"&&(y=this.inputs.parameters.extrusion.shape.shapeQuality==="low"?5:12);let{regions:x,infos:_,vertices:M}=this._computeShapePoints(y),S=0,T;g==="round"&&(T=new XN(this.inputs.shapeData,2*v,v,y,m,void 0,!0),S=T.getAttribute("position").count);let E=0,C=0;_.sort((Y,z)=>Y.start-z.start),_.forEach(Y=>{Y.verticesStart=E,Y.verticesCount=Y.continuous.reduce((z,V,U)=>z+(U===0||!V?2:1),0),C+=Y.verticesCount,E=C});let A=C*o,D,R=0;if(this._isOpenEnded()&&g==="flat"){try{D=jd({windingRule:lr.ODD,elementType:Pn.POLYGONS,polySize:3,vertexSize:2,strict:!0,contours:x})}catch{D=Jee}R=D.vertexCount}let L=A+2*R+S*2,O=A+2*R,H={positions:new Float32Array(L*3),normals:new Float32Array(L*3),uvs:new Float32Array(L*2)},j=[];if(_.forEach(Y=>{this._extrudeRegion(Y,M,c,l,H,j,this._isGeometryClosed()&&!this._isOpenEnded())}),D&&(this._closeEnd(D,A,j,H,c[0],l[0],!1),this._closeEnd(D,A+R,j,H,c[c.length-1],l[l.length-1],!0)),T){H.positions.set(T.getAttribute("position").array,O*3),H.normals.set(T.getAttribute("normal").array,O*3),H.uvs.set(T.getAttribute("uv").array,O*2);for(let U=O;U<O+S;U++)H.uvs[U*2+1]=1e-4;let Y=j.length;j.push(...T.getIndex().array.map(U=>U+O)),O+=S,H.positions.set(T.getAttribute("position").array,O*3),H.normals.set(T.getAttribute("normal").array,O*3),H.uvs.set(T.getAttribute("uv").array,O*2);let z=j.length;j.push(...T.getIndex().array.map(U=>U+O)),this.setAttribute("position",new Qt(H.positions,3)),this.setAttribute("normal",new Qt(H.normals,3)),this.setAttribute("uv",new Qt(H.uvs,2)),this.setIndex(j);let V=bRe;V.copy(c[c.length-1]).setPosition(l[l.length-1]),this.applyMatrix4OnRange(V,O,L),V.copy(c[0]).setPosition(l[0]).multiply(_Re.makeScale(1,1,-1)),this.applyMatrix4OnRange(V,O-S,O),this.reverseIndicesOnRange(Y,z)}else this.setAttribute("position",new Qt(H.positions,3)),this.setAttribute("normal",new Qt(H.normals,3)),this.setAttribute("uv",new Qt(H.uvs,2)),this.setIndex(j)}_extractPathPoints(){let e=Hee(this.inputs.path).getPoints(this.inputs.path.subdivisions);if(e.length<2)return[];let t=[e[0]];return e.forEach(i=>{t[t.length-1].distanceToSquared(i)>.001&&t.push(i)}),this.inputs.path.isClosed&&t[t.length-1].distanceTo(t[0])<.001&&t.pop(),t}_computeBasisMatrices(e){let t=[],i=e.length,r=this.inputs.path.isClosed,n=new N,s=new N,a=new N,o=new N,l=new N(0,1,0);for(let p=0;p<i;p++){let v=e[p],m;p===0?m=r?e[e.length-2]:v.clone().multiplyScalar(2).sub(e[1]):m=e[p-1];let g;p===i-1?g=r?e[1]:v.clone().multiplyScalar(2).sub(e[p-1]):g=e[p+1];let y=v.clone().sub(m).normalize(),x=g.clone().sub(v).normalize(),_=y.clone().add(x).normalize();a.copy(_),p===0&&(_.equals(l)||_.clone().negate().equals(l))&&l.set(0,0,1);let M=l.clone().cross(_).normalize(),S=_.clone().cross(M).normalize();l.copy(S),o.copy(M),p===0&&(n.copy(S),s.copy(_));let T=new ft().makeBasis(M,S,_);t.push(T)}let c=r?s:a,u=r?n:new N(0,1,0),h=c.clone().cross(o).normalize(),d=Math.acos(u.dot(h));if(isNaN(d))return t;let f=u.clone().cross(h);c.dot(f)>0&&(d*=-1);for(let p=1;p<t.length;p++){let v=new ft().makeRotationZ(d*p/t.length);t[p].multiply(v)}return t}_applyPathModifiers(e,t,i){let r=e.length,{angle:n,twist:s,startScale:a,endScale:o}=this.inputs.parameters.extrusion,l=new ft,c=new ft;return e.forEach((u,h)=>{let d=h===0?0:h===r-1?1:(h-t)/(r-(i===0?0:1)-(t+(1-i)));l.makeRotationZ(Tt.lerp(n,n+s,d)*Tt.DEG2RAD);let f=Tt.lerp(a,o,d);c.makeScale(f,f,f),u.multiply(l).multiply(c)}),e}_computeShapePoints(e=12,t=lr.ODD){let i=this.inputs.shapeData,r=i.extractShapePointsToFlatArray([],e),n=i.shapeHoles.map(c=>{let u=c.extractShapePointsToFlatArray([],e),h=[];for(let d=u.length-1;d>=1;d-=2){let f=u[d-1],p=u[d-0];h.push(f,p)}return h}),s;try{s=jd({windingRule:t,elementType:Pn.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[r]})}catch{s=WN}let a;try{a=jd({windingRule:lr.ODD,elementType:Pn.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[...n]})}catch{a=Kee}if(!s)throw new Error("error generating geometry");let o=s.elementCount;if(a){s.elementCount+=a.elementCount;for(let c=0;c<a.elements.length;c++){let u=a.elements[c],h=c%2===0?s.vertexCount:0;s.elements.push(u+h)}for(let c=0;c<a.vertexIndices.length;c++){let u=a.vertexIndices[c],h=s.vertexCount;s.vertexIndices.push(u+h)}for(let c=0;c<a.vertices.length;c++){let u=a.vertices[c];s.vertices.push(u)}}for(let c=0,u=s.vertexCount;c<u;c++){let h=c*2;s.vertices[h+0],s.vertices[h+1]}let l=[];for(let c=s.elementCount-1;c>=0;c--){let u=c>=o,h=c*2,d=s.elements[h+0],f=s.elements[h+1],p=d+f,v={start:d,count:f,normals:[],isHole:u,continuous:[],verticesStart:0,verticesCount:0};l.push(v);let m=d,g=p-1,y=d+1,x=i.roundedCurves.length;do{let _=m-d;s.vertices[g*2+0],s.vertices[g*2+1];let M=s.vertices[m*2+0],S=s.vertices[m*2+1],T=s.vertices[y*2+0],E=s.vertices[y*2+1],C=M-T,A=S-E,D=Math.sqrt(C*C+A*A);C/=D,A/=D,v.normals[_*2+0]=-A,v.normals[_*2+1]=C;let R=s.vertexIndices[m];if(Array.isArray(R))v.continuous[_]=!1;else{let[L,O]=i.getCurveIndexFromVertexId(R-1,!0);if(O>0&&O<1)v.continuous[_]=!0;else{let H=O===1?L+1:L-1;H=(H+x)%x;let j=O===1?0:1,Y=i.roundedCurves[L].getTangent(O),z=i.roundedCurves[H].getTangent(j);v.continuous[_]=Y.dot(z)>.95}}u&&(v.normals[_*2+0]*=-1,v.normals[_*2+1]*=-1),[g,m,y]=[m,y,y+1],y>=p&&(y-=f)}while(y!==d+1)}return{regions:[r,...n],infos:l,vertices:s.vertices}}_insertVertex(e,t,i,r,n){let s=t*2,a=t*3;e.positions[a+0]=i.x,e.positions[a+1]=i.y,e.positions[a+2]=i.z,e.normals[a+0]=r.x,e.normals[a+1]=r.y,e.normals[a+2]=r.z,e.uvs[s+0]=n.x,e.uvs[s+1]=n.y}_extrudeRegion(e,t,i,r,n,s,a){let o=new N,l=new N,c=new N,u=new N,h=new Me;i.forEach((f,p)=>{let v=r[p],m=e.verticesStart*i.length+e.verticesCount*p;for(let g=0;g<e.count;g++){let y=(e.start+g)*2;if(o.set(t[y+0],t[y+1],0),c.copy(o).applyMatrix4(f).add(v),e.continuous[g])u.set(e.normals[g*2+0],e.normals[g*2+1],0);else{let x=g===0?(e.start+e.count-1)*2:y-2;l.set(t[x+0],t[x+1],0),u.copy(o).sub(l),u.set(-u.y,u.x,0),e.isHole||u.negate()}if(u.applyMatrix4(f).normalize(),h.set(g===0?1:g/e.count,p/(i.length-1)),this._insertVertex(n,m,c,u,h),m++,!e.continuous[g]||g===0){if(g===0)u.set(e.normals[g*2+0],e.normals[g*2+1],0),h.set(0,p/(i.length-1));else{let x=g===e.count-1?e.start*2:y+2;l.set(t[x+0],t[x+1],0),u.copy(l).sub(o),u.set(-u.y,u.x,0),e.isHole||u.negate()}u.applyMatrix4(f).normalize(),this._insertVertex(n,m,c,u,h),m++}}});let d=i.length-1;for(let f=0;f<d;f++){let p=e.verticesStart*i.length+e.verticesCount*f,v=e.verticesStart*i.length+e.verticesCount*(f+1),m=0;for(let g=0;g<e.count;g++){(!e.continuous[g]||g===0)&&m++;let y=g===e.count-1?0:m+1,x=p+m,_=p+y,M=v+y,S=v+m;e.isHole?s.push(x,M,_,x,S,M):s.push(x,_,M,x,M,S),m++}}}_closeEnd(e,t,i,r,n,s,a){let o=e.vertexCount,l=new N(0,0,a?-1:1).applyMatrix4(n),c=new N,u=new Me;for(let d=0;d<o;d++){let f=2*d;c.set(e.vertices[f+0],e.vertices[f+1],0).applyMatrix4(n).add(s),this._insertVertex(r,t+d,c,l,u)}let h=e.elements;for(let d=0;d<e.elementCount;d++){let f=3*d,p=h[f+0]+t,v=h[f+(a?1:2)]+t,m=h[f+(a?2:1)]+t;i.push(p,v,m)}}applyMatrix4OnRange(e,t,i){let r=e.elements,n=new Dn().getNormalMatrix(e).elements,s,a,o,l,c=this.attributes.position,u=this.attributes.normal;if(!c||!u)return;let h=c.array,d=u.array,f=c.itemSize;for(let p=t*f,v=i*f;p<v;p+=f){if(p===t)debugger;s=h[p+0],a=h[p+1],o=h[p+2],l=1/(r[3]*s+r[7]*a+r[11]*o+r[15]),h[p+0]=(r[0]*s+r[4]*a+r[8]*o+r[12])*l,h[p+1]=(r[1]*s+r[5]*a+r[9]*o+r[13])*l,h[p+2]=(r[2]*s+r[6]*a+r[10]*o+r[14])*l,s=d[p+0],a=d[p+1],o=d[p+2],d[p+0]=n[0]*s+n[3]*a+n[6]*o,d[p+1]=n[1]*s+n[4]*a+n[7]*o,d[p+2]=n[2]*s+n[5]*a+n[8]*o}c.needsUpdate=!0,u.needsUpdate=!0}reverseIndicesOnRange(e,t){let i=this.index;if(i){for(let r=e;r<t;r+=3){let n=i.getX(r),s=i.getX(r+1),a=i.getX(r+2);i.setXYZ(r,a,s,n)}i.needsUpdate=!0}}};function dte(){let e=new Nt;return e.setAttribute("position",new Qt(new Float32Array([]),3)),e.setIndex(new Qt(new Uint16Array([]),1)),e}var ARe=dte().attributes,TRe=12,CRe=1,oB=class extends Nt{constructor(e,t){super(),this.charWidths=[],this.charCoords=[],this.wrappedText=[],this.isLowResolution=!1,this.vectorShapes=[],Object.assign(this.attributes,ARe),this.userData={parameters:e,type:"TextGeometry"};let i=t.getFont(e.font);i!=null&&i.isLoaded?(this.font=i,this.update(e)):this.updateFont(e.font,t).then(()=>{this.update(e),t==null||t.requestRender()})}async updateFont(e,t){let i=t.getFont(e);i&&(this.font=i,await i.loadingPromise)}update(e){let t=this.font;if(this.userData={parameters:e,type:"TextGeometry"},!(t!=null&&t.isLoaded)){console.warn("Cannot update text because its font is not loaded");return}let{width:i,height:r,depth:n,extrudeBevelSize:s,extrudeBevelSegments:a,text:o,textTransform:l}=e,c=Ls.getDisplayedValue(o),u=l===2?c.toUpperCase():l===3?c.toLowerCase():c,h=PRe(e,t,u),{shapes:d,charWidths:f,charCoords:p}=t.generateShapes(h,e),v=(typeof i=="number"?i:1)*.5,m=(typeof r=="number"?r:1)*.5,g=d.map(_=>new tn().fromShape(_,!0));this.vectorShapes=g;let y=g.map(_=>Ym.create({shape:_,parameters:{depth:n,extrudeBevelSegments:a,extrudeBevelSize:s,windingRule:n<=0?lr.NONZERO:lr.ODD,subdivisions:this.isLowResolution&&n>0?CRe:TRe}})),x=y.length?Qp(y):dte();x.translate(-v,m,0),this.dispose(),this.wrappedText=h,this.charCoords=p,this.charWidths=f,this.deleteAttribute("extrudeNormal"),Object.entries(x.attributes).forEach(([_,M])=>{this.setAttribute(_,M)}),this.setIndex(x.index),this.computeBoundingSphere()}clone(){let e=_l(new Nt,oB.prototype);return e.copy(this),console.log("CloneGeometry",this,e),e}copy(e){return Object.entries(e.attributes).forEach(([t,i])=>{this.setAttribute(t,i)}),this.setIndex(e.index),this.userData={parameters:{...e.userData.parameters},type:"TextGeometry"},this}async setText(e){this.font&&await this.font.loadingPromise,await this.update({...this.userData.parameters,text:{textValue:e}})}get text(){return this.userData.parameters.text??""}};function PRe(e,t,i){let r=[""],n="";for(let s of i)n+=s,s===" "||s===`
`?(r[r.length-1]+=n,n="",s===`
`&&r.push("")):t.getTextWidth(r[r.length-1]+n,e)>e.width&&(r[r.length-1].length&&r.push(""),t.getTextWidth(r[r.length-1]+n,e)>e.width&&(n.length===1?(r[r.length-1]+=n,n=""):(r[r.length-1]+=n.slice(0,-1),n=n[n.length-1],r.push(""))));return r[r.length-1]+=n,r}var fte,pte=new Promise(e=>{fte=e}),AW=!1,uM;function DRe(){if(AW)return;if(uM)return uM;async function e(){let t="https://unpkg.com/@splinetool/modelling-wasm@1.9.75/build",i=Af(()=>import("./process-B9H0U9ag.js"),[]),[r,n]=await Promise.all([i,fetch(`${t}/process.wasm`).then(o=>o.arrayBuffer())]),s=r.default,a=await s({wasmBinary:n});fte(a),AW=!0}return uM=e(),uM}var RRe=["font"];function Yw(e,t,i,r){var c,u;let n,s,a;e.type==="PathGeometry"?(s=JSON.parse(JSON.stringify(e)),a=[[],["extrusion"]]):(s={...e},a=[[]]);for(let h of a){let d=s;for(let f of h)d=d[f];for(n in d){let f=d[n];P8(f)&&!RRe.includes(n)&&(d[n]=t.getVariable(f,[r.uuid,"geometry",...h,n]),P8(d[n])&&(d[n]=1))}}let o={parameters:s,type:s.type};if(s.type==="PathGeometry")o.path=s.path;else if(s.type==="VectorGeometry"){let h=tn.createFromState(s.shape,s.width,s.height);o.shape=h}else if(s.type==="NonParametricGeometry"){if(s.data.groups&&((c=s.data.groups)==null||c.forEach(h=>h.materialIndex=Math.max(h.materialIndex??0,0))),o.geometry=new f$().parse(s),o.geometry.groups.length===0){let h=o.geometry;h.addGroup(0,Math.max(((u=h.getIndex())==null?void 0:u.count)??0,h.getAttribute("position").count),0)}}else if(s.type==="SubdivGeometry"){let h=new Aa(s,i);return h.data=e,h}else{if(s.type==="TextGeometry")return new oB(s,t);if(s.type==="InputGeometry")return new oB(s,t);if(s.type==="UIGeometry")return YN.create({parameters:{width:s.width,height:s.height,cornerRadius:s.cornerRadius,cornerType:s.cornerType}})}let l;try{l=RW(o)}catch(h){console.error(h)}if(!l){let h=tn.createFromState(LA.defaultData(),100,100);o.shape=h,l=RW(o)}return l}var IRe=new ft;function lB(e,t,i,r){let n=e.position.array,s=e.normal.array,a=IRe.makeScale(t,i,r).invert().elements,o,l,c;for(var u=0,h=n.length;u<h;u+=3)n[u]*=t,n[u+1]*=i,n[u+2]*=r,o=s[u],l=s[u+1],c=s[u+2],s[u]=a[0]*o+a[4]*l+a[8]*c,s[u+1]=a[1]*o+a[5]*l+a[9]*c,s[u+2]=a[2]*o+a[6]*l+a[10]*c;e.position.needsUpdate=!0,e.normal.needsUpdate=!0}var hM=new vn,Fg=new N,Zt;pte.then(e=>{Zt=e});var TW=new Float32Array([10,10,0,-10,10,0,-10,-10,0,10,-10,0]),CW=new Uint32Array([0,1,2,3]),PW=new Uint8Array([4]),Aa=class extends Nt{constructor(e,t){super(),this.data=e,this.flatShading=t,this.subdivPointer=0,this.rebuild(),this.freeSubdivPointer()}mutateDirectlyScaleBaked(e,t){this.freeSubdivPointer();let i=this.data.scaleBaked,r=lm.div(t,i);this.subdividedGeometry&&lB(this.subdividedGeometry.attributes,...r),this.originalGeometry&&lB(this.originalGeometry.attributes,...r),this.data=e;let n=this.userData.parameters;this.userData.parameters={width:n.width*r[0],height:n.height*r[1],depth:n.depth*r[2]},this.originalGeometry.boundingSphere.center.multiply(Fg.fromArray(r));let s=Fg.set(n.width,n.height,n.depth).length();this.originalGeometry.boundingSphere.radius=s/2}ensureSubdivPointer(){return this.subdivPointer===0&&this.rebuild(),this.subdivPointer}rebuild(){let e,t,i;try{({originalGeometry:e,subdividedGeometry:t,subdivPointer:i}=Aa.build(this.data,void 0,!this.flatShading,void 0))}catch{e=new ac(100,100,100),i=0}this.subdivPointer=i,this.originalGeometry=e,this.subdividedGeometry=t??void 0;let r=this.subdividedGeometry??this.originalGeometry;Object.assign(this,r),this.calcBoundingBox()}freeSubdivPointer(){this.subdivPointer&&(Aa.freeSubdivPointer(this.subdivPointer),this.subdivPointer=0)}dispose(){super.dispose(),this.freeSubdivPointer()}calcBoundingBox(){let e=this.originalGeometry;e.boundingSphere===null&&(e.boundingSphere=new uo,this.subdividedGeometry&&(this.subdividedGeometry.boundingSphere=e.boundingSphere));let t=e.attributes.position,i=e.boundingSphere.center;hM.setFromBufferAttribute(t),hM.getCenter(i),e.boundingSphere.radius=i.distanceTo(hM.max),isNaN(e.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this),hM.getSize(Fg);let r={width:Fg.x,height:Fg.y,depth:Fg.z};return this.userData.parameters=r,r}static build(e,t,i,r){let n,s,a,o=(e==null?void 0:e.phongAngle)??35;i===!1&&(o=-1),t&&(Zt.free_bvh(t),Zt.free_subdivision_surface(t));try{n=Aa.allocate(e,r)}catch(l){console.error(l,e),n=Aa.allocate({positionWASM:TW,indexWASM:CW,verticesPerFaceWASM:PW},r)}if(Zt.set_destination_refinement_level(n,0),s=Aa.buildLevel(n,!0,o),e.subdivisions>0)try{Zt.set_destination_refinement_level(n,e.subdivisions),a=Aa.buildLevel(n,!1,o)}catch{try{Zt.set_destination_refinement_level(n,e.subdivisions-1),a=Aa.buildLevel(n,!1,o)}catch{a=null}}else a=null;return{subdivPointer:n,originalGeometry:s,subdividedGeometry:a}}static primitiveToQuads(e,t,i){e.widthSegments>16&&(e.widthSegments=16),e.heightSegments>16&&(e.heightSegments=16),e.depthSegments>16&&(e.depthSegments=16),e.radialSegments>16&&(e.radialSegments=16),e.type==="DodecahedronGeometry"&&(e.detail=0);let r=e.shape!==void 0||e.path!==void 0?t.geometry:Yw(e,i,!1),n;e.type==="TorusGeometry"&&e.arc===Math.PI*2?n=r.getClosedTorusIndicesForBooleanOrSubdiv():n=r.getIndex();let s,a,o,l;({positions:s,triIndices:l}=jC(r.getAttribute("position"),n));let c;if(e.type==="CylinderGeometry"&&e.cornerRadius===0&&e.hollow===0&&e.openEnded===!1){let u=e.radialSegments*e.heightSegments*3*2,h=u+e.radialSegments*3;c=[u,h]}return{indices:a,verticesPerFace:o}=mte(s,l,r,c),{positions:s,indices:a,verticesPerFace:o}}static allocate(e,t){var x;let i,r,n,s=[],a=[];e.positionWASM&&e.positionWASM.length>0?(i=e.positionWASM,r=e.indexWASM,n=e.verticesPerFaceWASM):(i=TW,r=CW,n=PW);let o=i.length,l=r.length,c=n.length,u=i.length+s.length+a.length,h=r.length+n.length,d=u*Float32Array.BYTES_PER_ELEMENT+h*Uint32Array.BYTES_PER_ELEMENT,f=u*Float32Array.BYTES_PER_ELEMENT,p=Zt._malloc(d),v=new Float32Array(Zt.HEAPF32.buffer,p,u),m=new Uint32Array(Zt.HEAPU32.buffer,p+f,h);v.set(i,0),v.set(s,i.length),v.set(a,i.length+s.length),m.set(r,0),m.set(n,r.length);let g;(x=e==null?void 0:e.scaleBaked)!=null&&x.some(_=>_!==1)&&(g=new ft().makeScale(...e.scaleBaked)),t&&(g?g.premultiply(t):g=t);let y=g?Zt.alloc_subdivision_surface2(p,o,p+f,l,p+f+r.length*Uint32Array.BYTES_PER_ELEMENT,c,g.elements):Zt.alloc_subdivision_surface(p,o,p+f,l,p+f+r.length*Uint32Array.BYTES_PER_ELEMENT,c);return Zt._free(p),y}static buildLevel(e,t,i,r,n){let s=n?Zt.get_mesh_data2(e,t?Zt.Level.CONTROL:Zt.Level.REFINED,i,n.elements):Zt.get_mesh_data(e,t?Zt.Level.CONTROL:Zt.Level.REFINED,i),a=8,o=Zt.HEAPU32.subarray(s>>2,(s>>2)+a),l=o.subarray(4,8),c=0,u=Zt.HEAPU32[o[c]>>2],h=Zt.HEAPF32.subarray(u>>2,(u>>2)+l[c]);c++;let d=Zt.HEAPU32[o[c]>>2],f=Zt.HEAPF32.subarray(d>>2,(d>>2)+l[c]);c++;let p=Zt.HEAPU32[o[c]>>2],v=Zt.HEAPU32.subarray(p>>2,(p>>2)+l[c]);c++;let m=Zt.HEAPU32[o[c]>>2],g=Zt.HEAPU32.subarray(m>>2,(m>>2)+l[c]);if(c++,r===void 0){let y=new Nt;if(y.setIndex(new o0(g,1)),y.setAttribute("position",new _t(h,3)),y.setAttribute("normal",new _t(f,3)),t){y.setAttribute("faceMap",new o0(v,1));let x=new Float32Array(f.length/3*4).fill(0);y.setAttribute("color",new Qt(x,4))}return Zt.free_mesh_data(s),y.userData.type="SubdivGeometry",y}r.getAttribute("position").copyArray(h),r.getAttribute("normal").copyArray(f),r.attributes.position.needsUpdate=!0,r.attributes.normal.needsUpdate=!0,Zt.free_mesh_data(s)}static freeSubdivPointer(e){Zt.free_bvh(e),Zt.free_subdivision_surface(e)}static buildControlCageWireframe(e,t,i){let r=Zt.get_wireframe_data_for_base_level(e),n=4,s=Zt.HEAPU32.subarray(r>>2,(r>>2)+n),a=s.subarray(2,4),o=0,l=Zt.HEAPU32[s[o]>>2],c=Zt.HEAPF32.subarray(l>>2,(l>>2)+a[o]);o++;let u=Zt.HEAPU32[s[o]>>2],h=Zt.HEAPU32.subarray(u>>2,(u>>2)+a[o]);if(t===void 0){let d=new Nt;d.setAttribute("position",new _t(c,3));let f=new Float32Array(c.length);for(let p=0,v=c.length;p<v;)f[p++]=i.r,f[p++]=i.g,f[p++]=i.b;return d.setAttribute("color",new Qt(f,3)),d.setIndex(new o0(h,1)),Zt.free_wireframe_data_for_base_level(r),d}t.getAttribute("position").copyArray(c),t.attributes.position.needsUpdate=!0,Zt.free_wireframe_data_for_base_level(r)}static updateCollabMesh(e,t,i){let r=t===0;r||Zt.set_destination_refinement_level(e,t);let n=i?Zt.get_topological_data2(e,r?Zt.Level.CONTROL:Zt.Level.REFINED,i.elements):Zt.get_topological_data(e,r?Zt.Level.CONTROL:Zt.Level.REFINED),s=6,a=Zt.HEAPU32.subarray(n>>2,(n>>2)+s),o=a.subarray(3,6),l=0,c=Zt.HEAPU32[a[l]>>2],u=new Float32Array(Zt.HEAPF32.subarray(c>>2,(c>>2)+o[l]));l++;let h=Zt.HEAPU32[a[l]>>2],d=new Uint32Array(Zt.HEAPU32.subarray(h>>2,(h>>2)+o[l]));l++;let f=Zt.HEAPU32[a[l]>>2],p=new Uint8Array(Zt.HEAPU32.subarray(f>>2,(f>>2)+o[l]));return Zt.free_topological_data(n),{positions:u,indices:d,verticesPerFace:p}}},DW=["getX","getY","getZ"];function jC(e,t){let i={},r=t?t.count:e.count,n=0,s=[],a=[],o=1e4;for(let c=0;c<r;c++){let u=t?t.getX(c):c,h="";for(let d=0;d<3;d++)h+=`${~~(e[DW[d]](u)*o)},`;if(h in i)s.push(i[h]);else{for(let d=0;d<3;d++)a.push(e[DW[d]](u));i[h]=n,s.push(n),n++}}let l=[];for(let c=0;c<s.length;c+=3)s[c]===s[c+1]||s[c]===s[c+2]||s[c+1]===s[c+2]||l.push(s[c],s[c+1],s[c+2]);return{positions:a,triIndices:l}}var dM=new N,AR=new N,TR=new N,CR=new N;function mte(e,t,i,r){let n=[],s=[];if(i.userData.shape!==void 0&&i.userData.parameters.depth===0&&i.userData.shape.shapeHoles.length===0){let l=i.userData.shape.extractShapePointsToFlatArray([]),c=i.userData.parameters.spikes;if(i.userData.type==="EllipseGeometry"&&c<=24&&c%4===0&&i.userData.parameters.angle>=360){let d=l.length/2/c;l=l.filter((f,p)=>Math.floor(p/2)%d===0)}let u=0;for(let d=0;d<l.length;d+=2)u+=(l[d]-l[(d===0?l.length:d)-2])*(l[d+1]+l[(d===0?l.length:d)-1]);e.length=0;let h=0;if(u<0)for(let d=0;d<l.length;d+=2)e.push(l[d],l[d+1],0),n.push(h++);else for(let d=l.length-2;d>=0;d-=2)e.push(l[d],l[d+1],0),n.push(h++);return s.push(h),{indices:n,verticesPerFace:s}}let a=new Float32Array([i.userData.parameters.depth])[0],o=0;for(;o<t.length;){if(i.useNgonForTopBottomFaceDuringBake){let l=0;if((e[t[o]*3+2]===a||e[t[o]*3+2]===0)&&l++,(e[t[o+1]*3+2]===a||e[t[o+1]*3+2]===0)&&l++,(e[t[o+2]*3+2]===a||e[t[o+2]*3+2]===0)&&l++,l===3)break}if(t[o+1]===t[o+3]&&t[o+2]===t[o+5]||t[o+0]===t[o+3]&&t[o+2]===t[o+4]){dM.set(e[t[o]*3],e[t[o]*3+1],e[t[o]*3+2]),AR.set(e[t[o+1]*3],e[t[o+1]*3+1],e[t[o+1]*3+2]),TR.set(e[t[o+4]*3],e[t[o+4]*3+1],e[t[o+4]*3+2]),CR.set(e[t[o+5]*3],e[t[o+5]*3+1],e[t[o+5]*3+2]),AR.sub(dM).normalize(),TR.sub(dM).normalize(),CR.sub(dM).normalize();let l=AR.cross(TR).dot(CR);Math.abs(l)>.005||r&&r.some((c,u)=>u%2===1?!1:o>=r[u]&&o<r[u+1])?(n.push(t[o],t[o+1],t[o+2]),s.push(3),o+=3):(n.push(t[o],t[o+1],t[o+4],t[o+5]),s.push(4),o+=6)}else n.push(t[o],t[o+1],t[o+2]),s.push(3),o+=3}if(i.useNgonForTopBottomFaceDuringBake){let l=[],c=[],u=0;for(let h=0,d=0;h<e.length;h+=3,d++)e[h+2]===0&&(l.push(d),u++),e[h+2]===a&&c.push(d);if(i.userData.parameters.extrudeBevelSize===0){let h=c[0];c[0]=c[1],c[1]=h}l.reverse(),n.push(...l,...c),s.push(u,u)}return{indices:n,verticesPerFace:s}}var qu={};Sme(qu,{calcBoolean:()=>FRe,calcBooleanTopological:()=>BRe,freeMeshSet:()=>VRe,getMeshSet:()=>URe,hasOpenEdges:()=>NRe,transformMeshSet:()=>kRe});var gte,LRe=new Promise(e=>{gte=e}),fM;function ORe(){if(fM)return fM;async function e(){let t="https://unpkg.com/@splinetool/boolean-wasm@1.9.75/build",i=Af(()=>import("./boolean-BpCokwB2.js"),[]),[r,n]=await Promise.all([i,fetch(`${t}/boolean.wasm`).then(o=>o.arrayBuffer())]),s=r.default,a=await s({wasmBinary:n});gte(a)}return fM=e(),fM}var Bi,p0;LRe.then(e=>Bi=e);function zRe(e,t,i){let r,n;e.userData.parameters.type==="TorusGeometry"&&e.userData.parameters.arc===Math.PI*2?n=e.getClosedTorusIndicesForBooleanOrSubdiv():n=e.getIndex();let{positions:s,triIndices:a}=jC(e.getAttribute("position"),n),o;if(t&&i){let{indices:l,verticesPerFace:c}=mte(s,a,e);o=c.length,r=[];for(let u=0,h=0;u<o;u++){r.push(c[u]);for(let d=0;d<c[u];d++)r.push(l[h++])}}else{let l=a.length;r=Array(l+l/3),o=0;for(let c=0,u=0;u<r.length;)r[u++]=3,o++,r[u++]=a[c++],r[u++]=a[c++],r[u++]=a[c++]}return{positions:s,faceIndices:r,nFaces:o}}function vte(e){let t=e.length,i=t*Uint32Array.BYTES_PER_ELEMENT,r=t*Float32Array.BYTES_PER_ELEMENT,n=Number.isInteger(e[0])?i:r,s=Bi._malloc(n);return(Number.isInteger(e[0])?new Uint32Array(Bi.HEAPU32.buffer,s,t):new Float32Array(Bi.HEAPF32.buffer,s,t)).set(e,0),s}function yte(e){switch(e){case 0:return Bi.OP.UNION;case 1:return Bi.OP.INTERSECTION;case 2:return Bi.OP.A_MINUS_B;default:throw new Error("Unknown boolean operation "+e)}}function BRe(e,t){p0===void 0&&(p0=Bi.init_csg());let i=vte(e),r=Bi.csg_calc_topological(p0,i,e.length,yte(t));Bi._free(i);let n=6,s=Bi.HEAPU32.subarray(r>>2,(r>>2)+n),a=s.subarray(3,6),o=0,l=Bi.HEAPU32[s[o]>>2],c=new Float32Array(Bi.HEAPF32.subarray(l>>2,(l>>2)+a[o]));o++;let u=Bi.HEAPU32[s[o]>>2],h=new Uint32Array(Bi.HEAPU32.subarray(u>>2,(u>>2)+a[o]));o++;let d=Bi.HEAPU32[s[o]>>2],f=new Uint8Array(Bi.HEAPU32.subarray(d>>2,(d>>2)+a[o]));return Bi.free_mesh_data(r),{positions:c,indices:h,verticesPerFace:f}}function FRe(e,t,i,r){p0===void 0&&(p0=Bi.init_csg());let n=vte(e),s=Bi.csg_calc(p0,n,e.length,r,yte(t));Bi._free(n);let a=5,o=Bi.HEAPU32.subarray(s>>2,(s>>2)+a),l=o.subarray(2,5),c=0,u=Bi.HEAPU32[o[c]>>2],h=Bi.HEAPF32.subarray(u>>2,(u>>2)+l[c]);c++;let d=Bi.HEAPU32[o[c]>>2],f=Bi.HEAPF32.subarray(d>>2,(d>>2)+l[c]);c++;let p=l[c];i.setAttribute("position",new _t(h,3)),i.setAttribute("normal",new _t(f,3));let v=Bi.HEAPF32.subarray((s>>2)+5,(s>>2)+5+6);return i.boundingSphere===null&&(i.boundingSphere=new uo),i.boundingSphere.center.set(v[0],v[1],v[2]),i.boundingSphere.radius=(v[3]**2+v[4]**2+v[5]**2)**.5,i.userData.parameters={width:v[3]*2,height:v[4]*2,depth:v[5]*2},Bi.free_mesh_data(s),p}function URe(e,t,i){if(Bi===void 0)return-1;let r,n,s;if(t&&e.userData.positions!==void 0){let m=e.userData;s=m.verticesPerFace.length,r=m.positions,n=Array(m.verticesPerFace.reduce((g,y)=>g+y,0)+s);for(let g=0,y=0,x=0;g<m.verticesPerFace.length;g++){n[x++]=m.verticesPerFace[g];for(let _=0;_<m.verticesPerFace[g];_++)n[x++]=m.indices[y++]}}else({positions:r,faceIndices:n,nFaces:s}=zRe(e,t,i));let a=r.length,o=n.length,l=r.length,c=n.length,u=l*Float32Array.BYTES_PER_ELEMENT+c*Uint32Array.BYTES_PER_ELEMENT,h=l*Float32Array.BYTES_PER_ELEMENT,d=Bi._malloc(u),f=new Float32Array(Bi.HEAPF32.buffer,d,l),p=new Uint32Array(Bi.HEAPU32.buffer,d+h,c);f.set(r,0),p.set(n,0);let v=Bi.get_csg_mesh(d,a,d+h,o,s);return Bi._free(d),v}function NRe(e){return Bi.has_open_edges(e)}function kRe(e,t){Bi.transform_csg_mesh(e,t.elements)}function VRe(e){Bi.free_csg_mesh(e)}var GRe={ConeGeometry:j3e,CubeGeometry:W3e,CylinderGeometry:jee,DodecahedronGeometry:q3e,EllipseGeometry:qN,HelixGeometry:PDe,IcosahedronGeometry:DDe,LatheGeometry:RDe,NonParametricGeometry:UDe,PolygonGeometry:ote,PyramidGeometry:NDe,RectangleGeometry:YN,SphereGeometry:GDe,PlaneGeometry:HDe,BackdropGeometry:jDe,StarGeometry:lte,TextFrameGeometry:XDe,TorusGeometry:qDe,TorusKnotGeometry:QDe,TriangleGeometry:ZDe,PathGeometry:MRe,VectorGeometry:Ym},RW=e=>GRe[e.type].create(e);function Ug(e){return e!==null&&"booleanOp"in e}var xte=class extends VN(yr){constructor(){super(...arguments),this.booleanMeshSetAddress=-1,this.booleanWasTransformed=!1,this.booleanMatrixInvOld=new ft}updateVisible(e){super.updateVisible(e),this.visible=!Ug(this.parent)&&this.visible,Ug(this.parent)&&this.parent.invalidateDownstreamBooleanData()}freeBooleanPointer(){this.booleanMeshSetAddress!==-1&&(qu.freeMeshSet(this.booleanMeshSetAddress),this.booleanMeshSetAddress=-1)}invalidateDownstreamBooleanData(e=!1){return e?this.booleanWasTransformed=!0:this.freeBooleanPointer(),Ug(this.parent)?this.parent.invalidateDownstreamBooleanData():this}invalidateUpstreamBooleanData(){this.freeBooleanPointer();for(let e of this.children)e instanceof xte&&(e.freeBooleanPointer(),Ug(e)&&e.invalidateUpstreamBooleanData())}updateTransformState(e,t){let i=super.updateTransformState(e,t);return i&&Ug(this.parent)&&this.invalidateDownstreamBooleanData(!0),i}onVariableUpdate(e=!1){super.onVariableUpdate(e),Ug(this.parent)&&this.invalidateDownstreamBooleanData(!0)}},pM=new vn;function QN(e,t=0,i=e.count,r,n){let s=1/0,a=1/0,o=1/0,l=-1/0,c=-1/0,u=-1/0;for(let h=t;h<i;h++){let d=e.getX(h),f=e.getY(h),p=e.getZ(h);d<s&&(s=d),f<a&&(a=f),p<o&&(o=p),d>l&&(l=d),f>c&&(c=f),p>u&&(u=p)}pM.min.set(s,a,o),pM.max.set(l,c,u),pM.getCenter(r),pM.getSize(n).multiplyScalar(.5)}var HRe=new Nt,jRe=new Ch,za=class extends xte{constructor(e,t){super(HRe,jRe),this.super_Entity(e,t)}updateState(e,t){this.updateState_Entity(e,t)}updateEntityBoxSize(e,t){let i=this.geometry.getAttribute("position");i!==void 0?QN(i,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:i.count,e,t):super.updateEntityBoxSize(e,t)}},Ed=class{constructor(e){if(this.hashProperties=void 0,this.isNode=!0,this.shortcuts={},Ed.uuidContext===null)throw new Error("plz startContext");Ed.uuidContext===Ed.globalContext?this.uuid="_gid"+Ed.uuidContext.nodeContextUuid++:this.uuid="_uid"+Ed.uuidContext.nodeContextUuid++,this.type=e,this.name=""}static startContext(e){this.uuidContext===null||this.uuidContext===Ed.globalContext?this.uuidContext=e:console.error("Can't start context twice")}static endContext(e){this.uuidContext!==e&&console.error("Can't end context twice"),this.uuidContext=null}analyze(e,t){t=t??{},e.analyzing=!0,this.build(e.addFlow(t.slot,t.cache,t.context),"v4"),e.clearVertexNodeCode(),e.clearFragmentNodeCode(),e.removeFlow(),e.analyzing=!1}analyzeAndFlow(e,t,i){return i=i??{},this.analyze(e,i),this.flow(e,t,i)}flow(e,t,i){i=i??{},e.addFlow(i.slot,i.cache,i.context);let r={result:this.build(e,t),code:e.clearNodeCode(),extra:e.context.extra};return e.removeFlow(),r}build(e,t,i){t=t??this.getType(e,t);let r=e.getNodeData(i??this);return e.analyzing&&this.appendDepsNode(e,r,t),e.nodes.indexOf(this)===-1&&e.nodes.push(this),this.updateFrame!==void 0&&e.updaters.indexOf(this)===-1&&e.updaters.push(this),this.generate(e,t,i)}updateFrame(e){}generateReadonly(e,t,i,r,n,s){return""}generate(e,t,i,r,n){return""}parse(e,t,i,r){}appendDepsNode(e,t,i){t.deps=(t.deps||0)+1;let r=e.getTypeLength(i);(r>(t.outputMax||0)||this.getType(e,i))&&(t.outputMax=r,t.output=i)}setName(e){this.name=e}getName(){return this.name}getType(e,t){return t==="sampler2D"||t==="samplerCube"?t:this.type}},jn=Ed;jn.globalContext={nodeContextUuid:0},jn.uuidContext=Ed.globalContext;var IW=class{constructor(e){e=e??{},this.name=e.name,this.type=e.type,this.node=e.node,this.size=e.size,this.needsUpdate=e.needsUpdate}get value(){return this.node.value}set value(e){this.node.value=e}},WRe=class{constructor(){this.nodes={},this.keywords={}}add(e){this.nodes[e.name]=e}addKeyword(e,t,i){i=i!==void 0?i:!0,this.keywords[e]={callback:t,cache:i}}remove(e){delete this.nodes[e.name]}removeKeyword(e){delete this.keywords[e]}get(e){return this.nodes[e]}getKeyword(e,t){return this.keywords[e].callback(t)}getKeywordData(e){return this.keywords[e]}contains(e){return this.nodes[e]!==void 0}containsKeyword(e){return this.keywords[e]!==void 0}},eo=new WRe,hr=class extends jn{constructor(e,t){super(e),this.scope="",t=t??{},this.shared=t.shared!==void 0?t.shared:!0,this.unique=t.unique!==void 0?t.unique:!1}build(e,t,i,r){if(t=t??this.getType(e),this.getShared(e,t)){let n=this.getUnique(e,t);n&&this.uuid===void 0&&(this.uuid=Tt.generateUUID()),i=e.getUUID(i??this.getUUID(),!n);let s=e.getNodeData(i),a=s.output||this.getType(e);if(e.analyzing)return(s.deps||0)>0||this.getLabel()?(this.appendDepsNode(e,s,t),this.generate(e,t,i)):super.build(e,t,i);if(n)return s.name=s.name||super.build(e,t,i),s.name;if(!this.getLabel()&&(!this.getShared(e,a)||e.context.ignoreCache||s.deps===1))return super.build(e,t,i);i=this.getUUID(!1);let o=this.getTemp(e,i);if(o)return e.format(o,a,t);{o=super.generate(e,t,i,s.output,r);let l=this.generate(e,a,i);return e.addNodeCode(o+" = "+l+";"),e.format(o,a,t)}}return super.build(e,t,i)}getShared(e,t){return t!=="sampler2D"&&t!=="samplerCube"&&this.shared}getUnique(e,t){return this.unique}setLabel(e){return this.label=e,this}getLabel(){return this.label}getUUID(e){let t=this.uuid;return typeof this.scope=="string"&&(t=this.scope+"-"+t),t}getTemp(e,t){t=t||this.uuid;let i=e.getVars()[t];return i?i.name:void 0}generate(e,t,i,r,n){return this.getShared(e,t)||console.error("TempNode is not shared"),i=i??this.uuid,e.getTempVar(i,r??this.getType(e),n,this.getLabel()).name}},ho=class extends hr{constructor(e,t){t=t??{},t.shared=t.shared!==void 0?t.shared:!1,super(e,t),this.readonly=!1}setReadonly(e){return this.readonly=e,this.hashProperties=this.readonly?["value"]:void 0,this}getReadonly(){return this.readonly}generate(e,t,i,r,n,s){i=e.getUUID(i??this.getUUID()),r=r??this.getType(e);let a=e.getNodeData(i);return this.getReadonly()&&this.generateReadonly!==void 0?this.generateReadonly(e,t,i,r,n,s):e.isShader("vertex")?(a.vertex||(a.vertex=e.createVertexUniform(r,this,n,s,this.getLabel())),e.format(a.vertex.name,r,t)):(a.fragment||(a.fragment=e.createFragmentUniform(r,this,n,s,this.getLabel())),e.format(a.fragment.name,r,t))}},Cs=class extends ho{constructor(e=0,t){super("v2"),this.nodeType="Vector2",this.value=e instanceof Me?e:new Me(e,t)}get x(){return this.value.x}set x(e){this.value.x=e}get y(){return this.value.y}set y(e){this.value.y=e}generateReadonly(e,t,i,r,n,s){return e.format("vec2("+this.value.x+", "+this.value.y+")",r,t)}},nl=class extends ho{constructor(e=0,t,i){super("v3"),this.nodeType="Vector3",this.value=e instanceof N?e:new N(e,t,i)}get x(){return this.value.x}set x(e){this.value.x=e}get y(){return this.value.y}set y(e){this.value.y=e}get z(){return this.value.z}set z(e){this.value.z=e}generateReadonly(e,t,i,r,n,s){return e.format("vec3("+this.value.x+", "+this.value.y+", "+this.value.z+")",r,t)}},Bs=class extends Yt{constructor(e,t,i,r){super(e,t,i),this.isColorA=!0,this.a=r}setRGBA(e,t,i,r){super.setRGB(e,t,i),this.a=r}copy(e){return super.copy(e),this.a="a"in e?e.a:1,this}clone(){return new this.constructor(this.r,this.g,this.b,this.a)}equals(e){return super.equals(e)&&this.a===e.a}setStyle(e,t="srgb"){let i;if(e==="transparent")return this.setRGBA(0,0,0,0),this;if(i=/^((?:rgb|hsl)a?)\(([^)]*)\)/.exec(e)){let r,n=i[1],s=i[2];switch(n){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.a=n==="rgba"?parseFloat(r[4]):1,super.setStyle(e,t);break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)%\s*,\s*(\d*\.?\d+)%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.a=n==="hsla"?parseFloat(r[4]):1,super.setStyle(e,t);break}}return super.setStyle(e,t)}get x(){return this.r}get y(){return this.g}get z(){return this.b}get w(){return this.a}set x(e){this.r=e}set y(e){this.g=e}set z(e){this.b=e}set w(e){this.a=e}},Yu=class extends ho{constructor(e){super("v4"),this.nodeType="Vector4",this.value=e instanceof Bs?e:new Bs(e.r,e.g,e.b,e.a)}generateReadonly(e,t,i,r,n,s){return e.format("vec4("+this.value.r+", "+this.value.g+", "+this.value.b+", "+this.value.a+")",r,t)}},XRe=/^\s*([a-z_0-9]+)\s([a-z_0-9]+)\s*\((.*?)\)/i,LW=/[a-z_0-9]+/gi,wt=class extends hr{constructor(e,t,i,r,n){super(n),this.src="",this.nodeType="Function",this.useKeywords=!0,this.includes=[],this.extensions={},this.keywords={},this.isMethod=n===void 0,this.isInterface=!1,this.parse(e,t,i,r)}getShared(e,t){return!this.isMethod}getType(e){return e.getTypeByFormat(this.type)}getInputByName(e){if(this.inputs){let t=this.inputs.length;for(;t--;)if(this.inputs[t].name===e)return this.inputs[t]}}getIncludeByName(e){if(this.includes){let t=this.includes.length;for(;t--;)if(this.includes[t].name===e)return this.includes[t]}}generate(e,t,i,r,n){let s,a=0,o=this.src;if(this.includes)for(let c=0;c<this.includes.length;c++)e.include(this.includes[c],this);for(let c in this.extensions)e.extensions[c]=!0;let l=[];for(;s=LW.exec(this.src);)l.push(s);for(let c=0;c<l.length;c++){let u=l[c],h=u[0],d=this.isMethod?!this.getInputByName(h):!0,f=h;if(this.keywords[h]||this.useKeywords&&d&&eo.containsKeyword(h)){let p=this.keywords[h];if(!p){let v=eo.getKeywordData(h);v.cache&&(p=e.keywords[h]),p=p||eo.getKeyword(h,e),v.cache&&(e.keywords[h]=p)}f=p.build(e)}h!==f&&o[u.index+a-1]!=="."&&(o=o.substring(0,u.index+a)+f+o.substring(u.index+h.length+a),a+=f.length-h.length),this.getIncludeByName(f)===void 0&&eo.contains(f)&&e.include(eo.get(f))}return t==="source"?o:this.isMethod?(this.isInterface||e.include(this,void 0,o),this.name):e.format("( "+o+" )",this.getType(e),t)}parse(e,t,i,r){if(this.src=e||"",this.includes=t??[],this.extensions=i??{},this.keywords=r??{},this.isMethod){let n=XRe.exec(this.src);if(this.inputs=[],n&&n.length==4){this.type=n[1],this.name=n[2];let s=n[3].match(LW);if(s){let a=0;for(;a<s.length;){let o=s[a++],l;o==="in"||o==="out"||o==="inout"?l=s[a++]:(l=o,o="");let c=s[a++];this.inputs.push({name:c,type:l,qualifier:o})}}this.isInterface=this.src.indexOf("{")===-1}else this.type="",this.name=""}}},qRe=/^([a-z_0-9]+)\s([a-z_0-9]+)\s?\=?\s?(.*?)(\;|$)/i,wte=class extends hr{constructor(e="",t){super(),this.src="",this.useDefine=!1,this.nodeType="Const",this.parse(e||wte.PI,void 0,void 0,void 0,t)}getType(e){return e.getTypeByFormat(this.type)}parse(e,t,i,r,n){this.src=e||"";let s,a,o="",l=qRe.exec(e);this.useDefine=n??this.src.charAt(0)==="#",l&&l.length>1?(a=l[1],s=l[2],o=l[3]):(s=this.src,a="f"),this.name=s,this.type=a,this.value=o}build(e,t){if(t==="source"){if(this.value)return this.useDefine?"#define "+this.name+" "+this.value:"const "+this.type+" "+this.name+" = "+this.value+";";if(this.useDefine)return this.src}return e.include(this),e.format(this.name,this.getType(e),t)}generate(e,t,i,r,n){return e.format(this.name,this.getType(e),t)}},tr=wte;tr.PI="PI",tr.PI2="PI2",tr.RECIPROCAL_PI="RECIPROCAL_PI",tr.RECIPROCAL_PI2="RECIPROCAL_PI2",tr.LOG2="LOG2",tr.EPSILON="EPSILON";var YRe=new RegExp(`^structs*([a-z_0-9]+)s*{s*((.|
)*?)}`,"gim"),QRe=new RegExp("s*(w*?)s*(w*?)(=|;)","gim"),bte=class extends hr{constructor(e=""){super(),this.inputs=[],this.src="",this.nodeType="Struct",this.parse(e)}getType(e){return e.getTypeByFormat(this.name)}getInputByName(e){let t=this.inputs.length;for(;t--;)if(this.inputs[t].name===e)return this.inputs[t]}generate(e,t,i,r,n){return t==="source"?this.src+";":e.format("( "+this.src+" )",this.getType(e),t)}parse(e=""){this.src=e,this.inputs=[];let t=YRe.exec(e);if(t){let i=t[2],r;for(;r=QRe.exec(i);)this.inputs.push({type:r[1],name:r[2]});this.name=t[1]}else this.name="";this.type=this.name}},ZN=class extends hr{constructor(e){super("v2",{shared:!1}),this.nodeType="UV",this.index=e??0}generate(e,t){e.requires.uv[this.index]=!0;let i=this.index>0?this.index+1:"",r=e.isShader("vertex")?"uv"+i:"vUv"+i;return e.format(r,this.getType(e),t)}};eo.addKeyword("uv",function(){return new ZN});eo.addKeyword("uv2",function(){return new ZN(1)});var xv=class extends hr{constructor(e,t){super("v4"),this.nodeType="ColorSpace",this.input=e,this.method=t??xv.LINEAR_TO_LINEAR,this.hashProperties=["method"]}static getEncodingComponents(e){switch(e){case sc:return["Linear"];case vi:return["sRGB"];default:return[]}}generate(e,t){var a;let i=this.input.build(e,"v4"),r=this.getType(e),n=xv.Nodes[this.method],s=e.include(n);if(s===xv.LINEAR_TO_LINEAR)return e.format(i,r,t);if(((a=n.inputs)==null?void 0:a.length)===2){let o=this.factor.build(e,"f");return e.format(s+"( "+i+", "+o+" )",r,t)}else return e.format(s+"( "+i+" )",r,t)}fromEncoding(e){let t=xv.getEncodingComponents(e);this.method="LinearTo"+t[0],this.factor=t[1]}fromDecoding(e){let t=xv.getEncodingComponents(e);this.method=t[0]+"ToLinear",this.factor=t[1]}},jc=xv;jc.Nodes={LinearToLinear:new wt(["vec4 LinearToLinear( in vec4 value ) {","	return value;","}"].join(`
`)),sRGBToLinear:new wt(["vec4 sRGBToLinear( in vec4 value ) {","	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );","}"].join(`
`)),LinearTosRGB:new wt(["vec4 LinearTosRGB( in vec4 value ) {","	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );","}"].join(`
`))},jc.LINEAR_TO_LINEAR="LinearToLinear",jc.SRGB_TO_LINEAR="sRGBToLinear",jc.LINEAR_TO_SRGB="LinearTosRGB";var br=class extends wt{constructor(e="",t,i,r,n){super(e,n,r,i,t),this.nodeType="Expression"}},ih=class extends ho{constructor(e=new jr,t,i,r){super("v4",{shared:!0}),this.nodeType="Texture",this.value=e,this.uv=t??new ZN,this.bias=i,this.project=r!==void 0?r:!1}getTexture(e,t){return super.generate(e,t,this.value.uuid,"t")}generate(e,t){if(t==="sampler2D")return this.getTexture(e,t);let i=this.getTexture(e,t),r=this.uv.build(e,this.project?"v4":"v2"),n=this.bias?this.bias.build(e,"f"):void 0;n===void 0&&e.context.bias&&(n=e.context.bias.setTexture(this).build(e,"f"));let s,a;this.project?s="texture2DProj":s=n?"tex2DBias":"tex2D",n?a=s+"( "+i+", "+r+", "+n+" )":a=s+"( "+i+", "+r+" )";let o={include:e.isShader("vertex"),ignoreCache:!0},l=this.getType(e);return e.addContext(o),this.colorSpace=this.colorSpace??new jc(new br("",l)),this.colorSpace.fromDecoding(e.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(a),a=this.colorSpace.build(e,l),e.removeContext(),e.format(a,l,t)}},Dt=class extends ho{constructor(e){super("f"),this.nodeType="Float",this.value=e??0}generateReadonly(e,t,i,r,n,s){return e.format(this.value+(this.value%1?"":".0"),r,t)}},OW=class extends hr{constructor(e,t){super(),this.inputs=[],this.nodeType="FunctionCall",this.value=e,this.inputs=t??[]}getFunction(){return this.value}getType(e){return this.value.getType(e)}generate(e,t,i,r,n){r=this.getType(e);let s=this.value,a=s.build(e,t)+"( ",o=[];if(s.inputs){for(let l=0;l<s.inputs.length;l++){let c=s.inputs[l],u=this.inputs[l]||this.inputs[c.name];o.push(u.build(e,e.getTypeByFormat(c.type)))}a+=o.join(", ")+" )"}return e.format(a,r,t)}},_te=class extends hr{constructor(e,t,i=_te.ADD){super(),this.nodeType="Operator",this.type=e.type,this.a=e,this.b=t,this.op=i}getType(e){let t=this.a.getType(e),i=this.b.getType(e);return e.isTypeMatrix(t)?"v4":e.getTypeLength(i)>e.getTypeLength(t)?i:t}generate(e,t){let i=this.getType(e);this.type=i;let r=this.a.build(e,i),n=this.b.build(e,i);return e.format("( "+r+" "+this.op+" "+n+" )",i,t)}},Ya=_te;Ya.ADD="+",Ya.SUB="-",Ya.MUL="*",Ya.DIV="/";var nr=class extends hr{constructor(e,t=nr.ABS,i,r){super(),this.nodeType="Math",this.a=e,typeof t!="string"?this.b=t:r=t,typeof i!="string"?this.c=i:r=i,this.method=r,this.hashProperties=["method"]}getNumInputs(e){switch(this.method){case nr.MIX:case nr.CLAMP:case nr.REFRACT:case nr.SMOOTHSTEP:case nr.FACEFORWARD:return 3;case nr.MIN:case nr.MAX:case nr.MOD:case nr.STEP:case nr.REFLECT:case nr.DISTANCE:case nr.DOT:case nr.CROSS:case nr.POW:return 2;default:return 1}}getInputType(e){let t=e.getTypeLength(this.a.getType(e)),i=this.b?e.getTypeLength(this.b.getType(e)):0,r=this.c?e.getTypeLength(this.c.getType(e)):0;return t>i&&t>r?this.a.getType(e):i>r?this.b.getType(e):this.c.getType(e)}getType(e){switch(this.method){case nr.LENGTH:case nr.DISTANCE:case nr.DOT:return"f";case nr.CROSS:return"v3"}return this.getInputType(e)}generate(e,t){let i,r,n,s=this.a?e.getTypeLength(this.a.getType(e)):0,a=this.b?e.getTypeLength(this.b.getType(e)):0,o=this.c?e.getTypeLength(this.c.getType(e)):0,l=this.getInputType(e),c=this.getType(e);switch(this.type=c,this.method){case nr.NEGATE:return e.format("( -"+this.a.build(e,l)+" )",l,t);case nr.INVERT:return e.format("( 1.0 - "+this.a.build(e,l)+" )",l,t);case nr.CROSS:i=this.a.build(e,"v3"),r=this.b.build(e,"v3");break;case nr.STEP:i=this.a.build(e,s===1?"f":l),r=this.b.build(e,l);break;case nr.MIN:case nr.MAX:case nr.MOD:i=this.a.build(e,l),r=this.b.build(e,a===1?"f":l);break;case nr.REFRACT:i=this.a.build(e,l),r=this.b.build(e,l),n=this.c.build(e,"f");break;case nr.MIX:i=this.a.build(e,l),r=this.b.build(e,l),n=this.c.build(e,o===1?"f":l);break;default:i=this.a.build(e,l),this.b&&(r=this.b.build(e,l)),this.c&&(n=this.c.build(e,l));break}let u=[];u.push(i),r&&u.push(r),n&&u.push(n);let h=this.getNumInputs(e);if(u.length!==h)throw Error(`Arguments not match used in "${this.method}". Require ${h}, currently ${u.length}.`);return e.format(this.method+"( "+u.join(", ")+" )",c,t)}},mi=nr;mi.RAD="radians",mi.DEG="degrees",mi.EXP="exp",mi.EXP2="exp2",mi.LOG="log",mi.LOG2="log2",mi.SQRT="sqrt",mi.INV_SQRT="inversesqrt",mi.FLOOR="floor",mi.CEIL="ceil",mi.NORMALIZE="normalize",mi.FRACT="fract",mi.SATURATE="saturate",mi.SIN="sin",mi.COS="cos",mi.TAN="tan",mi.ASIN="asin",mi.ACOS="acos",mi.ARCTAN="atan",mi.ABS="abs",mi.SIGN="sign",mi.LENGTH="length",mi.NEGATE="negate",mi.INVERT="invert",mi.MIN="min",mi.MAX="max",mi.MOD="mod",mi.STEP="step",mi.REFLECT="reflect",mi.DISTANCE="distance",mi.DOT="dot",mi.CROSS="cross",mi.POW="pow",mi.MIX="mix",mi.CLAMP="clamp",mi.REFRACT="refract",mi.SMOOTHSTEP="smoothstep",mi.FACEFORWARD="faceforward";var ux=class extends hr{constructor(e,t,i){super("v4"),this.nodeType="TextureCubeUV",this.value=e,this.uv=t,this.bias=i}bilinearCubeUV(e,t,i,r){let n=new OW(ux.Nodes.bilinearCubeUV,[t,i,r]);this.colorSpaceTL=this.colorSpaceTL??new jc(new br("","v4")),this.colorSpaceTL.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceTL.input.parse(n.build(e)+".tl"),this.colorSpaceTR=this.colorSpaceTR??new jc(new br("","v4")),this.colorSpaceTR.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceTR.input.parse(n.build(e)+".tr"),this.colorSpaceBL=this.colorSpaceBL??new jc(new br("","v4")),this.colorSpaceBL.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceBL.input.parse(n.build(e)+".bl"),this.colorSpaceBR=this.colorSpaceBR??new jc(new br("","v4")),this.colorSpaceBR.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceBR.input.parse(n.build(e)+".br");let s={include:e.isShader("vertex"),ignoreCache:!0};e.addContext(s),this.colorSpaceTLExp=new br(this.colorSpaceTL.build(e,"v4"),"v4"),this.colorSpaceTRExp=new br(this.colorSpaceTR.build(e,"v4"),"v4"),this.colorSpaceBLExp=new br(this.colorSpaceBL.build(e,"v4"),"v4"),this.colorSpaceBRExp=new br(this.colorSpaceBR.build(e,"v4"),"v4"),e.removeContext();let a=new br("mix( mix( cubeUV_TL, cubeUV_TR, cubeUV.f.x ), mix( cubeUV_BL, cubeUV_BR, cubeUV.f.x ), cubeUV.f.y )","v4");return a.keywords.cubeUV_TL=this.colorSpaceTLExp,a.keywords.cubeUV_TR=this.colorSpaceTRExp,a.keywords.cubeUV_BL=this.colorSpaceBLExp,a.keywords.cubeUV_BR=this.colorSpaceBRExp,a.keywords.cubeUV=n,a}generate(e,t){if(e.isShader("fragment")){let i=this.uv,r=this.bias||e.context.roughness,n=new OW(ux.Nodes.roughnessToMip,[r]),s=new mi(n,ux.Nodes.m0,ux.Nodes.cubeUV_maxMipLevel,mi.CLAMP),a=new mi(s,mi.FLOOR),o=new mi(s,mi.FRACT),l=this.bilinearCubeUV(e,this.value,i,a),c=this.bilinearCubeUV(e,this.value,i,new Ya(a,new Dt(1).setReadonly(!0),Ya.ADD)),u=new mi(l,c,o,mi.MIX);return e.format(u.build(e),"v4",t)}else return console.warn("TextureCubeUVNode is not compatible with "+e.shader+" shader."),e.format("vec4( 0.0 )",this.getType(e),t)}},cB=ux;cB.Nodes=function(){let e=new bte(`struct TextureCubeUVData {
			vec4 tl;
			vec4 tr;
			vec4 br;
			vec4 bl;
			vec2 f;
		}`),t=new tr("float cubeUV_maxMipLevel 8.0",!0),i=new tr("float cubeUV_minMipLevel 4.0",!0),r=new tr("float cubeUV_maxTileSize 256.0",!0),n=new tr("float cubeUV_minTileSize 16.0",!0),s=new wt(`float getFace(vec3 direction) {
				vec3 absDirection = abs(direction);
				float face = -1.0;
				if (absDirection.x > absDirection.z) {
					if (absDirection.x > absDirection.y)
						face = direction.x > 0.0 ? 0.0 : 3.0;
					else
						face = direction.y > 0.0 ? 1.0 : 4.0;
				} else {
					if (absDirection.z > absDirection.y)
						face = direction.z > 0.0 ? 2.0 : 5.0;
					else
						face = direction.y > 0.0 ? 1.0 : 4.0;
				}
				return face;
		}`);s.useKeywords=!1;let a=new wt(`vec2 getUV(vec3 direction, float face) {
				vec2 uv;
				if (face == 0.0) {
					uv = vec2(direction.z, direction.y) / abs(direction.x); // pos x
				} else if (face == 1.0) {
					uv = vec2(-direction.x, -direction.z) / abs(direction.y); // pos y
				} else if (face == 2.0) {
					uv = vec2(-direction.x, direction.y) / abs(direction.z); // pos z
				} else if (face == 3.0) {
					uv = vec2(-direction.z, direction.y) / abs(direction.x); // neg x
				} else if (face == 4.0) {
					uv = vec2(-direction.x, direction.z) / abs(direction.y); // neg y
				} else {
					uv = vec2(direction.x, direction.y) / abs(direction.z); // neg z
				}
				return 0.5 * (uv + 1.0);
		}`);a.useKeywords=!1;let o=new wt(`TextureCubeUVData bilinearCubeUV(sampler2D envMap, vec3 direction, float mipInt) {
			float face = getFace(direction);
			float filterInt = max(cubeUV_minMipLevel - mipInt, 0.0);
			mipInt = max(mipInt, cubeUV_minMipLevel);
			float faceSize = exp2(mipInt);
			float texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);
			vec2 uv = getUV(direction, face) * (faceSize - 1.0);
			vec2 f = fract(uv);
			uv += 0.5 - f;
			if (face > 2.0) {
				uv.y += faceSize;
				face -= 3.0;
			}
			uv.x += face * faceSize;
			if(mipInt < cubeUV_maxMipLevel){
				uv.y += 2.0 * cubeUV_maxTileSize;
			}
			uv.y += filterInt * 2.0 * cubeUV_minTileSize;
			uv.x += 3.0 * max(0.0, cubeUV_maxTileSize - 2.0 * faceSize);
			uv *= texelSize;
			vec4 tl = texture2D(envMap, uv);
			uv.x += texelSize;
			vec4 tr = texture2D(envMap, uv);
			uv.y += texelSize;
			vec4 br = texture2D(envMap, uv);
			uv.x -= texelSize;
			vec4 bl = texture2D(envMap, uv);
			return TextureCubeUVData( tl, tr, br, bl, f );
		}`,[e,s,a,t,i,r,n]);o.useKeywords=!1;let l=new tr("float r0 1.0",!0),c=new tr("float v0 0.339",!0),u=new tr("float m0 -2.0",!0),h=new tr("float r1 0.8",!0),d=new tr("float v1 0.276",!0),f=new tr("float m1 -1.0",!0),p=new tr("float r4 0.4",!0),v=new tr("float v4 0.046",!0),m=new tr("float m4 2.0",!0),g=new tr("float r5 0.305",!0),y=new tr("float v5 0.016",!0),x=new tr("float m5 3.0",!0),_=new tr("float r6 0.21",!0),M=new tr("float v6 0.0038",!0),S=new tr("float m6 4.0",!0),T=[l,c,u,h,d,f,p,v,m,g,y,x,_,M,S],E=new wt(`float roughnessToMip(float roughness) {
			float mip = 0.0;
			if (roughness >= r1) {
				mip = (r0 - roughness) * (m1 - m0) / (r0 - r1) + m0;
			} else if (roughness >= r4) {
				mip = (r1 - roughness) * (m4 - m1) / (r1 - r4) + m1;
			} else if (roughness >= r5) {
				mip = (r4 - roughness) * (m5 - m4) / (r4 - r5) + m4;
			} else if (roughness >= r6) {
				mip = (r5 - roughness) * (m6 - m5) / (r5 - r6) + m5;
			} else {
				mip = -2.0 * log2(1.16 * roughness);// 1.16 = 1.79^0.25
			}
			return mip;
		}`,T);return{bilinearCubeUV:o,roughnessToMip:E,m0:u,cubeUV_maxMipLevel:t}}();var wv=class extends hr{constructor(e){super("v3"),this.nodeType="Normal",this.scope=e??wv.VIEW}getShared(){return this.scope===wv.WORLD}build(e,t,i,r){let n=e.context[this.scope+"Normal"];return n?n.build(e,t,i,r):super.build(e,t,i)}generate(e,t,i,r,n){let s;switch(this.scope){case wv.VIEW:e.isShader("vertex")?s="transformedNormal":s="geometryNormal";break;case wv.LOCAL:e.isShader("vertex")?s="objectNormal":(e.requires.normal=!0,s="vObjectNormal");break;case wv.WORLD:e.isShader("vertex")?s="inverseTransformDirection( transformedNormal, viewMatrix ).xyz":(e.requires.worldNormal=!0,s="vWNormal");break}return e.format(s,this.getType(e),t)}},ro=wv;ro.LOCAL="local",ro.WORLD="world",ro.VIEW="view",ro.NORMAL="normal";eo.addKeyword("viewNormal",function(){return new ro(ro.VIEW)});eo.addKeyword("localNormal",function(){return new ro(ro.NORMAL)});eo.addKeyword("worldNormal",function(){return new ro(ro.WORLD)});var Gu=class extends hr{constructor(e){super("v3"),this.nodeType="Position",this.scope=e??Gu.LOCAL}getType(){switch(this.scope){case Gu.PROJECTION:return"v4"}return this.type}getShader(){switch(this.scope){case Gu.LOCAL:case Gu.WORLD:return!1}return!0}generate(e,t,i,r,n){let s;switch(this.scope){case Gu.LOCAL:e.isShader("vertex")?s="transformed":(e.requires.position=!0,s="vPosition");break;case Gu.WORLD:if(e.isShader("vertex"))return"( modelMatrix * vec4( transformed, 1.0 ) ).xyz";e.requires.worldPosition=!0,s="vWPosition";break;case Gu.VIEW:s=e.isShader("vertex")?"-mvPosition.xyz":"vViewPosition";break;case Gu.PROJECTION:s=e.isShader("vertex")?"( projectionMatrix * modelViewMatrix * vec4( position, 1.0 ) )":"vec4( 0.0 )";break}return e.format(s,this.getType(),t)}},Kl=Gu;Kl.LOCAL="local",Kl.WORLD="world",Kl.VIEW="view",Kl.PROJECTION="projection";eo.addKeyword("position",function(){return new Kl});eo.addKeyword("worldPosition",function(){return new Kl(Kl.WORLD)});eo.addKeyword("viewPosition",function(){return new Kl(Kl.VIEW)});var Lc=class extends hr{constructor(e){super("v3"),this.nodeType="Reflect",this.scope=e??Lc.CUBE}getUnique(e){return!e.context.viewNormal}getType(){switch(this.scope){case Lc.SPHERE:return"v2"}return this.type}generate(e,t){let i=this.getUnique(e);if(e.isShader("fragment")){let r;switch(this.scope){case Lc.VECTOR:{let n=new ro(ro.VIEW),s=e.context.roughness,a=n.build(e,"v3"),o=new Kl(Kl.VIEW).build(e,"v3"),l=s?s.build(e,"f"):void 0,c=`reflect( -normalize( ${o} ), ${a} )`;l&&(c=`normalize( mix( ${c}, ${a}, ${l} * ${l} ) )`);let u=`inverseTransformDirection( ${c}, viewMatrix )`;i?(e.addNodeCode(`vec3 reflectVec = ${u};`),r="reflectVec"):r=u;break}case Lc.CUBE:{let n=new Lc(Lc.VECTOR).build(e,"v3"),s="vec3( -"+n+".x, "+n+".yz )";i?(e.addNodeCode(`vec3 reflectCubeVec = ${s};`),r="reflectCubeVec"):r=s;break}case Lc.SPHERE:{let n="normalize( ( viewMatrix * vec4( "+new Lc(Lc.VECTOR).build(e,"v3")+", 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) ).xy * 0.5 + 0.5";i?(e.addNodeCode(`vec2 reflectSphereVec = ${n};`),r="reflectSphereVec"):r=n;break}}return e.format(r,this.getType(),t)}else return console.warn("ReflectNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.type,t)}},m0=Lc;m0.CUBE="cube",m0.SPHERE="sphere",m0.VECTOR="vector";var ZRe=class extends hr{constructor(e=new ih,t,i){super("v4"),this.nodeType="TextureCube",this.value=e,this.radianceNode=new cB(this.value,t??new m0(m0.VECTOR),i),this.irradianceNode=new cB(this.value,new ro(ro.WORLD),new Dt(1).setReadonly(!0))}generate(e,t){return e.isShader("fragment")?(e.require("irradiance"),e.context.bias&&e.context.bias.setTexture(this.value),(e.slot==="irradiance"?this.irradianceNode:this.radianceNode).build(e,t)):(console.warn("TextureCubeNode is not compatible with "+e.shader+" shader."),e.format("vec4( 0.0 )",this.getType(e),t))}},KRe=class extends ho{constructor(e=new $U,t,i){super("v4",{shared:!0}),this.nodeType="CubeTexture",this.value=e,this.uv=t??new m0,this.bias=i}getTexture(e,t){return super.generate(e,t,this.value.uuid,"tc")}generate(e,t){var l;if(t==="samplerCube")return this.getTexture(e,t);let i=this.getTexture(e,t),r=(l=this.uv)==null?void 0:l.build(e,"v3"),n=this.bias?this.bias.build(e,"f"):void 0;n===void 0&&e.context.bias&&(n=e.context.bias.setTexture(this).build(e,"f"));let s;n?s="texCubeBias( "+i+", "+r+", "+n+" )":s="texCube( "+i+", "+r+" )";let a={include:e.isShader("vertex"),ignoreCache:!0},o=this.getType(e);return e.addContext(a),this.colorSpace=this.colorSpace??new jc(new br("",o)),this.colorSpace.fromDecoding(e.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(s),s=this.colorSpace.build(e,o),e.removeContext(),e.format(s,o,t)}},JRe=`
uniform int frameIndex;
uniform vec2 resolution;
uniform mat4 previousModelViewMatrix;
uniform mat4 previousProjectionMatrix;

varying vec4 vCurrentPosition;
varying vec4 vPreviousPosition;
`,$Re=`
layout(location = 1) out vec4 gVelocity;

uniform int frameIndex;
uniform vec2 resolution;

varying vec4 vCurrentPosition;
varying vec4 vPreviousPosition;

const vec2 haltonSequence[16] = vec2[16](
vec2( 0.000000,-0.333334),
vec2(-0.500000, 0.333334),
vec2( 0.500000,-0.777778),
vec2(-0.750000,-0.111112),
vec2( 0.250000, 0.555556),
vec2(-0.250000,-0.555556),
vec2( 0.750000, 0.111112),
vec2(-0.875000, 0.777778),
vec2(0.125000, -0.925926),
vec2(-0.375000, -0.259260),
vec2(0.625000, 0.407408),
vec2(-0.625000, -0.703704),
vec2(0.375000, -0.037038),
vec2(-0.125000, 0.629630),
vec2(0.875000, -0.481482),
vec2(-0.937500, 0.185186));

vec2 vogelDiskSample(int sampleIndex, int sampleCount, float angle) {
  const float goldenAngle = 2.399963f; // radians
  float r = sqrt(float(sampleIndex) + 0.5f) / sqrt(float(sampleCount));
  float theta = float(sampleIndex) * goldenAngle + angle;
  float sine = sin(theta);
  float cosine = cos(theta);
  return vec2(cosine, sine) * r;
}

// Derived from the interleaved gradient function from Jimenez 2014 http:goo.gl/eomGso
float getNoiseInterleavedGradient(vec2 screenPos) {
    vec3 magic = vec3(0.06711056f, 0.00583715f, 52.9829189f);
    return fract(magic.z * fract(dot(screenPos, magic.xy)));
}

`,eIe=`
// TODO: This could be generated CPU side and passed to the shader every frame
const vec2 haltonSequence[16] = vec2[16](
vec2( 0.000000,-0.333334),
vec2(-0.500000, 0.333334),
vec2( 0.500000,-0.777778),
vec2(-0.750000,-0.111112),
vec2( 0.250000, 0.555556),
vec2(-0.250000,-0.555556),
vec2( 0.750000, 0.111112),
vec2(-0.875000, 0.777778),
vec2(0.125000, -0.925926),
vec2(-0.375000, -0.259260),
vec2(0.625000, 0.407408),
vec2(-0.625000, -0.703704),
vec2(0.375000, -0.037038),
vec2(-0.125000, 0.629630),
vec2(0.875000, -0.481482),
vec2(-0.937500, 0.185186));

// TODO: Pass correct view size
vec2 offset = haltonSequence[frameIndex];
offset.x /= resolution.x;
offset.y /= resolution.y;

vec4 currentPosition = gl_Position;
vec4 currentPositionJittered = currentPosition + (vec4(offset.x, offset.y, 0.0, 0.0) * currentPosition.w);

// We want to calculate the velocity with unjittered positions
// so that things that are not moving get a velocity = 0
vCurrentPosition = currentPosition;
vPreviousPosition = previousProjectionMatrix * previousModelViewMatrix * vec4(transformed, 1.0);
#ifdef OUTLINE_COMPENSATION
vPreviousPosition.xy += OUTLINE_COMPENSATION;
#endif
gl_Position = currentPositionJittered;

`,tIe=`
vec2 oldPos = vPreviousPosition.xy;
    oldPos /= vPreviousPosition.w;
    oldPos.xy = (oldPos.xy+1.)/2.0;

vec2 newPos = vCurrentPosition.xy;
    newPos /= vCurrentPosition.w;
    newPos.xy = (newPos.xy+1.)/2.0;

vec2 velocity = (newPos - oldPos);

// Discard fully transparent pixels 
if (gl_FragColor.a <= 0.0) discard;

gVelocity = vec4(velocity, 0.0, 1.0);
`,iIe=`
layout(location = 1) out vec4 gVelocity;
`,rIe=`
    // Discard fully transparent pixels 
    if (gl_FragColor.a <= 0.0) discard;

    gVelocity = vec4(0.0, 0.0, 0.0, 1.0);
`,zW=["x","y","z","w"],nIe=["float","vec2","vec3","vec4"],sIe={float:"f",vec2:"v2",vec3:"v3",vec4:"v4",mat4:"v4",int:"i",bool:"b","float[]":"f[]","vec4[]":"v4[]"},aIe={t:"sampler2D",tc:"samplerCube",b:"bool",i:"int",f:"float",c:"vec3",v2:"vec2",v3:"vec3",v4:"vec4",m3:"mat3",m4:"mat4","f[]":"float[]","v4[]":"vec4[]"},Ste=class{constructor(){this.includes={consts:{},functions:{},structs:{}},this.cache="",this.slot="",this.shader="",this.context={},this.needsJitter=!0,this.getIncludesCode=function(){function e(t,i){return t.deps.length-i.deps.length}return function(t,i){let r=this.getIncludes(t,i);if(!r)return"";let n="";r=r.sort(e);for(let s=0;s<r.length;s++)r[s].src&&(n+=r[s].src+`
`);return n}}(),this.slots=[],this.caches=[],this.contexts=[],this.keywords={},this.nodeData={},this.fragmentVariables={},this.fragmentParsVariables={},this.vertexParsVariables={},this.requires={uv:[],color:[],transparent:!1,irradiance:!1,position:!1,worldPosition:!1,normal:!1,worldNormal:!1,vWorldViewDir:!1,modelMatrix:!1,viewMatrix:!1,projectionMatrix:!1},this.includes={consts:[],functions:[],structs:[]},this.attributes={},this.prefixCode=["#ifdef TEXTURE_LOD_EXT","	#define texCube(a, b) textureCube(a, b)","	#define texCubeBias(a, b, c) textureCubeLodEXT(a, b, c)","	#define tex2D(a, b) texture2D(a, b)","	#define tex2DBias(a, b, c) texture2DLodEXT(a, b, c)","#else","	#define texCube(a, b) textureCube(a, b)","	#define texCubeBias(a, b, c) textureCube(a, b, c)","	#define tex2D(a, b) texture2D(a, b)","	#define tex2DBias(a, b, c) texture2D(a, b, c)","#endif",`
			// NOTE: Include Spline's blending modes. This could be part of BlendNode
			#define SPE_BLENDING_NORMAL 0
			#define SPE_BLENDING_MULTIPLY 1
			#define SPE_BLENDING_SCREEN 2
			#define SPE_BLENDING_OVERLAY 3

			vec3 spe_normalBlend( vec3 a, vec3 b, float alpha ) {
				return mix( a, b, alpha );
			}

			vec3 spe_multiplyBlend( vec3 a, vec3 b, float alpha ) {
				return mix( a, a * b, alpha );
			}

			vec3 spe_screenBlend( vec3 a, vec3 b, float alpha ) {
				vec3 tmp = 1.0 - ( 1.0 - a ) * ( 1.0 - b );
				return mix( a, tmp, alpha );
			}

			vec3 spe_overlayBlend( vec3 a, vec3 b, float alpha ) {
				vec3 tmp = mix( 1. - 2. * (1. - a) * (1. - b), 2. * a * b, step( a, vec3(.5) ) );
				return clamp( mix( a, tmp, alpha ), 0.0, 1.0 );
			}

			vec3 spe_blend( vec3 a, vec3 b, float alpha, int mode ) {
				if ( mode == SPE_BLENDING_NORMAL ) return spe_normalBlend( a, b, alpha );
				else if ( mode == SPE_BLENDING_MULTIPLY ) return spe_multiplyBlend( a, b, alpha );
				else if ( mode == SPE_BLENDING_SCREEN ) return spe_screenBlend( a, b, alpha );
				else if ( mode == SPE_BLENDING_OVERLAY ) return spe_overlayBlend( a, b, alpha );
				return vec3( 1.0 );
			}
			`,"#include <packing>","#include <common>"].join(`
`),this.parsCode={vertex:["float neighbor_offset = 0.0001;",""].join(`
`),fragment:["float accumAlpha = 0.0;",`void accumulateAlpha(float alpha) {
					accumAlpha += (1.0 - accumAlpha) * alpha;
				}`,""].join(`
`)},this.code={vertex:"",fragment:""},this.nodeCode={vertex:"",fragment:""},this.resultCode={vertex:"",fragment:""},this.finalCode={vertex:"",fragment:""},this.inputs={uniforms:{list:[],vertex:[],fragment:[]},arrayUniforms:{list:[],vertex:[],fragment:[]},vars:{varying:[],vertex:[],fragment:[]}},this.defines={},this.uniforms={},this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.updaters=[],this.nodes=[],this.analyzing=!1}build(e,t){this.addVertexParsCode(JRe),this.addFragmentParsCode($Re),this.buildShader("vertex",e),this.buildShader("fragment",t);for(let i=0;i<this.requires.uv.length;i++)if(this.requires.uv[i]){let r=i>0?i+1:"";this.addVaryCode("varying vec2 vUv"+r+";"),i>0&&this.addVertexParsCode("attribute vec2 uv"+r+";"),this.addVertexFinalCode("vUv"+r+" = uv"+r+";")}return this.requires.color[0]&&(this.addVaryCode("varying vec4 vColor;"),this.addVertexParsCode("attribute vec4 color;"),this.addVertexFinalCode("vColor = color;")),this.requires.color[1]&&(this.addVaryCode("varying vec4 vColor2;"),this.addVertexParsCode("attribute vec4 color2;"),this.addVertexFinalCode("vColor2 = color2;")),this.requires.position&&(this.addVaryCode("varying vec3 vPosition;"),this.addVertexFinalCode("vPosition = transformed;")),this.requires.worldPosition,this.requires.normal&&(this.addVaryCode("varying vec3 vObjectNormal;"),this.addVertexFinalCode(`
				#ifndef SHAPEBLEND 
					vObjectNormal = normal;
				#else
					vObjectNormal = objectNormal;
				#endif
			`)),this.requires.modelMatrix&&this.addFragmentParsCode("uniform mat4 modelMatrix;"),this.requires.viewMatrix&&this.addFragmentParsCode("uniform mat4 viewMatrix;"),this.requires.projectionMatrix&&this.addFragmentParsCode("uniform mat4 projectionMatrix;"),this.requires.worldNormal&&(this.addVaryCode("varying vec3 vWNormal;"),this.addVertexFinalCode("vWNormal = inverseTransformDirection( transformedNormal, viewMatrix ).xyz;")),this.requires.vWorldViewDir&&(this.addVaryCode("varying vec3 vWorldViewDir;"),this.addVertexFinalCode("vWorldViewDir = isPerspectiveMatrix( projectionMatrix ) ?  ( (modelMatrix * vec4(position, 1.0)).xyz - cameraPosition ) : vec3( -viewMatrix[0][2], -viewMatrix[1][2], -viewMatrix[2][2] );")),this.needsJitter&&(this.addVertexFinalCode(eIe),this.addFragmentFinalCode(tIe)),this}buildShader(e,t){this.resultCode[e]=t.build(this.setShader(e),"v4")}setMaterial(e,t){return this.defines={},this}addFlow(e,t,i){return this.addSlot(e).addCache(t).addContext(i)}removeFlow(){return this.removeSlot().removeCache().removeContext()}addCache(e){return this.cache=e??"",this.caches.push(this.cache),this}removeCache(){return this.caches.pop(),this.cache=this.caches[this.caches.length-1]||"",this}addContext(e){return this.context=Object.assign({},this.context,e),this.context.extra=this.context.extra||{},this.contexts.push(this.context),this}removeContext(){return this.contexts.pop(),this.context=this.contexts[this.contexts.length-1]||{},this}addSlot(e){return this.slot=e||"",this.slots.push(this.slot),this}removeSlot(){return this.slots.pop(),this.slot=this.slots[this.slots.length-1]||"",this}addFragmentVariable(e,t){this.fragmentVariables[e]===void 0&&(this.addFragmentCode(`${t} ${e};`),this.fragmentVariables[e]="")}addFragmentParsVariable(e,t){this.fragmentParsVariables[e]===void 0&&(this.addFragmentParsCode(`${t} ${e};`),this.fragmentParsVariables[e]="")}addVertexParsVariable(e,t){this.vertexParsVariables[e]===void 0&&(this.addVertexParsCode(`${t} ${e};`),this.vertexParsVariables[e]="")}addVertexCode(e){this.addCode(e,"vertex")}addFragmentCode(e){this.addCode(e,"fragment")}addCode(e,t){this.code[t??this.shader]+=e+`
`}addVertexNodeCode(e){this.addNodeCode(e,"vertex")}addFragmentNodeCode(e){this.addNodeCode(e,"fragment")}addNodeCode(e,t){this.nodeCode[t??this.shader]+=e+`
`}clearNodeCode(e){e=e??this.shader;let t=this.nodeCode[e];return this.nodeCode[e]="",t}clearVertexNodeCode(){return this.clearNodeCode("vertex")}clearFragmentNodeCode(){return this.clearNodeCode("fragment")}addVertexFinalCode(e){this.addFinalCode(e,"vertex")}addFragmentFinalCode(e){this.addFinalCode(e,"fragment")}addFinalCode(e,t){this.finalCode[t??this.shader]+=e+`
`}addVertexParsCode(e){this.addParsCode(e,"vertex")}addFragmentParsCode(e){this.addParsCode(e,"fragment")}addParsCode(e,t){this.parsCode[t??this.shader]+=e+`
`}addVaryCode(e){this.addVertexParsCode(e),this.addFragmentParsCode(e)}isCache(e){return this.caches.indexOf(e)!==-1}isSlot(e){return this.slots.indexOf(e)!==-1}define(e,t){this.defines[e]=t===void 0?1:t}require(e){this.requires[e]=!0}isDefined(e){return this.defines[e]!==void 0}getVar(e,t,i,r="varying",n="V",s=""){let a=this.getVars(r),o=a[e];if(!o){let l=a.length;o={name:i||"node"+n+l+(s?"_"+s:""),type:t},a.push(o),a[e]=o}return o}getTempVar(e,t,i,r){return this.getVar(e,t,i,this.shader,"T",r)}getAttribute(e,t){if(!this.attributes[e]){let i=this.getVar(e,t);this.addVertexParsCode("attribute "+t+" "+e+";"),this.addVertexFinalCode(i.name+" = "+e+";"),this.attributes[e]={varying:i,name:e,type:t}}return this.attributes[e]}getCode(e){return[this.prefixCode,this.parsCode[e],this.getVarListCode(this.getVars("varying"),"varying"),this.getVarListCode(this.inputs.uniforms[e],"uniform"),this.getVarListCode(this.inputs.arrayUniforms[e],"uniform"),this.getIncludesCode("consts",e),this.getIncludesCode("structs",e),this.getIncludesCode("functions",e),"void main() {",this.getVarListCode(this.getVars(e)),this.code[e],this.resultCode[e],this.finalCode[e],"}"].join(`
`)}getVarListCode(e,t){t=t??"";let i="";for(let r=0,n=e.length;r<n;++r){let s=e[r],a=s.type,o=s.name,l=s.size,c=this.getFormatByType(a);if(c===void 0)throw new Error("Node pars "+c+" not found.");c.includes("[]")?i+=t+" "+c.substring(0,c.length-2)+" "+o+`[${l}];
`:i+=t+" "+c+" "+o+`;
`}return i}getVars(e){return this.inputs.vars[e??this.shader]}getNodeData(e){let t=e instanceof jn?e.uuid:e;return this.nodeData[t]=this.nodeData[t]||{}}createUniform(e,t,i,r,n,s){if(t.includes("[]")){let a=this.inputs.arrayUniforms,o=a.list.length,l=new IW({type:t,size:i.size,name:r||"nodeUA"+o+(s?"_"+s:""),node:i,needsUpdate:n});return a.list.push(l),a[e].push(l),a[e][l.name]=l,this.uniforms[l.name]=l,l}else{let a=this.inputs.uniforms,o=a.list.length,l=new IW({type:t,name:r||"nodeU"+o+(s?"_"+s:""),node:i,needsUpdate:n});return a.list.push(l),a[e].push(l),a[e][l.name]=l,this.uniforms[l.name]=l,l}}createVertexUniform(e,t,i,r,n){return this.createUniform("vertex",e,t,i,r,n)}createFragmentUniform(e,t,i,r,n){return this.createUniform("fragment",e,t,i,r,n)}include(e,t,i){var s;let r;if(e=typeof e=="string"?eo.get(e):e,this.context.include===!1)return e.name;e instanceof wt?r=this.includes.functions:e instanceof tr?r=this.includes.consts:e instanceof bte&&(r=this.includes.structs);let n=r[this.shader]=r[this.shader]||[];if(e){let a=n[e.name];if(a||(a=n[e.name]={node:e,deps:[]},n.push(a),a.src=e.build(this,"source")),e instanceof wt&&t&&n[t.name]&&n[t.name].deps.indexOf(e)===-1&&(n[t.name].deps.push(e),(s=e.includes)==null?void 0:s.length)){let o=0;do this.include(e.includes[o++],t);while(o<e.includes.length)}return i&&(a.src=i),e.name}else throw new Error("Include not found.")}colorToVectorProperties(e){return e.replace("r","x").replace("g","y").replace("b","z").replace("a","w")}colorToVector(e){return e.replace(/c/g,"v3")}getIncludes(e,t){return this.includes[e][t||this.shader]}getConstructorFromLength(e){return nIe[e-1]}isTypeMatrix(e){return/^m/.test(e)}getTypeLength(e){return e==="f"?1:parseInt(this.colorToVector(e).substr(1))}getTypeFromLength(e){return e===1?"f":"v"+e}findNode(...e){for(let t=0;t<arguments.length;t++){let i=e[t];if(i!=null&&i.isNode)return i}}resolve(...e){for(let t=0;t<arguments.length;t++){let i=e[t];if(i!==void 0){if(i.isNode)return i;if(i.isTexture)switch(i.mapping){case _m:case Sm:return new KRe(i);case Tb:return new ZRe(new ih(i));default:return new ih(i)}else{if(i.isVector2)return new Cs(i);if(i.isVector3)return new nl(i);if(i.isVector4)return new Yu(i)}}}}format(e,t,i){switch(this.colorToVector(i+" <- "+t)){case"f <- v2":return e+".x";case"f <- v3":return e+".x";case"f <- v4":return e+".x";case"f <- i":case"f <- b":return"float( "+e+" )";case"v2 <- f":return"vec2( "+e+" )";case"v2 <- v3":return e+".xy";case"v2 <- v4":return e+".xy";case"v2 <- i":case"v2 <- b":return"vec2( float( "+e+" ) )";case"v3 <- f":return"vec3( "+e+" )";case"v3 <- v2":return"vec3( "+e+", 0.0 )";case"v3 <- v4":return e+".xyz";case"v3 <- i":case"v3 <- b":return"vec2( float( "+e+" ) )";case"v4 <- f":return"vec4( "+e+" )";case"v4 <- v2":return"vec4( "+e+", 0.0, 1.0 )";case"v4 <- v3":return"vec4( "+e+", 1.0 )";case"v4 <- i":case"v4 <- b":return"vec4( float( "+e+" ) )";case"i <- f":case"i <- b":return"int( "+e+" )";case"i <- v2":return"int( "+e+".x )";case"i <- v3":return"int( "+e+".x )";case"i <- v4":return"int( "+e+".x )";case"b <- f":return"( "+e+" != 0.0 )";case"b <- v2":return"( "+e+" != vec2( 0.0 ) )";case"b <- v3":return"( "+e+" != vec3( 0.0 ) )";case"b <- v4":return"( "+e+" != vec4( 0.0 ) )";case"b <- i":return"( "+e+" != 0 )"}return e}getTypeByFormat(e){return sIe[e]||e}getFormatByType(e){return aIe[e]||e}getUUID(e,t){return t=t!==void 0?t:!0,t&&this.cache&&(e=this.cache+"-"+e),e}getElementByIndex(e){return zW[e]}getIndexByElement(e){return zW.indexOf(e)}isShader(e){return this.shader===e}setShader(e){return this.shader=e,this}mergeDefines(e){for(let t in e)this.defines[t]=e[t];return this.defines}mergeUniform(e){for(let t in e)this.uniforms[t]=e[t];return this.uniforms}getTextureEncodingFromMap(e){let t;return e?e.isTexture&&(t=e.encoding):t=sc,t===sc&&this.context.gamma&&(t=vi),t}},rn=class extends ho{constructor(e=0,t,i,r){super("c"),this.nodeType="Color",this.value=e instanceof Bs?e:new Bs(e||0,t,i,r)}setRGBA(e){this.value.setRGBA(e.r,e.g,e.b,e.a)}generate(e,t,i,r,n,s){i=e.getUUID(i??this.getUUID()),r=r??this.getType(e);let a=e.getNodeData(i),o=this.getReadonly()&&this.generateReadonly!==void 0;if(this.alpha){let l=this.alpha.build(e,"f");e.addFragmentNodeCode(`accumAlpha += ( 1.0 - accumAlpha ) * ${l};`)}return o?this.generateReadonly(e,t,i,r,n,s):e.isShader("vertex")?(a.vertex||(a.vertex=e.createVertexUniform(r,this,n,s,this.getLabel())),e.format(a.vertex.name,r,t)):(a.fragment||(a.fragment=e.createFragmentUniform(r,this,n,s,this.getLabel())),e.format(a.fragment.name,r,t))}generateReadonly(e,t,i,r,n,s){return e.format("vec3("+this.value.r+", "+this.value.g+", "+this.value.b+")",r,t)}},fr=class extends ho{constructor(e){super("i"),this.nodeType="Int",this.value=Math.floor(e??0)}generateReadonly(e,t,i,r,n,s){return e.format(this.value.toString(),r,t)}},Ta=class extends ho{constructor(e){super("b"),this.nodeType="Bool",this.value=e??!1}generateReadonly(e,t,i,r){return e.format(this.value?"true":"false",r,t)}},Ap=class extends ho{constructor(e=1,t){super("f[]"),this.nodeType="FloatArray",this.size=e,this.value=Array.isArray(t)?t:typeof t=="number"?new Array(e).fill(t):new Array(e).fill(0)}},KN=class extends ho{},oIe=class extends KN{constructor(e){super("v3"),this.image=e,this._value=new N}get value(){return this._value.x=this.image.isVideo?this.image.img.videoWidth??0:this.image.img.width,this._value.y=this.image.isVideo?this.image.img.videoHeight??0:this.image.img.height,this._value}},uB=class extends KN{constructor(e,t,i=1008,r=1006){super("t"),this.image=e,this.wrap=t,this.minFilter=i,this.magFilter=r}get value(){return this.image.getTexture(this.wrap,this.minFilter,this.magFilter)}},Mte=class extends ho{constructor(e){super("m3"),this.nodeType="Matrix3",this.value=e??new Dn}generateReadonly(e,t,i,r,n,s){return e.format("mat3("+this.value.elements.join(", ")+")",r,t)}get elements(){return this.value.elements}set elements(e){this.value.fromArray(e)}},cu=class extends ho{constructor(e){super("m4"),this.nodeType="Matrix4",this.value=e??new ft}generateReadonly(e,t,i,r,n,s){return e.format("mat4("+this.value.elements.join(", ")+")",r,t)}get elements(){return this.value.elements}set elements(e){this.value.fromArray(e)}};function BW(e,t,i,r=0){e.setUvTransform(i[0],i[1],t[0],t[1],0,0,0).premultiply(new Dn().makeRotation(r*Tt.DEG2RAD))}var lIe=class extends Mte{constructor(e,t,i=0){super(new Dn),this.repeat=e,this.offset=t,this.rotation=i,BW(this.value,e,t,i)}updateMatrix(){BW(this.value,this.repeat,this.offset,this.rotation)}},Tp=class extends ho{constructor(e=1,t){super("v4[]"),this.nodeType="Vector4Array",this.size=e,this.value=Array.isArray(t)?t:t instanceof ai?new Array(e).fill(t):new Array(e).fill(new ai(0))}},FW=class extends hr{constructor(e,t,i,r){super("v3"),this.nodeType="Blend",this.a=e,this.b=t,this.alpha=i,this.mode=r}generate(e,t){if(e.isShader("fragment")){let i=[];return i.push(this.a.build(e,"c")),i.push(this.b.build(e,"c")),i.push(this.alpha.build(e,"f")),i.push(this.mode.build(e,"i")),e.format("spe_blend("+i.join(",")+")",this.getType(e),t)}else return console.warn("BlendNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},Ete=class extends hr{constructor(e,t){super("v3"),this.nodeType="CustomColor",this.color=e,this.alpha=t,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.isShader("fragment")){let i=e.include(Ete.Nodes.customColor);e.addFragmentVariable(this.calpha,"float");let r=[];return r.push(this.color.build(e,"v3")),r.push(this.mask?`luminance(${this.mask.build(e,"v3")})`:"1.0"),r.push(this.alpha.build(e,"f")),r.push(this.calpha),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("CustomColorNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},hB=Ete;hB.Nodes=function(){return{customColor:new wt(`vec3 customColor(vec3 color, float mask, float alpha, out float calpha) {
				float lalpha = alpha * mask;
				calpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);
				accumAlpha += (1.0 - accumAlpha) * lalpha;

				return color;
			}`)}}();var Ate=class extends hr{constructor(e,t){super("v3"),this.nodeType="CustomNormal",this.cnormal=e,this.alpha=t,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.isShader("fragment")){let i=e.include(Ate.Nodes.customNormal);e.addFragmentVariable(this.calpha,"float");let r=[];return r.push(this.cnormal.build(e,"v3")),r.push("normal"),r.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),r.push(this.alpha.build(e,"f")),r.push(this.calpha),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("CustomNormalNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},Tte=Ate;Tte.Nodes=function(){return{customNormal:new wt(`vec3 customNormal(vec3 cnormal, vec3 norm, float mask, float alpha, out float calpha) {
				vec3 normal = packNormalToRGB( norm ).rgb;
				normal *= step( vec3(0.5), cnormal );

				float lalpha = alpha * mask;
				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += ( 1.0 - accumAlpha ) * lalpha;

				return normal;
			}`)}}();var hx=class extends hr{constructor(e,t,i,r,n,s,a,o,l,c,u,h){super("v3"),this.nodeType="CustomTexture",this.texture=e,this.textureSize=t,this.crop=i,this.projection=r,this.axis=n,this.side=s,this.size=a,this.blending=o,this.mat=l,this.isMask=h,this.alpha=c,this.mode=u,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){e.require("position"),e.require("normal"),e.require("uv"),e.requires.uv=[!0],e.extensions.shaderTextureLOD=!0,e.extensions.derivatives=!0;let i=`g${this.uuid.toString().replace(/-/g,"")}`,r;switch(this.projection.value){case 3:r=e.include(hx.Nodes.cylindrical);break;case 2:r=e.include(hx.Nodes.spherical);break;case 1:let s=["vec3(1.0, 0.0, 0.0)","vec3(0.0, 1.0, 0.0)","vec3(0.0, 0.0, 1.0)"][this.axis.value],a=["zy","xz","xy"][this.axis.value],o=new wt(`
		vec3 ${i}_planarTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {
				vec2 projected = (1. + (position.${a})) / 2.;
				vec2 uvs = ( mat * vec3( (projected * 2. - 1.) / (size * .5), 1. ) / 2. + 0.5 ).xy;
				writeUv = uvs;

				vec4 tmp = texture2D( tex, uvs );

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;
				${this.side.value===2?"":`lalpha *= step(0.0, ${this.side.value===1?"-1.0 * ":""}dot(vObjectNormal, ${s}));`}

				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}
				
				lalpha *= mask;

				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;
			}`);r=e.include(o);break;case 4:r=e.include(hx.Nodes.triplanar);break;default:r=e.include(hx.Nodes.uv);break}e.addFragmentVariable(this.calpha,"float");let n=[];if(n.push("normal"),n.push(this.texture.generate(e,"t")),n.push(this.textureSize.build(e,"v2")),n.push(this.crop.build(e,"f")),n.push(this.mat.build(e,"mat3")),n.push(this.size.build(e,"v2")),n.push(this.blending.build(e,"f")),n.push(this.isMask.build(e,"b")),n.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),n.push(this.alpha.build(e,"f")),n.push(this.mode.build(e,"i")),n.push(this.calpha),this.projection.value===4){let s=`${i}_writeUvs`,a=s+"0",o=s+"1",l=s+"2",c=`${i}_triplanarWeights`;e.addFragmentVariable(a,"vec2"),e.addFragmentVariable(o,"vec2"),e.addFragmentVariable(l,"vec2"),e.addFragmentVariable(c,"vec3"),n.push(a),n.push(o),n.push(l),n.push(c)}else{let s=`${i}_writeUvs`;e.addFragmentVariable(s,"vec2"),n.push(s)}return e.format(r+"("+n.join(",")+")",this.getType(e),t)}},JN=hx;JN.Nodes=function(){let e=new wt(`
vec3 cylindricalTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {
                vec3 posN = normalize(position);
                float u = 0.5 + atan(posN.z, posN.x) / (2.*3.1415);
                float scaledHeight = position.y / (size.y * 0.5);
                float v =  (scaledHeight / 2.) + .5;

                vec2 calculatedUv = vec2(u,v);
				vec2 uvs = ( mat * vec3( calculatedUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;
				writeUv = uvs;

                vec2 df = fwidth(uvs);
               	if(df.x > 0.5) df.x = 0.;

				#ifdef GL_EXT_shader_texture_lod
                vec4 tmp = texture2DLodEXT(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#else
                vec4 tmp = textureLod(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#endif

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;
				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}

				lalpha *= mask;
				
				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;
			}
`),t=new wt(`
vec3 sphericalTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {
                vec3 posN = normalize(vPosition);
                float u = 0.5 + atan(posN.z, posN.x) / (2.*3.1415);
                float v = 0.5 + asin(posN.y) / 3.1415;

                vec2 calculatedUv = vec2(u,v);
				vec2 uvs = ( mat * vec3( calculatedUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;
				writeUv = uvs;

                vec2 df = fwidth(uvs);
               	if(df.x > 0.5) df.x = 0.;
				#ifdef GL_EXT_shader_texture_lod
                vec4 tmp = texture2DLodEXT(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#else
                vec4 tmp = textureLod(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#endif

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;
				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}

				lalpha *= mask;

				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;
			}
`),i=new wt(`vec3 uvTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {
				vec2 uvs = ( mat * vec3( vUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;
				writeUv = uvs;

				vec4 tmp = texture2D( tex, uvs );

				vec3 col = tmp.rgb;

				float lalpha = alpha * tmp.a;
				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}
				
				lalpha *= mask;

				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;
			}`),r=new wt(`vec3 triplanarTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUvs0, out vec2 writeUvs1, out vec2 writeUvs2, out vec3 writeWeights) {
				vec3 p = position;
				vec2 uv0 = (1.0 + p.xy) / 2.0;     
				vec2 uv1 = (1.0 + p.zy) / 2.0;		
				vec2 uv2 = (1.0 + p.xz) / 2.0;		
	
				uv0 = (mat * vec3((uv0 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;
				uv1 = (mat * vec3((uv1 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;
				uv2 = (mat * vec3((uv2 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;

				// Range from 3 to 128 seems to be good
				float exponent = (1.0 - blending) * 125.0 + 3.0;

				vec3 n = vObjectNormal;
				vec3 weights = abs(normalize(n));
				weights = pow(weights, vec3(exponent));
				weights /= dot(weights, vec3(1.0));

				// Write out all sets of UVs that we generated
				writeUvs0 = uv0;
				writeUvs1 = uv1;
				writeUvs2 = uv2;
				writeWeights = weights;

				// Derivatives for LOD
				vec2 df0 = fwidth(uv0);
				vec2 df1 = fwidth(uv1);
				vec2 df2 = fwidth(uv2);
				if (df0.x > 0.5) df0.x = 0.0;
				if (df1.x > 0.5) df1.x = 0.0;
				if (df2.x > 0.5) df2.x = 0.0;

				#ifdef GL_EXT_shader_texture_lod
                	vec4 tmp = 
						texture2DLodEXT(tex, uv0, log2(max(df0.x, df0.y)*min(textureSize.x, textureSize.y))) * weights.z + 
						texture2DLodEXT(tex, uv1, log2(max(df1.x, df1.y)*min(textureSize.x, textureSize.y))) * weights.x + 
						texture2DLodEXT(tex, uv2, log2(max(df2.x, df2.y)*min(textureSize.x, textureSize.y))) * weights.y;
				#else
                	vec4 tmp = 
						textureLod(tex, uv0, log2(max(df0.x, df0.y)*min(textureSize.x, textureSize.y))) * weights.z + 
						textureLod(tex, uv1, log2(max(df1.x, df1.y)*min(textureSize.x, textureSize.y))) * weights.x + 
						textureLod(tex, uv2, log2(max(df2.x, df2.y)*min(textureSize.x, textureSize.y))) * weights.y;
				#endif

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;

				// Apply cropping across all 3 planes
				if ( crop > 0.5 ) {
					if ( uv0.x < 0.0 || uv0.x > 1.0 || uv0.y < 0.0 || uv0.y > 1.0 )  {
						lalpha = 0.0;
					}
					if ( uv1.x < 0.0 || uv1.x > 1.0 || uv1.y < 0.0 || uv1.y > 1.0 )  {
						lalpha = 0.0;
					}
					if ( uv2.x < 0.0 || uv2.x > 1.0 || uv2.y < 0.0 || uv2.y > 1.0 )  {
						lalpha = 0.0;
					}
				}

				lalpha *= mask;
				calpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;//n * 0.5 + 0.5;
			}			
			`);return{cylindrical:e,spherical:t,uv:i,triplanar:r}}();var dx=class extends hr{constructor(e,t,i,r,n,s,a,o,l,c,u,h){super("v3"),this.nodeType="Depth",this.gradientType=e,this.smooth=t,this.near=i,this.far=r,this.isVector=n,this.isWorldSpace=s,this.origin=a,this.direction=o,this.colors=l,this.steps=c,this.isMask=h,this.alpha=u,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){let i=`g${this.uuid.toString().replace(/-/g,"")}`,r=new wt(`vec3 ${i}_sdepth(float near, float far, vec3 origin, vec3 direction, vec4 colors[${i}_MAX_COLORS], float steps[${i}_MAX_COLORS], bool isMask, float mask, float alpha, out float calpha) {
               vec4 color = colors[0];
               #ifdef ${i}_IS_VECTOR
                   #ifdef ${i}_LINEAR
                       #ifdef ${i}_WORLDSPACE
                       float depth = vectorLinearWorldSpaceDepth(direction, origin, near, far);
                       #else
                       float depth = vectorLinearObjectSpaceDepth(direction, origin, near, far);
                       #endif
                   #else
                       #ifdef ${i}_WORLDSPACE
                           float depth = vectorSphericalWorldSpaceDepth(origin, near, far);
                       #else
                           float depth = vectorSphericalObjectSpaceDepth(origin, near, far);
                       #endif
                   #endif
               #else
                   float dist = length(vWPosition - cameraPosition);
			       float depth = ( dist - near ) / ( far - near );
               #endif


              float p;
              #ifdef ${i}_SMOOTH
				for ( int i = 1; i < ${i}_MAX_COLORS; i++ ) {
						p = clamp( ( depth - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );
						color = mix(color, colors[i], smoothstep(0.0, 1.0, p));
					}
              #else
                for ( int i = 1; i < ${i}_MAX_COLORS; i++ ) {
                   p = clamp(( depth - steps[i - 1] ) / ( steps[i] - steps[i - 1] ), 0.0, 1.0);
                   color = mix(color, colors[i], p);
                 }
              #endif

               float lalpha = alpha * color.a * mask;
               calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
			   accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));
			   
               return color.rgb;
			}`,[dx.Nodes.vectorLinearWorldSpaceDepth,dx.Nodes.vectorLinearObjectSpaceDepth,dx.Nodes.vectorSphericalObjectSpaceDepth,dx.Nodes.vectorSphericalWorldSpaceDepth]);if(e.isShader("fragment")){e.define(`${i}_MAX_COLORS`,this.colors.value.length),this.smooth.value&&e.define(`${i}_SMOOTH`),this.isVector.value>.5&&e.define(`${i}_IS_VECTOR`),this.gradientType.value===0&&e.define(`${i}_LINEAR`),this.isWorldSpace.value>.5&&e.define(`${i}_WORLDSPACE`),e.require("worldPosition"),e.addFragmentVariable(this.calpha,"float");let n=e.include(r),s=[];return s.push(this.near.build(e,"f")),s.push(this.far.build(e,"f")),s.push(this.origin.build(e,"v3")),s.push(this.direction.build(e,"v3")),s.push(this.colors.build(e,"v4[]")),s.push(this.steps.build(e,"f[]")),s.push(this.isMask.build(e,"b")),s.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),s.push(this.alpha.build(e,"f")),s.push(this.calpha),e.format(n+"("+s.join(",")+")",this.getType(e),t)}else return console.warn("DepthNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},Cte=dx;Cte.Nodes=function(){let e=new wt(`float vectorLinearWorldSpaceDepth(vec3 direction, vec3 origin, float near, float far) {
               vec3 n = normalize(direction);
               float dist = (n.x*(vWPosition.x - origin.x) + n.y*(vWPosition.y - origin.y) + n.z*(vWPosition.z - origin.z));
               return ( dist - near ) / ( far - near );
            }`),t=new wt(`float vectorLinearObjectSpaceDepth(vec3 direction, vec3 origin, float near, float far) {
               vec3 n = normalize(direction);
               float dist = (n.x*(position.x - origin.x) + n.y*(position.y - origin.y) + n.z*(position.z - origin.z));
               return ( dist - near ) / ( far - near );
            }`),i=new wt(`float vectorSphericalWorldSpaceDepth(vec3 origin, float near, float far) {
               float dist = length(vWPosition - origin);
               return ( dist - near ) / ( far - near );
            }`),r=new wt(`float vectorSphericalObjectSpaceDepth(vec3 origin, float near, float far) {
               float dist = length(position - origin);
               return ( dist - near ) / ( far - near );
            }`);return{vectorLinearWorldSpaceDepth:e,vectorLinearObjectSpaceDepth:t,vectorSphericalWorldSpaceDepth:i,vectorSphericalObjectSpaceDepth:r}}();var cIe=class extends hr{constructor(e,t,i,r,n,s,a,o){super("v3"),this.nodeType="Fresnel",this.color=e,this.bias=t,this.scale=i,this.intensity=r,this.factor=n,this.isMask=o,this.alpha=s,this.mode=a,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.require("vWorldViewDir"),e.require("worldNormal"),e.isShader("fragment")){e.addFragmentVariable(this.calpha,"float");let i=new wt(`vec3 fresnel(vec3 color, float bias, float scale, float intensity, float factor, bool isMask, float mask, float alpha, int mode, out float calpha) {
					float fresnel = bias + scale * pow( abs( factor + dot( normalize( vWorldViewDir ), normalize( vWNormal ) ) ), intensity );

					float lalpha = clamp(fresnel, 0.0, 1.0) * alpha * mask;
					calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
					accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

					return color;
				}`),r=e.include(i),n=[];return n.push(this.color.build(e,"c")),n.push(this.bias.build(e,"f")),n.push(this.scale.build(e,"f")),n.push(this.intensity.build(e,"f")),n.push(this.factor.build(e,"f")),n.push(this.isMask.build(e,"b")),n.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),n.push(this.alpha.build(e,"f")),n.push(this.mode.build(e,"i")),n.push(this.calpha),e.format(r+"("+n.join(",")+")",this.getType(e),t)}else return console.warn("FresnelNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},Pte=class extends hr{constructor(e,t,i,r,n,s,a,o,l){super("v3"),this.nodeType="Gradient",this.gradientType=e,this.smooth=t,this.colors=i,this.steps=r,this.offset=n,this.morph=s,this.angle=a,this.isMask=l,this.alpha=o,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.isShader("fragment")){e.define("GRAD_MAX",10),e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let i=e.include(Pte.Nodes.gradient),r=[];return r.push(this.gradientType.build(e,"i")),r.push(this.smooth.build(e,"b")),r.push(this.colors.build(e,"v4[]")),r.push(this.steps.build(e,"f[]")),r.push(this.offset.build(e,"v2")),r.push(this.morph.build(e,"v2")),r.push(this.angle.build(e,"f")),r.push(this.isMask.build(e,"b")),r.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),r.push(this.alpha.build(e,"f")),r.push(this.calpha),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("GradientNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},Dte=Pte;Dte.Nodes=function(){return{gradient:new wt(`vec3 gradient(int gradientType, bool smoothed, vec4 colors[GRAD_MAX], float steps[GRAD_MAX], vec2 offset, vec2 morph, float angle, bool isMask, float mask, float alpha, out float calpha) {
				vec4 color = colors[0];
				vec2 m = morph / vUv.xy;
				vec2 rot = vec2( 0.5 + m.x, m.y );
				vec2 dt = vec2(
					cos( angle ) * rot.x - sin( angle ) * rot.y,
					sin( angle ) * rot.x + cos( angle ) * rot.y
				);
				vec2 pt = ( vUv - 0.5 + offset ) / 2.0 + dt / 2.0;
				float t = dot( pt, dt ) / dot( dt, dt );
				if ( gradientType == 1 ) {
					t = distance (
						( vUv + morph ) * 3.0,
						( vUv + offset ) + 1.0
					) + angle;
				} else if ( gradientType == 2 ) {
					float polar = atan(
						vUv.x + morph.x - 0.5 + offset.x,
						vUv.y + morph.y - 0.5 + offset.y
					) * -1.0;
					t = fract( ( angle / PI / -2.0 ) + 0.5 * ( polar / PI ) );
				}

				float p;
				if (smoothed) {
					for ( int i = 1; i < GRAD_MAX; i++ ) {
						p = clamp( ( t - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );
						color = mix(color, colors[i], smoothstep(0.0, 1.0, p));
					}

				} else {
					for ( int i = 1; i < GRAD_MAX; i++ ) {
						p = clamp( ( t - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );
						color = mix(color, colors[i], p);
					}
				}

				float lalpha = alpha * color.a * mask;
				calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));
				
				return color.xyz;
			}`)}}();var Rte=class extends hr{constructor(e,t,i,r,n){super("v3"),this.nodeType="Matcap",this.texture=e,this.isMask=r,this.alpha=t,this.mode=i,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`,this.rotation=n}generate(e,t){if(e.isShader("fragment")){e.addFragmentVariable(this.calpha,"float");let i=e.include(Rte.Nodes.matcap);e.require("normal"),e.requires.normal=!0;let r=[];return r.push(this.texture.generate(e,"t")),r.push("normal"),r.push(this.isMask.build(e,"b")),r.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),r.push(this.alpha.build(e,"f")),r.push(this.mode.build(e,"i")),r.push(this.calpha),r.push(this.rotation.build(e,"f")),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("MatcapNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},Ite=Rte;Ite.Nodes=function(){return{matcap:new wt(`vec3 matcap(sampler2D matcapTex, vec3 normal, bool isMask, float mask, float alpha, int mode, out float calpha, float rotation) {
					vec3 viewDir = normalize( vViewPosition );
					vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
					vec3 y = cross( viewDir, x );
					vec2 uv = vec2( dot( x, normal ), dot( y, normal ) );
					uv = mat2( cos(rotation), sin(rotation), -sin(rotation), cos(rotation) ) * uv;
					uv = uv * 0.495 + 0.5;
					vec4 matcapColor = texture2D( matcapTex, uv );

					float lalpha = alpha * mask;
					calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
					accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));
					
					return matcapColor.rgb;
            	}`)}}();var Ja=function(){let e=new wt(`vec3 random3(vec3 c) {
			float j = 4096.0*sin(dot(c,vec3(17.0, 59.4, 15.0)));
			vec3 r;
			r.z = fract(512.0*j);
			j *= .125;
			r.x = fract(512.0*j);
			j *= .125;
			r.y = fract(512.0*j);
			return r-0.5;
		}`),t=new wt(`float simplexFast(vec3 p) {
			 vec3 s = floor(p + dot(p, vec3(F3)));
			 mediump vec3 x = p - s + dot(s, vec3(G3));
			 mediump vec3 hs = s;
			 
			 mediump vec3 e = step(vec3(0.0), x - x.yzx);
			 mediump vec3 i1 = e*(1.0 - e.zxy);
			 mediump vec3 i2 = 1.0 - e.zxy*(1.0 - e);
				
			 mediump vec3 x1 = x - i1 + G3;
			 mediump vec3 x2 = x - i2 + 2.0*G3;
			 mediump vec3 x3 = x - 1.0 + 3.0*G3;
			 
			 mediump vec4 w, d;
			 
			 w.x = dot(x, x);
			 w.y = dot(x1, x1);
			 w.z = dot(x2, x2);
			 w.w = dot(x3, x3);
			 
			 w = max(0.6 - w, 0.0);
			 
			 d.x = dot(random3(hs), x);
			 d.y = dot(random3(hs + i1), x1);
			 d.z = dot(random3(hs + i2), x2);
			 d.w = dot(random3(hs + 1.0), x3);
			 
			 w *= w;
			 w *= w;
			 d *= w;
			 
			 return dot(d, vec4(52.0));
		}`,[e]);t.keywords.F3=new tr("float F3 0.3333333"),t.keywords.G3=new tr("float G3 0.1666667");let i=new wt(`float simplexPrecise(vec3 p) {
			 vec3 s = floor(p + dot(p, vec3(F3)));
			 vec3 x = p - s + dot(s, vec3(G3));
			 
			 vec3 e = step(vec3(0.0), x - x.yzx);
			 vec3 i1 = e*(1.0 - e.zxy);
			 vec3 i2 = 1.0 - e.zxy*(1.0 - e);
				
			 vec3 x1 = x - i1 + G3;
			 vec3 x2 = x - i2 + 2.0*G3;
			 vec3 x3 = x - 1.0 + 3.0*G3;
			 
			 vec4 w, d;
			 
			 w.x = dot(x, x);
			 w.y = dot(x1, x1);
			 w.z = dot(x2, x2);
			 w.w = dot(x3, x3);
			 
			 w = max(0.6 - w, 0.0);
			 
			 d.x = dot(random3(s), x);
			 d.y = dot(random3(s + i1), x1);
			 d.z = dot(random3(s + i2), x2);
			 d.w = dot(random3(s + 1.0), x3);
			 
			 w *= w;
			 w *= w;
			 d *= w;
			 
			 return dot(d, vec4(52.0));
		}`,[e]);i.keywords.F3=new tr("float F3 0.3333333"),i.keywords.G3=new tr("float G3 0.1666667");let r=new wt(`float simplexFractal(vec3 m) {
			mat3 rot1 = mat3(-0.37, 0.36, 0.85,-0.14,-0.93, 0.34,0.92, 0.01,0.4);
			mat3 rot2 = mat3(-0.55,-0.39, 0.74, 0.33,-0.91,-0.24,0.77, 0.12,0.63);
			mat3 rot3 = mat3(-0.71, 0.52,-0.47,-0.08,-0.72,-0.68,-0.7,-0.45,0.56);
			return 0.5333333 * simplexFast(m * rot1)
				 + 0.2666667 * simplexFast(2.0 * m * rot2)
				 + 0.1333333 * simplexFast(4.0 * m * rot3)
				 + 0.0666667 * simplexFast(8.0 * m);
		}`,[t]),n=new wt("vec4 permute(vec4 x){return mod(((x*34.0)+1.0)*x, 289.0);}"),s=new wt("vec4 taylorInvSqrt(vec4 r){return 1.79284291400159 - 0.85373472095314 * r;}"),a=new wt(`float simplexAshima(vec3 v) {
		  const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;
		  const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);
		  vec3 i  = floor(v + dot(v, C.yyy) );
		  vec3 x0 =   v - i + dot(i, C.xxx) ;
		  vec3 g = step(x0.yzx, x0.xyz);
		  vec3 l = 1.0 - g;
		  vec3 i1 = min( g.xyz, l.zxy );
		  vec3 i2 = max( g.xyz, l.zxy );
		  vec3 x1 = x0 - i1 + 1.0 * C.xxx;
		  vec3 x2 = x0 - i2 + 2.0 * C.xxx;
		  vec3 x3 = x0 - 1. + 3.0 * C.xxx;
		  i = mod(i, 289.0 ); 
		  vec4 p = permute( permute( permute( 
					 i.z + vec4(0.0, i1.z, i2.z, 1.0 ))
				   + i.y + vec4(0.0, i1.y, i2.y, 1.0 )) 
				   + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));
		  float n_ = 1.0/7.0; // N=7
		  vec3  ns = n_ * D.wyz - D.xzx;
		  vec4 j = p - 49.0 * floor(p * ns.z *ns.z);  //  mod(p,N*N)
		  vec4 x_ = floor(j * ns.z);
		  vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)
		  vec4 x = x_ *ns.x + ns.yyyy;
		  vec4 y = y_ *ns.x + ns.yyyy;
		  vec4 h = 1.0 - abs(x) - abs(y);
		  vec4 b0 = vec4( x.xy, y.xy );
		  vec4 b1 = vec4( x.zw, y.zw );
		  vec4 s0 = floor(b0)*2.0 + 1.0;
		  vec4 s1 = floor(b1)*2.0 + 1.0;
		  vec4 sh = -step(h, vec4(0.0));
		  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;
		  vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;
		  vec3 p0 = vec3(a0.xy,h.x);
		  vec3 p1 = vec3(a0.zw,h.y);
		  vec3 p2 = vec3(a1.xy,h.z);
		  vec3 p3 = vec3(a1.zw,h.w);
		  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));
		  p0 *= norm.x;
		  p1 *= norm.y;
		  p2 *= norm.z;
		  p3 *= norm.w;
		  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);
		  m = m * m;
		  return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1), 
										dot(p2,x2), dot(p3,x3) ) );
		}`,[n,s]),o=new wt("vec4 mod289(vec4 x){return x - floor(x * (1.0 / 289.0)) * 289.0;}"),l=new wt("vec4 perm(vec4 x){return mod289(((x * 34.0) + 1.0) * x);}",[o]),c=new wt(`float noise(vec3 p){
			vec3 a = floor(p);
			vec3 d = p - a;
			d = d * d * (3.0 - 2.0 * d);
			vec4 b = a.xxyy + vec4(0.0, 1.0, 0.0, 1.0);
			vec4 k1 = perm(b.xyxy);
			vec4 k2 = perm(k1.xyxy + b.zzww);
			vec4 c = k2 + a.zzzz;
			vec4 k3 = perm(c);
			vec4 k4 = perm(c + 1.0);
			vec4 o1 = fract(k3 * (1.0 / 41.0));
			vec4 o2 = fract(k4 * (1.0 / 41.0));
			vec4 o3 = o2 * d.z + o1 * (1.0 - d.z);
			vec2 o4 = o3.yw * d.x + o3.xz * (1.0 - d.x);
			return o4.y * d.y + o4.x * (1.0 - d.y);
		}`,[l]),u=new wt(`float fbm(vec3 x) {
			float v = 0.0;
			float a = 0.5;
			vec3 shift = vec3(100);
			for (int i = 0; i < NUM_OCTAVES; ++i) {
				v += a * noise(x);
				x = x * 2.0 + shift;
				a *= 0.5;
			}
			return v;
		}`,[c]);u.keywords.NUM_OCTAVES=new tr("int NUM_OCTAVES 5");let h=new wt("vec3 fade(vec3 t) {return t*t*t*(t*(t*6.0-15.0)+10.0);}"),d=new wt(`float perlin(vec3 P){
		  vec3 Pi0 = floor(P);
		  vec3 Pi1 = Pi0 + vec3(1.0);
		  Pi0 = mod(Pi0, 289.0);
		  Pi1 = mod(Pi1, 289.0);
		  vec3 Pf0 = fract(P);
		  vec3 Pf1 = Pf0 - vec3(1.0);
		  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);
		  vec4 iy = vec4(Pi0.yy, Pi1.yy);
		  vec4 iz0 = Pi0.zzzz;
		  vec4 iz1 = Pi1.zzzz;
		  vec4 ixy = permute(permute(ix) + iy);
		  vec4 ixy0 = permute(ixy + iz0);
		  vec4 ixy1 = permute(ixy + iz1);
		  vec4 gx0 = ixy0 / 7.0;
		  vec4 gy0 = fract(floor(gx0) / 7.0) - 0.5;
		  gx0 = fract(gx0);
		  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);
		  vec4 sz0 = step(gz0, vec4(0.0));
		  gx0 -= sz0 * (step(0.0, gx0) - 0.5);
		  gy0 -= sz0 * (step(0.0, gy0) - 0.5);
		  vec4 gx1 = ixy1 / 7.0;
		  vec4 gy1 = fract(floor(gx1) / 7.0) - 0.5;
		  gx1 = fract(gx1);
		  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);
		  vec4 sz1 = step(gz1, vec4(0.0));
		  gx1 -= sz1 * (step(0.0, gx1) - 0.5);
		  gy1 -= sz1 * (step(0.0, gy1) - 0.5);
		  vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);
		  vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);
		  vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);
		  vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);
		  vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);
		  vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);
		  vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);
		  vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);
		  vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));
		  g000 *= norm0.x;
		  g010 *= norm0.y;
		  g100 *= norm0.z;
		  g110 *= norm0.w;
		  vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));
		  g001 *= norm1.x;
		  g011 *= norm1.y;
		  g101 *= norm1.z;
		  g111 *= norm1.w;
		  float n000 = dot(g000, Pf0);
		  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));
		  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));
		  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));
		  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));
		  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));
		  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));
		  float n111 = dot(g111, Pf1);
		  vec3 fade_xyz = fade(Pf0);
		  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);
		  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);
		  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x); 
		  return 2.2 * n_xyz;
		}`,[n,s,h]),f=new wt(`float hashwithoutsine13(vec3 p3)
		{
			p3  = fract(p3 * .1031);
			p3 += dot(p3, p3.yzx + 33.33);
			return fract((p3.x + p3.y) * p3.z);
		}`),p=new wt(`vec3 hashwithoutsine33(vec3 p3)
		{
			p3 = fract(p3 * vec3(.1031, .1030, .0973));
			p3 += dot(p3, p3.yxz+33.33);
			return fract((p3.xxy + p3.yxx)*p3.zyx);
		}`),v=new wt(`float metric(in vec3 p)
		{
			// L2 
			return length(p);

			// Chebyshev 
			// vec3 a = abs(p);
			// return max(a.x, max(a.y, a.z));
		}`),m=new wt(`float smin( float a, float b, float k )
		{
			float h = smoothstep(0.0, 1.0, 0.5 + 0.5 * (b - a) / k);
			float correction = k * h * (1.0 - h);
			return mix(b, a, h) - correction;
		}`),g=new wt(`float smax( float a, float b, float k )
		{
			float h = smoothstep(1.0, 0.0, 0.5 + 0.5 * (a - b) / k);
			float correction = k * h * (1.0 - h);
			return mix(a, b, h) + correction;
		}`),y=new wt(`float remap(float value, float input_min, float input_max, float output_min, float output_max) {
			// Compute width of each interval
			float input_width = input_max - input_min;
			float output_width = output_max - output_min;
		
			// Convert input range into a 0-1 range 
			float scaled = (value - input_min) / input_width;
		
			// Convert the 0-1 range into a value in output range
			return output_min + (scaled * output_width);
		}`),x=new wt(`float voronoi(in vec3 x, in int style, in float smoothness, in float seed, in int quality) 
		{
			// Integer and fractional parts of this point's coordinates
			ivec3 p = ivec3(floor(x));
			vec3 f = fract(x);

			// Different variables that we will use to construct noise:
			//
			// f1: distance to the closest feature point
			// f2: distance to the second closest feature point
			// e: distance to the closest edge (cell boundary)
			//
			// We also compute "smooth" versions of all of the above quantites, essentially
			// replacing "hard" minimums with "smooth" minimums (described by IQ)
			float f1_smooth = 8.0;
			float f1 = 8.0;
			float f2_smooth = 8.0;
			float f2 = 8.0;
			float e_smooth = 8.0;
			float e = 8.0;

			// Variables stored from closest cell
			ivec3 mb;
			vec3 mr; 

			int steps = quality;
			
			for (int x = -steps; x <= steps; x++) 
			for (int y = -steps; y <= steps; y++)
			for (int z = -steps; z <= steps; z++)
			{
				ivec3 b = ivec3(x, y, z);
				vec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;
				float d = length(r);
				
				f1_smooth = smin(d, f1_smooth, smoothness);

				// Store un-smoothed distances too 
				if (d < f1) 
				{
					f2 = f1;
					f1 = d;

					mb = ivec3(x, y, z);
					mr = r;
				} 
				else if (d < f2) 
				{
					f2 = d;
				}
			}	
			
			// Second pass for edge distance  
			// skip for styles don't need
			if (style != 0 &&  style != 5 && style != 7)
			for (int x = -steps; x <= steps; x++) 
			for (int y = -steps; y <= steps; y++)
			for (int z = -steps; z <= steps; z++)
			{
				// Start search at the cell that contains the closest point to "x" (found in 1st pass)
				ivec3 b = mb + ivec3(x, y, z);
				vec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;
				float d1 = dot(0.5 * (mr + r), (r - mr)); 				// IQ normalizes "r - mr" but that breaks things for the smooth version?
				float d2 = dot(0.5 * (mr + r), normalize(r - mr));

				e_smooth = smin(d1, e_smooth, smoothness);

				e = min(e, d2);

				// Also compute a smooth version of F2 in this pass
				{
					ivec3 b = ivec3(x, y, z);
					if (b != mb) 
					{
						vec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;
						float d = length(r);

						f2_smooth = smin(d, f2_smooth, smoothness);
					}
				}
			}

			// Different visualization modes 
			if (style == 0) 
			{
				return f1_smooth;
			}
			if (style == 1) 
			{
				return f2_smooth;
			}
			if (style == 2) 
			{
				return f2_smooth - f1_smooth;
				
				// "Pebbles" also cool
				//return step(0.2, f2_smooth - f1_smooth);
			}
			if (style == 3) 
			{
				// This one is really good for rock / stone effects
				float a = f1; 
				float b = f2;
				float k = 3.0;
				float h = max(k - abs(a - b), 0.0) / k;
				float final = min(a, b) - h * h * k * (1.0 / 4.0);
				return final;
			}
			if (style == 4) 
			{
				// Some random adjustments to make this style stand out more 
				return exp(5.0 * e_smooth);
			}
			if (style == 5) 
			{
				return pow(f1_smooth, 3.0);
			}
			if (style == 6) 
			{				
				const float eps = 0.0125;

				// Thicker lines as the user increases the smoothness slider
				float thickness = smoothness * 0.25 + eps;

				// Blurrier lines as the user increases the smoothness slider
				float blur = pow(smoothness, 3.0) * 0.25 + eps;

				return smoothstep(
					thickness - thickness * blur, 
					thickness + thickness * blur, 
					e
				);
			}
			if (style == 7) 
			{
				return hashwithoutsine13(vec3(p + mb) + seed);
			}
		}
	`,[f,p,v,m,g,y]);return{simplexFast:t,simplexPrecise:i,simplexFractal:r,simplexAshima:a,fbm:u,perlin:d,voronoi:x}}(),Lte=class extends hr{constructor(e,t,i,r,n,s,a,o,l,c,u,h,d,f,p,v,m,g,y){super("v3"),this.nodeType="Noise",this.scale=e,this.size=t,this.move=i,this.fA=r,this.fB=n,this.distortion=s,this.colorA=a,this.colorB=o,this.colorC=l,this.colorD=c,this.noiseType=h,this.voronoiStyle=f,this.highCut=p,this.lowCut=v,this.smoothness=m,this.seed=g,this.quality=y,this.isMask=d,this.alpha=u,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t,i,r,n){e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let s=["simplexFast","simplexFractal","simplexAshima","fbm","perlin","voronoi"][this.noiseType.value],a=s=="voronoi"?`
		float v = ${s}(st + move, voronoiStyle, smoothness, seed, quality);

		// Apply clipping to colors
		v = remap(v, lowCut, highCut, 0.0, 1.0);
		v = smax(v, 0.0, smoothness * 0.25);
		v = smin(v, 1.0, smoothness * 0.25);

		// Note that the voronoi mode only uses colors "A" and "C" from the UI 
		vec4 color = mix(colorA, colorC, v); 
		`:`
		vec3 q = vec3(${s}(st),
					   ${s}(st + vec3(1.0)),
					   ${s}(st + vec3(1.0)));
		vec3 r = vec3(${s}(st + vec3(distortion, 1.0) * q + vec3(fA, 1.0) + move),
					  ${s}(st + vec3(distortion, 1.0) * q + vec3(fB, 1.0) + move), 
					  ${s}(st * q));
		float f = ${s}(st + r);
		vec4 color;
		color = mix(colorA, colorB, clamp((f * f) * 4.0, 0.0, 1.0));
		color = mix(color, colorC, clamp(length(q), 0.0, 1.0));
		color = mix(color, colorD, clamp(length(r.x), 0.0, 1.0));
		`,o=new wt(`vec3 ${s}customNoise(float scale, vec3 size, float move, vec2 fA, vec2 fB, vec2 distortion, vec4 colorA, vec4 colorB, vec4 colorC, vec4 colorD, int voronoiStyle, float highCut, float lowCut, float smoothness, float seed, int quality, bool isMask, float mask, float alpha, out float calpha) 
			{
                // Prevent scale of zero 
				scale = max(abs(scale), 0.001);

				vec3 st = position / size;
				st /= scale;

				${a}

				float lalpha = alpha * color.a * mask;
				calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return clamp(color, 0.0, 1.0).rgb;
			}`,[Ja.simplexFast,Ja.simplexFractal,Ja.simplexAshima,Ja.fbm,Ja.perlin,Ja.voronoi]),l=e.include(o),c=[];return c.push(this.scale.build(e,"f")),c.push(this.size.build(e,"v3")),c.push(this.move.build(e,"f")),c.push(this.fA.build(e,"v2")),c.push(this.fB.build(e,"v2")),c.push(this.distortion.build(e,"v2")),c.push(this.colorA.build(e,"v4")),c.push(this.colorB.build(e,"v4")),c.push(this.colorC.build(e,"v4")),c.push(this.colorD.build(e,"v4")),c.push(this.voronoiStyle.build(e,"i")),c.push(this.highCut.build(e,"f")),c.push(this.lowCut.build(e,"f")),c.push(this.smoothness.build(e,"f")),c.push(this.seed.build(e,"f")),c.push(this.quality.build(e,"i")),c.push(this.isMask.build(e,"b")),c.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),c.push(this.alpha.build(e,"f")),c.push(this.calpha),e.format(l+"("+c.join(",")+")",this.getType(e),t)}};Lte.numOctaves=5;var Ote=class extends hr{constructor(e,t,i,r,n,s,a,o,l,c,u,h,d,f,p,v){super("v3"),this.nodeType="Outline",this.firstTime=!0,this.outlineColor=e,this.contourColor=t,this.outlineWidth=i,this.contourWidth=r,this.contourThreshold=n,this.outlineThreshold=s,this.contourFrequency=a,this.outlineSmoothing=o,this.contourDirection=l,this.positionalLines=c,this.compensation=u,this.resolution=h,this.normalMap=d,this.depthMap=f,this.pixelRatio=p,this.alpha=v,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){let i=`g${this.uuid.toString().replace(/-/g,"")}`;if(e.require("vWorldViewDir"),e.require("worldNormal"),e.extensions.derivatives=!0,this.compensation.value&&e.define("OUTLINE_COMPENSATION",`${i}_offset`),this.firstTime){let r=this.outlineWidth.build(e,"f"),n=this.resolution.build(e,"v2"),s=this.compensation.build(e,"b"),a=this.pixelRatio.build(e,"f");e.addVertexParsVariable("randomColor","attribute vec3"),e.addVertexParsVariable("extrudeNormal","attribute vec3"),e.addVertexParsVariable(r,"uniform float"),e.addVertexParsVariable(n,"uniform vec2"),e.addVertexParsVariable(s,"uniform bool"),e.addVertexParsVariable(a,"uniform float"),e.addVertexParsVariable("vID","flat out float"),e.addFragmentParsVariable("vID","flat in float"),e.addVertexFinalCode(`
                vID = randomColor.r;
                vec2 ${i}_offset = vec2(0.0);
                if (${s}) {
                    vec4 ${i}_clipPosition = projectionMatrix * (modelViewMatrix * vec4(transformed, 1.0));
                    // NOTE: For certain shapes, like spheres, we get incorrect extrusion when the
                    // normals face the camera directly. So we hackily fix this by offsetting the normal
                    // by a tiny amount.
                    vec3 ${i}_clipNormal = mat3(projectionMatrix) * (mat3(modelViewMatrix) * extrudeNormal) + 0.0000001;
                    ${i}_offset = normalize(${i}_clipNormal.xy) / ${n} * (${r} / 2.0) * ${i}_clipPosition.w * 2.0 * ${a};
                    ${i}_clipPosition.xy += ${i}_offset;
                    // TODO(MAX): To handle multiple outline layers, we only want to extrude
                    // if this offset is the biggest of all the potential offsets
                    gl_Position = ${i}_clipPosition;
                }
            `)}if(e.isShader("fragment")){e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let r=e.include(Ote.Nodes.outline),n=[];return n.push(this.outlineColor.build(e,"c")),n.push(this.contourColor.build(e,"c")),n.push(this.outlineWidth.build(e,"f")),n.push(this.contourWidth.build(e,"f")),n.push(this.contourThreshold.build(e,"f")),n.push(this.outlineThreshold.build(e,"f")),n.push(this.contourFrequency.build(e,"f")),n.push(this.outlineSmoothing.build(e,"f")),n.push(this.contourDirection.build(e,"v3")),n.push(this.positionalLines.build(e,"b")),n.push(this.resolution.build(e,"v2")),n.push(this.normalMap.getTexture(e,"t")),n.push(this.depthMap.getTexture(e,"t")),n.push(this.pixelRatio.build(e,"f")),n.push(this.compensation.build(e,"b")),n.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),n.push(this.alpha.build(e,"f")),n.push(this.calpha),this.firstTime=!this.firstTime,e.format(r+"("+n.join(",")+")",this.getType(e),t)}else return console.warn("OutlineNode is not compatible with "+e.shader+" shader."),""}},zte=Ote;zte.Nodes=function(){let e=new wt(`
float sobelSample(sampler2D t, sampler2D d, vec2 uv, vec2 resolution, float outlineWidth, float pixelRatio)
{
    vec2 halton = haltonSequence[frameIndex];
    float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);
    float temporalAngle  = temporalOffset * PI2;

    vec2 texelSize = (vec2(1.0) / resolution);
    vec2 offsetSize = texelSize * outlineWidth * pixelRatio;

    vec2 uvSamples[9];
    vec4 normalSamples[9];

	uvSamples[0] = uv + vec2( -offsetSize.x, -offsetSize.y) + (vogelDiskSample(0, 9, temporalAngle) * texelSize);
	uvSamples[1] = uv + vec2(0.0, -offsetSize.y) + (vogelDiskSample(1, 9, temporalAngle) * texelSize);
	uvSamples[2] = uv + vec2(  offsetSize.x, -offsetSize.y) + (vogelDiskSample(2, 9, temporalAngle) * texelSize);
	uvSamples[3] = uv + vec2( -offsetSize.x, 0.0) + (vogelDiskSample(3, 9, temporalAngle) * texelSize);
	uvSamples[4] = uv;
	uvSamples[5] = uv + vec2(  offsetSize.x, 0.0) + (vogelDiskSample(5, 9, temporalAngle) * texelSize);
	uvSamples[6] = uv + vec2( -offsetSize.x, offsetSize.y) + (vogelDiskSample(6, 9, temporalAngle) * texelSize);
	uvSamples[7] = uv + vec2(0.0, offsetSize.y) + (vogelDiskSample(7, 9, temporalAngle) * texelSize);
	uvSamples[8] = uv + vec2(  offsetSize.x, offsetSize.y) + (vogelDiskSample(8, 9, temporalAngle) * texelSize);


    normalSamples[0] = texture2D(t, uvSamples[0]);
    normalSamples[1] = texture2D(t, uvSamples[1]);
    normalSamples[2] = texture2D(t, uvSamples[2]);
    normalSamples[3] = texture2D(t, uvSamples[3]);
    normalSamples[4] = texture2D(t, uvSamples[4]);
    normalSamples[5] = texture2D(t, uvSamples[5]);
    normalSamples[6] = texture2D(t, uvSamples[6]);
    normalSamples[7] = texture2D(t, uvSamples[7]);
    normalSamples[8] = texture2D(t, uvSamples[8]);

    float depthBias = 0.0001;
    // TODO(MAX): Can we somehow reduce the number of conditionals here with MATH?!
    if (normalSamples[0].a != vID && normalSamples[0].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[0]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[1].a != vID && normalSamples[1].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[1]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[2].a != vID && normalSamples[2].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[2]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[3].a != vID && normalSamples[3].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[3]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }


    if (normalSamples[4].a != vID && normalSamples[4].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[4]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[5].a != vID && normalSamples[5].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[5]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[6].a != vID && normalSamples[6].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[6]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[7].a != vID && normalSamples[7].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[7]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[8].a != vID && normalSamples[8].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[8]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    vec3 sobel_edge_h = normalSamples[2].rgb + (2.0*normalSamples[5].rgb) + normalSamples[8].rgb - (normalSamples[0].rgb + (2.0*normalSamples[3].rgb) + normalSamples[6].rgb);
  	vec3 sobel_edge_v = normalSamples[0].rgb + (2.0*normalSamples[1].rgb) + normalSamples[2].rgb - (normalSamples[6].rgb + (2.0*normalSamples[7].rgb) + normalSamples[8].rgb);

    float edgeNormal = sqrt(dot(sobel_edge_h, sobel_edge_h) + dot(sobel_edge_v, sobel_edge_v));
    return edgeNormal;
}
`);return{outline:new wt(`vec3 outline(vec3 outlineColor, vec3 contourColor, float outlineWidth, float contourWidth, float outlineThreshold, float contourThreshold, float outlineSmoothing, float contourFrequency, vec3 contourDirection, bool positionalLines, vec2 resolution, sampler2D normalMap, sampler2D depthMap, float pixelRatio, bool compensation, float mask, float alpha, out float calpha) {
                vec3 result = outlineColor;
                float resultAlpha = 0.0;

                vec3 N = normalize(vWNormal);
                vec2 nuv = (gl_FragCoord.xy / resolution);
                float sobelSample = compensation ? sobelSample(normalMap, depthMap, nuv, resolution, outlineWidth / 2., pixelRatio) : sobelSample(normalMap, depthMap, nuv, resolution, outlineWidth, pixelRatio);
                resultAlpha = smoothstep(outlineThreshold - outlineSmoothing, outlineThreshold + outlineSmoothing, sobelSample);

                //resultAlpha = 1.0;
                //result = vec3(sobelSample);

                float t = 1.0 - contourThreshold;
                if(positionalLines) {
                    vec3 NDir = position * contourDirection;
                    float NT = NDir.x + NDir.y + NDir.z;
                    float f  = fract(NT * contourFrequency * 0.01);
                    float df = fwidth(NT * contourFrequency);

                    float g = smoothstep(df * (contourWidth * 0.01), df * (contourWidth * 0.01 * 2.0), f);
                    if (g < 1.0 && resultAlpha == 0.0) {
                        result = contourColor;
                        resultAlpha = 1.0;
                    }
                 }
                 else {
                    vec3 NDir = N * contourDirection;
                    float NT = NDir.x + NDir.y + NDir.z;
                    float df = fwidth(NT * contourThreshold);
                    float f = sin(NT * 1.0 * contourFrequency);
                    float g = smoothstep(0.0, df * contourWidth, 1.0 - f);

                    if (df > (t * 0.5) && g < 1.0 && resultAlpha == 0.0) {
                        result = contourColor;
                        resultAlpha = 1.0 - g;
                    }
                 }

                 float lalpha = alpha * resultAlpha * mask;
                 calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
                 accumAlpha += ( 1.0 - accumAlpha ) * lalpha;
				 
                 return result;
             }`,[e])}}();var Hu=class extends hr{constructor(e,t,i,r,n,s,a,o,l,c,u,h,d,f,p,v,m,g){super("v3"),this.nodeType="Pattern",this.style=e,this.projection=t,this.axis=i,this.blending=r,this.offset=n,this.colorA=s,this.colorB=a,this.frequency=o,this.size=l,this.variation=c,this.smoothness=u,this.zigzag=h,this.rotation=d,this.vertical=f,this.horizontal=p,this.sides=v,this.isMask=g,this.alpha=m,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.isShader("fragment")){e.require("position"),e.require("uv"),e.requires.uv=[!0],e.require("normal"),e.requires.normal=!0,e.addFragmentVariable(this.calpha,"float");let i;switch(this.style.value){case 0:i="circle";break;case 1:i="ring";break;case 2:i="polygon";break;case 3:i="xcross";break;case 4:i="diamond";break;case 5:i="checkerboard";break;case 6:i="line";break;case 7:i="wave";break;default:i="circle";break}let r=`g${this.uuid.toString().replace(/-/g,"")}`,n=new wt(`float hashwithoutsine12(vec2 p)
				{
					vec3 p3 = fract(vec3(p.xyx) * .1031);
					p3 += dot(p3, p3.yzx + 33.33);
					return fract((p3.x + p3.y) * p3.z);
				}`),s=new wt(`vec2 rotate_uv(in vec2 uv, float a, bool repeat) 
				{
					const float mid = 0.5;
					float radians = a * (PI / 180.0);
					vec2 rotated = vec2(
						cos(radians) * (uv.x - mid) + sin(radians) * (uv.y - mid) + mid,
						cos(radians) * (uv.y - mid) - sin(radians) * (uv.x - mid) + mid
					);
					return repeat ? fract(rotated): rotated;
				}`),a="";if(this.projection.value===4){let u=this.style.value===2?`${i}(uv0, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${i}(uv0, frequency, size, variation, smoothness_remapped, zigzag, rotation)`,h=this.style.value===2?`${i}(uv1, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${i}(uv1, frequency, size, variation, smoothness_remapped, zigzag, rotation)`,d=this.style.value===2?`${i}(uv2, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${i}(uv2, frequency, size, variation, smoothness_remapped, zigzag, rotation)`;a=`
				vec3 p = position;
				float factor = 0.0125;
				vec2 uv0 = fract(p.xy * factor);
				vec2 uv1 = fract(p.zy * factor);
				vec2 uv2 = fract(p.xz * factor);
				
				uv0 = rotate_uv(uv0 + offset, rotation, true);
				uv1 = rotate_uv(uv1 + offset, rotation, true);
				uv2 = rotate_uv(uv2 + offset, rotation, true);
	
				float d0 = ${u};
				float d1 = ${h};
				float d2 = ${d};
				
				// Range from 3 to 128 seems to be good
				float exponent = (1.0 - blending) * 125.0 + 3.0;

				vec3 n = vObjectNormal;
				vec3 weights = abs(normalize(n));
				weights = pow(weights, vec3(exponent));
				weights /= dot(weights, vec3(1.0));
				d0 *= weights.z;
				d1 *= weights.x;
				d2 *= weights.y;
				float draw = d0 + d1 + d2;
	
				vec2 custom_uv = uv0 * weights.z + uv1 * weights.x + uv2 * weights.y;
				`}else{let u=this.style.value===2?`${i}(custom_uv, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${i}(custom_uv, frequency, size, variation, smoothness_remapped, zigzag, rotation)`,h="";this.axis.value===0?h=`float radius = length(p);
					float theta = atan(p.y, p.z);
					float phi = acos(p.x / radius);`:this.axis.value===1?h=`float radius = length(p);
					float theta = atan(p.x, p.z);
					float phi = acos(p.y / radius);`:(this.axis.value,h=`float radius = length(p);
					float theta = atan(p.y, p.x);
					float phi = acos(p.z / radius);`);let d="";switch(this.projection.value){case 0:d="custom_uv = vUv.st;";break;case 1:break;case 2:d=`
							vec3 p = position;
							${h}
							custom_uv = vec2(theta, phi);
							custom_uv /= PI;
							`;break}a=`
				vec2 custom_uv;
				${d}
	
				custom_uv += offset;
				custom_uv = fract(custom_uv);
				custom_uv = rotate_uv(custom_uv, rotation, true);
	
				float draw = ${u};
				`}let o=new wt(`vec3 ${r}_pattern(vec3 normal, float blending, int style, vec2 offset, vec4 colorA, vec4 colorB, vec2 frequency, float size, float variation, float smoothness, float zigzag, float rotation, vec2 vertical, vec2 horizontal, int sides, bool isMask, float mask, float alpha, out float calpha) {
					const float TWO_PI = PI * 2.0;
					float smoothness_remapped = pow(smoothness, 5.0);	

					${a}

					// Construct final output color
					vec4 color = mix(colorA, colorB, draw);
					color.a = clamp(color.a, 0.0, 1.0);

					// Apply cuts
					color.a *= 
						step(vertical.x, custom_uv.y) * 
						step(custom_uv.y, vertical.y);
					color.a *= 
						step(horizontal.x, abs(custom_uv.x)) * 
						step(abs(custom_uv.x), horizontal.y);

					// Accumulate alpha 
					float lalpha = alpha * clamp(color.a, 0.0, 1.0) * mask;
					calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
					accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

					return clamp(color, 0.0, 1.0).rgb;
				}`,[s,n,Hu.DrawFunctions.circle,Hu.DrawFunctions.ring,Hu.DrawFunctions.polygon,Hu.DrawFunctions.cross,Hu.DrawFunctions.diamond,Hu.DrawFunctions.checkerboard,Hu.DrawFunctions.line,Hu.DrawFunctions.wave]),l=e.include(o),c=[];return c.push("normal"),c.push(this.blending.build(e,"f")),c.push(this.style.build(e,"i")),c.push(this.offset.build(e,"v2")),c.push(this.colorA.build(e,"v4")),c.push(this.colorB.build(e,"v4")),c.push(this.frequency.build(e,"v2")),c.push(this.size.build(e,"f")),c.push(this.variation.build(e,"f")),c.push(this.smoothness.build(e,"f")),c.push(this.zigzag.build(e,"f")),c.push(this.rotation.build(e,"f")),c.push(this.vertical.build(e,"v2")),c.push(this.horizontal.build(e,"v2")),c.push(this.sides.build(e,"i")),c.push(this.isMask.build(e,"b")),c.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),c.push(this.alpha.build(e,"f")),c.push(this.calpha),e.format(l+"("+c.join(",")+")",this.getType(e),t)}else return console.warn("PatterNode is not compatible with "+e.shader+" shader."),e.format("vec3(0.0)",this.getType(e),t)}},Bte=Hu;Bte.DrawFunctions=function(){let e=new wt(`float hashwithoutsine12(vec2 p) {
				vec3 p3 = fract(vec3(p.xyx) * 0.1031);
				p3 += dot(p3, p3.yzx + 33.33);
				return fract((p3.x + p3.y) * p3.z);
			}`),t=new wt(`vec2 tile_and_center(in vec2 uv, in vec2 frequency, in float variation, in float zigzag, in float rotation) {
                // Create tiles in UV-space
                uv *= frequency;

                // Integer coords
                vec2 i = floor(uv);

                // Offset every other row based on zigzag param, then compute fractional coords
                float row_offset = mod(i.y, 2.0);
                uv.x += row_offset * zigzag;
                vec2 f = fract(uv);

				// Rotate the tile itself:
				// const float mid = 0.5;
				// f = vec2(
				// 	cos(rotation) * (f.x - mid) + sin(rotation) * (f.y - mid) + mid,
				// 	cos(rotation) * (f.y - mid) - sin(rotation) * (f.x - mid) + mid
				// );
				// f = fract(f);

                f = f * 2.0 - 1.0;

				// Recompute integer coords after shifting - then, random value per tile 
				i = floor(uv);
				float rand = (hashwithoutsine12(i) * 5.0 + 1.0);
				float jitter = mix(1.0, rand, variation);
				f *= jitter;

                return f;
            }`,[e]),i=new wt(`float circle(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);
                return smoothstep(
                    -smoothness, 
                     smoothness, 
                     length(f) - size
                );
            }`,[t]),r=new wt(`float ring(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);

				float d = length(f);
                const float inner_width = 0.5;

                float outer = smoothstep(-smoothness, smoothness, d - size);
                float inner = smoothstep(-smoothness, smoothness, d - size * inner_width);
				return outer + (1.0 - inner);   
            }`,[t]),n=new wt(`float sdf_ngon(in vec2 p, in float r, in int n) {
                float an = (PI * 2.0) / float(n);
                float he = r * tan(0.5 * an);
                
                // Rotate to first sector
                p = -p.yx; 
                float bn = an * floor((atan(p.y, p.x) + 0.5 * an) / an);
                vec2  cs = vec2(cos(bn), sin(bn));
                p = mat2(cs.x, -cs.y, cs.y, cs.x)*p;
            
                // Side of polygon
                return length(p - vec2(r, clamp(p.y, -he, he))) * sign(p.x - r);
            }
            
            float polygon(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation, in int sides) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);
                return smoothstep(-smoothness, smoothness, sdf_ngon(f, size, sides));
            }`,[t]),s=new wt(`float sdf_cross(in vec2 p, in vec2 b, float r ) {
                p = abs(p); 
				p = (p.y > p.x) ? p.yx : p.xy;
                vec2  q = p - b;
                float k = max(q.y, q.x);
                vec2  w = (k > 0.0) ? q : vec2(b.y - p.x, -k);
                return sign(k) * length(max(w, 0.0)) + r;
            }
            
            // Avoid namespace conflicts 
            float xcross(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);
                return smoothstep(-smoothness, smoothness, sdf_cross(f, vec2(size, size * 0.25), smoothness));
            }`,[t]),a=new wt(`float ndot(vec2 a, vec2 b) { 
                return a.x*b.x - a.y*b.y; 
            }
            
            float sdf_diamond(in vec2 p, in vec2 b) {
                p = abs(p);
                float h = clamp(ndot(b - 2.0 * p, b) / dot(b, b), -1.0, 1.0);
                float d = length(p - 0.5 * b * vec2(1.0 - h, 1.0 + h));
                return d * sign(p.x * b.y + p.y * b.x - b.x * b.y);
            }

            float diamond(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);
	            return smoothstep(-smoothness, smoothness, sdf_diamond(f, vec2(size)));
            }`,[t]),o=new wt(`float checkerboard(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                uv *= frequency;
                vec2 i = floor(uv);

                float offset = mod(i.y, 2.0);

                uv.x += offset + zigzag * offset;
                float x = floor(uv.x);
                
                return mod(x, 2.0);
            }`),l=new wt(`float line(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, 0.0, zigzag, rotation);
				
				// Different approach for variation param here
				float row = floor(uv * frequency).y;
				float rand = hashwithoutsine12(vec2(row));
				float s = mix(size, size * rand, variation);

				return smoothstep(
					s - smoothness, 
					s + smoothness, 
					abs(f.y)
				);
            }`,[t]),c=new wt(`// Uses bisection 
            float udf_cos(in vec2 p, in float a, in float b, in float c, in float d) {
                // Convert all data to a primitive cosine wave
                p = c * (p - vec2(d, a));
                
                const float TWO_PI = PI * 2.0;

                // Reduce to principal half cycle
                p.x = mod(p.x, TWO_PI); 
                if (p.x > PI) {
                    p.x = TWO_PI - p.x;
                }
            
                // Find zero of derivative (minimize distance)
                float xa = 0.0;
                float xb = TWO_PI;

                // 24 bit precision
                for (int i = 0; i < 24; i++) {
                    float x = 0.5 * (xa + xb);
                    float y = x - p.x + b * c * sin(x) * (p.y - b * c * cos(x));
                    if (y < 0.0) xa = x; 
                    else xb = x;
                }
                float x = 0.5 * (xa + xb);
                
                // Compute distance    
                vec2 q = vec2(x, b * c * cos(x));
                return length(p - q) / c;
            }

            float wave(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                float repeat = frequency.x;
                uv *= repeat;
                vec2 i = floor(uv);
                float row_offset = mod(i.y, 2.0);
                uv.x += row_offset * zigzag;
                vec2 f = vec2(uv.x, fract(uv.y));

                // Generalized cosine: y(x) = a + b * cos(cx + d)
                const float amplitude = 0.125;
                float wave_frequency = frequency.y * 0.1;
                float distance_estimate = udf_cos(f, 0.50, amplitude, wave_frequency * (2.0 * PI), 0.0);

				// Different approach for variation param here
				float rand = hashwithoutsine12(vec2(i.y));
				float s = mix(size, size * rand, variation);

                return smoothstep(-smoothness, smoothness, distance_estimate - s * 0.5);
            }`);return{tileAndCenter:t,circle:i,ring:r,polygon:n,cross:s,diamond:a,checkerboard:o,line:l,wave:c}}();var Fte=class extends hr{constructor(e,t,i,r,n,s,a,o){super("v3"),this.nodeType="Rainbow",this.filmThickness=e,this.movement=t,this.wavelengths=i,this.noiseStrength=r,this.noiseScale=n,this.offset=s,this.isMask=o,this.alpha=a,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.require("vWorldViewDir"),e.require("worldNormal"),e.isShader("fragment")){e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let i=e.include(Fte.Nodes.rainbow),r=[];return r.push(this.filmThickness.build(e,"f")),r.push(this.movement.build(e,"f")),r.push(this.wavelengths.build(e,"v3")),r.push(this.noiseStrength.build(e,"f")),r.push(this.noiseScale.build(e,"f")),r.push(this.offset.build(e,"v3")),r.push(this.isMask.build(e,"b")),r.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),r.push(this.alpha.build(e,"f")),r.push(this.calpha),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("RainbowNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},Ute=Fte;Ute.Nodes=function(){let e=new wt(`vec3 attenuation(vec3 wavelengths, float filmThickness, float movement, float noiseStrength, float noiseScale, vec3 offset) {
				float f = 0.0;
				
				if (noiseStrength != 0.0) {
					vec3 st = position / noiseScale;
					float noise = simplexFast(1.6 * st + vec3(1.8, 1.5, 1.9) * simplexFast(st) + vec3(1.7, 9.2, 1.0));
					f = noise * noiseStrength;
				}

				vec3 waves = wavelengths * vec3(1.0, 0.8, 0.6) + 1.0;
				float angle = dot(normalize(vWorldViewDir + (offset * -0.001)), normalize(vWNormal));

				mediump vec3 color = cos((((filmThickness + f) / waves) * angle) + movement);
				return .5 + .5 * color;
			 }`,[Ja.simplexFast]);return{rainbow:new wt(`vec3 rainbow(float filmThickness, float movement, vec3 wavelengths, float noiseStrength, float noiseScale, vec3 offset, bool isMask, float mask, float alpha, out float calpha) {
				mediump vec3 res = clamp(attenuation(wavelengths, filmThickness, movement, noiseStrength, noiseScale, offset), 0.0, 2.0);

				float rainbowContribution = clamp(res.r + res.g + res.b, 0.0, 1.0);

				float lalpha = alpha * rainbowContribution * mask;
				calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return res;
			 }`,[e])}}();var Nte=class extends hr{constructor(e,t,i,r,n,s,a,o,l,c){super("v3"),this.nodeType="Toon",this.positioning=e,this.colors=t,this.steps=i,this.source=r,this.isWorldSpace=n,this.noiseStrength=s,this.noiseScale=a,this.shadowColor=o,this.offset=l,this.alpha=c,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.require("worldNormal"),e.require("worldPosition"),e.isShader("fragment")){e.define("COLORS_MAX",10),e.addFragmentVariable(this.calpha,"float");let i=e.include(Nte.Nodes.toon),r=[];return r.push(this.positioning.build(e,"i")),r.push(this.colors.build(e,"v4[]")),r.push(this.steps.build(e,"f[]")),r.push(this.source.build(e,"v3")),r.push(this.isWorldSpace.build(e,"b")),r.push(this.noiseStrength.build(e,"f")),r.push(this.noiseScale.build(e,"f")),r.push(this.shadowColor.build(e,"v4")),r.push(this.offset.build(e,"v3")),r.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),r.push(this.alpha.build(e,"f")),r.push(this.calpha),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("ToonNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},kte=Nte;kte.Nodes=function(){let e=new wt(`float rand(float n) {
				return fract(sin(n) * 43758.5453123);
			}`),t=new wt(`float hash1(float p) { 
				p = fract(p * 0.011); 
				p *= p + 7.5; 
				p *= p + p; 
				return fract(p); 
			}`),i=new wt(`float valueNoise(vec3 x) {
				const vec3 step = vec3(110, 241, 171);
			
				vec3 i = floor(x);
				vec3 f = fract(x);
			 
				// For performance, compute the base input to a 1D hash from the integer part of the argument and the 
				// incremental change to the 1D based on the 3D -> 1D wrapping
				float n = dot(i, step);
			
				vec3 u = f * f * (3.0 - 2.0 * f);
				return mix(mix(mix( hash1(n + dot(step, vec3(0, 0, 0))), hash1(n + dot(step, vec3(1, 0, 0))), u.x),
							   mix( hash1(n + dot(step, vec3(0, 1, 0))), hash1(n + dot(step, vec3(1, 1, 0))), u.x), u.y),
						   mix(mix( hash1(n + dot(step, vec3(0, 0, 1))), hash1(n + dot(step, vec3(1, 0, 1))), u.x),
							   mix( hash1(n + dot(step, vec3(0, 1, 1))), hash1(n + dot(step, vec3(1, 1, 1))), u.x), u.y), u.z);
			}`,[t]),r=new wt(`vec3 hash3(vec3 x) {
				x = vec3(dot(x,vec3(127.1, 311.7, 74.7)),
						 dot(x,vec3(269.5, 183.3, 246.1)),
						 dot(x,vec3(113.5, 271.9, 124.6)));
			
				return fract(sin(x)*43758.5453123);
			}`),n=new wt(`vec3 voronoiNoise(in vec3 x)
			{
				vec3 p = floor(x);
				vec3 f = fract(x);

				float id = 0.0;
				vec2 res = vec2(100.0);

				for(int k=-1; k<=1; k++)
				for(int j=-1; j<=1; j++)
				for(int i=-1; i<=1; i++)
				{
					vec3 b = vec3(float(i), float(j), float(k));

					// Comment out the "+ hash(p + b);" part below to get "square" cells
					vec3 r = vec3(b) - f + hash3(p + b);
					float d = dot(r, r);

					if (d < res.x)
					{
						id = dot(p + b, vec3(1.0, 57.0, 113.0));
						res = vec2(d, res.x);			
					}
					else if (d < res.y)
					{
						res.y = d;
					}
				}

				return vec3(sqrt(res), abs(id));
			}
			`,[r]);return{toon:new wt(`vec3 toon(int positioning, vec4 colors[COLORS_MAX], float steps[COLORS_MAX], vec3 source, bool isWorldSpace, float noiseStrength, float noiseScale, vec4 shadowColor, vec3 offset, float mask, float alpha, out float calpha) {
				float t = 0.0;
				float shadow = 1.0;

				if (positioning == 0) {

					// Can't do this mode if lighting is "none"
					#if (defined(PHONG) || defined(LAMBERT) || defined(STANDARD))

						// Algorithm from Chapter 10 of Graphics Shaders
						const vec3 weights = vec3(0.2125, 0.7154, 0.0721);
						vec3 lpos;
						vec3 l;
						float dproduct;

						#if (NUM_POINT_LIGHTS > 0)

							#if defined(USE_SHADOWMAP) && (NUM_POINT_LIGHT_SHADOWS > 0)
								PointLightShadow pointLightShadow;
							#endif 

							#pragma unroll_loop_start
							for (int i = 0; i < NUM_POINT_LIGHTS; i++) {
								// Light positions are in view-space for some reason?
								lpos = (inverse(viewMatrix) * vec4(pointLights[UNROLLED_LOOP_INDEX].position, 1.0)).xyz;
								l = normalize(lpos - worldPosition);
								
								dproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;
								
								// TODO: we want to use "intensity" but it isn't available in the shader code
								//dproduct += dot(pointLights[UNROLLED_LOOP_INDEX].color, weights);

								t = max(t, dproduct);

								// Accumulate shadow contribution
								#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS)
									pointLightShadow = pointLightShadows[UNROLLED_LOOP_INDEX];
									shadow *= getPointShadow( 
											pointShadowMap[UNROLLED_LOOP_INDEX], 
											pointLightShadow.shadowMapSize, 
											pointLightShadow.shadowBias, 
											pointLightShadow.shadowRadius,
											vPointShadowCoord[UNROLLED_LOOP_INDEX], 
											pointLightShadow.shadowCameraNear, 
											pointLightShadow.shadowCameraFar);
								#endif
							}
							#pragma unroll_loop_end

						#endif

						#if NUM_DIR_LIGHTS > 0 
							
							#if defined(USE_SHADOWMAP) && (NUM_DIR_LIGHT_SHADOWS > 0)
								DirectionalLightShadow directionalLightShadow;
							#endif 

							#pragma unroll_loop_start
							for (int i = 0; i < NUM_DIR_LIGHTS; i++) {
								// Use the direction vector for directional lights instead
								l = (inverse(viewMatrix) * vec4(directionalLights[UNROLLED_LOOP_INDEX].direction, 0.0)).xyz;
		
								dproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;
								t = max(t, dproduct);

								// Accumulate shadow contribution
								#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS)
									directionalLightShadow = directionalLightShadows[UNROLLED_LOOP_INDEX];
									shadow *= getShadow( 
										UNROLLED_LOOP_INDEX,
										directionalShadowMap[UNROLLED_LOOP_INDEX], 
										directionalLightShadow.shadowMapSize, 
										directionalLightShadow.shadowBias, 
										directionalLightShadow.shadowRadius, 
										vDirectionalShadowCoord[UNROLLED_LOOP_INDEX]);
								#endif
							}
							#pragma unroll_loop_end

						#endif

						#if NUM_SPOT_LIGHTS > 0 
							
							#if defined(USE_SHADOWMAP) && (NUM_SPOT_LIGHT_SHADOWS > 0)
								SpotLightShadow spotLightShadow;
							#endif 

							#pragma unroll_loop_start
							for (int i = 0; i < NUM_SPOT_LIGHTS; i++) {
								lpos = (inverse(viewMatrix) * vec4(spotLights[UNROLLED_LOOP_INDEX].position, 1.0)).xyz;
								l = normalize(lpos - worldPosition);
								
								dproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;
								t = max(t, dproduct);

								// Accumulate shadow contribution
								#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS)
									spotLightShadow = spotLightShadows[UNROLLED_LOOP_INDEX];
									shadow *= getShadow(
										UNROLLED_LOOP_INDEX,
										spotShadowMap[UNROLLED_LOOP_INDEX], 
										spotLightShadow.shadowMapSize, 
										spotLightShadow.shadowBias, 
										spotLightShadow.shadowRadius, 
										vSpotLightCoord[UNROLLED_LOOP_INDEX]);
								#endif
							}
							#pragma unroll_loop_end

						#endif

						t = clamp(t, 0.0, 1.0);
				
					#endif

				} else if (positioning == 1) {
					
					vec3 origin = mix(position, worldPosition, float(isWorldSpace));
					vec3 direction = normalize(source - origin);
					t = dot(direction, normalize(worldNormal)) * 0.5 + 0.5;	

				} else {

					vec3 origin = worldPosition;
					vec3 source = cameraPosition - offset;
					vec3 direction = normalize(source - origin);
					t = dot(direction, normalize(worldNormal)) * 0.5 + 0.5;	
					
				}

				if (noiseStrength > 0.0) {
					// Distort with noise
					vec3 st = position / noiseScale;
					
					// Voronoi "smooth" noise
					float noise = 1.0 - voronoiNoise(st).x;

					// Voronoi cellular noise
					//float noise = 1.0 - rand(voronoiNoise(st).z);

					// Position warp noise
					// vec3 offset = vec3(
					// 	simplexFast(st),
					// 	simplexFast(st + vec3(111.1, 143.89, 217.19)),
					// 	simplexFast(st + vec3(171.1, 247.89, 117.23))
					// );
					// st += offset;
					// float noise = valueNoise(st);

					t += noise * noiseStrength;
				}

				t = clamp(t, 0.0, 1.0);

				// Compute ramp color
				float p;
				vec4 color = colors[0];
				for (int i = 1; i < COLORS_MAX; i++) {
					p = clamp((t - steps[i-1]) / (steps[i] - steps[i-1]), 0.0, 1.0);
					color = mix(color, colors[i], smoothstep(0.0, 1.0, p));
				}

				// Incorporate custom shadow color
				if (positioning == 0) {

					vec3 blendedShadow = mix(color.rgb, shadowColor.rgb, shadowColor.a);
					color.rgb = mix(blendedShadow, color.rgb, shadow);
				
				}

				// Accumulate alpha as usual
				float lalpha = alpha * color.a * mask;
				calpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);
				accumAlpha += (1.0 - accumAlpha) * lalpha;

				return color.xyz;

            }`,[Ja.simplexFast,e,i,n])}}();var uIe=function(){return{textureBicubic:new wt(`float w0( float a ) {
            return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
        }
    
        float w1( float a ) {
            return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
        }
    
        float w2( float a ){
            return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
        }
    
        float w3( float a ) {
            return ( 1.0 / 6.0 ) * ( a * a * a );
        }
    
        // g0 and g1 are the two amplitude functions
        float g0( float a ) {
            return w0( a ) + w1( a );
        }
    
        float g1( float a ) {
            return w2( a ) + w3( a );
        }
    
        // h0 and h1 are the two offset functions
        float h0( float a ) {
            return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
        }
    
        float h1( float a ) {
            return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
        }
    
        vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
            uv = uv * texelSize.zw + 0.5;
    
            vec2 iuv = floor( uv );
            vec2 fuv = fract( uv );
    
            float g0x = g0( fuv.x );
            float g1x = g1( fuv.x );
            float h0x = h0( fuv.x );
            float h1x = h1( fuv.x );
            float h0y = h0( fuv.y );
            float h1y = h1( fuv.y );
    
            vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
            vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
            vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
            vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
    
            return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) + 
                   g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
        }

        vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
            vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
            vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
            vec2 fLodSizeInv = 1.0 / fLodSize;
            vec2 cLodSizeInv = 1.0 / cLodSize;
            vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
            vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
            return mix( fSample, cSample, fract( lod ) );
        }`)}}();function hIe(e,t){return e>=t?new Me(t/e,1):new Me(1,e/t)}var Vte=class extends hr{constructor(e,t,i,r,n,s,a,o){super("v3"),this.nodeType="Transmission",this.thickness=e,this.ior=t,this.roughness=i,this.transmissionSamplerSize=r,this.transmissionSamplerMap=n,this.transmissionDepthMap=s,this.aspectRatio=a,this.alpha=o,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.extensions.shaderTextureLOD=!0,e.extensions.derivatives=!0,e.isShader("fragment")){e.define("NUM_SAMPLES",6),e.define("BLUR_SLOD",Math.pow(2,Kt.transmissionLod.value)),e.require("worldPosition"),e.requires.worldNormal=!0,e.requires.modelMatrix=!0,e.requires.projectionMatrix=!0,e.addFragmentVariable(this.calpha,"float");let i=e.include(Vte.Nodes.transmission),r=[];return r.push(this.thickness.build(e,"f")),r.push(this.ior.build(e,"f")),r.push(this.roughness.build(e,"f")),r.push(this.transmissionSamplerSize.build(e,"v2")),r.push(this.transmissionSamplerMap.getTexture(e,"t")),r.push(this.transmissionDepthMap.getTexture(e,"t")),r.push(this.aspectRatio.build(e,"v2")),r.push("normal"),r.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),r.push(this.alpha.build(e,"f")),r.push(this.calpha),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("TransmissionNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},Gte=Vte;Gte.Nodes=function(){let e=new wt(`vec3 blur(sampler2D sp, vec2 U, vec2 scale, float lod, sampler2D dm, vec2 unrefractedU, vec2 aspectRatio) {
                // Slightly modified version of this:
                // https://www.shadertoy.com/view/ltScRG

				// Special case for blur == 0.0
				if (lod == 0.0) {
					#ifdef TEXTURE_LOD_EXT
					return texture2DLodEXT( sp, U, 0.0).rgb;
					#else
					return textureLod( sp, U, 0.0).rgb;
					#endif
				}
				
				vec2 texelSize = vec2(1.0) / resolution;
                vec2 halton = haltonSequence[frameIndex];
                float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);
                float temporalAngle  = temporalOffset * PI2;
				vec3 res = vec3(0.0);
                vec2 uv = vec2(0.0);
                vec2 offset = vec2(0.0);
                vec2 vogelSample = vec2(0.0);
                for (int i = 0; i < NUM_SAMPLES; i++) {
                    vogelSample =  vogelDiskSample(i, NUM_SAMPLES, temporalAngle) * texelSize;
                    offset = vogelSample * scale * (lod * 10.0); // TODO: used to be hardcoded to 20
                    uv = U + offset;
                    float opaqueDepth = unpackRGBAToDepth(textureLod(dm, uv, lod));
                    if (opaqueDepth != 0.0 && opaqueDepth < gl_FragCoord.z) {
                        uv = unrefractedU;
                        lod = lod > 4.0 ? lod : lod / 2.0;
                    }
                    res += textureLod(sp, uv, lod).rgb;
                }
                return res / float(NUM_SAMPLES);
            }`),t=new wt(`vec3 getVolumeTransmissionRay( vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix ) {
		        // Direction of refracted light.
		        vec3 refractionVector = refract( -v,  n, 1.0 / ior );
		        
				// Compute rotation-independant scaling of the model matrix.
		        vec3 modelScale;
		        modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		        modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		        modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );

		        // The thickness is specified in local space
		        return normalize( refractionVector ) * thickness * modelScale;
	        }`),i=new wt(`float applyIorToRoughness( float roughness, float ior ) {
				// Scale roughness with IOR so that an IOR of 1.0 results in no microfacet refraction and
				// an IOR of 1.5 results in the default amount of microfacet refraction.
				return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
			}`),r=new wt(`vec3 getTransmissionSample( vec2 fragCoord, float roughness, float ior, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 unrefractedCoords, vec2 aspectRatio) {
				// Threejs exports do not pass a depth map to this shader, so we have to fallback to the "Threejs method of blurring" - see
				// also the code in convertTransmission.ts, which runs during export
				#ifdef IS_THREEJS_EXPORT
					float lod = log2(transmissionSamplerSize.x) * applyIorToRoughness(roughness / 5.0, ior);
					return textureBicubic(transmissionSamplerMap, fragCoord.xy, lod).rgb;
				#else
					float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
					float lod = applyIorToRoughness(roughness, ior);
					return blur(transmissionSamplerMap, fragCoord, vec2(lod), min(framebufferLod / 5.5, 8.5), transmissionDepthMap, unrefractedCoords, aspectRatio);
				#endif
			}`,[uIe.textureBicubic,i,e]),n=new wt(`vec3 getIBLVolumeRefraction( vec3 n, vec3 v, float roughness, vec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 aspectRatio ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;

				// Project refracted vector on the framebuffer, while mapping to normalized device coordinates.
				vec4 ndcPos = projMatrix * viewMatrix *  vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;

				vec4 ndcPosUnrefracted = projMatrix * viewMatrix * vec4(position, 1.0 );
				vec2 unrefractedCoords = ndcPosUnrefracted.xy / ndcPosUnrefracted.w;
				unrefractedCoords += 1.0;
				unrefractedCoords /= 2.0;

				// Sample framebuffer to get pixel the refracted ray hits.
				return getTransmissionSample( refractionCoords, roughness, ior, transmissionSamplerSize, transmissionSamplerMap, transmissionDepthMap, unrefractedCoords, aspectRatio );
    		}`,[r,t]);return{transmission:new wt(`vec3 transmission(float thickness, float ior, float roughness, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 aspectRatio, vec3 normal, float mask, float alpha, out float calpha) {
                vec3 v = vec3(0.);
                if (isOrthographic) {
                    v = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
                } else {
                    v = normalize(vWPosition - cameraPosition);
                }
                vec3 transmission = getIBLVolumeRefraction(vWNormal, -v, roughness,  vWPosition, modelMatrix, viewMatrix, projectionMatrix, ior, thickness, transmissionSamplerSize, transmissionSamplerMap, transmissionDepthMap, aspectRatio );
                
				float lalpha = alpha * mask;
				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += ( 1.0 - accumAlpha ) * alpha;

				return transmission;
            }`,[n])}}();var dB=(e=>(e.NOISE="noise",e.MAP="map",e))(dB||{}),Hte=class extends hr{constructor(e,t,i,r,n,s,a,o,l,c,u){super("v3"),this.displacementTypeIndex=new fr(0),this.nodeType="VertexDisplacement",this.intensity=e,this.movementOrTexture=t,Object.values(dB)[this.displacementTypeIndex.value]==="map"&&(this.mat=new Mte(this.movementOrTexture.value.matrix)),this.cropOrOffset=i,this.scale=c,this.noiseFunctionIndex=u,this.voronoiStyle=r,this.smoothness=n,this.seed=s,this.highCut=a,this.lowCut=o,this.quality=l}generate(e,t){if(e.isShader("vertex")){e.define("USE_LAYER_DISPLACE");let i,r=[];switch(r.push("displaced_position"),r.push("displaced_normal"),Object.values(dB)[this.displacementTypeIndex.value]){case"map":{i=e.include(Hte.Nodes.map),r.push(this.movementOrTexture.getTexture(e,"t")),r.push("uv"),r.push(this.cropOrOffset.build(e,"f")),this.mat&&r.push(this.mat.build(e,"mat3"));break}case"noise":{let n=["simplexPrecise","simplexFractal","simplexAshima","fbm","perlin","voronoi"][this.noiseFunctionIndex.value],s=new wt(`vec3 orthogonal(vec3 v) {
							return normalize(abs(v.x) > abs(v.z) ? vec3(-v.y, v.x, 0.0) : vec3(0.0, -v.z, v.y));
						}`),a=n=="voronoi"?`
					float v = ${n}((p + offset) * scale * 0.001 + neighbour_offset + (movement * 0.1), voronoiStyle, smoothness, seed, quality);
					v = remap(v, lowCut, highCut, 0.0, 1.0);
					v = smax(v, 0.0, smoothness * 0.25);
					v = smin(v, 1.0, smoothness * 0.25);

					return p + n * v * intensity;
					`:`
					return p + n * ${n}((p + offset) * scale * 0.001 + neighbour_offset + (movement * 0.1)) * intensity;
					`,o=new wt(`vec3 distorted(vec3 p, vec3 n, float scale, float intensity, vec3 offset, float neighbour_offset, float movement, int voronoiStyle, float smoothness, float seed, float highCut, float lowCut, int quality) {
							${a}
						}`,[Ja.simplexPrecise,Ja.simplexFractal,Ja.simplexAshima,Ja.fbm,Ja.perlin,Ja.voronoi]),l=new wt(`vec3 vertexDisplacementNoise(vec3 position, vec3 normal, float scale, vec3 offset, float movement, int voronoiStyle, float smoothness, float seed, float highCut, float lowCut, int quality, float intensity, out vec3 displaced_normal) {
							vec3 displaced_position = distorted(position, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);
							vec3 tangent1 = orthogonal(normal);
							vec3 tangent2 = normalize(cross(normal, tangent1));

                            // TODO(Max): The distance to the neighbors was originally scaled by 0.1.
                            // This caused some small oval/circular visual artifacts in the lighting.
                            // For now, simply using neighbors further away betters the problem,
                            // but we should figure out the underlying cause when we have some time.
                            // Maybe its related to how we calculate the tangent and bitangent?
							vec3 nearby1 = position + tangent1;
							vec3 nearby2 = position + tangent2;
							vec3 distorted1 = distorted(nearby1, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);
							vec3 distorted2 = distorted(nearby2, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);
							displaced_normal = normalize(cross(distorted1 - displaced_position, distorted2 - displaced_position));
							return displaced_position;
						}`,[o,s]);i=e.include(l),r.push(this.scale.build(e,"f")),r.push(this.cropOrOffset.build(e,"v3")),r.push(this.movementOrTexture.build(e,"f")),r.push(this.voronoiStyle.build(e,"i")),r.push(this.smoothness.build(e,"f")),r.push(this.seed.build(e,"f")),r.push(this.highCut.build(e,"f")),r.push(this.lowCut.build(e,"f")),r.push(this.quality.build(e,"i"));break}}return r.push(this.intensity.build(e,"f")),r.push("displaced_normal"),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("VertexDisplacementNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},jte=Hte;jte.Nodes=function(){let e=new wt(`vec3 orthogonal(vec3 v) {
				return normalize(abs(v.x) > abs(v.z) ? vec3(-v.y, v.x, 0.0) : vec3(0.0, -v.z, v.y));
			}`),t=new wt(`float displacementMapTexture(sampler2D tex, float crop, vec2 uv, mat3 mat, vec2 offset) {
				vec2 uvs = (mat * vec3(uv * 2.0 - 1.0, 1.0) / 2.0 + 0.5).xy + offset;
				vec4 tmp = texture2D(tex, uvs);
				vec3 col = tmp.rgb;
				if (crop > 0.5) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						return 0.0;
					}
				}
				return col.r;
			}`);return{map:new wt(`vec3 vertexDisplacementMap(vec3 position, vec3 normal, sampler2D tex, vec2 uv, float crop, mat3 mat, float intensity, out vec3 displaced_normal) {
				vec3 displaced_position = position + normal * displacementMapTexture(tex, crop, uv, mat, vec2(0.0)) * intensity;
				vec3 tangent1 = normalize(orthogonal(normal));
				vec3 tangent2 = normalize(cross(normal, tangent1));
				vec3 nearby1 = position + tangent1 * 0.1;
				vec3 nearby2 = position + tangent2 * 0.1;
				vec3 distorted1 = nearby1 + normal * displacementMapTexture(tex, crop, uv, mat, vec2(neighbor_offset)) * intensity;
				vec3 distorted2 = nearby2 + normal * displacementMapTexture(tex, crop, uv, mat, vec2(neighbor_offset)) * intensity;
				displaced_normal = normalize(cross(distorted1 - displaced_position, distorted2 - displaced_position));
				return displaced_position;
			}`,[e,t])}}();var Kt={normalRenderTarget:new ih,normalRenderTargetDepth:new ih,transmissionRenderTarget:new ih,aspectRatio:new Cs,transmissionSize:new Cs(2048,2048),transmissionRenderTargetDepth:new ih,aoRenderTarget:new ih,aoEnabled:new Ta,pixelRatioNode:new Dt(1),resolution:new Cs,penumbraSize:new Ap(5,.5),frameIndex:new fr(0),transmissionLod:new fr(2)};for(let e of Object.values(Kt))e.isRenderGlobal=!0;var Wte={skiaWasmUrl:"https://unpkg.com/@splinetool/ui-wasm@1.9.75/build/ui.wasm"},$N=class extends jn{constructor(){super("basic"),this.nodeType="Basic",this.color=new rn(Bo),this.shadingAlpha=new Dt(1),this.shadingBlend=new fr(0),this.previousModelViewMatrix=new cu,this.previouseProjectionMatrix=new cu}get category(){return"phong"}generate(e){let t;if(e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:Kt.frameIndex}),e.mergeUniform({resolution:Kt.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(ay.merge([xt.fog])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <morphtarget_pars_vertex>"].join(`
`));let r=["#include <beginnormal_vertex>","#include <morphnormal_vertex>",`
				#include <skinbase_vertex>
				#include <skinnormal_vertex>
				#if !defined( USE_LAYER_DISPLACE )
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = normal;

				#if defined( USE_LAYER_DISPLACE )
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#if !defined( USE_LAYER_DISPLACE )
					#include <begin_vertex>
				#endif /* !USE_LAYER_DISPLACE */
				`];i&&r.push(i.code,i.result?"displaced_position = "+i.result+";":""),r.push("transformed = displaced_position;","#include <morphtarget_vertex>","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","	vNormal = transformedNormal;","#endif"),r.push("#include <project_vertex>","#include <fog_vertex>","#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=r.join(`
`)}else{this.color===void 0&&(this.color=new rn(Bo)),this.color.analyze(e,{slot:"color"}),this.alpha&&this.alpha.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"});let i=this.color.flow(e,"c",{slot:"color"}),r=this.alpha?this.alpha.flow(e,"f"):void 0,n=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0,s=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0;e.requires.transparent=r!==void 0,e.addParsCode(["varying vec3 vWPosition;","#include <fog_pars_fragment>","#include <dithering_pars_fragment>","varying vec3 vViewPosition;","#include <normal_pars_fragment>"].join(`
`));let a=["#include <normal_fragment_begin>",i.code];r&&a.push(r.code,"#ifdef ALPHATEST"," if ( "+r.result+" <= ALPHATEST ) discard;","#endif"),s?a.push(s.code,`vec3 outgoingLight = ${i.result};`,`vec3 finalColor = spe_blend(outgoingLight, ${s.result}, 1.0, SPE_BLENDING_NORMAL);`):a.push(`vec3 finalColor = ${i.result};`);let o="1.0";this.mask&&(this.mask.analyze(e),o=`luminance(${this.mask.flow(e,"v3").result})`),r?a.push(`gl_FragColor = vec4( finalColor, accumAlpha * ${r.result} * ${o} );`):a.push("gl_FragColor = vec4("+i.result+", 1.0 );"),n&&a.push(`gl_FragColor.a *= ${n.result};`),a.push("#include <fog_fragment>","#include <dithering_fragment>"),t=a.join(`
`)}return t}},dIe=class extends jn{constructor(){super("lambert"),this.nodeType="Lambert",this.color=new rn(Bo),this.emissive=new rn(0),this.emissiveIntensity=new Dt(1),this.previousModelViewMatrix=new cu,this.previouseProjectionMatrix=new cu,this.shadingAlpha=new Dt(1),this.shadingBlend=new fr(0),this.occlusion=new Ta(!0)}get category(){return"lambert"}build(e){let t;if(e.define("LAMBERT"),e.requires.lights=!0,e.extensions.derivatives=!0,e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:Kt.frameIndex}),e.mergeUniform({resolution:Kt.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(ay.merge([xt.fog,xt.lights])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","varying vec3 vLightFront;","varying vec3 vIndirectFront;","#ifndef DOUBLE_SIDED","   #define DOUBLE_SIDED","#endif","#ifdef DOUBLE_SIDED","	varying vec3 vLightBack;","	varying vec3 vIndirectBack;","#endif","#include <bsdfs>","#include <lights_pars_begin>","#include <color_pars_vertex>","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <morphtarget_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let r=["#include <beginnormal_vertex>","#include <morphnormal_vertex>",`
				#include <skinbase_vertex>
				#include <skinnormal_vertex>
				#ifndef USE_LAYER_DISPLACE
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = objectNormal;

				#ifdef USE_LAYER_DISPLACE
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <begin_vertex>
				#endif
				`];i&&r.push(i.code,i.result?"displaced_position = "+i.result+";":""),r.push("transformed = displaced_position;","#include <morphtarget_vertex>","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),r.push("	#include <project_vertex>","	#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","	#include <worldpos_vertex>",`
					vec3 diffuse = vec3( 1.0 );
					GeometricContext geometry;
					geometry.position = mvPosition.xyz;
					geometry.normal = normalize( transformedNormal );
					geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );
				`),r.push(`
					GeometricContext backGeometry;
					backGeometry.position = geometry.position;
					backGeometry.normal = -geometry.normal;
					backGeometry.viewDir = geometry.viewDir;
					vLightFront = vec3( 0.0 );
					vIndirectFront = vec3( 0.0 );
					#ifdef DOUBLE_SIDED
						vLightBack = vec3( 0.0 );
						vIndirectBack = vec3( 0.0 );
					#endif
					IncidentLight directLight;
					float dotNL;
					vec3 directLightColor_Diffuse;
					vIndirectFront += getAmbientLightIrradiance( ambientLightColor );
					vIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );
					#ifdef DOUBLE_SIDED
						vIndirectBack += getAmbientLightIrradiance( ambientLightColor );
						vIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );
					#endif
					#if NUM_POINT_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
							getPointLightInfo( pointLights[ i ], geometry, directLight );
							dotNL = dot( geometry.normal, directLight.direction );
							directLightColor_Diffuse = directLight.color;
							vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
							#ifdef DOUBLE_SIDED
								vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
							#endif
						}
						#pragma unroll_loop_end
					#endif
					#if NUM_SPOT_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
							getSpotLightInfo( spotLights[ i ], geometry, directLight );
							dotNL = dot( geometry.normal, directLight.direction );
							directLightColor_Diffuse = directLight.color;
							vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
							#ifdef DOUBLE_SIDED
								vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
							#endif
						}
						#pragma unroll_loop_end
					#endif
					#if NUM_DIR_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
							getDirectionalLightInfo( directionalLights[ i ], geometry, directLight );
							dotNL = dot( geometry.normal, directLight.direction );
							directLightColor_Diffuse = directLight.color;
							vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
							#ifdef DOUBLE_SIDED
								vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
							#endif
						}
						#pragma unroll_loop_end
					#endif
					#if NUM_HEMI_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
							vIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
							#ifdef DOUBLE_SIDED
								vIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );
							#endif
						}
						#pragma unroll_loop_end
					#endif
				`,"	#include <shadowmap_vertex>","	#include <fog_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=r.join(`
`)}else{e.mergeUniform({penumbraSize:Kt.penumbraSize}),e.mergeUniform({frameIndex:Kt.frameIndex}),e.mergeUniform({aoMap:Kt.aoRenderTarget}),e.mergeUniform({aoEnabled:Kt.aoEnabled}),this.color===void 0&&(this.color=new rn(Bo)),this.color.analyze(e,{slot:"color"}),this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e);let i=this.color.flow(e,"c",{slot:"color"}),r=this.emissive.flow(e,"c",{slot:"emissive"}),n=this.emissiveIntensity.flow(e,"f",{slot:"emissive"}),s=this.occlusion.flow(e,"b",{slot:"occlusion"}),a=this.shadingAlpha.flow(e,"f"),o=this.shadingBlend.flow(e,"i"),l=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,c=this.alpha?this.alpha.flow(e,"f"):void 0,u=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0;e.requires.transparent=c!==void 0,e.addParsCode(["uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","varying vec3 vViewPosition;","varying vec3 vWPosition;","varying vec3 vLightFront;","varying vec3 vIndirectFront;","#ifndef DOUBLE_SIDED","   #define DOUBLE_SIDED","#endif","#include <normal_pars_fragment>","#ifdef DOUBLE_SIDED","	varying vec3 vLightBack;","	varying vec3 vIndirectBack;","#endif","#include <bsdfs>","#include <lights_pars_begin>","#include <fog_pars_fragment>","#include <shadowmap_pars_fragment>","#include <shadowmask_pars_fragment>","#include <clipping_planes_pars_fragment>","#include <dithering_pars_fragment>"].join(`
`));let h=["#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx, viewdy));
				bool isFrontFacing = (dot(normal, faceNormal) >= 0.0);
				`,"#include <clipping_planes_fragment>"];h.push(i.code,"vec3 diffuseColor = "+i.result+";","ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );"),c&&h.push(c.code,"#ifdef ALPHATEST","if ( "+c.result+" <= ALPHATEST ) discard;","#endif"),h.push("#ifdef DOUBLE_SIDED","	reflectedLight.indirectDiffuse += ( isFrontFacing ) ? vIndirectFront : vIndirectBack;","#else","	reflectedLight.indirectDiffuse += vIndirectFront;","#endif","#include <lightmap_fragment>","reflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );","#ifdef DOUBLE_SIDED","	reflectedLight.directDiffuse = ( isFrontFacing ) ? vLightFront : vLightBack;","#else","	reflectedLight.directDiffuse = vLightFront;","#endif","reflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();"),r&&h.push(r.code,"reflectedLight.directDiffuse += "+r.result+" * "+n.result+";"),h.push("vec3 ao = aoEnabled && "+s.result+" ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = (reflectedLight.directDiffuse + reflectedLight.indirectDiffuse) ;");let d="1.0";this.mask&&(this.mask.analyze(e),d=`luminance(${this.mask.flow(e,"v3").result})`),h.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${a.result} * ${d} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${a.result} * ${d}, ${o.result} );

					outgoingLight *= ao;
				}
				`),l&&h.push(l.code,`outgoingLight = spe_blend(outgoingLight, ${l.result}, 1.0, SPE_BLENDING_NORMAL);`),c?h.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${c.result} );`):h.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),u&&h.push(`gl_FragColor.a *= ${u.result};`),h.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=h.join(`
`)}return t}},X0=function(){let e=new wt(`vec2 dHdxy(sampler2D bumpMap, vec2 bumpMapUv, float bumpScale) {

            // Gradient of UVs w.r.t. X coordinate (in screen-space)
            vec2 dSTdx = dFdx(bumpMapUv);

            // Gradient of UVs w.r.t. Y coordinate (in screen-space)
            vec2 dSTdy = dFdy(bumpMapUv);
            
            // Forward differencing
            float Hll = bumpScale * luminance(texture(bumpMap, bumpMapUv).rgb);
            float dBx = bumpScale * luminance(texture(bumpMap, bumpMapUv + dSTdx).rgb) - Hll;
            float dBy = bumpScale * luminance(texture(bumpMap, bumpMapUv + dSTdy).rgb) - Hll;
            
            return vec2( dBx, dBy );
        }`),t=new wt(`vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
            vec3 vSigmaX = dFdx( surf_pos.xyz );
            vec3 vSigmaY = dFdy( surf_pos.xyz );
            vec3 vN = surf_norm; // normalized
            
            vN = normalize(vN);

            vec3 R1 = cross( vSigmaY, vN );
            vec3 R2 = cross( vN, vSigmaX );

            R1 = normalize(R1);
            R2 = normalize(R2);
    
            float fDet = dot( vSigmaX, R1 ) * faceDirection;
    
            vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
            return normalize( abs( fDet ) * vN - vGrad );
        }`);return{dHdxy:e,perturbNormalArb:t}}(),fIe=class extends jn{constructor(){super("phong"),this.nodeType="Phong",this.color=new rn(Bo),this.specular=new rn(1118481),this.shininess=new Dt(30),this.previousModelViewMatrix=new cu,this.previouseProjectionMatrix=new cu,this.shadingAlpha=new Dt(1),this.shadingBlend=new fr(0),this.occlusion=new Ta(!0)}get category(){return"phong"}build(e){let t;if(e.define("PHONG"),e.requires.lights=!0,e.extensions.derivatives=!0,e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:Kt.frameIndex}),e.mergeUniform({resolution:Kt.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(ay.merge([xt.fog,xt.lights])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <morphtarget_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let r=["#include <beginnormal_vertex>","#include <morphnormal_vertex>",`
				#include <skinbase_vertex>
				#include <skinnormal_vertex>
				#ifndef USE_LAYER_DISPLACE
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = objectNormal;

				#ifdef USE_LAYER_DISPLACE
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <begin_vertex>
				#endif
				`];i&&r.push(i.code,i.result?"displaced_position = "+i.result+";":""),r.push("transformed = displaced_position;","#include <morphtarget_vertex>","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),r.push("	#include <project_vertex>","	#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","	#include <worldpos_vertex>","	#include <shadowmap_vertex>","	#include <fog_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=r.join(`
`)}else{e.mergeUniform({penumbraSize:Kt.penumbraSize}),e.mergeUniform({frameIndex:Kt.frameIndex}),e.mergeUniform({aoMap:Kt.aoRenderTarget}),e.mergeUniform({aoEnabled:Kt.aoEnabled}),this.color===void 0&&(this.color=new rn(Bo)),this.color.analyze(e,{slot:"color"}),this.specular.analyze(e),this.shininess.analyze(e);let i=this.occlusion.flow(e,"b",{slot:"occlusion"});this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e);let r=this.color.flow(e,"c",{slot:"color"}),n=this.specular.flow(e,"c"),s=this.shininess.flow(e,"f"),a=this.shadingAlpha.flow(e,"f"),o=this.shadingBlend.flow(e,"i"),l=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,c=this.alpha?this.alpha.flow(e,"f"):void 0,u=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0;e.requires.transparent=c!==void 0,e.addParsCode(["varying vec3 vWPosition;","uniform vec3 emissive;","uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","#include <normal_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_phong_pars_fragment>","#include <shadowmap_pars_fragment>","#include <dithering_pars_fragment>"].join(`
`));let h=["#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx,viewdy));
				if (dot(normal, faceNormal) < 0.0) {
					normal *= -1.0;
				}
				`,"	BlinnPhongMaterial material;"];if(this.bumpMap){e.include(X0.dHdxy),e.include(X0.perturbNormalArb);let f=this.bumpMap.texture.flow(e,"t"),p=this.bumpMap.flow(e,"v3"),v=this.bumpMapIntensity?this.bumpMapIntensity.flow(e,"f").result:"1.0",m="";this.bumpMap.projection.value===4?m=`
					vec3 bumpNormal = vec3(0.0);
					{
						vec2 uv0 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs0;
						vec2 uv1 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs1;
						vec2 uv2 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs2;
						vec3 weights = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;

						vec2 grad0 = dHdxy(${f.result}, uv0, ${v});
						vec3 n0 = perturbNormalArb(-vViewPosition, normal, grad0, faceDirection);

						vec2 grad1 = dHdxy(${f.result}, uv1, ${v});
						vec3 n1 = perturbNormalArb(-vViewPosition, normal, grad1, faceDirection);

						vec2 grad2 = dHdxy(${f.result}, uv2, ${v});
						vec3 n2 = perturbNormalArb(-vViewPosition, normal, grad2, faceDirection);
						
						bumpNormal = n0 * weights.z + n1 * weights.x + n2 * weights.y;
						bumpNormal = normalize(bumpNormal);
					}

					normal = bumpNormal;
					`:m=`
					vec2 bumpMapCachedUv = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs;
					vec2 grad = dHdxy(${f.result}, bumpMapCachedUv, ${v});
					normal = perturbNormalArb( - vViewPosition, normal, grad, faceDirection );
					`,h.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates
					${p.result};
					${m}
					`)}h.push(r.code,"	vec3 diffuseColor = "+r.result+";","	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","	vec3 totalEmissiveRadiance = emissive;",n.code,"	vec3 specular = "+n.result+";",s.code,"	float shininess = max( 0.0001, "+s.result+" );","	float specularStrength = 1.0;"),c&&h.push(c.code,"#ifdef ALPHATEST","if ( "+c.result+" <= ALPHATEST ) discard;","#endif"),h.push("material.diffuseColor = diffuseColor;"),h.push("material.specularColor = specular;","material.specularShininess = shininess;","material.specularStrength = specularStrength;","#include <lights_fragment_begin>","#include <lights_fragment_end>"),h.push("vec3 ao = aoEnabled && "+i.result+" ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse)) + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;");let d="1.0";this.mask&&(this.mask.analyze(e),d=`luminance(${this.mask.flow(e,"v3").result})`),h.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${a.result} * ${d} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${a.result} * ${d}, ${o.result} );
					
					outgoingLight *= ao;
				}
				`),l&&h.push(l.code,`outgoingLight = spe_blend(outgoingLight, ${l.result}, 1.0, SPE_BLENDING_NORMAL);`),c?h.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${c.result});`):h.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),u&&h.push(`gl_FragColor.a *= ${u.result};`),h.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=h.join(`
`)}return t}},pIe=class extends jn{constructor(){super("standard"),this.nodeType="Standard",this.color=new rn(Bo),this.roughness=new Dt(.3),this.metalness=new Dt(0),this.reflectivity=new Dt(.5),this.previousModelViewMatrix=new cu,this.previouseProjectionMatrix=new cu,this.shadingAlpha=new Dt(1),this.shadingBlend=new fr(0),this.occlusion=new Ta(!0)}get category(){return"physical"}build(e){let t;if(e.define("STANDARD"),e.requires.lights=!0,e.extensions.derivatives=!0,e.extensions.shaderTextureLOD=!0,e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:Kt.frameIndex}),e.mergeUniform({resolution:Kt.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(ay.merge([xt.fog,xt.lights])),xt.LTC_1&&(e.uniforms.ltc_1={value:void 0},e.uniforms.ltc_2={value:void 0}),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <morphtarget_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let r=["#include <beginnormal_vertex>","#include <morphnormal_vertex>",`
				#include <skinbase_vertex>
				#include <skinnormal_vertex>
				#if !defined( USE_LAYER_DISPLACE )
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = objectNormal;

				#if defined( USE_LAYER_DISPLACE )
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#if !defined( USE_LAYER_DISPLACE )
					#include <begin_vertex>
				#endif /* !USE_LAYER_DISPLACE */
				`];i&&r.push(i.code,i.result?"displaced_position = "+i.result+";":""),r.push("transformed = displaced_position;","#include <morphtarget_vertex>","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),r.push("#include <project_vertex>","#include <fog_vertex>","#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>","#include <shadowmap_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=r.join(`
`)}else{e.mergeUniform({penumbraSize:Kt.penumbraSize}),e.mergeUniform({frameIndex:Kt.frameIndex}),e.mergeUniform({aoMap:Kt.aoRenderTarget}),e.mergeUniform({aoEnabled:Kt.aoEnabled});let i={gamma:!0};this.color===void 0&&(this.color=new rn(Bo)),this.color.analyze(e,{slot:"color",context:i}),this.roughness.analyze(e),this.metalness.analyze(e);let r=this.occlusion.flow(e,"b",{slot:"occlusion"});this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e),this.reflectivity&&this.reflectivity.analyze(e);let n=this.color.flow(e,"c",{slot:"color",context:i}),s=this.roughness.flow(e,"f"),a=this.metalness.flow(e,"f"),o=this.shadingAlpha.flow(e,"f"),l=this.shadingBlend.flow(e,"i"),c=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,u=this.alpha?this.alpha.flow(e,"f"):void 0,h=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0,d=this.reflectivity?this.reflectivity.flow(e,"f"):void 0;e.requires.transparent=u!==void 0,e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","#include <normal_pars_fragment>","#include <dithering_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_physical_pars_fragment>","#include <shadowmap_pars_fragment>"].join(`
`));let f=["#include <clipping_planes_fragment>","	#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx,viewdy));
				if (dot(normal, faceNormal) < 0.0) {
					normal *= -1.0;
				}
				`,"	PhysicalMaterial material;","	material.diffuseColor = vec3( 1.0 );"];if(this.bumpMap){e.include(X0.dHdxy),e.include(X0.perturbNormalArb);let v=this.bumpMap.texture.flow(e,"t"),m=this.bumpMap.flow(e,"v3"),g=this.bumpMapIntensity?this.bumpMapIntensity.flow(e,"f").result:"1.0",y="";this.bumpMap.projection.value===4?y=`
					vec3 bumpNormal = vec3(0.0);
					{
						vec2 uv0 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs0;
						vec2 uv1 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs1;
						vec2 uv2 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs2;
						vec3 weights = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;

						vec2 grad0 = dHdxy(${v.result}, uv0, ${g});
						vec3 n0 = perturbNormalArb(-vViewPosition, normal, grad0, faceDirection);

						vec2 grad1 = dHdxy(${v.result}, uv1, ${g});
						vec3 n1 = perturbNormalArb(-vViewPosition, normal, grad1, faceDirection);

						vec2 grad2 = dHdxy(${v.result}, uv2, ${g});
						vec3 n2 = perturbNormalArb(-vViewPosition, normal, grad2, faceDirection);
						
						bumpNormal = n0 * weights.z + n1 * weights.x + n2 * weights.y;
						bumpNormal = normalize(bumpNormal);
					}

					normal = bumpNormal;
					`:y=`
					vec2 bumpMapCachedUv = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs;
					vec2 grad = dHdxy(${v.result}, bumpMapCachedUv, ${g});
					normal = perturbNormalArb( - vViewPosition, normal, grad, faceDirection );
					`,f.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates
					${m.result};
					${y}
					`)}if(f.push(n.code,"	vec3 diffuseColor = "+n.result+";","	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );",a.code,"	float metalnessFactor = "+a.result+";"),this.roughnessMap){let v=this.roughnessMap.texture.flow(e,"t"),m=this.roughnessMap.flow(e,"v3"),g="";this.roughnessMap.projection.value===4?g=`
					float roughnessChange = 1.0;
					{
						vec2 uv0 = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs0;
						vec2 uv1 = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs1;
						vec2 uv2 = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs2;
						vec3 weights = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;

						float r0 = luminance(texture(${v.result}, uv0).rgb) * roughnessScale;
						float r1 = luminance(texture(${v.result}, uv1).rgb) * roughnessScale;
						float r2 = luminance(texture(${v.result}, uv2).rgb) * roughnessScale;

						roughnessChange = (r0 * weights.z + r1 * weights.x + r2 * weights.y);
					}
					float roughnessFactor = roughnessChange * ${s.result};
					`:g=`
					vec2 roughnessMapCachedUv = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs;

					vec4 vals = texture(${v.result},  roughnessMapCachedUv);
					float roughnessFactor = luminance(vals.rgb) * ${s.result};
					`,f.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates
					${m.result};

					const float roughnessScale = 1.0;

					${g}
				`)}else f.push(s.code,"	float roughnessFactor = "+s.result+";");u&&f.push(u.code,"#ifdef ALPHATEST","	if ( "+u.result+" <= ALPHATEST ) discard;","#endif"),f.push("vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );"),f.push("material.diffuseColor = diffuseColor * ( 1.0 - metalnessFactor );","material.roughness = max( roughnessFactor, 0.0525 );","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.roughness = clamp( roughnessFactor, 0.04, 1.0 );"),d?f.push(d.code,"material.specularColor = mix( vec3( 0.16 * pow2( "+d.result+" ) ), diffuseColor, metalnessFactor );"):f.push("material.specularColor = mix( vec3( 0.04 ), diffuseColor, metalnessFactor );"),f.push("#include <lights_fragment_begin>"),f.push("#include <lights_fragment_end>"),f.push("vec3 ao = aoEnabled && "+r.result+" ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse)) + reflectedLight.directSpecular + reflectedLight.indirectSpecular;");let p="1.0";this.mask&&(this.mask.analyze(e),p=`luminance(${this.mask.flow(e,"v3").result})`),f.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${o.result} * ${p} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${o.result} * ${p}, ${l.result} );
					
					outgoingLight *= ao;
				}
				`),c&&f.push(c.code,`outgoingLight = spe_blend(outgoingLight, ${c.result}, 1.0, SPE_BLENDING_NORMAL);`),u?f.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${u.result} );`):f.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),h&&f.push(`gl_FragColor.a *= ${h.result};`),f.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=f.join(`
`)}return t}},mIe=class extends jn{constructor(){super("toon"),this.nodeType="Toon",this.color=new rn(Bo),this.specular=new rn(1118481),this.shininess=new Dt(30),this.previousModelViewMatrix=new cu,this.previouseProjectionMatrix=new cu,this.shadingAlpha=new Dt(1),this.shadingBlend=new fr(0)}get category(){return"toon"}build(e){let t;if(e.define("TOON"),e.requires.lights=!0,e.extensions.derivatives=!0,e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:Kt.frameIndex}),e.mergeUniform({resolution:Kt.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(ay.merge([xt.fog,xt.lights])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <morphtarget_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let r=["#include <beginnormal_vertex>","#include <morphnormal_vertex>",`
				#include <skinbase_vertex>
				#include <skinnormal_vertex>
				#ifndef USE_LAYER_DISPLACE
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = objectNormal;

				#ifdef USE_LAYER_DISPLACE
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <begin_vertex>
				#endif
				`];i&&r.push(i.code,i.result?"displaced_position = "+i.result+";":""),r.push("transformed = displaced_position;","#include <morphtarget_vertex>","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),r.push("	#include <project_vertex>","	#include <fog_vertex>","	#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","	#include <worldpos_vertex>","	#include <shadowmap_vertex>","	#include <fog_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=r.join(`
`)}else{e.mergeUniform({penumbraSize:Kt.penumbraSize}),e.mergeUniform({frameIndex:Kt.frameIndex}),e.mergeUniform({aoMap:Kt.aoRenderTarget}),e.mergeUniform({aoEnabled:Kt.aoEnabled}),this.color===void 0&&(this.color=new rn(Bo)),this.color.analyze(e,{slot:"color"}),this.specular.analyze(e),this.shininess.analyze(e),this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e);let i=this.color.flow(e,"c",{slot:"color"}),r=this.specular.flow(e,"c"),n=this.shininess.flow(e,"f"),s=this.shadingAlpha.flow(e,"f"),a=this.shadingBlend.flow(e,"i"),o=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,l=this.alpha?this.alpha.flow(e,"f"):void 0,c=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0;e.requires.transparent=l!==void 0,e.addParsCode(["uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","varying vec3 vWPosition;","#include <normal_pars_fragment>","#include <gradientmap_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <dithering_pars_fragment>",`
					varying vec3 vViewPosition;
					struct ToonMaterial {
						vec3	diffuseColor;
						vec3	specularColor;
						float	specularShininess;
						float	specularStrength;
					};
					void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
						vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
			
						reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
						reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
					}
					void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
						reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
					}
					#define RE_Direct				RE_Direct_Toon
					#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
					#define Material_LightProbeLOD( material )	(0)
					`,"#include <shadowmap_pars_fragment>","#include <bumpmap_pars_fragment>","#include <normalmap_pars_fragment>"].join(`
`));let u=["#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx,viewdy));
				if (dot(normal, faceNormal) < 0.0) {
					normal *= -1.0;
				}
				`,"	ToonMaterial material;"];if(this.bumpMap){e.include(X0.dHdxy),e.include(X0.perturbNormalArb);let d=this.bumpMap.texture.flow(e,"t"),f=this.bumpMap.flow(e,"v3"),p=this.bumpMapIntensity?this.bumpMapIntensity.flow(e,"f").result:"1.0",v="";this.bumpMap.projection.value===4?v=`
					vec3 bumpNormal = vec3(0.0);
					{
						vec2 uv0 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs0;
						vec2 uv1 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs1;
						vec2 uv2 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs2;
						vec3 weights = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;

						vec2 grad0 = dHdxy(${d.result}, uv0, ${p});
						vec3 n0 = perturbNormalArb(-vViewPosition, normal, grad0, faceDirection);

						vec2 grad1 = dHdxy(${d.result}, uv1, ${p});
						vec3 n1 = perturbNormalArb(-vViewPosition, normal, grad1, faceDirection);

						vec2 grad2 = dHdxy(${d.result}, uv2, ${p});
						vec3 n2 = perturbNormalArb(-vViewPosition, normal, grad2, faceDirection);
						
						bumpNormal = n0 * weights.z + n1 * weights.x + n2 * weights.y;
						bumpNormal = normalize(bumpNormal);
					}

					normal = bumpNormal;
					`:v=`
					vec2 bumpMapCachedUv = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs;
					vec2 grad = dHdxy(${d.result}, bumpMapCachedUv, ${p});
					normal = perturbNormalArb( - vViewPosition, normal, grad, faceDirection );
					`,u.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates
					${f.result};
					${v}
					`)}u.push(i.code,"	vec3 diffuseColor = "+i.result+";","	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );",r.code,"	vec3 specular = "+r.result+";",n.code,"	float shininess = max( 0.0001, "+n.result+" );","	float specularStrength = 1.0;"),l&&u.push(l.code,"#ifdef ALPHATEST","if ( "+l.result+" <= ALPHATEST ) discard;","#endif"),u.push("material.diffuseColor = diffuseColor;"),u.push("material.specularColor = specular;","material.specularShininess = shininess;","material.specularStrength = specularStrength;","#include <lights_fragment_begin>","#include <lights_fragment_end>"),u.push("vec3 ao = aoEnabled ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse) * ao) + reflectedLight.directSpecular;");let h="1.0";this.mask&&(this.mask.analyze(e),h=`luminance(${this.mask.flow(e,"v3").result})`),u.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${s.result} * ${h} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${s.result} * ${h}, ${a.result} );
				}
				`),o&&u.push(o.code,`outgoingLight = spe_blend(outgoingLight, ${o.result}, 1.0, SPE_BLENDING_NORMAL);`),l?u.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${l.result} );`):u.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),c&&u.push(`gl_FragColor.a *= ${c.result};`),u.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=u.join(`
`)}return t}},gIe=class{constructor(e=1e3*10){this.timeout=e,this.cache=new Map,this.head={data:null,time:0,src:null,next:null,prev:null},this.tail={data:null,time:1/0,src:null,next:null,prev:null},this.hasClean=!1,this.head.next=this.tail,this.tail.prev=this.head}log(...e){}remove(e){let t=this.cache.get(e);t&&(this.dispose(e,t.data),this.cache.delete(e),t.prev.next=t.next,t.next.prev=t.prev)}scheduleCleanup(){this.hasClean||(this.log("scheduled cleanup"),this.hasClean=!0,setTimeout(()=>{this.hasClean=!1,this.log("cleaning");let e=Date.now(),t=this.head.next;for(;t.time<e-this.timeout;)this.dispose(t.src,t.data),this.cache.delete(t.src),t=t.next,t.prev=this.head,this.head.next=t;this.head.next!==this.tail?this.scheduleCleanup():this.log("no more cleanup")},this.timeout+1e3))}has(e){var t;return(t=this.cache.get(e))==null?void 0:t.data}load(e){let t=Date.now(),i=this.cache.get(e);return i===void 0?(i={data:this.create(e),src:e,time:t,next:null,prev:null},this.cache.set(e,i)):(i.time=t,i.prev.next=i.next,i.next.prev=i.prev),i.prev=this.tail.prev,i.next=this.tail,this.tail.prev.next=i,this.tail.prev=i,this.scheduleCleanup(),i.data}},vIe=class extends gIe{create(e){return URL.createObjectURL(new Blob([e]))}dispose(e,t){URL.revokeObjectURL(t)}},PR;function yIe(e){return typeof e=="string"?e:(PR||(PR=new vIe),PR.load(e))}var xIe=class{constructor(e,t){this.data=e,this.cache=t,this.refCount=0}deref(){this.refCount,this.refCount-=1,this.refCount===0&&(this.cache.remove(this),this.dispose())}dispose(){this.refCount}},wIe=class{constructor(){this.cache=new Map}remove(e){this.cache.delete(e.data)}load(e){let t=this.cache.get(e);return t===void 0&&(t=this.create(e),this.cache.set(e,t)),t.refCount+=1,t}},Xte=class extends xIe{constructor(e,t){super(e,t.imageHolderCache),this.data=e,this.shared=t,this.loaded=!1,this.isVideo=!1,this.isBuffer=!1,this._cache={1e3:{},1001:{},1002:{}},this.isVideo=e.type==="video",this.isBuffer=e.isWebGLRenderTarget===!0,this.loadPromise=this.updateSrc(this.isBuffer?e:e.data)}async updateSrc(e){if(typeof document>"u")return;this.disposeTextures(),this.loaded=!1;let t=()=>{this.loaded=!0;for(let r of Object.values(this._cache))for(let n of Object.values(r))for(let s of Object.values(n))s&&(s.image=this.img,s.needsUpdate=!0);this.shared.requestRender()};if(this.isBuffer)this.img=e,this.loaded=!0;else if(this.isVideo){if(this.img=document.createElement("video"),this.img.preload="auto",this.img.playsInline=!0,this.img.currentTime=.01,typeof e!="string"){var i=new FileReader;i.readAsDataURL(new Blob([e],{type:"video/mp4"}));let r;await new Promise(n=>{i.onloadend=s=>{var a;r=(a=s.target)==null?void 0:a.result,n(null)}}),this.img.src=r}else this.img.src=e;this.img.onloadeddata=()=>{t()}}else this.img=new Image,this.img.src=yIe(e),this.img.onload=t,await new Promise(r=>{this.img.onload=()=>{t(),r(null)}})}getTexture(e,t=1008,i=1006){var n,s;let r=(s=(n=this._cache[e])==null?void 0:n[t])==null?void 0:s[i];if(r)return r;{let a;return this.isBuffer?a=this.img.texture:this.isVideo?a=new Uxe(this.img,void 0,e,e):a=new jr(this.img,void 0,e,e,i,t),this.loaded&&(a.needsUpdate=!0),this._cache[e]===void 0&&(this._cache[e]={}),this._cache[e][t]===void 0&&(this._cache[e][t]={}),this._cache[e][t][i]=a,a}}setNeedsUpdate(e){for(let t of Object.values(this._cache))for(let i of Object.values(t))for(let r of Object.values(i))r&&(r.needsUpdate=e)}disposeTextures(){for(let[e,t]of Object.entries(this._cache))for(let[i,r]of Object.entries(t))for(let[n,s]of Object.entries(r))s==null||s.dispose(),this._cache[e]!==void 0&&this._cache[e][i]!==void 0&&(this._cache[e][i][n]=void 0)}dispose(){super.dispose(),this.disposeTextures()}},Ld=class extends Xte{};function bIe(e,t){var i=EIe(t);return i.formatToParts?SIe(i,e):MIe(i,e)}var _Ie={year:0,month:1,day:2,hour:3,minute:4,second:5};function SIe(e,t){try{for(var i=e.formatToParts(t),r=[],n=0;n<i.length;n++){var s=_Ie[i[n].type];s>=0&&(r[s]=parseInt(i[n].value,10))}return r}catch(a){if(a instanceof RangeError)return[NaN];throw a}}function MIe(e,t){var i=e.format(t).replace(/\u200E/g,""),r=/(\d+)\/(\d+)\/(\d+),? (\d+):(\d+):(\d+)/.exec(i);return[r[3],r[1],r[2],r[4],r[5],r[6]]}var DR={};function EIe(e){if(!DR[e]){var t=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:"America/New_York",year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(new Date("2014-06-25T04:00:00.123Z")),i=t==="06/25/2014, 00:00:00"||t==="06/25/2014 00:00:00";DR[e]=i?new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:e,year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):new Intl.DateTimeFormat("en-US",{hourCycle:"h23",timeZone:e,year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}return DR[e]}function qte(e,t,i,r,n,s,a){var o=new Date(0);return o.setUTCFullYear(e,t,i),o.setUTCHours(r,n,s,a),o}var UW=36e5,AIe=6e4,RR={timezone:/([Z+-].*)$/,timezoneZ:/^(Z)$/,timezoneHH:/^([+-]\d{2})$/,timezoneHHMM:/^([+-]\d{2}):?(\d{2})$/};function Yte(e,t,i){var r,n;if(!e||(r=RR.timezoneZ.exec(e),r))return 0;var s;if(r=RR.timezoneHH.exec(e),r)return s=parseInt(r[1],10),NW(s)?-(s*UW):NaN;if(r=RR.timezoneHHMM.exec(e),r){s=parseInt(r[1],10);var a=parseInt(r[2],10);return NW(s,a)?(n=Math.abs(s)*UW+a*AIe,s>0?-n:n):NaN}if(PIe(e)){t=new Date(t||Date.now());var o=i?t:TIe(t),l=fB(o,e),c=i?l:CIe(t,l,e);return-c}return NaN}function TIe(e){return qte(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds())}function fB(e,t){var i=bIe(e,t),r=qte(i[0],i[1]-1,i[2],i[3]%24,i[4],i[5],0).getTime(),n=e.getTime(),s=n%1e3;return n-=s>=0?s:1e3+s,r-n}function CIe(e,t,i){var r=e.getTime(),n=r-t,s=fB(new Date(n),i);if(t===s)return t;n-=s-t;var a=fB(new Date(n),i);return s===a?s:Math.max(s,a)}function NW(e,t){return-23<=e&&e<=23&&(t==null||0<=t&&t<=59)}var kW={};function PIe(e){if(kW[e])return!0;try{return new Intl.DateTimeFormat(void 0,{timeZone:e}),kW[e]=!0,!0}catch{return!1}}var DIe=Tf(Ame(),1),VW=Tf(Tme(),1),RIe=/(Z|[+-]\d{2}(?::?\d{2})?| UTC| [a-zA-Z]+\/[a-zA-Z_]+(?:\/[a-zA-Z_]+)?)$/,IIe=RIe,IR=36e5,GW=6e4,LIe=2,Ca={dateTimePattern:/^([0-9W+-]+)(T| )(.*)/,datePattern:/^([0-9W+-]+)(.*)/,plainTime:/:/,YY:/^(\d{2})$/,YYY:[/^([+-]\d{2})$/,/^([+-]\d{3})$/,/^([+-]\d{4})$/],YYYY:/^(\d{4})/,YYYYY:[/^([+-]\d{4})/,/^([+-]\d{5})/,/^([+-]\d{6})/],MM:/^-(\d{2})$/,DDD:/^-?(\d{3})$/,MMDD:/^-?(\d{2})-?(\d{2})$/,Www:/^-?W(\d{2})$/,WwwD:/^-?W(\d{2})-?(\d{1})$/,HH:/^(\d{2}([.,]\d*)?)$/,HHMM:/^(\d{2}):?(\d{2}([.,]\d*)?)$/,HHMMSS:/^(\d{2}):?(\d{2}):?(\d{2}([.,]\d*)?)$/,timeZone:IIe};function OIe(e,t){if(arguments.length<1)throw new TypeError("1 argument required, but only "+arguments.length+" present");if(e===null)return new Date(NaN);var i={},r=i.additionalDigits==null?LIe:(0,DIe.default)(i.additionalDigits);if(r!==2&&r!==1&&r!==0)throw new RangeError("additionalDigits must be 0, 1 or 2");if(e instanceof Date||typeof e=="object"&&Object.prototype.toString.call(e)==="[object Date]")return new Date(e.getTime());if(typeof e=="number"||Object.prototype.toString.call(e)==="[object Number]")return new Date(e);if(!(typeof e=="string"||Object.prototype.toString.call(e)==="[object String]"))return new Date(NaN);var n=zIe(e),s=BIe(n.date,r),a=s.year,o=s.restDateString,l=FIe(o,a);if(isNaN(l))return new Date(NaN);if(l){var c=l.getTime(),u=0,h;if(n.time&&(u=UIe(n.time),isNaN(u)))return new Date(NaN);if(n.timeZone||i.timeZone){if(h=Yte(n.timeZone||i.timeZone,new Date(c+u)),isNaN(h))return new Date(NaN)}else h=(0,VW.default)(new Date(c+u)),h=(0,VW.default)(new Date(c+u+h));return new Date(c+u+h)}else return new Date(NaN)}function zIe(e){var t={},i=Ca.dateTimePattern.exec(e),r;if(i?(t.date=i[1],r=i[3]):(i=Ca.datePattern.exec(e),i?(t.date=i[1],r=i[2]):(t.date=null,r=e)),r){var n=Ca.timeZone.exec(r);n?(t.time=r.replace(n[1],""),t.timeZone=n[1].trim()):t.time=r}return t}function BIe(e,t){var i=Ca.YYY[t],r=Ca.YYYYY[t],n;if(n=Ca.YYYY.exec(e)||r.exec(e),n){var s=n[1];return{year:parseInt(s,10),restDateString:e.slice(s.length)}}if(n=Ca.YY.exec(e)||i.exec(e),n){var a=n[1];return{year:parseInt(a,10)*100,restDateString:e.slice(a.length)}}return{year:null}}function FIe(e,t){if(t===null)return null;var i,r,n,s;if(e.length===0)return r=new Date(0),r.setUTCFullYear(t),r;if(i=Ca.MM.exec(e),i)return r=new Date(0),n=parseInt(i[1],10)-1,jW(t,n)?(r.setUTCFullYear(t,n),r):new Date(NaN);if(i=Ca.DDD.exec(e),i){r=new Date(0);var a=parseInt(i[1],10);return VIe(t,a)?(r.setUTCFullYear(t,0,a),r):new Date(NaN)}if(i=Ca.MMDD.exec(e),i){r=new Date(0),n=parseInt(i[1],10)-1;var o=parseInt(i[2],10);return jW(t,n,o)?(r.setUTCFullYear(t,n,o),r):new Date(NaN)}if(i=Ca.Www.exec(e),i)return s=parseInt(i[1],10)-1,WW(t,s)?HW(t,s):new Date(NaN);if(i=Ca.WwwD.exec(e),i){s=parseInt(i[1],10)-1;var l=parseInt(i[2],10)-1;return WW(t,s,l)?HW(t,s,l):new Date(NaN)}return null}function UIe(e){var t,i,r;if(t=Ca.HH.exec(e),t)return i=parseFloat(t[1].replace(",",".")),LR(i)?i%24*IR:NaN;if(t=Ca.HHMM.exec(e),t)return i=parseInt(t[1],10),r=parseFloat(t[2].replace(",",".")),LR(i,r)?i%24*IR+r*GW:NaN;if(t=Ca.HHMMSS.exec(e),t){i=parseInt(t[1],10),r=parseInt(t[2],10);var n=parseFloat(t[3].replace(",","."));return LR(i,r,n)?i%24*IR+r*GW+n*1e3:NaN}return null}function HW(e,t,i){t=t||0,i=i||0;var r=new Date(0);r.setUTCFullYear(e,0,4);var n=r.getUTCDay()||7,s=t*7+i+1-n;return r.setUTCDate(r.getUTCDate()+s),r}var NIe=[31,28,31,30,31,30,31,31,30,31,30,31],kIe=[31,29,31,30,31,30,31,31,30,31,30,31];function Qte(e){return e%400===0||e%4===0&&e%100!==0}function jW(e,t,i){if(t<0||t>11)return!1;if(i!=null){if(i<1)return!1;var r=Qte(e);if(r&&i>kIe[t]||!r&&i>NIe[t])return!1}return!0}function VIe(e,t){if(t<1)return!1;var i=Qte(e);return!(i&&t>366||!i&&t>365)}function WW(e,t,i){return!(t<0||t>52||i!=null&&(i<0||i>6))}function LR(e,t,i){return!(e!=null&&(e<0||e>=25)||t!=null&&(t<0||t>=60)||i!=null&&(i<0||i>=60))}function GIe(e,t,i){var r=OIe(e,i),n=Yte(t,r,!0),s=new Date(r.getTime()-n),a=new Date(0);return a.setFullYear(s.getUTCFullYear(),s.getUTCMonth(),s.getUTCDate()),a.setHours(s.getUTCHours(),s.getUTCMinutes(),s.getUTCSeconds(),s.getUTCMilliseconds()),a}function Ra(e,t){return t.color(e)}function XW(e=new Date,t){let i=t.format,r=e.getSeconds(),n=e;t&&t.timeZone!==null&&(n=GIe(new Date,t.timeZone));let s=n.getHours(),a=n.getMinutes(),o;t.format12h24h==="12ampm"&&(o=s>=12?"PM":"AM");let l=s;t.format12h24h!=="24"&&(l=s%12,l===0&&(l=12));let c,u;switch(i){case"HH:mm:ss":c=[l,a,r];break;case"HH:mm":c=[l,a];break;case"HH":c=[l],o=void 0;break;case"mm":c=[a],o=void 0;break;case"ss":c=[r],o=void 0;break;case"year":u=n.getFullYear();break;case"month":u=n.getMonth()+1;break;case"dayOfYear":u=Math.floor((n.getTime()-new Date(n.getFullYear(),0,0).getTime())/864e5);break;case"dayOfMonth":u=n.getDate();break;case"secondOfDay":u=s*60*60+a*60+r;break;default:console.error("Unknown time format",i),u=0;break}return c!==void 0?{textValue:c,suffix:o}:u}function HIe(e,t){switch(e.type){case"fresnel":return XIe(e,t);case"gradient":return qIe(e,t);case"depth":return YIe(e,t);case"normal":return QIe(e,t);case"noise":return ZIe(e,t);case"rainbow":return KIe(e,t);case"toon":return JIe(e,t);case"outline":return $Ie(e,t);case"transmission":return eLe(e,t);case"color":return WIe(e,t);case"pattern":return tLe(e,t)}}function jIe(e){return{type:e.type}}function hc(e,t){let{alpha:i,mode:r,isMask:n}=e,s=typeof i=="string"?(Number(t.getVariable(i))??100)/100:i;return{...jIe(e),alpha:s,mode:r,isMask:n}}function WIe(e,t){return{...hc(e,t),color:Ra(e.color,t)}}function XIe(e,t){let{bias:i,scale:r,intensity:n,factor:s,color:a}=e;return{...hc(e,t),color:Ra(a,t),bias:i,scale:r,intensity:n,factor:s}}function qIe(e,t){let{gradientType:i,smooth:r,colors:n,steps:s,angle:a,offset:o,morph:l}=e;return{...hc(e,t),gradientType:i,smooth:r,colors:n.map(c=>new ai(c[0],c[1],c[2],c[3])),num:n.length,steps:s,offset:new Me(...o),morph:new Me(...l),angle:a}}function YIe(e,t){let{gradientType:i,near:r,far:n,isVector:s,isWorldSpace:a,origin:o,direction:l,colors:c,steps:u,smooth:h}=e;return{...hc(e,t),gradientType:i,near:r,far:n,isVector:s,isWorldSpace:a,origin:new N(...o),direction:l?new N(...l):new N(1,0,0),colors:c.map(d=>d!==void 0?new ai(d[0],d[1],d[2],d[3]):new ai(0,0,0,0)),steps:u.slice(0,c.length),smooth:h}}function QIe(e,t){let{cnormal:i}=e;return{...hc(e,t),cnormal:new N(i[0],i[1],i[2])}}function ZIe(e,t){return{...hc(e,t),scale:e.scale,move:e.move,fA:new Me(...e.fA),fB:new Me(...e.fB),size:new N(...e.size),distortion:new Me(...e.distortion),colorA:Ra(e.colorA,t),colorB:Ra(e.colorB,t),colorC:Ra(e.colorC,t),colorD:Ra(e.colorD,t),noiseType:e.noiseType,voronoiStyle:e.voronoiStyle,highCut:e.highCut,lowCut:e.lowCut,smoothness:e.smoothness,seed:e.seed,quality:e.quality}}function KIe(e,t){return{...hc(e,t),filmThickness:e.filmThickness,movement:e.movement,wavelengths:new N(...e.wavelengths),noiseStrength:e.noiseStrength,noiseScale:e.noiseScale,offset:new N(...e.offset)}}function JIe(e,t){return{...hc(e,t),positioning:e.positioning,colors:e.colors.map(i=>new ai(i[0],i[1],i[2],i[3])),num:e.colors.length,steps:e.steps,source:new N(...e.source),isWorldSpace:e.isWorldSpace,noiseStrength:e.noiseStrength,noiseScale:e.noiseScale,shadowColor:Ra(e.shadowColor,t),offset:new N(...e.offset)}}function $Ie(e,t){return{...hc(e,t),outlineColor:Ra(e.outlineColor,t),contourColor:Ra(e.contourColor,t),outlineWidth:e.outlineWidth,contourWidth:e.contourWidth,outlineThreshold:e.outlineThreshold,contourThreshold:e.contourThreshold,outlineSmoothing:e.outlineSmoothing,contourFrequency:e.contourFrequency,contourDirection:new N(...e.contourDirection),positionalLines:e.positionalLines,compensation:e.compensation}}function eLe(e,t){return{...hc(e,t),thickness:e.thickness,ior:e.ior,roughness:e.roughness}}function tLe(e,t){return{...hc(e,t),style:e.style,projection:e.projection,axis:e.axis,blending:e.blending,offset:new Me(...e.offset),colorA:Ra(e.colorA,t),colorB:Ra(e.colorB,t),frequency:new Me(...e.frequency),size:e.size,variation:e.variation,smoothness:e.smoothness,zigzag:e.zigzag,rotation:e.rotation,vertical:new Me(...e.vertical),horizontal:new Me(...e.horizontal),sides:e.sides}}var ZA=class extends Bs{},iLe={noise:["noiseType"],texture:["projection","axis","side"],video:["projection","axis","side"],displace:["noiseType"],light:["roughnessMap","bumpMap"],depth:["smooth","isWorldSpace","gradientType","isVector"],pattern:["style","projection","axis"]},rLe={depth:["colors"]};function nLe(e,t,i){var s,a;if(t==="isMask")return!0;let r=iLe[e.type],n=rLe[e.type];if(n!==void 0){let o=e.color;if(n.includes(t)){let l=(a=(s=o[t])==null?void 0:s.value)==null?void 0:a.length;if(l!==void 0&&l!==i.length)return!0}}return r!==void 0?r.includes(t):!1}function Zte(e,t,i){let r=i.uniforms[`f${i.id}_texture`];if(!r)return!1;let n=!1,s=e;if("image"in s){let a=s.image,o=t.image(a),l=r;l.image instanceof Ld||l.image.deref(),l.image=o}if("video"in s){let a=s.video,o=t.video(a),l=r;l.image instanceof Ld||l.image.deref(),l.image=o}if("wrapping"in s){let a=r;a.wrap=s.wrapping}if("minFilter"in s){let a=r;a.minFilter=s.minFilter}if("magFilter"in s){let a=r;a.magFilter=s.magFilter}if("rotation"in s&&i.uniforms[`f${i.id}_rotation`])return i.uniforms[`f${i.id}_rotation`].value=(s.rotation??0)*Tt.DEG2RAD,n;if("repeat"in s||"offset"in s||"rotation"in s){let a="mat",o=i.uniforms[`f${i.id}_${a}`];"repeat"in s&&(o.repeat=s.repeat),"offset"in s&&(o.offset=s.offset),"rotation"in s&&(o.rotation=s.rotation??0),o.updateMatrix()}return n}function sLe(e,t,i,r){let n=!1;for(let[s,a]of Object.entries(e)){if(s==="bumpMap"||s==="roughnessMap"){n=!0;continue}if(!s||a===void 0)continue;if(Jte(s,i,r,t)){s==="visible"&&i.type==="light"&&(n=!0);continue}i.visible=r.visible;let o=i.uniforms[`f${i.id}_${s}`];if(o&&!(o instanceof KN))switch(n=n||nLe(i,s,a),o.constructor){case rn:if(typeof a=="string"){let l=t.getColor(a);l&&(o.value=l);break}else{let l=a;o.value instanceof ZA?o.value=new Bs(l.r,l.g,l.b,l.a):o.setRGBA(l);break}case Yu:if(typeof a=="string"){let l=t.getColor(a);l&&(o.value=l);break}else{let l=a;o.value instanceof ZA?o.value=new Bs(l.r,l.g,l.b,l.a):o.value.setRGBA(l.r,l.g,l.b,l.a);break}case Cs:{let l=a;o.value.setX(l[0]),o.value.setY(l[1]);break}case nl:{let l=a;o.value.setX(l[0]),o.value.setY(l[1]),o.value.setZ(l[2]);break}case ih:{Zte(a,t,i);break}case Tp:{o.value=a.map(l=>new ai(...l));break}default:{o.value=a;break}}}return n}var Cm=(e,t,i)=>Math.max(0,Math.min(1,Number(t.getVariable(typeof e=="number"?e*100:e,i)??100)/100))??1,Fb=class{constructor(e,t,i,r,n){this.id=e,this.uuid=t,this.data=i,this.uniforms={};for(let s in r)this.uniforms[`f${this.id}_${s}`]=r[s];for(let s in i)Jte(s,this,i,n)}get type(){return this.data.type}static create(e,t,i,r){if(i.type==="light")return Bc.createLightLayer(e,t,i,r);if(i.type==="texture"||i.type==="video"){let n=i.type==="texture"?r.uiBuffer(i.texture.image)??r.image(i.texture.image):r.video(i.texture.video),s=new uB(n,i.texture.wrapping,i.texture.minFilter??1008,i.texture.magFilter??1006),a=new oIe(n),o=new lIe(i.texture.repeat,i.texture.offset,i.texture.rotation??0),l=new Dt(i.crop?1:0),c=new fr(i.projection??0),u=new fr(["x","y","z"].indexOf(i.axis)??0),h=new fr(i.side??0),d=new Cs(i.size?new Me(i.size[0],i.size[1]):new Me(100,100)),f=new Dt(i.blending??0),p=new Dt(Cm(i.alpha,r)),v=new fr(i.mode??0),m=new Ta(i.isMask??!1),g=new JN(s,a,l,c,u,h,d,f,o,p,v,m),y=new br(g.calpha,"f");return new Kr(e,t,i,{texture:s,textureSize:a,crop:l,projection:c,axis:u,side:h,size:d,blending:f,mat:o,alpha:p,mode:v,isMask:m},g,v,y,m,r)}else if(i.type==="matcap"){let n=r.image(i.texture.image),s=new uB(n,i.texture.wrapping,i.texture.minFilter??1008,i.texture.magFilter??1006),a=new Dt(Cm(i.alpha,r)),o=new fr(i.mode??0),l=new Ta(i.isMask??!1),c=new Dt((i.texture.rotation??0)*Tt.DEG2RAD),u=new Ite(s,a,o,l,c),h=new br(u.calpha,"f");return new Kr(e,t,i,{texture:s,alpha:a,mode:o,isMask:l,rotation:c},u,o,h,l,r)}else if(i.type==="displace")if(i.displacementType==="noise"){let n=new nl(new N(...i.offset)),s=new Dt(i.scale??10),a=new Dt(i.intensity??8),o=new Dt(i.movement??1),l=new fr(i.noiseType??0),c=new fr(i.voronoiStyle??0),u=new Dt(i.smoothness??.5),h=new Dt(i.seed??0),d=new Dt(i.highCut??1),f=new Dt(i.lowCut??0),p=new fr(i.quality??1),v=new jte(a,o,n,c,u,h,d,f,p,s,l);return new Kte(e,t,i,{offset:n,scale:s,intensity:a,movement:o,noiseType:l,voronoiStyle:c,smoothness:u,seed:h,highCut:d,lowCut:f,quality:p},v,r)}else throw new Error;else return lLe(e,t,i,r)}updateByOp(e,t,i){let r=e;if(r.path[0]===void 0){if(r.type===0)return"type"in r.props||"category"in r.props||"visible"in r.props||"noiseType"in r.props?(i.scene.markNeedsUpdateRendererDirty(),!0):sLe(r.props,i.shared,this,t)}else if(r.path[0]==="texture")return"texture"in t||"video"in t?Zte(r.props,i.shared,this):!0;return!1}dispose(){if(aLe(this)){let e=this.uniforms[`f${this.id}_texture`];if(!e)return!1;let t=e;t.image instanceof Ld||t.image.deref()}}hasValueByKey(e){return this.uniforms[e]!==void 0}hasValue(e){return this.hasValueByKey(`f${this.id}_${e}`)}setValue(e,t){let i=`f${this.id}_${e}`;this.hasValueByKey(i)&&t!==void 0&&(this.uniforms[i].value=t)}getNode(e){let t=`f${this.id}_${e}`;if(this.hasValueByKey(t))return this.uniforms[t]}getValue(e){let t=`f${this.id}_${e}`;if(this.hasValueByKey(t))return this.uniforms[t].value}getName(e){let t=/f\d+_(.*)/.exec(e);if(t&&t.length>1)return t[1];console.log(`Layer.getName: error ${e}`)}getNames(){let e=[];for(let t in this.uniforms){let i=this.getName(t);i&&e.push(i)}return e}},Kr=class extends Fb{constructor(e,t,i,r,n,s,a,o,l){super(e,t,i,r,l),this.params=r,this.color=n,this.mode=s,this.alpha=a,this.isMask=o}},Kte=class extends Fb{constructor(e,t,i,r,n,s){super(e,t,i,r,s),this.position=n}},Bc=class extends Fb{constructor(e,t,i,r,n,s){super(e,t,i,n,s),this.node=r}static createLightLayer(e,t,i,r){let n,s=new Dt(Cm(i.alpha,r)),a=new fr(i.mode),o=new Dt(i.bumpMapIntensity),l=new Dt(Cm(i.alphaOverride,r)),c;if(!i.visible)n=new $N,c={};else if(i.category==="lambert"){n=new dIe;let u=new rn(r.color(i.emissive)??0),h=new Ta(i.occlusion??!0);c={emissive:u,occlusion:h},n.emissive=u,n.occlusion=h}else if(i.category==="toon"){n=new mIe;let u=new Dt(i.shininess??30),h=new rn(r.color(i.specular)??1118481);c={shininess:u,specular:h},n.shininess=u,n.specular=h}else if(i.category==="physical"){n=new pIe;let u=new Dt(i.roughness??.3),h=new Dt(i.metalness??0),d=new Dt(i.reflectivity??.5),f=new Ta(i.occlusion??!0);c={roughness:u,metalness:h,reflectivity:d,occlusion:f},n.roughness=u,n.metalness=h,n.reflectivity=d,n.occlusion=f}else{n=new fIe;let u=new Dt(i.shininess??30),h=new rn(i.specular!==void 0?r.color(i.specular)??1118481:1118481),d=new Ta(i.occlusion??!0);c={shininess:u,specular:h,occlusion:d},n.shininess=u,n.specular=h,n.occlusion=d}return n.alpha=new Dt(1),n.shadingAlpha=s,n.shadingBlend=a,n.bumpMapIntensity=o,n.alphaOverride=l,c.alpha=n.shadingAlpha,c.mode=n.shadingBlend,c.bumpMapIntensity=n.bumpMapIntensity,c.alphaOverride=n.alphaOverride,new Bc(e,t,i,n,c,r)}get category(){return this.node.category}};function aLe(e){let t=e instanceof Fb?e.type:e;return t==="texture"||t==="video"||t==="displace_map"||t==="matcap"}function Jo(e){return{alpha:new Dt(e.alpha??1),mode:new fr(e.mode??0),isMask:new Ta(e.isMask??!1)}}function oLe(e,t,i,r,n){switch(e.type){case"color":{let s=new rn(r.color??Bo),a=Jo(r),o=new hB(s,a.alpha),l=new br(o.calpha,"f");return new Kr(t,i,e,{color:s,...a},o,a.mode,l,a.isMask,n)}case"fresnel":{let s=new rn(r.color??16777215),a=new Dt(r.bias??.1),o=new Dt(r.scale??1),l=new Dt(r.intensity??2),c=new Dt(r.factor??1),u=Jo(r),h=new cIe(s,a,o,l,c,u.alpha,u.mode,u.isMask),d=new br(h.calpha,"f");return new Kr(t,i,e,{color:s,bias:a,scale:o,intensity:l,factor:c,...u},h,u.mode,d,u.isMask,n)}case"rainbow":{let s=new Dt(r.filmThickness??30),a=new Dt(r.movement??0),o=new nl(r.wavelengths??new N(0,0,0)),l=new Dt(r.noiseStrength??0),c=new Dt(r.noiseScale??1),u=new nl(r.offset??new N(0,0,0)),h=Jo(r),d=new Ute(s,a,o,l,c,u,h.alpha,h.isMask),f=new br(d.calpha,"f");return new Kr(t,i,e,{filmThickness:s,movement:a,wavelengths:o,noiseStrength:l,noiseScale:c,offset:u,...h},d,h.mode,f,h.isMask,n)}case"transmission":{let s=new Dt(r.thickness??10),a=new Dt(r.ior??1.5),o=new Dt(r.roughness??.5),l=Kt.transmissionSize,c=Kt.transmissionRenderTarget,u=Kt.transmissionRenderTargetDepth,h=window.innerWidth,d=window.innerHeight,f=h>=d?new Cs(d/h,1):new Cs(1,h/d),p=Jo(r),v=new Gte(s,a,o,l,c,u,f,p.alpha),m=new br(v.calpha,"f");return new Kr(t,i,e,{thickness:s,ior:a,roughness:o,aspectRatio:f,...p},v,p.mode,m,p.isMask,n)}case"toon":{let s=new fr(r.positioning??0),a;r.colors?a=new Tp(r.colors.length,r.colors):(a=new Tp(10,new ai(0,0,0,1)),a.value[1]=new ai(1,1,1,1));let o;r.steps?o=new Ap(r.steps.length,r.steps):(o=new Ap(10,1),o.value[0]=0);let l=new nl(r.source??new N(0,0,0)),c=new Ta(r.isWorldSpace??!0),u=new Dt(r.noiseStrength??0),h=new Dt(r.noiseScale??1),d=new Yu(r.shadowColor),f=new nl(r.offset??new N(0,0,0)),p=Jo(r),v=new kte(s,a,o,l,c,u,h,d,f,p.alpha),m=new br(v.calpha,"f");return new Kr(t,i,e,{positioning:s,colors:a,steps:o,source:l,isWorldSpace:c,noiseStrength:u,noiseScale:h,shadowColor:d,offset:f,...p},v,p.mode,m,p.isMask,n)}case"outline":{let s=new rn(r.outlineColor??16777215),a=new rn(r.contourColor??16777215),o=new Dt(r.outlineWidth??.1),l=new Dt(r.contourWidth??.1),c=new Dt(r.outlineThreshold??.1),u=new Dt(r.contourThreshold??.1),h=new Dt(r.outlineSmoothing??.1),d=new Dt(r.contourFrequency??.1),f=new nl(r.contourDirection??new N(0,1,0)),p=new Ta(r.positionalLines??!1),v=new Ta(r.compensation??!0),m=Kt.normalRenderTarget,g=Kt.normalRenderTargetDepth,y=Kt.pixelRatioNode,x=Kt.resolution,_=Jo(r),M=new zte(s,a,o,l,c,u,h,d,f,p,v,x,m,g,y,_.alpha),S=new br(M.calpha,"f");return new Kr(t,i,e,{outlineColor:s,contourColor:a,outlineWidth:o,contourWidth:l,outlineThreshold:c,contourThreshold:u,outlineSmoothing:h,contourFrequency:d,contourDirection:f,positionalLines:p,compensation:v,..._},M,_.mode,S,_.isMask,n)}case"depth":{let s=new fr(r.gradientType??0),a=new Ta(r.smooth??!1),o=new Dt(r.near??50),l=new Dt(r.far??200),c=new Dt(r.isVector??1),u=new Dt(r.isWorldSpace??0),h=new nl(r.origin??new N),d=new nl(r.direction??new N),f;r.colors?f=new Tp(r.colors.length,r.colors):(f=new Tp(2,new ai(0,0,0,1)),f.value[1]=new ai(1,1,1,1));let p;r.steps?p=new Ap(r.steps.length,r.steps):(p=new Ap(2,1),p.value[0]=0);let v=Jo(r),m=new Cte(s,a,o,l,c,u,h,d,f,p,v.alpha,v.isMask),g=new br(m.calpha,"f");return new Kr(t,i,e,{gradientType:s,smooth:a,near:o,far:l,isVector:c,isWorldSpace:u,origin:h,direction:d,colors:f,steps:p,...v},m,v.mode,g,v.isMask,n)}case"noise":{let s=new Dt(r.scale??1),a=new nl(r.size??new N(100,100,100)),o=new Dt(r.move??1),l=new Cs(r.fA??new Me(1.7,9.2)),c=new Cs(r.fB??new Me(8.3,2.8)),u=new Cs(r.distortion??new Me(1,1)),h=new Yu(r.colorA),d=new Yu(r.colorB),f=new Yu(r.colorC),p=new Yu(r.colorD),v=new fr(r.noiseType??0),m=new fr(r.voronoiStyle??0),g=new Dt(r.highCut??1),y=new Dt(r.lowCut??0),x=new Dt(r.smoothness??.5),_=new Dt(r.seed??.5),M=new fr(r.quality??1),S=Jo(r),T=new Lte(s,a,o,l,c,u,h,d,f,p,S.alpha,v,S.isMask,m,g,y,x,_,M),E=new br(T.calpha,"f");return new Kr(t,i,e,{scale:s,size:a,move:o,fA:l,fB:c,distortion:u,colorA:h,colorB:d,colorC:f,colorD:p,noiseType:v,...S,voronoiStyle:m,highCut:g,lowCut:y,smoothness:x,seed:_,quality:M},T,S.mode,E,S.isMask,n)}case"normal":{let s=new nl(r.cnormal??new N(1,1,1)),a=Jo(r),o=new Tte(s,a.alpha),l=new br(o.calpha,"f");return new Kr(t,i,e,{cnormal:s,...a},o,a.mode,l,a.isMask,n)}case"gradient":{let s=new fr(r.gradientType??0),a=new Ta(r.smooth??!1),o;r.colors?o=new Tp(r.colors.length,r.colors):(o=new Tp(10,new ai(0,0,0,1)),o.value[1]=new ai(1,1,1,1));let l;r.steps?l=new Ap(r.steps.length,r.steps):(l=new Ap(10,1),l.value[0]=0);let c=new Cs(r.offset??new Me(0,0)),u=new Cs(r.morph??new Me(0,0)),h=new Dt(r.angle??0),d=Jo(r),f=new Dte(s,a,o,l,c,u,h,d.alpha,d.isMask),p=new br(f.calpha,"f");return new Kr(t,i,e,{gradientType:s,smooth:a,colors:o,steps:l,offset:c,morph:u,angle:h,...d},f,d.mode,p,d.isMask,n)}case"pattern":{let s=new fr(r.style??0),a=new fr(r.projection??0),o=new fr(["x","y","z"].indexOf(r.axis)??0),l=new Dt(r.blending??0),c=new Cs(r.offset??new Me(0,0)),u=new Yu(r.colorA),h=new Yu(r.colorB),d=new Cs(r.frequency??new Me(10,10)),f=new Dt(r.size??.5),p=new Dt(r.variation??0),v=new Dt(r.smoothness??.5),m=new Dt(r.zigzag??0),g=new Dt(r.rotation??0),y=new Cs(r.vertical??new Me(0,1)),x=new Cs(r.horizontal??new Me(0,1)),_=new fr(r.sides??6),M=Jo(r),S=new Bte(s,a,o,l,c,u,h,d,f,p,v,m,g,y,x,_,M.alpha,M.isMask),T=new br(S.calpha,"f");return new Kr(t,i,e,{style:s,projection:a,axis:o,blending:l,offset:c,colorA:u,colorB:h,frequency:d,size:f,variation:p,smoothness:v,zigzag:m,rotation:g,vertical:y,horizontal:x,sides:_,...M},S,M.mode,T,M.isMask,n)}default:{let s=new rn(1,0,0,1),a=Jo(r),o=new hB(s,a.alpha),l=new br(o.calpha,"f");return new Kr(t,i,e,{color:s,...a},o,a.mode,l,a.isMask,n)}}}function lLe(e,t,i,r){let n=HIe(i,r);return oLe(i,e,t,n,r)}function Jte(e,t,i,r){if(i.type==="displace"&&(e==="intensity"||e==="visible")){let n=t.uniforms[`f${t.id}_intensity`];return n?(n.value=i.intensity*(i.visible?1:0),n):void 0}if(i.type!=="displace"&&(e==="alpha"||e==="visible")){let n=t.uniforms[`f${t.id}_alpha`];if(!n)return;if(n.value=Cm(i.alpha,r)*(i.visible?1:0),i.type==="outline"&&e==="visible"){let s=t.uniforms[`f${t.id}_compensation`];s&&(s.value=i.compensation&&i.visible)}return n}}function qv(e,t){let i=0,r=e.layers.find(n=>n.data.type==="light");if(r){let n=r.data,s=Number(t.getVariable(n.alphaOverride));if((typeof n.alphaOverride=="string"?s/100:n.alphaOverride)<1)return!0}for(let n of e.layers){if(n.data.type!=="displace"&&n.data.isMask)return!0;if(n.data.type!=="displace"&&"alpha"in n.data&&n.data.type!=="light"&&n.data.type!=="fresnel"&&n.data.type!=="texture"&&n.data.type!=="matcap"&&n.data.type!=="rainbow"&&n.data.type!=="outline"&&n.data.type!=="pattern"){let s=n.data.visible?n.data.alpha:0;if(typeof s=="string"&&(s=Math.max(0,Math.min(1,Number(t.getVariable(s)??100)/100))),s===1&&n.data.type==="depth"||n.data.type==="gradient"){for(let a of n.data.colors)if(a[3]<1){s=a[3];break}}else if(s===1&&n.data.type==="noise"){let a=t.color(n.data.colorA).a,o=t.color(n.data.colorB).a,l=t.color(n.data.colorC).a,c=t.color(n.data.colorD).a,u=Math.min(a,Math.min(o,Math.min(l,c)));u<1&&(s=u)}i+=(1-i)*s}}return i<1}var yf=class extends ki{constructor(){super(void 0),this.flatShading=!1,this.needsJitter=!0,this.shadersPatchedForShapeBlend=!1,this.nodeContextUuid=0,this.fog=!0,this.dithering=!0,this.vertexColors=!0,this.transparent=!0}customProgramCacheKey(){return""}},cLe=class extends yf{constructor(e,t,i,r){super(),this.flatShading=e,this.side=t,this.wireframe=i,this.root=r}updateAfterBuild(){let e=this.root;this.lights=e.lights,this.vertexShader=e.vertexShader,this.fragmentShader=e.fragmentShader,Object.assign(this.defines,e.defines),Object.assign(this.uniforms,e.uniforms),this.extensions=e.extensions,this.transparent=e.transparent,this.cacheKey=e.customProgramCacheKey()+"flat"+this.flatShading+this.side}onBeforeCompile(e,t){this.root.onBeforeCompile(e)}get data(){return this.root.data}get category(){return this.root.category}get hasAO(){return this.root.hasAO}getFlavor(e,t,i,r){return this.root.getFlavor(e,t,i,r)}get layers(){return this.root.layers}get fragment(){return this.root.fragment}getLayersOfType(e){return this.root.getLayersOfType(e)}getLayerByUuid(e){return this.root.getLayerByUuid(e)}updateByOp(e,t,i){this.root.updateByOp(e,t,i)}nodeMaterialDispose(){this.root.nodeMaterialDispose()}},e4=class extends yf{constructor(e,t,i=!0){super(),this.data=e,this.allowVariableSaves=i,this.layerIdGen=0,this.flavors=[],this.masks={},this.type="NodeMaterial",this.updaters=[],this.needsJitter=t.shared.needsJitter,jn.startContext(this),this.reset0(e,t),jn.endContext(this)}get nodeMaterial(){return this}getFlavor(e,t,i,r){let n=i?6:(e?3:0)+t;if(n+=(((r==null?void 0:r.resolutionLevel)??0)-(r!=null&&r.useChildrenColors?4:0))*7,n===0)return this;this.flavors===void 0&&(this.flavors=[]),n-=1;let s=this.flavors[n];return s===void 0&&(s=new cLe(e,t,i,this),s.needsJitter=this.needsJitter,this.flavors[n]=s,s.flatShading=e,s.side=t,s.updateAfterBuild(),r&&(s.defines.SHAPEBLEND=r.resolutionLevel,s.defines.SHAPEBLEND_C=r.useChildrenColors?1:0)),s}get fragment(){return this.lightLayer.node}get category(){return this.lightLayer.category}get hasAO(){var e;return((e=this.lightLayer.getNode("occlusion"))==null?void 0:e.value)??!1}reset(e,t,i=!1){jn.startContext(this),(this.data!==e||i)&&this.reset0(e,t),jn.endContext(this)}reset0(e,t){this.data=e;let i=e.layers??ps.defaultTwoLayerData("phong").layers;try{this.layers=i.map(r=>Fb.create(this.layerIdGen++,r.id,r.data,t.shared))}catch{this.layers=[]}this.layers.reverse(),this.name=e.name??"Untitled Material",this.onUpdate(t.shared),this.transparent=qv(e,t.shared),this.saveVariableLocations(t)}onVariableUpdate(e,t,i){if(e[0]==="alphaOverride")this.transparent=qv(this.data,i.shared),this.lightLayer.setValue("alphaOverride",Math.max(0,Math.min(Number(t)/100,1)));else if(e[0]==="layer"){let r=e[1],n=e[2];if(r&&n){let s=this.layers.find(a=>a.uuid===r);s!=null&&s.hasValue(n)&&(n==="alpha"?(this.transparent=qv(this.data,i.shared),s.setValue(n,Math.max(0,Math.min(Number(t)/100,1)))):s.setValue(n,t))}}}saveVariableLocations(e){if(!this.allowVariableSaves)return;let t=this.data.layers.find(i=>i.data.type==="light");t&&e.shared.getVariable(t.data.alphaOverride,["material",this.uuid,"alphaOverride"]),this.data.layers.forEach(i=>{"alpha"in i.data&&typeof i.data.alpha=="string"&&e.shared.getVariable(i.data.alpha,["material",this.uuid,"layer",i.id,"alpha"])})}getLayersOfType(e){return this.layers.filter(t=>t.type===e)}getLayerByUuid(e){return this.layers.find(t=>t.uuid===e)}onUpdate(e){this.lightLayer=this.layers.find(t=>t instanceof Bc),this.lightLayer===void 0&&(this.lightLayer=new Bc(0,"",{...cs.defaultData("light","phong"),visible:!1},new $N,{},e)),this.dispose();for(let t of this.flavors)t&&t.dispose();this.applyTextureMaps(),this.applyMasks(),this.blendColors(),this.blendAfterColors(),this.blendPositions(),this.build(),this.nodeContextUuid=0}applyTextureMaps(){let e=this.layers.find(n=>n instanceof Bc);if(!e)return;let t=e.data,i=t.bumpMap,r=t.roughnessMap;e.node.bumpMap=void 0,e.node.roughnessMap=void 0;for(let n=0;n<this.layers.length;++n){let s=this.layers[n];s instanceof Kr&&s.color instanceof JN&&(s.uuid===i&&(e.node.bumpMap=s.color),s.uuid===r&&(e.node.roughnessMap=s.color))}}updateByOp(e,t,i){if(jn.startContext(this),t!==void 0?this.data=t:t=this.data,this.transparent=qv(t,i.shared),e.path[0]==="layers"){let r=i.shared,n=e.path[1];if(n===void 0)i.scene.markNeedsUpdateRendererDirty(),this.reset0(t,i);else{e.type===0&&e.props.occlusion!==void 0&&i.scene.markNeedsUpdateRendererDirty();let s=this.layers.find(a=>a.uuid===n);if(s){let a=t.layers.data(n),o;e.type===0&&("alpha"in e.props||"alphaOverride"in e.props)&&("alpha"in e.props?o={...e.props,alpha:Cm(e.props.alpha,r,["material",this.uuid,"layer",n,"alpha"])}:o={...e.props,alphaOverride:Cm(e.props.alphaOverride,r,["material",this.uuid,"alphaOverride"])}),s.updateByOp({...e,...o?{props:o}:{},path:e.path.slice(2)},a,i)&&this.reset0(t,i)}}}else this.reset0(t,i);jn.endContext(this)}applyMasks(){for(let e=0;e<this.layers.length;++e){let t=this.layers[e];t instanceof Kr?t.color.mask=void 0:t instanceof Bc&&(t.node.mask=void 0)}for(let e=0;e<this.layers.length;++e){let t=this.layers[e];if(t instanceof Kr&&t.isMask.value&&t.data.visible&&e>0){let i=e-1,r=this.layers[i];r instanceof Bc?r.node.mask=new Ya(t.color,t.alpha,Ya.MUL):r instanceof Kr&&(r.isMask.value||(r.color.mask=new Ya(t.color,t.alpha,Ya.MUL)))}}}blendColors(){let e=this.layers.findIndex(i=>i instanceof Kr),t=this.layers.findIndex(i=>i instanceof Bc);if(e!==-1&&e<t){let i=this.layers[e].color;for(let r=e+1;r<t;++r){let n=this.layers[r];if(n instanceof Kr){if(n.isMask.value)continue;i=new FW(i,n.color,n.alpha,n.mode)}}this.fragment.color=i}else this.fragment.color=void 0}blendAfterColors(){let e=new br("outgoingLight","f"),t=this.layers.findIndex(i=>i instanceof Bc);if(this.layers.length>t+1){for(let i=t+1;i<this.layers.length;++i){let r=this.layers[i];if(r instanceof Kr){if(r.isMask.value)continue;e=new FW(e,r.color,r.alpha,r.mode)}}this.fragment.afterColor=e}else this.fragment.afterColor=void 0}blendPositions(){let e=this.layers.filter(t=>t instanceof Kte);if(e.length>0){let t=e[0].position;for(let i=1;i<e.length;++i)e[i]&&(t=new Ya(t,e[i].position,Ya.ADD),t=new Ya(t,new Dt(.5).setReadonly(!0),Ya.MUL));this.fragment.position=t}else this.fragment.position=void 0}getDefines(){return this.defines}getUniforms(){return this.uniforms}getVertexShader(){return this.vertexShader}getFragmentShader(){return this.fragmentShader}onBeforeCompile(e){this.shapeBlendhack&&this.shapeBlendhack(this),e.uniforms=this.uniforms,e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,e.extensionDerivatives=this.extensions.derivatives===!0,e.extensionFragDepth=this.extensions.fragDepth===!0,e.extensionDrawBuffers=this.extensions.drawBuffers===!0,e.extensionShaderTextureLOD=this.extensions.shaderTextureLOD===!0}clampUniformsForPreview(e,t){let i=(r,n,s)=>Math.min(Math.max(r,n),s);for(let r of this.layers)if(r.type==="displace"){let n=i(r.uniforms[`f${r.id}_intensity`].value,e,t);r.uniforms[`f${r.id}_intensity`].value=n}}updateFrame(e){for(let t=0;t<this.updaters.length;++t)e.updateNode(this.updaters[t])}build(){let e=new Ste;e.needsJitter=this.needsJitter,this.lights=this.lightLayer.data.visible,e.build(this.fragment,this.fragment),this.vertexShader=e.getCode("vertex"),this.fragmentShader=e.getCode("fragment"),this.defines=e.defines,this.uniforms=e.uniforms,this.extensions=e.extensions,this.updaters=e.updaters;for(let t of this.flavors)t&&t.updateAfterBuild();return this.shadersPatchedForShapeBlend=!1,this}nodeMaterialDispose(){this.layers.forEach(e=>e.dispose()),super.dispose();for(let e of this.flavors)e&&e.dispose()}assetsLoaded(){for(let e of this.layers)if(e instanceof Kr){let t=e.params.texture;if(t instanceof uB&&!t.image.loaded)return!1}return!0}};Object.defineProperties(yf.prototype,{properties:{get:function(){return this.fragment.properties}}});var pB=class extends e4{constructor(e,t,i){super(e,t,!1),this.uuid=i,this.allowVariableSaves=!0,this.saveVariableLocations(t)}},qW=new Map;function uLe(e){if(typeof e=="string")return e;let t=qW.get(e);return t||(t={url:URL.createObjectURL(new Blob([e]))},qW.set(e,t)),t.url}var $te,hLe=new Promise(e=>{$te=e}),YW=!1,mM;function dLe(){if(YW)return;if(mM)return mM;async function e(){await Af(()=>import("./howler-88tbB9mP.js").then(t=>t.h),[]),$te(window!==void 0?window:global),YW=!0}return mM=e(),mM}var eie;hLe.then(e=>eie=e);function fLe(e){let t=!1;return e.scene.objects.traverse((i,r)=>{if(r.events===void 0||Array.isArray(r.events)===!1)return!0;let n=[];r.events.forEach(s=>{"dragDropActions"in s.data?(n.push(...s.data.dragDropActions.drag),n.push(...s.data.dragDropActions.drop)):"inActions"in s.data?(n.push(...s.data.inActions),n.push(...s.data.outActions)):"gameActions"in s.data?(n.push(...s.data.gameActions.idle),n.push(...s.data.gameActions.move),n.push(...s.data.gameActions.jump),n.push(...s.data.gameActions.run)):"breakpoints"in s.data?s.data.breakpoints.forEach(a=>{n.push(...a.data.actions)}):"actions"in s.data&&n.push(...s.data.actions),t=t||n.some(a=>a.data.type==="Audio")})}),t}var fx=class{constructor({src:e,volume:t,delay:i,loop:r}){this._volume=1,this.delay=0,this._loop=1,this.loopsRemaining=0,this._status="stopped",this.onEnd=()=>{this.loopsRemaining===1/0?this.replay():this.loopsRemaining>1?(this.replay(),this.loopsRemaining--):(this._status="stopped",this.loopsRemaining=this._loop)};let n;typeof e=="string"?n={src:e}:n={src:uLe(e),format:"wav"},this.sound=new eie.Howl(n),this.sound.on("end",this.onEnd),this.src=e,t!==void 0&&(this.volume=t),i!==void 0&&(this.delay=i),r!==void 0&&(this.loop=r)}get status(){return this._status}get volume(){return this._volume}set volume(e){this._volume=e,this.sound.volume(e)}get loop(){return this._loop}set loop(e){this._loop=e,this.loopsRemaining=e}replay(){this.clearDelay(),this.delayTimerId=window.setTimeout(()=>{this.sound.play(),this.clearDelay()},this.delay)}fade(e,t=1e3){e?(this.sound.volume(this._volume),this.clearFade(),this.fadeTimerId=window.setTimeout(()=>{this.sound.fade(this._volume,0,t),this.clearFade()},e)):this.sound.fade(this._volume,0,t)}on(e,t,i){this.sound.on(e,t,i)}off(e,t,i){this.sound.off(e,t,i)}play(){this._status==="playing"||this.sound.playing()||(this._status==="paused"?(this.sound.seek()===0?this.replay():this.sound.play(),this._status="playing"):this._status==="stopped"&&(this.replay(),this._status="playing"))}pause(){this._status==="playing"&&(this.sound.pause(),this.clearFade(),this.clearDelay(),this._status="paused")}stop(){this.sound.stop(),this.loopsRemaining=this._loop,this.clearFade(),this.clearDelay(),this._status="stopped"}clearFade(){this.fadeTimerId&&(clearTimeout(this.fadeTimerId),delete this.fadeTimerId)}clearDelay(){this.delayTimerId&&(clearTimeout(this.delayTimerId),delete this.delayTimerId)}dispose(e=!1){this.off(),this.stop(),this.clearFade(),this.clearDelay()}},pLe=class{constructor(){this.type="ShapePath",this.color=new Yt,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new uA,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){var i;return(i=this.currentPath)==null||i.lineTo(e,t),this}quadraticCurveTo(e,t,i,r){var n;return(n=this.currentPath)==null||n.quadraticCurveTo(e,t,i,r),this}bezierCurveTo(e,t,i,r,n,s){var a;return(a=this.currentPath)==null||a.bezierCurveTo(e,t,i,r,n,s),this}splineThru(e){var t;return(t=this.currentPath)==null||t.splineThru(e),this}toShapes(){let e={ORIGIN:0,DESTINATION:1,BETWEEN:2,LEFT:3,RIGHT:4,BEHIND:5,BEYOND:6},t={loc:e.ORIGIN,t:0};function i(f,p,v,m){let g=f.x,y=p.x,x=v.x,_=m.x,M=f.y,S=p.y,T=v.y,E=m.y,C=(_-x)*(M-T)-(E-T)*(g-x),A=(y-g)*(M-T)-(S-M)*(g-x),D=(E-T)*(y-g)-(_-x)*(S-M),R=C/D,L=A/D;if(D===0&&C!==0||R<=0||R>=1||L<0||L>1)return null;if(C===0&&D===0){for(let O=0;O<2;O++)if(r(O===0?v:m,f,p),t.loc===e.ORIGIN){let H=O===0?v:m;return{x:H.x,y:H.y,t:t.t}}else if(t.loc===e.BETWEEN){let H=+(g+t.t*(y-g)).toPrecision(10),j=+(M+t.t*(S-M)).toPrecision(10);return{x:H,y:j,t:t.t}}return null}else{for(let j=0;j<2;j++)if(r(j===0?v:m,f,p),t.loc===e.ORIGIN){let Y=j===0?v:m;return{x:Y.x,y:Y.y,t:t.t}}let O=+(g+R*(y-g)).toPrecision(10),H=+(M+R*(S-M)).toPrecision(10);return{x:O,y:H,t:R}}}function r(f,p,v){let m=v.x-p.x,g=v.y-p.y,y=f.x-p.x,x=f.y-p.y,_=m*x-y*g;if(f.x===p.x&&f.y===p.y){t.loc=e.ORIGIN,t.t=0;return}if(f.x===v.x&&f.y===v.y){t.loc=e.DESTINATION,t.t=1;return}if(_<-Number.EPSILON){t.loc=e.LEFT;return}if(_>Number.EPSILON){t.loc=e.RIGHT;return}if(m*y<0||g*x<0){t.loc=e.BEHIND;return}if(Math.sqrt(m*m+g*g)<Math.sqrt(y*y+x*x)){t.loc=e.BEYOND;return}let M;m!==0?M=y/m:M=x/g,t.loc=e.BETWEEN,t.t=M}function n(f,p){let v=[],m=[];for(let g=1;g<f.length;g++){let y=f[g-1],x=f[g];for(let _=1;_<p.length;_++){let M=p[_-1],S=p[_],T=i(y,x,M,S);T!==null&&v.find(E=>E.t<=T.t+Number.EPSILON&&E.t>=T.t-Number.EPSILON)===void 0&&(v.push(T),m.push(new Me(T.x,T.y)))}}return m}function s(f,p,v){let m=new Me;p.getCenter(m);let g=[];return v.forEach(y=>{y.boundingBox.containsPoint(m)&&n(f,y.points).forEach(x=>{g.push({identifier:y.identifier,isCW:y.isCW,point:x})})}),g.sort((y,x)=>y.point.x-x.point.x),g}function a(f,p,v,m,g){(g==null||g==="")&&(g="nonzero");let y=new Me;f.boundingBox.getCenter(y);let x=[new Me(v,y.y),new Me(m,y.y)],_=s(x,f.boundingBox,p);_.sort((A,D)=>A.point.x-D.point.x);let M=[],S=[];_.forEach(A=>{A.identifier===f.identifier?M.push(A):S.push(A)});let T=M[0].point.x,E=[],C=0;for(;C<S.length&&S[C].point.x<T;)E.length>0&&E[E.length-1]===S[C].identifier?E.pop():E.push(S[C].identifier),C++;if(E.push(f.identifier),g==="evenodd"){let A=E.length%2===0,D=E[E.length-2];return{identifier:f.identifier,isHole:A,for:D}}else if(g==="nonzero"){let A=!0,D=null,R=null;for(let L=0;L<E.length;L++){let O=E[L];p[O]&&(A?(R=p[O].isCW,A=!1,D=O):R!==p[O].isCW&&(R=p[O].isCW,A=!0))}return{identifier:f.identifier,isHole:A,for:D}}else console.warn('fill-rule: "'+g+'" is currently not implemented.')}let o=0,l=999999999,c=-999999999,u=[];this.subPaths.forEach(f=>{let p=f.getPoints(),v=-999999999,m=999999999,g=-999999999,y=999999999;for(let x=0;x<p.length;x++){let _=p[x];_.y>v&&(v=_.y),_.y<m&&(m=_.y),_.x>g&&(g=_.x),_.x<y&&(y=_.x)}c<=g&&(c=g+1),l>=y&&(l=y-1),p.length&&u.push({curves:f.curves,points:p,isCW:r$.isClockWise(p),identifier:o++,boundingBox:new hN(new Me(y,m),new Me(g,v))})});let h=u.map(f=>{var p;return a(f,u,l,c,(p=this.userData)==null?void 0:p.style.fillRule)}),d=[];return u.forEach(f=>{let p=h[f.identifier];if(p&&!p.isHole){let v=new hA;v.curves=f.curves,h.filter(m=>(m==null?void 0:m.isHole)&&m.for===f.identifier).forEach(m=>{if(m){let g=u[m.identifier],y=new uA;y.curves=g.curves,v.holes.push(y)}}),d.push(v)}}),d}},tie=!1,iie,QW=new Promise(e=>{iie=e}),ZW=!1,gM;function mLe(){if(tie=!0,ZW)return;if(gM)return gM;async function e(){let t=await Af(()=>import("./opentype-D6jUvuOk.js"),[]);iie(t),ZW=!0}return gM=e(),gM}var gLe=class{async load(e,t,i=()=>{}){let{load:r}=await QW;r(e,(n,s)=>{n||!s?i(n??"Something went wrong"):t(s)})}async parse(e){let{parse:t,Bidi:i}=await QW;try{let r=t(e),n=new i,s=a=>r.charToGlyphIndex(a.char);return n.registerModifier("glyphIndex",null,s),n.applyFeatures(r,r.defaultRenderOptions.features),{font:r,bidi:n}}catch(r){console.error(r)}}};async function vLe(e){return await(await fetch(e)).arrayBuffer()}var yLe=new gLe;async function KW(e){let t,i,r=!1;if(e.url?(t=await vLe(e.url),i=e.url,r=e.url.startsWith("/")):e.data&&(t=e.data.buffer.slice(e.data.byteOffset,e.data.byteOffset+e.data.byteLength)),t)if(tie){let n=await yLe.parse(t);if(n)return{font:n.font,url:i,intercepted:r,arr:t,bidi:n.bidi}}else return{font:void 0,url:i,intercepted:r,arr:t,bidi:null}}function xLe(e,t){return t.state.glyphIndex===e||t.state.fina===e||t.state.medi===e||t.state.init===e}var wLe=class{constructor(e){this._arrayBuffer=new ArrayBuffer(1),this._isLoaded=!1,this._intercepted=!1,this._isUserFont=e.isUserFont??!1,this._loadingPromise=KW(e).then(t=>{t&&(this._arrayBuffer=t.arr,this._url=t.url,this.font=t.font,this._intercepted=t.intercepted,this._isLoaded=!0,this._bidi=t.bidi)})}update(e){this._isLoaded=!1,this._isUserFont=e.isUserFont??!1,this._loadingPromise=KW(e).then(t=>{t&&(this._arrayBuffer=t.arr,this._url=t.url,this.font=t.font,this._intercepted=t.intercepted,this._isLoaded=!0,this._bidi=t.bidi)})}get url(){return this._url}get intercepted(){return this._intercepted}get isLoaded(){return this._isLoaded}get loadingPromise(){return this._loadingPromise}reverseLigaturesTable(e,t,i){if(!this._bidi)return[];let r=this._bidi;r.getTextGlyphs(t);let n=r.tokenizer.tokens,s=[],a=0,o=i.length===n.length;for(let l=0;l<i.length;l++){let c=i[l].index,u=String.fromCharCode(i[l].unicode),h=n[a];if(xLe(c,h)||o)s.push({char:u,index:c,replacements:[h.state.glyphIndex],replacementChars:[h.char]}),a++;else{let d=h.char,f="",p=[h.state.glyphIndex],v=[],m=!1;for(;!m;)a++,f=t.charAt(a),d+=f,p.push(e.charToGlyphIndex(f)),v=e.stringToGlyphs(d),v.length===1&&v[0].index===c&&(m=!0),a>t.length&&(m=!0);s.push({char:u,index:c,replacements:p,replacementChars:Array.from(d)}),a++}}return s}generateShapes(e,t){if(!this._isLoaded)return;let i=this.font,r=t.fontSize/this.unitsPerEm,n=t.fontSize*t.lineHeight,s=e.map(g=>this.getTextWidth(g,t)),a=t.width,o=this.getCharWidth(`
`,t),l=t.horizontalAlign===1?o:0,c=this.computeSpaceWidthForLine(e,0,t),u=this.getLineInitialOffsetX(s[0],a,t.horizontalAlign,e[0],o),h=this.getLineInitialOffsetY(n,e.length,t.height,r,t.verticalAlign),d=[],f=e.map(g=>[]),p=e.map(g=>[]),v;for(let g=0;g<e.length;g++){let y=e[g],x={features:{liga:!0}},_=[];try{_=i.stringToGlyphs(y,x)}catch(S){console.warn(S)}u=this.getLineInitialOffsetX(s[g],a,t.horizontalAlign,y,o);let M=[];try{M=this.reverseLigaturesTable(i,y,_)}catch(S){console.warn(S)}c=this.computeSpaceWidthForLine(e,g,t);for(let S=0;S<_.length;S++){let T=_[S],E=T.index===0?`
`:T.unicode?String.fromCharCode(T.unicode):void 0,C=M[S],A=0,D=0;S===0&&t.horizontalAlign===2&&T.leftSideBearing!==void 0&&(D=-T.leftSideBearing*r),v&&(A=i.getKerningValue(T,v)*r),u+=D+A;let R=0;if(E===`
`)R=l;else if(E===" ")R=c;else{let L=this.createPath(T,r,u,h,t);L&&(R=L.offsetX-(A+D),d.push(L.path))}if(C.replacements.length===1)p[g].push([u,h]),f[g].push(R);else{let L=C.replacements.map(Y=>(i.glyphs.get(Y).advanceWidth??0)*r),O=L.reduce((Y,z)=>Y+=z,0),H=L.map(Y=>Y/O),j=u;for(let Y=0;Y<H.length;Y++){let z=R*H[Y];p[g].push([j,h]),f[g].push(z),j+=z}}u+=R,v=T}h-=n}let m=[];for(let g=0,y=d.length;g<y;g++)m.push(...d[g].toShapes());return{shapes:m,charWidths:f,lineWidths:s,charCoords:p}}get isUserFont(){return this._isUserFont}get arrayBuffer(){return this._arrayBuffer}get ascender(){var e;return((e=this.font)==null?void 0:e.ascender)??0}get descender(){var e;return((e=this.font)==null?void 0:e.descender)??0}get familyName(){var e;return((e=this.font)==null?void 0:e.names.fontFamily)??""}get subfamilyName(){var e;return((e=this.font)==null?void 0:e.names.fontSubfamily)??""}get unitsPerEm(){var e;return((e=this.font)==null?void 0:e.unitsPerEm)??1}getLineInitialOffsetX(e,t,i,r,n){return(i===3||i===2)&&r.indexOf(`
`)>=0&&(e-=n),i===3?t*.5-e*.5:i===2?t-e:0}getLineInitialOffsetY(e,t,i,r,n){let s=t*e,a=Math.abs(this.ascender-this.descender)*r,o=e-a,l=-this.ascender*r-o/2;return n===3?-(i-s-l):n===2?-(i*.5-s*.5-l):l}createPath(e,t,i,r,n){var l;let s=e.getPath(i,-r,n.fontSize,{kerning:!1,letterSpacing:n.letterSpacing});if(!s){console.error('THREE.Font: character "'+e+'" does not exists in font family '+this.familyName+".");return}let a=new pLe,o=(e.advanceWidth??1)*t;if(e)for(let c of s.commands){let u=(l=a.currentPath)==null?void 0:l.currentPoint;if(!(u&&c.type!=="Z"&&u.x===c.x&&-u.y===c.y))switch(c.type){case"M":a.moveTo(c.x,-c.y);break;case"L":a.lineTo(c.x,-c.y);break;case"Q":a.quadraticCurveTo(c.x1,-c.y1,c.x,-c.y);break;case"C":a.bezierCurveTo(c.x1,-c.y1,c.x2,-c.y2,c.x,-c.y);break}}return a.subPaths.forEach(c=>{let u=bLe(c.curves);u!==void 0&&c.currentPoint.distanceTo(u)>0&&c.lineTo(u.x,u.y)}),{offsetX:o+n.fontSize*n.letterSpacing,path:a}}getCharWidth(e,t){var i;return((i=this.font)==null?void 0:i.getAdvanceWidth(e,t.fontSize,{kerning:!0,letterSpacing:t.letterSpacing}))??0}getTextWidth(e,t){var i;return((i=this.font)==null?void 0:i.getAdvanceWidth(e,t.fontSize,{kerning:!0,letterSpacing:t.letterSpacing}))??0}computeSpaceWidthForLine(e,t,i){let r=this.getCharWidth(" ",i),n=e[t];if(n){let s=this.countSpaces(n.trimEnd());if(i.horizontalAlign===4&&t<e.length-1&&s){let a=i.width,o=this.getTextWidth(n,i);return(a-(o-s*r))/s}}return r}countSpaces(e){return(e.match(/ /g)||[]).length}};function bLe(e){if(e.length){let t=e[0];if(t instanceof ic)return t.v1;if(t instanceof Zl||t instanceof gf)return t.v0}}var _Le=class{constructor(){this.objects=new Map,this.unreachable=new Set}getCached(e){return this.objects.get(e)}get size(){return this.objects.size}get(e,t,i){let r=this.objects.get(e);return r===void 0?(r=this.createObject(e,t,i),this.objects.set(e,r)):r.isShared=!0,r}forceDelete(e){let t=this.objects.get(e);t&&(this.disposeObject(t),this.objects.delete(e))}mutateIfUnique(e,t){let i=this.objects.get(e);if(i&&i.isShared!==!0)return this.objects.delete(e),this.objects.set(t,i),i}startGc(){this.unreachable=new Set(this.objects.keys())}markAsReachable(e,t){let i=this.objects.get(e);t===i&&this.unreachable.delete(e)}endGc(){this.unreachable.forEach(e=>{this.disposeObject(this.objects.get(e)),this.objects.delete(e)}),this.unreachable.clear()}dispose(){this.objects.forEach(e=>{this.disposeObject(e)}),this.objects.clear()}},JW=class extends _Le{constructor(e){super(),this.flatShading=e}disposeObject(e){e.dispose()}createObject(e,t,i){let r=Yw(e,t,this.flatShading,i);return r.computeBoundingSphere(),r}},SLe={markNeedsUpdateRendererDirty:()=>{}},a2=1e3,$W=512*a2;function MLe(e,t){let i=typeof e;return!!((t==="string"||t==="number")&&i===t||t==="boolean"&&(e==="true"||e==="false"||e===!0||e===!1)||t==="image"&&i==="string"&&e.startsWith("http"))}var ELe="https://hooks.spline.design",ALe=`${ELe}/events?hashFile=`,TLe=class{constructor(t,i){this.id=t,this.userWebhook=i,this.result=void 0,this._connected=!1,this.emitter=HC(),this.reconnectWaitFor=a2,this._onError=r=>{var n,s,a;(n=this.eventSource)==null||n.removeEventListener("message",this._onMessage),(s=this.eventSource)==null||s.removeEventListener("error",this._onError),(a=this.eventSource)==null||a.removeEventListener("open",this._onConnected),this._scheduleReconnect()},this._onConnected=r=>{clearTimeout(this.scheduledReconnectHandle),this.reconnectWaitFor=a2,this._connected=!0},this._onDisconnected=()=>{clearTimeout(this.scheduledReconnectHandle),this.reconnectWaitFor=a2,this._connected=!1},this._onMessage=r=>{let n=r.data,s;try{s=JSON.parse(n)}catch(a){console.error("Error parsing webhook message",a)}if(s){let a=!1;this.userWebhook.parametersSchemas.forEach(({data:o})=>{s[o.name]!==void 0&&MLe(s[o.name],o.type)&&(this.result===void 0&&(this.result={}),this.result[o.name]=s[o.name],a=!0)}),a&&this.emitter.emit("message",{userWebhookId:this.id})}}}connect(){clearTimeout(this.scheduledReconnectHandle),this.userWebhook.url&&(this.eventSource=new EventSource(ALe+this.userWebhook.url),this.eventSource.addEventListener("message",this._onMessage),this.eventSource.addEventListener("error",this._onError),this.eventSource.addEventListener("open",this._onConnected))}disconnect(){var t,i,r,n;(t=this.eventSource)==null||t.removeEventListener("message",this._onMessage),(i=this.eventSource)==null||i.removeEventListener("error",this._onError),(r=this.eventSource)==null||r.removeEventListener("open",this._onConnected),(n=this.eventSource)==null||n.close(),this._onDisconnected(),clearTimeout(this.scheduledReconnectHandle)}_scheduleReconnect(){this.reconnectWaitFor*=2,this.reconnectWaitFor>$W&&(this.reconnectWaitFor=$W),clearTimeout(this.scheduledReconnectHandle),this.scheduledReconnectHandle=setTimeout(()=>{this.scheduledReconnectHandle=void 0,this.connect()},this.reconnectWaitFor)}update(t){this.userWebhook=t}dispose(){this._connected&&this.disconnect()}get connected(){return this._connected}on(t,i){this.emitter.on(t,i)}off(t,i){this.emitter.off(t,i)}getParametersKeys(){return this.userWebhook.parametersSchemas.map(t=>t.data.name)}getParameterValue(t){var i;if(this.getParametersKeys().includes(t)){if(this.result)return(i=this.result)==null?void 0:i[t];for(let r of this.userWebhook.parametersSchemas)if(r.data.name===t)return Vz.defaultParameterValueByType(r.data.type)}}},e9=[4186.01,4434.92,4698.63,4978.03,5274.04,5587.65,5919.91,6271.93,6644.88,7040,7458.62,7902.13],CLe=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],uf=[],t4=[];for(let e=1;e<=8;e++)for(let t=0;t<e9.length;t++){let i=e9[t];uf.push(i/Math.pow(2,8-e)),t4.push(CLe[t]+e)}var KA=[32,2e3],t9=uf.filter((e,t)=>uf[t]>KA[0]&&uf[t]<KA[1]),PLe=t4.filter((e,t)=>uf[t]>KA[0]&&uf[t]<KA[1]),DLe=class{static getFrequencies(e,t,i,r="frequency",n=-100,s=-30){i||(i=new Float32Array(e.frequencyBinCount),e.getFloatFrequencyData(i));let a=t/2,o=1/i.length*a,l,c,u;if(r==="music"||r==="voice"){let d=r==="voice"?t9:uf,f=Array(d.length).fill(n);for(let p=0;p<i.length;p++){let v=p*o,m=i[p];for(let g=d.length-1;g>=0;g--)if(v>d[g]){f[g]=Math.max(f[g],m);break}}l=f,c=r==="voice"?t9:uf,u=r==="voice"?PLe:t4}else l=Array.from(i),c=l.map((d,f)=>o*f),u=c.map(d=>`${d.toFixed(2)} Hz`);let h=l.map(d=>Math.max(0,Math.min((d-n)/(s-n),1)));return{values:new Float32Array(h),frequencies:c,labels:u}}},RLe="gpt-4o-realtime-preview-2024-12-17",ILe=()=>"https://relayserver.spline.design/";async function LLe(e){try{return(await(await fetch(ILe()+"session?uuidfile="+e)).json()).token}catch(t){console.error("Token generation error:",t)}}var OLe=class{constructor(e){this.value=0,this.frequencies=new Float32Array(0);let t=new AudioContext;this.source=t.createMediaStreamSource(e),this.analyser=t.createAnalyser(),this.source.connect(this.analyser),this.analyser.fftSize=8192,this.analyser.smoothingTimeConstant=.1}getFrequencies(e=-100,t=-30){if(!this.analyser)throw new Error("Not connected, please call .connect() first");return DLe.getFrequencies(this.analyser,44100,void 0,"voice",e,t)}update(){let e=this.getFrequencies(),t=e.values.reduce((i,r)=>i+r,0)/e.values.length;this.value=t,this.frequencies=e.values}disconnect(){this.source.disconnect(),this.analyser.disconnect()}},i9=class{constructor(e,t,i){this.data=e,this.id=t,this.shared=i,this.emitter=HC(),this.rafId=0,this.voice=0,this.frequencies=new Float32Array([0]),this.events=[],this.isConnected=!1,this.isToolsAdded=!1,this.tools=[],this.onMessage=r=>{var s;let n=JSON.parse(r.data);if(this.appendEvent(n),n.type==="session.created"&&this.onSessionCreated(),n.type==="response.done"&&((s=n.response)==null?void 0:s.output)){for(let a of n.response.output)if(a.type==="function_call")for(let[o,l]of this.tools)a.name===o.name&&(l(JSON.parse(a.arguments)),setTimeout(()=>{this.sendClientEvent({type:"response.create",response:{instructions:"notice the user about what you just did"}})}))}},this.onSessionCreated=()=>{this.isToolsAdded||this.registerTools()},this.onOpen=()=>{this.events=[],this.isConnected=!0,this.sendClientEvent({type:"response.create",response:{instructions:"Say hi"}})},this.animate=()=>{if(this.rafId=requestAnimationFrame(this.animate),this.isConnected&&this.analyser){this.analyser.update();let r=this.analyser.value,n=this.analyser.frequencies;this.voice=r,this.frequencies=n,this.emitter.emit("voice",{value:r,frequencies:n})}}}update(e){this.data=e}setColorByName(e,t){let i=this.shared.getColorByName(e);if(i){let{id:r}=i,{r:n,g:s,b:a}=sRe.hexStringToRgb(t)??{r:0,g:0,b:0};this.shared.updateColor(r,{r:n/255,g:s/255,b:a/255})}}async connect(){if(this.isConnected)return;let e=await LLe(this.data.integration.hash);this.pc=new RTCPeerConnection,this.audioElement=document.createElement("audio"),this.audioElement.autoplay=!0,this.pc.ontrack=n=>{let s=n.streams[0];this.audioElement.srcObject=s,this.analyser=new OLe(s)};let t=await navigator.mediaDevices.getUserMedia({audio:!0});this.pc.addTrack(t.getTracks()[0]),this.dc=this.pc.createDataChannel("oai-events"),this.dc.addEventListener("message",this.onMessage),this.dc.addEventListener("open",this.onOpen);let i=await this.pc.createOffer();await this.pc.setLocalDescription(i);let r={type:"answer",sdp:await(await fetch(`https://api.openai.com/v1/realtime?model=${RLe}`,{method:"POST",body:i.sdp,headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/sdp"}})).text()};await this.pc.setRemoteDescription(r),this.animate()}appendEvent(e){this.events=[e,...this.events]}sendClientEvent(e){this.dc?(e.event_id=e.event_id||crypto.randomUUID(),this.dc.send(JSON.stringify(e)),this.appendEvent(e)):console.error("Failed to send message - no data channel available",e)}registerTools(){this.isToolsAdded=!0,this.registerTool({type:"function",name:"set_personality_color",description:"returns a color based on the voice personality of the ai assistant. This should be called by the voice assistant each time it is asks to speak differently. If a color cannot be associated to the personality, the color should be a neutral color.",parameters:{type:"object",properties:{color:{type:"string",description:"css hex color string, reflecting the personality"},personality:{type:"string",description:"the personality of the voice assistant"}},required:["color","personality"]}},({color:n})=>{this.setColorByName("Voice Assistant Color",n)});let e=this.shared.getVariablesNames().join(", ");this.registerTool({type:"function",name:"set_variable",description:"Sets a Spline variable value when asked by the user.",parameters:{type:"object",properties:{name:{type:"string",description:`The name of the variable that needs to be set. Here's a list of available variables: ${e}. It the variable does not exist, don't call the function and warn the user about it.`},value:{type:"string",description:"The new value for this variable, should always be a string even for number and boolean variables, assume that the value will be cast to the proper type afterwards."}},required:["name","value","type"]}},({name:n,value:s})=>{let a=this.shared.getVariableByName(n);if(a){let o=this.shared.getVariable(a.id),l;typeof o=="number"?l=parseFloat(s):typeof o=="boolean"?l=s.toLowerCase()==="true":l={textValue:s},this.shared.updateVariable(a.id,l)}});let t=this.shared.getColorNames().join(", ");this.registerTool({type:"function",name:"set_color",description:"Sets a Spline color asset value when asked by the user.",parameters:{type:"object",properties:{name:{type:"string",description:`The name of the color asset that needs to be set. Here's a list of available color assets: ${t}. It the color asset does not exist, don't call the function and warn the user about it.`},value:{type:"string",description:"css hex color string"}},required:["name","value"]}},({name:n,value:s})=>{this.setColorByName(n,s)});let i=this.shared.scene,r=[];i.traverseEntity(n=>{n.data.events.forEach(s=>{if(s.data.type==="AIAssistantTrigger"){let{description:a}=s.data;r.push(a)}})}),this.registerTool({type:"function",name:"trigger_event",description:"Trigger an event by name, here are the available events, please match what the user is asking for to one of these if it applies, otherwise don't call the function and warn the user.",parameters:{type:"object",properties:{description:{type:"string",description:`The name of the event that needs to be triggered. Here's a list of available events: ${JSON.stringify(r)}.`},direction:{type:"string",description:"default is forward, but can be forward or backward. Always set to forward unless the user ask to reverse or cancel the event, then set to backward."}},required:["description","direction"]}},({description:n,direction:s})=>{this.emitter.emit("trigger_event",{description:n,direction:s})}),this.sendClientEvent({type:"session.update",session:{tools:this.tools.map(([n])=>n)}})}registerTool(e,t){this.tools.push([e,t])}disconnect(){var e,t,i,r,n,s;cancelAnimationFrame(this.rafId),(e=this.analyser)==null||e.disconnect(),this.voice=0,this.isConnected=!1,this.isToolsAdded=!1,(t=this.dc)==null||t.removeEventListener("message",this.onMessage),(i=this.dc)==null||i.removeEventListener("open",this.onOpen),(r=this.dc)==null||r.close(),(n=this.pc)==null||n.getSenders().forEach(a=>{a.track&&a.track.stop()}),(s=this.pc)==null||s.close(),this.pc=void 0}computeAnalysisForListenerEvent(e){if(e.analysis==="range"){let t=this.frequencies.slice(...e.analysisRange);return t.reduce((i,r)=>i+r,0)/t.length}return e.analysis==="single"?this.frequencies[e.analysisSingle]:this.voice}on(e,t){this.emitter.on(e,t)}off(e,t){this.emitter.off(e,t)}};function mB(e){return"variable_"+e}var zLe=class extends wIe{constructor(e){super(),this.shared=e}create(e){return new Xte(e,this.shared)}},i4=class{constructor(e,t={},i=!0,r=!1){if(this.data=e,this.needsJitter=i,this.enableLocalStorageForPersistentVariables=r,this.geometryCache=new JW(!0),this.geometryCache2=new JW(!1),this.imageHolderCache=new zLe(this),this.thisContext={scene:SLe,shared:this},this.deletedMaterial=new pB(ps.defaultTwoLayerData("phong"),this.thisContext,""),this.deletedImage=new Ld(Hz.emptyImage,this),this.deletedVideo=new Ld(IA.defaultVideo,this),this.materials={},this.images={},this.uiBuffers={},this.videos={},this.colors={},this.audios={},this.particles={},this.fonts={},this.variables={},this.userAPIs={},this.userWebhooks={},this.mouseProperty=null,this.raycastProperty=null,this.requestRender=()=>{this._requestRender&&this._requestRender()},t.images)for(let[n,s]of Object.entries(t.images))this.addImage(n,s);if(t.videos)for(let[n,s]of Object.entries(t.videos))this.addVideo(n,s);if(t.audios)for(let[n,s]of Object.entries(t.audios))this.addAudio(n,s);if(t.particles)for(let[n,s]of Object.entries(t.particles))this.addParticle(n,s);this.reset(e)}setRequestRender(e){this._requestRender=e}getImageLoadPromises(){return Object.values(this.images).map(e=>e.loadPromise)}setEntityOpContext(e){this.entityOpContext=e}reset(e,t=!1){this.data=e,this.resetLib(e.lib);for(let{id:i,data:r}of e.variables)this.addVariableHolder(i,r),t&&this.updateVariableHolder(i,r);for(let[i,r]of Object.entries(e.userAPIs))this.addUserAPI(i,r);for(let[i,r]of Object.entries(e.userWebhooks))this.addUserWebhook(i,r);for(let[i,r]of Object.entries(e.images))this.addImage(i,r);for(let[i,r]of Object.entries(e.videos))this.addVideo(i,r);for(let[i,r]of Object.entries(e.colors))this.addColor(i,r);for(let[i,r]of Object.entries(e.materials))this.addMaterial(i,r);for(let[i,r]of Object.entries(e.audios))this.addAudio(i,r);for(let[i,r]of Object.entries(e.particles))this.addParticle(i,r);for(let[i,r]of Object.entries(e.fonts))this.addFont(i,r)}addMaterial(e,t){if(this.materials[e]){let i=this.materials[e];i.reset(t,this.thisContext),i.dispose()}else{let i=new pB(t,this.thisContext,e);this.materials[e]=i}}deleteMaterial(e){this.materials[e]&&(this.materials[e].nodeMaterialDispose(),delete this.materials[e])}getMaterial(e){return this.materials[e]}getMaterialOrDeletedPlaceholder(e){return this.materials[e]??this.deletedMaterial}material(e){return typeof e=="string"?this.getMaterialOrDeletedPlaceholder(e):e==null?(console.error("material is undefined or null"),this.deletedMaterial):new e4(e,this.thisContext)}getMaterials(){return this.materials}addImage(e,t){return this.images[e]?(this.onColorOrImageUpdate&&this.onColorOrImageUpdate(),this.images[e].updateSrc(t.data),!0):(this.images[e]=new Ld(t,this),!1)}deleteImage(e){let t=this.images[e];t&&(t.dispose(),delete this.images[e])}getDefaultImage(){return this.images.image_0}getImage(e){return this.images[e]??this.deletedImage}image(e){return typeof e=="string"?this.getImage(e):this.imageHolderCache.load(e)}addUIBuffer(e,t){return this.uiBuffers[e]?(this.onColorOrImageUpdate&&this.onColorOrImageUpdate(),this.uiBuffers[e].updateSrc(t),!0):(this.uiBuffers[e]=new Ld(t,this),!1)}uiBuffer(e){return this.uiBuffers[e]}addVideo(e,t){return this.videos[e]?(this.videos[e].updateSrc(t.data),!0):(this.videos[e]=new Ld(t,this),!1)}deleteVideo(e){let t=this.videos[e];t&&(t.dispose(),delete this.videos[e])}getVideo(e){return this.videos[e]??this.deletedVideo}video(e){return typeof e=="string"?this.getVideo(e):this.imageHolderCache.load(e)}addColor(e,t){return this.colors[e]?(this.onColorOrImageUpdate&&this.onColorOrImageUpdate(),"a"in t?this.colors[e].setRGBA(t.r,t.g,t.b,t.a):this.colors[e].setRGBA(t.r,t.g,t.b,1),!0):("a"in t?this.colors[e]=new ZA(t.r,t.g,t.b,t.a):this.colors[e]=new ZA(t.r,t.g,t.b,1),!1)}updateColor(e,t){if(this.colors[e]){this.onColorOrImageUpdate&&this.onColorOrImageUpdate();let i=this.colors[e];return this.colors[e].r=t.r??i.r,this.colors[e].g=t.g??i.g,this.colors[e].b=t.b??i.b,this.colors[e].a=t.a??i.a,!0}return!1}deleteColor(e){this.colors[e]&&delete this.colors[e]}getColor(e){return this.colors[e]}getColorNames(){return Object.values(this.data.colors).map(e=>e.name)}getColorByName(e){for(let t in this.data.colors)if(this.data.colors[t].name===e)return{color:this.colors[t],id:t}}color(e){let t;if(typeof e=="string"){let i=this.getColor(e);i?t=i:(console.warn("Tried to create color layer params with a color key that does not exist in the assets manager"),t=new Bs(0,0,0,0))}else return"a"in e?new Bs(e.r,e.g,e.b,e.a):new Bs(e.r,e.g,e.b,1);return t}addAudio(e,t){this.audios[e]=t}getAudio(e){let t=this.audios[e];if(t instanceof fx)return t;{let i=new fx({src:t.data});return this.audios[e]=i,i}}addParticle(e,t){this.particles[e]=t}getParticle(e){return this.particles[e]}deleteParticle(e){this.particles[e]&&delete this.particles[e]}deleteAudio(e){let t=this.audios[e];t&&(t instanceof fx&&t.dispose(),delete this.audios[e])}addFont(e,t){this.fonts[e]=new wLe(t),this.fonts[e].loadingPromise.then(()=>this.requestRender())}getFont(e){return this.fonts[e]}deleteFont(e){this.fonts[e]&&delete this.fonts[e]}dispose(){Object.keys(this.materials).forEach(e=>this.deleteMaterial(e)),this._requestRender=void 0,Object.values(this.audios).forEach(e=>{e instanceof fx&&e.dispose()}),this.audios={},this.particles={},this.geometryCache.dispose(),this.geometryCache2.dispose()}addVariableHolder(e,t){if(this.variables[e]===void 0){let i=t.value;if(this.enableLocalStorageForPersistentVariables&&t.persistent){let r=localStorage.getItem(mB(e));i=r!==null?JSON.parse(r):t.value}return this.variables[e]={value:i,locations:[],persistent:t.persistent},"dynamicVariableType"in t&&(this.variables[e].dynamicVariablePlayState="Playing",this.variables[e].dynamicVariableToggleIsForward=void 0),!0}return this.variables[e].value=t.value,!1}resetDynamicVariablePlayState(){for(let e in this.variables)this.variables[e].dynamicVariablePlayState!==void 0&&(this.variables[e].dynamicVariablePlayState="Playing",this.variables[e].dynamicVariableToggleIsForward=void 0)}updateVariableHolder(e,t){this.updateVariable(e,t.value)}updateVariable(e,t){if(this.variables[e]===void 0)return!1;this.variables[e].value=t,this.enableLocalStorageForPersistentVariables&&this.variables[e].persistent&&localStorage.setItem(mB(e),JSON.stringify(t));let i=t;for(;typeof i=="string";)i=this.variables[i].value;let r=this.entityOpContext.scene;for(let n=this.variables[e].locations.length-1;n>=0;n--){let s=this.variables[e].locations[n];if(s[0]==="material"){let a=s[1],o=i,l={scene:r,shared:this},c=s.slice(2);r.traverseMaterial(h=>{let d=h.root??h;d.uuid===a&&d.onVariableUpdate(c,o,l)});let u=this.materials[a];u&&u.onVariableUpdate(c,o,l)}else{let a=r.find(s[0]);if(a===void 0){this.variables[e].locations.splice(n,1);continue}if(s[1]!=="geometry"&&s[1]!=="particles"){for(let o=1;o<s.length-1;o++)a=a[s[o]];s[1]==="rotation"?a[s[s.length-1]]=i*Tt.DEG2RAD:a[s[s.length-1]]=i}if(a=r.find(s[0]),a.type==="ParticleEmitter"&&a.updateVariableState(i,s),Fi.is(a))if(s[1]==="position"||s[1]==="rotation"||s[1]==="scale")a.onVariableUpdate();else if(s[1]==="geometry"){let o=a;a.component&&(o=a.component);let l=o.dataPatched;o.chooseGeoemtryCache(this).forceDelete(l.geometry),o.createGeometryDelayed(this.entityOpContext),o.onVariableUpdate(!0),o.invalidateDownstreamBooleanData(),o.instances.forEach(c=>{let u=c.dataPatched;c.chooseGeoemtryCache(this).forceDelete(u.geometry),c.createGeometryDelayed(this.entityOpContext),c.onVariableUpdate(!0),c.invalidateDownstreamBooleanData()})}else s[1]==="morphTargetInfluences"&&a.updateMorphInfluences(s[2],i)}}return this.requestRender(),!0}deleteVariable(e){this.variables[e]&&delete this.variables[e]}getVariable(e,t){var i,r,n;if(Array.isArray(e)){if(e[0]==="mouse")return((i=this.mouseProperty)==null?void 0:i[e[1]])??0;if(e[0]==="raycast")return((r=this.raycastProperty)==null?void 0:r[e[1]])??0;let s=this.entityOpContext.scene.find(e[0]);if(e[1]==="width"||e[1]==="height"||e[1]==="depth")return s.geometry.userData.parameters[e[1]];for(let a=1;a<e.length;a++)s=s[e[a]];return e[1]==="rotation"&&(s*=Tt.RAD2DEG),s}for(let s in this.variables){if(t===void 0)break;let a=this.variables[s],o=(n=a.locations)==null?void 0:n.findIndex(l=>Xn.equal(l,t));o!==void 0&&o!==-1&&a.locations.splice(o,1)}if(typeof e=="string"){let s=e,a=e;do{if(a=s,this.variables[s]===void 0)break;let o=this.variables[s].value;t&&this.variables[a]!==void 0&&this.variables[a].locations.push(t),s=o}while(typeof s=="string");return s}else return e}getVariables(){return this.variables}getVariablesNames(){return this.data.variables.map(e=>e.data.name)}getVariableByName(e){for(let t of this.data.variables)if(t.data.name===e)return{variable:t.data,id:t.id}}getDynamicVariablePlayState(e){var t;return(t=this.variables[e])==null?void 0:t.dynamicVariablePlayState}setDynamicVariablePlayState(e,t){this.variables[e]!==void 0&&(this.variables[e].dynamicVariablePlayState=t)}getDynamicVariableToggleIsForward(e){var t;return(t=this.variables[e])==null?void 0:t.dynamicVariableToggleIsForward}setDynamicVariableToggleIsForward(e,t){this.variables[e]!==void 0&&(this.variables[e].dynamicVariableToggleIsForward=t)}resetLib(e){for(let[t,i]of Object.entries(e.images))this.addImage(t,i.asset);for(let[t,i]of Object.entries(e.audios))this.addAudio(t,i.asset);for(let[t,i]of Object.entries(e.particles))this.addParticle(t,i.asset);for(let[t,i]of Object.entries(e.colors))this.addColor(t,i.asset);for(let[t,i]of Object.entries(e.fonts))this.addFont(t,i.asset);for(let[t,i]of Object.entries(e.materials))this.addMaterial(t,i.asset);for(let[t,i]of Object.entries(e.videos))this.addVideo(t,i.asset);for(let[t,i]of Object.entries(e.variables))this.addVariableHolder(t,i.asset)}updateLibByOp(e,t){e.path[0]==="images"?e.path.length===1&&e.type===1?this.addImage(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteImage(e.id):e.path[0]==="videos"?e.path.length===1&&e.type===1?this.addVideo(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteVideo(e.id):e.path[0]==="audios"?e.path.length===1&&e.type===1?this.addAudio(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteAudio(e.id):e.path[0]==="particles"?e.path.length===1&&e.type===1?this.addParticle(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteParticle(e.id):e.path[0]==="colors"?e.path.length===1&&e.type===1?this.addColor(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteColor(e.id):e.path[0]==="materials"?e.path.length===1&&e.type===1?this.addMaterial(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteMaterial(e.id):e.path[0]==="fonts"?e.path.length===1&&e.type===1?this.addFont(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteFont(e.id):e.path[0]==="variables"?e.path.length===1&&e.type===1?this.addVariableHolder(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteVariable(e.id):e.path[0]==="components"&&t.updateByLibOp(e,this)}updateByOp(e,t,i){var r;if(this.data=t,e.path[0]==="images")e.path.length===2&&e.type===0?e.props.data&&this.getImage(e.path[1]).updateSrc(e.props.data):e.path.length===1&&e.type===1?this.addImage(e.id,e.data):e.path.length===1&&e.type===2&&this.deleteImage(e.id);else if(e.path[0]==="videos")e.path.length===2&&e.type===0?e.props.data&&this.getVideo(e.path[1]).updateSrc(e.props.data):e.path.length===1&&e.type===1?this.addVideo(e.id,e.data):e.path.length===1&&e.type===2&&this.deleteVideo(e.id);else if(e.path[0]==="audios")e.path.length===2&&e.type===0?e.props.data&&this.addAudio(e.path[1],t.audios[e.path[1]]):e.path.length===1&&e.type===1?this.addAudio(e.id,e.data):e.path.length===1&&e.type===2&&this.deleteAudio(e.id);else if(e.path[0]==="particles")e.path.length===2&&e.type===0?e.props.data&&this.addParticle(e.path[1],t.particles[e.path[1]]):e.path.length===1&&e.type===1?this.addParticle(e.id,e.data):e.path.length===1&&e.type===2&&this.deleteParticle(e.id);else if(e.path[0]==="colors")e.path.length===2&&e.type===0?this.updateColor(e.path[1],e.props):e.path.length===1&&e.type===1?this.addColor(e.id,e.data):e.path.length===1&&e.type===2&&this.deleteColor(e.id);else if(e.path[0]==="materials")e.path.length===1&&e.type===1?this.addMaterial(e.id,e.data):e.path.length===1&&e.type===2?this.deleteMaterial(e.id):e.path.length>1&&this.getMaterial(e.path[1]).updateByOp(fs.drop(e,2),t.materials[e.path[1]],{shared:this,scene:i});else if(e.path[0]==="fonts")e.path.length===2&&e.type===0?this.updateFont(e.path[1],e,i):e.path.length===1&&e.type===1?this.addFont(e.id,e.data):e.path.length===1&&e.type===2&&this.deleteFont(e.id);else if(e.path[0]==="variables")e.path.length===2&&e.type===0?"value"in e.props?this.updateVariable(e.path[1],e.props.value):"persistent"in e.props&&(this.variables[e.path[1]].persistent=e.props.persistent):e.path.length===1&&e.type===4?this.addVariableHolder(e.id,e.data):e.path.length===1&&e.type===5&&this.deleteVariable(e.id);else if(e.path[0]==="userAPIs"){if(e.path.length===1&&e.type===1)this.addUserAPI(e.id,e.data);else if(e.path.length===1&&e.type===2)this.deleteUserAPI(e.id);else if(typeof e.path[1]=="string"){let n=t.userAPIs[e.path[1]];if(n){let s=e.type===0&&e.props.debounce===void 0,a=this.getUserAPI(e.path[1]);a instanceof i9?a.update(n):a==null||a.update(n,this,s)}}}else if(e.path[0]==="userWebhooks"){if(e.path.length===1&&e.type===1)this.addUserWebhook(e.id,e.data);else if(e.path.length===1&&e.type===2)this.deleteUserWebhook(e.id);else if(typeof e.path[1]=="string"){let n=t.userWebhooks[e.path[1]];n&&((r=this.getUserWebhook(e.path[1]))==null||r.update(n))}}else e.path[0]==="lib"&&this.updateLibByOp(fs.drop(e,1),i)}updateFont(e,t,i){if(t.props.url){let r=this.getFont(e),n={...this.data.fonts[e],url:t.props.url};r.update(n),r.loadingPromise.then(()=>this.requestRender()),i.updateFont(e,this)}}addUserAPI(e,t){var i,r;return this.userAPIs[e]?(this.userAPIs[e].update(t,this),!0):((i=this.openAIRealtime)==null?void 0:i.id)===e?(this.openAIRealtime.update(t),!0):((r=t.integration)==null?void 0:r.type)==="VoiceAssistant"?(this.openAIRealtime=new i9(t,e,this),!1):(this.userAPIs[e]=new cte(e,t,this),!1)}getUserAPI(e){var t;return((t=this.openAIRealtime)==null?void 0:t.id)===e?this.openAIRealtime:this.userAPIs[e]}getUserAPIs(){return this.userAPIs}deleteUserAPI(e){let t=this.userAPIs[e];t&&(t.dispose(),delete this.userAPIs[e])}addUserWebhook(e,t){return this.userWebhooks[e]?(this.userWebhooks[e].update(t),!0):(this.userWebhooks[e]=new TLe(e,t),!1)}getUserWebhook(e){return this.userWebhooks[e]}getUserWebhooks(){return this.userWebhooks}deleteUserWebhook(e){let t=this.userWebhooks[e];t&&(t.dispose(),delete this.userWebhooks[e])}get scene(){return this.entityOpContext.scene}};new i4(ol.emptyData());var xy=class extends za{updateByPatchedOp(e,t,i){if(super.updateByPatchedOp(e,t,i),qCe(e.path,["materials"])!==null&&e.type===0&&Array.isArray(this.material))for(let[r,n]of Object.entries(e.props)){let s=i.shared.material(n);this.material[Number(r)]=s}else if(pr(e.path,["material"])&&this.material instanceof yf)"material"in t&&typeof t.material!="string"&&this.material.updateByOp(fs.drop(e,1),t.material,i);else if(pr(e.path,["materials","*"])&&Array.isArray(this.material)){let r=e.path[1];if("materials"in t&&r<this.material.length){let n=t.materials[r];typeof n!="string"&&this.material[r].updateByOp(fs.drop(e,2),n,i)}}}get needsAO(){return this.material!==void 0?(Array.isArray(this.material)?this.material[0]:this.material).hasAO:!1}updateState(e,t){var n,s;super.updateState(e,t),e.castShadow!==void 0&&(this.castShadow=e.castShadow),e.receiveShadow!==void 0&&(this.receiveShadow=e.receiveShadow);let i=this.dataPatched;this.dataPatched.type==="Mesh"&&this.dataPatched.geometry.shapeBlendNode&&this.layers.set(9);let r;if(this.dataPatched.type==="Mesh"&&this.dataPatched.geometry.type==="ShapeBlendGeometry"&&(r={resolutionLevel:this.dataPatched.geometry.resolutionLevel,useChildrenColors:this.dataPatched.geometry.useChildrenColors}),((n=e.geometry)==null?void 0:n.type)!=="NonParametricGeometry"&&"material"in e&&e.material!==void 0&&(this.disposeMaterial(),this.material=t.shared.material(e.material).getFlavor(i.flatShading,i.side,i.wireframe,r),t.scene.markNeedsUpdateRendererDirty()),(((s=e.geometry)==null?void 0:s.type)==="NonParametricGeometry"||"materials"in e)&&("materials"in e&&e.materials!==void 0?(this.disposeMaterial(),this.material=e.materials.map(a=>t.shared.material(a).getFlavor(i.flatShading,i.side,i.wireframe)),t.scene.markNeedsUpdateRendererDirty()):"material"in e&&e.material!==void 0&&(this.disposeMaterial(),this.material=[t.shared.material(e.material).getFlavor(i.flatShading,i.side,i.wireframe)],t.scene.markNeedsUpdateRendererDirty())),e.flatShading!==void 0||e.wireframe!==void 0||e.side!==void 0)if(Array.isArray(this.material))for(let a=0;a<this.material.length;a++)this.material[a]=this.material[a].getFlavor(i.flatShading,i.side,i.wireframe);else this.material=this.material.getFlavor(i.flatShading,i.side,i.wireframe,r)}disposeMaterial(){this.material&&$$(this.material).forEach(e=>{e instanceof yf&&(e instanceof pB||e.nodeMaterialDispose())})}dispose(){this.disposeMaterial(),super.dispose()}},r9=new N,n9=new ai,s9=new ai,BLe=new N,a9=new ft,Rn=class extends xy{constructor(e,t,i){super(e,t),this.data=t,this.isSkinnedMesh=!1,this.localGeometry=void 0,t.bindMode&&t.bindMatrix&&(this.bindMode=t.bindMode,this.bindMatrix=new ft().fromArray(t.bindMatrix),this.bindMatrixInverse=new ft)}chooseGeoemtryCache(e){return e.geometryCache}markGeometryAsReachable(e){this.geometryCreateDeleyed instanceof Nt&&this.chooseGeoemtryCache(e).markAsReachable(this.dataPatched.geometry,this.geometryCreateDeleyed)}get geometry(){if(this.localGeometry!==void 0)return this.localGeometry;if(this.geometryCreateDeleyed instanceof i4){let e=this.geometryCreateDeleyed,t=this.chooseGeoemtryCache(e);this.geometryCreateDeleyed=t.get(this.dataPatched.geometry,e,this)}return this.geometryCreateDeleyed}set geometry(e){this.localGeometry=e}get is2DAndNoDepth(){let e=this.dataPatched.geometry;return zA.is2DParametricMesh(e.type)&&e.depth===0}get is2DType(){return zA.is2DParametricMesh(this.geometry.userData.type)}get isNonParametric(){return this.geometry.userData.type==="NonParametricGeometry"}updateByPatchedOp(e,t,i){super.updateByPatchedOp(e,t,i),pr(e.path,["geometry"])&&this.updateByPatchedOpGeometry(fs.drop(e,1),t.geometry,i)}removeInteractionGeometry(e){var t;(t=this.localGeometry)==null||t.dispose(),this.localGeometry=void 0}updateGeometryInteractions(e,t){var r;this.invalidateDownstreamBooleanData();let i=this.data.geometry.type;if(i==="NonParametricGeometry"||i==="SubdivGeometry"){let n=e;if(this.localGeometry===void 0){let c={...this.data.geometry,...n};this.localGeometry=Yw(c,t,this.data.flatShading,this)}let s,a,o;n.scaleBaked?[s,a,o]=n.scaleBaked:{width:s,height:a,depth:o}=n;let l=this.localGeometry.userData;l.sxPrev!==void 0&&lB(this.localGeometry.attributes,s/l.sxPrev,a/l.syPrev,o/l.szPrev),l.sxPrev=s,l.syPrev=a,l.szPrev=o}else{let n={...this.data.geometry,...e};(r=this.localGeometry)==null||r.dispose(),this.localGeometry=Yw(n,t,this.data.flatShading,this)}}refreshAttachedClonersInteractions(){for(let e of this.attachedSurfaceCloners)e.update()}refreshAttachedCloners(e){for(let t of this.attachedSurfaceCloners)e.scene.addPendingUpdateCloner(t.object)}refreshAttachedPaths(e){for(let t of this.attachedPaths)e.scene.addPendingCommand(()=>t.updateShape())}createGeometryDelayed(e){this.geometryCreateDeleyed=e.shared,this.refreshAttachedCloners(e),this.refreshAttachedPaths(e)}updateByPatchedOpGeometry(e,t,i){var n;let r=!1;e.type===0&&e.path.length===0&&Object.keys(e.props).includes("scaleBaked")&&this.geometryCreateDeleyed instanceof Aa&&this.chooseGeoemtryCache(i.shared).mutateIfUnique(this.geometryCreateDeleyed.data,t)===this.geometryCreateDeleyed&&(r=!0,this.geometryCreateDeleyed.mutateDirectlyScaleBaked(t,e.props.scaleBaked),this.refreshAttachedCloners(i),this.refreshAttachedPaths(i)),r||((n=i.scene)==null||n.markGeometryCacheDirty(),this.createGeometryDelayed(i)),this.resetBBoxNeedsUpdate(),this.invalidateDownstreamBooleanData()}updateGeometryOnStateUpdate(e,t){this.createGeometryDelayed(t)}updateState(e,t){e.geometry!==void 0&&this.updateGeometryOnStateUpdate(e.geometry,t);let i=e.morphTargetInfluences;if(i){this.updateMorphTargets(),this.geometry.morphTargetsRelative=!0;for(let{data:{name:r,value:n}}of i)this.updateMorphInfluences(r,t.shared.getVariable(n,[this.uuid,"morphTargetInfluences",r]))}super.updateState(e,t)}updateMorphInfluences(e,t){if(this.morphTargetDictionary===void 0)return;let i=this.morphTargetDictionary[e];i!==void 0&&(this.morphTargetInfluences[i]=t)}updateGeometryGroupsIfNeeded(){var e;Array.isArray(this.material)&&this.geometry.groups.length===0&&this.geometry.addGroup(0,Math.max(((e=this.geometry.getIndex())==null?void 0:e.count)??0,this.geometry.getAttribute("position").count),0)}updateEntityBoxSize(e,t){let i=this.geometry.userData.parameters;this.is2DType?e.set(0,0,i.depth*.5):this.isNonParametric?(e.setScalar(0),this.geometry.boundingSphere&&e.copy(this.geometry.boundingSphere.center),t.set(i.width,i.height,i.depth??0).multiplyScalar(.5)):i.centerOffset?e.fromArray(i.centerOffset):e.setScalar(0),t.set(i.width,i.height,i.depth??0).multiplyScalar(.5)}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"&&this.bindMatrixInverse.copy(this.bindMatrix).invert()}bind(e,t){this.skeleton=e,this.isSkinnedMesh=!0,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(e){let t=new ai,i=this.geometry.attributes.skinWeight;for(let r=0,n=i.count;r<n;r++){t.fromBufferAttribute(i,r);let s=1/t.manhattanLength();s!==1/0?t.multiplyScalar(s):t.set(1,0,0,0),i.setXYZW(r,t.x,t.y,t.z,t.w)}}boneTransform(e,t){let i=this.skeleton;if(i===void 0)return;let r=this.geometry;n9.fromBufferAttribute(r.attributes.skinIndex,e),s9.fromBufferAttribute(r.attributes.skinWeight,e),r9.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let n=0;n<4;n++){let s=s9.getComponent(n);if(s!==0){let a=n9.getComponent(n);a9.multiplyMatrices(i.bones[a].matrixWorld,i.boneInverses[a]),t.addScaledVector(BLe.copy(r9).applyMatrix4(a9),s)}}return t.applyMatrix4(this.bindMatrixInverse)}};function FLe(e){var a,o;if(e.geometry.attributes.extrudeNormal||!e.geometry.attributes.position||!e.geometry.attributes.normal)return;let t=new Map,i=e.geometry.attributes,r=i.position.array,n=i.normal.array,s=new Float32Array(r.length);for(let l=0;l<r.length;l+=3){let c=`${r[l]}_${r[l+1]}_${r[l+2]}`,u=new N(n[l],n[l+1],n[l+2]);t.has(c)?(a=t.get(c))==null||a.normals.push(u):t.set(c,{normals:[u],result:new N})}t.forEach((l,c)=>{for(let u of l.normals)l.result.add(u);l.result.divideScalar(l.normals.length)});for(let l=0;l<r.length;l+=3){let c=`${r[l]}_${r[l+1]}_${r[l+2]}`,u=(o=t.get(c))==null?void 0:o.result;u&&(s[l]=u.x,s[l+1]=u.y,s[l+2]=u.z)}e.geometry.setAttribute("extrudeNormal",new _t(s,3))}function ULe(e){if(e.geometry.attributes.extrudeNormals||!e.geometry.attributes.position)return;let t=e.geometry.attributes.position.array,i=new Float32Array(t.length),r=new N;for(let n=0;n<t.length;n+=3)r.set(t[n],t[n+1],t[n+2]).normalize(),i[n]=r.x,i[n+1]=r.y,i[n+2]=r.z;e.geometry.setAttribute("extrudeNormal",new _t(i,3))}function r4(e){if(Array.isArray(e.material)){for(let t of e.material)if(t.getLayersOfType("outline").length===0)return}else if(!(e.material instanceof yf)||e.material.getLayersOfType("outline").length===0)return;e instanceof Rn&&e.is2DAndNoDepth?ULe(e):FLe(e)}function n4(e){if(!e.geometry.attributes.position)return;let t=e.geometry.attributes.position.array,i=new Float32Array(t.length),r=parseInt(e.uuid.replace(/\D/g,"")),n=[Tt.seededRandom(r),Tt.seededRandom(r+1e4),Tt.seededRandom(r+2e4)];for(let s=0;s<t.length;s++)i[s]=n[s%3];e.geometry.setAttribute("randomColor",new Qt(i,3))}var Ac=new vn,M1=new N;function NLe(e){let t=!1;return e.scene.objects.traverse((i,r)=>{r.type==="Mesh"&&r.geometry.type==="SubdivGeometry"&&(t=!0)}),t}var Qw=class extends Rn{constructor(e,t,i){super(e,t,i),this.data=t,this.hiddenMatrixOld=new ft,this.smoothShading=!0,this.skipReactionUpdate=!1}chooseGeoemtryCache(e){return this.dataPatched.flatShading?e.geometryCache:e.geometryCache2}get subdivPointerNew(){return this.localGeometry!==void 0?this.subdivPointer:this.geometry.ensureSubdivPointer()}get originalGeometryNew(){return this.localGeometry!==void 0?this.originalGeometry:this.geometry.originalGeometry}get phongAngle(){return this.data.geometry.phongAngle??45}updateEntityBoxSize(e,t){let i=this.geometry.userData.parameters;e.copy(this.originalGeometryNew.boundingSphere.center),t.set(i.width,i.height,i.depth??0).multiplyScalar(.5)}createGeometryByControls(e){var s,a,o;if(this.skipReactionUpdate===!0)return;let t=(s=this.localGeometry)==null?void 0:s.uuid,{originalGeometry:i,subdividedGeometry:r,subdivPointer:n}=Aa.build(e,this.subdivPointer,this.smoothShading,this.hasNonUniformScale?this.shearScale:void 0);this.subdivPointer=n,i!==void 0&&((a=this.originalGeometry)==null||a.dispose(),this.originalGeometry=i),r!==void 0&&((o=this.subdividedGeometry)==null||o.dispose(),this.subdividedGeometry=r??void 0),this.localGeometry=this.subdividedGeometry??this.originalGeometry,r4(this),n4(this),this.calcBoundingBox(),t&&(this.localGeometry.uuid=t)}updateState(e,t){if(super.updateState(e,t),e.flatShading!==void 0){let i=this.material;this.material=Array.isArray(i)?i.map(r=>r.getFlavor(!1,r.side,r.wireframe)):i.getFlavor(!1,i.side,i.wireframe),this.smoothShading=!e.flatShading,this.createGeometryDelayed(t)}}updateMesh(e=!1){Aa.buildLevel(this.subdivPointer,!0,this.smoothShading?this.phongAngle:-1,this.originalGeometry,e&&this.hasNonUniformScale?this.shearScaleInv:void 0),this.subdividedGeometry&&Aa.buildLevel(this.subdivPointer,!1,this.smoothShading?this.phongAngle:-1,this.subdividedGeometry,e&&this.hasNonUniformScale?this.shearScaleInv:void 0)}updateTopology(){this.originalGeometry.dispose(),this.originalGeometry=Aa.buildLevel(this.subdivPointer,!0,this.smoothShading?this.phongAngle:-1),this.subdividedGeometry&&(this.subdividedGeometry.dispose(),this.subdividedGeometry=Aa.buildLevel(this.subdivPointer,!1,this.smoothShading?this.phongAngle:-1)),this.localGeometry=this.subdividedGeometry??this.originalGeometry}raycast(e,t){let i=this.localGeometry;this.localGeometry=this.originalGeometryNew,za.prototype.raycast.call(this,e,t),this.localGeometry=i}activateSVDCompensation(){!this.hasNonUniformScale||(this.matrix.copy(this.matrixWorldRigid),this.hiddenMatrixOld.copy(this.hiddenMatrix),this.hiddenMatrix.copy(this.parent.matrixWorld).invert())}deactivateSVDCompensation(){!this.hasNonUniformScale||(this.updateMatrix(),this.hasNonUniformScale=void 0,this.hiddenMatrix.copy(this.hiddenMatrixOld))}calcBoundingBox(){let e=this.originalGeometry;e.boundingSphere===null&&(e.boundingSphere=new uo,this.subdividedGeometry&&(this.subdividedGeometry.boundingSphere=e.boundingSphere));let t=e.attributes.position,i=e.boundingSphere.center;Ac.setFromBufferAttribute(t),Ac.getCenter(i),e.boundingSphere.radius=i.distanceTo(Ac.max),isNaN(e.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this),Ac.getSize(M1),this.hasNonUniformScale&&M1.divide(this.scale);let r={width:M1.x,height:M1.y,depth:M1.z};return this.geometry.userData.parameters=r,r}updateBoundingSphere(e){let t=this.originalGeometry;Ac.min.set(e[0],e[2],e[4]),Ac.max.set(e[1],e[3],e[5]),this.hasNonUniformScale&&(Ac.min.applyMatrix4(this.shearScaleInv),Ac.max.applyMatrix4(this.shearScaleInv)),t.boundingSphere===null&&(t.boundingSphere=new uo);let i=t.boundingSphere.center;Ac.getCenter(i),t.boundingSphere.radius=i.distanceTo(Ac.max)}freeSubdivPointer(){var e,t;this.subdivPointer&&(Aa.freeSubdivPointer(this.subdivPointer),this.subdivPointer=0),this.localGeometry=void 0,(e=this.originalGeometry)==null||e.dispose(),(t=this.subdividedGeometry)==null||t.dispose()}dispose(){super.dispose(),this.freeSubdivPointer()}updateByPatchedOpGeometry(e,t,i){super.updateByPatchedOpGeometry(e,t,i),this.localGeometry&&this.createGeometryByControls(t)}},o9=-1,kLe=1,VLe={x:[1,0,0],"-x":[-1,0,0],y:[0,1,0],"-y":[0,-1,0],z:[0,0,1],"-z":[0,0,-1]},GLe={polygon_center:0,edge:1,vertex:2},vM=(e,t)=>(i,r)=>!t||i===0||e===0?0:e*r/100,gi=(e,t)=>{let i=Math.abs(t),r=i*-1;return(e-o9)*(i-r)/(kLe-o9)+r},HLe=new N,yM=new N,jLe=new N,WLe=new N;function g0(e,t){let i=jLe.fromArray(e),r=WLe.fromArray(t);yM.copy(r).sub(i);let n=yM.length();return yM.normalize().multiplyScalar(n*.5),HLe.copy(i).add(yM).toArray()}var ul=new Rs,xM=new N,JA=new N,Bp=new N;function XLe(e){let t=[];for(let i=0;i<=e.index.count;i++)if(xM.fromArray(e.index.array,i*3),ul.setFromAttributeAndIndices(e.attributes.position,xM.x,xM.y,xM.z),ul.getNormal(JA),ul.getMidpoint(Bp),!(isNaN(Bp.x)||isNaN(Bp.y)||isNaN(Bp.z))){let{a:r,b:n,c:s}=ul,a=r.toArray(),o=n.toArray(),l=s.toArray(),c=r.distanceTo(n),u=n.distanceTo(s),h=s.distanceTo(r),d=g0(a,o),f=g0(o,l),p=g0(l,a),v=[c,u,h],m=Math.max(...v),g=v.filter(_=>Math.round(_)===Math.round(m)).length>1,y=[],x=ul.getMidpoint(Bp).toArray();m===c&&!g&&(y=[f,p,p],x=d),m===u&&!g&&(y=[d,p,p],x=f),m===h&&!g&&(y=[d,f,f],x=p),g&&(y=[d,f,p]),t.push({vertices:[a,o,l],faceCenters:y,midpoint:x,norm:ul.getNormal(JA).toArray()})}return t}function qLe(e){let t=[],{position:i}=e.attributes;for(let r=0;r<i.count;r++){ul.setFromAttributeAndIndices(i,r*3,r*3+1,r*3+2),ul.getNormal(JA),ul.getMidpoint(Bp);let n=ul.a.toArray(),s=ul.b.toArray(),a=ul.c.toArray();t.push({vertices:[n,s,a],faceCenters:[g0(n,s),g0(s,a),g0(a,n)],midpoint:Bp.toArray(),norm:JA.toArray()})}return t}var YLe=4,QLe=.5,OR=e=>.5*(1-Math.cos(e*Math.PI)),ZLe=class{constructor(){this.perlin=new Array(4096)}noise(e,t=0,i=0){if(this.perlin==null){this.perlin=new Array(4096);for(let m=0;m<4096;m++)this.perlin[m]=Math.random()}e<0&&(e=-e),t<0&&(t=-t),i<0&&(i=-i);let r=Math.floor(e),n=Math.floor(t),s=Math.floor(i),a=e-r,o=t-n,l=i-s,c,u,h=0,d=.5,f,p,v;for(let m=0;m<YLe;m++){let g=r+(n<<4)+(s<<8);c=OR(a),u=OR(o),f=this.perlin[g&4095],f+=c*(this.perlin[g+1&4095]-f),p=this.perlin[g+16&4095],p+=c*(this.perlin[g+16+1&4095]-p),f+=u*(p-f),g+=256,p=this.perlin[g&4095],p+=c*(this.perlin[g+1&4095]-p),v=this.perlin[g+16&4095],v+=c*(this.perlin[g+16+1&4095]-v),p+=u*(v-p),f+=OR(l)*(p-f),h+=f*d,d*=QLe,r<<=1,a*=2,n<<=1,o*=2,s<<=1,l*=2,a>=1&&(r++,a--),o>=1&&(n++,o--),l>=1&&(s++,l--)}return h}noiseSeed(e){let t=(()=>{let i,r;return{setSeed(n){r=i=(n??Math.random()*4294967296)>>>0},getSeed(){return i},rand(){return r=(1664525*r+1013904223)%4294967296,r/4294967296}}})();t.setSeed(e),this.perlin=new Array(4096);for(let i=0;i<4096;i++)this.perlin[i]=t.rand()}},KLe=ZLe,l9=new N,c9=new ft,u9=new sy;function h9(e){let t=!1;return e.scene.objects.traverse((i,r)=>{r.type==="Mesh"&&(r.geometry.type==="TextGeometry"||r.geometry.type==="InputGeometry")&&(t=!0)}),t}var s4=class extends Rn{constructor(e,t,i){super(e,t,i),this.data=t}get textGeometry(){return this.geometry}get charWidths(){return this.textGeometry.charWidths}get charCoords(){return this.textGeometry.charCoords}get wrappedText(){return this.textGeometry.wrappedText}get font(){return this.textGeometry.font}get initialOffsetY(){var t;let e=this.dataPatched;return((t=this.font)==null?void 0:t.getLineInitialOffsetY(this.lineHeight,this.wrappedText.length,e.geometry.height,this.fontScale,e.geometry.verticalAlign))??0}get fontScale(){let e=this.dataPatched;return this.font?e.geometry.fontSize/this.font.unitsPerEm:1}get AD(){return Math.abs(this.ascender-this.descender)}get ascender(){var e;return(((e=this.font)==null?void 0:e.ascender)??1)*this.fontScale}get descender(){var e;return(((e=this.font)==null?void 0:e.descender)??1)*this.fontScale}get lineHeight(){let e=this.dataPatched;return e.geometry.fontSize*e.geometry.lineHeight}raycast(e,t){let{matrixWorld:i}=this;if(!(isNaN(e.ray.origin.x)||this.scale.x===0||this.scale.y===0||this.scale.z===0)&&(c9.copy(i).invert(),u9.copy(e.ray).applyMatrix4(c9),u9.intersectBox(this.singleBBox,l9))){let r=l9.applyMatrix4(i),n=e.ray.origin.distanceTo(r);t.push({distance:n,point:r.clone(),object:this})}}},wa=1e-4,Tc,rie,nie,sie,d9=new N,f9=new N;pte.then(e=>{Tc=e,rie=[Tc.get_face_center,Tc.get_edge_midpoint,Tc.get_vertex_position],nie=[Tc.get_face_normal,Tc.get_edge_normal,Tc.get_vertex_normal],sie=[Tc.face_count,Tc.edge_count,Tc.vertex_count]});var JLe=new ft,$Le=new ft,ad=new N,wM=new N,E1=new N,zR=new N,eOe=new N,tOe=new N,iOe=class{constructor(e,t){this.data=e,this.is3D=t,this.perlin=new KLe,e.noiseType==="perlin"?(this.perlin.noiseSeed(e.seed),t?this.noise=(i,r,n)=>this.perlin.noise(i,r,n):this.noise=i=>this.perlin.noise(i)):t?this.noise=D3e((0,$z.default)(e.seed)):this.noise=P3e((0,$z.default)(e.seed))}},fl=class extends kN(rr){constructor(e,t){super(),this.parameters=t,this.objectForSample=void 0,this._pendingMediaLoad=!1,this.random=null,this.object=e}resetOnMove(){this.removeFromParent(),this.parent=null}expandClones(e){if(this.parent===null)this.updateState(this.parameters,e);else for(let t of this.children)t instanceof Os&&t.expand()}invalidateTransform(e){this.matrixWorldNeedsUpdate=!0,this.traverse(t=>{t instanceof Os&&t.object===e&&(t.matrixWorldNeedsUpdate=!0)})}onObjUpdateMatrix(){this.parameters.type!=="toObject"&&(this.matrixWorldNeedsUpdate=!0)}update(){switch(this._updateCount(),this.parameters.type){case"radial":this._updateRadial(this.parameters);break;case"linear":this._updateLinear(this.parameters);break;case"grid":this._updateGrid(this.parameters);break;case"toObject":this._updateToObject(this.parameters)}for(let e of this.children)e.updateMatrix(),e.hasNonUniformScale&&(e.updateMatrixWorld(),e.updateMatrixWorldSVD())}_updateCount(e){let t;if(e!==void 0?t=e:t=this.parameters.type==="grid"?Math.round(this.parameters.grid.count[0])*Math.round(this.parameters.grid.count[1])*Math.round(this.parameters.grid.count[2]):this.parameters.count,this.parameters.type==="toObject"){if(!this.parameters.toObject.object)t=0;else if(e===void 0&&this.parameters.toObject.spreadType!=="random")return}if(this.parameters.type==="toObject"&&this.objectForSample){let i=this.children;if(i.length===t)return;if(i.length<t)for(let r=0,n=t-i.length;r<n;++r){let s=new Os(this.object);s.expand(),this.add(s)}else for(let r=0,n=i.length-t;r<n;++r)this.remove(i[r])}else{if(this.children.length===t)return;if(this.children.length<t)for(let i=0,r=t-this.children.length;i<r;++i){let n=new Os(this.object);n.expand(),this.add(n)}else for(let i=0,r=this.children.length-t;i<r;++i)this.remove(this.children[i])}}getRandom(e,t=!1){return(this.random===null||this.random.data.seed!==e.seed||this.random.is3D!==t)&&(this.random=new iOe(e,t)),this.random}_updateRadial(e){let t=e.radial,i=t.start*Tt.DEG2RAD,r=t.end*Tt.DEG2RAD,n=i-r,s=new Wn(t.rotation[0],t.rotation[1],t.rotation[2]),a;switch(t.axis){case"z":a=new N(0,0,1);break;case"y":a=new N(0,1,0);break;default:case"x":a=new N(1,0,0);break}let o=e.randomnessObject??kd.defaultData([1,1,1]).randomnessObject,l=this.getRandom(o),c=vM(o.strength,this.parameters.randomness);for(let[u,h]of this.children.entries()){let d=u*(o.freqScale/10)+o.movement,f=l.noise(d,d,d),p=u+1;h.scale.x=t.scale[0]+c(p,gi(f,o.scale[0]))||wa,h.scale.y=t.scale[1]+c(p,gi(f,o.scale[1]))||wa,h.scale.z=t.scale[2]+c(p,gi(f,o.scale[2]))||wa,h.position.setScalar(0);let v=n/e.count*u-i;switch(t.axis){case"x":h.rotation.set(0,v,0);break;case"y":h.rotation.set(0,0,v);break;case"z":h.rotation.set(v,0,0);break}h.translateOnAxis(a,t.radius),h.position.x+=t.position[0]+c(p,gi(f,o.position[0])),h.position.y+=t.position[1]+c(p,gi(f,o.position[1])),h.position.z+=t.position[2]+c(p,gi(f,o.position[2]));let m=c(p,gi(f,o.rotation[0])),g=c(p,gi(f,o.rotation[1])),y=c(p,gi(f,o.rotation[2]));t.alignment===!0?(h.rotation.x+=s.x+m,h.rotation.y+=s.y+g,h.rotation.z+=s.z+y):h.rotation.set(s.x+m,s.y+g,s.z+y)}}_updateLinear(e){if(e.type!=="linear")throw new Error;let t=e.linear,i=new Wn(t.rotation[0],t.rotation[1],t.rotation[2]),r=e.randomnessObject??kd.defaultData([1,1,1]).randomnessObject,n=this.getRandom(r),s=vM(r.strength,this.parameters.randomness);for(let[a,o]of this.children.entries()){let l=a*(r.freqScale/10)+r.movement,c=n.noise(l,l,l),u=a+1,h=s(u,gi(c,r.rotation[0])),d=s(u,gi(c,r.rotation[1])),f=s(u,gi(c,r.rotation[2]));o.scale.x=1+(t.scale[0]-1)*a+s(u,gi(c,r.scale[0]))||wa,o.scale.y=1+(t.scale[1]-1)*a+s(u,gi(c,r.scale[1]))||wa,o.scale.z=1+(t.scale[2]-1)*a+s(u,gi(c,r.scale[2]))||wa,o.rotation.x=i.x*a+h,o.rotation.y=i.y*a+d,o.rotation.z=i.z*a+f,o.position.x=t.position[0]*a+s(u,gi(c,r.position[0])),o.position.y=t.position[1]*a+s(u,gi(c,r.position[1])),o.position.z=t.position[2]*a+s(u,gi(c,r.position[2]))}}_updateGrid(e){let t=0,i=e.grid,r=e.randomnessObject??kd.defaultData([1,1,1]).randomnessObject,n=this.getRandom(r,!0),s=vM(r.strength,this.parameters.randomness);if(i.useCenter===!0){let a={x:i.count[0]%2===0?2:1,y:i.count[1]%2===0?2:1,z:i.count[2]%2===0?2:1},o=new N(i.size[0]*(i.count[0]-a.x)*.5,i.size[1]*(i.count[1]-a.y)*.5,i.size[2]*(i.count[2]-a.z)*.5);for(let l=0;l<i.count[0];l++)for(let c=0;c<i.count[1];c++)for(let u=0;u<i.count[2];u++){let h=n.noise((l+1)*(r.freqScale/10)+r.movement,(c+1)*(r.freqScale/10)+r.movement,(u+1)*(r.freqScale/10)+r.movement),d=this.children[t++];d.scale.x=1+s(t,gi(h,r.scale[0]))||wa,d.scale.y=1+s(t,gi(h,r.scale[1]))||wa,d.scale.z=1+s(t,gi(h,r.scale[2]))||wa;let f=s(t,gi(h,r.rotation[0])),p=s(t,gi(h,r.rotation[1])),v=s(t,gi(h,r.rotation[2]));d.rotation.set(f,p,v),d.position.x=i.size[0]*l-o.x+s(t,gi(h,r.position[0])),d.position.y=i.size[1]*c-o.y+s(t,gi(h,r.position[1])),d.position.z=i.size[2]*u-o.z+s(t,gi(h,r.position[2]))}}else for(let a=0;a<i.count[0];a++)for(let o=0;o<i.count[1];o++)for(let l=0;l<i.count[2];l++){let c=n.noise((a+1)*(r.freqScale/10)+r.movement,(o+1)*(r.freqScale/10)+r.movement,(l+1)*(r.freqScale/10)+r.movement),u=this.children[t++];u.scale.x=1+s(t,gi(c,r.scale[0]))||wa,u.scale.y=1+s(t,gi(c,r.scale[1]))||wa,u.scale.z=1+s(t,gi(c,r.scale[2]))||wa;let h=s(t,gi(c,r.rotation[0])),d=s(t,gi(c,r.rotation[1])),f=s(t,gi(c,r.rotation[2]));u.rotation.set(h,d,f),u.position.x=i.size[0]*a+s(t,gi(c,r.position[0])),u.position.y=-i.size[1]*o+s(t,gi(c,r.position[1])),u.position.z=-i.size[2]*l+s(t,gi(c,r.position[2]))}}_updateToObject(e){var u;if(e.type!=="toObject")throw new Error;let{toObject:t}=e,i=new Wn(t.rotation[0],t.rotation[1],t.rotation[2]),r=e.randomnessObject??kd.defaultData([1,1,1]).randomnessObject,n=this.getRandom(r),s=vM(r.strength,this.parameters.randomness);if(!t.object){for(let[,h]of this.children.entries())h.position.set(0,0,0),h.scale.setScalar(1),h.rotation.set(0,0,0);this.objectForSample=void 0;return}if(!this.objectForSample)return;if(this.objectForSample instanceof s4)if(!((u=this.objectForSample.font)!=null&&u.isLoaded)||this.objectForSample.geometry.attributes.position===void 0){this._pendingMediaLoad=!0;return}else this._pendingMediaLoad=!1;if(this.objectForSample.geometry===void 0&&this.objectForSample.isAncestorOf(this.object.uuid)){console.warn(`Oh no! The object "${this.object.name}" (${this.object.uuid}) seem to be a child/descendant of the object it's being cloned to. Please re-parent it so that they are siblings instead.`);return}let a=this.getSubdivData();if(a.length>0){let h=Math.round(a.length*t.count/100);this._updateCount(h)}else{let h=this.objectForSample.geometry.getAttribute("position");if(!h||isNaN(h.count)||h.count===0){console.warn(`Oh no! The object "${this.object.name}" (${this.object.uuid}) cannot be cloned on the surface of "${this.objectForSample.name}" (${this.objectForSample.uuid}) because the latter does not have a valid geometry.`);return}}this.objectForSample.updateMatrixWorld();let o=new R3e(this.objectForSample).build(),l=VLe[t.axis],c=this.children;o.setRandomGenerator((0,$z.default)(this.object.uuid+t.seed));for(let[h,d]of c.entries()){let f=h*(r.freqScale/10)+r.movement,p=n.noise(f,f,f),v=h+1,m=s(v,gi(p,r.rotation[0])),g=s(v,gi(p,r.rotation[1])),y=s(v,gi(p,r.rotation[2]));t.spreadType==="random"?o.sample(E1,zR):(a.length&&(E1.fromArray(a[h].pos),zR.fromArray(a[h].norm)),this.objectForSample instanceof Qw&&E1.applyMatrix4(JLe.copy(this.objectForSample.matrixWorld).invert())),E1.applyMatrix4(this.object.hiddenMatrix.clone().invert()),d.position.copy(E1),ad.fromArray(l);let x=t.align==="normal"?zR:this.object.getWorldDirection(tOe),_=wM.fromArray(t.position);wM.x+=s(v,gi(p,r.position[0])),wM.y+=s(v,gi(p,r.position[1])),wM.z+=s(v,gi(p,r.position[2]));let M=Math.acos(x.dot(ad)),S=eOe.crossVectors(ad,x).normalize(),T=$Le.makeRotationAxis(S,M),E=x.clone().cross(this.object.up).normalize(),C=E.clone().cross(x).normalize(),A=new ft().makeBasis(E,x,C),D=new N(ad.y,ad.z,ad.x).normalize(),R=D.clone().cross(ad).normalize(),L=new ft().makeBasis(D,ad,R).invert(),O=new ft().multiplyMatrices(A,L);d.rotation.setFromRotationMatrix(O),_.applyMatrix4(T),d.position.add(_),d.rotation.x=d.rotation.x+i.x+m,d.rotation.y=d.rotation.y+i.y+g,d.rotation.z=d.rotation.z+i.z+y,d.scale.setScalar(1),d.scale.x=d.scale.x+t.scale[0]+s(v,gi(p,r.scale[0]))||wa,d.scale.y=d.scale.y+t.scale[1]+s(v,gi(p,r.scale[1]))||wa,d.scale.z=d.scale.z+t.scale[2]+s(v,gi(p,r.scale[2]))||wa,d.scale.multiply(this.object.scale),d.hiddenMatrix=this.object.hiddenMatrix}}getSubdivData(){if(!this.objectForSample)return[];let e=this.parameters.toObject.spreadType,t=new Map,i=(n,s)=>{let a=Math.round(n[0]*1e4)+"_"+Math.round(n[1]*1e4)+"_"+Math.round(n[2]*1e4),o=t.get(a);o?(o.pos[0]+=n[0],o.pos[1]+=n[1],o.pos[2]+=n[2],o.norm[0]+=s[0],o.norm[1]+=s[1],o.norm[2]+=s[2],o.count+=1):t.set(a,{pos:[...n],norm:[...s],count:1})};if(e==="random")return[];if(this.objectForSample instanceof Qw){let n=this.objectForSample,s=GLe[e],a=sie[s],o=rie[s],l=nie[s],c=a(n.subdivPointerNew);for(let u=0;u<=c-1;u++){let h=o(n.subdivPointerNew,u),d=l(n.subdivPointerNew,u);d9.fromArray(h).applyMatrix4(n.matrixWorld),f9.fromArray(d),i(d9.toArray(),f9.toArray())}}else(this.objectForSample.geometry.index?XLe(this.objectForSample.geometry):qLe(this.objectForSample.geometry)).forEach((n,s)=>{e==="polygon_center"&&i(n.midpoint,n.norm),e==="vertex"&&(i(n.vertices[0],n.norm),i(n.vertices[1],n.norm),i(n.vertices[2],n.norm)),e==="edge"&&(i(n.faceCenters[0],n.norm),i(n.faceCenters[1],n.norm),i(n.faceCenters[2],n.norm))});let r=Array.from(t.values());for(let n of r)n.pos[0]/=n.count,n.pos[1]/=n.count,n.pos[2]/=n.count,n.norm[0]/=n.count,n.norm[1]/=n.count,n.norm[2]/=n.count;return r}updateState(e,t){var i;if(this.parameters=zC(e),this.parameters.type!=="toObject")(this.parent===null||this.parent!==this.object)&&(this.removeFromParent(),(i=this.object.parent)==null||i.add(this),this.matrix=this.object.matrix,this.hiddenMatrix=this.object.hiddenMatrix,this.matrixWorldNeedsUpdate=!0,this.matrixAutoUpdate=!1);else if(this.parent===null||this.parent.uuid!==this.parameters.toObject.object){this.removeFromParent();let r=t.find(this.parameters.toObject.object);r instanceof za?this.objectForSample=r:this.objectForSample=void 0,this.matrix=new ft,this.hiddenMatrix=new ft,this.matrixWorldNeedsUpdate=!0,this.matrixAutoUpdate=!1,r&&r.add(this)}this.update()}get pendingMediaLoad(){return this._pendingMediaLoad}},Ub=e=>{var t;return t=class extends e{},t.geometryHelper=new ac(30,30,30),t},bM=new sy,BR=new uo,p9=new ft,Nb=(e,t,i,r,n=!1,s=e)=>{let a=t,o=s.matrixWorld;if(a.boundingSphere===null&&a.computeBoundingSphere(),BR.copy(a.boundingSphere),BR.applyMatrix4(o),i.ray.intersectsSphere(BR)===!1||(p9.copy(o).invert(),bM.copy(i.ray).applyMatrix4(p9),a.boundingBox!==null&&bM.intersectsBox(a.boundingBox)===!1))return;let l,c,u,h,d=a.index,f=a.attributes.position,p=a.drawRange,v,m;if(n===!1){let y=Math.max(0,p.start),x=Math.min(d.count,p.start+p.count);for(v=y,m=x;v<m;v+=3)if(c=d.getX(v),u=d.getX(v+1),h=d.getX(v+2),l=g(e,i,bM,f,c,u,h),l){l.faceIndex=Math.floor(v/3),r.push(l);return}}else{let y=a.attributes.position,x=new N,_=new N,M=new N,S=new N,T=2,E=1/((s.scale.x+s.scale.y+s.scale.z)/3),C=E*E,A=Math.max(0,p.start),D=Math.min(y.count,p.start+p.count);for(let R=A,L=D-1;R<L;R+=T){if(x.fromBufferAttribute(y,R),_.fromBufferAttribute(y,R+1),bM.distanceSqToSegment(x,_,S,M)>C)continue;S.applyMatrix4(s.matrixWorld);let O=i.ray.origin.distanceTo(S);O<i.near||O>i.far||r.push({distance:O,point:M.clone().applyMatrix4(s.matrixWorld),object:e})}}function g(y,x,_,M,S,T,E){let C=new N,A=new N,D=new N,R=new N,L=new N;if(C.fromBufferAttribute(M,S),A.fromBufferAttribute(M,T),D.fromBufferAttribute(M,E),_.intersectTriangle(C,A,D,!1,R)===null)return null;L.copy(R),L.applyMatrix4(y.matrixWorld);let O=x.ray.origin.distanceTo(L);return O<x.near||O>x.far?null:{faceIndex:1,distance:O,point:L.clone(),object:y}}},_M=new N,$o=new Cf,rOe=class extends Pb{constructor(e){let t=new Nt,i=new Pf({color:16777215,vertexColors:!0,toneMapped:!1}),r=[],n=[],s={},a=new Yt(15711266),o=new Yt(15711266),l=new Yt(2857471);c("n1","n2",a),c("n2","n4",a),c("n4","n3",a),c("n3","n1",a),c("f1","f2",a),c("f2","f4",a),c("f4","f3",a),c("f3","f1",a),c("n1","f1",a),c("n2","f2",a),c("n3","f3",a),c("n4","f4",a),c("p","n1",o),c("p","n2",o),c("p","n3",o),c("p","n4",o),c("u1","u2",l),c("u2","u3",l),c("u3","u1",l);function c(h,d,f){u(h,f),u(d,f)}function u(h,d){r.push(0,0,0),n.push(d.r,d.g,d.b),s[h]===void 0&&(s[h]=[]),s[h].push(r.length/3-1)}t.setAttribute("position",new _t(r,3)),t.setAttribute("color",new _t(n,3)),super(t,i),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update()}update(){let e=this.geometry,t=this.pointMap;$o.projectionMatrixInverse.elements=[.5112609807824982,-0,-0,-0,-0,.41421356237309503,-0,-0,-0,-0,-0,-.099999,-0,-0,-1.0000000000000002,.100001];let i=1,r=1,n=.8;Dl("n1",t,e,$o,-i,-r,n),Dl("n2",t,e,$o,i,-r,n),Dl("n3",t,e,$o,-i,r,n),Dl("n4",t,e,$o,i,r,n);let s=n;Dl("f1",t,e,$o,-i,-r,s),Dl("f2",t,e,$o,i,-r,s),Dl("f3",t,e,$o,-i,r,s),Dl("f4",t,e,$o,i,r,s);let a=s,o=.5;Dl("u1",t,e,$o,i*.7*o,r*1.1,a),Dl("u2",t,e,$o,-i*.7*o,r*1.1,a),Dl("u3",t,e,$o,0,r*(1.1+.9*o),a),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}};function Dl(e,t,i,r,n,s,a){_M.set(n,s,a).unproject(r);let o=t[e];if(o!==void 0){let l=i.getAttribute("position");for(let c=0,u=o.length;c<u;c++)l.setXYZ(o[c],_M.x,_M.y,_M.z)}}var nOe=class extends Ub(rOe){constructor(e){super(e),this.object=e,this.object=e,this.name=`CombinedCameraHelper: ${e.uuid}`}updateMatrixWorld(e){super.updateMatrixWorld(e),this.updateTarget()}updateTarget(){let e=this.object.getTarget();this.updateWorldMatrix(!0,!1),this.worldToLocal(e)}raycast(e,t){Nb(this.object,this.geometry,e,t,!0)}},gB;(e=>e.is=t=>"objectHelper"in t)(gB||(gB={}));var wy=(e,t)=>class extends VN(e){constructor(){super(...arguments),this.objectHelper=new t(this),this.gizmos={}}get geometryHelper(){return t.geometryHelper}raycast(i,r){this.objectHelper.raycast(i,r)}showGizmos(){for(let i in this.gizmos){let r=this.gizmos[i];r instanceof gA&&(r.visible=!0)}}updateEntityBoxSize(i,r){this.objectHelper.visible&&this.geometryHelper instanceof ac?(i.setScalar(0),r.set(this.geometryHelper.parameters.width,this.geometryHelper.parameters.height,this.geometryHelper.parameters.height).multiplyScalar(.5)):super.updateEntityBoxSize(i,r)}hideGizmos(){for(let i in this.gizmos){let r=this.gizmos[i];r instanceof gA&&(r.visible=!1)}}},SM=790,Ng=new N,FR=new N,UR=new ri,NR=new N,A1=new N,kR=new N,aa=class extends wy(Cf,nOe){constructor(e="",t={...Vw.defaultData,name:""}){super(),this._cameraType="OrthographicCamera",this.targetOffset=N0.DefaultTargetOffset,this.isUpVectorFlipped=!1,this.angleOffsetFromUp=0,this.wasMovedByUser=!1,this.wasMovedBySwitchCameraAction=!1,this.super_Entity(e,t),this.previousProjectionMatrix=new ft,this.matrixAutoUpdate=!0,this.width=window.innerWidth,this.height=window.innerHeight;let i=this.width,r=this.height;this.orthoCamera=new EC(i*-.5,i*.5,r*.5,r*-.5,-5e4,1e4),this.perspCamera=new ta(45,i/r,50,1e4),this.left=this.orthoCamera.left,this.right=this.orthoCamera.right,this.top=this.orthoCamera.top,this.bottom=this.orthoCamera.bottom,this.far=this.orthoCamera.far,this.view=this.orthoCamera.view,this.aspect=this.perspCamera.aspect,this.focus=this.perspCamera.focus,this.filmGauge=this.perspCamera.filmGauge,this.filmOffset=this.perspCamera.filmOffset,this.objectHelper.update()}get isPerspectiveCamera(){return this.cameraType==="PerspectiveCamera"}get isOrthographicCamera(){return!this.isPerspectiveCamera}get cameraType(){return this._cameraType}set fov(e){this.perspCamera.fov=e}get fov(){return this.perspCamera.fov}setNear(e,t){e==="PerspectiveCamera"?this.perspCamera.near=t:this.orthoCamera.near=t}setZoom(e,t){t>=0&&(e==="PerspectiveCamera"?this.perspCamera.zoom=t:this.orthoCamera.zoom=t)}set cameraType(e){e==="PerspectiveCamera"?this.toPerspective():e==="OrthographicCamera"&&this.toOrthographic()}get near(){return this._cameraType==="PerspectiveCamera"?this.perspCamera.near:this.orthoCamera.near}set near(e){this._cameraType==="PerspectiveCamera"?this.perspCamera.near=e:this.orthoCamera.near=e}get zoom(){return this._cameraType==="PerspectiveCamera"?this.perspCamera.zoom:this.orthoCamera.zoom}set zoom(e){e>=0&&(this._cameraType==="PerspectiveCamera"?this.perspCamera.zoom=e:this.orthoCamera.zoom=e)}lookAt(e,t,i){typeof e=="number"&&(e=new N(e,t,i)),super.lookAt(e),this.getWorldPosition(Ng),this.targetOffset=Ng.distanceTo(e)}getTarget(e=new N){return this.getWorldDirection(FR),this.getWorldPosition(Ng),FR.multiplyScalar(this.targetOffset),e.copy(Ng).add(FR),e}getDistanceToTarget(){let e=this.getTarget();return this.getWorldPosition(Ng),Ng.distanceTo(e)}updateUp(){this.getWorldQuaternion(UR),NR.set(0,0,1).applyQuaternion(UR),A1.copy(rr.DEFAULT_UP),this.isUpVectorFlipped&&A1.negate(),A1.applyQuaternion(UR),kR.copy(rr.DEFAULT_UP).projectOnPlane(NR),this.angleOffsetFromUp=kR.angleTo(A1),this.angleOffsetFromUp*=kR.cross(A1).dot(NR)>=0?1:-1}updateTransformState(e,t){let i=super.updateTransformState(e,t);return e.isUpVectorFlipped!==void 0&&(this.isUpVectorFlipped=e.isUpVectorFlipped),this.updateUp(),i}getViewFrontToObject(e){let t=e.getWorldPosition(new N),i=e.getWorldDirection(new N).multiplyScalar(this.targetOffset);return{position:t.clone().add(i),target:t}}getViewToTarget(e){let t=this.getWorldDirection(new N).multiplyScalar(this.targetOffset);return{position:e.clone().sub(t),target:e}}getViewToObject(e){let t=new N;return e.getWorldPosition(t),this.getViewToTarget(t)}setViewplaneSize(e,t,i=!1){if(this.aspect=e/t,i){let r=e>t?this.aspect:1,n=e>t?1:this.aspect;this.left=-SM*.5*r,this.right=SM*.5*r,this.top=SM*.5*(1/n),this.bottom=-SM*.5*(1/n)}else this.left=-e*.5,this.right=e*.5,this.top=t*.5,this.bottom=-t*.5;this.updateProjectionMatrix()}copyViewPlaneSize(e){this.aspect=e.aspect,this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.updateProjectionMatrix()}toOrthographic(){this.orthoCamera.left=this.left,this.orthoCamera.right=this.right,this.orthoCamera.top=this.top,this.orthoCamera.bottom=this.bottom,this.orthoCamera.view=this.view,this.orthoCamera.far=this.far,this.orthoCamera.updateProjectionMatrix(),this.projectionMatrix=this.orthoCamera.projectionMatrix,this.projectionMatrixInverse=this.orthoCamera.projectionMatrixInverse,this._cameraType="OrthographicCamera",this.objectHelper&&this.objectHelper.update()}toPerspective(){this.perspCamera.aspect=this.aspect,this.perspCamera.fov=this.fov,this.perspCamera.view=this.view,this.perspCamera.far=this.far,this.perspCamera.updateProjectionMatrix(),this.projectionMatrix=this.perspCamera.projectionMatrix,this.projectionMatrixInverse=this.perspCamera.projectionMatrixInverse,this._cameraType="PerspectiveCamera",this.objectHelper&&this.objectHelper.update()}setFocalLength(e){this.perspCamera.setFocalLength(e),this.toPerspective()}getFocalLength(){return this.perspCamera.getFocalLength()}getEffectiveFOV(){return this.perspCamera.getEffectiveFOV()}getFilmWidth(){return this.perspCamera.getFilmWidth()}getFilmHeight(){return this.perspCamera.getFilmHeight()}setViewOffset(e,t,i,r,n,s){this._cameraType==="PerspectiveCamera"?this.perspCamera.setViewOffset(e,t,i,r,n,s):this.orthoCamera.setViewOffset(e,t,i,r,n,s)}clearViewOffset(){this._cameraType==="PerspectiveCamera"?(this.perspCamera.clearViewOffset(),this.toPerspective()):(this.orthoCamera.clearViewOffset(),this.toOrthographic())}copyHistory(){this.previousProjectionMatrix&&this.previousProjectionMatrix.copy(this.projectionMatrix)}updateProjectionMatrix(){this._cameraType==="PerspectiveCamera"?this.toPerspective():this._cameraType==="OrthographicCamera"&&this.toOrthographic()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}copy(e,t){return super.copy(e,t),this.parent=e.parent,this.orthoCamera.copy(e.orthoCamera),this.perspCamera.copy(e.perspCamera),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.far=e.far,this.view=e.view===null?null:Object.assign({},e.view),this._cameraType=e._cameraType,this.aspect=e.aspect,this.fov=e.fov,this.focus=e.focus,this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this.targetOffset=e.targetOffset,this.updateProjectionMatrix(),this}toCameraState(e=[]){let t={type:this.cameraType,far:this.far,orthographic:{near:this.orthoCamera.near,zoom:this.orthoCamera.zoom},perspective:{near:this.perspCamera.near,fov:this.perspCamera.fov,zoom:this.perspCamera.zoom},up:this.up.toArray(),targetOffset:this.targetOffset,isUpVectorFlipped:this.isUpVectorFlipped};return lz(t,e)}updateCameraSubtype(e,t){let i=e==="perspective"?"PerspectiveCamera":"OrthographicCamera";t.zoom!==void 0&&this.setZoom(i,t.zoom),t.near!==void 0&&this.setNear(i,t.near),t.fov!==void 0&&i==="PerspectiveCamera"&&(this.fov=t.fov)}updateState(e,t){this.updateCameraState(e,t)}updateCameraState(e,t){this.updateState_Entity(e,t),e.far!==void 0&&(this.far=e.far),e.orthographic!==void 0&&this.updateCameraSubtype("orthographic",e.orthographic),e.perspective!==void 0&&this.updateCameraSubtype("perspective",e.perspective),e.type!==void 0&&(this.cameraType=e.type),e.up!==void 0&&this.up.fromArray(e.up),e.targetOffset!==void 0&&(this.targetOffset=e.targetOffset),e.isUpVectorFlipped!==void 0&&(this.isUpVectorFlipped=e.isUpVectorFlipped),this.updateProjectionMatrix()}updateByPatchedOp(e,t,i){super.updateByPatchedOp(e,t,i),e.path.length===1&&e.type===0&&this.updateCameraSubtype(e.path[0],e.props)}toState(e){return{...super.toState(e),...this.toCameraState(e),type:this.cameraType}}},kg=new ft,sOe=new ft;function m9(e){let t=!1;return e.scene.objects.traverse((i,r)=>{var n;((n=r.geometry)==null?void 0:n.type)==="BooleanGeometry"&&(t=!0)}),t}var Pm=class extends xy{constructor(e,t,i){super(e,t),this.data=t,this.meshSetAddresses=[],this.needsTransformForDownstream=!1,this.geometry=new Nt,this.onAfterRender=(r,n,s,a,o,l)=>{super.onAfterRender(r,n,s,a,o,l),this.recomputeBoolean()},this.geometry.userData.parameters={width:0,height:0,depth:0}}get booleanOp(){return this.data.geometry.operation}get phongAngle(){return this.data.geometry.phongAngle??45}get isLOD(){return this.recomputeBoolean(),!1}updateByPatchedOp(e,t,i){super.updateByPatchedOp(e,t,i),e.path.length===1&&e.path[0]==="geometry"&&e.type===0&&e.props.operation!==void 0&&(this.freeBooleanPointer(),this.resetBBoxNeedsUpdate())}freeBooleanPointer(){super.freeBooleanPointer(),this.geometry.dispose()}recomputeBoolean(e,t=!0){var r;if(this.booleanMeshSetAddress!==-1&&!e)return;for(let n=0;n<this.children.length;n++){let s=this.children[n];s instanceof Pm&&s.dataPatched.visible===!0&&s.recomputeBoolean(e===!0,t)}this.meshSetAddresses=[];for(let n=0;n<this.children.length;n++){let s=this.children[n];if(s instanceof za&&s.dataPatched.visible===!0&&((r=s.geometry.attributes.position)==null?void 0:r.count)>0&&s.geometry.drawRange.count>0&&s.booleanMeshSetAddress!==0){kg.multiplyMatrices(s.hiddenMatrix,s.matrix);try{if(s.booleanMeshSetAddress===-1){if((s.geometry.index??s.geometry.getAttribute("position")).count/3<15e5&&(s.booleanMeshSetAddress=qu.getMeshSet(s.geometry,e===!0,t)),s.booleanMeshSetAddress===-1)return;qu.transformMeshSet(s.booleanMeshSetAddress,kg),s.booleanMatrixInvOld.copy(kg).invert(),s.booleanWasTransformed=!1}else s instanceof Pm&&s.needsTransformForDownstream===!0?(qu.transformMeshSet(s.booleanMeshSetAddress,kg),s.needsTransformForDownstream=!1):s.booleanWasTransformed===!0&&(qu.transformMeshSet(s.booleanMeshSetAddress,sOe.multiplyMatrices(kg,s.booleanMatrixInvOld)),s.booleanMatrixInvOld.copy(kg).invert(),s.booleanWasTransformed=!1)}catch(a){console.error(a),s.booleanMeshSetAddress=0,s.geometry.userData.booleanOperationDidFail=!0;continue}qu.hasOpenEdges(s.booleanMeshSetAddress)===!1||n===this.children.length-1&&this.booleanOp===2?(this.meshSetAddresses.push(s.booleanMeshSetAddress),s.geometry.userData.booleanOperationDidFail=!1):s.geometry.userData.booleanOperationDidFail="openEdges"}}if(this.meshSetAddresses.length===0){this.geometry.setAttribute("position",new _t([],0)),this.geometry.setDrawRange(0,0);return}if(e===!0)return qu.calcBooleanTopological(this.meshSetAddresses,this.booleanOp);let i=this.geometry;i.dispose(),this.geometry=new Nt,this.geometry.userData=i.userData,this.geometry.boundingSphere=i.boundingSphere;try{this.booleanMeshSetAddress=qu.calcBoolean(this.meshSetAddresses,this.booleanOp,this.geometry,this.phongAngle)}catch(n){this.booleanMeshSetAddress=0,this.geometry.userData.booleanOperationDidFail=!0,console.error(n)}this.booleanMatrixInvOld.copy(this.matrix).invert(),this.needsTransformForDownstream=!0,r4(this),n4(this)}dispose(){super.dispose(),this.geometry.dispose()}},vB;(e=>{function t(i){return Fi.is(i)&&i instanceof Ib}e.is=t})(vB||(vB={}));var a4=(e,t)=>class extends wy(e,t){updateState_Light(i,r){this.updateState_Entity(i,r),i.color!==void 0&&(this.color=r.shared.color(i.color)),i.intensity!==void 0&&(this.intensity=i.intensity),i.depth!==void 0&&(this.shadow.camera.far=i.depth,this.shadow.needsUpdate=!0),i.shadows!==void 0&&(this.castShadow=i.shadows)}},ql=e=>e instanceof za,fh=e=>e!==null&&e instanceof Pm,aOe=e=>e instanceof aa,oOe=e=>vB.is(e),yB=e=>gB.is(e),lOe=new N(1,1,1),g9=new N,cOe=new N,v9=new ri,kb=class extends Ub(Qwe){constructor(e,t=15){super(t),this.object=e,this.dummy=new hh,this.object.updateMatrixWorld(),this.name=`EmptyObjectHelper: ${e.uuid}`,this.matrix=this.dummy.matrixWorld,this.matrixAutoUpdate=!1,this.object.isBone&&(this.visible=!1)}raycast(e,t){Nb(this.object,kb.geometryHelper,e,t,!1,this.dummy)}update(){}updateMatrix(){}updateMatrixWorld(e){this.object.matrixWorld.decompose(g9,v9,cOe),this.matrix.compose(g9,v9,lOe),super.updateMatrixWorld(e)}updateWorldMatrix(e,t){}},v0=class extends wy(hh,kb){constructor(e,t){super(),this.super_Entity(e,t),this.objectHelper.update()}updateState(e,t){this.updateState_Entity(e,t),"buffer"in e&&Object.keys(e).length===1&&t.scene.reloadSplats()}},Ux=class extends wy(hh,kb){constructor(e,t,i){super(),this.super_Entity(e,t),this.context=i,this.objectHelper.update()}updateState(e,t){this.updateState_Entity(e,t)}},aie={RED:0,GREEN:1,BLUE:2,ALPHA:3},Vb="varying vec2 vUv;void main(){vUv=position.xy*0.5+0.5;gl_Position=vec4(position.xy,1.0,1.0);}",uOe=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform lowp sampler2D cocBuffer;uniform vec2 texelSize;uniform float scale;uniform vec4 kernel64[32];varying vec2 vUv;void main(){
#ifdef FOREGROUND
vec2 CoCNearFar=texture2D(cocBuffer,vUv).rg;float CoC=CoCNearFar.r*scale;
#else
float CoC=texture2D(cocBuffer,vUv).g*scale;
#endif
if(CoC==0.0){gl_FragColor=texture2D(inputBuffer,vUv);}else{
#ifdef FOREGROUND
vec2 step=texelSize*max(CoC,CoCNearFar.g*scale);
#else
vec2 step=texelSize*CoC;
#endif
vec4 acc=vec4(0.0);for(int i=0;i<32;++i){vec4 kernel=kernel64[i];vec2 uv=step*kernel.xy+vUv;acc+=texture2D(inputBuffer,uv);uv=step*kernel.zw+vUv;acc+=texture2D(inputBuffer,uv);}gl_FragColor=acc/64.0;}}`,MM=class extends ki{constructor(e=!1,t=!1){super({name:"BokehMaterial",defines:{PASS:e?"2":"1"},uniforms:{kernel64:new ct(null),kernel16:new ct(null),inputBuffer:new ct(null),cocBuffer:new ct(null),texelSize:new ct(new Me),scale:new ct(1)},blending:Ln,depthWrite:!1,depthTest:!1,fragmentShader:uOe,vertexShader:Vb}),this.toneMapped=!1,t&&(this.defines.FOREGROUND="1"),this.generateKernel()}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}set cocBuffer(e){this.uniforms.cocBuffer.value=e}setCoCBuffer(e){this.uniforms.cocBuffer.value=e}get scale(){return this.uniforms.scale.value}set scale(e){this.uniforms.scale.value=e}getScale(e){return this.uniforms.scale.value=e}setScale(e){this.uniforms.scale.value=e}generateKernel(){let e=2.39996323,t=new Float32Array(128),i=new Float32Array(32),r=0,n=0;for(let o=0;o<80;++o){let l=o*e,c=Math.sqrt(o)/Math.sqrt(80),u=c*Math.cos(l),h=c*Math.sin(l);o%5===0?(i[n++]=u,i[n++]=h):(t[r++]=u,t[r++]=h)}let s=[],a=[];for(let o=0;o<128;)s.push(new ai(t[o++],t[o++],t[o++],t[o++]));for(let o=0;o<32;)a.push(new ai(i[o++],i[o++],i[o++],i[o++]));this.uniforms.kernel64.value=s,this.uniforms.kernel16.value=a}setTexelSize(e,t){this.uniforms.texelSize.value.set(e,t)}setSize(e,t){this.uniforms.texelSize.value.set(1/e,1/t)}};function y9(e,t,i){return e*(t-i)-t}function xB(e,t,i){return Math.min(Math.max((e+t)/(t-i),0),1)}var hOe=`#include <common>
#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform float focusDistance;uniform float focusRange;uniform float cameraNear;uniform float cameraFar;varying vec2 vUv;float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}void main(){float depth=readDepth(vUv);
#ifdef PERSPECTIVE_CAMERA
float viewZ=perspectiveDepthToViewZ(depth,cameraNear,cameraFar);float linearDepth=viewZToOrthographicDepth(viewZ,cameraNear,cameraFar);
#else
float linearDepth=depth;
#endif
float signedDistance=linearDepth-focusDistance;float magnitude=smoothstep(0.0,focusRange,abs(signedDistance));gl_FragColor.rg=magnitude*vec2(step(signedDistance,0.0),step(0.0,signedDistance));}`,dOe=class extends ki{constructor(e){super({name:"CircleOfConfusionMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new ct(null),focusDistance:new ct(0),focusRange:new ct(0),cameraNear:new ct(.3),cameraFar:new ct(1e3)},blending:Ln,depthWrite:!1,depthTest:!1,fragmentShader:hOe,vertexShader:Vb}),this.toneMapped=!1,this.uniforms.focalLength=this.uniforms.focusRange,this.adoptCameraSettings(e)}get near(){return this.uniforms.cameraNear.value}get far(){return this.uniforms.cameraFar.value}set depthBuffer(e){this.uniforms.depthBuffer.value=e}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e,t=Uh){this.depthBuffer=e,this.depthPacking=t}get focusDistance(){return this.uniforms.focusDistance.value}set focusDistance(e){this.uniforms.focusDistance.value=e}get worldFocusDistance(){return-y9(this.focusDistance,this.near,this.far)}set worldFocusDistance(e){this.focusDistance=xB(-e,this.near,this.far)}getFocusDistance(e){this.uniforms.focusDistance.value=e}setFocusDistance(e){this.uniforms.focusDistance.value=e}get focalLength(){return this.focusRange}set focalLength(e){this.focusRange=e}get focusRange(){return this.uniforms.focusRange.value}set focusRange(e){this.uniforms.focusRange.value=e}get worldFocusRange(){return-y9(this.focusRange,this.near,this.far)}set worldFocusRange(e){this.focusRange=xB(-e,this.near,this.far)}getFocalLength(e){return this.focusRange}setFocalLength(e){this.focusRange=e}adoptCameraSettings(e){e&&(this.uniforms.cameraNear.value=e.near,this.uniforms.cameraFar.value=e.far,e instanceof ta?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}},fOe=`#include <common>
#include <dithering_pars_fragment>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec4 sum=texture2D(inputBuffer,vUv0);sum+=texture2D(inputBuffer,vUv1);sum+=texture2D(inputBuffer,vUv2);sum+=texture2D(inputBuffer,vUv3);gl_FragColor=sum*0.25;
#include <encodings_fragment>
#include <dithering_fragment>
}`,pOe="uniform vec2 texelSize;uniform vec2 halfTexelSize;uniform float kernel;uniform float scale;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vec2 dUv=(texelSize*vec2(kernel)+halfTexelSize)*scale;vUv0=vec2(uv.x-dUv.x,uv.y+dUv.y);vUv1=vec2(uv.x+dUv.x,uv.y+dUv.y);vUv2=vec2(uv.x+dUv.x,uv.y-dUv.y);vUv3=vec2(uv.x-dUv.x,uv.y-dUv.y);gl_Position=vec4(position.xy,1.0,1.0);}",x9=class extends ki{constructor(e=new Me){super({name:"KawaseBlurMaterial",uniforms:{inputBuffer:new ct(null),texelSize:new ct(new Me),halfTexelSize:new ct(new Me),kernel:new ct(0),scale:new ct(1)},blending:Ln,depthWrite:!1,depthTest:!1,fragmentShader:fOe,vertexShader:pOe}),this.toneMapped=!1,this.setTexelSize(e.x,e.y)}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.inputBuffer=e}get scale(){return this.uniforms.scale.value}set scale(e){this.uniforms.scale.value=e}getScale(){return this.uniforms.scale.value}setScale(e){this.uniforms.scale.value=e}getKernel(){return null}get kernel(){return this.uniforms.kernel.value}set kernel(e){this.uniforms.kernel.value=e}setKernel(e){this.kernel=e}setTexelSize(e,t){this.uniforms.texelSize.value.set(e,t),this.uniforms.halfTexelSize.value.set(e,t).multiplyScalar(.5)}setSize(e,t){let i=this.uniforms;i.texelSize.value.set(1/e,1/t),i.halfTexelSize.value.copy(i.texelSize.value).multiplyScalar(.5)}},mOe=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform float opacity;varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=opacity*texel;
#include <encodings_fragment>
}`,gOe=class extends ki{constructor(){super({name:"CopyMaterial",uniforms:{inputBuffer:new ct(null),opacity:new ct(1)},blending:Ln,depthWrite:!1,depthTest:!1,fragmentShader:mOe,vertexShader:Vb}),this.toneMapped=!1}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}getOpacity(e){return this.uniforms.opacity.value}setOpacity(e){this.uniforms.opacity.value=e}},vOe=`varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;
#if THREE_REVISION < 143
#define luminance(v) linearToRelativeLuminance(v)
#endif
#if EDGE_DETECTION_MODE != 0
varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;
#endif
#if EDGE_DETECTION_MODE == 1
#include <common>
#endif
#if EDGE_DETECTION_MODE == 0 || PREDICATION_MODE == 1
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}vec3 gatherNeighbors(){float p=readDepth(vUv);float pLeft=readDepth(vUv0);float pTop=readDepth(vUv1);return vec3(p,pLeft,pTop);}
#elif PREDICATION_MODE == 2
uniform sampler2D predicationBuffer;vec3 gatherNeighbors(){float p=texture2D(predicationBuffer,vUv).r;float pLeft=texture2D(predicationBuffer,vUv0).r;float pTop=texture2D(predicationBuffer,vUv1).r;return vec3(p,pLeft,pTop);}
#endif
#if PREDICATION_MODE != 0
vec2 calculatePredicatedThreshold(){vec3 neighbours=gatherNeighbors();vec2 delta=abs(neighbours.xx-neighbours.yz);vec2 edges=step(PREDICATION_THRESHOLD,delta);return PREDICATION_SCALE*EDGE_THRESHOLD*(1.0-PREDICATION_STRENGTH*edges);}
#endif
#if EDGE_DETECTION_MODE != 0
uniform sampler2D inputBuffer;
#endif
void main(){
#if EDGE_DETECTION_MODE == 0
const vec2 threshold=vec2(DEPTH_THRESHOLD);
#elif PREDICATION_MODE != 0
vec2 threshold=calculatePredicatedThreshold();
#else
const vec2 threshold=vec2(EDGE_THRESHOLD);
#endif
#if EDGE_DETECTION_MODE == 0
vec3 neighbors=gatherNeighbors();vec2 delta=abs(neighbors.xx-vec2(neighbors.y,neighbors.z));vec2 edges=step(threshold,delta);if(dot(edges,vec2(1.0))==0.0){discard;}gl_FragColor=vec4(edges,0.0,1.0);
#elif EDGE_DETECTION_MODE == 1
float l=luminance(texture2D(inputBuffer,vUv).rgb);float lLeft=luminance(texture2D(inputBuffer,vUv0).rgb);float lTop=luminance(texture2D(inputBuffer,vUv1).rgb);vec4 delta;delta.xy=abs(l-vec2(lLeft,lTop));vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0))==0.0){discard;}float lRight=luminance(texture2D(inputBuffer,vUv2).rgb);float lBottom=luminance(texture2D(inputBuffer,vUv3).rgb);delta.zw=abs(l-vec2(lRight,lBottom));vec2 maxDelta=max(delta.xy,delta.zw);float lLeftLeft=luminance(texture2D(inputBuffer,vUv4).rgb);float lTopTop=luminance(texture2D(inputBuffer,vUv5).rgb);delta.zw=abs(vec2(lLeft,lTop)-vec2(lLeftLeft,lTopTop));maxDelta=max(maxDelta.xy,delta.zw);float finalDelta=max(maxDelta.x,maxDelta.y);edges.xy*=step(finalDelta,LOCAL_CONTRAST_ADAPTATION_FACTOR*delta.xy);gl_FragColor=vec4(edges,0.0,1.0);
#elif EDGE_DETECTION_MODE == 2
vec4 delta;vec3 c=texture2D(inputBuffer,vUv).rgb;vec3 cLeft=texture2D(inputBuffer,vUv0).rgb;vec3 t=abs(c-cLeft);delta.x=max(max(t.r,t.g),t.b);vec3 cTop=texture2D(inputBuffer,vUv1).rgb;t=abs(c-cTop);delta.y=max(max(t.r,t.g),t.b);vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0))==0.0){discard;}vec3 cRight=texture2D(inputBuffer,vUv2).rgb;t=abs(c-cRight);delta.z=max(max(t.r,t.g),t.b);vec3 cBottom=texture2D(inputBuffer,vUv3).rgb;t=abs(c-cBottom);delta.w=max(max(t.r,t.g),t.b);vec2 maxDelta=max(delta.xy,delta.zw);vec3 cLeftLeft=texture2D(inputBuffer,vUv4).rgb;t=abs(c-cLeftLeft);delta.z=max(max(t.r,t.g),t.b);vec3 cTopTop=texture2D(inputBuffer,vUv5).rgb;t=abs(c-cTopTop);delta.w=max(max(t.r,t.g),t.b);maxDelta=max(maxDelta.xy,delta.zw);float finalDelta=max(maxDelta.x,maxDelta.y);edges*=step(finalDelta,LOCAL_CONTRAST_ADAPTATION_FACTOR*delta.xy);gl_FragColor=vec4(edges,0.0,1.0);
#endif
}`,yOe=`uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;
#if EDGE_DETECTION_MODE != 0
varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;
#endif
void main(){vUv=position.xy*0.5+0.5;vUv0=vUv+texelSize*vec2(-1.0,0.0);vUv1=vUv+texelSize*vec2(0.0,-1.0);
#if EDGE_DETECTION_MODE != 0
vUv2=vUv+texelSize*vec2(1.0,0.0);vUv3=vUv+texelSize*vec2(0.0,1.0);vUv4=vUv+texelSize*vec2(-2.0,0.0);vUv5=vUv+texelSize*vec2(0.0,-2.0);
#endif
gl_Position=vec4(position.xy,1.0,1.0);}`,WC={DEPTH:0,LUMA:1,COLOR:2},xOe={DISABLED:0,DEPTH:1,CUSTOM:2},wOe=class extends ki{constructor(e=new Me,t=WC.COLOR){super({name:"EdgeDetectionMaterial",defines:{THREE_REVISION:ny.replace(/\D+/g,""),LOCAL_CONTRAST_ADAPTATION_FACTOR:"2.0",EDGE_THRESHOLD:"0.1",DEPTH_THRESHOLD:"0.01",PREDICATION_MODE:"0",PREDICATION_THRESHOLD:"0.01",PREDICATION_SCALE:"2.0",PREDICATION_STRENGTH:"1.0",DEPTH_PACKING:"0"},uniforms:{inputBuffer:new ct(null),depthBuffer:new ct(null),predicationBuffer:new ct(null),texelSize:new ct(e)},blending:Ln,depthWrite:!1,depthTest:!1,fragmentShader:vOe,vertexShader:yOe}),this.toneMapped=!1,this.edgeDetectionMode=t}set depthBuffer(e){this.uniforms.depthBuffer.value=e}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e,t=Uh){this.depthBuffer=e,this.depthPacking=t}get edgeDetectionMode(){return Number(this.defines.EDGE_DETECTION_MODE)}set edgeDetectionMode(e){this.defines.EDGE_DETECTION_MODE=e.toFixed(0),this.needsUpdate=!0}getEdgeDetectionMode(){return this.edgeDetectionMode}setEdgeDetectionMode(e){this.edgeDetectionMode=e}get localContrastAdaptationFactor(){return Number(this.defines.LOCAL_CONTRAST_ADAPTATION_FACTOR)}set localContrastAdaptationFactor(e){this.defines.LOCAL_CONTRAST_ADAPTATION_FACTOR=e.toFixed("6"),this.needsUpdate=!0}getLocalContrastAdaptationFactor(){return this.localContrastAdaptationFactor}setLocalContrastAdaptationFactor(e){this.localContrastAdaptationFactor=e}get edgeDetectionThreshold(){return Number(this.defines.EDGE_THRESHOLD)}set edgeDetectionThreshold(e){this.defines.EDGE_THRESHOLD=e.toFixed("6"),this.defines.DEPTH_THRESHOLD=(e*.1).toFixed("6"),this.needsUpdate=!0}getEdgeDetectionThreshold(){return this.edgeDetectionThreshold}setEdgeDetectionThreshold(e){this.edgeDetectionThreshold=e}get predicationMode(){return Number(this.defines.PREDICATION_MODE)}set predicationMode(e){this.defines.PREDICATION_MODE=e.toFixed(0),this.needsUpdate=!0}getPredicationMode(){return this.predicationMode}setPredicationMode(e){this.predicationMode=e}set predicationBuffer(e){this.uniforms.predicationBuffer.value=e}setPredicationBuffer(e){this.uniforms.predicationBuffer.value=e}get predicationThreshold(){return Number(this.defines.PREDICATION_THRESHOLD)}set predicationThreshold(e){this.defines.PREDICATION_THRESHOLD=e.toFixed("6"),this.needsUpdate=!0}getPredicationThreshold(){return this.predicationThreshold}setPredicationThreshold(e){this.predicationThreshold=e}get predicationScale(){return Number(this.defines.PREDICATION_SCALE)}set predicationScale(e){this.defines.PREDICATION_SCALE=e.toFixed("6"),this.needsUpdate=!0}getPredicationScale(){return this.predicationScale}setPredicationScale(e){this.predicationScale=e}get predicationStrength(){return Number(this.defines.PREDICATION_STRENGTH)}set predicationStrength(e){this.defines.PREDICATION_STRENGTH=e.toFixed("6"),this.needsUpdate=!0}getPredicationStrength(){return this.predicationStrength}setPredicationStrength(e){this.predicationStrength=e}setSize(e,t){this.uniforms.texelSize.value.set(1/e,1/t)}},bOe=`#include <common>
#include <packing>
#include <dithering_pars_fragment>
#define packFloatToRGBA(v) packDepthToRGBA(v)
#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;
#if THREE_REVISION < 143
#define luminance(v) linearToRelativeLuminance(v)
#endif
#if THREE_REVISION >= 137
vec4 sRGBToLinear(const in vec4 value){return vec4(mix(pow(value.rgb*0.9478672986+vec3(0.0521327014),vec3(2.4)),value.rgb*0.0773993808,vec3(lessThanEqual(value.rgb,vec3(0.04045)))),value.a);}
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNear,cameraFar);
#else
return orthographicDepthToViewZ(depth,cameraNear,cameraFar);
#endif
}FRAGMENT_HEADvoid main(){FRAGMENT_MAIN_UVvec4 color0=texture2D(inputBuffer,UV);vec4 color1=vec4(0.0);FRAGMENT_MAIN_IMAGEgl_FragColor=color0;
#ifdef ENCODE_OUTPUT
#include <encodings_fragment>
#endif
#include <dithering_fragment>
}`,_Oe="uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;VERTEX_HEADvoid main(){vUv=position.xy*0.5+0.5;VERTEX_MAIN_SUPPORTgl_Position=vec4(position.xy,1.0,1.0);}",Rl={FRAGMENT_HEAD:"FRAGMENT_HEAD",FRAGMENT_MAIN_UV:"FRAGMENT_MAIN_UV",FRAGMENT_MAIN_IMAGE:"FRAGMENT_MAIN_IMAGE",VERTEX_HEAD:"VERTEX_HEAD",VERTEX_MAIN_SUPPORT:"VERTEX_MAIN_SUPPORT"},wB=class extends ki{constructor(e,t,i,r,n=!1){super({name:"EffectMaterial",defines:{THREE_REVISION:ny.replace(/\D+/g,""),DEPTH_PACKING:"0",ENCODE_OUTPUT:"1"},uniforms:{inputBuffer:new ct(null),depthBuffer:new ct(null),resolution:new ct(new Me),texelSize:new ct(new Me),cameraNear:new ct(.3),cameraFar:new ct(1e3),aspect:new ct(1),time:new ct(0)},blending:Ln,depthWrite:!1,depthTest:!1,dithering:n}),this.toneMapped=!1,e&&this.setShaderParts(e),t&&this.setDefines(t),i&&this.setUniforms(i),this.adoptCameraSettings(r)}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(e){this.uniforms.depthBuffer.value=e}get depthPacking(){return Number(this.defines.DEPTH_PACKING)}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e,t=Uh){this.depthBuffer=e,this.depthPacking=t}setShaderParts(e){return this.fragmentShader=bOe.replace(Rl.FRAGMENT_HEAD,e.get(Rl.FRAGMENT_HEAD)).replace(Rl.FRAGMENT_MAIN_UV,e.get(Rl.FRAGMENT_MAIN_UV)).replace(Rl.FRAGMENT_MAIN_IMAGE,e.get(Rl.FRAGMENT_MAIN_IMAGE)),this.vertexShader=_Oe.replace(Rl.VERTEX_HEAD,e.get(Rl.VERTEX_HEAD)).replace(Rl.VERTEX_MAIN_SUPPORT,e.get(Rl.VERTEX_MAIN_SUPPORT)),this.needsUpdate=!0,this}setDefines(e){for(let t of e.entries())this.defines[t[0]]=t[1];return this.needsUpdate=!0,this}setUniforms(e){for(let t of e.entries())this.uniforms[t[0]]=t[1];return this}setExtensions(e){this.extensions={};for(let t of e)this.extensions[t]=!0;return this}get encodeOutput(){return this.defines.ENCODE_OUTPUT!==void 0}set encodeOutput(e){this.encodeOutput!==e&&(e?this.defines.ENCODE_OUTPUT="1":delete this.defines.ENCODE_OUTPUT,this.needsUpdate=!0)}isOutputEncodingEnabled(e){return this.encodeOutput}setOutputEncodingEnabled(e){this.encodeOutput=e}get time(){return this.uniforms.time.value}set time(e){this.uniforms.time.value=e}setDeltaTime(e){this.uniforms.time.value+=e}adoptCameraSettings(e){e&&(this.uniforms.cameraNear.value=e.near,this.uniforms.cameraFar.value=e.far,e instanceof ta?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(e,t){let i=this.uniforms;i.resolution.value.set(e,t),i.texelSize.value.set(1/e,1/t),i.aspect.value=e/t}static get Section(){return Rl}},SOe=`#include <common>
#if THREE_REVISION < 143
#define luminance(v) linearToRelativeLuminance(v)
#endif
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef RANGE
uniform vec2 range;
#elif defined(THRESHOLD)
uniform float threshold;uniform float smoothing;
#endif
varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);float l=luminance(texel.rgb);
#ifdef RANGE
float low=step(range.x,l);float high=step(l,range.y);l*=low*high;
#elif defined(THRESHOLD)
l=smoothstep(threshold,threshold+smoothing,l);
#endif
#ifdef COLOR
gl_FragColor=vec4(texel.rgb*l,l);
#else
gl_FragColor=vec4(l);
#endif
}`,MOe=class extends ki{constructor(e=!1,t=null){super({name:"LuminanceMaterial",defines:{THREE_REVISION:ny.replace(/\D+/g,"")},uniforms:{inputBuffer:new ct(null),threshold:new ct(0),smoothing:new ct(1),range:new ct(null)},blending:Ln,depthWrite:!1,depthTest:!1,fragmentShader:SOe,vertexShader:Vb}),this.toneMapped=!1,this.colorOutput=e,this.luminanceRange=t}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}get threshold(){return this.uniforms.threshold.value}set threshold(e){this.smoothing>0||e>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.threshold.value=e}getThreshold(){return this.threshold}setThreshold(e){this.threshold=e}get smoothing(){return this.uniforms.smoothing.value}set smoothing(e){this.threshold>0||e>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.smoothing.value=e}getSmoothingFactor(){return this.smoothing}setSmoothingFactor(e){this.smoothing=e}get useThreshold(){return this.threshold>0||this.smoothing>0}set useThreshold(e){}get colorOutput(){return this.defines.COLOR!==void 0}set colorOutput(e){e?this.defines.COLOR="1":delete this.defines.COLOR,this.needsUpdate=!0}isColorOutputEnabled(e){return this.colorOutput}setColorOutputEnabled(e){this.colorOutput=e}get useRange(){return this.luminanceRange!==null}set useRange(e){this.luminanceRange=null}get luminanceRange(){return this.uniforms.range.value}set luminanceRange(e){e!==null?this.defines.RANGE="1":delete this.defines.RANGE,this.uniforms.range.value=e,this.needsUpdate=!0}getLuminanceRange(){return this.luminanceRange}setLuminanceRange(e){this.luminanceRange=e}},EOe=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef MASK_PRECISION_HIGH
uniform mediump sampler2D maskTexture;
#else
uniform lowp sampler2D maskTexture;
#endif
#if MASK_FUNCTION != 0
uniform float strength;
#endif
varying vec2 vUv;void main(){
#if COLOR_CHANNEL == 0
float mask=texture2D(maskTexture,vUv).r;
#elif COLOR_CHANNEL == 1
float mask=texture2D(maskTexture,vUv).g;
#elif COLOR_CHANNEL == 2
float mask=texture2D(maskTexture,vUv).b;
#else
float mask=texture2D(maskTexture,vUv).a;
#endif
#if MASK_FUNCTION == 0
#ifdef INVERTED
mask=step(mask,0.0);
#else
mask=1.0-step(mask,0.0);
#endif
#else
mask=clamp(mask*strength,0.0,1.0);
#ifdef INVERTED
mask=1.0-mask;
#endif
#endif
#if MASK_FUNCTION == 2
gl_FragColor=vec4(mask*texture2D(inputBuffer,vUv).rgb,mask);
#else
gl_FragColor=mask*texture2D(inputBuffer,vUv);
#endif
}`,oie={DISCARD:0,MULTIPLY:1,MULTIPLY_RGB_SET_ALPHA:2},AOe=class extends ki{constructor(e=null){super({name:"MaskMaterial",uniforms:{maskTexture:new ct(e),inputBuffer:new ct(null),strength:new ct(1)},blending:Ln,depthWrite:!1,depthTest:!1,fragmentShader:EOe,vertexShader:Vb}),this.toneMapped=!1,this.setColorChannel(aie.RED),this.setMaskFunction(oie.DISCARD)}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}set maskTexture(e){this.uniforms.maskTexture.value=e,delete this.defines.MASK_PRECISION_HIGH,e.type!==ca&&(this.defines.MASK_PRECISION_HIGH="1"),this.needsUpdate=!0}setMaskTexture(e){this.maskTexture=e}set colorChannel(e){this.defines.COLOR_CHANNEL=e.toFixed(0),this.needsUpdate=!0}setColorChannel(e){this.colorChannel=e}set maskFunction(e){this.defines.MASK_FUNCTION=e.toFixed(0),this.needsUpdate=!0}setMaskFunction(e){this.maskFunction=e}get inverted(){return this.defines.INVERTED!==void 0}set inverted(e){this.inverted&&!e?delete this.defines.INVERTED:e&&(this.defines.INVERTED="1"),this.needsUpdate=!0}isInverted(){return this.inverted}setInverted(e){this.inverted=e}get strength(){return this.uniforms.strength.value}set strength(e){this.uniforms.strength.value=e}getStrength(){return this.strength}setStrength(e){this.strength=e}},TOe=`#define sampleLevelZeroOffset(t, coord, offset) texture2D(t, coord + offset * texelSize)
#if __VERSION__ < 300
#define round(v) floor(v + 0.5)
#endif
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform lowp sampler2D areaTexture;uniform lowp sampler2D searchTexture;uniform vec2 texelSize;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixCoord;void movec(const in bvec2 c,inout vec2 variable,const in vec2 value){if(c.x){variable.x=value.x;}if(c.y){variable.y=value.y;}}void movec(const in bvec4 c,inout vec4 variable,const in vec4 value){movec(c.xy,variable.xy,value.xy);movec(c.zw,variable.zw,value.zw);}vec2 decodeDiagBilinearAccess(in vec2 e){e.r=e.r*abs(5.0*e.r-5.0*0.75);return round(e);}vec4 decodeDiagBilinearAccess(in vec4 e){e.rb=e.rb*abs(5.0*e.rb-5.0*0.75);return round(e);}vec2 searchDiag1(const in vec2 texCoord,const in vec2 dir,out vec2 e){vec4 coord=vec4(texCoord,-1.0,1.0);vec3 t=vec3(texelSize,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(coord.z<float(MAX_SEARCH_STEPS_DIAG_INT-1)&&coord.w>0.9)){break;}coord.xyz=t*vec3(dir,1.0)+coord.xyz;e=texture2D(inputBuffer,coord.xy).rg;coord.w=dot(e,vec2(0.5));}return coord.zw;}vec2 searchDiag2(const in vec2 texCoord,const in vec2 dir,out vec2 e){vec4 coord=vec4(texCoord,-1.0,1.0);coord.x+=0.25*texelSize.x;vec3 t=vec3(texelSize,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(coord.z<float(MAX_SEARCH_STEPS_DIAG_INT-1)&&coord.w>0.9)){break;}coord.xyz=t*vec3(dir,1.0)+coord.xyz;e=texture2D(inputBuffer,coord.xy).rg;e=decodeDiagBilinearAccess(e);coord.w=dot(e,vec2(0.5));}return coord.zw;}vec2 areaDiag(const in vec2 dist,const in vec2 e,const in float offset){vec2 texCoord=vec2(AREATEX_MAX_DISTANCE_DIAG,AREATEX_MAX_DISTANCE_DIAG)*e+dist;texCoord=AREATEX_PIXEL_SIZE*texCoord+0.5*AREATEX_PIXEL_SIZE;texCoord.x+=0.5;texCoord.y+=AREATEX_SUBTEX_SIZE*offset;return texture2D(areaTexture,texCoord).rg;}vec2 calculateDiagWeights(const in vec2 texCoord,const in vec2 e,const in vec4 subsampleIndices){vec2 weights=vec2(0.0);vec4 d;vec2 end;if(e.r>0.0){d.xz=searchDiag1(texCoord,vec2(-1.0,1.0),end);d.x+=float(end.y>0.9);}else{d.xz=vec2(0.0);}d.yw=searchDiag1(texCoord,vec2(1.0,-1.0),end);if(d.x+d.y>2.0){vec4 coords=vec4(-d.x+0.25,d.x,d.y,-d.y-0.25)*texelSize.xyxy+texCoord.xyxy;vec4 c;c.xy=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(-1,0)).rg;c.zw=sampleLevelZeroOffset(inputBuffer,coords.zw,vec2(1,0)).rg;c.yxwz=decodeDiagBilinearAccess(c.xyzw);vec2 cc=vec2(2.0)*c.xz+c.yw;movec(bvec2(step(0.9,d.zw)),cc,vec2(0.0));weights+=areaDiag(d.xy,cc,subsampleIndices.z);}d.xz=searchDiag2(texCoord,vec2(-1.0,-1.0),end);if(sampleLevelZeroOffset(inputBuffer,texCoord,vec2(1,0)).r>0.0){d.yw=searchDiag2(texCoord,vec2(1.0),end);d.y+=float(end.y>0.9);}else{d.yw=vec2(0.0);}if(d.x+d.y>2.0){vec4 coords=vec4(-d.x,-d.x,d.y,d.y)*texelSize.xyxy+texCoord.xyxy;vec4 c;c.x=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(-1,0)).g;c.y=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(0,-1)).r;c.zw=sampleLevelZeroOffset(inputBuffer,coords.zw,vec2(1,0)).gr;vec2 cc=vec2(2.0)*c.xz+c.yw;movec(bvec2(step(0.9,d.zw)),cc,vec2(0.0));weights+=areaDiag(d.xy,cc,subsampleIndices.w).gr;}return weights;}float searchLength(const in vec2 e,const in float offset){vec2 scale=SEARCHTEX_SIZE*vec2(0.5,-1.0);vec2 bias=SEARCHTEX_SIZE*vec2(offset,1.0);scale+=vec2(-1.0,1.0);bias+=vec2(0.5,-0.5);scale*=1.0/SEARCHTEX_PACKED_SIZE;bias*=1.0/SEARCHTEX_PACKED_SIZE;return texture2D(searchTexture,scale*e+bias).r;}float searchXLeft(in vec2 texCoord,const in float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.x>end&&e.g>0.8281&&e.r==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(-2.0,0.0)*texelSize+texCoord;}float offset=-(255.0/127.0)*searchLength(e,0.0)+3.25;return texelSize.x*offset+texCoord.x;}float searchXRight(vec2 texCoord,const in float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.x<end&&e.g>0.8281&&e.r==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(2.0,0.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e,0.5)+3.25;return-texelSize.x*offset+texCoord.x;}float searchYUp(vec2 texCoord,const in float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.y>end&&e.r>0.8281&&e.g==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=-vec2(0.0,2.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e.gr,0.0)+3.25;return texelSize.y*offset+texCoord.y;}float searchYDown(vec2 texCoord,const in float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;i++){if(!(texCoord.y<end&&e.r>0.8281&&e.g==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(0.0,2.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e.gr,0.5)+3.25;return-texelSize.y*offset+texCoord.y;}vec2 area(const in vec2 dist,const in float e1,const in float e2,const in float offset){vec2 texCoord=vec2(AREATEX_MAX_DISTANCE)*round(4.0*vec2(e1,e2))+dist;texCoord=AREATEX_PIXEL_SIZE*texCoord+0.5*AREATEX_PIXEL_SIZE;texCoord.y=AREATEX_SUBTEX_SIZE*offset+texCoord.y;return texture2D(areaTexture,texCoord).rg;}void detectHorizontalCornerPattern(inout vec2 weights,const in vec4 texCoord,const in vec2 d){
#if !defined(DISABLE_CORNER_DETECTION)
vec2 leftRight=step(d.xy,d.yx);vec2 rounding=(1.0-CORNER_ROUNDING_NORM)*leftRight;rounding/=leftRight.x+leftRight.y;vec2 factor=vec2(1.0);factor.x-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(0,1)).r;factor.x-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,1)).r;factor.y-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(0,-2)).r;factor.y-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,-2)).r;weights*=clamp(factor,0.0,1.0);
#endif
}void detectVerticalCornerPattern(inout vec2 weights,const in vec4 texCoord,const in vec2 d){
#if !defined(DISABLE_CORNER_DETECTION)
vec2 leftRight=step(d.xy,d.yx);vec2 rounding=(1.0-CORNER_ROUNDING_NORM)*leftRight;rounding/=leftRight.x+leftRight.y;vec2 factor=vec2(1.0);factor.x-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(1,0)).g;factor.x-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,1)).g;factor.y-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(-2,0)).g;factor.y-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(-2,1)).g;weights*=clamp(factor,0.0,1.0);
#endif
}void main(){vec4 weights=vec4(0.0);vec4 subsampleIndices=vec4(0.0);vec2 e=texture2D(inputBuffer,vUv).rg;if(e.g>0.0){
#if !defined(DISABLE_DIAG_DETECTION)
weights.rg=calculateDiagWeights(vUv,e,subsampleIndices);if(weights.r==-weights.g){
#endif
vec2 d;vec3 coords;coords.x=searchXLeft(vOffset[0].xy,vOffset[2].x);coords.y=vOffset[1].y;d.x=coords.x;float e1=texture2D(inputBuffer,coords.xy).r;coords.z=searchXRight(vOffset[0].zw,vOffset[2].y);d.y=coords.z;d=round(resolution.xx*d+-vPixCoord.xx);vec2 sqrtD=sqrt(abs(d));float e2=sampleLevelZeroOffset(inputBuffer,coords.zy,vec2(1,0)).r;weights.rg=area(sqrtD,e1,e2,subsampleIndices.y);coords.y=vUv.y;detectHorizontalCornerPattern(weights.rg,coords.xyzy,d);
#if !defined(DISABLE_DIAG_DETECTION)
}else{e.r=0.0;}
#endif
}if(e.r>0.0){vec2 d;vec3 coords;coords.y=searchYUp(vOffset[1].xy,vOffset[2].z);coords.x=vOffset[0].x;d.x=coords.y;float e1=texture2D(inputBuffer,coords.xy).g;coords.z=searchYDown(vOffset[1].zw,vOffset[2].w);d.y=coords.z;d=round(resolution.yy*d-vPixCoord.yy);vec2 sqrtD=sqrt(abs(d));float e2=sampleLevelZeroOffset(inputBuffer,coords.xz,vec2(0,1)).g;weights.ba=area(sqrtD,e1,e2,subsampleIndices.x);coords.x=vUv.x;detectVerticalCornerPattern(weights.ba,coords.xyxz,d);}gl_FragColor=weights;}`,COe="uniform vec2 texelSize;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixCoord;void main(){vUv=position.xy*0.5+0.5;vPixCoord=vUv*resolution;vOffset[0]=vUv.xyxy+texelSize.xyxy*vec4(-0.25,-0.125,1.25,-0.125);vOffset[1]=vUv.xyxy+texelSize.xyxy*vec4(-0.125,-0.25,-0.125,1.25);vOffset[2]=vec4(vOffset[0].xz,vOffset[1].yw)+vec4(-2.0,2.0,-2.0,2.0)*texelSize.xxyy*MAX_SEARCH_STEPS_FLOAT;gl_Position=vec4(position.xy,1.0,1.0);}",POe=class extends ki{constructor(e=new Me,t=new Me){super({name:"SMAAWeightsMaterial",defines:{MAX_SEARCH_STEPS_INT:"16",MAX_SEARCH_STEPS_FLOAT:"16.0",MAX_SEARCH_STEPS_DIAG_INT:"8",MAX_SEARCH_STEPS_DIAG_FLOAT:"8.0",CORNER_ROUNDING:"25",CORNER_ROUNDING_NORM:"0.25",AREATEX_MAX_DISTANCE:"16.0",AREATEX_MAX_DISTANCE_DIAG:"20.0",AREATEX_PIXEL_SIZE:"(1.0 / vec2(160.0, 560.0))",AREATEX_SUBTEX_SIZE:"(1.0 / 7.0)",SEARCHTEX_SIZE:"vec2(66.0, 33.0)",SEARCHTEX_PACKED_SIZE:"vec2(64.0, 16.0)"},uniforms:{inputBuffer:new ct(null),searchTexture:new ct(null),areaTexture:new ct(null),resolution:new ct(t),texelSize:new ct(e)},blending:Ln,depthWrite:!1,depthTest:!1,fragmentShader:TOe,vertexShader:COe}),this.toneMapped=!1}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}get searchTexture(){return this.uniforms.searchTexture.value}set searchTexture(e){this.uniforms.searchTexture.value=e}get areaTexture(){return this.uniforms.areaTexture.value}set areaTexture(e){this.uniforms.areaTexture.value=e}setLookupTextures(e,t){this.searchTexture=e,this.areaTexture=t}get orthogonalSearchSteps(){return Number(this.defines.MAX_SEARCH_STEPS_INT)}set orthogonalSearchSteps(e){let t=Math.min(Math.max(e,0),112);this.defines.MAX_SEARCH_STEPS_INT=t.toFixed("0"),this.defines.MAX_SEARCH_STEPS_FLOAT=t.toFixed("1"),this.needsUpdate=!0}setOrthogonalSearchSteps(e){this.orthogonalSearchSteps=e}get diagonalSearchSteps(){return Number(this.defines.MAX_SEARCH_STEPS_DIAG_INT)}set diagonalSearchSteps(e){let t=Math.min(Math.max(e,0),20);this.defines.MAX_SEARCH_STEPS_DIAG_INT=t.toFixed("0"),this.defines.MAX_SEARCH_STEPS_DIAG_FLOAT=t.toFixed("1"),this.needsUpdate=!0}setDiagonalSearchSteps(e){this.diagonalSearchSteps=e}get diagonalDetection(){return this.defines.DISABLE_DIAG_DETECTION===void 0}set diagonalDetection(e){e?delete this.defines.DISABLE_DIAG_DETECTION:this.defines.DISABLE_DIAG_DETECTION="1",this.needsUpdate=!0}isDiagonalDetectionEnabled(){return this.diagonalDetection}setDiagonalDetectionEnabled(e){this.diagonalDetection=e}get cornerRounding(){return Number(this.defines.CORNER_ROUNDING)}set cornerRounding(e){let t=Math.min(Math.max(e,0),100);this.defines.CORNER_ROUNDING=t.toFixed("4"),this.defines.CORNER_ROUNDING_NORM=(t/100).toFixed("4"),this.needsUpdate=!0}setCornerRounding(e){this.cornerRounding=e}get cornerDetection(){return this.defines.DISABLE_CORNER_DETECTION===void 0}set cornerDetection(e){e?delete this.defines.DISABLE_CORNER_DETECTION:this.defines.DISABLE_CORNER_DETECTION="1",this.needsUpdate=!0}isCornerRoundingEnabled(){return this.cornerDetection}setCornerRoundingEnabled(e){this.cornerDetection=e}setSize(e,t){let i=this.uniforms;i.texelSize.value.set(1/e,1/t),i.resolution.value.set(e,t)}},DOe=new Cf,od=null;function ROe(){if(od===null){let e=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),t=new Float32Array([0,0,2,0,0,2]);od=new Nt,od.setAttribute!==void 0?(od.setAttribute("position",new Qt(e,3)),od.setAttribute("uv",new Qt(t,2))):(od.addAttribute("position",new Qt(e,3)),od.addAttribute("uv",new Qt(t,2)))}return od}var Ua=class{constructor(e="Pass",t=new co,i=DOe){this.name=e,this.renderer=null,this.scene=t,this.camera=i,this.screen=null,this.rtt=!0,this.needsSwap=!0,this.needsDepthTexture=!1,this.enabled=!0}get renderToScreen(){return!this.rtt}set renderToScreen(e){if(this.rtt===e){let t=this.getFullscreenMaterial();t!==null&&(t.needsUpdate=!0),this.rtt=!e}}setRenderer(e){this.renderer=e}isEnabled(){return this.enabled}setEnabled(e){this.enabled=e}get fullscreenMaterial(){return this.screen!==null?this.screen.material:null}set fullscreenMaterial(e){let t=this.screen;t!==null?t.material=e:(t=new yr(ROe(),e),t.frustumCulled=!1,this.scene===null&&(this.scene=new co),this.scene.add(t),this.screen=t)}getFullscreenMaterial(){return this.fullscreenMaterial}setFullscreenMaterial(e){this.fullscreenMaterial=e}getDepthTexture(){return null}setDepthTexture(e,t=Uh){}render(e,t,i,r,n){throw new Error("Render method not implemented!")}setSize(e,t){}initialize(e,t,i){}dispose(){for(let e of Object.keys(this)){let t=this[e];if(t!==null&&typeof t=="object"&&typeof t.dispose=="function"){if(t instanceof co||t===this.renderer)continue;this[e].dispose()}}}},bB=class extends Ua{constructor(e,t=!0){super("CopyPass"),this.fullscreenMaterial=new gOe,this.needsSwap=!1,this.renderTarget=e,e===void 0&&(this.renderTarget=new Ni(1,1,{minFilter:bi,magFilter:bi,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="CopyPass.Target"),this.autoResize=t}get resize(){return this.autoResize}set resize(e){this.autoResize=e}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}setAutoResizeEnabled(e){this.autoResize=e}render(e,t,i,r,n){this.fullscreenMaterial.inputBuffer=t.texture,e.setRenderTarget(this.renderToScreen?null:this.renderTarget),e.render(this.scene,this.camera)}setSize(e,t){this.autoResize&&this.renderTarget.setSize(e,t)}initialize(e,t,i){i!==void 0&&(this.renderTarget.texture.type=i,i!==ca?this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1":e.outputEncoding===vi&&(this.renderTarget.texture.encoding=vi))}},IOe=class extends Ua{constructor(){super("ClearMaskPass",null,null),this.needsSwap=!1}render(e,t,i,r,n){let s=e.state.buffers.stencil;s.setLocked(!1),s.setTest(!1)}},VR=new Yt,o4=class extends Ua{constructor(e=!0,t=!0,i=!1){super("ClearPass",null,null),this.needsSwap=!1,this.color=e,this.depth=t,this.stencil=i,this.overrideClearColor=null,this.overrideClearAlpha=-1}setClearFlags(e,t,i){this.color=e,this.depth=t,this.stencil=i}getOverrideClearColor(){return this.overrideClearColor}setOverrideClearColor(e){this.overrideClearColor=e}getOverrideClearAlpha(){return this.overrideClearAlpha}setOverrideClearAlpha(e){this.overrideClearAlpha=e}render(e,t,i,r,n){let s=this.overrideClearColor,a=this.overrideClearAlpha,o=e.getClearAlpha(),l=s!==null,c=a>=0;l?(VR.copy(e.getClearColor(VR)),e.setClearColor(s,c?a:o)):c&&e.setClearAlpha(a),e.setRenderTarget(this.renderToScreen?null:t),e.clear(this.color,this.depth,this.stencil),l?e.setClearColor(VR,o):c&&e.setClearAlpha(o)}},ld=-1,no=class extends Vs{constructor(e,t=ld,i=ld,r=1){super(),this.resizable=e,this.base=new Me(1,1),this.preferred=new Me(t,i),this.target=this.preferred,this.s=r}get width(){let{base:e,preferred:t,scale:i}=this,r;return t.width!==ld?r=t.width:t.height!==ld?r=Math.round(t.height*(e.width/Math.max(e.height,1))):r=Math.round(e.width*i),r}set width(e){this.preferredWidth=e}get height(){let{base:e,preferred:t,scale:i}=this,r;return t.height!==ld?r=t.height:t.width!==ld?r=Math.round(t.width/Math.max(e.width/Math.max(e.height,1),1)):r=Math.round(e.height*i),r}set height(e){this.preferredHeight=e}getWidth(){return this.width}getHeight(){return this.height}get scale(){return this.s}set scale(e){this.s!==e&&(this.s=e,this.preferred.setScalar(ld),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getScale(){return this.scale}setScale(e){this.scale=e}get baseWidth(){return this.base.width}set baseWidth(e){this.base.width!==e&&(this.base.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getBaseWidth(){return this.base.width}setBaseWidth(e){this.base.width!==e&&(this.base.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}get baseHeight(){return this.base.height}set baseHeight(e){this.base.height!==e&&(this.base.height=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getBaseHeight(){return this.baseHeight}setBaseHeight(e){this.baseHeight=e}setBaseSize(e,t){(this.base.width!==e||this.base.height!==t)&&(this.base.set(e,t),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}get preferredWidth(){return this.preferred.width}set preferredWidth(e){this.preferred.width!==e&&(this.preferred.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getPreferredWidth(){return this.preferredWidth}setPreferredWidth(e){this.preferredWidth=e}get preferredHeight(){return this.preferred.height}set preferredHeight(e){this.preferred.height!==e&&(this.preferred.height=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getPreferredHeight(){return this.preferredHeight}setPreferredHeight(e){this.preferredHeight=e}setPreferredSize(e,t){(this.preferred.width!==e||this.preferred.height!==t)&&(this.preferred.set(e,t),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}copy(e){this.base.set(e.getBaseWidth(),e.getBaseHeight()),this.preferred.set(e.getPreferredWidth(),e.getPreferredHeight()),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height)}static get AUTO_SIZE(){return ld}},GR=!1,w9=class{constructor(e=null){this.originalMaterials=new Map,this.material=null,this.materials=null,this.materialsBackSide=null,this.materialsDoubleSide=null,this.materialsFlatShaded=null,this.materialsFlatShadedBackSide=null,this.materialsFlatShadedDoubleSide=null,this.setMaterial(e),this.meshCount=0,this.replaceMaterial=t=>{if(t.isMesh){let i;if(t.material.flatShading)switch(t.material.side){case na:i=this.materialsFlatShadedDoubleSide;break;case ms:i=this.materialsFlatShadedBackSide;break;default:i=this.materialsFlatShaded;break}else switch(t.material.side){case na:i=this.materialsDoubleSide;break;case ms:i=this.materialsBackSide;break;default:i=this.materials;break}this.originalMaterials.set(t,t.material),t.isSkinnedMesh?t.material=i[2]:t.isInstancedMesh?t.material=i[1]:t.material=i[0],++this.meshCount}}}setMaterial(e){if(this.disposeMaterials(),this.material=e,e!==null){let t=this.materials=[e.clone(),e.clone(),e.clone()];for(let i of t)i.uniforms=Object.assign({},e.uniforms),i.side=nc;t[2].skinning=!0,this.materialsBackSide=t.map(i=>{let r=i.clone();return r.uniforms=Object.assign({},e.uniforms),r.side=ms,r}),this.materialsDoubleSide=t.map(i=>{let r=i.clone();return r.uniforms=Object.assign({},e.uniforms),r.side=na,r}),this.materialsFlatShaded=t.map(i=>{let r=i.clone();return r.uniforms=Object.assign({},e.uniforms),r.flatShading=!0,r}),this.materialsFlatShadedBackSide=t.map(i=>{let r=i.clone();return r.uniforms=Object.assign({},e.uniforms),r.flatShading=!0,r.side=ms,r}),this.materialsFlatShadedDoubleSide=t.map(i=>{let r=i.clone();return r.uniforms=Object.assign({},e.uniforms),r.flatShading=!0,r.side=na,r})}}render(e,t,i){let r=e.shadowMap.enabled;if(e.shadowMap.enabled=!1,GR){let n=this.originalMaterials;this.meshCount=0,t.traverse(this.replaceMaterial),e.render(t,i);for(let s of n)s[0].material=s[1];this.meshCount!==n.size&&n.clear()}else{let n=t.overrideMaterial;t.overrideMaterial=this.material,e.render(t,i),t.overrideMaterial=n}e.shadowMap.enabled=r}disposeMaterials(){if(this.material!==null){let e=this.materials.concat(this.materialsBackSide).concat(this.materialsDoubleSide).concat(this.materialsFlatShaded).concat(this.materialsFlatShadedBackSide).concat(this.materialsFlatShadedDoubleSide);for(let t of e)t.dispose()}}dispose(){this.originalMaterials.clear(),this.disposeMaterials()}static get workaroundEnabled(){return GR}static set workaroundEnabled(e){GR=e}},LOe=class extends Ua{constructor(e,t,i=null){super("RenderPass",e,t),this.needsSwap=!1,this.clearPass=new o4,this.overrideMaterialManager=i===null?null:new w9(i),this.ignoreBackground=!1,this.skipShadowMapUpdate=!1,this.selection=null}get renderToScreen(){return super.renderToScreen}set renderToScreen(e){super.renderToScreen=e,this.clearPass.renderToScreen=e}get overrideMaterial(){let e=this.overrideMaterialManager;return e!==null?e.material:null}set overrideMaterial(e){let t=this.overrideMaterialManager;e!==null?t!==null?t.setMaterial(e):this.overrideMaterialManager=new w9(e):t!==null&&(t.dispose(),this.overrideMaterialManager=null)}getOverrideMaterial(){return this.overrideMaterial}setOverrideMaterial(e){this.overrideMaterial=e}get clear(){return this.clearPass.enabled}set clear(e){this.clearPass.enabled=e}getSelection(){return this.selection}setSelection(e){this.selection=e}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(e){this.ignoreBackground=e}isShadowMapDisabled(){return this.skipShadowMapUpdate}setShadowMapDisabled(e){this.skipShadowMapUpdate=e}getClearPass(){return this.clearPass}render(e,t,i,r,n){let s=this.scene,a=this.camera,o=this.selection,l=a.layers.mask,c=s.background,u=e.shadowMap.autoUpdate,h=this.renderToScreen?null:t;o!==null&&a.layers.set(o.getLayer()),this.skipShadowMapUpdate&&(e.shadowMap.autoUpdate=!1),(this.ignoreBackground||this.clearPass.overrideClearColor!==null)&&(s.background=null),this.clearPass.enabled&&this.clearPass.render(e,t),e.setRenderTarget(h),this.overrideMaterialManager!==null?this.overrideMaterialManager.render(e,s,a):e.render(s,a),a.layers.mask=l,s.background=c,e.shadowMap.autoUpdate=u}},b9=class extends Ua{constructor(e,t,{resolutionScale:i=1,width:r=no.AUTO_SIZE,height:n=no.AUTO_SIZE,renderTarget:s}={}){super("DepthPass"),this.needsSwap=!1,this.renderPass=new LOe(e,t,new XJ({depthPacking:RJ}));let a=this.renderPass;a.skipShadowMapUpdate=!0,a.ignoreBackground=!0;let o=a.getClearPass();o.overrideClearColor=new Yt(16777215),o.overrideClearAlpha=1,this.renderTarget=s,this.renderTarget===void 0&&(this.renderTarget=new Ni(1,1,{minFilter:Ci,magFilter:Ci,stencilBuffer:!1}),this.renderTarget.texture.name="DepthPass.Target");let l=this.resolution=new no(this,r,n,i);l.addEventListener("change",c=>this.setSize(l.baseWidth,l.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}render(e,t,i,r,n){let s=this.renderToScreen?null:this.renderTarget;this.renderPass.render(e,s)}setSize(e,t){let i=this.resolution;i.setBaseSize(e,t),this.renderTarget.setSize(i.width,i.height)}},Gi={SKIP:0,ADD:1,ALPHA:2,AVERAGE:3,COLOR_BURN:4,COLOR_DODGE:5,DARKEN:6,DIFFERENCE:7,EXCLUSION:8,LIGHTEN:9,MULTIPLY:10,DIVIDE:11,NEGATION:12,NORMAL:13,OVERLAY:14,REFLECT:15,SCREEN:16,SOFT_LIGHT:17,SUBTRACT:18},OOe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return min(x+y,1.0)*opacity+x*(1.0-opacity);}",zOe="vec3 blend(const in vec3 x,const in vec3 y,const in float opacity){return y*opacity+x*(1.0-opacity);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){float a=min(y.a,opacity);return vec4(blend(x.rgb,y.rgb,a),max(x.a,a));}",BOe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(x+y)*0.5*opacity+x*(1.0-opacity);}",FOe="float blend(const in float x,const in float y){return(y==0.0)?y:max(1.0-(1.0-x)/y,0.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",UOe="float blend(const in float x,const in float y){return(y==1.0)?y:min(x/(1.0-y),1.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",NOe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return min(x,y)*opacity+x*(1.0-opacity);}",kOe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return abs(x-y)*opacity+x*(1.0-opacity);}",VOe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(x+y-2.0*x*y)*opacity+x*(1.0-opacity);}",GOe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return max(x,y)*opacity+x*(1.0-opacity);}",HOe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return x*y*opacity+x*(1.0-opacity);}",jOe="float blend(const in float x,const in float y){return(y>0.0)?min(x/y,1.0):1.0;}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",WOe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(1.0-abs(1.0-x-y))*opacity+x*(1.0-opacity);}",XOe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return y*opacity+x*(1.0-opacity);}",qOe="float blend(const in float x,const in float y){return(x<0.5)?(2.0*x*y):(1.0-2.0*(1.0-x)*(1.0-y));}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",YOe="float blend(const in float x,const in float y){return(y==1.0)?y:min(x*x/(1.0-y),1.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",QOe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(1.0-(1.0-x)*(1.0-y))*opacity+x*(1.0-opacity);}",ZOe="float blend(const in float x,const in float y){return(y<0.5)?(2.0*x*y+x*x*(1.0-2.0*y)):(sqrt(x)*(2.0*y-1.0)+2.0*x*(1.0-y));}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",KOe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return max(x+y-1.0,0.0)*opacity+x*(1.0-opacity);}",JOe=new Map([[Gi.SKIP,null],[Gi.ADD,OOe],[Gi.ALPHA,zOe],[Gi.AVERAGE,BOe],[Gi.COLOR_BURN,FOe],[Gi.COLOR_DODGE,UOe],[Gi.DARKEN,NOe],[Gi.DIFFERENCE,kOe],[Gi.EXCLUSION,VOe],[Gi.LIGHTEN,GOe],[Gi.MULTIPLY,HOe],[Gi.DIVIDE,jOe],[Gi.NEGATION,WOe],[Gi.NORMAL,XOe],[Gi.OVERLAY,qOe],[Gi.REFLECT,YOe],[Gi.SCREEN,QOe],[Gi.SOFT_LIGHT,ZOe],[Gi.SUBTRACT,KOe]]),$Oe=class extends Vs{constructor(e,t=1){super(),this.f=e,this.opacity=new ct(t)}getOpacity(){return this.opacity.value}setOpacity(e){this.opacity.value=e}get blendFunction(){return this.f}set blendFunction(e){this.f=e,this.dispatchEvent({type:"change"})}getBlendFunction(){return this.blendFunction}setBlendFunction(e){this.blendFunction=e}getShaderCode(){return JOe.get(this.blendFunction)}},eu={NONE:0,DEPTH:1,CONVOLUTION:2},fu=class extends Vs{constructor(e,t,{attributes:i=eu.NONE,blendFunction:r=Gi.SCREEN,defines:n=new Map,uniforms:s=new Map,extensions:a=null,vertexShader:o=null}={}){super(),this.name=e,this.renderer=null,this.attributes=i,this.fragmentShader=t,this.vertexShader=o,this.defines=n,this.uniforms=s,this.extensions=a,this.blendMode=new $Oe(r),this.blendMode.addEventListener("change",l=>this.setChanged())}getName(){return this.name}setRenderer(e){this.renderer=e}getDefines(){return this.defines}getUniforms(){return this.uniforms}getExtensions(){return this.extensions}getBlendMode(){return this.blendMode}getAttributes(){return this.attributes}setAttributes(e){this.attributes=e,this.setChanged()}getFragmentShader(){return this.fragmentShader}setFragmentShader(e){this.fragmentShader=e,this.setChanged()}getVertexShader(){return this.vertexShader}setVertexShader(e){this.vertexShader=e,this.setChanged()}setChanged(){this.dispatchEvent({type:"change"})}setDepthTexture(e,t=Uh){}update(e,t,i){}setSize(e,t){}initialize(e,t,i){}dispose(){for(let e of Object.keys(this)){let t=this[e];if(t!==null&&typeof t=="object"&&typeof t.dispose=="function"){if(t instanceof co||t===this.renderer)continue;this[e].dispose()}}}};function _9(e,t,i){for(let r of t){let n="$1"+e+r.charAt(0).toUpperCase()+r.slice(1),s=new RegExp("([^\\.])(\\b"+r+"\\b)","g");for(let a of i.entries())a[1]!==null&&i.set(a[0],a[1].replace(s,n))}}function eze(e,t,i,r,n,s,a){let o=new Map([["fragment",t.getFragmentShader()],["vertex",t.getVertexShader()]]),l=o.get("fragment")!==void 0&&/mainImage/.test(o.get("fragment")),c=o.get("fragment")!==void 0&&/mainUv/.test(o.get("fragment")),u=[],h=[],d=!1,f=!1;if(o.get("fragment")===void 0)console.error("Missing fragment shader",t);else if(c&&a&eu.CONVOLUTION)console.error("Effects that transform UV coordinates are incompatible with convolution effects",t);else if(!l&&!c)console.error("The fragment shader contains neither a mainImage nor a mainUv function",t);else{let p=/(?:\w+\s+(\w+)\([\w\s,]*\)\s*{[^}]+})/g,v=wB.Section;if(c){let g=`	${e}MainUv(UV);
`;i.set(v.FRAGMENT_MAIN_UV,i.get(v.FRAGMENT_MAIN_UV)+g),d=!0}if(o.get("vertex")!==null&&/mainSupport/.test(o.get("vertex"))){let g=`	${e}MainSupport(`;g+=/mainSupport *\([\w\s]*?uv\s*?\)/.test(o.get("vertex"))?`vUv);
`:`);
`,i.set(v.VERTEX_MAIN_SUPPORT,i.get(v.VERTEX_MAIN_SUPPORT)+g),u=u.concat([...o.get("vertex").matchAll(/(?:varying\s+\w+\s+(\w*))/g)].map(y=>y[1])),h=h.concat(u).concat([...o.get("vertex").matchAll(p)].map(y=>y[1]))}h=h.concat([...o.get("fragment").matchAll(p)].map(g=>g[1])),h=h.concat([...t.defines.keys()].map(g=>g.replace(/\([\w\s,]*\)/g,""))),h=h.concat([...t.uniforms.keys()]),t.uniforms.forEach((g,y)=>s.set(e+y.charAt(0).toUpperCase()+y.slice(1),g)),t.defines.forEach((g,y)=>n.set(e+y.charAt(0).toUpperCase()+y.slice(1),g)),_9(e,h,n),_9(e,h,o);let m=t.blendMode;if(r.set(m.blendFunction,m),l){let g=/MainImage *\([\w\s,]*?depth[\w\s,]*?\)/,y=`${e}MainImage(color0, UV, `;a&eu.DEPTH&&g.test(o.get("fragment"))&&(y+="depth, ",f=!0),y+=`color1);
	`;let x=e+"BlendOpacity";s.set(x,m.opacity),y+=`color0 = blend${m.blendFunction}(color0, color1, ${x});

	`,i.set(v.FRAGMENT_MAIN_IMAGE,i.get(v.FRAGMENT_MAIN_IMAGE)+y),y=`uniform float ${x};

`,i.set(v.FRAGMENT_HEAD,i.get(v.FRAGMENT_HEAD)+y)}i.set(v.FRAGMENT_HEAD,i.get(v.FRAGMENT_HEAD)+o.get("fragment")+`
`),o.get("vertex")!==null&&i.set(v.VERTEX_HEAD,i.get(v.VERTEX_HEAD)+o.get("vertex")+`
`)}return{varyings:u,transformedUv:d,readDepth:f}}var $A=class extends Ua{constructor(e,...t){super("EffectPass"),this.fullscreenMaterial=new wB(null,null,null,e),this.effects=t.sort((i,r)=>r.attributes-i.attributes),this.skipRendering=!1,this.uniformCount=0,this.varyingCount=0,this.minTime=1,this.maxTime=Number.POSITIVE_INFINITY}get encodeOutput(){return this.fullscreenMaterial.encodeOutput}set encodeOutput(e){this.fullscreenMaterial.encodeOutput=e}get dithering(){return this.fullscreenMaterial.dithering}set dithering(e){let t=this.fullscreenMaterial;t.dithering=e,t.needsUpdate=!0}verifyResources(){let e=this.renderer.capabilities,t=Math.min(e.maxFragmentUniforms,e.maxVertexUniforms);this.uniformCount>t&&console.warn("The current rendering context doesn't support more than "+t+" uniforms, but "+this.uniformCount+" were defined"),t=e.maxVaryings,this.varyingCount>t&&console.warn("The current rendering context doesn't support more than "+t+" varyings, but "+this.varyingCount+" were defined")}updateMaterial(){let e=wB.Section,t=new Map([[e.FRAGMENT_HEAD,""],[e.FRAGMENT_MAIN_UV,""],[e.FRAGMENT_MAIN_IMAGE,""],[e.VERTEX_HEAD,""],[e.VERTEX_MAIN_SUPPORT,""]]),i=new Map,r=new Map,n=new Map,s=new Set,a=0,o=0,l=0,c=!1,u=!1;for(let d of this.effects)if(d.blendMode.blendFunction===Gi.SKIP)l|=d.getAttributes()&eu.DEPTH;else if(l&d.getAttributes()&eu.CONVOLUTION)console.error("Convolution effects cannot be merged",d);else{l|=d.getAttributes();let f="e"+a++,p=eze(f,d,t,i,r,n,l);if(o+=p.varyings.length,c=c||p.transformedUv,u=u||p.readDepth,d.extensions!==null)for(let v of d.extensions)s.add(v)}let h=/\bblend\b/g;for(let d of i.values()){let f=d.getShaderCode().replace(h,`blend${d.blendFunction}`);t.set(e.FRAGMENT_HEAD,t.get(e.FRAGMENT_HEAD)+f+`
`)}l&eu.DEPTH?(u&&t.set(e.FRAGMENT_MAIN_IMAGE,`float depth = readDepth(UV);

	`+t.get(e.FRAGMENT_MAIN_IMAGE)),this.needsDepthTexture=this.getDepthTexture()===null):this.needsDepthTexture=!1,c?(t.set(e.FRAGMENT_MAIN_UV,`vec2 transformedUv = vUv;
`+t.get(e.FRAGMENT_MAIN_UV)),r.set("UV","transformedUv")):r.set("UV","vUv"),t.forEach((d,f,p)=>p.set(f,d.trim().replace(/^#/,`
#`))),this.uniformCount=n.size,this.varyingCount=o,this.skipRendering=a===0,this.needsSwap=!this.skipRendering,this.fullscreenMaterial.setShaderParts(t).setExtensions(s).setUniforms(n).setDefines(r)}recompile(){this.updateMaterial(),this.verifyResources()}getDepthTexture(){return this.fullscreenMaterial.depthBuffer}setDepthTexture(e,t=Uh){this.fullscreenMaterial.depthBuffer=e,this.fullscreenMaterial.depthPacking=t;for(let i of this.effects)i.setDepthTexture(e,t)}render(e,t,i,r,n){for(let s of this.effects)s.update(e,t,r);if(!this.skipRendering||this.renderToScreen){let s=this.fullscreenMaterial;s.inputBuffer=t.texture,s.time+=r,e.setRenderTarget(this.renderToScreen?null:i),e.render(this.scene,this.camera)}}setSize(e,t){this.fullscreenMaterial.setSize(e,t);for(let i of this.effects)i.setSize(e,t)}initialize(e,t,i){this.renderer=e;for(let r of this.effects)r.initialize(e,t,i),r.addEventListener("change",n=>this.handleEvent(n));this.updateMaterial(),this.verifyResources(),i!==void 0&&i!==ca&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}dispose(){super.dispose();for(let e of this.effects)e.dispose()}handleEvent(e){switch(e.type){case"change":this.recompile();break}}},tze=[new Float32Array([0,0]),new Float32Array([0,1,1]),new Float32Array([0,1,1,2]),new Float32Array([0,1,2,2,3]),new Float32Array([0,1,2,3,4,4,5]),new Float32Array([0,1,2,3,4,5,7,8,9,10])],l4=class extends Ua{constructor({resolutionScale:e=.5,width:t=no.AUTO_SIZE,height:i=no.AUTO_SIZE,kernelSize:r=XC.LARGE}={}){super("KawaseBlurPass"),this.renderTargetA=new Ni(1,1,{minFilter:bi,magFilter:bi,stencilBuffer:!1,depthBuffer:!1}),this.renderTargetA.texture.name="Blur.Target.A",this.renderTargetB=this.renderTargetA.clone(),this.renderTargetB.texture.name="Blur.Target.B";let n=this.resolution=new no(this,t,i,e);n.addEventListener("change",s=>this.setSize(n.baseWidth,n.baseHeight)),this.blurMaterial=new x9,this.ditheredBlurMaterial=new x9,this.ditheredBlurMaterial.uniforms.scale=this.blurMaterial.uniforms.scale,this.ditheredBlurMaterial.dithering=!0,this.dithering=!1,this.kernelSize=r}getResolution(){return this.resolution}get width(){return this.resolution.width}set width(e){this.resolution.preferredWidth=e}get height(){return this.resolution.height}set height(e){this.resolution.preferredHeight=e}get scale(){return this.blurMaterial.scale}set scale(e){this.blurMaterial.scale=e}getScale(){return this.blurMaterial.scale}setScale(e){this.blurMaterial.scale=e}getKernelSize(){return this.kernelSize}setKernelSize(e){this.kernelSize=e}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}render(e,t,i,r,n){let s=this.scene,a=this.camera,o=this.renderTargetA,l=this.renderTargetB,c=tze[this.kernelSize],u=this.blurMaterial,h=t,d,f;for(this.fullscreenMaterial=u,d=0,f=c.length-1;d<f;++d){let p=d&1?l:o;u.kernel=c[d],u.inputBuffer=h.texture,e.setRenderTarget(p),e.render(s,a),h=p}this.dithering&&(u=this.ditheredBlurMaterial,this.fullscreenMaterial=u),u.kernel=c[d],u.inputBuffer=h.texture,e.setRenderTarget(this.renderToScreen?null:i),e.render(s,a)}setSize(e,t){let i=this.resolution;i.setBaseSize(e,t);let r=i.width,n=i.height;this.renderTargetA.setSize(r,n),this.renderTargetB.setSize(r,n),this.blurMaterial.setSize(r,n),this.ditheredBlurMaterial.setSize(r,n)}initialize(e,t,i){i!==void 0&&(this.renderTargetA.texture.type=i,this.renderTargetB.texture.type=i,i!==ca?(this.blurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.ditheredBlurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1"):e.outputEncoding===vi&&(this.renderTargetA.texture.encoding=vi,this.renderTargetB.texture.encoding=vi))}static get AUTO_SIZE(){return no.AUTO_SIZE}},ize=class extends Ua{constructor({width:e=no.AUTO_SIZE,height:t=no.AUTO_SIZE,renderTarget:i,luminanceRange:r,colorOutput:n}={}){super("LuminancePass"),this.fullscreenMaterial=new MOe(n,r),this.needsSwap=!1,this.renderTarget=i,this.renderTarget===void 0&&(this.renderTarget=new Ni(1,1,{minFilter:bi,magFilter:bi,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="LuminancePass.Target",this.renderTarget.texture.generateMipmaps=!1);let s=this.resolution=new no(this,e,t);s.addEventListener("change",a=>this.setSize(s.baseWidth,s.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}render(e,t,i,r,n){let s=this.fullscreenMaterial;s.inputBuffer=t.texture,e.setRenderTarget(this.renderToScreen?null:this.renderTarget),e.render(this.scene,this.camera)}setSize(e,t){let i=this.resolution;i.setBaseSize(e,t),this.renderTarget.setSize(i.width,i.height)}initialize(e,t,i){i!==void 0&&i!==ca&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},rze=class extends Ua{constructor(e,t){super("MaskPass",e,t),this.needsSwap=!1,this.clearPass=new o4(!1,!1,!0),this.inverse=!1}get inverted(){return this.inverse}set inverted(e){this.inverse=e}get clear(){return this.clearPass.enabled}set clear(e){this.clearPass.enabled=e}getClearPass(){return this.clearPass}isInverted(){return this.inverted}setInverted(e){this.inverted=e}render(e,t,i,r,n){let s=e.getContext(),a=e.state.buffers,o=this.scene,l=this.camera,c=this.clearPass,u=this.inverted?0:1,h=1-u;a.color.setMask(!1),a.depth.setMask(!1),a.color.setLocked(!0),a.depth.setLocked(!0),a.stencil.setTest(!0),a.stencil.setOp(s.REPLACE,s.REPLACE,s.REPLACE),a.stencil.setFunc(s.ALWAYS,u,4294967295),a.stencil.setClear(h),a.stencil.setLocked(!0),this.clearPass.enabled&&(this.renderToScreen?c.render(e,null):(c.render(e,t),c.render(e,i))),this.renderToScreen?(e.setRenderTarget(null),e.render(o,l)):(e.setRenderTarget(t),e.render(o,l),e.setRenderTarget(i),e.render(o,l)),a.color.setLocked(!1),a.depth.setLocked(!1),a.stencil.setLocked(!1),a.stencil.setFunc(s.EQUAL,1,4294967295),a.stencil.setOp(s.KEEP,s.KEEP,s.KEEP),a.stencil.setLocked(!0)}},hl=class extends Ua{constructor(e,t="inputBuffer"){super("ShaderPass"),this.fullscreenMaterial=e,this.inputBufferUniform=null,this.setInput(t)}setInput(e){if(this.inputBufferUniform=null,this.fullscreenMaterial!==null){let t=this.fullscreenMaterial.uniforms;t!==void 0&&t[e]!==void 0&&(this.inputBufferUniform=t[e])}}render(e,t,i,r,n){this.inputBufferUniform!==null&&t!==null&&(this.inputBufferUniform.value=t.texture),e.setRenderTarget(this.renderToScreen?null:i),e.render(this.scene,this.camera)}initialize(e,t,i){i!==void 0&&i!==ca&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},HR=1/1e3,nze=1e3,sze=class{constructor(){this.previousTime=0,this.currentTime=0,this.delta=0,this.fixedDelta=1e3/60,this.elapsed=0,this.timescale=1,this.fixedDeltaEnabled=!1,this.autoReset=!1}setFixedDeltaEnabled(e){return this.fixedDeltaEnabled=e,this}isAutoResetEnabled(e){return this.autoReset}setAutoResetEnabled(e){return typeof document<"u"&&document.hidden!==void 0&&(e?document.addEventListener("visibilitychange",this):document.removeEventListener("visibilitychange",this),this.autoReset=e),this}getDelta(){return this.delta*HR}getFixedDelta(){return this.fixedDelta*HR}setFixedDelta(e){return this.fixedDelta=e*nze,this}getElapsed(){return this.elapsed*HR}getTimescale(){return this.timescale}setTimescale(e){return this.timescale=e,this}update(e){return this.fixedDeltaEnabled?this.delta=this.fixedDelta:(this.previousTime=this.currentTime,this.currentTime=e!==void 0?e:performance.now(),this.delta=this.currentTime-this.previousTime),this.delta*=this.timescale,this.elapsed+=this.delta,this}reset(){return this.delta=0,this.elapsed=0,this.currentTime=performance.now(),this}handleEvent(e){document.hidden||(this.currentTime=performance.now())}dispose(){this.setAutoResetEnabled(!1)}},XC={VERY_SMALL:0,SMALL:1,MEDIUM:2,LARGE:3,VERY_LARGE:4,HUGE:5},aze=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D map;
#else
uniform lowp sampler2D map;
#endif
uniform float intensity;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){outputColor=clamp(texture2D(map,uv)*intensity,0.0,1.0);}`,oze=class extends fu{constructor({blendFunction:e=Gi.SCREEN,luminanceThreshold:t=.9,luminanceSmoothing:i=.025,resolutionScale:r=.5,intensity:n=1,width:s=no.AUTO_SIZE,height:a=no.AUTO_SIZE,kernelSize:o=XC.LARGE}={}){super("BloomEffect",aze,{blendFunction:e,uniforms:new Map([["map",new ct(null)],["intensity",new ct(n)]])}),this.renderTarget=new Ni(1,1,{minFilter:bi,magFilter:bi,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="Bloom.Target",this.renderTarget.texture.generateMipmaps=!1,this.uniforms.get("map").value=this.renderTarget.texture,this.luminancePass=new ize({renderTarget:this.renderTarget,colorOutput:!0}),this.luminanceMaterial.threshold=t,this.luminanceMaterial.smoothingFactor=i,this.blurPass=new l4({resolutionScale:r,width:s,height:a,kernelSize:o});let l=this.blurPass.getResolution();l.addEventListener("change",c=>this.setSize(l.baseWidth,l.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}get resolution(){return this.blurPass.resolution}getResolution(){return this.blurPass.resolution}getBlurPass(){return this.blurPass}getLuminancePass(){return this.luminancePass}get luminanceMaterial(){return this.luminancePass.fullscreenMaterial}getLuminanceMaterial(){return this.luminancePass.fullscreenMaterial}get width(){return this.resolution.width}set width(e){this.resolution.preferredWidth=e}get height(){return this.resolution.height}set height(e){this.resolution.preferredHeight=e}get dithering(){return this.blurPass.dithering}set dithering(e){this.blurPass.dithering=e}get kernelSize(){return this.blurPass.kernelSize}set kernelSize(e){this.blurPass.kernelSize=e}get distinction(){return console.warn(this.name,"distinction was removed"),1}set distinction(e){console.warn(this.name,"distinction was removed")}get intensity(){return this.uniforms.get("intensity").value}set intensity(e){this.uniforms.get("intensity").value=e}getIntensity(){return this.intensity}setIntensity(e){this.intensity=e}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}update(e,t,i){let r=this.renderTarget;this.luminancePass.enabled?(this.luminancePass.render(e,t,r),this.blurPass.render(e,r,r)):this.blurPass.render(e,t,r)}setSize(e,t){let i=this.resolution;i.setBaseSize(e,t),this.renderTarget.setSize(i.width,i.height),this.luminancePass.resolution.copy(i)}initialize(e,t,i){this.blurPass.initialize(e,t,i),i!==void 0&&(this.renderTarget.texture.type=i,e.outputEncoding===vi&&(this.renderTarget.texture.encoding=vi))}},lze="uniform float brightness;uniform float contrast;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=inputColor.rgb+vec3(brightness-0.5);if(contrast>0.0){color/=vec3(1.0-contrast);}else{color*=vec3(1.0+contrast);}outputColor=vec4(min(color+vec3(0.5),1.0),inputColor.a);}",cze=class extends fu{constructor({blendFunction:e=Gi.NORMAL,brightness:t=0,contrast:i=0}={}){super("BrightnessContrastEffect",lze,{blendFunction:e,uniforms:new Map([["brightness",new ct(t)],["contrast",new ct(i)]])})}get brightness(){return this.uniforms.get("brightness").value}set brightness(e){this.uniforms.get("brightness").value=e}getBrightness(e){return this.brightness}setBrightness(e){this.brightness=e}get contrast(){return this.uniforms.get("contrast").value}set contrast(e){this.uniforms.get("contrast").value=e}getContrast(e){return this.contrast}setContrast(e){this.contrast=e}},uze="void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){outputColor=vec4(vec3(average(inputColor.rgb)),inputColor.a);}",hze=class extends fu{constructor(e=Gi.NORMAL){super("ColorAverageEffect",uze,{blendFunction:e})}},dze="varying vec2 vUvR;varying vec2 vUvB;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec2 ra=texture2D(inputBuffer,vUvR).ra;vec2 ba=texture2D(inputBuffer,vUvB).ba;outputColor=vec4(ra.x,inputColor.g,ba.x,max(max(ra.y,ba.y),inputColor.a));}",fze="uniform vec2 offset;varying vec2 vUvR;varying vec2 vUvB;void mainSupport(const in vec2 uv){vec2 shift=offset*vec2(1.0,aspect);vUvR=uv+shift;vUvB=uv-shift;}",pze=class extends fu{constructor({blendFunction:e=Gi.NORMAL,offset:t=new Me(.001,5e-4)}={}){super("ChromaticAberrationEffect",dze,{vertexShader:fze,blendFunction:e,attributes:eu.CONVOLUTION,uniforms:new Map([["offset",new ct(t)]])})}get offset(){return this.uniforms.get("offset").value}set offset(e){this.uniforms.get("offset").value=e}getOffset(){return this.offset}setOffset(e){this.offset=e}},mze=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D nearColorBuffer;uniform mediump sampler2D farColorBuffer;
#else
uniform lowp sampler2D nearColorBuffer;uniform lowp sampler2D farColorBuffer;
#endif
uniform lowp sampler2D nearCoCBuffer;uniform float scale;void mainImage(const in vec4 inputColor,const in vec2 uv,const in float depth,out vec4 outputColor){vec4 colorNear=texture2D(nearColorBuffer,uv);vec4 colorFar=texture2D(farColorBuffer,uv);float CoCNear=texture2D(nearCoCBuffer,uv).r;CoCNear=min(CoCNear*scale,1.0);vec4 result=inputColor*(1.0-colorFar.a)+colorFar;result=mix(result,colorNear,CoCNear);outputColor=result;}`,gze=class extends fu{constructor(e,{blendFunction:t=Gi.NORMAL,worldFocusDistance:i,worldFocusRange:r,focusDistance:n=0,focalLength:s=.1,focusRange:a=s,bokehScale:o=1,width:l=no.AUTO_SIZE,height:c=no.AUTO_SIZE}={}){super("DepthOfFieldEffect",mze,{blendFunction:t,attributes:eu.DEPTH,uniforms:new Map([["nearColorBuffer",new ct(null)],["farColorBuffer",new ct(null)],["nearCoCBuffer",new ct(null)],["scale",new ct(1)]])}),this.camera=e,this.renderTarget=new Ni(1,1,{minFilter:bi,magFilter:bi,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="DoF.Intermediate",this.renderTarget.texture.generateMipmaps=!1,this.renderTargetMasked=this.renderTarget.clone(),this.renderTargetMasked.texture.name="DoF.Masked.Far",this.renderTargetNear=this.renderTarget.clone(),this.renderTargetNear.texture.name="DoF.Bokeh.Near",this.uniforms.get("nearColorBuffer").value=this.renderTargetNear.texture,this.renderTargetFar=this.renderTarget.clone(),this.renderTargetFar.texture.name="DoF.Bokeh.Far",this.uniforms.get("farColorBuffer").value=this.renderTargetFar.texture,this.renderTargetCoC=this.renderTarget.clone(),this.renderTargetCoC.texture.name="DoF.CoC",this.renderTargetCoCBlurred=this.renderTargetCoC.clone(),this.renderTargetCoCBlurred.texture.name="DoF.CoC.Blurred",this.uniforms.get("nearCoCBuffer").value=this.renderTargetCoCBlurred.texture,this.cocPass=new hl(new dOe(e));let u=this.cocMaterial;u.focusDistance=n,u.focusRange=a,i!==void 0&&(u.worldFocusDistance=i),r!==void 0&&(u.worldFocusRange=r),this.blurPass=new l4({kernelSize:XC.MEDIUM,width:l,height:c});let h=this.blurPass.getResolution();h.addEventListener("change",f=>this.setSize(h.getBaseWidth(),h.getBaseHeight())),this.maskPass=new hl(new AOe(this.renderTargetCoC.texture));let d=this.maskPass.fullscreenMaterial;d.maskFunction=oie.MULTIPLY,d.colorChannel=aie.GREEN,this.bokehNearBasePass=new hl(new MM(!1,!0)),this.bokehNearBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehNearFillPass=new hl(new MM(!0,!0)),this.bokehNearFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehFarBasePass=new hl(new MM(!1,!1)),this.bokehFarBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.bokehFarFillPass=new hl(new MM(!0,!1)),this.bokehFarFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.target=null,this.bokehScale=o}get cocTexture(){return this.renderTargetCoC.texture}get cocMaterial(){return this.cocPass.fullscreenMaterial}get circleOfConfusionMaterial(){return this.cocMaterial}getCircleOfConfusionMaterial(){return this.circleOfConfusionMaterial}getBlurPass(){return this.blurPass}get resolution(){return this.blurPass.getResolution()}getResolution(){return this.blurPass.getResolution()}get bokehScale(){return this.uniforms.get("scale").value}set bokehScale(e){let t=[this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass];for(let i of t)i.fullscreenMaterial.setScale(e);this.maskPass.fullscreenMaterial.setStrength(e),this.uniforms.get("scale").value=e}getBokehScale(){return this.bokehScale}setBokehScale(e){this.bokehScale=e}getTarget(){return this.target}setTarget(e){this.target=e}calculateFocusDistance(e){let t=this.camera,i=t.position.distanceTo(e);return xB(-i,t.near,t.far)}setDepthTexture(e,t=Uh){this.circleOfConfusionMaterial.depthBuffer=e,this.circleOfConfusionMaterial.depthPacking=t}update(e,t,i){let r=this.renderTarget,n=this.renderTargetCoC,s=this.renderTargetCoCBlurred,a=this.renderTargetMasked;if(this.target!==null){let o=this.calculateFocusDistance(this.target);this.circleOfConfusionMaterial.focusDistance=o}this.cocPass.render(e,null,n),this.blurPass.render(e,n,s),this.maskPass.render(e,t,a),this.bokehFarBasePass.render(e,a,r),this.bokehFarFillPass.render(e,r,this.renderTargetFar),this.bokehNearBasePass.render(e,t,r),this.bokehNearFillPass.render(e,r,this.renderTargetNear)}setSize(e,t){let i=this.resolution;i.setBaseSize(e,t);let r=i.width,n=i.height,s=[this.cocPass,this.blurPass,this.maskPass,this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass];s.push(this.renderTargetCoC,this.renderTargetMasked),s.forEach(a=>a.setSize(e,t)),s=[this.renderTarget,this.renderTargetNear,this.renderTargetFar,this.renderTargetCoCBlurred],s.forEach(a=>a.setSize(r,n)),[this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass].forEach(a=>a.fullscreenMaterial.setSize(r,n))}initialize(e,t,i){[this.cocPass,this.maskPass,this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass].forEach(r=>r.initialize(e,t,i)),this.blurPass.initialize(e,t,ca),i!==void 0&&(this.renderTarget.texture.type=i,this.renderTargetNear.texture.type=i,this.renderTargetFar.texture.type=i,this.renderTargetMasked.texture.type=i,e.outputEncoding===vi&&(this.renderTarget.texture.encoding=vi,this.renderTargetNear.texture.encoding=vi,this.renderTargetFar.texture.encoding=vi,this.renderTargetMasked.texture.encoding=vi))}};new N;new ft;var vze="uniform vec3 hue;uniform float saturation;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=vec3(dot(inputColor.rgb,hue.xyz),dot(inputColor.rgb,hue.zxy),dot(inputColor.rgb,hue.yzx));float average=(color.r+color.g+color.b)/3.0;vec3 diff=average-color;if(saturation>0.0){color+=diff*(1.0-1.0/(1.001-saturation));}else{color+=diff*-saturation;}outputColor=vec4(min(color,1.0),inputColor.a);}",yze=class extends fu{constructor({blendFunction:e=Gi.NORMAL,hue:t=0,saturation:i=0}={}){super("HueSaturationEffect",vze,{blendFunction:e,uniforms:new Map([["hue",new ct(new N)],["saturation",new ct(i)]])}),this.hue=t}get saturation(){return this.uniforms.get("saturation").value}set saturation(e){this.uniforms.get("saturation").value=e}getSaturation(){return this.saturation}setSaturation(e){this.saturation=e}get hue(){let e=this.uniforms.get("hue").value;return Math.acos((e.x*3-1)/2)}set hue(e){let t=Math.sin(e),i=Math.cos(e);this.uniforms.get("hue").value.set((2*i+1)/3,(-Math.sqrt(3)*t-i+1)/3,(Math.sqrt(3)*t-i+1)/3)}getHue(){return this.hue}setHue(e){this.hue=e}};new Yt;var xze=`void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 noise=vec3(rand(uv*time));
#ifdef PREMULTIPLY
outputColor=vec4(min(inputColor.rgb*noise,vec3(1.0)),inputColor.a);
#else
outputColor=vec4(noise,inputColor.a);
#endif
}`,wze=class extends fu{constructor({blendFunction:e=Gi.SCREEN,premultiply:t=!1}={}){super("NoiseEffect",xze,{blendFunction:e}),this.premultiply=t}get premultiply(){return this.defines.has("PREMULTIPLY")}set premultiply(e){this.premultiply!==e&&(e?this.defines.set("PREMULTIPLY","1"):this.defines.delete("PREMULTIPLY"),this.setChanged())}isPremultiplied(){return this.premultiply}setPremultiplied(e){this.premultiply=e}},bze="uniform bool active;uniform vec2 d;void mainUv(inout vec2 uv){if(active){uv=vec2(d.x*(floor(uv.x/d.x)+0.5),d.y*(floor(uv.y/d.y)+0.5));}}",_ze=class extends fu{constructor(e=30){super("PixelationEffect",bze,{uniforms:new Map([["active",new ct(!1)],["d",new ct(new Me)]])}),this.resolution=new Me,this.d=0,this.granularity=e}get granularity(){return this.d}set granularity(e){let t=Math.floor(e);t%2>0&&(t+=1),this.d=t,this.uniforms.get("active").value=t>0,this.setSize(this.resolution.width,this.resolution.height)}getGranularity(){return this.granularity}setGranularity(e){this.granularity=e}setSize(e,t){this.resolution.set(e,t),this.uniforms.get("d").value.setScalar(this.d).divide(this.resolution)}};new N;new N;var S9="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAAQCAYAAACm53kpAAAAeElEQVRYR+2XSwqAMAxEJ168ePEqwRSKhIIiuHjJqiU0gWE+1CQdApcVAMUAuARaMGCX1MIL/Ow13++9lW2s3mW9MWvsnWc/2fvGygwPAN4E8QzAA4CXAB6AHjG4JTHYI1ey3pcx6FHnEfhLDOIBKAmUBK6/ANUDTlROXAHd9EC1AAAAAElFTkSuQmCC",M9="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKAAAAIwCAYAAAABNmBHAAAgAElEQVR4Xuy9CbhlV1ktOvbpq09DkiIkUBI6kxASIH0DlAQiIK1wRfSJTx+i4JX7vKIigs8HXpXvqVcvrcC9agQ7IDTSSWgqCQQliDRBJKkkhDSkqVPNqVOnP+8b//rH3P+eZ+199tlznVTlvVrft7+1T7OaueZY42/m37QALKNk2wHg1pITlB17mC+Pp11W3X/LHyT32vhg48/5SOv+PnwpsHA70JoGlueB1iKApeqzvOzn44GatTB76Xzhd7suBR7+WWADgDEAwwCG/L54b/poDLrHuvvm70Z2Avhsc+PVcxscBU8F8C8ADg5+ipIjD/PlGwfgju8B924E5seARUfLsiNmqQW0IjL8+7L2NYD/7COBzfcCm+aB8SVgdAkYIRCXKyDax4EdAanL5PuNPllNvXDlAHwFgP8AcC2AhRIoDXbsYb48dl5WkVFTE3LGDcC9m4CZCWBuFFgeAZaGAYJQQCRqDHT+McJrVb8zwATUXH02MHYfMHEIGFsAxgjApQqACYQORjtd/B7Axt/z79sC0+cMPgjjlwPwVwHcA+DfAHzTxcVgWBroqMN8+cYBeM71wH0TwKExYHYUWCIAHYRLTlkCYgcIBcAgU/n3qy8GRu4HRgnAOWBkERhddPAJhGJDBxkvw7cqimr+zFM/ZLnZF64cgL8BYD+AWwB8x/dlWuWagHiYL984AJ/0RWBy1AE4AizyM1yxYAcTigW55xMbAkxEiwEdkJ/ZCQxPAiOHgBECcKEC4TBZcKkSv+mTieNcNPNC26mLNsj45QD8LQDTAO4GcJt/7iw2bfoG4WG+vAGwm9ExiEg69zpg/wgwPQLMjgALzn4E4aIzoJjQ9g4024uygkj+pyuAoX0VAIfngOH5NgCHMhAm8Sv2y3XDZeBhNIp8OzJE8OsBzAKYBHAXgDt8/4O+MVT0j4f58o0D8Pxrgf3DwMwIMEPQEYRkNwfgsuuDZLskip0No0gWMD/9HGDoADAkAC4Aw/wsAgZAgs2Z0ABI0GU6IVmKv+f28KDnHxkA/G0A8y6G73N9kOCjXnh/Ebb6OvgwX75xAF5wLTA1VIHPADgMLDj4yIA5AAm6aCUnv4oz46eeDwxNAUMzwJAz4BABSNDFTwSfg7DDKHE23MG5PqIY8A1u/dINs9dBdy8AgnGPM2NfUBrsnw7z5RsH4IXXAAcJviFgluAbygBINnSLWOAjGxJ4pgOKDV0v/OSLKp8iGXBovhLBBOCQM2ACoTOhnYrAdItYbCij5JFzRyIAqRccAnDAQUjg6UNQ7hsMXP0cRQAexss3DsCLCECCLwCQzMcPwUi2MwAScAKbfnY/YRLFQ8DHX+IAJAMSfDkAF13kLvleIjhjQQHxUVS3jjgGpKeeNzYVQEjgUS8k+PghONdhIwAP4+XXBYCHKIJbwJyDTgaIAdCBJx3Q2M8tYAHP9m4df/ylQOsQ0JqtRLCx30K1wtLBggScQOgsKBGcWHAJeOwRC0BSM1mQIKRbhh+Bj98JQP6t4U0APEyXXxcAEnxkQAFwoVUxID9kvQg+c1C7vidRbIDkc24B//hTQGumDcCWA5DgMxASdNIFBUI5pCML8v8API5zfEQx4BudgqiczviSnJhQwCP4BMCGl+wO8+U7AJi/W4O4YS6+pmK/2ciADsAOBhTIIiAJnPB7AvNjP+0AnANaYkAHX2JBAc+tYaJXOqBZv24Vc386XW5dtkHGW+4HFAJonpOe+YYQZAShgKjv3PNvPQaxVoI8zJdfFwASfPzMUwS3Kt1v0UFIlos6oDFdAGFcliMAP/ryAEAGNwQRnDOgLbdlIEwrIs6AZ/QgkMMHQF6ZAKQcJAsSYPwIeAIk9wJgoPK1gi7+PwF4GC/fOAAvIQPSs0URTPBJ/Pp3GSEGRHfBCIQ0xowBtUbcAj7ys5X4Jfu1HIAGQrIgQRXEsAFQIORDFhiDY/rMHmrU4QUgR08AkgUjCAW6CD6CkwBsAIQC4GG6fPMA3OXiNzCg2I9gNCMksmAAoemDzoimFwL48M85AKkiuQVMAAp8CYRRDAt8GQiJ67N6GJODAXAHlsGguscA2AJg1IPGYmxOpBxFWkRN9LsATgIwXnNs/v/5z/9XCf8BO3YAtxbc/46/KDt+5+ea1Yku2VUxHz/z0v24FwMGK1gWsK2OUUxHHdCBeRUB6OxHABr4ZICIBd0QWSF+XRdMTAjgCdTrG9cBNwE4F8CpDkICyYLGsuhFt6zs+gISwUen8zEAjgMw4cfx2H6O/90yAFo84Cbg4ID3/9TfLTt+5+ebnRABkODjx0SwPi5ec/FrYpmqSAxM8Dn60CsqAFI6GfhqAMiDE/gokmvEr0C4PgDkBQm40wE8zMFEUDKEVoxIMLl/KS73mE7H9d+vcKHQQcjwW0Yu9nP8m8sAmOIBuWY6wP2/4s0ezjjg8TuvaR6ABJ70vxUApGrm7EbGE+i472BAB+WHfqHS/eoAaEwY2E9+wLSXTqhI7CXgnB6LCoOJ4BiST+hTnG0HcCwAglCx3ARoZEVFXnBPp/O/A/hXACc7CPs9/i1lAOyIB+RDX+P9/+pbQjjjAMfv/PL6AFDs1wFAgs/9fgKfgdE/ZEpuiQlbwAde6QAMBgiRmsSwA9BY0JfjovGRDBMH4TlcXGhcBOc6HkF0gjPhZgchxTLZMAci/04W/B6Ab3t09EPXcPyflgFwRTwgJ2MN9/8bf5qFM67x+B/aW4XQz42FeL0YrRyikztUFw0704mf9kXgxhOAqc3AAsPyRxxQCs/PdXOFY0W1KHy3QIUGtx+6vdnx1vsB+dsTncm2AogglFgVEAlUWrOMB2RyEmMCGQ/Y7/HvKns6tfGAnJQ+r/9b76oJZ1zD8WdyQjYBh8aBhVEHjELouQ8ukQ7VRSCJAALwkr+sALhnGzDD3JAJYJHg9uhoi4bx8ytkWUtvHT/7+Zc4dw1uZ3612fH2dkQf7yxIEEockwkJQn4IQoq8unhAhmPRKKFx0uv4K8ueTs94wD7u//VX9ghn7OP4c+4G7h8HpseB+dF2AKlFLwuAIZ8jD6NPrOhAffmfA9/ZBuzZCkyRWSeqBCWyoYGQ5yQrBpDbum/ME1HoPo0XEkSD2zlfbna8q6+EUJcTCxKEtHL5EQjP6BEPyIgYAZBvYt3xHyx7OqvGA65y/7/9wVXCGVc5/sl7qxD66dEqiYgRzAqhN1A4CBNAAlDyAFI+iZ9/N3DLJuC+jcDUBmCWyUnOrmTYCMIOkNclLg0B8/RsNLg9+UvNjnd1APLmmQpFHyEBROuWACQT8nN+H/GAvY7/VNnT6SsesMf13/CpahGnZzhjj+PPmwX2MYdDIfQexWyBAwEUOQDrRDN/98p3A7dvAO6fAA5sqHJDBEAyoUVGkwEd6HR12XU4kwzfl6fCXTZzjy57vvnR513X7Hj7AyDvggAUi9EyFgiZqNxPQF6345nOWbD1HQ/Y5fpvuLa/2+82/vNHgAPDFQDnhoF5j2C2qBWCI8bw1eRw5CL5l94L3DEOTI4DB8Y9OWmsEu/zBJ3rgsaybqBob/7A4C7jtWcooRrczr+u2fH2D0AOQgAUCxKEP7aGgLy64+m6KdjWFA9Yc/03/Osa4glrjr+AupqHz1sEs0cxG0BC9HIePLoit9eNkVf9L+DuUWByDJgaq4ybGYLPAWgiXmLedUE7dwC7saL7CqfPKXi4NYdaykCD410bAHlDEsNiwZ9wAPYbkJcfz6T2gm3N8YDZ9d/wHxUA+739fPwXPrSKYGb+BuP3jAFDElFH9HIWwbzCIGkBr/or4J4RYO8oMOW6ZVcAuvi1Cgoha04BCwT5gfMKHm7NoRde2+x41w5A3hQZkADk5+cGiAeMx3+/7AENFA8Yrv/G71cAXFM4Yzj+otOAaQLQA0gZxaIIZtMDFTigKJV8H9Iq6aZ59ZXAvSPAvpEKgBTtBODcSCWCZeRYtpzrmLyeGNCAyFl1v+Hei8qeb370Rdc2O97BAMi7EgB/2QG41nhAHU9LuWAbOB7Qr//GPRUA13r7Gv9FZwIMoVcEswEwfDoimEP0shKKtIphaZQAXv1+YM+wA3DEdcvRKkGJADQQEsQuhi1Tjt95vBsh5nx2IO59SsHDrTmUOStNjndwAAqEry0IyCMICkOyiuIBNwBvPFQQT7gBuPjc9oRYAIHyOEL4vIFEYVNaOou5vCGE/tV/A0wOVcnpzI47NOri3QFIBpSeaSDUdYLOSWvYImSGgftpJDa4MWJbAGxivGUA5MAOc0Be6eVLj7/4Mk+hzCOYPYpZDBiNkLh+G/M3yFyv/ltgL3W3YQfgcFUhgRY2PwY+Z7/EhAR1SFyXCOb57r28QfQBsJQBMn5D4y0HYLPje9Cd7RIC0PM3EiMofF4gVCBp1P840ix/gyz56r+vAMjk9Gl375iB4+CzveuZdLkkEPJ8ZEfX/6R73vOjzT5Si9hucLxHAVg4PwJgRwh9CKOXK8YA4ZEqKZXSQWh5P+5AftXfA/uGKvYjCKn72cctbFrZNECka5L5CPwIPtMH3TVz17MLB5gdLgA2Nd6jACycHwLQxFEUSR5ASvARDB0h9AQb9bXIgCGk6lUfAPYTgEPAITKgg1BObk58srTJgG58WMkWMaAbQQT1nc8rHGANAJsc71EAFs4PAagQestgC1lsBJ4BMCSOK6dDUcwqqaFiQr/0QeAAAdjy+jBiQQeeMSBZT3nCPUDIa9z+/MIB1gCwyfEeBWDh/BCAeQSzgkjFfGLBBD5nxQ4DxN0wv3hVxX5TBGDwL5obxvVA5YqYL5BeMLd66YYxJpRB0gK+96LCAdYAsMnxHgVg4fwIgMrhUPKQ2C+Bz0PmBTqBMQehAbDlIjj4F80KJguSVZ0FuXpjoCOgXawLjALhbT9eOMAuAGxqvEcBWDg/l1IE05Ed0ygZnyHdz0VwCqEPIfNyx0QQvvLDFQCp+8nfZk5und8tXwIgWcHSNX0N2CJmnAl3v6RwgNnhl17T7HiPArBwfghAS7mV/hey2JS9FvM3BLpUUi1YwDRMXvkRYJoAlAh2l0dcZ04s6JUTDIjyBcrl4yDc/dLCAdYAsMnxHgVg4fxwKVwJgGEJNmWtxpQMpX9on2eRhVA+O56AjMfnP+e3Xvf3NwG4xIPTleiY55bpGh6UbafNU0l0z0p+5Jh5HqYJ6b51nP6XP8cx12XNHQVgIQB/bFPVg2OC7Q+WgVFWng/FvtWLI06uWh5oguKEcXVS/9sEAF//VGD7t4ETDgJbF4CNi8CGZWBs2fPL/H6Vwp2KEtVk4fJ+v/EIYPN9wKa5qu+IncfPwXHVZe/aOL3EbwS7xv8A1rQvnO0j8PArTgTGZ4BxFv9mIxhOCGsv+0OPYDRghcLfkWkEuq0+G00x4OtfDGz+d2DbHmDLjL8si8AYP/7CGIAiEEMTG92zXqSbH+d9R2aA0XnvO+JjthiIrOVDHHPOkBrzUQAWAPsZp3oPDpa/Xag6EVkLBK+5rAnJC3/nYk/APD704WiEAV8OTHwX2LQH2DgFbJgFNrBhjd8r79deGoEwsllgNBOzy8CdjweG9wBj08AIAci2D6HafmyAk4/Z7SJ72hGYRwFYAMDLTwOGp4FRFgD3HhzqRGQiyeurqOdG6r0Rm8IEZjzRlkiqCWoEgK8Axm4BJu4HJhyAbFhDxmbDGnZO4j0SgLGDkpibgEq66TJw/1nA0F5gdLpq+zDqFfd5LMeWqu5HNST0uJOIllg+qgMWgI+HPv0xwLA3gWHpW2sC441gCECbmKziaGrnUdMO4aHeh6MxAP4SMHI7ML4HGD8AjHvHJGNAgpDgY/ck3stipRemvVhc+uASMPUEYGh/9dIRgGx8Y+MNbR/00uVtH0wEx94j/v0oAxaA8Ed+GBieAYZZg5kADC0QWGOFzGJlcGPzl1BxNLXD8sk4xftwNAbA/wwM3wGMUmxOOQBnHXzetIYvibonmSiuYTNjriVg7glAiwBk0fNZH6+PmX9P6kfNmCXGpftJ7TgKwBIAnln14BAAYxMYm5C6RjCyCoOyr0qkD/c+HI0B8DXA8N3AyCQwesD1VQKH7EcASm1Q+y4CkN9pUKiVF5nLvy+fBbTUd8QBaH1HvNBROiZvfsNnrF4kcvPwpdsBLBeU18Nf7AB23Dp4ecHC8oBgUlJJecLS+7+WOpE3gbE+HKw+yoevCYkMGKqPJrdEKARutaFYRs1fiEZ0wP8CDN8LDO8FRqYq3W10pgKgfYLaYCzootgA6KXaTA90y374TKB1sBozy77xHFZ536utRgAmEaw6g5kUSFZwSXnA330qsOlfgHMPDlZesLA8IOjoLypPWHj/11EnCiVwkz7kAExtsGraYUWdSDX5TmsagL8KDBGA7Bd30JsW0oWivnEOQNP7yGTSBR101AlZSUtGyfgZDkCWY1HnJdcBVe6325hTvelg2CQjZNDygG/2An0j1wKnL6y9vGBheUC8prQ8YeH9X39OVQSc7Mc6fCaKvAeHdCIVf4yMYCynTpX+nb97NJmlSQb8r8DQHm9YOFUZTKOzoXGhs6AxF0HIexcLBvWBuiHN8s2ne98R3qc6L4Vyb2oBVjfm9MIFHbjDCh6kPOBbQoG+oW8CO5bWVl6wsDwgfr20PGHh/X/1iaEIuDcCTIW/1Q4rFv8OnYiW3c+W2iKwUjKbyjQNwL1uuR6sAEgDgq1brXOmV81PxhNB6DUDBSYzQJwFtz623XcktX1Q1VWKaTF/zZhVazBVYA1tX5MazsGvobwe/jQr0Ne6BTh5uf/ygoXlAfG60vKEhff/rSe1i4DnTWDUACY1guFTDqLYdCBvf6DJYSMYATBfOx1kLfj1v1axH10nQ3Sd0GUkBnTfpemtBJgseIKQAHLQcVxa2TnuMW0Aqui5es8xBIegVdVVE8VhzHnLh65WMB9An+X18K6aAn2tO4ETl6vqbKuVFywsDwhevqg8YeH93/Rk70JE90nowxZbIJjvS3WYNSGUwGHJTpPxwwcbBuBrgRYBeKACn7VtpdUu/c0NJxO9BIxcKu4TTODzbkonPLoaL0vyUQRb2y8HsL1ckfWzMeuFi40Qezqi+yiPhyt7FOjr6/gCFwgP7Xb5vssTFt7/nQRg6MGRWmDRoeyTlpgw68GRTwgZgo1gGmXAX6/8dtaylSKY/koyID9BhzML3q1gAos2AcOrZYSoq/pJp1VtODRm9Z3LS/7WjVkvXOzEtOpKyGrlAT+4SoG+VY8vBGCvy/dVnrDw/vee65NBJiAjBIVcAJQjOm+DkCZEeiGAMw6sAwDZsJrAdhFM9rPGhd4904Co5oVuCZPV6kD40Ec6+9W8dBTBsfdc3nkpvnB82fp2RPcs79dHgb51LA9ofsDV6vut5/3PnxcAmLVBiDqgevDaJLkYrpuQxzcNwN8AWgIgRbB8loEBzXDwl4cGiDGft58SCOWGedgjvOJ+bPvgRkiuA+ZjzhnQQOiFNVbloa7l/fos0LdO5QENgEXlCfs8Qbf7HyMA3QVjYihYhLENgjX9y/qwxQmRU/asfd0ZcLU2CHVGyusJQLKfVi98CS12T5f7iECkHpsMkAhCF8+nshWH2I/jXsOYO144GV/9ApAIrS3vt4YCfetQHtAA2G+/4PW4/2PPbzMgmUMi2NoeSCRxIt2/FvuxWURIWCXg357gfTjEDNIHnTRXRCpH5ugKwGl3HpMBXQc0v6WLYVm/5limj04rG762K2uYY9jBkr9+rI03NL5ZbczS/dJ+LQyoga4o77fGAn0NlwdMAOy3vl/T938KAcj121z8Bn+Y9eWQJRz8Y6kNagDh2ey5EvxjxQD8TWdAuneCCO4An1vw5vdzQMmdktwq7pLZQR+dM34+ZumAxvY1Y04uqOAJ6FsExzeto7zfAAX6GiwPaLWR1lrfr8n7f/Rl3QGzmsis+/uO71V9OFgP2gpPhgr7TGRqRUT6dyvr4aIs/pm/2zVUNbBSv6G8e5pEv0Cvec7Po7+bTtjlBRlkvAMBkDeQyvsNWKCvofKACYBrre/X1P0/oWEAnnFD1YdjhtXxR73mX10FfCHHE9pVWcGAI/S0gKsfA2y+twrFZw6Hxf/F0Pk8Ri/kpGSnMuDx5T0iACgQHioo0NdAecBUHW6QdsV2/cL7v/Cyqr5gnc42CCOcfX1VIZ/V8We9IDmTzVXwPDJiXuKXPxtDBma8+lzP4WAgKkPxCUAPE4v5GzEuMX0PYJPLhB6FJsc7MAMmkVxaYC/K9gG+F1++8AQ7Gwbgk78I7GFpXgIwFiRXOwaJZPUbiR0yCUDRk+cHf+YpwMj9HgfI8ClGPyvsSiH0WSKRuYlitLb/zHM/JOSs5C/YIC9cMQDZr/dwxgOW9gtGYUBi0wA8l304vDQvAchilFbpIBQhZ7Ejq6ZQ0/Yhil8y4j89Axie9DAsD6FX9HOK3QtROTFkviN83kG4felIY8DCeLrSeMDSfsEovAECUFsTjHD+tcB+tkFgcXKvBRir7qtFl9owmO4Xy/1G3bAFfPrZHorFNWBFwHjQAFctIghj2kBarw06If/+MM9ZqTN6DgsDojCerjQesLRfMApvoGkAWh8Ob/tgAPSKWCp8ngNQtadjmTdltvNvn3peFYhgQQgh+iUmEaUAUoXM1yRLmWuFLaE9Z+XIAWBhPF1pPGBpv2AU3kDTALzwmqo6qtVh9kJErAudABia38TC5wJgS2xIhAwBn3yhByL4EhzXfRXxYsDTJ4IvrNN2JFMxZcBzVo4cABbG05XGA5b2C0bhDTQNQLZBYH1AVsQSAAU+imI1obHyblnjG/kJk3U8BHz8xVUQAhnQIl5CyNgKAGp5LKSSCoAySh5Jj79vTagcxUaIBeRNe79g9gq+DXig4wGzy+PONfT7RWFA4noAkGXZVAhcBckJQgNgrLiaNb3paIDo1vHHX+oA9LQBi4DxJcOUPJUnTgU2NJUyROs8irGARxQAC+PpCtsFd40H/AEf0gMQkLgeACT41PiGoLOKqyrJq3K/Ya9mNyr5FusN/uPLPIeDa8Bc+w3rtyl4VFHaMZc3i9RWBM9jjzgAFsbTFbYLRmm/YBTeQNMAtD4cBKDXBTQGdAB2MGBo8SCLmEuS1AFVAJ3A/NhPt0PoCcA8bSDG76XI7aySg6JYuGfKwJHFgH0E5B3ueMCe/Y4L+xVHAOZ+9EHcEgQgwbeiEYx6jwTdz4qfu7EhEJqxGqruf/RnHIAEnxgwBM0aC8aUAYWNBRCmoIll4HTqO122QcZbrgMWxtMVtgvuOx6wa7/jwhtoGoDWh4MBJ16WN4lfr8AqI0TVV1O1fa9BbQzovkAy4Ed+NgCQUSxZCFWvCOaOFREXyUwZOPIA2GdA3uGOB6wPaOz+QPv5S+MA3OXiN9aclghW+d3IgupBF2pPqxcxGenDPxfSRh2ASiKKiVP2PaZScvAKoA0VDc6cOlIB2GdA3uGOB1zR77iwX/F6AFB9ONSOQW0frA50sILVcckWJyIDSgwPAVcJgFbYuZ3FJvAlEHbJ3IsgJLGedeBIA+AAAXmHOx6wo99xYb/i9QKg2iAIfDJEJHqj4SExbEty0gkdhB/6P9oZbBZIGiKYVb9GKaN50lRHBLOvhDxh/5EKwDUG5B3ueMB2QGM/grb7/6wHAPNGMAY+GSGUjC52VX2f2CD4+HO0gqkZfegXKgBaHkcWtS0AWii9xG1ImrLlN5XR8L8fmQD05BVrmEENmpYSP9QX+KHiqj2/82+HqqDWwnbBRfGATdzAegGwru2DpRq7Mzq2fpAf0Nq0Rl2wBXzglZ4yUAPAmDSVWDBPHQjLcgTqOZ6zUvdKHh4ruDCerox/Dnu7YqwXAC1NI/QcEQuK6WK/kdgCTGC0PYAP/KIDMBgglq+hIkrOfsaCviLSofcJgJ5AdM7kkSaCj/HqQKVIGvD4swF8bcBjmzjsaQ2H5D/6acBd9wALB4DFWWB5AVherMp4GKIYEOp7+26UF0aSfT/xYuDG7wDjrIpAERytXf2vajj7ueryQXSFl10K/ON3gIWDwCLvjfGB8Z54O+Ee4ve6513uB2R1yzsqC+twbC8HcNVhfAeaBuDP/TvwtS3A/ePAIfYFVlPq2HHTuyulZCTlhbjhETF5yxTQGgPGhoHhIWC4VSXGD3n0tLkMHXHxu+YyB+MlPwDuZs5K6FlsbCzdVO9DuKfkHM8AEkP7B8fOkwDcD+B7np42+JkGOvKdAL4E4K8P0zvQdET0b14D3DgB3D0B7B8HZka9WzrD88N6sFm+YcUjrn7E1ZDvMtF9DBgeAYaHgSGB0PNHCD4BLwLRsByAyX/ij0/dDUxuqlIG5hix7eFhvLcOVUAtyPSydAFmOQNe6EYGV/9ZESiKgIEgtbaD/gHALQC4ovY5r5KwtjOU/XfTAHzzLuCmIeDuMWDvKHBwpMoN0WQzNtAaYSs0K4ZlOSAjGG9kPjCBRwZ0ABKEBJexYAZEAU3A7Oi1BeDym4EDnjQ1TwCGWMW8MXcKks0YOyZNlQOQjcgYIUHllEzYQ0ktm+r6oz8G4F4AXwXwRd8/kO9A0wB8y65KmPxgGJgcqYJTKYpTv2CCzyddQJRDOjKivn+Deh8BF8BnwBtaCUA+YYEyAU8h+c6Az9gNHHRmrgOgmDA3jHQ+iWupCeUAvNSrA9HNwqx+muk9nJVNg/CTfrmbAPwbgK8D+PcHkIibjob5o13A3XypWsAkG1cPA9PDFQDZM1id0i1KxsWfOrKnAFXlifCFFMMRcASigOcs2MGAIfE9iWXplS6On7UbmPaUUTXQrgsVMzcRj5Folg2V5ayUA5BWYKwOxKUafnosWjcJwk+7W5F2EKvlE3xcXaNYfiCYsGkA/smuqug6hcleAnAImPbO6YwRpMgjCAVAm/yQmKTv5hNsAf/i7SyNBSl2a8Qv/4/M1yF+BZSYlNQCnnVrpbC+mToAACAASURBVJcaI7sOSEY2NpaDXLqpR+vE/OVksDgImgGgghHoYJbTWc7oJtFWc65/cg2AYvh2ALsB3AzgVv95nS/f4QdsIkT9T3cBrGtITWZfC5hqtQHInsEGQn3UDDvEDEY/ICf7SxMOrAg8T+c00JGkvHGd2DABUYZIAONzCUDppCFhSukCBsLQrFtZe/IixYQpSyEoJoqnuPWrVRAubQh83HNlZB23z7j1ywmj6CIIqUPxw2Xeu9bx2jx10wz4Z7sqTYZaDD8EIDuoE3hMVEphWg66JIp90k0sBxBcy+iPIIaT1RtEsHS/yIAqw+VSNPWQfe5tlVEk8auXgVa5BUsEJuT5uoliAbE5AGotmIAjCPnR9xDG3TQernYAUupTdBGEFMf83OkApHG+XlvTAPwfuyrgSZOhas3u6cwTsUBVn2gTwyFMi8wjHZAA1M9fYGHDULJD1m8Cpa8fRxDad+l+Ykf/3XNvd11U+qiL39SxXevSsshdDFvgbI1O2AwAtRZMZzTBRuDFjxe1Xg8QEIB8yyj5yYIUxfQIkfkIRnmHCM712JoG4FsdgHHp3ACoMH2G6jM4lWzoQarSvwQ6MSB/vporVaFkh+mCLlpVR8Z+dqDZLoDOpHSiQeAFDkBjPrlgCHgCUaFifg67H/9uYjn4Ai1vpTERTAASBaoQJBAKeNqHlL6mwPDZYAOROag/EYRkPX34MwHIvzW9rQcA+TLpI22G7EcQKlJGsYIJhC6ClUMiXfBTbFUQAej6nPS/OuAl9pOOqIc2BLzg++3VmWgIEUz82cRuCAtLIHQQm0gO52uOAb22sC3JEWgRfPpZf2sQBQIgLydPEIFGwPEj8MlF2bSbsulghLftqsCXq9HGgHysznrGgi5qzTUTFH8FLhAUn3hIJwCN0HLncw37qaF2zoYvuKNivmQIuUNc7GvWt6sHNs26twA6vhyq8NEMAHlyntFrDCcQehyaPTl+FwAbXDcmAKMRThakEk8Q8kPg8SPL0qzLBl+A9QCgR6uZGs3vfHz8TtBZvkgGQrEPBVAUg2Sij50QAOjiVKI3saADJRm7dSLYWfSFDkCem/dhZeMy9pPY5QvSDYQyUJoDIK8qMezh3wY6fSL49PcGgCAA8pScJLIgAUYQEmz8RPA17StvGoBv39W24eREiBoNQSgWNI1HBkdgxJSw1AI+dFIbgOYmkjimQ1r6XXC3rAbCHycAgytohf8vsB/r2KRaRq7zpZ+D37HMX0s3DDcCUGLYaw53MJ4YUODzusqlGCQAOQCejuxA8UULUkxIwAmMAp8Wa3qkN/R9W+sBwOhIEPjk5SLr8HeKFbTQfb77csPIMHGl/4MPbReslPhNe4+MiTpi9AFGV4nI7MfvagNQLh/pfrYnDAS8aJQ42A2w4em2cAyWQUuJVQTGWLs1uL7DG9J1RjhA+jvYk4t3KXeMqijpzrud4At9z3XtP16yGfjKZmCGooYh1tZzvv8xXPFl4PoJYC97k9FlwZWD+Azi/deMZWeP13eQCGEyoERudChIjbb3mJYwH7V0QIKuCwj/gfMj0asn2I0FXRSHXfL/iRkNgLyeVj8ccMY//J1fyxzTAXT2+xoQViKYD/1hDqLxPiYxTgSvQrphphG97tz4Slqafnj7uk1kIQDZrvWTw8B3jwEW+RLxPgSiCERdPwPR7+wCPg/gulFgfruDkOMQkFc5x84e708JAMmCuRNBXi4TIg5CGRzGiBGE/D4E/C2r2vcAYJoify62i0aJSMhB+2IHoNwu0fkcjQ85pu3ack5nIBREqneYFyWLkAXIJHESe00Cyx5QyeL6F/tyEcDcrOW2n7fX8df0mME+/vQ/PQjhoy3gzo3AISYf80MQaQx1peH9wb7v2mrtmCBkIMMejp3jIJD1MsaxaMZ8v5N/67INAsB3BAYU4JL4DSo1J15AFPAEwuQHZJzkKfUAtOHLJSOQRWndBYQvCQA01cfnNopfsaCJaD2baBn79QjSTiOEP1EcawIpkq2kegBTNgHWEpOKF8Uwq2NRFPM4AqCf46/rA2U9/uVDvurB01zvAJpiiwOl3fEeciCGF+Ij11f+QkbSfMPfIzqw57mEFZ9Dl3Ps5HXWAYByHJAJKV7N+s0cCQQhwSlfm4lGZ0KB8C/rABgZUS6ZHITBSEhCowUYAAksF7cStWREyxRwtuPpOlgw+5s9sq6OaIJIIlUgEhA1edoTgHxa9HVw5jibZNF+j/9yGQA/7pbujZ4bwv2+cWB6tFo0NzYnkxFA+cvEAo43VBoEo2e+48EMXEOmD9F6xhCE8RwZEJ80VblKvDlmzwicfqy93/o+8K8TwB2jVSgW138FrJQTXBNlnJgmrjZwanow9CBP/rL9wF0jwAGWDtFyoN9PHutnIHT05mPXz93dMGQAPniJsjiBXiTbxDZFMF9NLUPQxKR5qezz1Y6/YZDH0D6GkdAkYJIvRalAdHAMmPZoYhb6NhDWvEyf/ma737CXN7R1ZC7hUbPgcFgqt/ZZjADnM1xqEVhYBpb4CUk5UsL7jQvj///5buDrLeCOEeD+YQchYwG9VIfyg1NaZszFiCH6DkRGLze5/dgk8IMWcMCjdCiCzR8od1B8OTwvJM8JEShFut1fzMhi+eRJr6LI7hYP2M/xVLwKNoZjUTwRMAQQmYyhWGQxsSADOflZ4kukj7PhZ75bETjBpkAGahMkcrGgwhsXeCyBHBj1wmOBQwvAwqKzoFeRV8ZaerjKYAuirmPY/o9X7q5Cyr7fAvYMAftCPGAEoYlBiVtFwLjtp2U4irj7yOANbi+crHyrfCbTquJV44O0F1FrwQGIMZFqdQDyP/gGSZ8TC0ZRRsOlVzzgasd/u+zpMByLehAfCgMQCDyGZJHFCCgLZ2f8mgI5qauEcVx9e5vACTgCTwEMWr5TdIpWKJb5MvrnoocDswvAPAG4VLGg6UKeqmi4iuDz4er30oX0FP7u5moMvIf7W8B+jwlUNAzFnlZCIhvGFRCeWzrgXSSIBreXTFZSgVLHAp4UHOFuociEEsn2PJwl/XEk0dzfSojeerFg1IOo5BKAveIBex1P67lgUzgWQaJwLAKRH04i14ItgDKEtGsRnWx49b2Vkk9wUefTGrKCF7R0JxZMqxN8cmPAxWcAcxGABKEAKPA5u9lEaAbCmKMI+sDN1X3z+ro24wEZFc0VEE64ABgT180PF9ZdBcDb6JpqcPtPk+1ACbmKjJnllwyuILunEAWjZHkBsrsRUnfD0qEiC5IJfyisgMhzWhcP2O14Ro4WbASgAMQJ48SJwchmBCDFa8qpyBbSP7OvU4PQ0p2W7+LSnSJUFOrI4V7w5IoBTQQTfJ6oTSYk2mQcpGRyH2syGjIF6EM3V/fM++C1CfwUExhCsmzCaQT43lZC3e1hBpEHh36XEqrB7Scmq5dV0XZxmV8WuDFzAF9iwhow9seAGoBcGtKjqAc+1l9rLb/1igesO55ysmCrC8ei6IxRMAKTWNBi6Xw98xNTFUi0jEcmpYgRAPhddpVi9OIEPP5cYD4CcLkCooHPwaW9kV+iwWrQHT8uA1fd3F7DFvgUHUP2k8jTiogAqLoxFpDgbMj9jXSuN7i9dLIdaxzBp5XVBMIMgFEnFAPKT9qPd6A9BIGI7MfPmf4U+40HzI8nWgq2PBxL4FEkjKJixGRRFyQQPzzd1iAUzCAQas1YOmAEoFjwkecDC/PAwhKw6CxIkCXwOdVJLxTobMjBdyIgfvimNvNJ7Evf4jWtdnRYD1YNGVuG93VWuWs4Jf+mlZCCZxwP/cnJ6mXVKk2+tK8lQQVHRTGc64SDAZB3Ey3JcxyACkToJx4wHl+YwqloGDICmYmTFgMQFBET8yyYzyAG/AfWX8mCGQg0BTRoHwt9KVaPE/HQ890AIfgWK+CRAaMRYnVdxHbhdY8Wslw1V93UDsmPIj9GxgiAioRRMIJNvoti+SW/Ikd0gwAU8+XxJcbGITJPDvI6XdCFREFSknTB83xka40H1PGF9dnycCxFwygkK0bASJQSVAbAYeD98xUAe5U3jKIwBosSgNsuABYogl3/IwgFPrOIg1Xc4ZrpAsSrvruykl2ucykapkMMh4CExD5DwJfWAYAxwk4MKPAJgOIjGSEGwuCakRhemw6Yv0UUwRf7L00L9pnsNx6Qx4feY4O8pDEcixOjsoTKKpMYjSFYYjOC8Eq3Wnnr0YYS+0Tmi2HysrPGLqwASNYzBnT2Mz2QD91laxLB0gs12GAh81cf/o/OcHyJ+qj0S/zxnhUZbSyYWaL8+Rq2S29wowiWkJPan4MvgrDDGAlRe7KIywDIgR3meEDWg9HbJgApNTkXo8o0i7oVgxnEgFr8F7jEdnU5GvqfJQKQKyEOPlsNIQvyvupAGHS/Okv4qv9oh+PHxMLk8ggBCRxvAmEN+AiEzz2iQfQBeNmkh4K52hJBKOaNe/FSLobLRXCz43rQnu2yi9oMSMDxs2jo8303ERz1wsCGZECF4kd3DwEYYwJjhoNlQrgIjlYodbBPrwMAZfEmyzcIv27gs6XDzC/IR1DOgA9a6DRz4wZAsZ+LYXvQYsHoD4ziOFklna6YD3+nnU6dZ7bGDAcBUImIAmEUw/zbJ1i/scGNDJiLXmle3RhQ+l/aq57gUQCWzwwBKPeLsZ/LFrGg/ShRXAe64Ajkv30kALAjF8R11Dy3K7KRwJcsUTaqWScARou3w/INVnCH+A36n8RvM3nB5XP4oD6DATBYwGb5ajlOLOh6X8JaBKRG77+7ygGYp1bn+V25/01AzBnwQ1ypanD7KWfA1QDYC3zJIj7KgOUzc9nFbetX/r+O5biwNhyX5uSEDr5o0xsJwLp8/m4A7GaJUv/j3/5+HQFYJ3oFPPkho/hNeqBcMkcB2BAA6XrxmMBkfFAci/m0JpwzXw0TXvXtzrz+PKc/Ml/ugzM9MDqCAbz/keVjjGcQA/YLvjoguo1mRslRI6RwfsiA5nqhL5D6nscF8gfTdfxpS+/hLzvWfzMQCoB1Fq/8b3VWaPIDZqsRV64DALsZHVHs1gEvsqFAeBSApQC8pHK90Oql4UEAyvCwNeGcBXNLOPMLftgZsI75ouUr9ousp2TEyIJ/sU4AzC1e+WIFshyAHPZREVwItrrD3wGAhibTYBhxVpe/xePyrNBuWaoNp3DgFwC81O+RAepK/a5Lfe51jxr7JwA83nPXYgq1asl0yX5N48+f4VEGLATlK1vAo5YB1gBSRmsM+NFE57lcfPD5pPFWCJImtyvGgGfOAacBYO59zFglgHgPefZsXV6/gPXBYeC0RVgyJNOGYuJjPka9eHWgjL9bWzhWk0/n/wPn+k8bgFNmgYcsVflZnBRmIShtJM/m7JGibGBoOIIez9wKPP4AcNpylfbNlGfdI+9NjBjz8JVzppckZuJ+dBw4aQ44drk6j1LIY9JkPD7P4s2lwVEGLHwJnncscNIh4Nh5YMsSsHm5ndOu1BGFThJ8/K6JrZtoslST2+XHA6ftB05ZAE5crgAups5TfaL6EF+UyIif3gAcOwtsXep82eIYY9JkXpMgMp/AeZQBC2b8OduBYw8C2+aALQvARgJwGZhY7swEzbNa88IRvAVO1qkF91J36DNOBE7eD2yfB45fqphLnevzdGeBKBfL8UX5/CZgyyyweRHYsFwxYHzRNK6oetSBMDLjUQAWTPqPngpsnQK2zgKbCMAlYMMSME4ALrcnR6JYQIwsoUnjpDRstOLy7cBJB4CHUGwuAtuW2nUDVH1EFUhycSwWjGD64mZg0xywcaECoI0z5P3X5P6nWlHdgHgUgAUAfOYOYMtBYNMssHEe2LgITBCADkIzSJZXpCOnIg25uPrhgnupO/TyhwLHHwSOmwW2LVSik2pCrDsQskzNIBGIpBdGI+VfNgMb5oENCxX4yPRjPj4xaJ0+WGeEHRXBDUz2Mx4FbDoIbJypADixUAFwzAFI8KUJChMV2SUaAGc1cE/xFJef3FYRti64nkqWDrqqEhbrsm5zvZCdPCd8nHzJOLZuABRz9hTHZwPL7LnLnoNMIY2VyaKcjtZLHOAbNgNPngKe4BacfGF1pnydD+hphQ/8XV5UiEueLGnDN1tWXj/3/4cTwAUzwGPcRcFJiDpPt3FLmf5vjwE2HAQ2zPrEzDv7OQg5OSM+ScYQy5Xbo8465u/ZfLTJ7fKHAdumKxVh8wKwealSE6inEoSy2MWCdbUHIghv3AqMzwHji9VLZuDzD8cXxxWZs5c7apmW0fMBnIHKn5X7d6I5npvRz94O7LgXuGIReJSb+Xl1tzqflybwRwqf9i97BQRWomWJQ7oZVFtJoqDX/b/oGODsvcBTATB9gsfGqmzdjtVz+G+PAyamgYmZCoDjFE2anCVg1CeJwOMnTRB/DmUINVkkgia3y08BtkwDW+YqAFJFMD1VAAw6XG61R31O9/fdrcDYPDDmY0zjc1UjivBuAMx1QdMB+WAYXU8dhEU16dOSkppbcHFSrng8MHwnsGMPcN5ypURHp2xMIa7zDz2z8Gn/kVe0YomO0wEwBYKujL7v/zHA6C3AxfOVh58g5AsZxx4fZM7sf3h6BcDxWWeGBZ+cMEFiwGEHHRnDzun7ONHs/djkRgBunql0VDOSHIDU3cxSD4aEajhFXS4H4S1bgVGN0V8we7E0Fh9jVDG6Obr1LJMRwn+kOCaTEYT0dsfqZHXl/p7PrLi9wIY7gO0H2yAgCAWCWCowKrYE8nMLn/a7PQn9X7zIJPPkCcK+758y7x7guNsB6l98gZjLLYet3Ay5n0sv4R+fCYxPA2MOwLEAQLIDPyP8uBg2cRYmzFweAYilKkn+OC8/Fdh0CNhEA4nGA40kd6FES13WLO8v1qHKAfh9B+DoYjU2Ak/js/8NAIwg7OUb7LCC+WAfB4CpBJoIiTRNRmS1l13kqWh3Adv2A8cdqqp1MB+aIOSxWv6pq5D2kkIAvt8rF7BLJksN/jMqfa7v+7/Ak4B3A6ceqpasKMq5akAmlLWY37t8ZW97PDB2qALg2BxgAFwANEGcnI5JcrDZRPlkaXL4u1KJUAfAjbTQ59x6dSvdLPXAgGYshZWR6JIRaXB/NwFI8C1WwLMXzMeSwLfcXuKrA2G+wrLCDcN/IIg4ERRn0qvyySAQX6mG1XuA4fuAbTOVwktRRr2MLCoQyvEZ/UY/WwjAj3jtFJZkU79g1ghkgEBf98+0Umb/3A2M3lkBl/fOcdMok2EjkZyv8773LAfgHDDKjwNwxEUw9yailpwdxBAEYhBbAuGzG3aKkQEJwAkCkOCjlb7Y6SYyf2UwlAS+vKYnAXjfNmDEX7DEfA5CjUcsnzvbu1nDtUMmCDkRZEEyGdlAk6G6lQTSa6m0MP6HuY73AxNTlcJLZ6WOJYC5/CNxLpHMgdKIKNl69Qvu6/75AjHOiTU87gKOOViJb748BKCWrnK/maTA+58AjM0Ao7PA6Lx/xBAupoYDC9okBRAmPdBZ47lNA/DhwMRsxX7mPgl+SrmK5EaRNRslXFQ9CKB9DkADn79cZtkHFkysJ103eBbqlh97DpmTQTYgk9VNxu+xYbXKU3lhFoJPOgdFGY+lPkgQxokkgF9Xgj4AvfoFs84eX4Ke9x9fIC+tRfDxvvniif358sSir2LCj5wNjBKAc8CIi2AxxLCzIAGY9L7AhGIKgpATw4l8wToB0JjPrfTkp+SLQbHrOqm5jNyajS6VCMIpApDAWwQ4LrGgXqzIfnq5cv0vN0ZXHTInME5GBNLb1DGdOYQsI7AfGKFjlgqve8wJwG4T+fuFAFytXzCLb+VgWnH/fIGYfc46Hs7iHC8ZkPcdXx4VfVXJw8+cA4wIgM6AHSLKWZCTESfLfg7WsIyRF3ckiRQ+HACXkwHptyP4KHrpJvKVGnOhRF9eBF9wE0mUEogz2wC+WGI/vVxiQQIxAs9+rmHA6E1YFYB8DJwQMZl0OrLZ++i7sfT8zroYHLS9df4RACWKxSZvLXzG/fQLZqk2gqn2/vUCUQ9UZaM9wDaPeSPrC4A5C1KV+NITKwCS/SiCR/jRBDlLmP7nHynsxno1IPwJSyRpbiMADXzuPDYfZfBTEoAmcuVQdiaW0zwXwQsCYDYmMaDA1wG8TBSvaoR0G77EcGSET6hjOvVApfRPAUN0zjr45JzVcSqiTxD+VeGzXku/4Nr7JwDJOkxFIwt6j6+RqUrlkO4bXzp1gCAAv04AzgLDDsBhKugLFUvQUhTwCEKbnKCw14HwJ9cDgGQ9WegRgDI8XEcVEDvAl7lVlglAgi+I4CR+Zf1mLGgMmDFhBGFfDCicRJFERviSABjLS7FC0MFKMU+07wOPE0kGvaoQgGvtF9z1/iODkwn3VWoEXxres5ib9xx1wZufBAwLgAQexbAD0JiQwJOuJBA68/H3Zhk6+3CifqqwWNMKN8wjKgbk6gWJgC+FMaBb5vJVmsUbV2vCqo3cRWZcCIACoax53+ulkqNd7iqOcU1WcC9cxEm5kQBUdZ+sTnSL/jEtTWngi21jhJNJBivZBukXvOL+yYBkcOqxKjJ4AGgxzMrBVwdAMmHrZOAYF2l6y/mwV6xD17zmWo6MbRyeWtOHwxJ91IIhr6rqZS70DPPLXDVUrfBwzHKr1EUp6/h0T/6L/GcCqslt4IhoTcwdAqDSs7I60WQH6R329pHuFyuXDJmEjuOSbdB+wSvuP5bGUjmsA5XoUvcvBXKKAQnApUdXwah0b8jXR2YzJTsC0ZHB33FL+2yiX3h/1YeD1fFZGT81g/H6yqkVa9YEpqMhTADle8erHA6t7Mh6j4ZBXdBGjFyO4CSIm9wGBiBvgqxwIAJQlXIyEJLyI/i0SkAG/FbhaEr6BXfcv+5dLKhCg4z1C1HEBJ8+BODQGZXfk/quAZC6ketAZEQCTWAU8PIJt0fgwHzZvVWNaKqi7JLOmtDWFy42g1FxH/XfqGkII0C+a0tnDkfsGxQjn3VPsk7tXmuy+Xp0JhtoJosAaFcUAJUYKiYJxcqHqKAH9rPlG2cMrmCUbMX9guMLpGTcCMKDlZGhMK8IPnPIn1X5PA2AwegwEEYmDGBMjOI5whGQP3NPBT7VJlRNaKvF4t2IWHbDErtDlSk1p4lJ7/zd246tglGZryIfrFhQ7pU8WCAX0ZENG+57U14Z4YrCeLrSxXdev6TfLwrbxT7znMrfKQXfHLQCnyvmRIv0Q3430ezMmL98P393G3wqz6am1NYzzoGn+svqRmTAU2citctqAX/2EI8F9ACEmLHXLZGoFxtSl2xyK2bAYwrj6Xr12+1noL/jUTCD9vvFrn6u0v1/nvGkaoVBAQi0eummMAuXQHMWJAA7gCixG8U0gFfcXdlBKk4Z6zELgAJfZEKrxpC1xOIl/+Sk7jkcdYlSco90y9+gK6vJrRiADD0piad7RuFo3udNCgft94vCdrGXn+tujgV3QAcHLcFnroelivHkchEL8ue0uQ74S3eubAITS3IQhKkMRjBMokgWG3L//2z3VSnP4VDgQWxUEEUxAZFHL0eR3HDfm3IRbDHkBfF0zy4EIKNhSvr9goGEBdvTz/MIYQLQdVsTwRTFDj5jQmdArRDYJQNDSs961R3tPhx5NXoVgoxleHnarjohgLec3D2HI492yQNvIwvqO9fJm9zKGbAwnu6FhaP5pFuMg/b7tTbpBdvTz68cz/zI8azVj8iAHTqgmFHXDUB89R2dtaC7tUGw4kDOgFb0R2wYRDGZ8g9O8aU4XwPOczhiwGlMjqqLWiFYGu570wADFsbTvaxg8nkow7E8nM/atfKzln6/1mS4YHv6BQ4+Z0BbqHcd0NwwYbVD3+1yWhXJxPBrbq8AqE/XApSqAxiBV2MZ/54DMOZwKE00rnDUWcR5KiV/brjtSAMALIyn+/mCyeehjIYp6fdrvVELth8RAClyHXxmhPi6r1m8FM0ucgk8+y4RHC1kAK/5XgW+2hZYofafWcPq1B5AqDqEYsQ3nepR2gqhV2yiol1COkD0C+aOaoGx4aL7DQCwMJ7uVwomn4fm7VrX2u/XAlELth+5sHPtN+l/Ap6sX2dCsZ/phZkIJgv9l++1wbcq+2WFv2NXIjNKAPzuw7MUAV8DTuynFIEsQy83RgTAhiv+NgBABaQOGE/3mwWTLwAqHnaQfr9GnwUbARgDNBUlkpzQboyYCyYDYdILdf0l4NduW9kGoa4geNdazLElKoA3Prx7DofiETtC6XvE7hGEzJlpcis3Qgrj6d5UOJoYDcMglrX2+y0NPtl5UZUjkfx/Hqbecoe0OZzdF1gHQrln9Bhee4s3f3Zxm4MvAk9VSFdUIw0i+Q2PaBtISiBSSFgCYMjMW00MP7pwvvLDmwFgQTzdHxcOSGvBg/b7ZRZByWYAlOERluKM3Ra9CKWc0q73dTBhMFT4ZwIw9l5Lrpes+HjeBiGCUOKXeuBvPcKTiEIOR0f+RhDBMYi0Lhea4GTaa5NbOQAVDzhgPB1La5RssV3rIP1+7yy5OAADoAchEHBkFbKfGRpiweAPtMs5IFNokyOGk/7rAYC9OhBFwNXVY1at5tftCBHaWVS2AJdEcEinrDNC+Lumiyc1B8AB4+muLARAXTDCWvr93lR4/Z0Xt6ODFQkj8WtumEwHTKDLQejAfN3uds/dfjoQdatGLxb8jQBAYz6/boxiFgAVudzNIc2/s3xLk1szAORoB4yn+2DhaATAGJCtbpkCYq9+v4V+aBgAQ4i66XtaC85YkDog/zdZvzUgfN1N7a633Xqv6fe9msDIHfNaB6Ay2JRE1AHAEDIfI5nzZCLeN4Nbm9yaA+CA8XSsul6yqV0rJ2WQfr+splCyCYBR/HJyKX4phs0PKBZ0lqOYTpvniAiUAmAd+HKjo1cvDjHgr+3wPJQsVCymUZrPMuRsRBDG4AQCsunyJtFGHwAAIABJREFUcc0BUJlxQoH62q8ST8cggpKNAFRGwCD9fkuvbwAkyGgJE3C+Nz1P1q9/T3F1EZBxvZh50s6AEYC5yyUHXt5/Q8zI5/KrAmAIkkipkyGPYwXz1aRT8v5ZO6jJrRyAvKOvNXlLazsXs9bo/ztc29Pohgotp5J49Rcj/pzfIwGS//3OM4CNd1dpntQpFUmjEH4LYIgnyn/OLjL8FeDGhwJbNgFjI8DIEDA8BAy1PFK7FSKf43cNKrvHx+8C/vmxwMgmYHgEaA35J0StpvvzL/nP8RbLAfhyT207TChgDRiu/ZL9DsfWNABvYzbhCDBKoBAk/pEobGWTqp819hzQ1/0k0PoaMDEJbJjxVZFgDad0SaUO5LksWVj+XScDmw5UEUDJ6U4d0nVbC91S3ovfVHp5al64cgC+k7mZAP768KCA0WD3A/ieLz090CDceVmlAuhBljLgrfcAw6PAyDAwPFwBkCAbItM4a/FiNtERjBl76W9ffD2AbwJDdwFj+6syImRXrd5Y2FjIYcnzWPLEqnsfC0zsr6qBMQmfIDR/pyJ6xMhKyMrSDiKD2xja6TADTt0/AGAs1KcAUCFrOLF6tbtiRVFavT/wuMCa7MfVTlH098YBeBcwNAIMEYAUlS4uBULOmK3LCnwOPANlEIOSoF9+C4DvVoWXhvdWZVOYqWgi3vOXDUQhgieB0EElViMYJ08HxqeqnG8D4IIDkAzo51DKQQJvBKUmKACzbM4+5hUivwrgiwC4LzvjmgCh6nBcgiMTcv9Abo0D8E6g5eCjfpUA6AxoQIzgi8ALmWwC4z//DxcPPwBak8DQFDB8yJPpPZHeGCyC0KN5DFCByfh9/+OAsekKgEzCTwD047X0SCPM1IYQjCv2E/MJoGVwUUQoPboq0MdqkWVn7RtDDMahB4g+P6qhXFpjVtkDtRGA2nKjos7IyOyHFUbIrXe0FXsTuzIYfNb4O2M3ATGIYQOmPn6hG6gi3eUkQQAeAIYOAUOzALMVh2pAlESqGFBAXAYOMQVjxll03iO/yYKRAT0FQXkwZkjp1pz51LO2XAT3KtD3AIAwj4Wg05kfiuUHYlsXAJLVnP0INLM0OYFx78AzcRySeTsw2AJueI+Dj2Fne4EWKz5MA0MzDkCCkAByUWqsJzarEanzj2zXwjEGFHuGY+pYsMojzZL1G9EBexXou339IRBrC3lJGmNDuSHX+w7WC4Cm6wWxm8DngLTImgC8pBcGBuTXf/1fXnyTugnFwxTQOgi0CECyIFlsvvJfEnh0mhsYI/s5uxFYi1xZof7oOqSAawwYjRGBzYGXbtWXaCIrlvHUagX6SP/ruMVYCEbEqECXAMjfree2HgA0ESur1/0vtnNwGSsG0RsZME20/+/XWH6Mugk/yngPAGy5GDYALjiIHIgRUIrsZjM7Ax+BSx1S4pfffQVIep8dL7dMDsTGjJB+CvQxTHmdtrw4l0CovFruC2NOe975egDQsCXRK/eK634JhBK90q2C7I1i+Gt0jxF40k1cPJAB7UP2m3MGJAAFQrGei9iUTH9yBUDTHfU3B5+BOIKQ43BWtNtPcWIOzEZE8FoK9K0DCGNxLi3FqaKA9gTgeoFwPQAoI0OulWT11oEwiFz7cwbErzNxWtEYBB+VY76Vh4DWrH8IOoGQ7Ocg1CqMRLPltmxvs1/SHaP4dcAJePYyyUCRIzrTB8tE8FoL9DUMwl61kQQ87Rmy2PS2rgB0a1ci18RudEJH57OsY02y/+83/sZdBKr4FXQTApBvprGgQCg9UEAM+h9F6ugJDkC3gJPBEvRGrYoYCBX9IxEcS5K4i6cZAHIw8oXQ4mLBb35YH5d7OekadtTV1UZSjaEIPH4nQzYNwgjAHNwDuWGYpZc7lzPfX1cQur5oBorfzDf+zi0yVTuSkuxBI2Q+PhQDIUEnMLo1TBCZLufGw/ixbQa0KB8CTODjPohdY78IQmfDjmW7Yo/doAX6GqIiAtDHaYswSmeMubV81kp11L6hy2PdAcgblfslOKC1IiKRmyRxZgV/8++DS8BFrxXi5Hd/U6MeSKdqEsEKhpBRsgRMbAtuG4KU/+9ry5brzP/lPVMv1EPOQegharrVcgZUhVHFxNPcp9VFtlOWkL437C0WABWypFRGsV0sb5Hn2zYBwvUGoKl10v1knDgo0y7XA8Pfv0UACnjaK33Co9gJQAOe64FkNvtZAHQdjz9v2Nz2GSa3jYej2W3KGuZ9ixGdIVSoKT13B2s5AHkGheST6qn0erHv5AIgAAU+LVfw/wq3CEAV7clBKDDGZG9/5oVXx/oyYARczcqH5GyH8eFplTawFvAtrtXLGpNrQDGbejupB3omlIHQGc/ErzOcGSRs8zrhAbbuL1Tco/JfbLlNwHOmi2kIcs3owbdwNpYtynDQhsFcgvuG9/YapGFvYX22zZcAU0/GwA2LJ/4AmGF9mwEbBu98Y3cMF+uAGQCj2HVp3BbPuo3IlqxAy5wHAq4OfARmEBXGfNIBa0BIsG0ecwC67merHgRpZLwocrWaovuTxew/V0txJQ2DWeae3WAGbdhb2DB4+wRw7w5g8Qpv88liyGtoWHzMi4C9fAEHbBi8kwUKu2xNAdBxaGBLbJdZux1LwAGECYAEm6wyfpelJrEgFnRDxESwgyUxIUsVMwjVy5AYO0bG89Auu1/5BF38KqjBHlUAYXsteNCGwTeWNuwtk4JMkrlzGNizA1hm69g1Nix+zDOBW0aBeRZZGqBh8M4emfWNADDT+zqMjQyESdQFHfDbZECCLRgdHeCTe8CBaKJY1rDnBRCIAuGW4TYAZeFG8ZuMkGiQ1IEwGCJtHZBmy1obBsvVMnDD3jIAerti3LEBOMjGcOpa3WfD4ic9t6oveDtLfw7QMHjnH6wPAybW6yaG4+8D4HIQfvtDIVtLejpBFsVvUI7NIBHw3DUjRzL3rDVtsYPOkAScuX3coNDynT2VYJCkn+PjqvUD8hVbS8NgjphGxcANe8sAGNoVY/824BCBtIaGxRe8pLKZdpMkTvXiJ2toGHzSNHDPScAyq3er4qPyGaNc7JCRXWLT2TjwGmCOeQashq6+qSpZmp8vojQpheF58ncdZVjLnjWPHr4VWKTKxrHGUqq97qXu3jp0wPy+eEC/DYNZsZAO6IEb9pY9lNCuGPcNV830ZmkM9dmw+OKfbdcXvJMPdY0Ng0/7GnDXKcDMccBS7MwdKz8KCAKQIgY0MWGCtr4TOHAasMwOkTqf6unyuLykfd254nkb7qsw/iVg7jhgmSX31Vpd9yRHeLx+zRhjEGRbB6wDYT8NdymyubzDzCCGfpMJWfSRYfr9HP/aMgBm7YoxNQHMbQHm+ID6aFh8yS93tAvGQb7da2gYfPoXgbtPAqaPA+a3AEubgGU1RM6B060fgkRoCzj+TcD+04CFE4BldZdRc4/YxlxgjJMewSiwN1zWfsOngdljq3EmY08vm5i/7j5yIMqpvupKyGoNg9lngYosl9wY/0dZdrMzYl8Ne8sAWNOu2MA3zw/F2CoNiy99XbvftrcLriz6PhsGn3U9cM9xMODObQYWCMANwPJ49UliuW6SaqqBn/gGYP8pwPyJwNIxwDK76ahDeN6uXYCuYyABkEza4LbpY5WEWdSLxjF26/dQB0SJ6r4ByAN6NQxmkWcqrnQ00x1DEDJFjR8CcNWGvWVPp6ZdMQ6OVOCb3wAscPJ6NCy+7PerkP5Q3tBY1PrT9tEw+JwbgPu2AlNbgVkCcCOwtAFYcgAuiwWlM/XqDjMEbP9t4MB2YO54YJFMo/5gHIcALV1TRZ17FXOhPtvgtvkqf9H4kvHDlyKK4l6VzvVSBF22uwjOb7pbw+CfcwBSkyeFEHAUx/yw9JTyEbo27C17Ol3aFWNuAlgIn9QxO2tYfNlbK6MvaxeMRYquvL9rTcPgJ30TuH8LcHAzMOugX3QALo21WXBZLEHwRF1OgHS2eOgbgIPHA7PHAezNu7QFWFZ7JnXJ5rnqxHEulvlzwyVNN3+wern5Yovl7SXLGwvn4riLWO4fgMRJXcPd/+pmOymELEhRzBxJAo9gVL4kwVnbsLccgHEpWi3epocCAMeBRU5eTcPiy/6qtl0wpvhA+2gYfO7NwOQm4OBGYGaDs+5ExYDGgqP+ccAkINaVpB8GTv4d4OBxwNw2YGFrxYCmV0YxLNYheCXau7EhV3ga3Lb8g4+R45uoGLADgHWqhsBXA8K1AZADyRvuvtkBSArh+i9DsQhCOtf0UUgW/7aiYW/Z0+nRrhizoxXwFhyAi5y4rGHxU66qAFhT3rDSIVdpGHzencDejcDBDcDsBDBP1uX1CMJRwFiQIBzxieL3KIY1YW5MPOxNwLRb8gs0aghAss1GZ1O+SFHsdRPt0i/PLHu++dFb/x4mXfhcbWxhfCtYMFr/uWvKxfDaAcg7ipPCvFOVpuo3HrCjYW/ZA+rRrti6TS6MVQ+L4NPH2nx698GnXF0BsKa8Iab4dFZpGHz+JLBvApieqAA4J8CPOQuOBBAOV0CUYbIskRkAecrvAdNbXc/aDCxSpyT4CEIyTgRgneiLIp3nP6fs+a4A4N8B8/48CUC+ZGJA29fpuLmxJW+5h5kNFg2jiWHSi0r0Uv4pCoZsxw8DUfnhd4Vk0XGdGvaWPaBV2hVjdjgA0BlpkQ/K9bmn/HOVqtClvKEBqlfD4AtmgP3jDsBxB6DA7tdbcvYzJvQJkii2n4NOeMpbgJktbYPGACiF3wFoEx1ZMNe/4jnPLXu+KwD4t/5SO/iMBcXuesHylyACMBPDgzGg7opM8mEHIGdwrfGA1rC37AH10a64Yr4APvvOSdwEPOVbKxu+K2pdKRTmdI3dqkPPVgbSTBGAY8AsATjWniBdx0QxJylOFCcr6HBiw1P/CDgU3EgEIMW52M8YkLolQRddIN1AyKWiBretf9MJQN6HsaCPxe4rvgDdHOcOxDIAcmDFDXvLnk4f7Yqt63gEIB/Yoj+4p9xaAbBHeUPM8qF2aRh84QQwNQYcGgdmx4C50WqCFngNsgSvQ+Dxu4MuiawhwIAXVk1O+e/A7CZgThY1dcno1nHL2oDIyZULpBsAFTBZ9pjT0QQgn2V6ufRicS8QRgbs5ZYpEsENDejBfpoLrwAOjgIzZMBRZ0AHoUC+SOA56xJwNlEyTFw5FxBPeWvlzpnbANCdQ1eSGTRybMuydgMggVBsKmtYoC6Mt8znZxsZMLzAxoAOvsh+ydDqtXx4FIDl8L/omQ7A0QqA82S/ERdTI22mNfaTuBIIxR4BhKe+y61punQC+MytI/Zz/c9EuvyBeetLAfGZ5WOMZ9j2/gqABB1fMLsHAVBqhfTcyH5d9MByEdzs+B50Z7voGZX+NzNSsd8cwUcG5ASRKYbdHRNYwhhDIHRgGmO0gFP+HJh15jOXjnyKblVT5Cbfoq+yJOszF8P8+VnNPlICkMAzds/YLxlYznrJwIpO6egTPMqA5ZNDAB6iCCYAyYBcBqTRQ0e4630SxZyQJQIvMJ8mSeLrYe+p/GzGfnTpEIBy6US/out+K1wg+brs88rHmDOgAVCMnrEfxxMte1Mt6j7u9zzKgIXzczEBOJIB0BnCJoqgIfDEhM58SWzJEPGJe9hfVH42un/Mfxl9bgSiBySIBWnAJBDGEDAB8QWFA8wO3/a+wH4+rg4RLPYLul8tCI8CsJmJMQAOuwFC9qMI9g9Z0CxhZz65K0wfFBPqu7PEyVdWAOTHVlTcpxhXHZLz1w0ZA6EDLhkCskRf0sw4dRYC0PQ/vVSRAYPo7QCdj7GqVOSMeBSAzUzMxZcDMwLgcKX/zbv45SQlHXDIgagJc+bjZBqAWhUoH/Y+B2D0J7rFa6LYDRmzomsAaOeKqxEvbWacHQB08JkRIteSXiSBLYJOLB+X4xrzAzY7vgfd2S4RAKkDDgPzNEAIxMASSWF38WsgkuXLyXTRSRCe/DduSZMBMwe6ObTd8JBj24Aot07uDObPP9XsIzUGFPs5+JJ/M6oT4buxHv9X7BeY8KgOWDg/Z58GTC9Xq5FxTXOw9c3Cm6k5fPcjgbHbgAlvVG2tH1T3Oavoq6BlniZ+12n5u/2sDbOvasqoFg8x2Lnbcd1GdhSAhXN+7qMrAC4sA8sORJ6yHwD28z+Ft4fdv8UyqUDrDmCEBcpZ39kLS6aq9l4D2rLb/KYsFTPWdfbvh86vQu2s1K/K+zIjTsXIVQ9a59Egs4Y6sZfIA/EcSp/jEXv8BWcAhxaA+SVgSQAkGAMICcwVlNLlqTc9Gbv/HAA7MrL4+f1VlXwrUq7SvCoyGcrrWpGhuur2fNGYwM8YT67hT3s1LaZvqn5MLM0bzmHMmIFSgdFNj/mIBct63NhFZwEzDsBFgpDPeanNgATfCtGsX9TIKwNrg9tuVkhlng7TI/YArX1VkXKrEe1l2SynN1RCsFJsqnQv3UIMxhwIRjU5AGN9QUteVz3BUAvahuNgjC3HxLAND7nBp/cgONXF5wCz8xUDGgCjKPbvevlzcKUHH2ag6cnYzepYBB9Zi2FxDJdjoXJv1WDFiLJ6MKqKZUzoQFTfj2HmwTKcTpVWvcxHKm6kKgoORAEvVclPD6NdzLXpMT8IYNPcLV7yJGB2AVhYrAC4SNA5AxKM9ryDPE5fs6eeVKWGZ2M3S3MQfEyJUKV8L1ZpJXpVJ9pLilmlAxWkVJHKwIhjjD9TtVXVm1HdOy/pJiaMFRWM+bo0rWl4yM1N7oPhTJecC8wRgAttBjQWdBBGESwgSiV0Pb9DRgu0TY19N+M1mRKh8niqFx3rRDsLqjgl9yaGXT80vcL1wnE252PAZCzAHQCoiqoW3yYWFIt664fUpKaREr1NPakH6XkuOQ+YDwy4FMSwgU8GSRSz0UJx3Vx/5vFNbrs/EiLRY+v4ACITww6iJEodQKwBIyBRv9vwhKzUW6z66TUGEwhDS3ezqusAyNxnJn8xa1KRPSFts9YfFB/QDZcAm78CnDBT5U8rCqjfc3yh8Gn/hGd/MsKf1+QzYJ4891Jye13iy1cAE9cDJ+6FpYrEkidxDN3OtXR+FwBGMezoMmxJLOumAuD4J4rxJrfdH/XCoLGFVKiUbw+LAPQqWWaMMLrd6/+JycSIm85w9lOpt1j1MwAwFTiqAWEUxeYH5ENn/jInUVHeMXQ/f/jRePvCa4DhTwLHfBc4frGqqaNJzLPw6iZxV+HTplFGvZrXZT45N39+HW3TujlZv8D6fp8HRq8Dts9XIOR5YtakgBgdrrrt5Qsq8Ssd0BhQ4HMwmVitAWHAY/LbLDQNQDaTVJ8Q6W4qVB51OOqDZDPVB3TLOBepW5jmqaLbec3jGgBGMSxvvemDYkQ9GoKF1ShUCSKCqBeQrvmfVZPC1keBjXcCmw911tTJ8q5XgOLaQgA+x/OdWA2EGZ98gbjleTHdQHQN+2iwls3nK3/Zhj3VeQhovYzdxmArSwQgDRA3QiSCJUrTnjfl4KozRCSCCeYmt90EoJJbVCk/1+FiCwFZxLk4dRfLFia6x8LbYkD9v9cXtLG6+O4AYQRfrgPygVIcqyhTXcWFOJH8fh3rz7EKwnUArq8mcGwK2MCC1i7WY7Zenh56feHT/jE3yliE4TZncd636gPFCKWavGhcRx2J+cvs9MlSw0Ty3cCm+c7n0G0MExdW4BMIbTXE9UCynvyCCX+Ovm4gbByA/xisVgJPpXrzLj4EoRJjJIZrWHArS9iprK+KcefgiyB0XVKGjOmCmW9xhRVMUSyRFnNeFGEdI2q+/HFXclkp9WsAbgTG9wGj08CI64WxRk/OTDcUAvBHXSLQxcVCDMQSWbzv+1e7WVbz+k5w2tJtsbcCYV6WJY7hmAsDA7r1Sz3OgOgoM+KTOJbcjSI5yGIaNE1uuwlAAU/MF+tF5/0sIghVLdVdM2S0bSzHx2Mi+FTxXf8X925NC4BycK8QwfmgVX1LlcFiykEMcL2BndJJ7aQfijKfxLGDwAhByM7aC5U4qwPzNwufNnNuOH4VZaCPlPo2AahqFqoPVFc14ga2m+WEEL0cAz9kdPrOmMu8r1o/rTsXz7f9oswFs+jO6LAqkvC3Ggg5Fg6mwW03CUI6X12h8lyfcz3QHqr3DIl64DbqaQKc9mI87QXACD6vpJqY0EVxz2CEyCI5eMSGX2e7VtI5J4yTRyZhscrvt1nQuivOAaNLlYESwcySgiVbr37Bfd0/u31yEgg2FVaiPCeVOguqAfGov0iR0R9JABJ0bnwk9nMxw+fOh55EbgRhzozrBUA1polN9CLwok5HEEUQBjFMQB7D+j656PW+IrJ8O/bBCo4sGFdGejqiyYCx3mKe9/JtTiBvmI5OFiTisg9LtJFF7gZGDrUbHKs79+hyu5hSaUvh1foFr3r/6vZJCiXgCDwVVFJ7MVmRLsrGltuFCc68yFdACMDAflwR4QM3HPoKgIExt4gz42SuaQb8hBOE2oZmlu+KFlKR3QSssMJxDPWbbjpfLoJrxG8CYT8MKGZSVTCxYFTIb84nkCxCIPLDiby30gXFghaF4c2ReR466Uu2fvoFr3r/fKAEFxvpqMcd9yonIrkuK5LLV7MVCM+/uDJCyIC2J8a0z1iwqyESgMl15Sa33QKgmtPEBnp11mwuXgO70Ud4DHWzfgDYC3zBEOk7HlA6XKyHQzb8HgGoCSQLqsxorIy1Bxie7Wx0rFaf+wr9Xv32C+56/7HbJ5VHtRYT+GJrsehHcya57PyKAQk6+vBkBZPpjPEExlwU59awg3C24W6KBsC6tqHR+MidyVG3i3rdAnAsH2T093XT+zLr197MTA80h3SfsZP2UqpCrPQ46oF317VrpeiKXTJ9MhMLkgGdCacKG/mupV9w1/vnwyGgCDCKWzJe3lqsyzLWZWe6/kc/oKzgKH4jC7oolhdC4jiuzM0WPo+cPQ2AsX1obFCTO5Jzn566PwbReiwnfTWjI4KvDoh1juh+aT+WKSYD3i8Aql2rJk+VsVQly5kkddv2FvHT61icqO7Fr71/IkLNXOi0FQjV0046oBy6wZ922Q95ICqDEaL4XWw3COcf9Mw73DFB9AqE6wZAAS8XuzGQIDKf+oVkqxt00ttAc+YT0PJ9qRFSB8xoye5Xu1ZVeCSgCLbYLVNswoncHxoeLwCzBGjBNki/4BX3z9lXgUCyIIGmhova83cRgO5Te9yLgP3MfmsBS8xs8/U67ePQOqy9umBUruDchqo8sHSd3PMfT5ifo+ack8eFHI6QEcnT5GvdOnVdXof+ptJ+BVPWceiaRHA8Us/nkACo8mzqlqmWrbFDppT5A5UIZm7CPA2Vgm3QfsEd909kKIqB1qJAKCBG8ZstZz3xHOAAiwmpDIdng1maZQAkZzsHZ537YfQrwNyxoQ+HakrnS0h1mUA1C96TdJTmORyhC3oeqdwROi+GDhkFI6bYNrcNDEDeAkXwQizPRpmnIs3OdqZPSaRFUcbchHlgie6agq2kX7Dd/+d8lUJVXuUzk8ERmS+2vfd4uvN2VOV5rSwb0y3JhgIh9wJeN3YMQCIgR78Q+nDEVYBYZUrUpbXFnM7COSdf7N4IPvtDnT2BY/h8Chh10MXQeYGS+7GGjaQiABpuNIFiECnzdWJMIUHcazLptC7YivsF8/7FgLFMqpiQL5TuNbKfA/DC46rqqAbAwIKWK+timRUBEiNGsOQsyQm+Gpjd4n046hbT84KPuYjOmHHyp92gcgDS2OoIuVIeh/xyUkaVwyEWdLrewHE3uBUDcKIwnq40HpDXL+n3CzbaKdguel5VnFJl2awaghLQBTzteZ0cjLq2A2n0M6EPh2pC57Wg41poLzZsAZNso0Hw6eVR/J8bF9YjWGmVCpGKwQLBRCcrbiSxNLgVAxCF8XSl8YDHHFPW7xeFBRwv/rGqOKUBkODzqgdWPYAM53vTASMQu4Bx9J+69OHIF+N71F1O1gUB+AsBfFqKC+4Wi4BWX+CYgOTAU36wdMVNVKka3MoBWBhPxyiuko3xkSX9fvGMkqsDlzzHC1N6SQ4DoINOe7KelWWTheziObeKCdARApD1AdVnRH048gKUAmAEYi6Oh4DJV4VoGDWqjq4XLbO5o1jBoimEPhPJmwu9FvnTLgdgYTwd2wyXbMyRKen3i2eXXB245FlVYUpVxUpGiLtmGBlrTEhVUwV8dEkVKAq3MHJ1uzRbRx+OOgDWFX6MsXJU/36lJoEoA2AKvw8+uwTEDIBbStdOs8ddDsDCeDom7ZdszBIs6fcL9ror2C75US9IxJJsEsHdGFBil4yYuUwknofJgF4XcEUfjrz+X7fKo4EJJ//PkMORO6FrVjQMeL5kJhZMMXzLwNZCt1nzDFgYT8cQwpLt4hDON0i/X7ys5OrAJVe0S/ISgFY7j9ZvnQ7I3+lyqpYaL98CWp/N+nDkZdhi6bW8An1kP3fRTLKVWlwF6RZCH2L4zDDR0k1IqeTNb2OQSYNbOQMWxtMxeqtkY6I+ny9VEz6btfb7xc+XXB249AoXv85+tIBVgJJ6n4lf6oV+mfjdDJNMH0wAVFX90GMk1f5TxlS3Fggh92DyN0IORy5665KIfCktsl+K3VsGtpVOWOMiuDCerlSnjQ2rB+n3C+pIBdulz8wqonrNPLKgwKaC5B3s53qhXVq6oDNg6sOhqvqhEr3V2VNLBjmnSSNdrOLJ1zkAu6VPRjFcFz4fXDJ8i45hG94Gt3IGjOFYA8TTlQZ/qGH1oP1+8ZtlT1MAtHK8mQg25zOZUSCLIliWcbw8wfW5Ln04ssqnHX04euiCk6/3de66MPpuAQVZAEFkw2MKFw6a1wEL4+lSBvmAOMhD8vkOkFX77feLNw14YT/ssmc4A6oOdHBEkwXlgjH2k4Nal6wB4fIuX9LzZjAmorNeHMo5Tc0OewHwDTUh9HXxfGJsYkAbAAAgAElEQVS/uvCpoAcew6zBBrdyBlQwwoDxdLZWXLDFkHyF8xGE/fb7xR8XXByAAVC1oB18HQYIT+8uGfP75SCUs1o64he8v4j6cIQ+IqkPhxrBCHjdjBH6AblQkAeY1ondukSiELmsUPpjbyp7XuvDgAXxdNZVvWCLIfmKg6Bbhrjup98v3lVwcQLw8gqA5v9zC9jErutltg8gMxDWWMBaMVkmANWFyEV6R0uH2I1IzW7ypbkQOTP5f2ch9KsFkwp0kQlDAOmxzHpscGuGAQvi6VD4RgmAg/b7xZVlT5MATNXwqQc6KGwf2U2uGV2uzg3D4ua7fDnPwZcKgIdq9GaIBPZb0YdD7hgyIFWMXiH0eQ5vXS5HcMkc++9lz2t9GLAgns7KxxZsCkgdtN8vWD+vYDMAUpcja7lOR9eLVcIP4tcuob/3AOHCdW02VTX62ApB4Mv1v24gnPy9HiH03fJ366KYHYTHsgBBg1s5AxbG0+HLZaOp65i+ln6/YM5EwdYBwGj1cmUkE7+8THLNdAHhwrUOXtcrO/pwhF4cct2oN68BMDCfmsJM/n6PEPoYPp8bH3kCkbtjji2tJJA962YAWBBPZ0WBCrbYsFoOf9pDAiENk179fkuvf9nTXewKcBSjsn7ldonWbgQpx+26otaLIwAlfi2QQSJY3Yjy5i9dmsFM/oEDMM/Z7Uf0RiYUA7J+ToNbOQC3e0WBBm9qLad6HICG1ZK1XB5PoxnuOOIcxSXe/Of8xHV/P+FpwN47gKUpYHmuSve0pKZgCKSq5wqniWE1WZz/xouBm74KTMwBI17lVBXwtWSs+8/vL45Ff3vhpcAnvwos8d48DZX3M2hx9XIAnu0IIO0chu35AOgLL0yuG/jOmwbg028G/mNz1YWdETbm4I5BrFlov+EtD2wIo7l+Atg8D2xY7iw3V5diEqO54mnj6XdMAYcU+6gon7A3NSO2qFjlyZYDkAX6uD5Iam44YaUfVNDNxaJcLIPXcGGpfi6PnZdVD1wPspQBX/wl4OaNwN6Jqg+xwrxslcVFuYJblehkcYYZGPS3L20BxueBcS8nwg5H5kZkx6TQSbXFZcCQKadx5Cz5mPurAFxrRaa17pAR2PFC+ElSHKQ/0QjQcgCyGyM9v3SnsDBRJgL6msWCf6IfWeUJac8UFlpY8500DcCfvgb43hiwZwyYVhd2D/VSrKGAmIDnBkiafEcN9cprHgKMzgNjS1V7rRjRlceyrqif6KAkMgXIM+6tAnDl+zSL36O9+U8p9jGHQo285/2XA/AnXeNnKAorDXH/AILwbSvLEz6Ql2+cAf/3XcCdw8DkKHBwpOpFbE2wadzIdyh3jjNQirYWEwYq+/zJwMh8pf+xKNSwM6DZMmzNRRbM2K+2Ii6TlFrAWfd5V3i/F7IgT2LBF5LbIdkqxLPWvtzlAGQ3RpU3Y7AiixMxLOUB2t7pKQ8M0qCTnp8HkojJgNqaMEJesQv4AR3Iw8DB4QqAs+6SWRiqgJgY0HVDAdBA4Ba4xN7ndlSFAAjAYX4IPO5dBDMAdS2i+Jx7XTf1eEdTDfgAQnR34p/wQkRmjNAoByDT/ugFphXAmjAEn8qaPQAgZCs0lSckCNmVigEbFMsPBBE3DcBX7gLuawH7hoAD7EM8DMw48AhATrjtQwiXoqkTEwWd7LOneXNCbz6Tiq/TInb2M8ZzIFrTQbGiy92oGz7pXl/7jvdAJnb2470IbB3T77Sai+hyAP5voTqW6sKwFAc/TAdc5+3dvcsTrvPVYSK4SQb8xV3+6IaAqSHg0FDVh3iOIFTIFxtit9orL5Z/LD1Q4s+B8OnHVuXwhhdd5DoLGsgCCJ04q66X/Ju/vSaeAxDPvbdtmdtKDV90gVEPIl/xySkviOhmAEjrlzSkwj40SlQZYZ39I+8JBMx8mZryhOsKwqYB+KpdVSDFvhYwPVR9BD7uyX4SwRS59nNI+bRck/DzJ05v12M0nY8fAk8iWL5BB5qASPGRCi8EVjzv3mqpkC9ACrrwhKukB67GhpqRRowQMqCiYbj8oOoHeUWpdYIBAUj8c8WjrjyhNIJ1unzjDPjqXdUjJAAP8TMEzLYq9uOHICQALe/EwWe+QgddAqCzzD8+vgIgg0qp+5nYjaDzCgjmnCYone0klqP4JSgvvK+6LoFPoFMlkPGh+0rPWta4RHTNJJQz4M8EAGoNTPVU8opS64CC9zoAWTFChcq7lCdch6s3L4J/2QFIEBKA1P9mHIBmhPh3Ai354RyAAmWsR/PRs6vOR8Z8FMPS97yxtIlYgVB/I7jC0rIKSfLXF1EEB+BFFjQ3jCLA49OWsRTTEPzvzQEwry7VrZ5KwzAQAPssT9jw1dcHgCrORQCS/bgn+1HsCYQSveaHkzvGv1scgU/6R55Y1YIxhvOm1EZekQWl8wVDxJgwc88QiJc6AKX/meHDawX9z16M/Em7bO8Q08GBP/jEkAEVjMBoAFWXUjRA3KtNwOBXW3EkAZhrALktpC6lKtTV4OU7RHB+3kHWgv/zrnYZl2kCkF4uF8MGQGc+MqEYUCA0n1tkwxbw4ScHAHr71Q7W4++c8czwcBAmHVB/c7Bcek9b3FuwbdD/kjGWgzJjQ3thGmVA3jhfOyU+RxB6FamOFp8NrhsTgLy8Cpzm5QlVptAU+6CiNgXCaIQ0BcDYV8b0P4pi30vfIxD5+w72C9aliegW8MHzqrmh/meuFhYi0pKbs6D9fsh/n1XFMrYMbPgUByCZz6J+uEknDA9AornWFRb01WZEsACoHhOqyC7wdetT0QAK2KqOb5MCUvPyhLE0oQxzqaYNXL5xBvyVXe12vByLADjXAvgxBvSPGFGMIjCmJbEW8HfntxtQmxT0cmxp9UPAdKAZ1upA6EB7qgDo6oCUxXRtPVSpAwJpnUhuxAqWCCYK1MBExZljY5S8SYr+pxAFAuBayhNG26jw8usCQLX0SAAkwwcAEngyQizaXoziIli+Oe7/9kJvNk1LmBMe9ECO3XRB7aPeF0EYHNVPdT8gj016YBcWtBfBVYJuz7mF7VgGY/pO8f5WdQ1/7U67nIKNS7j0wIbDPFZsyNHHY7od/xdlEHj8CcC3TgCWHgGAPSxiSdt4312u/8SPAl8/Dlh4pDeZW2PD4J1c9+uyDaIDkgEJQKnTfG/N8nUAmu5HUnMW5ARbPfEuIHy/ACjRK7FL5pOR4RaxgTHofKl8r/S1ZWBnAGDKefbn3AFIPRPXB7sFiVQimKVgGdl5ooNwLQ1/1U+DQGSXQ9r5Evy1q9rZbP1lGQDZsPpzI8APHgXgod7qUx11YtBbFzC+/C+BL7SAWwhgdoLkONSLqy5oLogYft3ZI1F7EAC+phsAnekokhP4HIzml/PvthQWmPB9LJ7jxkcSr14jWj4/0wFlgJD5eoDw6fe4DzAYPHokWhHJZ3TFSkn4h7YOSOBwEtiMTv1aY0uktFYTmI2/43EMQmCuAJmUE0gmVD8EFdPpdnxhVhqzDr8F4NMtYM9Jfg98EVTeNu9Q2OFZBX7vr9vtgm/lcezczZ61ZNN8DCvilYCdPXqNDQpAlfGTKm0M6AA0PTAyoMSx64cRfPQHXsniOTI+fEWDFGp+Qb9BeySRBV2kpl0QxxGAlHDmkI56X6z+EP7UDYSdRgh/IouwIZ36lHabBE0GJ0r10Rgb/xA/tt/j/6aMAf+7R4CxzuBXWRGULwBfIrY6UNfpvLae7n0I+LO/reoLMqiVMbW38oUhkNkQIzZO7tIweGePcmWlAFTjAYHPVGwXxWoLYblEDkLuTT8MDPhXLJ4jALpaJB+ggU6xfgJknT7IKXIQXh4Y0FZCog+wxiUTwSkXUbSMV1rB/A31OXWuFpPUda/mRHKi1e6U+hA7Zq7l+A+UAfDtHg/LrptkQpZ727cRWOL9542Pa3rOvuOqagUltgtmJM08j4/PILbIDKz6w5PAHsbraTnMGdZWIwIzxIfeK0rn578J3LAVuH8CODRahV/FFQ/1IumIvXP1QudNfyNT8oVqcHviPcBd48A0g2RDuoDqHdb2SalZAdG9dnfDkAE0gXnH5ijWCDbKCq5/MRiV0QD8HgHQ63jG0hdsLGxA3x9Bw1Asli7hO3BwApgng/Gjvq01IHrXJ7q3Cz7E++YziF2rs1ZLZ+8H9jJsSoECWXj6igmR87aLgfbGq4GvbgLu2gjsHwdmCEIPSI1h+SkCRjpfUC3iNWcpoRrcnrYbuGsUOMBo7QBCxSTG/igxVcBIVGPWM1h1JYQPnyKNExGZMDIJ9b66eEBGxPDY1Y5nv+GCjfGAxD+DDpiawphABWZPjwNzNLAEIH4XCH0M7/5c93bBfI8Yk2cgVAdvdT10ifDkBWC/r9lGH51NhIsnsWHOfPmEUKT94WeAG8eAO8aAfWPAwVEHISNQlKQUglJjJExqC+H6Nq93kOpUg9szbwLuHa66QzFWkaFieXxi6hgVHOMCYGRuJ+5V4jYJIDKI9KlsAvFDq8QDrnb8NWVPh9EwdFkQ79TlSMIsN0Mi5s9MoOGno4U6f3YAvefL7Y7rvdoFLxOANSA8f7xSgWmd0kCQbmZ6mTLEnJ0UqWLhUkxlrBn6n3wWuGkYuGukCsufGq2iojnRFpafsU7MDxErJuZhYCsJosHtWTcBe1oeq+hxigJgXBrMmTBPnJKLrr+VED54ibHYvZos8sO+DNcrHrDX8YVVyglAKud0LtMjFPtNMz6QLDY7VomLJd671AEH4Xu+3g7nWq28ISvX58/hguOBg8vtFQvV/hEzxfqOevuTfpjri8vAWz8L3NYCfjBc6ZYHmBcitnFd06pxyb8W4gPlgonBqffTtdTg9pybqiVNBssyUsdUD7eGO9amnf3sXtxQipl7Wg/sD4A8AwHIyZMYky50Tp/xgN2OL8y051qw2hXzwRCEdT2nmck1RxHG+w5jeO9NFQBpR6ldMIMXlFWgVndqF2dVFsJzuOgRwMElB6DcI6rznemD0RnbwQiSRS3g7Z+tVIl7PC9kahiYZm6IizuLigliT/VoUog+p8P9l3wJ7qGEanB77k3VczroUToWLCsABud4ypaLCUoxf9i/9w9ADiICULrQRWuIB6w7nuZrwaZwLBGwClSqSyz3AhHbaRGEFGOmC44D72UVgjW2C2Z4lIF4ArjodODQcqUGqAxfcpG4mJVuVqcL5tbs2z/veV0tYK/nhTAqesYNHdO5PCJZos+WuzxHJIViuXFyJxupNLg976ZK2lizUKodilGUgzyGhokF8yw5Mf+qRkjdjfuDtwkkm7DTkNaBaQ2ox1q3eMD8+B6O3H6em8Kx1Ccx9ptWl9iYIUAAWrI3I3nHgPdOtsO5eOuxXXBdj0V1vOL/so3Cxef60tlSpYwveKf0pAu6ohfdJ8k4CUqgvr5jV6VGTBKALeCAh+VbZLTnh5gu6D44A6H8cVlkNK95O1WkBrfn31R5HSy+JCwPplAxRegE/2T+AloGncNmbQyogUQx/KwB4gHj8YWNTwRAOW0FIIIndoqNkTAxz/bd09XDGLBdMM6/pLKi5whAX60gCK2ujxzEAqGL2pQ1Jis5AJEAFHvTujYAKjRf+SEugm1d2COQLU/DAwQ44caEw8AtZzSIPgAvuKkdrWMM6M7xCMBoiBn4YpCE2NCfxWAA5MEuwvCCEICwlnhAHV+YORfDsWJGgPpMKwg1b9QpFnzHbD2BK2JGul9s8KkYW17vLALQRTCBpzXZpS4gtCXXMAkduuAy8E7PijPWprXJ5CR38ygw1fJDohh2BlRAgq2OeN7uTWc1D0AFNtmL54ESBsCaJcLkDajxj5ZXRiCIGA0waDwgjy8sk5+HY+X9ppUbJSCp6TnFCMXwny1WAFQ8rUAc2wUrRL6mXTAefWnFfnz3FpbagQKLAqAzoZjAKkkpXkNO5GCEvOMLFXOnnC4xIKOjnQGNdWSM+GqHQGd7JSsxUf+JzQLwhTdV4je1nQvr1MkPGtlf9yP2Dy+gAqZ6rQytfvdHSDxgLwBF8AmAYjHWluEDiKGMiqOVvtejXTBOuRSYJwDJAARgZAGWL9Nk+IM3SzgTydE4eec1nZHbtDaNAf1Dpd/SMx2END6kD0oXtFhBXmcY+OY6AFChnKnzl7NfdMR3qCAae2B+VVMYXASvDs3/X/zHJZcB84vuiqABEo0QPnhnwqQLyRURmZBPytnwHde0M1vN2lR6picoKULaxHDIEdHkW2iWg4/7b5zb7DSQAVd0/griV2JYojfpwRGEYsGBrOBmx/OgP5sAKANkcbFzNWTRnX/GSGImMYH/LYlk+gGvdT+bW+SWH+Ig1GqL5QeTtR2EYj5LVHfjw/ZDwL8yJ6TB7UU3VVoTjTYxYDK+Ivv7dzNAZIxpZSiU8jjKgIWTcykZkBawDBBnQdMr5QeTKI5iWCB09AmEb7+ucnOQ/aTPWn6wuzyS4u+R0Ob6CUGqJpIDA97AdqINbgRgBJ69CG4Jp6q/ckjXqB/RKla4WpkO2ODgHoynigA0JiLwaNiEt95YQKJ4FRC+7brKzRH9jZbN6iJYuSHm9I5iOAOhHNJfZkh+gxsBKPbLu3+JgaWDdojhMO5kkDWSlNTg4B6MpyIAjf3IggJgMD4MCARjFMU9QCgAykhSKnUCYHB9JB0wy5aTRUxmup4h+Q1uAmDs+hpXgFLnB6ULONOn5xACNJqxghsc3IPxVBGAiQG9aLeilWUJW1FvVXEN0TKp1C6At19TMSCBpz1dHtT/JH7N9yaxp6QkF73KBxYIr10nAMproB44qQGTj6sjUrtOFPtLeFQHLES9AdDFrq1E6M13MaxVCTNAXNFThIylLcor40zxtgDAPKuVwDMrOKw+SBTbtR2MND7sZwC7Qvm4wqHa4T/uIrhb+7n0EgbQdTijoyg+agWXT8llDsAFWr/B8qP1K7bT0pvtVwHhW6+t2C/m8svvZlawi2CKe37nhFtapkDnILRqBQA+v04AjMyn79EIkXO/DnzyCBwVweX4wxs9B4rRZgyPVFqykgDd+5JSpBU5r0vHyHz+jsc3ub0KABsZMCyQgeExKyFPVIz3lmcM6OfPAGCADYPE67Jfs6h7G0o+xvi7oyK4cLZfOgpsXwC2Lq9MwuuVERonKn4nSJrcXnQKcM7dwMMXgYcsVxkSebJgzOWPqdB1ad2f3gpsnwK2LXWeR9m3danUIV1lBSCPArBwtp+7DThuBti6UDWDmWA/DvXk8LRptfPtNUlihYZTOPCi04GH3wFsnwGOW6iAs5n3GeJJ+KLoE+9VDClQ8R6vOQHYegDYwuY3S6H/iJ8jb11ck0q9Qhoc9QMWgPBZJwFbpoFN88DGRWBiqQIgWyJY3lPozaGJ1KTEPh36zpTkJrcXPRE44S7g+Cng2DlgyyKwaclfFoIwvCwx9Zn3Q1DmIPx/2/sSaMuusszvjfXq1ZRUElJkKsBEGQyYhJCBSkUqAW1tsBdpuxEVaBzowXZqe1g90G2LotjQdmMjKqtBxQERdAWUAkUlZNBGkQRNyIAEMAkxpFKpqjfUG3t9//m/c/+737njPq9uVeqcte66b7jnnn32/s6///3v//++Tz0dmD0KzC4DM6vAFpd/0L3Gh6yTDgnvLwKzAWDGiH/ThcC2OWDrErB1pRgQisIQhAa+AED+HEEY6uNLyrRnZLSl6tSbrgLOeBQ44yiw8ziwfaV4UGbdegmA5QMTLFlqsfn7XecDW+eAmePAltXiXnkuZSBkRcm4UGXtU2uo3xsAZgz6y54JzMwDWzkgBOAqMMVBCSAUObh8QuN/CiTgcWAuyWhL1amvvBbY+VgxbW477paa7gIBqCnUrbUBiQuhAKDUot13IbBlDtiyBEyvtO5VDxvvVfxW/JkWNFrCeK8NAGsY7BsvKQC4hQCkJNaKy2LRIsg6SJ3IQSe1onKKC2CsOYMeN+0Dtj0ObDsGbFsEZmWp5S74g2Ir2uA22BScAJGA+dJFwPQ8ML0ETAUAkgDTPq9zdK/+sMWpPF19NxYwA4g3PtsHxAE4SQC6FdSgmGWRRIJLZJll8EGKjHiX1jwaN10HzD4BbD0GzC4WrsKMW2pNobZoCu6CLCDfCTqzgg6sr+wFphaAKQfgZHKvpRSYg7HN5XCL2AbAZwPrZGaj6ippXhgn0kqmU1woxnHedg5AATuWHig2FE1uVRwoxoX+Wcbg89S3AqCKPONcCi8oPtVP+9++G3j+oSK2xRBFDElUxbTS+3nvc4FpDsjxllXQoJg8FgdCQoGJJTTicLcQ6vPL6wbg9cDM4cJv27oAzFA5ky9/UOSvmg8oP86n0dICBn25JwjARWDSAUgBHN6vfdbv10AbARh8X91vDM2ss+NvAECKPVLCsHoyUgRqrlbnRwB933OBc+4DXrIC0IEmiLnE75di8HsyAcjzWUVGUi6uICMpVwwJVMXdeOk3XAxc+Hng+vV2esAYw+sWoP31r3eLcLwQBeQUrEHh4Jo2h4vDmJPuAyMLGAeEn7uqbgB+I7DlSWBGCwe31Gb9aL20kGDb/EGRxY6WTz8f2wtM8l4pgL1SgM8esHCvsuylME4nn9cfQLtldg6TZ0kUKorAfij23vAPCmqp3fcCl60XFINid1PlZrf41/dnApB6wSQjutUfIDJR8CGIQOwWEH7DywpKrWc8CFzqRLHkVYrB2jS2FQH5vkuBycXCAlIUUAAkCM2iRBA6+ARCe7DjYmQduLYTleiQ/XTTS4DpI+6nLhZW2nzVCEBaMLd+soIGqjD1ampdugiYWCpeBKA9bBJC9ActAk8LES26SqsftInLZ44dQif4Igdhym5WLrPDyuYH/7HTCNwDnPko8LXrBccjQaioe6BiKad3+QY/MGTH6rS3OBvCnQDuAIyqhiDkQ9RX+29yE3on8IwjxQPI8zkTiApGU3oVkD/4fGDieAuAdMw5MFQjEgg1DYsUku+a3uI0TGBfV7PotwHwaOEmbHEATvuDIutni6UAQoFRIFRYhfe/dhEw7tbe9Of0Si1g8HkrwRcevDajz07gIJ7n05rYyWIpb4ya/7vv8PRdFpj/LXDmkQLAnA4jCCOlTBRN/rFMAJKgkkVHpGUjySSBSFeg7/azqk8EgbSEq8UDRACLKDXSyaQ7Br//DcA4LSCtwnKhTEkQcmAIQhtM+Uaajl0uS9NatITXWzpzfcdNB4DpY+6nBgDaCtanYLN6fCj4u1ay0QIqtML/EYC61wSA9tAJeP6eWsAoDysFpg1eB0HIQRCIIkVeCqQf/05P3WCB+UPA+CPAzvmCaFWDKEuYcl1yMN+Y2dckqGTeHPEvvWDSNhOAfbefX0A6rS8CUw8X9066bFIfdqMHJID++DJgLACQumyc3gyAEYRRKFCLD1eu5ODLF6QvXedx0w3A1BwwxdAJLTXjd8seQnGrZ9bPFxLyA7WIKON63tYtCQBN/sv9QPm6BkLp0vl9t/m6ietR6fbyBA4gnXtORwRRpNnTtPpW6gWLH83lKqcOFTEnDiKtoHwy8RNFhrefyeztbnrBfbWfgttsP+kIyO32ELD1cHHvInrlvWs6TsnB7qAUlg/suFtAWkE55zYQ0QpqcALoNCXTEt7A3KoaDwGQfqoAOEUBa7fUbKctltwCajVbxvSiyvoasM0BaBKwwdKb9fN7NfcqBWGiSWykWXER0umeacUEonQgCKRfIgDFjya5yq8Wfsfs8dYgiuMxgpAg/vnMzu6mF0z6Zj5APdvPQec0TEosnvQosGOhaLuIYvnwEYSithE52F1XFAA0p5yigD4otCqygFKnpHUpLYP0OcKURYv6Mj4MNR433QhM0gL6QongawOg+6rl9CswKoSkEIxPyTsuAPigCYBmAXVfYcVf+n0SRYw6dP1YwNgHsgSajiJP429RrpWOM6cxDiJB6NINM4w7LbUGMQUwB/M9mZ3dSy+YVG0EoBiDBST5ddZ+PkCsAiIlQZDa3LVatJ0WXG2PbL98AB+4omB3oP/HgTUhmGgBfRqWf2TTrUSjExDSP/qWzQDgfAFAWyzR8rkFtDAKX75jo6nUguZxZ8NByHbvvqBQ36T1swcsBaBAGGRg40Ir+rt9WUDhQ5ZAU7Es2e9LLzglqHRxNkbeuW+oQRRls5jaMjnK0a9ecNf2R4LAwO829kQB3LTtEYQPUwzQAWgW0AGo8AQH0ljp/V17pm0KRcEifGuNOnocO1rACQbKPXhs8TtNwVr5uh+n6Zf3wDgu29g2FdMtOc8B6PdpFj08ZFrplw+ZA5FTvAQQ0/BT36FPDkRqBT9Jag7xYlQItY0f88j78sZzCcKPZlrAQfSCK9uvB4h577SCotUiEJ8opq8IQFl/PUBPEoBLxbRE62LSqG4dFB8r5bHcOtiOQSqT5T7RKzYDgJx+BUCCTxZQCwhaQc9oKcEnEBKknj5FsJ1LAPo9xoWWPWDy+6IIoqbeaO0VA+zHB0zxIQDKkn1GgtXiRxMIAx0Vn0Db+lkuFjLRCt5WEwD71Qvu2H5OfekD5FaciQay/GIbFgBXriwAyGmJADR1ck3DwTE3TQ4B0LetzBJErTYAr2BBSI3HTS8tLKBZPo/fWQDZp197Z3scjGb5BDp/L3+njMweB6B83Gj9wj3atOsPWin9WgXCFlVO/3ctf4iD8XkBkH5USlAZlNPZAQqARr5vxu1yjmH0givbX0UQKI63o0Wun/xHuR8E4VnPK5JQLd4VNttTBvK2uoiKOUf/f+GjwMNBh0NMV6J0c0NpcRv7mrYv3kh8/uHxYp+bVpwLp3R7sts2YzouSq3KGa+q7+x7Co4nazAerRKsVlV1QitF59dyyFZaYY0HMu9mWL3gtvZXMbymBIFMZ1ov2h0B+LTLisxgW+Eq5uU92iZ72ud9vvR+4JFp4NjkRh2ONi0OB1/UBCkvEYRhfuNs4OmhhiPKnFQlx6aAjMnSXJUAACAASURBVPjmz1w41nnwO4cCIBvBwZgTAOUHRq3gyDExD4zRGVYEnpm5LqmQc0M5esFt7acFl0SlHiBxuTkYxxdaihUC4QVXFu5FCUD5QtJl85sjGA0ziQxqeu/fem+hw0F2fLLQGxFlYMRvo7v1WmIVtpt1DFkXvOR7LwJ2HSkyoZmEypoVVe8p7b6qEMnidGG/Vl/L2aPOIwuA1pAIQE3DAmFa4j9f7CPaFpCHKujr5xzZesGdHqAqKz5X+FLRAl58le+jui+kTBALMcgZ73CDBkpN2/7+bfcWOhwUyCEAjQTcAVhKdjkPc2RajewKyu/n1//qJcA2uhBMRGXQOcn9U6JIOjXHQqSYOsVoQp1HNgAvz8yny80H5PVz9H6RqVd849WtXQ/zA0Ow2ayGLJ474L0G79vvbulwkJi8BGCg4S01SKqofoNvSIC+5zkhFUupV8rUTpJN06KpaBkFQm5M1HlkA3AyM5/u9Zl38zrk6f0iU6/4hmscgK5ISUtCTowyDqb7UxwsqFJW3fo/vbuIBJEZ1YRgyHwQKNi0KEl1OKTCZJdxtPDn//v8ooaDaVgqFyiTD2IKfcjZS4Fo+7g+HXOPv84jG4DIzKfLzQf8KVfI/FNKrQ6h94tfz+vOA9cGAAbrpylY2SDlVTTt+uCnV3/V3a7DQQAysJAwobZJgUXi78Qayhd812WeiOAZzEyUiAkHMeu5BF5FwZQAWLPwknkLQy9CrPMy8+lIHZFzvN3T+YbV+8X7c64OHHix74V6zIxB+RJ0wQ+UU992tYoFy3fcXcTDxQkoPsCUhFIczKVCegSg5B8A/PILN9ZwxBSxtiKiUAOi7JW0dLTustF8AGbm0/1o3vjjnSGdj+lYlGwdRO8XN+c1wABIoHk6k61yuSCJITq3jDY9Vx0BqK++uwAfX6JkI/hME0SC1EGguiQ+isqcQRLrF6/0jO2w+6FMnZhyZYsQ1W50qOHgPX1NXndtODsfgMwHzMin+0+ZN0S9YOllMzWfLwKQSS396P3iY3kNOLDPM1y065H4gOW3p4uTDkB8zWdb7FgbdDhEgJkCUDRvogTmd/vPv3BVAUBuvylNzAAYi4hisVQnEHoIqWblrxqm4Mx8ujfljT+YjsWBYgIOc0oJPsq1slCpH71fKybJOEoAuuVTRSCnYlmU6P/Z4iSJEcbLv+Yu9/1EAh7JKEXDKxq4ChUiKymRbwjgHdcUWTARgLYXHSr2LOU+BV7MVwzxwOfkOWybYAGZD5iRT0edjpxD6VhcOQ6j94tP51wdOHBdMeXa9OqWRcmWXA1XLUIUH6zyCwlAs3z+YBkfs1u+VIejJEF3ckrjI9T0y/aMA2+/tgAg08VURKT8vbKMUgAMIGzzAcOi5HknHQAz8+l+MW/829KxhtH7tTz+jIMAJPCYMULAWd6fvi+EY9ouoZBM/Kx/4LUBgFLgNC5o16FrE8JJVJgkiFhaQQBv3+dVbMrWVsC8UxFRkjjaVsW2DtRdOJ/vAyohVYK7A+bTvTdj8HlqTMcaRu/XxHkzjgNkIOWuDr8jnYYDKDutgpUhra0uAlAyCCUAK8BXcjBXgLCk/h0D/hcByDxFAdAzoFUqUBYRJTUcMWdPP7ONL6i5bLQeALJRQ+bT/W7G4AuAOXq/lsGdcRgAY+glLkYclJVTsa6ptCX3uQjAKINQstFrAZKIwWxQIhIJuovB/Nx+r2LzFCwlj8Y0evl/MYk0kieVtcvrwGUnHQCVjjVkPl3mItQsIPuElx9G79dOzDgMgGkAWlNyBJn8xKprBRC+zgEo4LWRgcdVcOCjjlNvmx84DrzNAahaFZWLygKWxUNibIhTcPD9BMLLa65bzreAMSGVoXvJ/Cgh1WUfO+XTZS5CDYDs9GH1fnOrIDcAkABTTDCCLYK0Cwi/586WcKJUiEpC8CCBYDsiiSplqUIUmOjf+o2tIiKVUJbgU5uSWl4DWwX4+PcXnrQATBNS+8yny1yEopdcay+930y5YhgAg+9n2OoUeI5TdQer+32fdhmGoOBZanBo+g1yEKU4dYgFSvqB//vZBIBt9RshkTbW8ZZZ2hUgvDL3iU3uux4LSBM0ZD7dPRnTH08VAIfV+2XAOucQAMuVcKfFSD/+IAABsEoGwYAoHZIKEEYxRIHwLS8pUuhjFVs6/ZZhIVWyxVKBBIRXnbQATBNS+8ynI4tBzkEACv+chlUVIKE/5cRGsWmlKfIzudc3APLQSlg3E2OCyVRc1kpU3DgBmKoQsWtlBcswjPu+nfTYtBL+GQdgOf16GCZW6pXlBCqWSgqJypoOAFfXXDifbwFJLvi5HAjlnUsiIe6AjOp4iQNQHRlT2PlgJCUbbc2s+v/hFwFb/q7gm6HlYpBbmTV2sscQyy/qFBj2v0/cAdz/HGD7NDA1AUyOOU+1CwWOewNjKj6/O03F1/WuugW4/XJgfBoYmwDGdH7IxB5kLPIB+I8AfNwZgga5ck2fJbEm8V9zNWPfrasbgMuPAcuseJ8Exsb9FdBhA+7gaQNKB6TfcgCYug+YJT+g89aoBDMmIMScP12uTKj13uDv8zsKig/uJ1uQOsnojm3qB5P5ACRBH3OhPuzzRN9DV88HqQLEWPJnvTy5nm/t/1s4BcuSpRZtGAu4fi+wtBVYEyccrYwn6hF8/FkJp9bKxAKVFsn/d8urgbHPA9NPOEOWl4+2cfoFHhfVrJTZPKHSj5daOtup6JyCpPx8rHWRVQ7WOlrYCMx8AHIzlxkALPD9c0VB+x/A3E/+E2fUYHXdF7KTGwdvTd0AHP9r4PgWYG0KWBdfsBdsMPfPrKKsoL9XAVLAvO2fFylCE4cKliyrDVZNcGS1CqEYhWFiAZV+XntaURdTLmpCEbpchTYLqi6NrkMCzLzt5Xc4HwyJmmkJ+Z73jQOh4NWeDUZiK1K08f0EXt7CMHVawIk7gaVpYJUA9LI1Ao8bzKX1cytoFtFfpdCIWz7rgzHgth8u0oPGDwETc8CEMySUzFaikgtlpW1Ta8JqNba7lVljSRgW+Q6ZP/57WQvj6fydBjXfAjKbgEvMLwWCvhNoipgNpnQshlS4IGFWzIk6ylWwAz93ETLxGWB5ClidLABoIOS7pmGfG+33YAG5mND0G8F4678vkiPJczNOAC4UyQm2N8w94kirFlfIAl7i402d6dbPWWAtrsjOFiuCvAJZOQE0pHTFsckHYDeCvhNgipQNxoAz8/8IPr5nbvH2jd+6AThJAE4AqwTdZKEBLDoDgU4+YVkPHIBoPwareOt/BkDexsMFAFnbzNJYm0IDnVwbt4uyur1kwL7Tp+iZM/08WT9Rc7DHUmuYTr/x+6o4ovvu9fjBbgR9JyA+omwwxvZI5ULg6ZW7y9FPf9QNwKm/CgCcKABovh8ByVy/UCtJq2f+X1yYJPGU27lIZLbuEWDsWBHesZeDz4iURLUWa1TE47LqK12fZmd3OXidFctqm92KatVs1jAEsNv6sdymaa2g8+xUL4I+Pn2beCgbLGWHI/h8G3oTr45iK86POlbBU9yKI/AcfLR+ouQwH9BfmmbLlTHboOnZ/T9+5vaf8FUaAThXsFOQ45mUcgZCWTAxe0UQ+urYMO1/37GtxQmoLCBtRSp30LrDp2SFdzYMgk/R+VNwvwR9mwQDsaspGSfJgYDYNTbp8psCQFJxEIBkQjDrxt8dXCUIY+COH5MVFPi8SOn2n/QYLZ9Gp0cxANIP5IvAkzVzxivRydnKNzBa8fddM84b6AFyAriMF2pajk9kYIeoClXmA3AQgr5NQEHMBqMVFMNaIOayNRL/vhlH3RZwmhbQQUcAasrVVGz4EtjCu/3dfb/ID3PbT7uKAZ/MhcIC0vqRTo4W0IBIEAmEtFwCYqjW03bcmdwBYeoWgetUbrR8snrloiR2drpACf+rD4D9EvTVjIJu7HBV+781X752Czj9lwUZkTEgcPoNPp5Nv4oBRhCG6dd+1DkMz1JIhR1BAHJ7zwqO3fIRRM5tmDK5CoQKsSgOeBYBKFZULTqcB9r6Ni5KYmd3WKDUA0BlhNLM8EbT1QBXBU72aI5ZjUcVOxz7WLkQ8d37vsart/uA6RcPsxNSAtAXHDYNC1AEpf9s01kKwuBwGU7HgVt/1jtD1e60fgQigSe/j5bQp+KYpGB+H62jT7P8/ZypBIC8Dhcx8eY9wF015abhmnoAyJ5WSrKeNgKO9SHxnT/LSasJBim5lRjWBEIVeROInKL1qunybRawLgASdEy74qjaNNzJCgqEEYzBGvK0297mAFSHEIB6ebKDgc8J1ksmV8t29f1en6L5v6cxIK5iK6Xne/5jCTiFcTqVn/r/tWDPWwXnEPTVgIKUHU7ljASawKefIwDpMdRxRB+wFgD+RREDJABpwSzz2c0LfxczVjkVKwaYgtBBezu3SvX08d39P5uO3QKahXMQciourZRAGKZWar/YZ1xXRPe8wQr2AUK7TvbOVTZBXx4MBECRnConUBSFEXT6mf/TK+/qmzAF/0UBOPqBZYF52HrTFCw2LH5G8UCzJEko5nZqmRnPh/uCXmpnVpDTsIPPwKApOaSA2QLDLSHf97iPx0tpISLfz7bl4iFfsUsnj+HZWEeOYDCDnDmCvZkEgedcCjxGseIhBYt3vx049HwMLRh8gA9gh2MoH9ABqKJzxf0McO7XlSAU4HzhYYFq+5D7hwBu/98OQLlIBCKnW39SlXNY+nqeiq2dkQg+gnGPb9/ZpT0lq6MV5D96gLCwgDmCwbdnCvZmCgY/dxy47xxg5SWuUjigYPHFbwA+fyGwfr2rXrMvPB+vp3L3GHCgi9JOHQCkRVPppeUBigXLFymyejYTB4YsgfA20ofRAlYB0FfAlvQqP0/TsX5PLOB5DNu471cmIwiBaRww/F01J+mz2pqChxUMZvpJlmBv3iTocsW4dzewfhkGFix+2febXDAeJO/YEILBB7pU1g8LQFo98QASVGYNQ6DZfEG3fnEqrgLhbf/HV15anbkFNCvohWSl9XPQ2XTM/2s3I4DwPIZwBEDfgitH0Ek6N6x+u/iD7T4g/YdBBYPpWHEaHlqwNw+AQa4Yj54JrJO+aQDB4pt+oCAyYvOPEIQDCgYfeF/9U3AbAMX7ItAlVtAspKZdz5SOlvA2pstxjES3wJ+92NgAGK2gwi78QoVfEhBeQACqNNP1RdoA18kKdgDhxkUI/zKIYDCnqyzB3jwAJnLFOEIW7QEEi1/1Y21ywVglCAcQDD5/Efj7M4CVrZ5AKlkhxeQUaxBI4nvFzxf8IfCVC4HV7cC6ZEX5nen3VX1vAGLZq8ysrvHY+QBwbGfI2E6JpLvdX+ksthpUvQrmX/sVDGZVUJZgb17vJHLFeGQcmCdVb5+Cxd/5xjZ6QzzMLOQBBIOfTV2Ps4HFHQ7CLQUQmUrV0rgKJMsCjsxGAqTn/hzw0EXA4tnAyg5gbTYBorKkUyLnkB9YVhTxu+kT13iccwtwdBewPAus+b2ar9xJAafqfgMQO4dh+J9+BHe5gqZZZzYok1JJUcpaR6bp93P+W/N6p0KuGIemgEWKgPQhWPxdP7NBLhiHKYHUp2DwpZ8rLOD8tmJQVplOLxAqmbRKC6EDYC7/CeCRPcCx3cDSrsISrs04CPm9ArZk55UvKAspYLqPaPdR4/H0g8DRHcDyVr/X6VabLHk2PhjpPVZY7d5xwF6CwS9y/4LbbVyQsEKIufGiKe0p2JvXOx3kinF0GjhOQY+oNRtljji9TQPf/fOV9IZY4Gq4D8Hgy/4W+Oo2YG5bUUy04vUcLCqSJVRWszJbNgxSmMau+q/Ao2cBR88EjtOqbgNWWaTkIFz3YiWrF4nAjtN0nBZrJnU+/8PA3CxwfMYB6LUra3oglL0tps6wlVha5rLiqd9AdDfB4Je6U0s/0BXTDYh80Sr2FOzNA2AXuWIszABL1JaKWq1R+nwGeM17OsoFY5XTVw/B4Cv+Djg0C8xvLYqJCECzgsxmZlq9T8e0XGUyaUizavPtxoFr/zvw2BnA0Z3A8e2FVV3x6c4sqwObckeyhiXAowUSADhD1XhceDMwx37lvU4XxVN2n3rJIocygkr/Vbs7fe+EdBLcfaXXQ3IPWIrpBB6XlnwpR76jYG9e7/SQKzarxM7qJFj8mg8UarMV9IZ4gvNDD8HgKx8HDs8A8zMFAFnPYQPDl0Co2g4fpDZLqKCxT0/7fhJ4fCdwbFvhRiwRgJruCOwUgCpeCvUjZmEFxhfk9W969kW/B8xvKQqnVgg+B6CB0MsI7P70AHgmd2n1NQ0rv7FvALIlVYK73MnQCDLThSGZoDpuP7uCeuX5n8zroB5yxThGnQ0CgyBMxY63Aq/5aBHG6EBviDlOLV0Eg1+0AByZLgbl+HRxnZXJoqqttA4ODovlJZVuSjTQFtq+NwNPbHMAzramdVpVs6wEoPtdNg37wJfvsYiJP9NFqvHY+7vAwjSwxAeNxVO8T6aNVRRRlT6hHrJ0Ovaw0WDJCKng7g86APvNB9wg2JvXO33IFWOBgn8EIf2nRLD4tbe1+AU7yAWbZeskGHwVdd2mgAUCcNKnJgLQrZ/V9/Jnn5JUYmnAE3hCmv3+t8AWQfSzyPK/POOgJgDdsgqA5nfJAvLdLV+bz0kK4RqPZ3wQWJxyAPqDVhZQyQr7gyaXI9axWCFVAGLvRUhV46PgLnUWBs0HbBPszeudPuWKsTRZAJDTo8l8ui/42juL5veQC7ZpsEow+OrZQlqVVuH4FLA8WVyDAOTAmHUQCAWQkOlsQAwDt/9/AE8SgPQpNa07+AhAA6HLXbb5Xr4IaAMfv/eGvP5NzyYA7UGjBWTWjh40v9fSyscHLtaxhJWxFVsNNAXH1khw983+DYPmA5aCvXkdNIBccemfceooAfhAAcA+6A2xLuAGucxrzgKOMexDfV9OwbS2BB/BEoqLSrBoYGgJ3E8qLcIEsP/ngCPuUy7S13L3wb6PU56/m/Xj4Ps0TKCXQA6AXuNeZY3HMz5QANAeND1kwcKXlj6wOZQ+b7R+Pi0PD0DeFAfk590CKg8qncfoFzIRVWVqfFfBhgn25vXOAHLFWCDbvPstBsJZ4LUPt+jdesgFg+qVptWq11bg2gtgfuLiRAAgQeg+oEmsOujsXb5SsAoCIN/3vx04OlNM6Yv0tdx1MKvK7/TFjVmeCD4HQQQhf159eV7/pmc/kwCcKABoeYvR0oept7SEoZQ0Tr1lPuPQFlAtO0nyAcWhpzw/FSjFzGjLx+RGvxzoSeC1hwsA9klvaFN5FAy+9mJgnhaQ0qqagglADo4c9AhCDpJPl5ZommQ8738HcGw6AJBW1VecZv0cePwOY0/wl1lAD/WUCx0mMlDLr8bjmb+Dwp3x4nkDYbD0thIO5aNtfmDi/xGEeRawxhs7Vb/q2huABQJwAlhyy2cC0xoggjAAUCWWAkksOiIY978TmOOqeqqwqAx3WGhHK06n7TDwOcAV/iipPAKjwgrZm2o8nkUA0gKmAHTrp+o9MTrEYvq44o9pZIOtgmu8mafCV72YAKT/RwAy5OPOuVlAAk9Oule6xQRTWUKlWtkU/IvAHAHti5oIwDK841ZPFtCmdr0U8PaC9hVultd4CIC8P2Ztt/m5/qC11TJXlJDGGpfGAmYODgFoCxACkLpuWh3KCgqE8gNVZK4KtxgjJAB/2X1Krao1rfN7CWZf3LSBT4uAEIyWBVpipL7GgwA0AW25GbGENBTRx3rm1M2w39mmrFVwjTd1Kn+VAZALEE5LtIDyMWUBvbLNLGHgd5H/V07BDp7r3uU+Jadgn3ptxekA5MBri0/Wp4wzBjDbCnkMWMqVpE8GJwLQqvfc0pqbkVj5aNk7gbCxgJno30cAjntowtXNaZ1suvSKNhsYTcVKmw9F5xGE+94dfEoP+JYhD/8OC8eIPUsUHokVVKB78XszbzAF4Pvd//PCKVGIpOAr78mn4DZOm8YC1jco+w6EFTDDPJqeCEBZBa5GffVbhmQ8DtZW5TYOvPhXip0GTuu22lTMLSw+aAVl9QhEWjurI/aQiLJkTMLsX9R3r/ymZ73fp1+37OU9hunXSkdl7T3QrhKCtlCM59k2i5CMMSIAGdqxEIwrmptzTsCEut5yilKoJLAcxCq3fe8tLCDBFwO+tKjyuxSCMdYEXoeDrHcHvu0tTwLzmwHA4N/Gh6zNCqqeOSxC2lb8tQSiMwbuqXIqAcjFh2JjBKGJyShQG6ygVbfJegULWBYcMR3rvb6oCRaQwFPgl1M5rR7/JtBZOIZWx/0+s4QeY5z/1/X2tFnAxPpFELaVkdLN8MWGVr4pCBsfMHN8bmTKfCjZ0Ncp456/x58zLzfw6Qf3ABd8pUgEYmqk5bGyek06IQl1bkXScnlN/u8L24Gdx1qVq91KQvrpgwaAAw9p+wnXPw1YjyWMGtDo2ASOFGMU7SIEUzdYD34vMPmXwLbHgdkFYAtlGiim6DpxJtvq9LtlVr/aWKEB8pUXAOOPAFPzwBTZ9r04vdQ9Ts4pAZ3cd+yHxgfMAOH+vcA69/9Uxijmz/AerYpdar1lNSMYzV+vWY/34I8DY58Gph8Bpo8A04vAFEFIknIHohGVR62QhFRSYjQE6qFri2z3iaPAhHNNlxKwArI0Q1IAxwfReacbC5gBPp66/5ICgLKCtqnsrKKlrFZUFPKOr7osMTtdsxzqQRZ93Q1MPARMPllohUxRqkEK6gShOP0S+dY2hlRv99y+ovRi7IiTnTvLqmg6xDPYpqAUgRgsoR7MxgJmgHD/c4E1FXu7FRRbvEgd7evXWlbPpp9EgUjiJpwe6zwOMlvpAWCMVusJYPIYMOlSDZRpoGiNxKzbdIQlXONMWJbGtw4svdgz3El47nzTRvPrrKptAJT6ZrzfintvAJgx4vsvdQvIXK5VYF3sUZxmJUvgA1FOvwF8spKyBtM1y6EepI4LqVMedbEaTp0EIKdPKh5FqYYqSxgo2jgFr13j6XXHnOiSZOeBVSvyC8qC2r05FVvVw9cAMAOA178AWPMp2LJaaekiCPXExwHw660n1oB/niGQazwOkkSepbJ/72I1x4CJ+cJ6lYI1riccrVicUuVSmIW82pkwnHHVOKbFsOozQGkFkwewnBES37ABYMaAX39ZAUCCb82nIlo+40p2gNnvsoKunxH1xGwA/LOzdQOQJPIuHzV2GBg7Cow7AI0l33XfjOsv6oVodes6ISbBsAZMX+kJxU56KY7pkmFVhOciuvTzSt05v0+ryuT/9gDrZNe4wPMsI7VJP3GcP7gUOOdvgL1rRYJ0ZI5IV3hV4/wrGYPPU3/AiRhYusy2K7mU999P+z90ObD7LuBZK0Xdkeq9NSX2+o4HLwfWlopFCC0fgciBMtAFC8CGrYXVoVjnU2G7rTXrzh4kfRzLY1kyGwBoeiGcPiXb5eAzdXWnazPCSScb4j3xfmav8Cx2p50lAMW0VXINitCogl2r9H2dcctWwQxQsn6ZTBbMNtcgdKIbiZj51VcBk38CXPxoQcfCUg8pjcYgZScw/momACnXyr4leBhs5QaBTHpf7X8dMPYJYO8XgAv9e8QJlAZZq8D4xSuANYKPJQn0AR2AHKy1MACKe9nfFI6IEqduEWoHIJ9wlsVKLekoMCa9EAegSTYQeM4TXco2SEMkAHEbBZoj4bbYtdyCVrFqGXgTSxgXYTZeHLi9AMjEQRCVUXP/n4KUaaT8vVTi+Rtg7GPAuYcAWlMCgUVkQfJ2Q12yBvPXMwHImhDWwf81imsTiLSEvHZkr+jY/p9CQRD4p8DOBwteItai05qn31FFdfLlFxYWgCDUIkRkj/TxbCEi/89jfPZ3X2VqYSJQbmUNQY3HQT7hbv2sLoerVwKQHNEEoCsm8R4MhPRjXUGzVEIKIoY7yaEYuY4dgGb5RXruoSgtSCLLarkICQ9f6QNykGjFdjsIBaI4kGlt8W+Rg5g0HJ8qAp47nihAzFpuWtPIMBZJlASILvR6fQ0DCVbJCkJOJCqnk4pGpb99tZ8MopyiKDX7WWDiwYKXiEQOehCrgKh+eJQ+EQHo1Lby/zRlyf8TIbf9XS5ftIb8I92YugH4ay2pLusorl7dAoonWtMwQSTdOFuQSLTGHyIC8kxSIQuA4hwU2WUAoO4/grBcDbsfWElSzg+JCoYDoEGM1ixSkHzgF/wG7y8sIa3J7JPAGWuFJSQIaU01iJHUiYP4e33BrPOHmG/JMaOfTZVYRhwGav87vWKPJ9/rSH4IOGO5sITqg/ggxXs4TOaBAECbeoOsgfl+DrQShFqcEIhyyt0MbMusEkx76iAZXKM8BvXiZAGlF+KaIbaadYpem4aDgpJZQz6YJABV5VcHAJZ0v4FxX6KG5UpYs0KnqjhRuagEVgPglYAl9ciHf8mdUrJh0Qx9vkDBzBywfbkYQIGwahA/kglATsHsDzKA0BATiPyZ4NEDwIeoa/uFYKKXL2f24nQoIgd9R3yQCMTFqwIAfdBWI7+yB5ZLECYLETd85YJl+2YAUNosLIel/xYlu4Jsl6bhNhD6it4WJCvA2Zc4Gxo73RcgJeOqFmGR6rcChLYACyGojmEYdj59KnZ+tIQRhH9IvWA2hiREjDeRI9Cly7fMF3EtWRFawhQIf5IJwE56wdTIYdt7tp9ys1K8JnoJvod9Wn682PNkP4hUy1ndWgstAtBDMLYN5/6PAc5DGNoF4SrZfN+4+IhT8jqwg2Cp8ThIJ5vfSWBXAVCrWN9SMxDK+skaOvhoAc8me654pmUB3f0wyt+E8FyRAGmPlOEoiSD2qgvmAKoOm52fAuiTDHSyIRxx+lI0QxxADubfF5vffMmSajrWlP7nmZ3dSy+4r/ZzAUEHnQ8R70HsXlK+PgJsW68G4XYGZj0EY2EYATCAT6tAhmE0DXcC4faapcwMgAIfLb0kuzT9Qmw5uwAAIABJREFUSi+EfeALkSrpBovbrQDnkm8wAo8/E3i+CCsZ98NCpAp8cUekZyBavI4ET/TnaAk/RQCyAXy6uNSPA0i+wMeB6ePA5HFgZq2wpNGK3FUDAHmv3fSCe7afX8CB4UNEEOolVi/3obastNwJ9cO5BOBKEQMsAcifHWzRAigWWAlCn5K2bQYAOe1KMjTIR2kRUhKVS7IrLia0v+3xwHMZMCbYNP0KfG79zAqK5DxOvyEuWu6VD5KSHy2YAEQAfpaRdl5UkuUctIpBnCIIl4psD03FtIIP1ADAlBuJM47EqqUX3LX9kSBQcuuyftK78xUkHyQ+RLqHZ3Fv1KcgLj5kAQ1s0Qo6IA1nHhNLQzA8ZxvBXuNx8DcS5UYpNnoYxsCnUIqvZo0F3wPTMa7Hv53HOJVbS/l+5bumX7d+5WLE44hxIRJB2NMCqj9ixwuE90svWCaIA6bAp959EKeWChAyA0PTOV2unGMQveCO7bfqHbcS4rJR7Ewqnw5AWhLuImg2uFQAXAVs8RGmntW4+g2hB3P79L/EJ9zGvqrxOPibiVihAOgrWQOf/EBfBcsPNBBqW9Hv6zzGqFzmoXz3B9AePgXiq6bgiv4YOB9QHS8AfpkAFMMjrWAcQA0iO9XJiQyAnos2vV7ESHOOQfWCO7Zf7F40mZFQScRKAYBaSU6vAVcTgN7xXHiUFpDTMK2dFh56912BTiDcvpkATIXzCL4g3WXTZ4jpGfjoF/oihL+fx+0yWUABLwIwtYKKIabgCzHQvi2ggBKn0McEQDaKT5cGkIOo6SuyYzEfjQB0EM5nZgAPoxe8of3sgSqCQM3jkdFLvpRvR13+7UVRuhUFSavNO6otwp88ZZ3+t4M6HLtch6OT9AG/q9cmtf//gV1JDYcnQ2zY6/YakfSrU+Pg1M45NqPt3IEtoM7WFHokyrWKkooglCMWLYjiUXMtK3g8Uzd1WL3gDe3vRRCoUEYCwGtYFxxqgA2E/jI20F5hhmQod98BHNnlxOTig1aGiDanO21yV4DygWuB8YeB6fnC9WEtiKVVKeE0ZGiXWczeJoWMIig5a9V5DA1ANoKDeDylZ9NSXxyAsiKawrQqmCv2HVf5e8aRoxfc1n7xs+khItAUvojvyWryxVcWJZksVSyZoQRA3dcAoHzax4Gj2wtu6FVKM7gMgti02jbV476oUJJs1j/AbA1mQ3Pm8eTRsoZDtR+xZKCiEKmMXTIeXHPGdhYArX8FwG4DGMEnAHIK4yvT58nWC2b73cexaZgWWaEKgU1gjNbPP7PvOYGsUSBkv3hBtmRWNzxjTk9RWktvxp6POj0vARjY9sWkFel8RWxegjIF4RjwAOnZWMPBTGjqvHmszxJOBUD3xyznL2bqROvoP3N3q84jG4C7M/PpcvMBef0cvV9k6hXv+2Yno5QfGArRbaCC0mWv2YtF3ecerNDhkNZIIsXQRv5dlTtGADJSz2gEE1EJQM//026HdIEZLC8B6A0tk0g1Ja8DuzJdphS82QBEZj5dbj7gxZN5er/IZI+67pscgE7QaDOUMyC0Wb8+gXjuR4F5J6YsaXnFhBoAGEVvUhb60jISgCQnoh/OLBgvIrL8v7DdFkEYM5dtNg97tvz5zJqzdfIBmJlPl5sP+DJP5xtW7xffnzeh7H+Z+3+RpkyWT1YxuURJYVtx6T0fCTocouQV85VkHRIGegEuEv/YKpkA/JceVmL8kv6t5/9pu62tfiPWcFQVEa0DZ9WcLJEPwMx8uvfnjT9IgZyj94t/ldeA/S9tMaGa9SNdmsIxbvVscVJ1GScoMt4UPwhAsmMZ0aXzQBsvdGRBjQz0FUpEJRAJQOq4KAnBdz+sfiPJ3bOYn8fsykyVWMfiN3BOzckS+QDMzKe7OW/88aqQzsfE5kH1fvGjeQ0wADodmVGwOeiMsUqHrGOnS4UFy9P/wAEojkEnI+IqOIJQNLgpCXhcmLAtD/D+kgQE235L93tj+YBqgTX9BiCeW/NedT4AmQ+YkU/3sbzxBymQuZhm8g1T+QbV+wWFdjKO/Te2mEFNlCb6gPF708VJ1TXHgKd91GnZpDfi1k/gM2vqU3DUnCuBmNQe3P9vw6pe229KOvB0K1k+ZS+rnrfM2AlA3JMZtah/EZKZT3drxuDz1O/yxAwu9JgJxr3lQfR+8aa8Buy/wdWQZAVl+ZzCrG3q9c/YrkmHy3IRYryAAqAkEBIlopJxNNUbER+fA/H+/+AAdP9PmS9dazicJybm7mlB8nR2dI1HvgVkOlZGPt2nM29GCamcGZjAwlQ+vvrV+8X/zGsAAUiLVPp/wd+zaTMFWw+/kAA0GQQnpCw5mDsAMIrcRB5mC/+MAffTwgfwKY2KfmCZ6ZIkUShrxXxBX4yYaV8Hzmcn13jUA8CMfDqWYeQcSkhVOl8U6uxH7xekrsg49h8oiCENgC5TUG5vKxxT8f2aRtOtcAKQ1s8soPuOVUIwpchNlEEIOyNSIrrvv3hwnckWIZPZsnbcDyzTpvg3lU8mpZQqozyfK74aj3wAKh1LgrsD5tMxiz/nkGD1sHq/YNFOxkEAcuW7oqmXlisuQOT7VV2jwi/kTgj1RkoZhBje8Z83SCAEEJZW0C3gff8tADCt4VASaWIBK0HI9q8BF5yUAMzIp8tNx5Jg9bB6v/jdDPSRns0BWIZeUitIo9IhHmhXTvzCPQddccnZ76U1V/IvC4SBCFyg26DFNg7c++Mhhb6qiCikT7WVUmr6lYn2nRKyrdZ51GMBlZIc07GUBdMjny6XCiUmpA6j94vMZbgBMFo552pu27PXAqXTyAUQcitOQjAm9xX0N9pIwIPmSCmH5QuPqER0L4kDYgp9zOUL6fYxkbZcFceyAreAF3GlV+NRDwAz8uksnT3jiILVSmpWNlhMze+k94vMZfgGAPJeHDjpCrgM01Tdry9OzvmYAzAqLVWIwEShwzbRwwSEn+MqP6bQK5tZlWyhjCCCsC19Xv7gOnBRbgp7cu/5AOyVjqVMmA75dJZ9nHF0yohWNlhMxKnS+0XmMtwAmFq4imnYbrEqNJPc+9kfd62RKh0On8qV9hXZ9askEPgAfI56ziocUgVbzGT28lEtRMoKtg7lBHtznfZNA+CQ+XQWM8k4uglWK/NLYKzS+8U9GReXD0g/Tyvh4Ne17Yb4Zbr6g6y7/aNWcoPpjKRTsJIags5IJwkEAv6en05S6GUBfRWsUExZyVZVQCQwrgN7Wfdd41GPBczIp8ODeXfTSbBa6YYxlY8/p3q/udc3C+jTbtvqt2oadnB2m4oNgMn0W0p+hYWHWbwg9yU/0Kb9EIy+5y2hiCit4UgKyTeAkN8Valk4Le/ldlONRz4AWWBRM6fdIPfHstw/G+SE5rMnVQ/kA5AkLHS0ak7V7reXfhgACaBqDtD3e/nmc5k9kA/A80JReq+U38zGVp3ObJo/BvAOD3dtwiWar9zEHsgHIGlFubqSx7+Jja36anLLcDvvgwA+NDpDfILv+qlzuXwAXuSjrkKemlO2e3U1uWUYnL8dwB/5e2apca9LNv+vsQfyAUheX4VguB+mzIsaG9ntqxhF4Xbe3QD+n7/uHLAW9wQ1tblMRQ/UA0CaHC7plXEh+q4T0OWcfhleYTSHBK0EH/mi+fcRuKQn4I6fWpeoB4AevCz3HOOm9yb3F5mBlZBNclYCj1aRfyfrbgPCTR6AzK+vD4CyglX7jpmN7HY66d1E0ctdIrEEE4wEIMlam+Pk7YF6AMj7EwAVbU82vTerCwhAXopJN9zVI+AYrOeULLZgErY2x8nZA/kAJGWr0naUWdFpy2cT+oCWjpdjLFxE5UzYIBBpEUX5nLnlvAktb76SPVAfAOUHpiAMm96bsVtCAMaKALICMyxDq6cXfycA+b/mOLl6oF4AiqBRIEzBp7/X2Af0+fi1XIioMIlAI+AIPIGPmeROWV3j1Zuvyu2B+gHoFfZiDS2lC0LiY52WUADkQoTTMH1BFSYRdHoRfKSu5v9qrizMHYPT+vx6ARhSuDcAzzmDo5ZGHT1PAKYMwQxME2jiSo/gEwBrrq+u41ZOy++oD4BaCcsXTPiSI3ey8s4KGoG8QwCMFM+0ggQhLR0BF19SXuD/ayakz7uR0/TsMcxg3SjfqWNA0hsrga/ojaq/8WPcC+YIk4Ke4CMSuB2XVht1Oj8zIfXlU8BtU8DhmYRXWdfrdF1fgr3+S8At48CD04DVjXQSDO70PTUnaJ5uOCwsIIFHSSFy1pKPWCDsZxCpw8UVgKSPxLXM937OzxxAljzcPAbcswU4Qh4V3UN8mKoeKm/bu78IfKJQa8VD48CylHQiL3O3/qg5Rf30BKACMtJXjXKQcfBSK8Dfqc3KVCwuN2VFGRnm/yKZtq4Re5ifyQQgM2A+BeB3GHaZBo5MAIue0l7Kt3cC4xhw+5eL7TuCkJk1jBtyerbUfYG5ExjZ/pqrxE5fAOrOq5SmowVIrRp1IyT2R6+fg0bgVYG4CsyZe2UsaiOGKXr4Sfp9k8CxCYAFSKyvXeY1o1BxQux91yMtfsHPutgnnyUuUvhc0ZsgUXib+nVkq6+ZKaABIHsgVZnuwD9sVo66rrR4ImdhLGSQ8zPL/JgBQxeU1ouWkO9PTgDzbgmXxrzMkatl3keivfG5x4r4IRcz5BfkO5vEZ0kgpIfBZ8yKjlL17syy0tMNcOn9dl4Fy6dLFabj1Mpvow9Ify+I4Nlo9Xt+ZqU9VdJpqZh4QDDyxUyYOYJwHDg+DhgI/WUVZl7aSEt93+GO9Ia2iuZKOfA7lhp9JpvAVy61w2mOwO5hmCgMHC1H9O24gu6UD9jP+ZmbtLRaSsei9SL4XDPbAEh/kGQ/pSUcc0lbApFWb67lQUhpVnLBsoKqqZclFMmUtrxPcwxl3X7vOCAtYLSCcugFQmqhdssH7HU+RznjiOlYXA8wqkOfkItTAom+oKygca4ES8jY+N3z7fSG4hfUtp3ihUHruVSsFy1iRvNP+1N7A5BdJACmVpAgZPhGOyCigEjlPLudn7kvFtOxuB4g6OjD8UWLRkCZFRwrLCEXJQQhp2K+37lQeBCRX1A7KPQto1prFEmSYn2mB9EAsO+kYfk8KQhZF8yjVz5gp/MztyOUjiW9bCUhEBhKRCCgSis45uQ/PhX/xfFWMgOnWu2gxB0TF/o0kEZ/kCDM1Ts+3RHYnwVUL6XhDFrAswfIB6w6P1MrTulY0sum1VICglKwCEACqvQFCUK3gHcsFQCM/ILayqP1k9JshVqrncMalOYYvgcGAyCvIwuod8YBJQmZpmGJeyRwkGw4n8jJOJQNw3idLFhMRNB0SgASTJyKoy/4ieXCeFfJBUeV2SoAclFyR0bbm1OHTUiN0/DTAwD7zQeM52dqj8VsGEkVE2jKetG7AEhQ0frJAv6RC0trC1skl+IWlNinGLbSaZg7Mc0xfA8MbgF1LQV1z08A2G8+oM7PVF9Ms2GUE0gQyp+Lwu2yagLgR9ZaYpkSypQ6a6Q2DCqzpkvietXIFdoZfuieGmcOD0DeP0HEbBhNwYPmA/L8zJQsATAKnguEqS+XTqkE4YfWWwCUFZTksYAYwZfIBeN9Tw0cjOwu8gDIZqsoSSvhEeQDiiGYFoyWiSDRypWgi69UP5sc5fIcquSCNeXqe2X9ZAHfM7Khe2pcOB+AT41+aO5iRD3QAHBEHd9ctuiBBoANEkbaAw0AR9r9zcUbADYYGGkPNAAcafc3F28A2GBgpD3QAHCk3d9cvAFgg4GR9kADwJF2f3PxBoANBkbaAw0AR9r9zcUbADYYGGkPNAAcafc3F28A2GBgpD3QAHCk3d9cfOxqYJ2au9RdPtdp/khoEOlglDYT39V1PzQFXLsMXAlgt9PCxJKPbufyf8/KHIPfBPAZABf79Xc5XQ0ZQ1Q7360NbxoHrlsDvs5ZRsgo0une06by6X1mZvtP99PNAp4F4LsBXA5gjw8EGTeqaGF4QhzQF80CX7cAvGIdeDYAfhdZ2sTKUcVrpE7nd31N5gj8e2dIo2osk7NZpMdK0Z19tv+bJ4F9K8D1ACj8yfNSikHeg+5Z969m57Y/8/ZP+dPLKZhP/rcA+AYAF7g1oRUhEMUzFMt6eSJfX78b2DkPfM0i8GIAX+uWlAMppreUUErn8p2gzTl+2flg/sDbTkvIOik+CP20//mzwAXzwDcCuNTPJeFXpEpM6QEjIHm/zTF8D7T5gATYNQCe69aAloRTGulfBESBSYNyxR5g/Bhw7hKwZwl4vk9LnM5JmsBzUyDGAX3B8G23Mz/g9BuUa/0IiutfMkj7zwKmngAuXSvOpUvAWYBtF4BTnspIj/O8zPaf7qdvWITw6eZA0JLQEhKEGgxZhUj/dz3NzSKwbR44exnYvVKcy+mM5Km0JhxInUtrGkmzCPicg3W5LMGkQiZZTm9xS9Z3+4m2o8C5c4X15pTKW2Lb+fCx7WLtjYxzqiql29Icw/dA5SqYf6RTTilg+lYCIXmICKQ4IK9wxfSJY8AZK8CuFWDnanEua9ZTAMsaCog3Dt92O/MvnRGBtGwkqKRmMEkqCaa+2k+0LQDTh4rP88UHj74kF1WaATo9QHQ7mmP4HugYhtEKj4PB6ZQ+FS0hQahpldPya1kXTOqNY8DscgG+HavAttUCvBxInitrkgL4lcO33c7spBdM3kAuSnq2nx9gQfAh4JyVwvrxwel2z3p4aMlzH6DM2z/lT+8aB+Q/OT4EEqckWQSBkGD6EQKQnDCLwBSnYgcf32fXioGUFawC4esyu7CXXnDP9tOCsyD4KLB1rmgvX7zfbu2WG/Jtme0/3U/vKxBNAMoi0KcjkATCN3HOEr3UAjDrwOP71rXixYEkeKMFlSX8ocwR6KUXTJ7AaNE2tF8WfA4Ye7Kw1mwvX/yZn+eKnvcrfzC6IK/ObP/pfnpfAGQnySoISBqUXyAASS1AK0JfagWYcRDOrAF66TxZQU7jBOEbM0egH71gcgXSFZAV54NQtj9YcNIpbONCyh8Ygi8CVospApDuB63g92W2/3Q/vW8AsqM4gLIKBBIH8bcJwMCNMX68BTqBb8s6sGWtsIA6jwDk662ZI9CvXjA5A6NVa2t/IAicnC/aGV+8T74IQPm/AmGuBc+8/VP+9IEAyLslAKMV/LgAyIUInfnjwPQqMOOgI/DstQ5Mr7UAqMF8V2YXDqoXXNl+EQQ6N9v29aKdesUpWJZbAPyPme0/3U8fGIDssDid/pUASCvCaXgJmFguAEfgEXT27gDkuwaUg/nbmSMwjF7whvbLhSDL5TwwvdRqo9oqHzACkCB8U2b7T/fThwIgO01T1IMCoAZxGRhbKoAXQUcQTjkI+a4B5e5FzjGsXvCG9gdqrLGFYrpVG/UuHzBOw2/LaXxzbh43DKeoJwlAHqLndSs4udoCoIBHQE45EPk3DuitmYOQoxdctp8+rFwIWsGFYiFFoLGNchcEQC6e+OJC5J2Z7T/dTx/aApYdJ37AyJK/DIwvFxYvWr0IwEn/H1Opco5sveDUhSAAF4HJpQJkWixp6k2n4IYfMGf0amDHev2I8+l4/UbvNw8Eozw72wJePOJ8und7EkKj9ztKGA1/7WwATo44n45pWI3e7/AAGPWZ2QBkYHCU+XTMfGGQmYIxjd7vqOE0+PXzATjifDrKtTZ6v4MP/MlyRj4AR5xPF+VaqZLJF1UzKdPV6P2eLDDr3I58AI44n07ZMARbo/d78gMubWE+AEecT8e9YOn2Uheu0fs9tUCYD8AR59MpG6bR+z21gKfW1gNAz4geRT5dTEZo9H5PPRDmAzBmRM8BJzqfLiYjSKKr0fs9dYBYDwBHmE9XtRfMsIz04aQZ1+j9npygrA+Akqs8wfl0BCCTWRq935MTYL1aVQ8Ao1zlAnAi8+kEQGZTNXq/vYb75Pt/fQAcUT5dBGCj93vyAaxXi+oDoFLyT3A+3Rcavd9eY3xS/z8fgCQX/LPR3SOzkon55jg1eyAfgD8M4NcAPD6aDmBtB1e4NMDNcer1QD4AbwbwxwDe4UvRE9wHZG1gNSXDLlwLNcep1QP5APxzzwj9IIAPnXhT5ORc5EYCA9HNcWr1QD4AmRH6FQBMTSZZH98ZmD5Bh5g1FopiNns1x6nTA/kAvAfAEwDudnI+EvQxPfkEzYfaCXRSBluQMB7YHKdGD+QDsBNBH/9+AkAobqTADGK7Inw1x8nfA/kA7EXQt8kgrGAGMfBxZ5Cv5ji5eyAfgL0I+r68uR0QmUFoBQU8vfNvzXHy9kA9AORoMw7CdGQCjoUZDwL4kv/+8OZ1gJhBIjGDgMh3vTavBc035/RAPgD7JegjODfhiMwgoqeJwNPPTaB6Ezq/hq+sB4AcXeXEP+ZhGVo9vRimIQD5v5oPAZCupgDI9wg8/qz/1Xz55usyeyAfgMMQ9GU2Op4eAchpOIJQQEz/VuPlm6/K7IH6AMjgGzdl6QtyX5jWjpQFevF3lq3xf6yhrOlIAUgQCojR8gmE+l9Nl2++JrMH6gEgR5UA5KYsc+AZmCbQCDi+IvgEQMob1XBEAHIajgBMLV+0kCdws6aGu3zqfkV9AGTwjftg3JRVVRAtHQEXX/wbAcoXP5d5CID8GoJKvqDAloKOoIz/y7x8c3pmD4zhaqwjRzCYyQg5gr2ZgsFTLweWr8XQgsXjbwLWrnNtMlKgNoLBmZAa7PTCAuYIBlMvlWQswwr2UlUw45jdDSx8HbD+Ctd+HVCwePKbgJV9aASDM8Yg59TWFDysYPBtmYK91IbNOHaPA/M7gUXKXA4hWDz79cA8+W0aweCMURj+1HYfcBjBYO54MMY3tGDv8I3nmWSHOzYOLJ0LLPGXAQWLz3oB8MQUsEa16kYwOG8whjh74yJkUMFgbsNlCfYO0epwissVY34bsHw2sEIRkAEEi/dcU0SP5qhF1ggG5w3GEGdXr4L5134Fg4kAjuDQgr1DtDqcUmZETwArZwAru4BVqsv0KVh8/o3F4v0QXZBGMDhvMIY4u3MYhv95Zh+Cu1xBcxuOU/HfeDIq5cv7FuwdotXhlCBXjOXZAnyrO4BV6in0IVh8wStLuWCsUAyvEQzOG5ABz+4eB+R/ewnu/kOP/3G/l4kJTERlljQtIot2e53/IwO2OPl4FLtcnCqAp9cahT56CBZf+LpSLhhz1N5qBIPzBmTAs/sLRHcTDKbiNHdBGGymOC/3hglEvgjAnoK9A7Y4+XgiV4zVWYDAs/etxaubYPFFP1QkLtCIP8neaASD8wZkwLP7AyC/tJNg8L/xLNBu+YBdBXsHbHEFAINcMVamgdWZAoRrfPdXm8KitLdmgYveWAq+2y7iMqfuRjA4b1AGOLt/APJLqwSD3+y5T1yI0AoSbAxMMzGV1o8/My2ro2DvAK2t+GgiV4zj4+3AIwDXtwBrVJeuECze+9aW4Dut4PxkIhYsdetGMDhvoDqcPRgA+SWp4O4veQ5Uv/mAGwR78+6rQq4Yq9PAOi2fA4/vBkKudKVU7VZw77uKvWFuZbtcMNb5v0YwOG9g+jx7cADyi6Pg7gccgIxlcA5TKhaD01yYKBmVFpBZMfx/m2Bvny3t8LGqoqTliZbVI+gMgHwnMAnCIFi897cLAAZ6QyzFzzSCwXkD1OPs4QDIL5XgLmk5JHk/SD5gKdibd38VcsVYGmuBTaAzEHLHgyCcaokB7/1IkUET5IKxwF5pBIPzBqbPs4cHIC/AaeqvPL9pmHxAE+zts6VdLCD/lcgVY3UyWD0Bj1ZwqgCggXA7sPfWAoAJvaEtZBrB4Lyx6efsPADyCtmCvf00s/NnOsgVY3m8BTRZPZuGBUACdArY+5lWDqGmYbIrLHEx0ggG5w1OH2fnA7CPizQfaXqgUw80AGywMdIeaAA40u5vLt4AsMHASHugAeBIu7+5eAPABgMj7YEGgCPt/ubiDQAbDIy0BxoAjrT7m4s3AGwwMNIeaAA40u5vLt4AsMHASHugAeBIu7+5eAPABgMj7YEGgCPt/ubiDQAbDIy0B8ZYNMbkX+ZekpuIiOQrPar+xs889HJg6jZg5jAwvVZ8B+ll9PlO5/Fc/o+ECjnHfi8zYfkvM5ulmp4qJXVqx5deD4zfAkw/CGxdAZgoHfuh131QkaI5hu8Bs4Ds8B0AWLnIRGCBsFfn87JffDMwdjOw5R5g8giwZa34jnQQUwDo99wBfJ4TM7COiNdlaj2rA/jeV/vfDeATAP4UGH8I2Lrc6gc+SHqY4oMZ74VSKM0xfA+UUzB/oBUUCKMl6zSQ/PsXqZD5KQC/A0w/DEwcAcYXgYnVwppwADuBkefnCim90FmBWXwnK87Uen53BI8sbuwqaz9p5UgnQhBS+ZN1zE8Ak0utviCwq8DI8/nx5hi+Bzb4gJzKZE1SEFZZgS9/2pWR/gTAJ4HJQ8DEMWB8ARhfBsaWCwDquwQKvvNgHXvOcYVbPFJPkw+dDxC/W1Y4tWDpw/Rlgo4lo1T4/KxTihDNpJwj3/UiMLXemprjffC7eWpzDN8DlYsQDiKtVxzEqoHkyX9HRizW+nIgaQnvAiaeBCbmC0s4tgSMu2rMePAR9X252jXklaTFU108K0MHav/nvJ6ZxVVk9OI7GR2IZoGQNc/HgbHgIwqILIVujuF7oOMqWFawCoRxkfEIB5CWgkREBCNf9wMTc8A4QciBWyoGz16rwNgaML5eWKpctYZL3N+TWLX0gvtuP0HHk2n16JDyxXmVhfU0qywbJbr5GSuXKxA/sV5Y9UYWdnjwyS3qKKgarWA69Wg6fjQOIK0HadnIjPVFB+AiME4AuiUkCFnESyCSkmAuU7Cjm15wX+2X2ifBRn9A8mKcW2UFjULVQcgVDl80u40SYh763FfvquhLCxitoBYUsoJfjXKttByMq9CKcHn4sPuCbgXNJwyWkECcz5Q376UX3LNncZyQAAADEklEQVT9fFgIJs6lBBwtn3Tt6FpIz4RWnuQxPh2XIGzm4CwQ9hWIFgBTK0gQHiIAJddKq0ELQh+KL1qUR4MvSEsoENIKrgALHNiMox+94K7tl9qnnMio8MSf6SNwGpYVjCDk/Ju7isq496fCqX0BkDeqlWwKwic1gAQSpzGREnFgREz01eALLvvq2Kfi45m6cf3qBXdsfxRbJMho8dimqOhEK8cXQRr9QVpvPoDNMXQP9A3ACELFxPh+jACkP0fLIKFCCRRqKuPUdqjlC9o07JZwKVNHeBC94DQcZO0XAAkmgotAk9QYrR9f/BvByYfMSATDVMzwTXMM3QMDAVAgVHCZ7/MaQK4QZUHiNCbBQlqUw74YCb7gcmYkelC9YFlwvVv7RRAorTuBkECU9asCID9/x9B935zYzyKkqpfiNHxcA0gLQgvBAaPVkCqm3h2AtC5m/RyEqzw/4xhGL3hD++MmslgqCbgUfLKAcRrmTlBzDN0DA1tAXUlWcDm1IOIIJAjlT/Fd05lbFQFwjdtgGcewesFt7Rc/Gx8iWjUCjGCT1YvWT1MwgUqrf3NG45tTbcu0aximWx9xENcEQHGbcYAEwtSXSqY0gnCdgeuMI0cvuGx/FUGgFhwEYrR80QckWN+X0fjm1DwAWv8RgJFilJZBznz0pQg+AZAAlVWh1GvGka0XzB0cCQi30aSGVa9AF62fLOB7MhrfnJoPwPER59Px+o3e76mL5Kwp2G57xPl0kxc3er+nLvyKtLmhfUC78RHn081ONnq/pzcAR5xPR9mRRu/31IVgvgUccT4dNaobvd/TGYAjzqejumqj93s6A3DE+XRUg2VSCjdaGr3fUw+I+VPwiPPpqJjO8J1Nw43e7ymHwHoAKMFd7QErAeEE5NNJMb3R+z3lsGcNzgfgiPPpomJ6o/d76oGwPgCOKJ8uKqY3er+nKwBHmE+noqRG7/fUA199U/AI8+kEwEbv93QHoEhZTnA+nYqSGr3fBoAtaiqBUImdm5hPJwA2er+nKwBHnE+X1gUzSbnR+z11wPj/AeCpPDD3t7rvAAAAAElFTkSuQmCC",Sze="uniform sampler2D weightMap;varying vec2 vOffset0;varying vec2 vOffset1;void movec(const in bvec2 c,inout vec2 variable,const in vec2 value){if(c.x){variable.x=value.x;}if(c.y){variable.y=value.y;}}void movec(const in bvec4 c,inout vec4 variable,const in vec4 value){movec(c.xy,variable.xy,value.xy);movec(c.zw,variable.zw,value.zw);}void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec4 a;a.x=texture2D(weightMap,vOffset0).a;a.y=texture2D(weightMap,vOffset1).g;a.wz=texture2D(weightMap,uv).rb;vec4 color=inputColor;if(dot(a,vec4(1.0))>=1e-5){bool h=max(a.x,a.z)>max(a.y,a.w);vec4 blendingOffset=vec4(0.0,a.y,0.0,a.w);vec2 blendingWeight=a.yw;movec(bvec4(h),blendingOffset,vec4(a.x,0.0,a.z,0.0));movec(bvec2(h),blendingWeight,a.xz);blendingWeight/=dot(blendingWeight,vec2(1.0));vec4 blendingCoord=blendingOffset*vec4(texelSize,-texelSize)+uv.xyxy;color=blendingWeight.x*texture2D(inputBuffer,blendingCoord.xy);color+=blendingWeight.y*texture2D(inputBuffer,blendingCoord.zw);}outputColor=color;}",Mze="varying vec2 vOffset0;varying vec2 vOffset1;void mainSupport(const in vec2 uv){vOffset0=uv+texelSize*vec2(1.0,0.0);vOffset1=uv+texelSize*vec2(0.0,1.0);}",Fp={LOW:0,MEDIUM:1,HIGH:2,ULTRA:3},lie=class extends fu{constructor({preset:e=Fp.MEDIUM,edgeDetectionMode:t=WC.COLOR,predicationMode:i=xOe.DISABLED}={}){super("SMAAEffect",Sze,{vertexShader:Mze,blendFunction:Gi.NORMAL,attributes:eu.CONVOLUTION|eu.DEPTH,uniforms:new Map([["weightMap",new ct(null)]])});let r,n;arguments.length>1&&(r=arguments[0],n=arguments[1],arguments.length>2&&(e=arguments[2]),arguments.length>3&&(t=arguments[3])),this.renderTargetEdges=new Ni(1,1,{minFilter:bi,stencilBuffer:!1,depthBuffer:!1}),this.renderTargetEdges.texture.name="SMAA.Edges",this.renderTargetWeights=this.renderTargetEdges.clone(),this.renderTargetWeights.texture.name="SMAA.Weights",this.uniforms.get("weightMap").value=this.renderTargetWeights.texture,this.clearPass=new o4(!0,!1,!1),this.clearPass.overrideClearColor=new Yt(0),this.clearPass.overrideClearAlpha=1,this.edgeDetectionPass=new hl(new wOe),this.edgeDetectionMaterial.edgeDetectionMode=t,this.edgeDetectionMaterial.predicationMode=i,this.weightsPass=new hl(new POe);let s=new h$;s.onLoad=()=>{let a=new jr(r);a.name="SMAA.Search",a.magFilter=Ci,a.minFilter=Ci,a.generateMipmaps=!1,a.needsUpdate=!0,a.flipY=!0,this.weightsMaterial.searchTexture=a;let o=new jr(n);o.name="SMAA.Area",o.magFilter=bi,o.minFilter=bi,o.generateMipmaps=!1,o.needsUpdate=!0,o.flipY=!1,this.weightsMaterial.areaTexture=o,this.dispatchEvent({type:"load"})},s.itemStart("search"),s.itemStart("area"),r!==void 0&&n!==void 0?(s.itemEnd("search"),s.itemEnd("area")):typeof Image<"u"&&(r=new Image,n=new Image,r.addEventListener("load",()=>s.itemEnd("search")),n.addEventListener("load",()=>s.itemEnd("area")),r.src=S9,n.src=M9),this.applyPreset(e)}get edgesTexture(){return this.renderTargetEdges.texture}getEdgesTexture(){return this.edgesTexture}get weightsTexture(){return this.renderTargetWeights.texture}getWeightsTexture(){return this.weightsTexture}get edgeDetectionMaterial(){return this.edgeDetectionPass.fullscreenMaterial}get colorEdgesMaterial(){return this.edgeDetectionMaterial}getEdgeDetectionMaterial(){return this.edgeDetectionMaterial}get weightsMaterial(){return this.weightsPass.fullscreenMaterial}getWeightsMaterial(){return this.weightsMaterial}setEdgeDetectionThreshold(e){this.edgeDetectionMaterial.edgeDetectionThreshold=e}setOrthogonalSearchSteps(e){this.weightsMaterial.orthogonalSearchSteps=e}applyPreset(e){let t=this.edgeDetectionMaterial,i=this.weightsMaterial;switch(e){case Fp.LOW:t.edgeDetectionThreshold=.15,i.orthogonalSearchSteps=4,i.diagonalDetection=!1,i.cornerDetection=!1;break;case Fp.MEDIUM:t.edgeDetectionThreshold=.1,i.orthogonalSearchSteps=8,i.diagonalDetection=!1,i.cornerDetection=!1;break;case Fp.HIGH:t.edgeDetectionThreshold=.1,i.orthogonalSearchSteps=16,i.diagonalSearchSteps=8,i.cornerRounding=25,i.diagonalDetection=!0,i.cornerDetection=!0;break;case Fp.ULTRA:t.edgeDetectionThreshold=.05,i.orthogonalSearchSteps=32,i.diagonalSearchSteps=16,i.cornerRounding=25,i.diagonalDetection=!0,i.cornerDetection=!0;break}}setDepthTexture(e,t=Uh){this.edgeDetectionMaterial.depthBuffer=e,this.edgeDetectionMaterial.depthPacking=t}update(e,t,i){this.clearPass.render(e,this.renderTargetEdges),this.edgeDetectionPass.render(e,t,this.renderTargetEdges),this.weightsPass.render(e,this.renderTargetEdges,this.renderTargetWeights)}setSize(e,t){this.edgeDetectionMaterial.setSize(e,t),this.weightsMaterial.setSize(e,t),this.renderTargetEdges.setSize(e,t),this.renderTargetWeights.setSize(e,t)}dispose(){let{searchTexture:e,areaTexture:t}=this.weightsMaterial;e!==null&&t!==null&&(e.dispose(),t.dispose()),super.dispose()}static get searchImageDataURL(){return S9}static get areaImageDataURL(){return M9}},Eze=`uniform float offset;uniform float darkness;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){const vec2 center=vec2(0.5);vec3 color=inputColor.rgb;
#if VIGNETTE_TECHNIQUE == 0
float d=distance(uv,center);color*=smoothstep(0.8,offset*0.799,d*(darkness+offset));
#else
vec2 coord=(uv-center)*vec2(offset);color=mix(color,vec3(1.0-darkness),dot(coord,coord));
#endif
outputColor=vec4(color,inputColor.a);}`,EM={DEFAULT:0,ESKIL:1},Aze=class extends fu{constructor({blendFunction:e=Gi.NORMAL,technique:t=EM.DEFAULT,eskil:i=!1,offset:r=.5,darkness:n=.5}={}){super("VignetteEffect",Eze,{blendFunction:e,defines:new Map([["VIGNETTE_TECHNIQUE",t.toFixed(0)]]),uniforms:new Map([["offset",new ct(r)],["darkness",new ct(n)]])})}get technique(){return Number(this.defines.get("VIGNETTE_TECHNIQUE"))}set technique(e){this.technique!==e&&(this.defines.set("VIGNETTE_TECHNIQUE",e.toFixed(0)),this.setChanged())}get eskil(){return this.technique===EM.ESKIL}set eskil(e){this.technique=e?EM.ESKIL:EM.DEFAULT}getTechnique(){return this.technique}setTechnique(e){this.technique=e}get offset(){return this.uniforms.get("offset").value}set offset(e){this.uniforms.get("offset").value=e}getOffset(){return this.offset}setOffset(e){this.offset=e}get darkness(){return this.uniforms.get("darkness").value}set darkness(e){this.uniforms.get("darkness").value=e}getDarkness(){return this.darkness}setDarkness(e){this.darkness=e}},Nh=class{constructor(e,t){this.enabled=!1,this.effect=new e(t),Object.defineProperty(this,"opacity",{enumerable:!0,set(i){this.effect.blendMode.opacity.value=i},get(){return this.effect.blendMode.opacity.value}}),Object.defineProperty(this,"blendFunction",{enumerable:!0,set(i){this.effect.blendMode.setBlendFunction(Number(i))},get(){return this.effect.blendMode.blendFunction}}),this.blendFunction=Gi.NORMAL}},Tze=class extends Nh{constructor(){super(oze),this.blendFunction=Gi.SCREEN}set intensity(e){this.effect.intensity=e}get intensity(){return this.effect.intensity}set luminanceThreshold(e){this.effect.luminanceMaterial.threshold=e}get luminanceThreshold(){return this.effect.luminanceMaterial.threshold}set luminanceSmoothing(e){this.effect.luminanceMaterial.smoothing=e}get luminanceSmoothing(){return this.effect.luminanceMaterial.smoothing}set blurScale(e){this.effect.blurPass.scale=e}get blurScale(){return this.effect.blurPass.scale}set kernelSize(e){this.effect.blurPass.kernelSize=e}get kernelSize(){return this.effect.blurPass.kernelSize}},Cze=class extends Nh{constructor(){super(cze)}set contrast(e){this.effect.uniforms.get("contrast").value=e}get contrast(){return this.effect.uniforms.get("contrast").value}set brightness(e){this.effect.uniforms.get("brightness").value=e}get brightness(){return this.effect.uniforms.get("brightness").value}},Pze=class extends Nh{constructor(){super(pze),this.effect.offset=new Me(.01,.01)}set offset(e){this.effect.offset.set(e[0]/1e3,e[1]/1e3)}get offset(){return[this.effect.offset.x*1e3,this.effect.offset.y*1e3]}},Dze=class extends Nh{constructor(){super(hze)}},Rze=class extends Nh{constructor(){super(yze),this._hue=0}set hue(e){this._hue=e,this.effect.setHue(e)}get hue(){return this._hue}set saturation(e){this.effect.uniforms.get("saturation").value=e}get saturation(){return this.effect.uniforms.get("saturation").value}},Ize=class extends Nh{constructor(){super(wze),this.blendFunction=Gi.OVERLAY}},Lze=class extends Nh{constructor(){super(Aze)}get eskil(){return this.effect.eskil}set eskil(e){this.effect.eskil=e}get darkness(){return this.effect.uniforms.get("darkness").value}set darkness(e){this.effect.uniforms.get("darkness").value=e}get offset(){return this.effect.uniforms.get("offset").value}set offset(e){this.effect.uniforms.get("offset").value=e}},Oze=class extends Nh{constructor(e){super(gze)}set focalLength(e){this.effect.circleOfConfusionMaterial.uniforms.focalLength.value=e/2e3}get focalLength(){return this.effect.circleOfConfusionMaterial.uniforms.focalLength.value}set focusDistance(e){this.effect.circleOfConfusionMaterial.uniforms.focusDistance.value=this.isPerspectiveCamera?e/2e3:(e+992)/2e3}get focusDistance(){return this.effect.circleOfConfusionMaterial.uniforms.focusDistance.value}get bokehScale(){return this.effect.bokehScale}set bokehScale(e){this.effect.bokehScale=e}setCamera(e){let t=!1;(e.isPerspectiveCamera&&this.isPerspectiveCamera===!1||!e.isPerspectiveCamera&&this.isPerspectiveCamera===!0)&&(t=!0),e.isPerspectiveCamera?(this.effect.circleOfConfusionMaterial.adoptCameraSettings(e.perspCamera),this.isPerspectiveCamera=!0):(this.effect.circleOfConfusionMaterial.adoptCameraSettings(e),this.isPerspectiveCamera=!1),t&&this.effect.setChanged()}},zze=class extends Nh{constructor(){super(_ze)}get granularity(){return this.effect.getGranularity()}set granularity(e){this.effect.setGranularity(e)}},Bze=`#define GLSLIFY 1
varying vec2 vUv;varying vec2 vTexCoords[9];uniform vec2 resolution;void main(){vUv=position.xy*0.5+0.5;vec2 texelSize=vec2(1.0)/resolution;vTexCoords[0]=vUv+vec2(-texelSize.x,-texelSize.y);vTexCoords[1]=vUv+vec2(0.0,-texelSize.y);vTexCoords[2]=vUv+vec2(texelSize.x,-texelSize.y);vTexCoords[3]=vUv+vec2(-texelSize.x,0.0);vTexCoords[4]=vUv+vec2(0.0,0.0);vTexCoords[5]=vUv+vec2(texelSize.x,0.0);vTexCoords[6]=vUv+vec2(-texelSize.x,texelSize.y);vTexCoords[7]=vUv+vec2(0.0,texelSize.y);vTexCoords[8]=vUv+vec2(texelSize.x,texelSize.y);gl_Position=vec4(position.xy,1.0,1.0);}`,Fze=`#define GLSLIFY 1
#include <common>
varying vec2 vUv;varying vec2 vTexCoords[9];uniform sampler2D inputBuffer;uniform sampler2D historyBuffer;uniform sampler2D velocityBuffer;uniform sampler2D depthBuffer;uniform vec2 resolution;
#define USE_YCOCG
#define USE_CATMULL_ROM
const float feedback_min=0.5;const float feedback_max=0.95;vec3 RGB_YCoCg(vec3 c){return vec3(c.x/4.0+c.y/2.0+c.z/4.0,c.x/2.0-c.z/2.0,-c.x/4.0+c.y/2.0-c.z/4.0);}vec3 YCoCg_RGB(vec3 c){return clamp(vec3(c.x+c.y-c.z,c.x+c.z,c.x-c.y-c.z),vec3(0.0),vec3(1.0));}vec4 sample_color(sampler2D tex,vec2 uv){
#ifdef USE_YCOCG
vec4 c=texture(tex,uv);return vec4(RGB_YCoCg(c.rgb),c.a);
#else
return texture(tex,uv);
#endif
}vec4 sample_catmull_rom(sampler2D tex,vec2 uv,vec2 texSize){vec2 samplePos=uv*texSize;vec2 texPos1=floor(samplePos-0.5)+0.5;vec2 f=samplePos-texPos1;vec2 w0=f*(-0.5+f*(1.0-0.5*f));vec2 w1=1.0+f*f*(-2.5+1.5*f);vec2 w2=f*(0.5+f*(2.0-1.5*f));vec2 w3=f*f*(-0.5+0.5*f);vec2 w12=w1+w2;vec2 offset12=w2/(w1+w2);vec2 texPos0=texPos1-1.0;vec2 texPos3=texPos1+2.0;vec2 texPos12=texPos1+offset12;texPos0/=texSize;texPos3/=texSize;texPos12/=texSize;vec4 result=vec4(0.0);result+=texture2D(tex,vec2(texPos12.x,texPos0.y))*w12.x*w0.y;result+=texture2D(tex,vec2(texPos0.x,texPos12.y))*w0.x*w12.y;result+=texture2D(tex,vec2(texPos12.x,texPos12.y))*w12.x*w12.y;result+=texture2D(tex,vec2(texPos3.x,texPos12.y))*w3.x*w12.y;result+=texture2D(tex,vec2(texPos12.x,texPos3.y))*w12.x*w3.y;return result;}vec3 choose_motion_vector(){
#ifdef CHOOSE_LONGEST_MOTION_VECTOR
float longest=-1.0;vec3 v_choose=vec3(-1.0);for(int i=0;i<9;i++){vec3 v=texture2D(velocityBuffer,vTexCoords[i]).rgb;float l=length(v.xy);if(l>longest){longest=l;v_choose=v;}}return v_choose;
#else
float closest_depth=1000.0;vec2 closest_uv_offset=vec2(0.0);for(int i=0;i<9;i++){float neighbor_depth=texture2D(depthBuffer,vTexCoords[i]).r;if(neighbor_depth<closest_depth){closest_uv_offset=vTexCoords[i];closest_depth=neighbor_depth;}}return texture2D(velocityBuffer,closest_uv_offset).rgb;
#endif
}vec4 clipAabb(vec3 aabb_min,vec3 aabb_max,vec4 avg,vec4 input_texel){const float FLT_EPS=0.00000001;vec3 p_clip=0.5*(aabb_max+aabb_min);vec3 e_clip=0.5*(aabb_max-aabb_min)+FLT_EPS;vec4 v_clip=input_texel-vec4(p_clip,avg.w);vec3 v_unit=v_clip.xyz/e_clip;vec3 a_unit=abs(v_unit);float ma_unit=max(a_unit.x,max(a_unit.y,a_unit.z));if(ma_unit>1.0){return vec4(p_clip,avg.w)+v_clip/ma_unit;}else{return input_texel;}}vec3 clip_aabb_variance(in vec3 cOld,in vec3 cNew,in vec3 centre,in vec3 halfSize){if(all(lessThanEqual(abs(cOld-centre),halfSize))){return cOld;}vec3 dir=(cNew-cOld);vec3 near=centre-sign(dir)*halfSize;vec3 tAll=(near-cOld)/dir;float t=0.0001;for(int i=0;i<3;i++){if(tAll[i]>=0.0&&tAll[i]<t){t=tAll[i];}}if(t>=0.0001){return cOld;}return cOld+dir*t;}void main(){vec3 v=choose_motion_vector();vec2 velocity=v.rg;vec2 previousPixelPos=vUv-velocity;vec4 currentColor=sample_color(inputBuffer,vUv);
#ifdef USE_CATMULL_ROM
vec4 previousColor=sample_catmull_rom(historyBuffer,previousPixelPos,resolution);
#else
vec4 previousColor=sample_color(historyBuffer,previousPixelPos);
#endif
#ifdef USE_YCOCG
previousColor=vec4(RGB_YCoCg(previousColor.rgb),previousColor.a);
#endif
vec4 ctl=sample_color(inputBuffer,vTexCoords[0]);vec4 ctc=sample_color(inputBuffer,vTexCoords[1]);vec4 ctr=sample_color(inputBuffer,vTexCoords[2]);vec4 cml=sample_color(inputBuffer,vTexCoords[3]);vec4 cmc=sample_color(inputBuffer,vTexCoords[4]);vec4 cmr=sample_color(inputBuffer,vTexCoords[5]);vec4 cbl=sample_color(inputBuffer,vTexCoords[6]);vec4 cbc=sample_color(inputBuffer,vTexCoords[7]);vec4 cbr=sample_color(inputBuffer,vTexCoords[8]);vec4 cmin=min(ctl,min(ctc,min(ctr,min(cml,min(cmc,min(cmr,min(cbl,min(cbc,cbr))))))));vec4 cmax=max(ctl,max(ctc,max(ctr,max(cml,max(cmc,max(cmr,max(cbl,max(cbc,cbr))))))));vec4 cavg=(ctl+ctc+ctr+cml+cmc+cmr+cbl+cbc+cbr)/9.0;vec4 cmin5=min(ctc,min(cml,min(cmc,min(cmr,cbc))));vec4 cmax5=max(ctc,max(cml,max(cmc,max(cmr,cbc))));vec4 cavg5=(ctc+cml+cmc+cmr+cbc)/5.0;cmin=0.5*(cmin+cmin5);cmax=0.5*(cmax+cmax5);cavg=0.5*(cavg+cavg5);
#ifdef USE_YCOCG
vec2 chroma_extent=vec2(0.25*0.5*(cmax.r-cmin.r));vec2 chroma_center=currentColor.gb;cmin.yz=chroma_center-chroma_extent;cmax.yz=chroma_center+chroma_extent;cavg.yz=chroma_center;
#endif
vec4 previousColorClipped=clamp(previousColor,cmin,cmax);
#ifdef LUMINANCE_DIFFERENCES
#ifdef USE_YCOCG
float lum0=currentColor.r;float lum1=previousColorClipped.r;
#else
float lum0=luminance(currentColor.rgb);float lum1=luminance(previousColorClipped.rgb);
#endif
float unbiased_diff=abs(lum0-lum1)/max(lum0,max(lum1,0.2));float unbiased_weight=1.0-unbiased_diff;float unbiased_weight_sqr=unbiased_weight*unbiased_weight;float k_feedback=mix(feedback_min,feedback_max,unbiased_weight_sqr);vec4 result=mix(currentColor,previousColorClipped,vec4(k_feedback));
#else
const float alpha=0.1;vec4 result=mix(currentColor,previousColorClipped,1.0-alpha);
#endif
#ifdef USE_YCOCG
gl_FragColor=vec4(YCoCg_RGB(result.rgb).rgb,result.a);
#else
gl_FragColor=result;
#endif
}`,Uze=`#define GLSLIFY 1
varying vec2 vUv;void main(){gl_Position=vec4(position.xy,1.0,1.0);vUv=position.xy*0.5+0.5;}`,Nze=`#define GLSLIFY 1
layout(location=1)out vec4 gVelocity;varying vec2 vUv;uniform sampler2D inputBuffer;void main(){gl_FragColor=texture2D(inputBuffer,vUv);gVelocity=vec4(0.0);}`,_B=class extends ki{constructor(){super({name:"PassthroughMaterial",uniforms:{inputBuffer:new ct(null)},blending:Ln,depthWrite:!1,depthTest:!1,vertexShader:Uze,fragmentShader:Nze})}set inputBuffer(e){this.uniforms.inputBuffer.value=e}},kze=class extends Ua{constructor(){super("TAAResolvePass"),this.MRTCompatible=!0,this.needsSwap=!1,this.passThroughMaterial=new _B,this.resolutionVector=new Me,this.resolveMaterial=new ki({name:"TAAResolveMaterial",uniforms:{inputBuffer:new ct(null),historyBuffer:new ct(null),velocityBuffer:new ct(null),depthBuffer:new ct(null),resolution:new ct(new Me)},blending:Ln,depthWrite:!1,depthTest:!1,vertexShader:Bze,fragmentShader:Fze}),this.historyRenderTarget=new Ni(1024,1024,{minFilter:bi,stencilBuffer:!1,depthBuffer:!1}),this.historyRenderTarget.texture.name="TAA.History",this.resultRenderTarget=new Ni(1024,1024,{minFilter:bi,stencilBuffer:!1,depthBuffer:!1}),this.resultRenderTarget.texture.name="TAA.Output"}setSize(e,t){this.historyRenderTarget.setSize(e,t),this.resultRenderTarget.setSize(e,t)}render(e,t){this.fullscreenMaterial=this.resolveMaterial,this.resolveMaterial.uniforms.inputBuffer.value=t.texture[0],this.resolveMaterial.uniforms.velocityBuffer.value=t.texture[1],this.resolveMaterial.uniforms.depthBuffer.value=t.depthTexture,this.resolveMaterial.uniforms.historyBuffer.value=this.historyRenderTarget.texture,this.resolveMaterial.uniforms.resolution.value.set(t.width,t.height),e.setRenderTarget(this.resultRenderTarget),e.render(this.scene,this.camera),this.fullscreenMaterial=this.passThroughMaterial,this.passThroughMaterial.inputBuffer=this.resultRenderTarget.texture,e.setRenderTarget(this.historyRenderTarget),e.render(this.scene,this.camera);let i=this.renderToScreen?null:t;this.fullscreenMaterial=this.passThroughMaterial,this.passThroughMaterial.inputBuffer=this.resultRenderTarget.texture,e.setRenderTarget(i),e.render(this.scene,this.camera)}dispose(){this.resultRenderTarget.dispose(),this.historyRenderTarget.dispose(),this.resolveMaterial.dispose(),this.passThroughMaterial.dispose()}},Vze=class extends Ua{constructor(e,t,i){super("TransmissionPass",void 0,t),this.MRTCompatible=!0,this.depthPass=new b9(e,t,{renderTarget:i.transmissionDepthTarget}),this.passThroughMaterial=new _B,this.splineScene=e,this.needsSwap=!1}updatePasses(e){this.passThroughMaterial=new _B,this.depthPass=new b9(this.splineScene,this.camera,{renderTarget:e.transmissionDepthTarget})}setCamera(e){this.camera=e}setScene(e){this.splineScene=e}render(e,t,i){let r=this.camera.layers.mask,n=e;n.setRenderTarget(n.transmissionRenderTarget),this.fullscreenMaterial=this.passThroughMaterial,this.passThroughMaterial.inputBuffer=t.texture[0],n.clear(),n.render(this.scene,this.camera),this.camera.layers.disable(3),this.depthPass.render(e,t,i),n.shadowMap.needsUpdate=!1,n.shadowMap.autoUpdate=!1;let s=this.renderToScreen?null:t;this.camera.layers.set(3),e.setRenderTarget(s),e.render(this.splineScene,this.camera),this.camera.layers.mask=r}},E9=new co,Gze=new ki({transparent:!0,vertexShader:`
        void main() {
            gl_Position = vec4(0.0);
        }
    `,fragmentShader:`
        layout(location = 1) out vec4 gVelocity;

        void main() {
            gl_FragColor = vec4(0.0);
			gVelocity = vec4(0.0);
        }
    `}),SB=class extends Ua{constructor(e,t,i){super("OpaquePass",t??E9,i),this.MRTCompatible=!0,this.originalMaterials=[],this.hasTransmissionPass=!1,this.clear=!0,this.clearColorOnly=!1,this.clearDepth=!1,this.needsSwap=!1,this.MRTCompatible=e}setCamera(e){this.camera=e}setScene(e){this.scene=e??E9}getScene(){return this.scene}render(e,t){this.camera.layers.enable(3),this.hasTransmissionPass&&(this.originalMaterials.length=0,this.scene.traverse(r=>{r.layers.isEnabled(3)&&r instanceof za&&(this.originalMaterials.push([r,r.material]),r.material=Gze)}),e.shadowMap.needsUpdate=!0,e.shadowMap.autoUpdate=!0),this.camera.layers.enable(8);let i=this.renderToScreen?null:t;e.setRenderTarget(i),this.clearColorOnly&&e.clear(!0,!1,!0),this.clear&&e.clear(),e.render(this.scene,this.camera),this.clearDepth&&e.clear(!1,!0,!1),this.hasTransmissionPass&&this.originalMaterials.forEach(r=>{r[0].material=r[1]})}},Hze=class{constructor(e,{depthBuffer:t=!0,stencilBuffer:i=!1,multisampling:r=0,frameBufferType:n=0}={}){this.renderer=e,this.helperStartIndex=0,this.copyPass=new bB,this.depthTexture=null,this.timer=new sze,this._width=1,this._height=1,this.passes=[],this.helperPasses=[],this.autoRenderToScreen=!0,this.inputBuffer=this.createBuffer(t,i,n,r,!0,"input buffer mrt"),this.inputBufferSingle=this.createBuffer(t,i,n,r,!1," input buffer single"),this.inputBufferSingle.texture.dispose(),this.inputBufferSingle.depthTexture.dispose(),this.inputBufferSingle.texture=this.inputBuffer.texture[0],this.inputBufferSingle.depthTexture=this.inputBuffer.depthTexture,this.outputBuffer=this.inputBuffer.clone(),this.outputBuffer.name="output buffer mrt",this.outputBufferSingle=this.createBuffer(t,i,n,r,!1,"output buffer single"),this.outputBufferSingle.texture.dispose(),this.outputBufferSingle.depthTexture.dispose(),this.outputBufferSingle.texture=this.outputBuffer.texture[0],this.outputBufferSingle.depthTexture=this.outputBuffer.depthTexture,this.setRenderer(e)}get multisampling(){return this.inputBuffer.samples||0}set multisampling(e){let t=this.inputBuffer,i=this.multisampling;i>0&&e>0?(this.inputBuffer.samples=e,this.outputBuffer.samples=e,this.inputBuffer.dispose(),this.outputBuffer.dispose()):i!==e&&(this.inputBuffer.dispose(),this.outputBuffer.dispose(),console.log("creating new input buffer"),this.inputBuffer=this.createBuffer(t.depthBuffer,t.stencilBuffer,t.texture.type,e,!0,"new input buffer"),this.inputBuffer.depthTexture=this.depthTexture,this.outputBuffer=this.inputBuffer.clone())}getTimer(){return this.timer}getRenderer(){return this.renderer}setRenderer(e){var t;if(this.renderer=e,e!==null){let i=e.getSize(new Me),r=((t=e.getContext().getContextAttributes())==null?void 0:t.alpha)??!1,n=this.inputBuffer.texture[0].type;n===ca&&e.outputEncoding===vi&&(this.inputBuffer.texture[0].encoding=vi,this.outputBuffer.texture[0].encoding=vi,this.inputBuffer.dispose(),this.outputBuffer.dispose(),console.log("doing some kinda dispose??")),e.autoClear=!1,this.setSize(i.width,i.height,!1);for(let s of this.passes)s.initialize(e,r,n)}}replaceRenderer(e,t=!0){let i=this.renderer,r=i.domElement.parentNode;return this.setRenderer(e),t&&r!==null&&(r.removeChild(i.domElement),r.appendChild(e.domElement)),i}createDepthTexture(){let e=this.depthTexture=new O0(this._width,this._height);return this.inputBuffer.depthTexture=e,this.inputBuffer.stencilBuffer?(e.format=Mm,e.type=sm):e.type=ch,e}deleteDepthTexture(){if(this.depthTexture!==null){this.depthTexture.dispose(),this.depthTexture=null,this.inputBuffer.depthTexture=null,this.inputBuffer.dispose();for(let e of this.passes)e.setDepthTexture(null)}}createBuffer(e,t,i,r,n,s){let a=this.renderer,o=a===null?new Me:a.getDrawingBufferSize(new Me),l={minFilter:bi,magFilter:bi,wrapS:Tr,wrapT:Tr,stencilBuffer:t,depthBuffer:e},c;return r>0?(c=new Ni(o.width,o.height,l),c.samples=r):(n?(c=new UJ(o.width,o.height,2,l),c.texture[1].type=Th):c=new Ni(o.width,o.height,l),c.depthTexture=new O0(2048,2048),c.depthTexture.type=or),i===ca&&a!==null&&a.outputEncoding===vi&&(Array.isArray(c.texture)?c.texture.forEach(u=>u.encoding=vi):c.texture.encoding=vi),Array.isArray(c.texture)?c.texture.forEach((u,h)=>{u.name=`EffectComposer.Buffer ${n} ${h}`,u.generateMipmaps=!1}):(c.texture.name=`EffectComposer.Buffer ${n}`,c.texture.generateMipmaps=!1),c.name=s,c}addPass(e,t){var o;let i=this.passes,r=this.renderer,n=r.getDrawingBufferSize(new Me),s=((o=r.getContext().getContextAttributes())==null?void 0:o.alpha)??!1,a;if(e.MRTCompatible&&(a=this.inputBuffer.texture[0].type),e.MRTCompatible||(a=this.inputBuffer.texture.type),e.setRenderer(r),e.setSize(n.width,n.height),e.initialize(r,s,a),this.autoRenderToScreen&&(i.length>0&&(i[i.length-1].renderToScreen=!1),e.renderToScreen&&(this.autoRenderToScreen=!1)),t!==void 0?i.splice(t,0,e):i.push(e),this.autoRenderToScreen&&(i[i.length-1].renderToScreen=!0),e.needsDepthTexture||this.depthTexture!==null)if(this.depthTexture===null){let l=this.createDepthTexture();for(e of i)e.setDepthTexture(l)}else e.setDepthTexture(this.depthTexture)}setHelperStartIndex(e){this.helperStartIndex=e}removePass(e){let t=this.passes,i=t.indexOf(e);if(i!==-1&&t.splice(i,1).length>0){if(this.depthTexture!==null){let r=(n,s)=>n||s.needsDepthTexture;t.reduce(r,!1)||e.getDepthTexture()===this.depthTexture&&e.setDepthTexture(null)}this.autoRenderToScreen&&i===t.length&&(e.renderToScreen=!1,t.length>0&&(t[t.length-1].renderToScreen=!0))}}removeAllPasses(){let e=this.passes;e.length>0&&(this.autoRenderToScreen&&(e[e.length-1].renderToScreen=!1),this.passes=[])}render(e){let t=this.renderer,i=this.copyPass,r=this.inputBuffer,n=this.outputBuffer,s=this.inputBufferSingle,a=this.outputBufferSingle,o=!1,l,c,u,h;e===void 0&&(e=this.timer.update().getDelta());for(let d of this.passes)d.enabled&&(d.MRTCompatible?d.render(t,r,n,e,o):d.render(t,s,a,e,o),d.needsSwap&&(o&&(i.renderToScreen=d.renderToScreen,l=t.getContext(),c=t.state.buffers.stencil,c.setFunc(l.NOTEQUAL,1,4294967295),i.render(t,r,n,e,o),c.setFunc(l.EQUAL,1,4294967295)),u=r,h=s,r=n,s=a,n=u,a=h),d instanceof rze?o=!0:d instanceof IOe&&(o=!1))}setSize(e,t,i){let r=this.renderer;if(this._width=e,this._height=t,e===void 0||t===void 0){let s=r.getSize(new Me);e=s.width,t=s.height}r.setSize(e,t,i);let n=r.getDrawingBufferSize(new Me);this.inputBuffer.setSize(n.width,n.height),this.outputBuffer.setSize(n.width,n.height),this.inputBufferSingle.setSize(n.width,n.height),this.outputBufferSingle.setSize(n.width,n.height);for(let s of this.passes)s.setSize(n.width,n.height)}reset(){let e=this.timer.isAutoResetEnabled();this.dispose(),this.autoRenderToScreen=!0,this.timer.setAutoResetEnabled(e)}dispose(){for(let e of this.passes)e.dispose();this.passes=[],this.inputBuffer!==null&&this.inputBuffer.dispose(),this.outputBuffer!==null&&this.outputBuffer.dispose(),this.inputBufferSingle!==null&&this.inputBufferSingle.dispose(),this.outputBufferSingle!==null&&this.outputBufferSingle.dispose(),this.deleteDepthTexture(),this.copyPass.dispose(),this.timer.dispose()}},jze=new ki({name:"CombineMaterial",uniforms:{inputBufferA:new ct(null),inputBufferB:new ct(null)},blending:Ln,depthWrite:!1,depthTest:!1,vertexShader:`
varying vec2 vUv;
void main() {
    gl_Position = vec4(position.xy, 1.0, 1.0);
    vUv = position.xy * 0.5 + 0.5;
}
`,fragmentShader:`
    varying vec2 vUv;
    uniform sampler2D inputBufferA;
    uniform sampler2D inputBufferB;

    // TODO: Why do we need these when postpro of framemode is enabled???
    layout(location = 1) out vec4 gVelocity;

    void main() {
	vec4 resA = texture2D(inputBufferA, vUv);
	vec4 resB = texture2D(inputBufferB, vUv);
    float a = resA.a + resB.a * ( 1.0 - resA.a );

	vec4 res;
	res.rgb =  resA.rgb + (resB.rgb * (1.0 - resA.a));
	res.a = resA.a + resB.a * (1.0 - resA.a);
	gl_FragColor = res;
    gVelocity = vec4(0.0);
    }
`}),Wze=class extends Ua{constructor(e){super("HelperPass",void 0,e),this.MRTCompatible=!1,this.fullscreenMaterial=jze,this.helperPass=new SB(!1,void 0,this.camera),this.helperPass.hasTransmissionPass=!1,this.helperPass.clear=!1,this.helperPass.renderToScreen=!1,this.helperPassOnTop=new SB(!1,void 0,this.camera),this.helperPassOnTop.hasTransmissionPass=!1,this.helperPassOnTop.clear=!1,this.helperPassOnTop.renderToScreen=!1;let t=new lie({preset:Fp.LOW,edgeDetectionMode:WC.COLOR});this.effectPass=new $A(this.camera,t),this.rt=new Ni(10,10,{minFilter:bi,magFilter:bi,wrapS:Tr,wrapT:Tr,depthBuffer:!0})}setSize(e,t){this.rt.setSize(e,t),this.effectPass.setSize(e,t)}set sceneHelpers(e){this.helperPass.setScene(e)}get sceneHelpers(){return this.helperPass.getScene()}set sceneHelpersOnTop(e){this.helperPassOnTop.setScene(e)}get sceneHelpersOnTop(){return this.helperPassOnTop.getScene()}setCamera(e){this.helperPass.setCamera(e),this.helperPassOnTop.setCamera(e)}initialize(e,t,i){super.initialize(e,t,i),this.effectPass.initialize(e,t,i)}dispose(){super.dispose(),this.rt.dispose(),this.effectPass.dispose()}render(e,t,i){this.rt.depthTexture=t.depthTexture;let r=e.getClearAlpha();e.setClearAlpha(0),this.helperPass.clearDepth=!0,this.helperPass.clearColorOnly=!0,this.helperPass.render(e,this.rt),this.helperPassOnTop.render(e,this.rt),this.effectPass.renderToScreen=!1,this.effectPass.render(e,this.rt,i),this.fullscreenMaterial.uniforms.inputBufferA.value=i.texture,this.fullscreenMaterial.uniforms.inputBufferB.value=t.texture,e.setClearAlpha(r),e.setRenderTarget(null),e.clear(),e.render(this.scene,this.camera)}},Xze=`#define GLSLIFY 1
#include <skinning_pars_vertex>
#include <morphtarget_pars_vertex>
out vec3 n;void main(){
#include <beginnormal_vertex>
#include <morphnormal_vertex>
#include <skinbase_vertex>
#include <skinnormal_vertex>
#include <defaultnormal_vertex>
#include <begin_vertex>
#include <morphtarget_vertex>
#include <skinning_vertex>
vec4 view_space=viewMatrix*modelMatrix*vec4(transformed,1.0);gl_Position=projectionMatrix*view_space;n=normalize(transformedNormal);}`,qze=`#define GLSLIFY 1
in vec3 n;void main(){gl_FragColor=vec4(n,1.0);}`,Yze=`#define GLSLIFY 1
out vec2 v_uv;void main(){v_uv=uv;gl_Position=vec4(position.xy,1.0,1.0);}`,Qze=`#define GLSLIFY 1
in vec2 v_uv;const float pi=3.14159265;const float num_steps=4.0;const float num_directions=4.0;uniform float near;uniform float far;uniform float fov;uniform vec4 proj_info;uniform bool is_ortho;uniform vec2 resolution;uniform float radius_of_influence;uniform float radius_in_screen_space;uniform float exponent;uniform vec3 ao_color;uniform float bias;uniform sampler2D texture_depth;uniform sampler2D texture_normals;uniform sampler2D texture_blue_noise;uniform sampler2D texture_blue_noise_in_disk;uniform sampler2D texture_color_pass;uniform int frame_index;uniform bool fog_enabled;uniform float fog_near;uniform float fog_far;vec3 uv_to_view_space(vec2 uv,float eye_z){return vec3((uv*proj_info.xy+proj_info.zw)*(is_ortho ? 1.0 : eye_z),eye_z);}float linearize_depth(float depth_sampled){float z=is_ortho ? depth_sampled : depth_sampled*2.0-1.0;return mix((2.0*near*far)/(far+near-z*(far-near)),near+z*(far-near),float(is_ortho));}vec3 get_view_position(vec2 uv_coords){float linear_depth=linearize_depth(texture(texture_depth,uv_coords).x);return uv_to_view_space(uv_coords,linear_depth);}vec3 min_difference(vec3 p,vec3 right,vec3 left){vec3 v1=right-p;vec3 v2=p-left;return(dot(v1,v1)<dot(v2,v2))? v1 : v2;}vec3 rebuild_normal(in vec2 uv,in vec3 p){vec2 one_over_resolution=1.0/resolution;vec3 r=get_view_position(uv+vec2(one_over_resolution.x,0));vec3 l=get_view_position(uv+vec2(-one_over_resolution.x,0));vec3 t=get_view_position(uv+vec2(0,one_over_resolution.y));vec3 b=get_view_position(uv+vec2(0,-one_over_resolution.y));return normalize(cross(min_difference(p,r,l),min_difference(p,t,b)));}float falloff(float distance_squared){float neg_inv_r2=-1.0/(radius_of_influence*radius_of_influence);return distance_squared*neg_inv_r2+1.0;}float ao_contribution(vec3 P,vec3 N,vec3 S){vec3 to_sample=S-P;float norm_squared=dot(to_sample,to_sample);float norm=sqrt(norm_squared);float cos_theta=dot(N,to_sample)/norm;return clamp(cos_theta-bias,0.0,1.0)*clamp(falloff(norm_squared),0.0,1.0);}float compute_ambient_occlusion(vec2 uv,float radius_in_screen_space,vec3 pc,vec3 view_space_n){vec2 one_over_resolution=1.0/resolution;ivec2 noise_uv=ivec2(int(mod(gl_FragCoord.x,128.0)),int(mod(gl_FragCoord.y,128.0)));float noise=texelFetch(texture_blue_noise,noise_uv,0).r;noise=fract(noise+0.61803398875*float(frame_index));float theta=noise*2.0*3.1415;float ct=cos(theta);float st=sin(theta);float step_size=radius_in_screen_space/(num_steps+1.0);const float angle_step=2.0*pi/num_directions;float contribution=0.0;for(int i=0;i<int(num_directions);++i){float current_pixel=step_size+1.0;for(int j=0;j<int(num_steps);++j){int index=i*int(num_steps)+j;vec2 blue_noise_sample=texelFetch(texture_blue_noise_in_disk,ivec2(index,0),0).rg;vec2 disk_point;disk_point.x=blue_noise_sample.x*ct-blue_noise_sample.y*st;disk_point.y=blue_noise_sample.x*st+blue_noise_sample.y*ct;vec2 sample_direction=disk_point;vec2 snapped_uv=round(current_pixel*sample_direction)*one_over_resolution+uv;vec3 ps=get_view_position(snapped_uv);current_pixel+=step_size;contribution+=ao_contribution(pc,view_space_n,ps);}}float mult=1.0/(1.0-bias);contribution*=mult/(num_directions*num_steps);return clamp(1.0-contribution*2.0,0.0,1.0);}
#define USE_GBUFFER_NORMALS
void main(){vec3 view_space_p=get_view_position(v_uv);
#ifdef USE_GBUFFER_NORMALS
vec3 view_space_n=texture(texture_normals,v_uv).rgb;view_space_n.z*=-1.0;
#else
vec3 view_space_n=-rebuild_normal(v_uv,view_space_p);
#endif
float radius_ss=radius_in_screen_space/(is_ortho ? 1.0 : view_space_p.z);float ao=compute_ambient_occlusion(v_uv,radius_ss,view_space_p,view_space_n);float final=pow(ao,exponent);if(view_space_p.z>=far){final=1.0;}vec3 color=mix(ao_color,vec3(1.0),final);if(fog_enabled){float fog_factor=smoothstep(fog_near,fog_far,view_space_p.z);color=mix(color,vec3(1.0),fog_factor);}gl_FragColor=vec4(color,1.0);}`,Zze=`#define GLSLIFY 1
out vec2 v_uv;void main(){gl_Position=vec4(position.xy,1.0,1.0);v_uv=uv;}`,Kze=`#define GLSLIFY 1
in vec2 v_uv;uniform sampler2D texture_ao_lrez;uniform sampler2D texture_depth_lrez;uniform sampler2D texture_depth_hrez;uniform float near;uniform float far;float linearize_depth(float depth_sampled){float z=depth_sampled*2.0-1.0;return(2.0*near*far)/(far+near-z*(far-near));}vec2 nearest_depth_filter(in vec2 uv){vec2 resolution=vec2(textureSize(texture_depth_lrez,0));vec2 texel_size=1.0/resolution;vec2 offset=uv-0.5*texel_size;float d_hrez=texture(texture_depth_hrez,uv).r;float a=abs(d_hrez-texture(texture_depth_lrez,offset).r);float b=abs(d_hrez-texture(texture_depth_lrez,offset+vec2(texel_size.x,0.0)).r);float c=abs(d_hrez-texture(texture_depth_lrez,offset+vec2(0.0,texel_size.y)).r);float d=abs(d_hrez-texture(texture_depth_lrez,offset+vec2(texel_size.x,texel_size.y)).r);float min_diff=min(a,min(b,min(c,d)));if(min_diff==a)return offset;if(min_diff==b)return offset+vec2(texel_size.x,0.0);if(min_diff==c)return offset+vec2(0.0,texel_size.y);if(min_diff==d)return offset+vec2(texel_size.x,texel_size.y);}void main(){
#ifdef DEBUG
float d_lrez=texture(texture_depth_lrez,v_uv).r;float d_hrez=texture(texture_depth_hrez,v_uv).r;float output_d=mix(linearize_depth(d_lrez)/far,linearize_depth(d_hrez)/far,step(0.5,v_uv.x));gl_FragColor=vec4(vec3(output_d),1.0);
#else
vec2 filtered_uv=nearest_depth_filter(v_uv);vec4 ao=texture(texture_ao_lrez,filtered_uv);gl_FragColor=vec4(ao.rgb,1.0);gl_FragColor=ao;
#endif
}`,T1=[[.478712,.875764],[-.337956,-.793959],[-.955259,-.028164],[.864527,.325689],[.209342,-.395657],[-.106779,.672585],[.156213,.235113],[-.413644,-.082856],[-.415667,.323909],[.141896,-.93998],[.954932,-.182516],[-.766184,.410799],[-.434912,-.458845],[.415242,-.078724],[.728335,-.491777],[-.058086,-.066401],[.20299,.686837],[-.808362,-.556402],[.507386,-.640839],[-.723494,-.22924],[.48974,.317826],[-.622663,.765301],[-.01064,.929347],[.663146,.647618],[-.096674,-.413835],[.525945,-.321063],[-.122533,.366019],[.195235,-.687983],[-.563203,.098748],[.418563,.561335],[-.378595,.800367],[.826922,.001024],[-.085372,-.766651],[-.92192,.183673],[-.590008,-.721799],[.167751,-.164393],[.032961,-.56253],[.6329,-.107059],[-.46408,.569669],[-.173676,-.958758],[-.242648,-.234303],[-.275362,.157163],[.382295,-.795131],[.562955,.115562],[.190586,.470121],[.770764,-.297576],[.237281,.93105],[-.666642,-.455871],[-.905649,-.298379],[.33952,.157829],[.701438,-.7041],[-.062758,.160346],[-.220674,.957141],[.642692,.432706],[-.77339,-.015272],[-.671467,.24688],[.158051,.062859],[.806009,.527232],[-.05762,-.247071],[.333436,-.51671],[-.550658,-.315773],[-.652078,.589846],[.008818,.530556],[-.210004,.519896]],Jze=new ki({vertexShader:Xze,fragmentShader:qze}),Vg=new ki({vertexShader:Zze,fragmentShader:Kze,uniforms:{texture_ao_lrez:new ct(null),texture_depth_lrez:new ct(null),texture_depth_hrez:new ct(null),near:new ct(null),far:new ct(null)}}),$ze=class extends Ua{constructor(e,t){super("AmbientOcclusionPass",void 0,t),this.fogEnabled=!1,this.fogNear=1,this.fogFar=1e3,this.frameIndex=0,this._runHalfRes=!0,this._width=1,this._height=1;let i=1024,r=1024;this.gBuffer=new Ni(i,r,{type:zb?Th:or,depthTexture:new O0(i,r),minFilter:bi,magFilter:bi}),this.depthBufferHighRes=new Ni(i,r,{depthTexture:new O0(i,r)}),this.aoBuffer=new Ni(i,r,{minFilter:bi,magFilter:bi}),this.splineScene=e,this.splineCamera=t;let n=new Float32Array(T1.length*2);for(let a=0;a<T1.length;a++){let o=a*2;n[o+0]=T1[a][0],n[o+1]=T1[a][1]}this.blueNoiseInDiskTexture=new Da(n,T1.length,1,rA,or),this.blueNoiseInDiskTexture.wrapS=lh,this.blueNoiseInDiskTexture.wrapT=lh,this.blueNoiseInDiskTexture.needsUpdate=!0,this.hbaoMaterial=new ki({vertexShader:Yze,fragmentShader:Qze,uniforms:{near:new ct(null),far:new ct(null),fov:new ct(null),proj_info:new ct(new ai),is_ortho:new ct(!1),resolution:new ct(new Me),radius_of_influence:new ct(8),radius_in_screen_space:new ct(1),exponent:new ct(1),ao_color:new ct(new N),bias:new ct(.5),texture_depth:new ct(null),texture_normals:new ct(null),texture_blue_noise:new ct(null),texture_blue_noise_in_disk:new ct(this.blueNoiseInDiskTexture),frame_index:new ct(0),fog_enabled:new ct(!1),fog_near:new ct(1),fog_far:new ct(1e3)}}),this.radius=128,this.aoColor={r:0,g:0,b:0},this.bias=.5,this.hbaoMaterial.uniforms.texture_depth.value=this.gBuffer.depthTexture,this.hbaoMaterial.uniforms.texture_normals.value=this.gBuffer.texture,this.needsSwap=!0,this.aaBuffer=new Ni(i,r,{minFilter:bi,magFilter:bi,wrapS:Tr,wrapT:Tr,depthBuffer:!1,type:or});let s=new lie({preset:Fp.ULTRA,edgeDetectionMode:WC.COLOR});this.effectPass=new $A(this.camera,s)}initialize(e,t,i){super.initialize(e,t,i),this.effectPass.initialize(e,t,i)}setBlueNoiseTexture(e){this.hbaoMaterial.uniforms.texture_blue_noise.value=e}setSize(e,t){this._width=e,this._height=t,this.depthBufferHighRes.setSize(e,t);let i=this._runHalfRes?.5:1,r=e*i,n=t*i;this.gBuffer.setSize(r,n),this.aoBuffer.setSize(r,n),this.hbaoMaterial.uniforms.resolution.value.set(r,n),this.aaBuffer.setSize(r,n),this.effectPass.setSize(r,n)}get runHalfRes(){return this._runHalfRes}set runHalfRes(e){this._runHalfRes=e,this.setSize(this._width,this._height)}setCamera(e){this.splineCamera=e}setScene(e){this.splineScene=e}setDepthTexture(e){this.depthBufferHighRes.depthTexture=e,Vg.uniforms.texture_depth_hrez.value=e,Vg.needsUpdate=!0}render(e,t,i){this.splineScene.overrideMaterial=Jze;let r=this.splineCamera.layers.mask;if(this.splineCamera.layers.set(5),e.setRenderTarget(this.gBuffer),e.clear(),e.render(this.splineScene,this.splineCamera),e.setRenderTarget(this.depthBufferHighRes),e.clear(),e.render(this.splineScene,this.splineCamera),this.splineScene.overrideMaterial=null,this.splineCamera.layers.mask=r,this.hbaoMaterial.uniforms.radius_of_influence.value=this.radius,this.hbaoMaterial.uniforms.ao_color.value.set(this.aoColor.r,this.aoColor.g,this.aoColor.b),this.hbaoMaterial.uniforms.bias.value=this.bias,this.hbaoMaterial.uniforms.fog_enabled.value=this.fogEnabled,this.hbaoMaterial.uniforms.fog_near.value=this.fogNear,this.hbaoMaterial.uniforms.fog_far.value=this.fogFar,this.hbaoMaterial.uniforms.frame_index.value=this.frameIndex,this.frameIndex++,this.splineCamera.isPerspectiveCamera){this.hbaoMaterial.uniforms.near.value=this.splineCamera.perspCamera.near,this.hbaoMaterial.uniforms.far.value=this.splineCamera.perspCamera.far;let n=this.splineCamera.perspCamera.projectionMatrix.elements,s=2/n[0],a=2/n[5],o=-(1-n[8])/n[0],l=-(1+n[9])/n[5];this.hbaoMaterial.uniforms.proj_info.value.set(s,a,o,l);let c=this.splineCamera.perspCamera.fov*(Math.PI/180),u=this.hbaoMaterial.uniforms.resolution.value.y/(Math.tan(c*.5)*2),h=this.hbaoMaterial.uniforms.radius_of_influence.value*.5*u;this.hbaoMaterial.uniforms.radius_in_screen_space.value=h,this.hbaoMaterial.uniforms.is_ortho.value=!1}else{this.hbaoMaterial.uniforms.near.value=this.splineCamera.orthoCamera.near,this.hbaoMaterial.uniforms.far.value=this.splineCamera.orthoCamera.far;let n=this.splineCamera.orthoCamera.projectionMatrix.elements,s=2/n[0],a=2/n[5],o=-(1+n[12])/n[0],l=-(1-n[13])/n[5];this.hbaoMaterial.uniforms.proj_info.value.set(s,a,o,l);let c=.5*(this.hbaoMaterial.uniforms.resolution.value.y/a),u=this.hbaoMaterial.uniforms.radius_of_influence.value*c;this.hbaoMaterial.uniforms.radius_in_screen_space.value=u,this.hbaoMaterial.uniforms.is_ortho.value=!0}this.runHalfRes?(this.fullscreenMaterial=this.hbaoMaterial,e.setRenderTarget(this.aoBuffer),e.clear(),e.render(this.scene,this.camera),this.fullscreenMaterial=Vg,Vg.uniforms.texture_ao_lrez.value=this.aoBuffer.texture,Vg.uniforms.texture_depth_lrez.value=this.gBuffer.depthTexture,Vg.uniforms.texture_depth_hrez.value=this.depthBufferHighRes.depthTexture,e.setRenderTarget(e.aoRenderTarget),e.clear(),e.render(this.scene,this.camera)):(this.fullscreenMaterial=this.hbaoMaterial,e.setRenderTarget(this.aaBuffer),e.clear(),e.render(this.scene,this.camera),this.effectPass.renderToScreen=!1,this.effectPass.render(e,this.aaBuffer,e.aoRenderTarget))}dispose(){this.gBuffer.dispose(),this.depthBufferHighRes.dispose(),this.aoBuffer.dispose()}},eBe=`
varying vec2 vUv;
void main() {
    vUv = uv;
    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,tBe=`
uniform sampler2D tInput;
uniform sampler2D tMap;
uniform vec2 resolution;
varying vec2 vUv;

uniform vec2 uResolution;
uniform vec2 uCoords;

// Draws a rectangle at center <st> with size <size>
float rectangle(vec2 st, vec2 size) {
    size = vec2(0.5) - size * 0.5;
    vec2 uv = vec2(step(size.x, st.x), step(size.y, st.y));
    uv *= vec2(step(size.x, 1.0 - st.x), step(size.y, 1.0 - st.y));

    return uv.x * uv.y;
}

uniform vec2 uSize;
uniform float uScale;
uniform float uDPR;
uniform float uCurrent;
uniform vec3 uSceneColor;

void main() {
    vec2 screenUv = gl_FragCoord.xy / uResolution.xy;
    screenUv *= 1.0 / uDPR;

    vec2 center = vec2(0.5, -0.5);
    vec2 outsideUv = screenUv;
    outsideUv += center;
    outsideUv -= uCoords.xy / uResolution.xy;
    outsideUv = (outsideUv - 0.5) + 0.5;
    outsideUv -= center;
    vec2 s = (uSize / uResolution) * uScale;
    float isOutside = 1.0 - rectangle(outsideUv, s);
    
    vec2 mid = vec2(0.5);
    vec2 insideUv = (screenUv - mid + s * mid) / s;
    vec4 background = texture2D(tInput, screenUv);
    vec4 image = texture2D(tMap, insideUv);
    gl_FragColor = mix(image, background, isOutside);
}
`,iBe=class extends hl{constructor(){super(new ki({vertexShader:eBe,fragmentShader:tBe,uniforms:{tInput:new ct(null),tMap:new ct(null),uResolution:new ct(new Me),uSize:new ct(new Me),uCoords:new ct(new Me),uScale:new ct(1),uSceneColor:new ct(new Yt(16711680)),uDPR:new ct(1),uCurrent:new ct(0)}}),"tInput"),this.needsSwap=!0}get uniforms(){return this.fullscreenMaterial.uniforms}get texture(){return this.uniforms.tMap.value}set texture(e){this.uniforms.tMap.value=e}},rBe=`
void main() {
    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,nBe=`
uniform sampler2D toScene;
uniform sampler2D fromScene;
uniform vec2 resolution;

uniform vec2 uResolution;
uniform float uDPR;

uniform float mixRatio;
uniform sampler2D tMixTexture;
uniform int useTexture;
uniform float threshold;

void main() {
	vec2 screenUv = gl_FragCoord.xy / uResolution.xy;
	screenUv *= 1.0 / uDPR;

	vec4 texel1 = texture2D( fromScene, screenUv );
	vec4 texel2 = texture2D( toScene, screenUv );

	if (useTexture==1) {
		
		vec4 transitionTexel = texture2D( tMixTexture, screenUv );
		float r = mixRatio * (1.0 + threshold * 2.0) - threshold;
		float mixf=clamp((transitionTexel.r - r)*(1.0/threshold), 0.0, 1.0);
		
		gl_FragColor = mix( texel1, texel2, mixf );
	} else {
		
		gl_FragColor = mix( texel1, texel2, mixRatio );
		
	}
}
`,sBe=[],aBe=class extends hl{constructor(){super(new ki({vertexShader:rBe,fragmentShader:nBe,uniforms:{toScene:new ct(null),fromScene:new ct(null),uResolution:new ct(new Me),uDPR:new ct(1),mixRatio:new ct(0),threshold:new ct(.1),useTexture:new ct(0),tMixTexture:{value:sBe[0]}}}),"toScene"),this.needsSwap=!0}get uniforms(){return this.fullscreenMaterial.uniforms}get texture(){return this.uniforms.fromScene.value}set texture(e){this.uniforms.fromScene.value=e}},oBe=`
void main() {
    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,lBe=`
uniform sampler2D inputBuffer;
uniform sampler2D blurredInputBuffer;
uniform sampler2D overlay;
uniform float blurIntensity;

uniform vec2 uResolution;
uniform float uDPR;

void main() {
	vec2 screenUv = gl_FragCoord.xy / uResolution.xy;
	screenUv *= 1.0 / uDPR;

	vec4 texel1 = texture2D( overlay, screenUv );
	vec4 texel2 = texture2D( inputBuffer, screenUv );
	vec4 texel3 = texture2D( blurredInputBuffer, screenUv );

	float blurMask2 = max(sign(texel1.a), 0.0) * blurIntensity;
    gl_FragColor = mix( mix(texel2, texel3, blurMask2), texel1, texel1.a );
}
`,cBe=class extends hl{constructor(){super(new ki({vertexShader:oBe,fragmentShader:lBe,uniforms:{inputBuffer:new ct(null),blurredInputBuffer:new ct(null),overlay:new ct(null),uResolution:new ct(new Me),uDPR:new ct(1),blurIntensity:new ct(0)}})),this._blurEnabled=!1,this.blurTarget=new Ni(1,1,{minFilter:bi,magFilter:bi,wrapS:Tr,wrapT:Tr}),this.blurPass=new l4({width:window.innerWidth,height:window.innerHeight,kernelSize:XC.HUGE,resolutionScale:.25}),this.blurPass.renderToScreen=!1,this.uniforms.blurredInputBuffer.value=this.blurTarget.texture}get uniforms(){return this.fullscreenMaterial.uniforms}get texture(){return this.uniforms.overlay.value}set texture(e){this.uniforms.overlay.value=e}setResolution(e,t,i=1){this.uniforms.uResolution.value.set(e,t),this.uniforms.uDPR.value=i,this.blurPass.setSize(e,t),this.blurTarget.setSize(e,t),this.blurPass.setSize(e,t)}get uiCanvas(){return this._uiCanvas}set uiCanvas(e){this._uiCanvas=e,e.texture&&(this.uniforms.overlay.value=e.texture);let t=e.frame;if(t){let i=t.data.backgroundBlur,r=i.radius;this._blurEnabled=i.enabled,this.uniforms.blurIntensity.value=this._blurEnabled?1:0,this.blurPass.scale=r/3}}render(e,t,i,r,n){this._blurEnabled&&(this.blurPass.setDepthTexture(this.getDepthTexture()),this.blurPass.render(e,t,this.blurTarget,r,n)),super.render(e,t,i,r,n)}},uBe=`
varying vec2 vUv;
void main() {
    vUv = uv;
    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,hBe=`
uniform sampler2D tInput;
uniform sampler2D tOverlayImage;
varying vec2 vUv;
uniform vec2 uResolution;
uniform vec2 uRightBottom;
uniform vec2 uImageSize;
uniform float uScale;
uniform float uDPR;

vec3 blendNormal(vec3 base, vec3 blend) {
	return blend;
}

vec3 blendNormal(vec3 base, vec3 blend, float opacity) {
	return (blendNormal(base, blend) * opacity + base * (1.0 - opacity));
}

vec4 drawFixedSizeImage(sampler2D image, vec2 screenUV, vec2 imageSize, vec2 imageCoords, vec2 screenSize, float dpr) {
	vec2 uv = (screenUV * screenSize * dpr - imageCoords) / (imageSize * dpr);
	if (uv.x < 0.0 || uv.x > 1.0 || uv.y < 0.0 || uv.y > 1.0) {
		return vec4(0.0);
	}
	return texture2D(image, uv);
}

void main() {
    vec2 screenUV = gl_FragCoord.xy / (uResolution.xy * uDPR);
	vec2 imageCoords = vec2(uResolution.x * uDPR - uImageSize.x * uScale * uDPR - uRightBottom.x * uDPR, uRightBottom.y * uDPR);
    vec4 background = texture2D(tInput, screenUV);
    vec4 image = drawFixedSizeImage(tOverlayImage, screenUV, uImageSize * uScale, imageCoords, uResolution, uDPR);
    gl_FragColor = vec4(blendNormal(background.rgb, image.rgb, image.a), max(background.a, image.a));
}
`,dBe=class extends hl{constructor(){super(new ki({vertexShader:uBe,fragmentShader:hBe,uniforms:{tInput:new ct(null),tOverlayImage:new ct(null),uResolution:new ct(new Me),uImageSize:new ct(new Me),uRightBottom:new ct(new Me(20,20)),uScale:new ct(.25),uDPR:new ct(1)}}),"tInput")}get uniforms(){return this.fullscreenMaterial.uniforms}get texture(){return this.uniforms.tOverlayImage.value}set texture(e){this.uniforms.tOverlayImage.value=e,this.uniforms.uImageSize.value.set(e.image.width,e.image.height)}};function A9(e,t){return t&&t.enabled&&e.push(t.effect),e}var fBe=e=>Object.values(Gi).includes(e)?e:Gi.NORMAL,pBe=class extends Vs{constructor(e,t){super(),this._needsDOFResize=t,this.postprocessingState=BA.defaultData,this._scene=new co,this._camera=new aa,this.effects=new Map,this.blueNoiseTexture=new Da,this._renderToScreen=!0,this._isUIOverlayEnabled=!1,this.clock=new Iwe,this.renderer=e,this.debug=!1,this.effects.set("bloom",new Tze),this.effects.set("chromaticAberration",new Pze),this.effects.set("vignette",new Lze),this.effects.set("noise",new Ize),this.effects.set("colorAverage",new Dze),this.effects.set("hueSaturation",new Rze),this.effects.set("brightnessContrast",new Cze),this.effects.set("depthOfField",new Oze),this.effects.set("pixelation",new zze),this.effectComposer=new Hze(this.renderer),this.effectComposer.autoRenderToScreen=!1,this.opaquePass=new SB(!0,this.scene,this.camera),this.opaquePass.clear=!0,this.transmissionPass=new Vze(this.scene,this.camera,this.renderer),this.aoPass=new $ze(this.scene,this.camera),this.taaPass=new kze,this.taaPass.renderToScreen=!1,this.helperPass=new Wze(this.camera),this.helperPass.renderToScreen=!1,this.stylesOverlayPass=new iBe,this.stylesOverlayPass.enabled=!1,this.uiOverlayPass=new cBe,this.uiOverlayPass.enabled=!1,this.logoOverlayPass=new dBe,this.logoOverlayPass.enabled=!1,this.sceneTransitionPass=new aBe,this.sceneTransitionPass.enabled=!1,this._initCopyPass(),this._initPasses()}set overlayTexture(e){e!==void 0?(this.stylesOverlayPass.texture=e,this.stylesOverlayPass.enabled=!0):this.stylesOverlayPass.enabled=!1}get overlayTexture(){return this.stylesOverlayPass.texture}set sceneHelpers(e){this.helperPass.sceneHelpers=e}get sceneHelpers(){return this.helperPass.sceneHelpers}set sceneHelpersOnTop(e){this.helperPass.sceneHelpersOnTop=e}get sceneHelpersOnTop(){return this.helperPass.sceneHelpersOnTop}get scene(){return this._scene}set scene(e){this._scene=e,this.opaquePass.setScene(e),this.transmissionPass.setScene(e),this.aoPass.setScene(e)}get camera(){return this._camera}set camera(e){let t=this._camera!==e;this._camera=e,this.opaquePass.setCamera(e),this.transmissionPass.setCamera(e),t&&this.transmissionPass.updatePasses(this.renderer),this.aoPass.setCamera(e),this.helperPass.setCamera(e),this.effects.get("depthOfField").setCamera(e)}updateRenderToScreen(){let e=!1;for(let t=this.effectComposer.passes.length-1;t>=0;t--){let i=this.effectComposer.passes[t];if(i.enabled===!0&&!e&&this._renderToScreen){i.renderToScreen=!0,e=!0;continue}i.renderToScreen=!1}}get isUIOverlayEnabled(){return this._isUIOverlayEnabled}disableUIOverlay(){this._isUIOverlayEnabled=!1}enableUIOverlay(){this._isUIOverlayEnabled=!0}disableHelpers(){this.helperPass.enabled=!1,this.updateRenderToScreen()}enableHelpers(){this.helperPass.enabled=!0,this.updateRenderToScreen()}updateBlueNoiseTexture(e){this.blueNoiseTexture=new Da(e,128,128),this.blueNoiseTexture.wrapS=lh,this.blueNoiseTexture.wrapT=lh,this.blueNoiseTexture.minFilter=Ci,this.blueNoiseTexture.magFilter=Ci,this.blueNoiseTexture.needsUpdate=!0}setAmbientOcclusionParams(e,t,i,r,n,s,a,o){this.aoPass.enabled=e,this.aoPass.radius=t,this.aoPass.bias=i,this.aoPass.aoColor=r,this.aoPass.fogEnabled=n,this.aoPass.fogNear=s,this.aoPass.fogFar=a,this.aoPass.runHalfRes!==!o&&(this.aoPass.runHalfRes=!o)}setTransmissionPassEnabled(e){this.transmissionPass.enabled=e,this.opaquePass.hasTransmissionPass=e}_initPasses(){var e,t,i;if((e=this.uvEffectPass)==null||e.dispose(),(t=this.effectPass)==null||t.dispose(),this.effectComposer.removeAllPasses(),this.transmissionPass.updatePasses(this.renderer),this.effectComposer.addPass(this.aoPass),this.effectComposer.addPass(this.opaquePass),this.effectComposer.addPass(this.transmissionPass),this.effectComposer.addPass(this.taaPass),this.postprocessingState.enabled){let r=[this.effects.get("pixelation")].reduce(A9,[]);r.length>0&&(this.uvEffectPass=new $A(this.camera,...r),this.uvEffectPass.renderToScreen=!1,this.effectComposer.addPass(this.uvEffectPass));let n=[this.effects.get("chromaticAberration"),this.effects.get("bloom"),this.effects.get("depthOfField"),this.effects.get("colorAverage"),this.effects.get("hueSaturation"),this.effects.get("brightnessContrast"),this.effects.get("vignette"),this.effects.get("noise")].reduce(A9,[]);if(n.length>0&&(this.effectPass=new $A(this.camera,...n),this.effectPass.renderToScreen=!1,this.effectComposer.addPass(this.effectPass),this._needsDOFResize&&((i=this.effects.get("depthOfField"))==null?void 0:i.enabled)&&window!==void 0)){let s=this.renderer.viewportWidth,a=this.renderer.viewportHeight;this.renderer.setSize(s-1,a-1),this.renderer.setSize(s,a)}}this.effectComposer.addPass(this.stylesOverlayPass),this.effectComposer.addPass(this.uiOverlayPass),this.effectComposer.addPass(this.sceneTransitionPass),this.effectComposer.addPass(this.helperPass),this.effectComposer.addPass(this.logoOverlayPass)}_initCopyPass(){if(this._savePass)return;let e=new Me;this.renderer.getDrawingBufferSize(e),this._rt=new Ni(e.x,e.y,{depthBuffer:!1,stencilBuffer:!1,wrapS:lh,wrapT:lh}),this._rt.samples=0,this._savePass=new bB(this._rt,!1),this._savePass.renderToScreen=!1}setCopyPass(e){this._rt=e,this._savePass=new bB(this._rt,!1),this.renderToScreen=!1}get renderToScreen(){return this._renderToScreen}set renderToScreen(e){if(this._renderToScreen===e)return;let t=this.effectComposer;!t||(e===!0?t.removePass(this._savePass):t.addPass(this._savePass),this._renderToScreen=e,this.updateRenderToScreen())}set sceneTransitionFromTexture(e){e!==this.sceneTransitionPass.texture&&(e!==null?this.sceneTransitionPass.enabled=!0:(this.sceneTransitionPass.enabled=!1,this.updateRenderToScreen()),this.sceneTransitionPass.texture=e)}setWatermark(e){this.logoOverlayPass.enabled=e!==null,e&&(this.logoOverlayPass.texture=e)}get texture(){return this._rt&&this._rt.texture}get renderTarget(){return this._rt}updatePostprocessing(e){let{enabled:t,...i}=e,r=!1;t!==this.postprocessingState.enabled&&(r=!0);for(let n of Object.entries(i)){let s=n[1],a=this.effects.get(n[0]);if(a){a.enabled!==s.enabled&&(r=!0),a.enabled=s.enabled;for(let[o,l]of Object.entries(s))o==="blendFunction"?a.blendFunction=fBe(l):a[o]=l}}this.postprocessingState=e,r&&this._initPasses()}render(){this.effectComposer.render(this.clock.getDelta())}setScissor(e,t,i,r){e instanceof ai?(this.effectComposer.inputBuffer.scissor.set(e.x,e.y,e.z,e.w),this.effectComposer.outputBuffer.scissor.set(e.x,e.y,e.z,e.w)):(this.effectComposer.inputBuffer.scissor.set(e,t,i,r),this.effectComposer.outputBuffer.scissor.set(e,t,i,r));let n=this.renderer.getPixelRatio();this.effectComposer.inputBuffer.scissor.multiplyScalar(n),this.effectComposer.outputBuffer.scissor.multiplyScalar(n),this.renderer.setScissor(e,t,i,r)}setScissorTest(e){this.effectComposer.inputBuffer.scissorTest=e,this.effectComposer.outputBuffer.scissorTest=e,this.renderer.setScissorTest(e)}setViewport(e,t,i,r){e instanceof ai?(this.effectComposer.inputBuffer.viewport.copy(e),this.effectComposer.outputBuffer.viewport.copy(e)):(this.effectComposer.inputBuffer.viewport.set(e,t,i,r),this.effectComposer.outputBuffer.viewport.set(e,t,i,r))}resize(e,t,i){if(this.effectComposer.setSize(e,t,i),this._rt){let r=this.renderer.getPixelRatio();this._rt.setSize(e*r,t*r)}}dispose(){var e,t;(e=this.uvEffectPass)==null||e.dispose(),(t=this.effectPass)==null||t.dispose(),this.effectComposer.dispose()}},mBe=e=>`

// PCSS implementation based on:
// https://www.gamedev.net/articles/programming/graphics/contact-hardening-soft-shadows-made-fast-r4906/
// NOTE: This number affects how big the shadow blur can
// possibly get. Bigger number == bigger blur, but less precise results

const float  gPenumbraFilterSize = 80.0;
const int   gPenumbraSamples = ${e};
const int gShadowSamples = ${e};
const float gShadowSamplesRpc = 1.0f / float(gShadowSamples);

#ifdef USE_SHADOWMAP
    #if NUM_DIR_LIGHT_SHADOWS > 0

        uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
        varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];

        struct DirectionalLightShadow {
            float shadowBias;
            float shadowNormalBias;
            float shadowRadius;
            vec2 shadowMapSize;
        };

        uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];

    #endif

    #if NUM_SPOT_LIGHT_SHADOWS > 0

        uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
        varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_SHADOWS ];

        struct SpotLightShadow {
            float shadowBias;
            float shadowNormalBias;
            float shadowRadius;
            vec2 shadowMapSize;
        };

        uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];

    #endif

    #if NUM_POINT_LIGHT_SHADOWS > 0

        uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
        varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];

        struct PointLightShadow {
            float shadowBias;
            float shadowNormalBias;
            float shadowRadius;
            vec2 shadowMapSize;
            float shadowCameraNear;
            float shadowCameraFar;
        };

        uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];

    #endif

    /*
    #if NUM_RECT_AREA_LIGHTS > 0

        // TODO (abelnation): create uniforms for area light shadows

    #endif
    */

float computePenumbra(int index, sampler2D shadowMap, float temporalAngle, float texelSize, vec2 uv, float compare, float texelScalar, float shadowRadius)
{
    float penumbra = 1.0;
    float blockerDepthAvg = 0.0;
    float blockerCount = 0.0;

    #pragma unroll_loop_start
    for(int i = 0; i < gPenumbraSamples; i ++)
    {
        vec2 offset = (vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize) * texelScalar;
        float depth = unpackRGBAToDepth( texture2D( shadowMap, uv + offset ) );

        if(depth < compare + 0.0001)
        {
            blockerDepthAvg += depth;
            blockerCount++;
        }
    }
    #pragma unroll_loop_end

    if (blockerCount > 0.0)
    {
        blockerDepthAvg /= blockerCount;

        // Compute penumbra
        penumbra = (compare - blockerDepthAvg) / (blockerDepthAvg);
        penumbra *= penumbra;
        penumbra *= 200.0 * penumbraSize[min(index, 5 - 1)]; // Magic number that affects how quickly the penumbra grows

        return clamp(penumbra, 0.00, 1.0);
    }
    return 0.0;
}

float vogelShadow(int index, sampler2D shadowMap, vec2 uv, float texelSize, float compare, float shadowRadius)
{
    float shadow         = 0.0f;

    // NOTE: When using TAA, we should use screen space interleaved gradient noise
    vec2 halton = haltonSequence[frameIndex];
    float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);
    float temporalAngle  = temporalOffset * PI2;

    float texelScalar = (gPenumbraFilterSize) / (texelSize * 1024.);
    float penumbra = computePenumbra(index, shadowMap, temporalAngle, texelSize, uv, compare, texelScalar, shadowRadius);
    if (penumbra == -1.0) {
        return 1.0;
    }

    #pragma unroll_loop_start
    for (int i = 0; i < gShadowSamples; i++)
    {
        vec2 vogelSample =  vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;
        // Overall blurring offset
        vec2 offset = vogelSample * (shadowRadius * 2.);

        // Penumbra offset
        offset += vogelSample * (penumbra * texelScalar);

        shadow += step( compare, unpackRGBAToDepth( texture2D( shadowMap, uv + offset ) ) );
    }
    #pragma unroll_loop_end

    return shadow * gShadowSamplesRpc;
}


    float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {

        return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );

    }

    vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {

        return unpackRGBATo2Half( texture2D( shadow, uv ) );

    }

    float VSMShadow (sampler2D shadow, vec2 uv, float compare ){

        float occlusion = 1.0;

        vec2 distribution = texture2DDistribution( shadow, uv );

        float hard_shadow = step( compare , distribution.x ); // Hard Shadow

        if (hard_shadow != 1.0 ) {

            float distance = compare - distribution.x ;
            float variance = max( 0.00000, distribution.y * distribution.y );
            float softness_probability = variance / (variance + distance * distance ); // Chebeyshevs inequality
            softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 ); // 0.3 reduces light bleed
            occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );

        }
        return occlusion;

    }

    float getShadow( int i, sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {

        float shadow = 1.0;

        shadowCoord.xyz /= shadowCoord.w;
        shadowCoord.z += shadowBias;

        // if ( something && something ) breaks ATI OpenGL shader compiler
        // if ( all( something, something ) ) using this instead

        bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
        bool inFrustum = all( inFrustumVec );

        bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );

        bool frustumTest = all( frustumTestVec );

        if ( frustumTest ) {

        #if defined( SHADOWMAP_TYPE_PCF )

            vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
            return vogelShadow(i, shadowMap, shadowCoord.xy, texelSize.x, shadowCoord.z, shadowRadius );

        #elif defined( SHADOWMAP_TYPE_PCF_SOFT )

            vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
            float dx = texelSize.x;
            float dy = texelSize.y;

            vec2 uv = shadowCoord.xy;
            vec2 f = fract( uv * shadowMapSize + 0.5 );
            uv -= f * texelSize;

            shadow = (
                texture2DCompare( shadowMap, uv, shadowCoord.z ) +
                texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
                texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
                texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
                mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
                     texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
                     f.x ) +
                mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
                     texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
                     f.x ) +
                mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
                     texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
                     f.y ) +
                mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
                     texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
                     f.y ) +
                mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
                          texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
                          f.x ),
                     mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
                          texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
                          f.x ),
                     f.y )
            ) * ( 1.0 / 9.0 );

        #elif defined( SHADOWMAP_TYPE_VSM )

            shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );

        #else // no percentage-closer filtering:

            shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );

        #endif

        }

        return shadow;

    }

    // cubeToUV() maps a 3D direction vector suitable for cube texture mapping to a 2D
    // vector suitable for 2D texture mapping. This code uses the following layout for the
    // 2D texture:
    //
    // xzXZ
    //  y Y
    //
    // Y - Positive y direction
    // y - Negative y direction
    // X - Positive x direction
    // x - Negative x direction
    // Z - Positive z direction
    // z - Negative z direction
    //
    // Source and test bed:
    // https://gist.github.com/tschw/da10c43c467ce8afd0c4

    vec2 cubeToUV( vec3 v, float texelSizeY ) {

        // Number of texels to avoid at the edge of each square

        vec3 absV = abs( v );

        // Intersect unit cube

        float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
        absV *= scaleToCube;

        // Apply scale to avoid seams

        // two texels less per square (one texel will do for NEAREST)
        v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );

        // Unwrap

        // space: -1 ... 1 range for each square
        //
        // #X##         dim    := ( 4 , 2 )
        //  # #         center := ( 1 , 1 )

        vec2 planar = v.xy;

        float almostATexel = 1.5 * texelSizeY;
        float almostOne = 1.0 - almostATexel;

        if ( absV.z >= almostOne ) {

            if ( v.z > 0.0 )
                planar.x = 4.0 - v.x;

        } else if ( absV.x >= almostOne ) {

            float signX = sign( v.x );
            planar.x = v.z * signX + 2.0 * signX;

        } else if ( absV.y >= almostOne ) {

            float signY = sign( v.y );
            planar.x = v.x + 2.0 * signY + 2.0;
            planar.y = v.z * signY - 2.0;

        }

        // Transform to UV space

        // scale := 0.5 / dim
        // translate := ( center + 0.5 ) / dim
        return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );

    }

    float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {

        float shadow = 1.0;
        vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );

        // for point lights, the uniform @vShadowCoord is re-purposed to hold
        // the vector from the light to the world-space position of the fragment.
        vec3 lightToPosition = shadowCoord.xyz;

        // dp = normalized distance from light to fragment position
        float compare = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear ); // need to clamp?
        compare += shadowBias;

        // bd3D = base direction 3D
        vec3 bd3D = normalize( lightToPosition );

        vec2 halton = haltonSequence[frameIndex];
        float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);
        float temporalAngle  = temporalOffset * PI2;

        #if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_VSM )
            for (int i = 0; i < gShadowSamples; i++) {
                vec2 vogelSample = vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;

                // Overall blurring offset
                vec3 offset = vec3(vogelSample.x, vogelSample.y, -vogelSample.x) * (shadowRadius + 5.);

                // NOTE: Removed for now
                // Penumbra offset
                //offset += vec3(vogelSample.x, vogelSample.y, vogelSample.y)  * (penumbra * gPenumbraFilterSize);

                shadow += texture2DCompare( shadowMap, cubeToUV( bd3D + offset, texelSize.y ), compare );

            }
            return shadow * gShadowSamplesRpc;

        #elif defined( SHADOWMAP_TYPE_PCF_SOFT )
            for (int i = 0; i < 16; i++) {
                vec2 vogelSample = vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;

                // Overall blurring offset
                vec3 offset = vec3(vogelSample.x, vogelSample.y, -vogelSample.x) * (shadowRadius + 5.);

                shadow += texture2DCompare( shadowMap, cubeToUV( bd3D + offset, texelSize.y ), compare );

            }
            return shadow * (1.0 / 16.0);
        #else // no percentage-closer filtering

            return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), compare );

        #endif

    }

#endif
`,gBe=yi.lights_fragment_begin,vBe=yi.shadowmask_pars_fragment,T9=null,yBe=e=>{switch(e){case"low":return 8;case"medium":return 16;case"high":return 32;default:return 16}},xBe=(e="medium")=>{if(T9===e)return!1;T9=e;let t=yBe(e);yi.shadowmap_pars_fragment=mBe(t);let i=gBe.slice();i=i.replace("getShadow( spotShadowMap[ i ]","getShadow( UNROLLED_LOOP_INDEX + 3, spotShadowMap[ i ]"),i=i.replace("getShadow( directionalShadowMap[ i ]","getShadow( UNROLLED_LOOP_INDEX, directionalShadowMap[ i ]"),yi.lights_fragment_begin=i;let r=vBe.slice();return r=r.replaceAll("getShadow(","getShadow( UNROLLED_LOOP_INDEX, "),yi.shadowmask_pars_fragment=r,!0},wBe=`
attribute vec3 randomColor;
varying vec3 vNormal;
flat out vec3 vColor;
#include <skinning_pars_vertex>
#include <morphtarget_pars_vertex>
	
void main()
{
#include <beginnormal_vertex>
#include <morphnormal_vertex>
#include <skinbase_vertex>
#include <skinnormal_vertex>
vec3 transformed = vec3(position);
#include <morphtarget_vertex>
#include <skinning_vertex>

vNormal = normal;
vColor = randomColor;
gl_Position = projectionMatrix * (modelViewMatrix * vec4(transformed, 1.0));
}
`,bBe=`
uniform float depthContrast;
varying vec3 vNormal;
flat in vec3 vColor;
void main()
{
vec3 normal = (normalize(vNormal)).rgb;

float contrastDepth = (gl_FragCoord.z - 0.5) * depthContrast + 0.5;

vec3 resultColor = mix(mix(vColor, normal, 0.2), vec3(contrastDepth), 0.4);
gl_FragColor = vec4(resultColor, vColor.r);
gl_FragColor = vec4(resultColor, vColor.r);
}
`,jR=new ki({vertexShader:wBe,fragmentShader:bBe,uniforms:{depthContrast:{value:1}}}),C9=new jr,P9=new Me,_Be=class extends qJ{constructor(e){super(e),this._pixelRatio=this.getPixelRatio(),this.viewportWidth=1,this.viewportHeight=1,this.resolution=new Me,this.dummyCamera=new aa,this.sceneTransitionDuration=0,this.sceneTransitionTimeRemaining=-1,this.isXRCopyPassSet=!1,this.clear=(n=!0,s=!0,a=!0)=>{let o=this.getContext(),l=0;n&&(l|=o.COLOR_BUFFER_BIT),s&&(l|=o.DEPTH_BUFFER_BIT),a&&(l|=o.STENCIL_BUFFER_BIT),o.clear(l),o.clearBufferfv(o.COLOR,1,[0,0,0,1])},this.pipeline=new pBe(this,(e==null?void 0:e.needsDOFResize)??!1),this.autoClear=!1;let t=this.setPixelRatio.bind(this),i=this.setSize.bind(this);this.shadowMap.enabled=!0,this.shadowMap.type=YU,this.dummyCamera.matrixAutoUpdate=!1,this.domElement.removeAttribute("data-engine");let r=this.getContext();if(r&&"drawingBufferColorSpace"in r)try{r.drawingBufferColorSpace="display-p3"}catch(n){console.warn(n)}this.setPixelRatio=n=>{this._pixelRatio!==n&&(this._pixelRatio=n,t(n))},this.setSize=(n,s,a=!0)=>{var o,l;(this.viewportWidth!==n||this.viewportHeight!==s)&&(this.viewportWidth=n,this.viewportHeight=s,i(n,s,a),(o=this.normalRenderTarget)==null||o.setSize(n*this._pixelRatio,s*this._pixelRatio),this._resizeTransmission(n,s),(l=this.transmissionDepthTarget)==null||l.setSize(n*this._pixelRatio/2,s*this._pixelRatio/2),this.pipeline.resize(n,s,a))},this._superDispose=this.dispose,this.dispose=this._currentDispose}createAORenderTarget(){this.aoRenderTarget===void 0&&(this.aoRenderTarget=new Ni(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio,{generateMipmaps:!1,minFilter:bi,magFilter:bi,wrapS:Tr,wrapT:Tr,depthBuffer:!1}))}_resizeTransmission(e,t){var i,r;(i=this.transmissionRenderTarget)==null||i.setSize(e*this._pixelRatio/(this.hdTransmission?1:2),t*this._pixelRatio/(this.hdTransmission?1:2)),(r=this.aoRenderTarget)==null||r.setSize(e*this._pixelRatio/1,t*this._pixelRatio/1)}get hdTransmission(){return Kt.transmissionLod.value===1}set hdTransmission(e){Kt.transmissionLod.value=e===!0?1:2,this._resizeTransmission(this.viewportWidth,this.viewportHeight)}createTransmissionRenderTarget(){this.transmissionRenderTarget===void 0&&(this.transmissionRenderTarget=new Ni(this.viewportWidth*this._pixelRatio/(this.hdTransmission?1:2),this.viewportHeight*this._pixelRatio/(this.hdTransmission?1:2),{generateMipmaps:!0,minFilter:I0,magFilter:bi,wrapS:Tr,wrapT:Tr,depthBuffer:!1}),this.transmissionDepthTarget=new Ni(this.viewportWidth*this._pixelRatio/2,this.viewportHeight*this._pixelRatio/2,{minFilter:Ci,magFilter:Ci,depthBuffer:!1}))}createNormalRenderTarget(){this.normalRenderTarget===void 0&&(this.normalRenderTarget=new Ni(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio,{generateMipmaps:!1,minFilter:Ci,magFilter:Ci,type:or,depthTexture:new O0(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio)}))}renderNormal(e,t,i){this.normalRenderTarget&&(this.setClearColor(0),i.layers.enable(8),i.layers.disable(0),i.layers.disable(3),t.traverseEntity(r=>{r.layers.isEnabled(8)&&(r.copyPreviousMatrix=!1)}),this.setRenderTarget(this.normalRenderTarget),this.clear(),i instanceof aa?jR.uniforms.depthContrast.value=(i.far-i.near)/1e4:jR.uniforms.depthContrast.value=1,t.overrideMaterial=jR,this.render(t,i),this.setClearColor(t.bgColor,t.bgColor.a),this.setRenderTarget(null),t.overrideMaterial=e.wireframeState?DB:null,i.layers.enable(0),i.layers.enable(3),t.traverseEntity(r=>{r.layers.isEnabled(8)&&(r.copyPreviousMatrix=!0)}))}renderSplineSceneWithDummyCamera(e,t,i=1){this.dummyCamera.updateCameraState(t.dataPatched),this.dummyCamera.matrix.copy(t.matrixWorld);let r=t.height,n=t.width,s=this.viewportWidth/this.viewportHeight;n<r?n=r*s:r=n/s,this.dummyCamera.setViewplaneSize(n,r);for(let a=0;a<i;a++)this.renderSplineScene(e,this.dummyCamera)}renderSplineScene(e,t,{sceneHelpers:i=this.sceneHelpers,sceneHelpersOnTop:r=this.sceneHelpersOnTop,overrideTransmission:n=void 0,overrideNormal:s=void 0}={}){var d;let a=e instanceof g4?e.activePage:e,o=a.visible;a.visible=!0;let l=a.scene;this.xr.enabled&&(this.isXRCopyPassSet===!1&&this.getRenderTarget()!==null&&(this.pipeline.setCopyPass(this.getRenderTarget()),this.isXRCopyPassSet=!0),this.xr.updateCamera(t)),this.setClearColor(a.bgColor,a.bgColor.a),a.penumbraSizeArray.forEach((f,p)=>{Kt.penumbraSize.value[p]=f}),Kt.pixelRatioNode.value=this.getPixelRatio(),this.resolution.x!==0&&this.resolution.y!==0?Kt.resolution.value.set(this.resolution.x,this.resolution.y):Kt.resolution.value.set(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio),s!==void 0?(Kt.normalRenderTarget.value=s,Kt.normalRenderTargetDepth.value=C9):l.needsNormal()&&(this.createNormalRenderTarget(),Kt.normalRenderTarget.value=this.normalRenderTarget.texture,Kt.normalRenderTargetDepth.value=this.normalRenderTarget.depthTexture,this.renderNormal(l,a,t));let c=a.data.ao,u=c.occlusion;if(u&&(this.createAORenderTarget(),Kt.aoRenderTarget.value=this.aoRenderTarget.texture),Kt.aoEnabled.value=u,this.pipeline.setAmbientOcclusionParams(c.occlusion,c.radius,c.bias,a.aoColor,a.fog!==null,a.backupFog.near,a.backupFog.far,c.aoFullRes&&!zb),this.pipeline.aoPass.setBlueNoiseTexture(this.pipeline.blueNoiseTexture),this.pipeline.isUIOverlayEnabled&&((d=a.uiCanvas)==null?void 0:d.enabled)&&a.uiCanvas.texture&&a.uiCanvas.texture.image.width>0){let f=this.getSize(P9),p=this.getPixelRatio();(a.uiCanvas.width!==this.viewportWidth||a.uiCanvas.height!==this.viewportHeight||a.uiCanvas.dpr!==p)&&a.uiCanvas.applySize({width:this.viewportWidth,height:this.viewportHeight},p),a.uiCanvas.render(this),this.pipeline.uiOverlayPass.uiCanvas=a.uiCanvas,this.pipeline.uiOverlayPass.enabled=!0,this.pipeline.uiOverlayPass.setResolution(f.x,f.y,p),this.pipeline.updateRenderToScreen()}else this.pipeline.uiOverlayPass.enabled=!1,this.pipeline.updateRenderToScreen();if(this.pipeline.logoOverlayPass.enabled){let f=this.getSize(P9),p=this.getPixelRatio();this.pipeline.logoOverlayPass.uniforms.uResolution.value.set(f.x,f.y),this.pipeline.logoOverlayPass.uniforms.uDPR.value=p}let h=!1;if(n!==void 0)Kt.transmissionRenderTarget.value=n,Kt.transmissionRenderTargetDepth.value=C9,this.pipeline.setTransmissionPassEnabled(!1);else{let f=l.needsTransmission();f&&(this.transmissionRenderTarget===void 0&&(h=!0),this.createTransmissionRenderTarget(),Kt.transmissionRenderTarget.value=this.transmissionRenderTarget.texture,Kt.aspectRatio.value=hIe(this.viewportWidth,this.viewportHeight),Kt.transmissionRenderTargetDepth.value=this.transmissionDepthTarget.texture),this.pipeline.setTransmissionPassEnabled(f)}t.layers.enable(3),t.layers.enable(8),this.pipeline.sceneHelpers=i,this.pipeline.sceneHelpersOnTop=r,this.pipeline.scene=a,this.pipeline.camera=t,h&&this.pipeline.transmissionPass.updatePasses(this),this.pipeline.postprocessingState!==a.postprocessing&&(this.pipeline.updatePostprocessing(a.postprocessing),!i&&!r&&this.pipeline.disableHelpers()),this.clearAlphaOverride!==void 0&&this.setClearAlpha(this.clearAlphaOverride),l.shapeBlendIntances.forEach(f=>{f.onBeforeShadowPass(this)}),a.overrideMaterial=l.wireframeState?DB:null,this.pipeline.render(),Kt.frameIndex.value=(Kt.frameIndex.value+1)%16,t instanceof aa&&t.copyHistory(),a.visible=o}renderFromSceneForSceneTransitionPass(e,t,i){this.pipeline.renderToScreen=!1,this.pipeline.renderTarget,this.renderSplineScene(e,t),this.pipeline.sceneTransitionFromTexture=this.pipeline.renderTarget.texture,this.sceneTransitionDuration=i,this.sceneTransitionTimeRemaining=i,this.pipeline.renderToScreen=!0;let r=this.pipeline.sceneTransitionPass.uniforms;r.uDPR.value=window.devicePixelRatio,r.uResolution.value.set(this.domElement.width,this.domElement.height).divideScalar(window.devicePixelRatio)}_currentDispose(){var e,t,i,r,n,s;this._superDispose(),this.pipeline.dispose(),(e=this.aoRenderTarget)==null||e.dispose(),(t=this.transmissionRenderTarget)==null||t.dispose(),(i=this.transmissionDepthTarget)==null||i.dispose(),(r=this.normalRenderTarget)==null||r.dispose(),(s=(n=this.normalRenderTarget)==null?void 0:n.depthTexture)==null||s.dispose()}},cie=class extends Ub(Ywe){constructor(e,t=15,i=10066329){super(e,t,i),this.object=e,this.added=!1,this.name=`DirectionalLightHelper: ${e.uuid}`}raycast(e,t){Nb(this.object,cie.geometryHelper,e,t)}},uie=class extends Ub(qwe){constructor(e,t=15,i=6710886){super(e,t,i),this.object=e,this.name=`PointLightHelper: ${e.uuid}`}raycast(e,t){Nb(this.object,uie.geometryHelper,e,t)}},MB=class extends Ub(Xwe){constructor(e,t=6710886){super(e,t),this.object=e,this.name=`SpotLightHelper: ${e.uuid}`}raycast(e,t){Nb(this.object,MB.geometryHelper,e,t)}update(){if(this.object!==void 0){let e=MB._vector,t=this.object.distance?this.object.distance:1e3,i=t*Math.tan(this.object.angle);this.cone.scale.set(i,i,t),e.setFromMatrixPosition(this.object.target.matrixWorld),this.cone.lookAt(e);let r=this.color!==void 0?this.color:this.light.color;if(this.cone.material instanceof Array)for(let n=0,s=this.cone.material.length;n<s;n++)this.cone.material[n].color.set(r);else this.cone.material.color.set(r)}}},hie=MB;hie._vector=new N;var die=class extends hh{constructor(){super(),this.caretIndex=0,this._caretVisibleAlpha=1,this._selectionVisibleAlpha=.3,this.current={start:0,end:void 0},this.matrixAutoUpdate=!1,this.caretMesh=new yr(new au(1,1),new Ch({transparent:!0,opacity:0,side:na})),this.add(this.caretMesh),this.selectionMesh=new yr(new au(1,1),new Ch({color:2857471,transparent:!0,depthTest:!1,depthWrite:!1,opacity:0,side:na})),this.add(this.selectionMesh),this.hide()}get caretHeight(){var e;return((e=this.object)==null?void 0:e.AD)??0}show(e){this.visible=!0,this.object=e,this.caretMesh.scale.set(1,this.caretHeight,1),this.caretMesh.position.y=-this.caretHeight*.5,this.setCaretPosition(this.caretIndex),this.update()}hide(){this.visible=!1}update(){if(this.object===void 0)return;this.updateHelperMatrix();let{depth:e}=this.object.geometry.userData.parameters;this.caretMesh.position.z=e,this.selectionMesh.position.z=e}updateHelperMatrix(){if(this.object===void 0)return;let e=this.object,t=e.parent;t!==null&&t.updateWorldMatrix(!0,!1),e.matrixAutoUpdate&&e.updateMatrix(),t!==null?(this.matrixWorld.multiplyMatrices(t.matrixWorld,e.hiddenMatrix),this.matrixWorld.multiplyMatrices(this.matrixWorld,e.matrix)):this.matrixWorld.multiplyMatrices(e.hiddenMatrix,e.matrix),this.matrix.copy(this.matrixWorld);for(let i of this.children)i.matrixWorld.copy(this.matrixWorld);e.updateWorldMatrix(!0,!0)}setCaretColor(e){let t=this.caretMesh.material;t.color.setRGB(e.r,e.g,e.b);let i=this._caretVisibleAlpha===t.opacity;this._caretVisibleAlpha=e.a,i&&(t.opacity=this._caretVisibleAlpha)}setSelectionColor(e){this.selectionMesh.material.color.setRGB(e.r,e.g,e.b)}setCaretPosition(e,t={}){if(this.object===void 0)return;this.caretIndex=e;let i=this.object.wrappedText,[r,n]=eT(i,e),[s,a]=e>0?eT(i,e-1):[null,null];(e>0&&i.length?i[s].charAt(a):null)===`
`&&(r++,n=0),this.current.start=e,this.current.end=void 0;let[o,l]=WR(this.object,r,n),{AD:c,descender:u}=this.object,h=u+c*.5,{width:d,height:f,depth:p}=this.object.geometry.userData.parameters,v=typeof d=="string"?0:d,m=typeof f=="string"?0:f;this.caretMesh.scale.set(1,this.caretHeight,1),this.caretMesh.position.set(o-v*.5,l+h+m*.5,p),this.hideSelectionMesh(),this.showCaretMesh()}setSelection(e,t){if(this.object===void 0)return;let i=this.object.wrappedText;this.current.start=e,this.current.end=t;let r=[],n=[],s=SBe(i,e,t),{lineHeight:a,AD:o,descender:l}=this.object,c=l+o*.5-a*.5;for(let[m,g,y]of s)if(g!==y){let[x,_]=WR(this.object,m,g),[M,S]=WR(this.object,m,y);_+=c,S+=c,S+=a;let T=r.length/3;r.push(x,_,0),r.push(M,_,0),r.push(M,S,0),r.push(x,S,0),n.push(T+0,T+1,T+2),n.push(T+2,T+3,T+0)}let u=new Nt;u.setIndex(n),u.setAttribute("position",new _t(r,3));let{width:h,height:d,depth:f}=this.object.geometry.userData.parameters,p=typeof h=="string"?0:h,v=typeof d=="string"?0:d;this.selectionMesh.geometry.dispose(),this.selectionMesh.geometry=u,this.selectionMesh.position.x=-p*.5,this.selectionMesh.position.y=v*.5,this.selectionMesh.position.z=f,this.showSelectionMesh(),this.hideCaretMesh()}getSelectionFromPosition(e,t,i="previous"){if(this.object===void 0||this.object.font===void 0)return;let r=this.object.wrappedText,n=r.length,s=this.object.lineHeight,a=n*s,{height:o,verticalAlign:l}=this.object.geometry.userData.parameters,c=typeof o=="string"?0:o,u=0;l===3?u=c-a:l===2&&(u=c*.5-a*.5);let h=Math.min(Math.floor(Math.max(Math.min(-t-u,a),0)/s),n-1),d=this.object.charCoords[h],f=this.object.charWidths[h],p=0,v=!1;if(i==="previous"){for(let m=0;m<d.length;m++)if(d[m][0]+f[m]*.5-e>0){p=m,v=!0;break}}else if(i==="closest"){let m=1/0;for(let g=0;g<d.length;g++){let y=d[g][0]+f[g]*.5,x=Math.abs(y-e);x<m&&(m=x,p=g,v=!0)}}else for(let m=0;m<d.length;m++){let g=d[m][0],y=d[m][0]+f[m];if(e>=g&&e<y){p=m,v=!0;break}}return v||(p=d.length),{index:this.getGlobalIndexFromLineAndCharIndexes(r,h,p),lineIndex:h,characterIndex:p}}getGlobalIndexFromLineAndCharIndexes(e,t,i){return e.slice(0,t).reduce((r,n)=>r+=n.length,0)+i}showSelectionMesh(){this.selectionMesh.material.opacity=this._selectionVisibleAlpha}hideSelectionMesh(){this.selectionMesh.material.opacity=0}showCaretMesh(){this.caretMesh.material.opacity=this._caretVisibleAlpha}hideCaretMesh(){this.caretMesh.material.opacity=0}};function WR(e,t,i){let{charCoords:r,charWidths:n,initialOffsetY:s,lineHeight:a}=e;if(r[t]&&r[t].length===0||r.length===0){let u=0,{horizontalAlign:h}=e.data.geometry,d=e.wrappedText,{width:f}=e.geometry.userData.parameters;return d.length===1&&d[0].length===0&&(h===3?u=f*.5:h===2&&(u=f)),[u,s-a*t]}let o=r[t];if(o===void 0||o.length===0)return[0,0];let[l,c]=o[Math.min(i,o.length-1)];return i>=o.length&&(l+=n[t][i-1]),[l,c]}function eT(e,t){var r;let i=0;for(let n=0;n<e.length;n++){let s=e[n],a=t-i;if(a<=s.length)return[n,a];i+=s.length}return[Math.max(0,e.length-1),((r=e[e.length-1])==null?void 0:r.length)??0]}function SBe(e,t,i){let[r,n]=eT(e,t),[s,a]=eT(e,i),o=[];n>=e[r].length&&(r++,n=0);for(let l=r;l<=s;l++){let c=e[l],u=l===r?n:0,h=l===s?a:c.length;o.push([l,u,h])}return o}function MBe(e,t){let i=Ds.fromHex(3223857),r=.8;for(let n of e.layers){if(n.data.type==="light"||n.data.type==="displace"||n.data.type==="fresnel"||n.data.type==="matcap"||n.data.type==="texture"||n.data.type==="toon"||n.data.type==="outline"||n.data.type==="transmission"||n.data.type==="noise")continue;let s=typeof n.data.alpha=="string"?Number(t.getVariable(n.data.alpha)):n.data.alpha;if(n.data.type==="color"&&s>.3){i=EBe(n.data.color,t),r=s;break}else if((n.data.type==="depth"||n.data.type==="gradient")&&s>.3){let a=ABe(n.data);i={r:a[0],g:a[1],b:a[2]},r=typeof n.data.alpha=="string"?1:n.data.alpha;break}}return{...i,a:r}}function EBe(e,t){return typeof e=="string"?t.data.colors[e]:e}function ABe(e){return e.colors[0]}function TBe(e,t){e.shadow.camera.right=t/2,e.shadow.camera.left=-t/2,e.shadow.camera.top=t/2,e.shadow.camera.bottom=-t/2,e.shadow.needsUpdate=!0}var fie=class extends a4(Rwe,cie){constructor(e,t,i){super(),this.super_Entity(e,t),this.castShadow=!0,this.shadow.mapSize.width=2048,this.shadow.mapSize.height=2048,this.shadow.normalBias=1,this.layers.enable(3);let r=this.shadow.camera;r.top=1250,r.bottom=-1250,r.right=1250,r.left=-1250,r.near=-1e4,r.far=2500;let n=new mA(this.shadow.camera);n.visible=!1,this.gizmos.shadowmap=n}update(){this.shadow.camera.updateProjectionMatrix();for(let e in this.gizmos){let t=this.gizmos[e];t instanceof mA&&t.update()}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.objectHelper&&this.objectHelper.update()}updateState(e,t){this.updateState_Light(e,t);let i=e.depth!==void 0&&e.depth!==this.shadow.camera.far||e.size!==void 0&&e.size/2!==this.shadow.camera.right;e.size!==void 0&&TBe(this,e.size),e.shadowRadius!==void 0&&(this.shadow.radius=e.shadowRadius),e.shadowResolution!==void 0&&(this.shadow.mapSize.set(e.shadowResolution,e.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null)),e.penumbraSize!==void 0&&t.scene.markPenumbraSizeDirty(),i&&this.update()}},D9=new N,R9=new N,I9=new ri,pie=class extends a4(Twe,hie){constructor(e,t,i){super(),this.super_Entity(e,t),this.castShadow=!0,this.shadow.mapSize.width=1024,this.shadow.mapSize.height=1024,this.shadow.normalBias=1,this.layers.enable(3);let r=this.shadow.camera;r.fov=Tt.RAD2DEG*2*this.angle,r.aspect=1,r.near=100,r.far=2500;let n=new mA(this.shadow.camera);n.visible=!1,this.gizmos.shadowmap=n,this.update()}update(){this.shadow.camera.updateProjectionMatrix();for(let e in this.gizmos){let t=this.gizmos[e];t instanceof mA&&t.update()}}updateMatrixWorld(e){super.updateMatrixWorld(e),R9.setFromMatrixPosition(this.matrixWorld),I9.setFromRotationMatrix(this.matrixWorld),D9.copy(this.up).applyQuaternion(I9).negate().multiplyScalar(this.distance),this.target.position.copy(R9).add(D9),this.target.updateMatrixWorld(),this.objectHelper&&this.objectHelper.update()}updateState(e,t){this.updateState_Light(e,t),e.distance!==void 0&&(this.distance=e.distance),e.decay!==void 0&&(this.decay=e.decay),e.angle!==void 0&&(this.angle=e.angle),e.penumbra!==void 0&&(this.penumbra=e.penumbra),e.shadowRadius!==void 0&&(this.shadow.radius=e.shadowRadius),e.penumbraSize!==void 0&&t.scene.markPenumbraSizeDirty(),e.shadowResolution!==void 0&&(this.shadow.mapSize.set(e.shadowResolution,e.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null))}};function CBe(e){let t=(e[0][0]+e[1][1])/2,i=(e[0][0]-e[1][1])/2,r=(e[1][0]+e[0][1])/2,n=(e[1][0]-e[0][1])/2,s=Math.sqrt(t*t+n*n),a=Math.sqrt(i*i+r*r),o=s+a,l=s-a,c=Math.atan2(r,i),u=Math.atan2(n,t),h=(u-c)/2,d=(u+c)/2,f=[[Math.cos(d),Math.sin(d)],[-Math.sin(d),Math.cos(d)]],p=[[o,0],[0,l]],v=[[Math.cos(h),Math.sin(h)],[-Math.sin(h),Math.cos(h)]];return f[0][0]*=-1,f[0][1]*=-1,v[0][0]*=-1,v[1][0]*=-1,[f,p,v]}function o2(e,t){return[[e[0][0]*t[0][0]+e[0][1]*t[1][0],e[0][0]*t[0][1]+e[0][1]*t[1][1]],[e[1][0]*t[0][0]+e[1][1]*t[1][0],e[1][0]*t[0][1]+e[1][1]*t[1][1]]]}function L9(e){return[[e[0][0],e[1][0]],[e[0][1],e[1][1]]]}function PBe(e){let[t,i,r]=CBe(e),n=o2(t,L9(r)),s=o2(o2(r,i),L9(r)),a=Math.atan2(n[1][0],n[0][0]),o=[s[0][0],s[1][1]],l=[s[0][1]/s[1][1],s[1][0]/s[0][0]];return{rotation:a,scale:o,shear:l}}function DBe({rotation:e,scale:t,shear:i}){let r=Math.cos(e),n=Math.sin(e),s=[[r,-n],[n,r]],a=[[t[0],i[0]*t[1]],[i[1]*t[0],t[1]]],o=o2(s,a);return[o[0][0],o[1][0],o[0][1],o[1][1]]}var Wi;(e=>{function t(){return[1,0,0,0,1,0,0,0,1]}e.identity=t;function i(S,T=e.identity()){for(let E=0,C=S.length;E<C;E++)T[E]=S[E];return T}e.copy=i;function r(S,T,E,C,A,D){return e.setAbcdef(e.identity(),S,T,E,C,A,D)}e.create=r;function n(S,T,E,C,A,D,R){return S[0]=T,S[1]=C,S[2]=D,S[3]=E,S[4]=A,S[5]=R,S}e.setAbcdef=n;function s(S,T){let[E,C,A,D,R,L]=o(S),[O,H,j,Y,z,V]=o(T),U=O*E+H*A,k=O*C+H*D,X=j*E+Y*A,re=j*C+Y*D,q=z*E+V*A+R,ee=z*C+V*D+L;return e.create(U,k,X,re,q,ee)}e.append=s;function a(S,T){let[E,C,A,D,R,L]=o(S),[O,H,j,Y,z,V]=o(T),U=E,k=C,X=A,re=D;(O!==1||H!==0||j!==0||Y!==1)&&(U=E*O+C*j,k=E*H+C*Y,X=A*O+D*j,re=A*H+D*Y);let q=R*O+L*j+z,ee=R*H+L*Y+V;return e.create(U,k,X,re,q,ee)}e.prepend=a;function o(S){return[S[0],S[3],S[1],S[4],S[2],S[5]]}e.getAbcdef=o;function l(S){let[T,E,C,A,D,R]=e.getAbcdef(S),L=T*A-E*C,O=A/L,H=-E/L,j=-C/L,Y=T/L,z=(C*R-A*D)/L,V=-(T*R-E*D)/L;return e.create(O,H,j,Y,z,V)}e.invert=l;function c([S,T],E){let[C,A,D,R,L,O]=e.getAbcdef(E);return[C*S+D*T+L,A*S+R*T+O]}e.apply=c;function u(S,T){let[E,C,A,D,R,L]=e.getAbcdef(T),O=1/(E*D+A*-C),[H,j]=S;return[D*O*H+-A*O*j+(L*A-R*D)*O,E*O*j+-C*O*H+(-L*E+R*C)*O]}e.applyInverse=u;function h(S,T,E=T){let[C,A,D,R,L,O]=e.getAbcdef(S);return e.setAbcdef(S,C*T,A*E,D*T,R*E,L*T,O*E),S}e.scale=h;function d(S,T){let E=Math.cos(T),C=Math.sin(T),[A,D,R,L,O,H]=e.getAbcdef(S);return e.setAbcdef(S,A*E-D*C,A*C+D*E,R*E-L*C,R*C+L*E,O*E-H*C,O*C+H*E),S}e.rotate=d;function f(S,T,E){let[C,A]=E,D=e.translate(S,-C,-A);return D=e.rotate(D,T),D=e.translate(D,C,A),D}e.rotateAround=f;function p(S,T,E){let[C,A,D,R,L,O]=e.getAbcdef(S);return e.setAbcdef(S,C,A,D,R,L+T,O+E),S}e.translate=p;function v(S,T,E){let[C,A,D,R]=e.getAbcdef(S);return e.setAbcdef(S,C,A,D,R,T,E),S}e.setTranslate=v;function m(S,T,E){let[C,A,D,R]=e.getAbcdef(S);return e.setAbcdef(S,C,A,D,R,T,E),S}e.setPosition=m;function g(S){let[T,E,C,A]=e.getAbcdef(S),D=Math.sqrt(T*T+E*E),R=Math.sqrt(C*C+A*A);return[D,R]}e.getScale=g;function y(S){let[,,,,T,E]=e.getAbcdef(S);return[T,E]}e.getPosition=y;function x(S,T){return e.decompose(S,T).rotation}e.getRotation=x;function _(S,T){let[E,C,A,D,R,L]=e.getAbcdef(S),{rotation:O,scale:H,shear:j}=PBe([[E,A],[C,D]]);return{position:[R+(T[0]*E+T[1]*A)-T[0],L+(T[0]*C+T[1]*D)-T[1]],scale:H,rotation:O,shear:j,pivot:T}}e.decompose=_;function M(S,T,E,C,A=[0,0]){let[D,R]=S,[L,O]=C,[H,j,Y,z]=DBe({rotation:E,scale:T,shear:A}),V=D-(L*H+O*Y)+L,U=R-(L*j+O*z)+O;return e.create(H,j,Y,z,V,U)}e.compose=M})(Wi||(Wi={}));var RBe=Math.PI/180;function IBe(e,t,i,r,n,s){let a=e-i,o=t-r;return a*a/(n*n)+o*o/(s*s)<=1}function LBe(e){return e*RBe}var ys=class{constructor(e,t,i){this.uuid=e,this.data=t,this.localMatrix=Wi.identity(),this.worldMatrix=Wi.identity(),this.ignoreCameraZoom=!1,this.visible=!0,this._singleBBox=new EB,this._recursiveBBox=new EB,this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0,this.stateSelection=null,this.prevState=null,this.currentState=null,this.reversibleToState=null,this.currentTransitionEvent=null,this.previousAction=null,this.name="",this.position=[0,0],this.scale=[1,1],this.rotation=0,this.shear=[0,0],this.emitter=HC(),this.dpr=i.dpr??1,this.dataPatched=t}project(e,t){let i=this.worldMatrix;return t&&(i=Wi.append(t.worldMatrix,i)),Wi.applyInverse(e,i)}intersects(e,t,i,r=!1){return this.visible&&!this.data.raycastLock&&this.intersectsInLocalSpace(...this.project([e,t],i),r)}intersectsInLocalSpace(e,t,i=!1){let{min:r,max:n}=i?this.recursiveBBox:this.singleBBox;return e>=r[0]&&e<=n[0]&&t>=r[1]&&t<=n[1]}applyTransforms(e){e.setTransform(this.worldMatrix,this.ignoreCameraZoom)}get singleBBox(){return this.singleBBoxNeedsUpdate&&(this.singleBBoxNeedsUpdate=!1,this._singleBBox.setFromObjectSize(this,!1),this._singleBBox.computeVertices(),this._singleBBox.computeEdges()),this._singleBBox}get recursiveBBox(){return this.recursiveBBoxNeedsUpdate&&(this.recursiveBBoxNeedsUpdate=!1,this._recursiveBBox.setFromObjectSize(this,!0),this._recursiveBBox.computeVertices(),this._recursiveBBox.computeEdges()),this._recursiveBBox}updateLocalMatrix(){this.localMatrix=Wi.compose(this.position,this.scale,LBe(this.rotation),cm.getPivot(this.dataPatched),this.shear)}updateWorldMatrix(e,t,i){let r=this.parent;t&&r!==null&&r!==void 0&&r.updateWorldMatrix(e,!0,!1),e&&this.updateLocalMatrix(),this.parent?this.worldMatrix=Wi.append(this.parent.worldMatrix,this.localMatrix):this.worldMatrix=Wi.copy(this.localMatrix),this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0}get pivot(){return cm.getPivot(this.data)}getCenter(){return[0,0]}getHalfSize(){return[0,0]}get id(){return this.uuid}resetBBoxNeedsUpdateSelf(){this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0}resetBBoxNeedsUpdate(){this.resetBBoxNeedsUpdateSelf(),this.traverseAncestors(e=>{e.resetBBoxNeedsUpdateSelf()})}updateTransformState(e){let t=!1;e.position!==void 0&&(t=!0,this.position=e.position),e.rotation!==void 0&&(t=!0,this.rotation=e.rotation),e.scale!==void 0&&(t=!0,this.scale=e.scale),e.shear!==void 0&&(t=!0,this.shear=e.shear),t&&(this.updateWorldMatrix(!0,!1,!0),this.resetBBoxNeedsUpdate())}updateByOp(e,t,i){e.type===0&&e.props.visible!==void 0&&(this.visible=e.props.visible),this.data=t,this.data=t;let r=e,n=pr(e.path,["states","*"]);if(n!==null){if(e.type===0){let[s]=n;if((this==null?void 0:this.stateSelection)===s){let a={...e.props};if(delete a.name,Object.values(e.props).some(o=>o===void 0)){let o=this.data;if(o!==void 0){let l=Xn.zoom(o,e.path.slice(2));if(l)for(let c in e.props)e.props[c]===void 0&&c in l&&(a[c]=l[c])}}r={...e,props:a,path:e.path.slice(2)}}}}else if(e.type===0){let s=this.stateSelection?this.data.states.data(this.stateSelection):void 0;if(s!==void 0){if(e.props.name!==void 0&&s.name){let{name:o,...l}=s;s=l}let a=Xn.removeOverridden(e.path,e.props,s);r={...e,props:a}}}this.updateByPatchedOpBase(r,Yp.patch(this.data,this.stateSelection?this.data.states.data(this.stateSelection):void 0),i)}changeSelectedState(e,t,i=!1){if(!(this.data.states.length===0&&!i)){for(let r of this.data.states)Yp.toOps(this.data,r.data).forEach(n=>{let s=AA.replaceProps(n,this.data);this.dataPatched=this.data,this.updateByPatchedOp(s,this.data,t)});if(e!==null){let r=this.data.states.data(e);r&&(this.dataPatched=Yp.patch(this.data,r),Yp.toOps(this.data,r).forEach(n=>{this.updateByPatchedOp(n,this.dataPatched,t)}))}i&&this.updateTransformState(this.dataPatched),this.stateSelection=e}}updateState(e,t){e.name!==void 0&&(this.name=e.name),e.visible!==void 0&&(this.visible=e.visible),this.updateTransformState(e)}updateByPatchedOpBase(e,t,i){this.dataPatched=t,this.updateByPatchedOp(e,t,i)}updateByPatchedOp(e,t,i){e.path.length===0&&e.type===0&&this.updateState(e.props,i),this.requestRender()}traverseFrameAncestors(e){this.traverseAncestors(t=>{t.data.type==="frame2d"&&e(t)})}traverseAncestors(e){let t=this.parent;for(;t;)e(t),t=t.parent}requestRender(){this.traverseFrameAncestors(e=>{e.requestRender()})}clone(e){let t=new ys(this.uuid,this.data,e);return t.parent=void 0,t}addEventListener(e,t){this.emitter.on(e,t)}removeEventListener(e,t){this.emitter.off(e,t)}dispatchEvent(e){this.emitter.emit(e.type,{...e,target:e.target??this})}traverseSortNextHelper(){let e=this.parent;if(e){let t=e.children;if(t){let i=t.indexOf(this)+1;return t[i]?t[i]:e.traverseSortNextHelper()}}}sortNext(){let e=this.children;return e&&e.length>0&&e[0]?e[0]:this.traverseSortNextHelper()}isDescendantOf(e){e instanceof ys&&(e=e.uuid);let t=this;for(;t.parent;){if(t.parent.uuid===e)return!0;t=t.parent}return!1}},Yl=class extends ys{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this.context=i,this.children=[]}add(e){e.parent&&e.parent instanceof Yl&&e.parent.remove(e),this.children.push(e),e.parent=this}remove(e){let t=this.children.indexOf(e);t>=0&&(this.children.splice(t,1),e.parent=void 0)}traverse(e){let t=e(this);if(t!==!0)for(let i of this.children)i instanceof Yl?i.traverse(e):t=e(i)}intersectsChildrenHelper(e,t,i,r,n){for(let s of this.children)if(s.intersects(e,t,i,!1)&&(n.push(s),r)||s instanceof Yl&&s.intersectsChildrenHelper(e,t,i,r,n))return!0;return!1}intersectsChildren(e,t,i,r=!1,n=[],s=!1){return this.intersectsChildrenHelper(e,t,i,r,n),n}intersectsChildrenHelperReverse(e,t,i,r,n){for(let s of this.children)if(s instanceof Yl&&s.intersectsChildrenHelperReverse(e,t,i,r,n)||s.intersects(e,t,i,!1)&&(n.push(s),r))return!0;return!1}intersectsChildrenReverse(e,t,i,r=!1,n=[],s=!1){return this.intersectsChildrenHelperReverse(e,t,i,r,n),n}updateWorldMatrix(e,t,i){if(super.updateWorldMatrix(e,t,i),i&&this.children)for(let r of this.children)r.updateWorldMatrix(e,!1,!0)}find(e){let t;return this.traverse(i=>{i.uuid===e&&(t=i)}),t}innerDrawChildren(e){for(let t=this.children.length-1;t>=0;t--)this.children[t].draw(e)}resetBBoxNeedsUpdate(){super.resetBBoxNeedsUpdate(),this.traverse(e=>{e.resetBBoxNeedsUpdateSelf()})}clone(e){let t=new Yl(this.uuid,this.data,e);t.parent=void 0;for(let i of this.children)t.add(i.clone(e));return t}},xf=class extends Yl{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this.updateState(t,i)}draw(e){!this.visible||(e.save(),this.applyTransforms(e),this.innerDrawChildren(e),e.restore())}clone(e){let t=new xf(this.uuid,this.data,e);t.parent=void 0;for(let i of this.children)t.add(i.clone(e));return t}};function OBe(e,t){let[[i,r],[n,s]]=e,[[a,o],[l,c]]=t,u=(i-n)*(o-c)-(r-s)*(a-l);if(u===0)return!1;let h=((i-a)*(o-c)-(r-o)*(a-l))/u,d=-((i-n)*(r-o)-(r-s)*(i-a))/u;return h>=0&&h<=1&&d>=0&&d<=1}var mie=[[-1,1],[-1,-1],[1,-1],[1,1]],O9=(e,t,i)=>{let r=e.getCenter(),n=e.getHalfSize(),s=Wi.append(t,e.worldMatrix);n[0]===0&&n[1]===0?i.push(Wi.apply(r,s)):mie.forEach(a=>{let o=[a[0]*n[0]+r[0],a[1]*n[1]+r[1]];i.push(Wi.apply(o,s))})},EB=class{constructor(){this.matrix=Wi.identity(),this.min=[1/0,1/0],this.max=[-1/0,-1/0],this.vertices=[],this.edges=[]}setFromObjectSize(e,t=!1){e.updateWorldMatrix(),this.makeEmpty(),Wi.copy(e.worldMatrix,this.matrix);let i=Wi.invert(e.worldMatrix);this.expandByObjectSize(e,i,t)}expandByObjectSize(e,t,i=!1){let r=[];i===!0&&e instanceof Yl?e.traverse(n=>{n.visible&&O9(n,t,r)}):O9(e,t,r),this.setFromPoints(r)}setFromSize(e,t,i){this.makeEmpty(),Wi.copy(i,this.matrix),this.expandBySize(e,t,i)}expandBySize(e,t,i){[Wi.apply([0,0],i),Wi.apply([0,t],i),Wi.apply([e,t],i),Wi.apply([e,0],i)].forEach(r=>this.expandByPoint(r))}getCenter(){let[e,t]=this.min,[i,r]=this.getHalfSize();return Wi.apply([e+i,t+r],this.matrix)}getSize(){return[this.max[0]-this.min[0],this.max[1]-this.min[1]]}getHalfSize(){return[(this.max[0]-this.min[0])*.5,(this.max[1]-this.min[1])*.5]}makeEmpty(){this.min=[1/0,1/0],this.max=[-1/0,-1/0]}setFromPoints(e){this.makeEmpty();for(let t of e)this.expandByPoint(t)}expandByPoint(e){this.min=[Math.min(this.min[0],e[0]),Math.min(this.min[1],e[1])],this.max=[Math.max(this.max[0],e[0]),Math.max(this.max[1],e[1])]}computeVertices(){let[e,t]=this.getHalfSize(),i=this.getCenter(),[r,n,s,a]=Wi.getAbcdef(this.matrix),o=Wi.create(r,n,s,a,i[0],i[1]);this.vertices=mie.map(([l,c])=>Wi.apply([l*e,c*t],o))}computeEdges(){this.edges=[];for(let e=0,t=this.vertices.length;e<t;++e)this.edges.push([this.vertices[e],this.vertices[(e+1)%t]])}project(e,t){let i=this.matrix;return t&&(i=Wi.append(t.worldMatrix,i)),Wi.applyInverse(e,i)}intersects(e,t,i){return this.intersectsInLocalSpace(...this.project([e,t],i))}intersectsInLocalSpace(e,t){let{min:i,max:r}=this;return e>=i[0]&&e<=r[0]&&t>=i[1]&&t<=r[1]}containsPoint(e){let[t,i]=e,[r,n]=this.min,[s,a]=this.max;return t>=r&&t<=s&&i>=n&&i<=a}intersectsBBox2D(e){for(let t=0,i=this.edges.length;t<i;t++){let r=this.edges[t];for(let n=0,s=e.edges.length;n<s;n++){let a=e.edges[n];if(OBe(r,a))return!0}}for(let t=0,i=e.vertices.length;t<i;t++){let r=e.vertices[t];if(this.containsPoint(r))return!0}return!1}ensureMinMax(){let e=this.min,t=this.max;this.min=[Math.min(e[0],t[0]),Math.min(e[1],t[1])],this.max=[Math.max(e[0],t[0]),Math.max(e[1],t[1])]}copy(e){this.min=[...e.min],this.max=[...e.max],Wi.copy(e.matrix,this.matrix),this.computeVertices(),this.computeEdges()}clone(){let e=new EB;return e.copy(this),e}},gie,zBe=new Promise(e=>{gie=e}),z9=!1,AM;function BBe(){if(z9)return;if(AM)return AM;async function e(){let t=await Af(()=>import("./ui-L7l3pL7d.js"),[]);gie(t.default??t),z9=!0}return AM=e(),AM}function B9(e){let t=!1;return e.scene.objects.traverse((i,r)=>{(r.type==="Mesh"&&r.geometry.type==="UIGeometry"||r.type==="Page"&&r.uiFrame!==void 0)&&(t=!0)}),t}var di,XR;async function FBe(e){let t=await zBe;di||(XR||(XR=t({locateFile:()=>e})),di=await XR)}var F9=Wi.identity(),vie=class{constructor(e,t=1){this.canvas=e,this._dpr=t,this._width=0,this._height=0,this._strokeMode="inside",this._layerBlur=0,this._backgroundBlur=0,this._dropShadowBlur=0,this._dropShadowOffsetX=0,this._dropShadowOffsetY=0,this._dropShadowColor=cr.transparent,this._innerShadowBlur=0,this._innerShadowOffsetX=0,this._innerShadowOffsetY=0,this._innerShadowSpread=0,this._innerShadowColor=cr.transparent,this._fonts=new Map,this._isSizeDirty=!1;try{let i=e.getBoundingClientRect();e.width=i.width*t,e.height=i.height*t}catch{console.log(e.width,t)}this._currentM3Transform=F9,this._currentTransform=new Float32Array(F9)}get dpr(){return this._dpr}set dpr(e){this._dpr=e,this._isSizeDirty=!0}async init(){var e,t;if(!this.wasmURL)throw Error("Your must set the wasm binary url with renderer.wasmURL = ... before you can call renderer.init");await FBe(this.wasmURL),this._surface=di.MakeWebGLCanvasSurface(this.canvas),this.ctx=(e=this._surface)==null?void 0:e.getCanvas(),this._paint=new di.Paint,this._paint.setAntiAlias(!0),this._paintFill=this._paint.copy(),this._paintFill.setStyle(di.PaintStyle.Fill),this._paintStroke=this._paint.copy(),this._paintStroke.setStyle(di.PaintStyle.Stroke),(t=this.ctx)==null||t.scale(this.dpr,this.dpr)}get currentTransform(){return this._currentM3Transform}get currentTransformBuffer(){return this._currentTransform}set currentTransform(e){this._currentM3Transform=e,this._currentTransform.set(e)}async loadFont(e,t){let i=await(await fetch(e)).arrayBuffer();this.registerFont(i,t)}registerFont(e,t){if(this._fonts.has(t))return;let i=di.FontMgr.FromData(e);if(i)this._fonts.set(t,i);else throw new Error("Invalid font data for "+t)}get width(){return this._width}get height(){return this._height}set strokeColor(e){this._paintStroke&&this._paintStroke.setColor(TM(e),di.ColorSpace.DISPLAY_P3)}set fillColor(e){this._paintFill&&this._paintFill.setColor(TM(e),di.ColorSpace.DISPLAY_P3)}set lineWidth(e){this._paintStroke&&this._paintStroke.setStrokeWidth(this._strokeMode==="center"?e:e*2)}set strokeMode(e){this._strokeMode=e}set dropShadowBlur(e){this._dropShadowBlur=e}set dropShadowColor(e){this._dropShadowColor=e}set dropShadowOffsetX(e){this._dropShadowOffsetX=e}set dropShadowOffsetY(e){this._dropShadowOffsetY=e}set innerShadowBlur(e){this._innerShadowBlur=e}set innerShadowColor(e){this._innerShadowColor=e}set innerShadowOffsetX(e){this._innerShadowOffsetX=e}set innerShadowOffsetY(e){this._innerShadowOffsetY=e}set innerShadowSpread(e){this._innerShadowSpread=e}set layerBlur(e){this._layerBlur=e}set backgroundBlur(e){this._backgroundBlur=e}clear(){var e;(e=this.ctx)==null||e.clear(di.TRANSPARENT)}save(){var e;(e=this.ctx)==null||e.save()}restore(){var e;(e=this.ctx)==null||e.restore()}beginPath(){var e;(e=this._currentPath)==null||e.delete(),this._currentPath=new di.Path}closePath(){let e=this._currentPath;if(e){if(e.isEmpty())return;let t=e.getBounds();(t[3]-t[1]||t[2]-t[0])&&e.close()}}fill(){this._paintInner(this._paintFill,!0)}stroke(){this._paintInner(this._paintStroke,!1)}clipRect(e,t,i,r,n=0,s=0,a=0,o=0){var c,u;let l=di.XYWHRect(e,t,i,r);if(n===0&&s===0&&o===0&&a===0)(c=this.ctx)==null||c.clipRect(l,di.ClipOp.Intersect,!0);else{let h=di.RRectXY(l,n,n);h[4]=h[5]=n,h[6]=h[7]=s,h[8]=h[9]=a,h[10]=h[11]=o,(u=this.ctx)==null||u.clipRRect(h,di.ClipOp.Intersect,!0)}}_applyShadowOffsetMatrix(){if(this.ctx){let e=Wi.invert(this.currentTransform);this.ctx.concat(e);let t=Wi.translate(Wi.identity(),this._dropShadowOffsetX,this._dropShadowOffsetY);this.ctx.concat(t),this.ctx.concat(this._currentTransform)}}_applyEffectsToPaint(e,t,i=!0){var r,n,s,a;if(this.ctx&&this._currentPath){let o,l=!1;if(i&&this._hasDropShadow()){let c=e.copy();c.setColor(TM(this._dropShadowColor));let u;this._dropShadowBlur>0&&(u=di.MaskFilter.MakeBlur(di.BlurStyle.Normal,this._dropShadowBlur*this.dpr*(((r=this.camera)==null?void 0:r.scale)??1),!1),c.setMaskFilter(u)),this.ctx.save(),this.ctx.clipPath(this._currentPath,di.ClipOp.Difference,!0),this._applyShadowOffsetMatrix(),t(c),this.ctx.restore(),c.delete(),u==null||u.delete()}if(this._backgroundBlur>0&&i){this.ctx.save(),this.ctx.clipPath(this._currentPath,di.ClipOp.Intersect,!0);let c=di.ImageFilter.MakeBlur(this._backgroundBlur,this._backgroundBlur,di.TileMode.Clamp,null),u=e.copy();u.setImageFilter(c),u.setAlphaf(1);let h=this._currentPath.computeTightBounds();this.ctx.saveLayer(u,h,null,di.SaveLayerInitWithPrevious),this.ctx.drawColor(e.getColor()),this.ctx.restore(),this.ctx.restore(),u.delete(),c.delete(),l=!0}if(this._layerBlur>0){let c=e.copy();o=di.MaskFilter.MakeBlur(di.BlurStyle.Normal,this._layerBlur*this.dpr*(((n=this.camera)==null?void 0:n.scale)??1),!1),c.setMaskFilter(o),t(c),c.delete(),o.delete(),l=!0}if(l||t(e),i&&this._hasInnerShadow()){let c=new di.Paint;c.setAntiAlias(!0),c.setStyle(di.PaintStyle.Fill),c.setColor(TM(this._innerShadowColor));let u;this._innerShadowBlur>0&&(u=di.MaskFilter.MakeBlur(di.BlurStyle.Normal,this._innerShadowBlur*this.dpr*(((s=this.camera)==null?void 0:s.scale)??1),!1),c.setMaskFilter(u));let h=this._currentPath.computeTightBounds(),[d,f,p,v]=h,m=p-d,g=v-f;this.ctx.save(),this.ctx.clipPath(this._currentPath,di.ClipOp.Intersect,!0),this.ctx.saveLayer(c,h,null,di.SaveLayerInitWithPrevious),(a=this.ctx)==null||a.translate(this._innerShadowOffsetX,this._innerShadowOffsetY),this.ctx.drawRect(di.XYWHRect(-1e3-this._innerShadowOffsetX,-1e3-this._innerShadowOffsetY,2e3+m+Math.abs(this._innerShadowOffsetX*2),2e3+g+Math.abs(this._innerShadowOffsetY*2)),c),c.setBlendMode(di.BlendMode.Clear),this.ctx.drawPath(this._currentPath,c),this.ctx.restore(),this.ctx.restore(),c.delete(),u==null||u.delete()}}}_paintInner(e,t=!0){if(this.ctx&&this._currentPath&&e){let i=this.ctx,r=this._currentPath;this._applyEffectsToPaint(e,n=>{let s=!1;!t&&this._strokeMode!=="center"&&(i.save(),i.clipPath(r,this._strokeMode==="outside"?di.ClipOp.Difference:di.ClipOp.Intersect,!0),s=!0),i.drawPath(r,n),s&&i.restore()},t)}}_hasDropShadow(){var e;return((e=this._dropShadowColor)==null?void 0:e.a)>0}_hasInnerShadow(){var e;return((e=this._innerShadowColor)==null?void 0:e.a)>0}path(e){var t;(t=this._currentPath)==null||t.addPath(di.Path.MakeFromSVGString(e))}ellipse(e,t,i,r,n,s,a,o){var c;if(!U9([e,t,i,r])||!this._currentPath)return;if(i<0||r<0)throw Error("radii cannot be negative");let l=di.XYWHRect(e-i,t-r,i*2,r*2);(c=this._currentPath)==null||c.addOval(l)}rect(e,t,i,r,n=0,s=0,a=0,o=0){var c,u;let l=di.XYWHRect(e,t,i,r);if(U9(l))if(n===0&&s===0&&o===0&&a===0)(c=this._currentPath)==null||c.addRect(l);else{let h=di.RRectXY(l,n,n);h[4]=h[5]=n,h[6]=h[7]=s,h[8]=h[9]=a,h[10]=h[11]=o,(u=this._currentPath)==null||u.addRRect(h)}}getHorizontalAlign(e){switch(e){case 2:return di.TextAlign.Right;case 3:return di.TextAlign.Center;case 4:return di.TextAlign.Justify;case 1:default:return di.TextAlign.Left}}drawTextInner(e,t,i,[r,n,s,a],o,l,c=!0){let u=0,{ctx:h}=this;if(!h)return u;let d=l.copy(),f=l.copy();return f.setAlphaf(0),this._applyEffectsToPaint(d,p=>{t.pushPaintStyle(i,p,f),t.addText(e);let v=t.build();v.layout(s);let m=n;o===2?m+=(a-v.getHeight())/2:o===3&&(m+=a-v.getHeight()),h.drawParagraph(v,r,m),u=v.getHeight(),t.reset(),v.delete()},c),d.delete(),f.delete(),u}drawText(e,t){let i=0,r=this._fonts.get(t.font),{ctx:n,_paintFill:s,_paintStroke:a}=this;if(r&&n){let o=new di.TextStyle({fontFamilies:[t.font],fontSize:t.fontSize,heightMultiplier:t.lineHeight,letterSpacing:t.letterSpacing}),l=new di.ParagraphStyle({textStyle:o,textAlign:this.getHorizontalAlign(t.horizontalAlign)}),c=di.XYWHRect(t.x,t.y,t.width,t.height),u=di.ParagraphBuilder.Make(l,r);s&&(i=this.drawTextInner(e,u,o,c,t.verticalAlign,s,!0)),a&&(i=this.drawTextInner(e,u,o,c,t.verticalAlign,a,!1)),u.delete()}return{height:i}}render(){var e;(e=this._surface)==null||e.flush()}moveTo(e,t){var i;(i=this._currentPath)==null||i.moveTo(e,t)}lineTo(e,t){var i;(i=this._currentPath)==null||i.lineTo(e,t)}bezierCurveTo(e,t,i,r,n,s){var a;(a=this._currentPath)==null||a.cubicTo(e,t,i,r,n,s)}quadraticCurveTo(e,t,i,r){var n;(n=this._currentPath)==null||n.quadTo(e,t,i,r)}setTransform(e,t=!1){var n,s,a,o,l;if(!this.ctx)return;let i=this.ctx.getTotalMatrix(),r=Wi.invert(i);if(r&&this.ctx.concat(r),(n=this.ctx)==null||n.scale(this.dpr,this.dpr),((s=this.camera)==null?void 0:s.enabled)&&((a=this.ctx)==null||a.concat(this.camera.worldMatrix),t)){let c=Wi.getScale(this.camera.worldMatrix);(o=this.ctx)==null||o.scale(1/c[0],1/c[1])}(l=this.ctx)==null||l.concat(e),this.currentTransform=e}transform(e){var t;(t=this.ctx)==null||t.concat(e)}setSize(e,t){var i;!this._isSizeDirty&&e===this._width&&t===this._height||(this._isSizeDirty=!1,this._width=e,this._height=t,this.canvas.style.width=e+"px",this.canvas.style.height=t+"px",this.canvas.width=e*this.dpr,this.canvas.height=t*this.dpr,this._surface&&(this._surface=di.MakeWebGLCanvasSurface(this.canvas),this.ctx=(i=this._surface)==null?void 0:i.getCanvas()))}};function U9(e){for(let t=0;t<e.length;t++)if(e[t]!==void 0&&!Number.isFinite(e[t]))return!1;return!0}function TM({r:e,g:t,b:i,a:r}){return di.Color4f(e,t,i,r)}var N9=class{constructor(e,t,i){this.uuid=e,this.data=t,this.enabled=!1,this.color=cr.transparent,this.blurRadius=0,this.offset=[0,0],this.spread=0,this.update(t)}update(e){e.color!==void 0&&(this.color=e.color),e.enabled!==void 0&&(this.enabled=e.enabled),e.blurRadius!==void 0&&(this.blurRadius=e.blurRadius),e.offset!==void 0&&(this.offset=e.offset),e.spread!==void 0&&(this.spread=e.spread)}},k9=class{constructor(e,t,i){this.uuid=e,this.data=t,this.enabled=!1,this.radius=0,this.update(t)}update(e){e.enabled!==void 0&&(this.enabled=e.enabled),e.radius!==void 0&&(this.radius=e.radius)}},UBe=class{constructor(e,t,i){this.uuid=e,this.data=t,this.enabled=!1,this.color=cr.transparent,this.update(t)}update(e){e.enabled!==void 0&&(this.enabled=e.enabled),e.color!==void 0&&(this.color=e.color)}},NBe=class{constructor(e,t,i){this.uuid=e,this.data=t,this.enabled=!1,this.color=cr.transparent,this.thickness=0,this.mode="inside",this.update(t)}update(e){e.enabled!==void 0&&(this.enabled=e.enabled),e.color!==void 0&&(this.color=e.color),e.thickness!==void 0&&(this.thickness=e.thickness),e.mode!==void 0&&(this.mode=e.mode)}},ds=class extends ys{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this.autoClose=!0,this.fill=new UBe(e+"-fill",t.fill,i),this.stroke=new NBe(e+"-stroke",t.stroke,i),this.dropShadow=new N9(e+"-dropShadow",t.dropShadow,i),this.innerShadow=new N9(e+"-innerShadow",t.innerShadow,i),this.backgroundBlur=new k9(e+"-backgroundBlur",t.backgroundBlur,i),this.layerBlur=new k9(e+"-layerBlur",t.layerBlur,i)}applyFillStroke(e){e.fillColor=this.fill.enabled?this.fill.color:cr.transparent,e.strokeColor=this.stroke.enabled&&this.stroke.thickness>0?this.stroke.color:cr.transparent,e.strokeMode=this.stroke.mode,e.lineWidth=this.stroke.thickness}applyFilters(e){this.layerBlur.enabled?e.layerBlur=this.layerBlur.radius*5:e.layerBlur=0,this.backgroundBlur.enabled?e.backgroundBlur=this.backgroundBlur.radius*5:e.backgroundBlur=0,this.dropShadow.enabled?(e.dropShadowBlur=this.dropShadow.blurRadius*5,e.dropShadowColor=this.dropShadow.color,e.dropShadowOffsetX=this.dropShadow.offset[0],e.dropShadowOffsetY=this.dropShadow.offset[1]):e.dropShadowColor=cr.transparent,this.innerShadow.enabled?(e.innerShadowSpread=this.innerShadow.spread,e.innerShadowBlur=this.innerShadow.blurRadius*5,e.innerShadowColor=this.innerShadow.color,e.innerShadowOffsetX=this.innerShadow.offset[0],e.innerShadowOffsetY=this.innerShadow.offset[1]):e.innerShadowColor=cr.transparent}innerDraw(e){}draw(e){!this.visible||(e.save(),this.applyTransforms(e),this.applyFilters(e),this.applyFillStroke(e),e.beginPath(),this.innerDraw(e),this.autoClose&&e.closePath(),this.fill.enabled&&e.fill(),this.stroke.enabled&&e.stroke(),e.restore())}updateByPatchedOp(e,t,i){super.updateByPatchedOp(e,t,i),e.type===0&&(pr(e.path,["fill"])?this.fill.update(e.props):pr(e.path,["stroke"])?this.stroke.update(e.props):pr(e.path,["dropShadow"])?this.dropShadow.update(e.props):pr(e.path,["innerShadow"])?this.innerShadow.update(e.props):pr(e.path,["layerBlur"])?this.layerBlur.update(e.props):pr(e.path,["backgroundBlur"])?this.backgroundBlur.update(e.props):this.resetBBoxNeedsUpdate())}updateState(e,t){super.updateState(e,t),e.fill!==void 0&&this.fill.update(e.fill),e.stroke!==void 0&&this.stroke.update(e.stroke),e.dropShadow!==void 0&&this.dropShadow.update(e.dropShadow),e.innerShadow!==void 0&&this.innerShadow.update(e.innerShadow),e.layerBlur!==void 0&&this.layerBlur.update(e.layerBlur),e.backgroundBlur!==void 0&&this.backgroundBlur.update(e.backgroundBlur)}clone(e){let t=new ds(this.uuid,this.data,e);return t.parent=void 0,t}},c4=class extends ds{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this.width=0,this.height=0,this.updateState(t,i)}innerDraw(e){e.ellipse(this.width*.5,this.height*.5,this.width*.5,this.height*.5,0,0,Math.PI*2)}intersectsInLocalSpace(e,t){return IBe(e,t,this.width*.5,this.height*.5,this.width*.5,this.height*.5)}getCenter(){return[this.width*.5,this.height*.5]}getHalfSize(){return[this.width*.5,this.height*.5]}updateSizeState(e){let t=!1;e.width!==void 0&&(this.width=typeof e.width=="number"?e.width:this.width,t=!0),e.height!==void 0&&(this.height=typeof e.height=="number"?e.height:this.height,t=!0),t&&this.updateWorldMatrix(!0,!1,!0)}updateState(e,t){super.updateState(e,t),this.updateSizeState(e)}clone(e){let t=new c4(this.uuid,this.data,e);return t.parent=void 0,t}},Gb=class extends ds{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this.width=0,this.height=0,this.cornerRadius=[0,0,0,0],this.updateState(t,i)}innerDraw(e){e.rect(0,0,this.width,this.height,...this.cornerRadius)}getCenter(){return[this.width*.5,this.height*.5]}getHalfSize(){return[this.width*.5,this.height*.5]}updateCornerState(e){e.cornerRadius!==void 0&&(this.cornerRadius=e.cornerRadius)}updateSizeState(e){let t=!1;e.width!==void 0&&(this.width=typeof e.width=="number"?e.width:this.width,t=!0),e.height!==void 0&&(this.height=typeof e.height=="number"?e.height:this.height,t=!0),t&&this.updateWorldMatrix(!0,!1,!0)}updateState(e,t){super.updateState(e,t),this.updateSizeState(e),this.updateCornerState(e)}clone(e){let t=new Gb(this.uuid,this.data,e);return t.parent=void 0,t}},u4=class extends ds{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this._textHeight=0,this._textHeightDirty=!0,this.width=0,this.height=0,this.updateState(t,i)}get textHeight(){return this._textHeight}applyFillStroke(e){e.fillColor=this.fill.enabled?this.fill.color:cr.transparent,e.strokeColor=this.stroke.enabled&&this.stroke.thickness>0?this.stroke.color:cr.transparent,e.strokeMode="center",e.lineWidth=this.stroke.thickness}innerDraw(e){var s;(s=this._fontHolder)!=null&&s.arrayBuffer&&this._fontHolder.arrayBuffer.byteLength>1&&this.data.font&&e.registerFont(this._fontHolder.arrayBuffer,this.data.font);let t=this.data.textTransform,i=this.data.text.textValue.toString(),r=t===2?i.toUpperCase():t===3?i.toLowerCase():i,{height:n}=e.drawText(r,{x:0,y:0,width:this.width,height:this.height,fontSize:this.data.fontSize,lineHeight:this.data.lineHeight??1,letterSpacing:this.data.letterSpacing??0,horizontalAlign:this.data.horizontalAlign,verticalAlign:this.data.verticalAlign,font:this.data.font});this._textHeight=n}getCenter(){return[this.width*.5,this.height*.5]}getHalfSize(){return[this.width*.5,this.height*.5]}updateSizeState(e){let t=!1;e.width!==void 0&&(this.width=typeof e.width=="number"?e.width:this.width,t=!0),e.height!==void 0&&(this.height=typeof e.height=="number"?e.height:this.height,t=!0),t&&this.updateWorldMatrix(!0,!1,!0)}updateFontState(e,{shared:t}){e.font!==void 0&&(this._fontHolder=t.getFont(e.font),this._fontHolder&&!this._fontHolder.isLoaded&&this._fontHolder.loadingPromise.then(()=>{this.requestRender()}))}updateState(e,t){super.updateState(e,t),this.updateSizeState(e),this.updateFontState(e,t)}clone(e){let t=new u4(this.uuid,this.data,e);return t.parent=void 0,t}},yie=class extends ds{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this.curves=[],this.extremasBBox={min:[0,0],max:[0,0]},this.updateState(t,i)}computeExtremas(){this.curves.length===0&&this.computeCurves();let e=this.curves.map(r=>tT.extremas(r)),t=[1/0,1/0],i=[-1/0,-1/0];for(let r=0,n=e.length;r<n;r++){let s=e[r];s[0][0]<t[0]&&(t[0]=s[0][0]),s[0][1]<t[1]&&(t[1]=s[0][1]),s[1][0]>i[0]&&(i[0]=s[1][0]),s[1][1]>i[1]&&(i[1]=s[1][1])}return this.extremasBBox.min=[t[0],t[1]],this.extremasBBox.max=[i[0],i[1]],this.extremasBBox}computeCurves(){this.curves=[];for(let i=1,r=this.data.points.length;i<r;i++){let n=this.data.points[i].data,s=this.data.points[i-1].data,a={start:s.position,cp1:s.controlNext.position,cp2:n.controlPrevious.position,end:n.position};this.curves.push(a)}let e=this.data.points[0].data,t=this.data.points[this.data.points.length-1].data;if(this.data.isClosed){let i={start:t.position,cp1:t.controlNext.position,cp2:e.controlPrevious.position,end:e.position};this.curves.push(i)}}getCenter(){let[e,t]=this.extremasBBox.min,[i,r]=this.getHalfSize();return[e+i,t+r]}getHalfSize(){let{min:e,max:t}=this.extremasBBox;return[(t[0]-e[0])*.5,(t[1]-e[1])*.5]}innerDraw(e){for(let r=0,n=this.data.points.length;r<n;r++){let s=this.data.points[r].data;if(r===0){let[a,o]=s.position;e.moveTo(a,o)}else{let a=this.data.points[r-1].data,[o,l]=a.controlNext.position,[c,u]=s.controlPrevious.position,[h,d]=s.position,f={start:a.position,cp1:a.controlNext.position,cp2:s.controlPrevious.position,end:s.position};tT.derive(f),e.bezierCurveTo(o,l,c,u,h,d)}}let t=this.data.points[0].data,i=this.data.points[this.data.points.length-1].data;if(this.data.isClosed){let[r,n]=i.controlNext.position,[s,a]=t.controlPrevious.position,[o,l]=t.position;e.bezierCurveTo(r,n,s,a,o,l)}}updateState(e,t){super.updateState(e,t),this.computeExtremas()}clone(e){let t=new yie(this.uuid,this.data,e);return t.parent=void 0,t}},tT;(e=>{function t(a){let o=a.start,l=a.cp1,c=a.cp2,u=a.end,h=[3*(l[0]-o[0]),3*(l[1]-o[1])],d=[3*(c[0]-l[0]),3*(c[1]-l[1])],f=[3*(u[0]-c[0]),3*(u[1]-c[1])],p={start:h,cp:d,end:f};return a.derivative=p,p.derivative=AB.derive(p),p}e.derive=t;function i(a,o,l,c=!1){let u=a-2*o+l;if(u!==0){let h=-Math.sqrt(Math.abs(o*o-a*l)),d=-a+o,f=-(h+d)/u,p=-(-h+d)/u;return[f,p]}else if(o!==l&&u===0)return[(2*o-l)/(2*(o-l))];return[]}function r(a){let o=a.derivative??e.derive(a),l=o.start,c=o.cp,u=o.end;return[i(l[0],c[0],u[0]),i(l[1],c[1],u[1])]}e.droot=r;function n(a){let[o,l]=e.droot(a),c=[a.start[0],a.end[0]],u=[a.start[1],a.end[1]];for(let h of o)c.push(e.compute(a,Math.min(1,Math.max(0,h)))[0]);for(let h of l)u.push(e.compute(a,Math.min(1,Math.max(0,h)))[1]);return c.sort((h,d)=>h-d),u.sort((h,d)=>h-d),[[c[0],u[0]],[c[c.length-1],u[u.length-1]]]}e.extremas=n;function s(a,o){if(o===0)return[...a.start];if(o===1)return[...a.end];let l=1-o,c=l*l,u=o*o,h=c*l,d=c*o*3,f=l*u*3,p=o*u;return[h*a.start[0]+d*a.cp1[0]+f*a.cp2[0]+p*a.end[0],h*a.start[1]+d*a.cp1[1]+f*a.cp2[1]+p*a.end[1]]}e.compute=s})(tT||(tT={}));var AB;(e=>{function t(n){let s=n.start,a=n.cp,o=n.end,l=[2*(a[0]-s[0]),2*(a[1]-s[1])],c=[2*(o[0]-a[0]),2*(o[1]-a[1])],u={start:l,end:c};return u.derivative=TB.derive(u),n.derivative=u,u}e.derive=t;function i(n){let s=n.derivative??e.derive(n),a=s.start,o=s.end;return[a[0]!==o[0]?a[0]/(a[0]-o[0]):0,a[1]!==o[1]?a[1]/(a[1]-o[1]):0]}e.droot=i;function r(n,s){if(s===0)return[...n.start];if(s===1)return[...n.end];let a=1-s,o=a*a,l=s*s,c=o,u=a*s*2,h=l;return[c*n.start[0]+u*n.cp[0]+h*n.end[0],c*n.start[1]+u*n.cp[1]+h*n.end[1]]}e.compute=r})(AB||(AB={}));var TB;(e=>{function t(r){let n=r.start,s=r.end,a=[s[0]-n[0],s[1]-n[1]];return r.derivative=a,r.derivative}e.derive=t;function i(r,n){if(n===0)return[...r.start];if(n===1)return[...r.end];let s=r.start,a=r.end;return[s[0]+(a[0]-s[0])*n,s[1]+(a[1]-s[1])*n]}e.compute=i})(TB||(TB={}));var tu=class extends Yl{constructor(e,t,i){super(e,t,i),this.uuid=e,this.width=0,this.height=0,this.clipped=!0,this.background=new Gb(e+"-background",jw.defaultData,i),this.background.parent=this,this.updateState(t,i)}get fill(){return this.background.fill}get stroke(){return this.background.stroke}get backgroundBlur(){return this.background.backgroundBlur}get layerBlur(){return this.background.layerBlur}get dropShadow(){return this.background.dropShadow}get innerShadow(){return this.background.innerShadow}get cornerRadius(){return this.background.cornerRadius}set cornerRadius(e){this.background.cornerRadius=e}updateLocalMatrix(){var e;super.updateLocalMatrix(),(e=this.background)==null||e.updateLocalMatrix()}updateWorldMatrix(e,t,i){var r;super.updateWorldMatrix(e,t,i),(r=this.background)==null||r.updateWorldMatrix(e,t,i)}draw(e){if(!this.visible)return;e.save();let t=this.width,i=this.height;this.applyTransforms(e),this.background.width=t,this.background.height=i,this.background.draw(e),this.clipped&&e.clipRect(0,0,t,i,...this.cornerRadius),this.innerDrawChildren(e),e.restore()}getCenter(){return[this.width*.5,this.height*.5]}getHalfSize(){return[this.width*.5,this.height*.5]}updateCornerState(e){e.cornerRadius!==void 0&&(this.cornerRadius=e.cornerRadius)}updateSizeState(e){let t=!1;e.width!==void 0&&(this.width=typeof e.width=="number"?e.width:this.width,t=!0),e.height!==void 0&&(this.height=typeof e.height=="number"?e.height:this.height,t=!0),t&&this.updateWorldMatrix(!0,!1,!0)}updateState(e,t){super.updateState(e,t),this.updateSizeState(e),this.updateCornerState(e),e.fill!==void 0&&this.fill.update(e.fill),e.stroke!==void 0&&this.stroke.update(e.stroke),e.dropShadow!==void 0&&this.dropShadow.update(e.dropShadow),e.innerShadow!==void 0&&this.innerShadow.update(e.innerShadow),e.layerBlur!==void 0&&this.layerBlur.update(e.layerBlur),e.backgroundBlur!==void 0&&this.backgroundBlur.update(e.backgroundBlur),e.clipped!==void 0&&(this.clipped=e.clipped)}requestRender(){super.requestRender(),this.dispatchEvent({type:"render"})}dispose(){this.removeEventListener("render")}updateByPatchedOp(e,t,i){super.updateByPatchedOp(e,t,i),e.type===0&&(pr(e.path,["fill"])?this.fill.update(e.props):pr(e.path,["stroke"])?this.stroke.update(e.props):pr(e.path,["dropShadow"])?this.dropShadow.update(e.props):pr(e.path,["innerShadow"])?this.innerShadow.update(e.props):pr(e.path,["layerBlur"])?this.layerBlur.update(e.props):pr(e.path,["backgroundBlur"])?this.backgroundBlur.update(e.props):this.resetBBoxNeedsUpdate())}clone(e){let t=new tu(this.uuid,this.data,e);t.parent=void 0;for(let i of this.children)t.add(i.clone(e));return t}},kBe=Tf(_J(),1),qC=class extends ds{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this._pathBBox=new DOMRect,this.path="",this.updateState(t,i),this.autoClose=!1,this.computeSVGBBox()}computeSVGBBox(){let e=document.createElementNS("http://www.w3.org/2000/svg","svg"),t=document.createElementNS("http://www.w3.org/2000/svg","path");document.body.appendChild(e),t.setAttribute("d",this.path),e.appendChild(t),this._pathBBox=t.getBBox(),e.remove()}innerDraw(e){e.path(this.path)}intersectsInLocalSpace(e,t){return e>=this._pathBBox.x&&e<=this._pathBBox.x+this._pathBBox.width&&t>=this._pathBBox.y&&t<=this._pathBBox.y+this._pathBBox.height}getCenter(){return[(this._pathBBox.x+this._pathBBox.width)/2,(this._pathBBox.y+this._pathBBox.height)/2]}getHalfSize(){return[(this._pathBBox.x+this._pathBBox.width)/2,(this._pathBBox.y+this._pathBBox.height)/2]}updateState(e,t){super.updateState(e,t),e.path!==void 0&&(this.path=e.path,this.computeSVGBBox())}clone(e){let t=new qC(this.uuid,this.data,e);return t.parent=void 0,t}};function VBe(e,t=1,i=1){if(t<=0||i<=0)return e;let r=(0,kBe.parseSVG)(e).map(n=>{let s={...n};return"x"in s&&(s.x=s.x*t),"y"in s&&(s.y=s.y*i),"x1"in s&&(s.x1=s.x1*t),"x2"in s&&(s.x2=s.x2*t),"y1"in s&&(s.y1=s.y1*i),"y2"in s&&(s.y2=s.y2*i),"rx"in s&&(s.rx=s.rx*t),"ry"in s&&(s.ry=s.ry*i),s});return GBe(r)}function GBe(e){let t=["rx","ry","xAxisRotation","largeArc","sweep","x1","y1","x2","y2","x","y"],i;return e.map(r=>{let n=[];t.forEach(a=>{if(a in r){let o=r[a]*1;n.length&&o>=0&&n.push(","),n.push(o)}});let s=(i===r.code?n[0]<0?"":",":r.code)+n.join("");return i=r.code,s}).join("")}function HBe(e,t,i){switch(t.type){case"ellipse2d":return new c4(e,t,i);case"rectangle2d":return new Gb(e,t,i);case"text2d":return new u4(e,t,i);case"vector2d":return new yie(e,t,i);case"path2d":return new qC(e,t,i);case"frame2d":return new tu(e,t,i);case"group2d":default:return new xf(e,t,i)}}var xie=class{constructor(e,t,i){this.uuid=e,this.data=t,this.group=new xf(xie.GROUP_ID,{...WA.defaultData},i),this.createChildrenObjects(t.objects,this.group,i)}createObject(e,t,i,r,n,s){let a=HBe(e,t,s);a&&(r.add(a),r.children.splice(n,0,r.children.pop()),a.updateWorldMatrix(),i.length>0&&(a instanceof xf||a instanceof tu)&&this.createChildrenObjects(i,a,s))}createChildrenObjects(e,t,i){let r=0;for(let n of e)this.createObject(n.id,n.data,n.children,t,r,i),r+=1}draw(e){this.group.draw(e)}updateEntityByOp(e,t,i,r){let n=this.find(e);if(n)try{n.updateByOp(t,i,{shared:r})}catch(s){console.error(s)}}updateTreeByOp(e,t){if(e.path.length===0&&e.type===7){let i=e.parent===null?this.group:this.find(e.parent);i!==void 0&&i instanceof Yl&&(this.createObject(e.id,e.data,e.children,i,e.localIndex,t),i.requestRender())}else if(e.path.length===0&&e.type===8){let i=this.find(e.id);if(i!==void 0&&i.parent!==void 0&&i.parent instanceof Yl){let r=i.parent;i.resetBBoxNeedsUpdate(),r==null||r.remove(i),r==null||r.requestRender()}}else if(e.path.length===0&&e.type===9){let i=this.find(e.id);if(i!==void 0){let r=i.parent,n=e.parent===null?this:this.find(e.parent);if(n instanceof Yl||n===this){n.add(i);let s=e.localIndex;n.children.splice(s,0,n.children.pop()),i.updateWorldMatrix(!0,!1,!0),r==null||r.requestRender(),i.requestRender()}i.resetBBoxNeedsUpdate()}}}add(e){this.group.add(e)}remove(e){this.group.remove(e)}traverse(e){this.group.traverse(t=>{t!==this.group&&e(t)})}intersectsChildren(e,t,i,r=!1,n=[]){return this.group.intersectsChildren(e,t,i,r,n,!0)}intersectsChildrenReverse(e,t,i,r=!1,n=[]){return this.group.intersectsChildrenReverse(e,t,i,r,n,!0)}find(e){return this.group.find(e)}get children(){return this.group.children}project(e,t){return this.group.project(e,t)}getWithSortKey(e){let t=this.find(e);if(t===void 0)return;let i=[],r=t;for(;r!==this.group;){let n=r;r=r.parent;let s=r.children.indexOf(n);i.splice(0,0,s)}return{entity:t,sortKey:i}}getAllSorted(e){let t=[];for(let i of e){let r=this.getWithSortKey(i.id);r!==void 0&&t.push(r)}return t.sort((i,r)=>eee(i.sortKey,r.sortKey)),t.map(i=>i.entity)}},h4=xie;h4.GROUP_ID="scene2d";function wie({constraints:e,newParentWidth:t,newParentHeight:i,initialParentWidth:r,initialParentHeight:n,objectInitialWidth:s,objectInitialHeight:a,objectInitialPosition:o}){let{horizontalConstraint:l,verticalConstraint:c}=e,u=t-r,h=i-n,d=s,f=a,p=o[0],v=o[1];if(l!==0){if(l===1)p+=u;else if(l===3)p+=u/2;else if(l===2)d=Math.max(1,d+u);else if(l===4){let m=t/r;d*=m,p*=m}}if(c!==0){if(c===1)v+=h;else if(c===3)v+=h/2;else if(c===2)f=Math.max(1,f+h);else if(c===4){let m=i/n;f*=m,v*=m}}return{width:d,height:f,position:[p,v]}}Tf(_J(),1);var jBe=`
	varying vec2 vUv;
	void main() {
		vUv = uv;
		gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
	}`,WBe=`
	uniform sampler2D tDiffuse;
	varying vec2 vUv;
	void main() {
		vec4 texel = texture2D( tDiffuse, vUv );
		gl_FragColor = texel;
	}`,XBe=new EC(-1,1,1,-1,0,1),qBe=class extends Nt{constructor(){super(),this.setAttribute("position",new _t([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new _t([0,2,0,0,2,0],2))}},YBe=new qBe,QBe=class{constructor(e){this._mesh=new yr(YBe,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,XBe)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}},bie=new ki({defines:{},uniforms:{tDiffuse:new ct(null)},vertexShader:jBe,fragmentShader:WBe}),ZBe=new QBe(bie),qR=null,YR=null,KBe=()=>(qR===null&&(qR=document.createElement("canvas")),qR),JBe=e=>(YR===null&&(YR=new vie(e)),YR),$Be=Wi.identity(),_ie=class{constructor(e,t,i,r){this.uuid=e,this.width=t,this.height=i,this.context=r,this.enabled=!0,this.isScreenSpace=!1,this.dpr=window.devicePixelRatio,this.isFrameDirty=!1,this.onRenderRequestedDownstream=()=>{this.isFrameDirty=!0,this.context.shared.requestRender()},this._innerApplySize=()=>{let n=this.width,s=this.height,a=this.dpr;this.renderer.dpr=this.isScreenSpace?a:Math.floor(2048/Math.max(n,s)),this.renderer.setSize(n,s)},this.onFrameOverrideObjectEvent=n=>{var s,a;if(((s=n.target)==null?void 0:s.uuid)!==void 0){let o=(a=this.frameRoot)==null?void 0:a.find(n.target.uuid);o&&o.dispatchEvent({...n,target:o})}},this.scene2d=new h4(Tt.generateUUID(),Qz.defaultData,{dpr:window.devicePixelRatio,shared:r.shared}),this.canvas=KBe(),this.renderer=JBe(this.canvas),this.promise=this.init(),this.renderTarget=new Ni(1,1,{type:Th,stencilBuffer:!1,depthBuffer:!1}),r.shared.addUIBuffer(this.uuid,this.renderTarget),this.textureHolder=r.shared.uiBuffer(this.uuid)}get canvasTexture(){return this._canvasTexture||(this._canvasTexture=new Nxe(this.canvas)),this._canvasTexture}async init(){this.renderer instanceof vie&&(this.renderer.wasmURL=Wte.skiaWasmUrl),await this.renderer.init()}render(e){var t,i;if(this.isFrameDirty){this.isFrameDirty=!1,this._innerApplySize(),this.renderer.clear(),(t=this.frameOverride)==null||t.draw(this.renderer),this.renderer.render(),bie.uniforms.tDiffuse.value=this.canvasTexture,this.canvasTexture.needsUpdate=!0;let r=e.getRenderTarget();e.setRenderTarget(this.renderTarget),e.clear(),ZBe.render(e),e.setRenderTarget(r),(i=this.textureHolder)==null||i.setNeedsUpdate(!0)}}updateEntity2DByOp(e,t,i,r){this.scene2d.updateEntityByOp(e,t,i,r),this.applySize()}updateTreeByOp(e,t){this.scene2d.updateTreeByOp(e,t),this.applySize()}applyOverrides(e){if(this.frameOverride&&this.frameRoot){this.frameOverride.position=[0,0],this.frameOverride.rotation=0;let t=(e==null?void 0:e.width)??this.width,i=(e==null?void 0:e.height)??this.height;this.frameOverride.width=t,this.frameOverride.height=i,this.frameOverride.localMatrix=$Be,this.isScreenSpace&&(this.frameOverride.fill.color=cr.from0to1([0,0,0,0])),this.frameOverride.data={...this.frameOverride.data,width:t,height:i},Sie({objectOverride:this.frameOverride,objectRoot:this.frameRoot,newParentWidth:this.frameOverride.width,newParentHeight:this.frameOverride.height,initialParentWidth:this.frameRoot.width,initialParentHeight:this.frameRoot.height}),this.frameOverride.updateWorldMatrix(!0,!1,!0)}}applySize(e,t=window.devicePixelRatio){var o,l;let i=Math.max(1,(e==null?void 0:e.width)??this.width),r=Math.max(1,(e==null?void 0:e.height)??this.height);this.dpr=t,this.width=i,this.height=r,this._innerApplySize();let n=1,s=512,a=512;(i*t<s||r*t<a)&&(n=Math.max(s/(i*t),a/(r*t))),this.renderTarget.setSize(i*t*n,r*t*n),(o=this._canvasTexture)==null||o.dispose(),this._canvasTexture=void 0,this.applyOverrides(e),(l=this.frameOverride)==null||l.requestRender()}applyFrame(e){var i,r;let t=this.context.scene.find2D(e);if(!(!t||!(t instanceof tu)))return this.disposeFrameOverride(),this.frameRoot=t,this.frameOverride=t.clone({dpr:this.renderer.dpr,shared:this.context.shared}),this.scene2d.add(this.frameOverride),this.applySize(),(i=this.frame)==null||i.addEventListener("render",this.onRenderRequestedDownstream),this.frameOverride.traverse(n=>{n.addEventListener("beginState",this.onFrameOverrideObjectEvent)}),this.frameOverride.traverse(n=>{n.addEventListener("completeState",this.onFrameOverrideObjectEvent)}),(r=this.frame)==null||r.requestRender(),t}get frame(){return this.frameOverride}get frameId(){var e;return(e=this.frame)==null?void 0:e.uuid}find(e){return this.scene2d.find(e)}get texture(){var e;return(e=this.textureHolder)==null?void 0:e.getTexture(1001)}disposeFrameOverride(){var e,t,i;(e=this.frameOverride)==null||e.removeEventListener("render",this.onRenderRequestedDownstream),(t=this.frameOverride)==null||t.traverse(r=>{r.removeEventListener("beginStateChange",this.onFrameOverrideObjectEvent)}),(i=this.frameOverride)==null||i.traverse(r=>{r.removeEventListener("completeState",this.onFrameOverrideObjectEvent)}),this.frameOverride&&this.scene2d.remove(this.frameOverride)}};function Sie({objectOverride:e,objectRoot:t,newParentWidth:i,newParentHeight:r,initialParentWidth:n,initialParentHeight:s}){if(e instanceof tu&&t instanceof tu||e instanceof xf&&t instanceof xf)for(let a=0,o=e.children.length;a<o;a++){let l=e.children[a],c=t.children[a];l&&c&&l.uuid===c.uuid&&tFe({objectOverride:l,objectRoot:c,newParentWidth:i,newParentHeight:r,initialParentWidth:n,initialParentHeight:s})}}function eFe(e){if(CB(e))return[e.width,e.height];if(e instanceof qC){let[t,i]=e.getHalfSize();return[t*2,i*2]}else if(e instanceof xf){let[t,i]=e.recursiveBBox.getHalfSize();return[t*2,i*2]}return[0,0]}function tFe({objectOverride:e,objectRoot:t,newParentWidth:i,newParentHeight:r,initialParentWidth:n,initialParentHeight:s}){let[a,o]=eFe(t),{width:l,height:c,position:u}=wie({constraints:e.data,newParentWidth:i,newParentHeight:r,initialParentWidth:n,initialParentHeight:s,objectInitialWidth:a,objectInitialHeight:o,objectInitialPosition:t.position});if(e.position=u,e.data={...e.data,position:u},e.states)for(let h in e.states)iFe({stateId:h,objectOverride:e,objectRoot:t,newParentWidth:i,newParentHeight:r,initialParentWidth:n,initialParentHeight:s});if(CB(e)||e instanceof xf)CB(e)&&(e.width=l,e.height=c,e.data={...e.data,width:l,height:c}),Sie({objectOverride:e,objectRoot:t,newParentWidth:l,newParentHeight:c,initialParentWidth:a,initialParentHeight:o});else if(e instanceof qC){let h=t,d=a!==0?l/a:1,f=o!==0?c/o:1;e.path=VBe(h.path,d,f),e.data={...e.data,path:e.path}}}function iFe({stateId:e,objectOverride:t,objectRoot:i,newParentWidth:r,newParentHeight:n,initialParentWidth:s,initialParentHeight:a}){var c,u;let o=(c=t.states)==null?void 0:c[e],l=(u=i.states)==null?void 0:u[e];if(o&&l){let{width:h,height:d,position:f}=wie({constraints:t.data,newParentWidth:r,newParentHeight:n,initialParentWidth:s,initialParentHeight:a,objectInitialWidth:cm.isResizeable(l)?l.width:0,objectInitialHeight:cm.isResizeable(l)?l.height:0,objectInitialPosition:l.position});Object.assign(t.states[e],{position:f}),cm.isResizeable(o)&&Object.assign(t.states[e],{width:h,height:d})}}function CB(e){return e instanceof Gb||e instanceof tu||e instanceof c4||e instanceof u4}var hs=class extends VN(co){constructor(e,t,i){super(),this.data=t,this.bgColor=new Bs(1,1,1,1),this.fog=null,this.backupFog=new YJ(16777215,.1,2e3),this.fogUseBGColor=!1,this.isActive=!1,this.aoColor=new Yt,this.penumbraSizeArrayCache=null,this.super_Entity(e,t),this.personalCamera=new aa(gy,{...Vw.defaultData,...t.camera,name:"Personal Camera"}),this.personalCamera.objectHelper.visible=!1,this.add(this.personalCamera),this.activeCamera=this.personalCamera,this.ambientLight=new Ewe(13882323,8553090,.75),this.ambientLight.name="Default Ambient Light",this.ambientLight.layers.enable(3),this.ambientLight.removeFromParent(),this.add(this.ambientLight),t.uiScene?this.uiScene=new h4((Array.isArray(e)?e[0]:e)+"-ui",t.uiScene,{dpr:window.devicePixelRatio,shared:i.shared}):t.uiFrame&&this.createUICanvas(t.uiFrame,i)}get scene(){return this.parent}get postprocessing(){return this.data.postprocessing}get frameId(){return this.data.uiFrame}get frame(){var e;return(e=this.uiCanvas)==null?void 0:e.frame}createUICanvas(e,t){this.uiCanvas=new _ie(this.uuid+"-uiscreen",window.innerWidth,window.innerHeight,t),this.uiCanvas.isScreenSpace=!0,this.uiCanvas.promise.then(()=>{var i,r;(i=this.uiCanvas)==null||i.applyFrame(e),(r=this.uiCanvas)==null||r.applySize()})}updateVisible(){}setBackgroundColor(e){this.bgColor=e,this.fogUseBGColor===!0&&(this.backupFog.color=e)}entityChildrenCount(){return this.uiScene?this.uiScene.children.length:super.entityChildrenCount()}updateAmbientLight(e,t){e.color!==void 0&&(this.ambientLight.color=Ra(e.color,t)),e.intensity!==void 0&&(this.ambientLight.intensity=e.intensity),e.enabled!==void 0&&(e.enabled?this.add(this.ambientLight):this.remove(this.ambientLight))}onDeactive(){this.isActive=!1}onActive(e){this.isActive=!0,e.fog=this.fog,this.traverseEntity(t=>{t instanceof Pm&&t.recomputeBoolean()}),this.updateShadow(this.data.shadow)}forceMaterialsUpdate(){this.traverseEntity(e=>{if(e instanceof xy)if(Array.isArray(e.material))for(let t of e.material)t.needsUpdate=!0;else e.material.needsUpdate=!0,e.material.dispose()})}updateShadow(e){e.softShadowQuality!==void 0&&this.isActive&&xBe(e.softShadowQuality)&&this.forceMaterialsUpdate()}updateFog(e,t){if(e.enabled?this.fog=this.backupFog:this.fog=null,this.isActive){let i=this.scene;i.fog=this.fog}this.fogUseBGColor=e.useBackgroundColor,e.useBackgroundColor?this.backupFog.color.set(this.bgColor):this.backupFog.color=Ra(e.color,t),this.backupFog.near=e.near,this.backupFog.far=e.far}updateAo(e,t){e.aoColor!==void 0&&(this.aoColor=Ra(e.aoColor,t))}updateByOp(e,t,i,r){let n=this.data.uiFrame;super.updateByOp(e,t,i,r);let s=t;pr(e.path,["fog"])?this.updateFog(s.fog,i.shared):pr(e.path,["ao"])?this.updateAo(s.ao,i.shared):pr(e.path,["ambient"])?this.updateAmbientLight(s.ambient,i.shared):pr(e.path,["shadow"])?this.updateShadow(s.shadow):e.type===0&&e.path.length===0&&(e.props.uiFrame!==void 0||n!==s.uiFrame)&&this.updateUIFrame(e.props.uiFrame,i)}updateUIFrame(e,t){e?(this.uiCanvas||this.createUICanvas(e,t),this.uiCanvas.enabled=!0,this.uiCanvas.applyFrame(e)):this.uiCanvas&&(this.uiCanvas.enabled=!1)}updateState(e,t){this.updateState_Entity(e,t),e.backgroundColor!==void 0&&this.setBackgroundColor(Ra(e.backgroundColor,t.shared)),e.fog!==void 0&&this.updateFog(e.fog,t.shared),e.ambient!==void 0&&this.updateAmbientLight(e.ambient,t.shared),e.ao!==void 0&&this.updateAo(e.ao,t.shared),e.shadow!==void 0&&this.updateShadow(e.shadow)}createFrame(e,t){}raycast(e,t){super.raycast(e,t)}switchActiveCamera(e){e&&e.isDescendantOf(this)&&(this.activeCamera!==this.personalCamera&&(this.activeCamera.objectHelper.visible=!0),this.activeCamera=e,e.objectHelper.visible=!1)}get playCamera(){var e;return((e=this.scene)==null?void 0:e.find(this.data.publish.playCamera))??this.personalCamera}switchToPlayCamera(){this.switchActiveCamera(this.playCamera)}get penumbraSizeArray(){return this.penumbraSizeArrayCache===null&&this.updatePenumbraSizeArray(),this.penumbraSizeArrayCache}updatePenumbraSizeArray(){this.penumbraSizeArrayCache=new Array(5).fill(.5);let e=0,t=0;this.traverseEntity(i=>{if(!i.visible)return!0;i instanceof fie&&i.visible&&e<3&&(this.penumbraSizeArrayCache[e]=i.data.penumbraSize??.5,e+=1),i instanceof pie&&i.visible&&e<2&&(this.penumbraSizeArrayCache[3+t]=i.data.penumbraSize??.5,t+=1)})}raycastWithClones(e){let t=[],i=r=>{for(let n of r.children){let s=n.cloner;Fi.is(n)&&(n.visible||s!=null&&s.object.data.visible)&&((ql(n)||yB(n)&&this.scene.enableHelpers&&n.objectHelper.visible)&&(e.intersectObject(n,!1,t),PB(n,e,t,!0)),i(n))}};return i(this),t}updateEntity2DByOp(e,t,i,r){var n;(n=this.uiCanvas)==null||n.updateEntity2DByOp(e,t,i,r)}},rFe=class extends a4(Pwe,uie){constructor(e,t,i){super(),this.super_Entity(e,t),this.castShadow=!0,this.shadow.mapSize.width=1024,this.shadow.mapSize.height=1024,this.shadow.normalBias=1,this.layers.enable(3);let r=this.shadow.camera;r.fov=90,r.aspect=1,r.near=100,r.far=2500;let n=new N(-r.far+this.position.x,-r.far+this.position.y,-r.far+this.position.z),s=new N(r.far+this.position.x,r.far+this.position.y,r.far+this.position.z),a=new vn(n,s),o=new gA(a,new Yt(16755200));o.visible=!1,this.gizmos.shadowmap=o,this.update()}update(){if(this.shadow&&(this.shadow.camera.updateProjectionMatrix(),this.gizmos))for(let e in this.gizmos){let t=this.gizmos[e];if(t instanceof gA){let i=this.shadow.camera,r=new N(-i.far+this.position.x,-i.far+this.position.y,-i.far+this.position.z),n=new N(i.far+this.position.x,i.far+this.position.y,i.far+this.position.z);t.box.set(r,n),t.updateMatrixWorld(!0)}}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.objectHelper&&this.objectHelper.update()}updateState(e,t){this.updateState_Light(e,t),e.distance!==void 0&&(this.distance=e.distance),e.decay!==void 0&&(this.decay=e.decay),e.shadowRadius!==void 0&&(this.shadow.radius=e.shadowRadius),e.shadowResolution!==void 0&&(this.shadow.mapSize.set(e.shadowResolution,e.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null))}},nFe=class extends Rn{get forceComputeSize(){return!0}get shape(){return this.geometry.userData.shape}updateEntityBoxSize(e,t){let i=this.geometry.getAttribute("position");i!==void 0?QN(i,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:i.count,e,t):super.updateEntityBoxSize(e,t)}},d4=class extends Rn{constructor(e,t,i){super(e,t,i),this._shapeId=null,this._context=i}updateState(e,t){super.updateState(e,t),this.updateShape(),this.refreshAttachedCloners(t)}updateShape(){var r;let e={...this.data.geometry.extrusion.shape};for(let n in e)typeof e[n]=="string"&&(e[n]=this._context.shared.getVariable(e[n],[this.uuid,"geometry","extrusion","shape",n]));let t;if(e.type==="Custom"){let n=e.shapeId;if(n!==this._shapeId&&this.detachShape(),n){this._shapeId=n;let s=this._context.scene.find(n);s!=null&&s.data&&(s.attachedPaths.add(this),t=(r=s.geometry.userData)==null?void 0:r.shape),t||this._context.scene.addPendingCommand(()=>this.updateShape())}}else{let n;switch(e.type){case"Rectangle":n=YN;break;case"Ellipse":n=qN;break;case"Polygon":n=ote;break;case"Star":n=lte;break;default:throw new Error(`Unknown shape type: ${e.type}`)}t=n.create({parameters:e}).userData.shape}let i=this.geometry;t&&i.inputs&&(i.inputs.shapeData=t,i.build())}detachShape(){var e;this._shapeId!==null&&((e=this._context.scene.find(this._shapeId))==null||e.attachedPaths.delete(this))}createGeometryDelayed(e){this.geometryCreateDeleyed=e.shared,this.updateShape(),this.refreshAttachedPaths(e)}updateTransformState(e,t){return super.updateTransformState(e,t)}updateGeometryInteractions(e,t){super.updateGeometryInteractions(e,t),this.updateShape()}updateEntityBoxSize(e,t){let i=this.geometry.getAttribute("position");i!==void 0?QN(i,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:i.count,e,t):super.updateEntityBoxSize(e,t)}},f4=class extends s4{constructor(e,t,i){super(e,t,i),this.data=t}},y0=class extends wy(hh,kb){constructor(e,t,i){super(),t.type==="Instance"&&typeof e=="string"&&(t=this.transformAssignData(t,i)),this.super_Entity(e,t),this.objectHelper.update()}get isComponentRoot(){return this.data.type==="Component"&&typeof this.identity=="string"}get isInstanceRoot(){return this.data.type==="Instance"&&typeof this.identity=="string"}transformAssignData(e,t){let i=VA.getComponentData({scene:t.scene.data,shared:t.shared.data},e.component);if(i){let r,n;for(let s of Vd.rootOverrideProps)e[s]===void 0?(r===void 0&&(r={...e}),r[s]=i.data[s]):(n===void 0&&(n={}),n[s]=e[s],r===void 0&&(r={...e}),r[s]=af.apply(i.data[s],e[s]));return this.overrideData=n,r}else return{...qn.defaultData,...e,...$c(qn.defaultData,Vd.rootOverrideProps)}}updateByOp(e,t,i,r){let n;if(this.isInstanceRoot&&!r){if(t=this.transformAssignData(t,i),e.type===0&&e.path.length===0&&this.component)for(let s of Vd.rootOverrideProps)s in e.props&&e.props[s]===void 0&&(n===void 0&&(n={...e,props:{...e.props}}),n.props[s]=this.component.data[s]);else if(e.type===0&&e.path.length>0&&Vd.rootOverrideProps.includes(e.path[0])){let s=e.path[0];n===void 0&&(n={...e,path:[],props:{[s]:t[s]}})}}super.updateByOp(n??e,t,i,r)}updateState(e,t){this.updateState_Entity(e,t)}expandInstanceChildren(e){let t=this.data;if(this.component===void 0){let i=e.scene.find(t.component)??null,r=!1;if(i!==this.oldComponent){if(this.oldComponent){let n=0;for(let s of this.children)if(Fi.is(s))e.scene.disposeAndUnregisterEntityRecursivelyIfNotReregistered(s),p4(s),n+=1;else break;this.children.splice(0,n)}r=!0}if(i){let n={};Mie(e,[this.uuid],t.overrides,this,i,i,0,r,n);for(let s of this.children)if(Fi.is(s)){let a=s.data;a.type==="Empty"&&a.animations&&s.traverseEntity(o=>{let l=o.dataPatched;if(o instanceof Rn&&l.bones&&l.boneInverses){let c=o.dataPatched;if(c.bones&&c.boneInverses){let u=c.bones.map(f=>e.scene.find(n[f])),h=c.boneInverses.map(f=>new ft().fromArray(f)),d=new iN(u,h);o.bind(d,o.bindMatrix)}}else o.matrixAutoUpdate=!0})}}this.oldComponent=this.component}}};function p4(e){if(e.component){let t=e.component.instances.indexOf(e);t>=0&&e.component.instances.splice(t,1);for(let i of e.children)Fi.is(i)&&p4(i)}}function V9(e,t,i,r){return e.component===t&&CN(e.identity,r)?e.overrideData===i?2:1:0}function Mie(e,t,i,r,n,s,a,o,l){if(a>50)return!1;if(r.component!==n){if(r.component){let u=r.component.instances.indexOf(r);u>=0&&r.component.instances.splice(u,1)}n.instances.find(u=>u===r)||n.instances.push(r),r.component=n}n instanceof y0&&n.isInstanceRoot&&n.expandInstanceChildren(e);let c=0;for(let u of n.children)if(Fi.is(u)){let h=[...t,...typeof u.identity=="string"?[u.identity]:u.identity],d=FA.resolve(i,h,1);d!=null&&!(d instanceof On)&&(Object.setPrototypeOf(d,On.prototype),console.error("wrong prototype"));let f=null,p;if(!o){let v=r.children[c];if(f=Fi.is(v)?v:null,f!==null){let m=V9(f,u,d,h);p=m>=1?f.stateSelection:void 0,m!==2&&(f=null)}if(f===null&&(f=e.scene.findInstance(h)??null,f!==null)){let m=V9(f,u,d,h);if(p=m>=1?f.stateSelection:void 0,m!==2)f=null;else{let g=f.parent.children.indexOf(f);f.parent.children.splice(g,1),r.children.splice(c,0,f),f.parent===r?g<=c&&console.error("not possible"):(f.parent=r,f.matrixWorldNeedsUpdate=!0,f.resetBBoxNeedsUpdate(),f.updateVisible(),e.pendingDeletes.delete(f))}}}if(f===null){let v=d?af.apply(u.data,d):u.data;Am.is(v.type)&&(v={...v,type:"Empty"}),f=Hd.createEntity(h,v,e),f.overrideData=d,r.add(f),r.children.splice(r.children.length-1,1),r.children.splice(c,0,f),f.updateState(f.data,e),p&&f.changeSelectedState(p,e),e.scene.registerInstanceAndSetUuid(f)}if(f.isBone){let v=f.identity[f.identity.length-1];l[v]=f.uuid}c+=1,Mie(e,t,i,f,u,s,a+1,o,l)}if(!o){let u=c;for(;;){let h=r.children[c];if(Fi.is(h))e.pendingDeletes.add(h);else break;c+=1}r.children.splice(u,c-u)}return!0}var sFe=class extends wy(QJ,kb){constructor(e,t){super(),this.super_Entity(e,t),this.objectHelper.update(),this.matrixAutoUpdate=!0}updateState(e,t){this.updateState_Entity(e,t)}},ia=class extends Rn{constructor(e,t,i){super(e,t,i),this.onBeforeRender=r=>{this.uiCanvas.render(r)},this.uiCanvas=new _ie(e+"-canvas",t.geometry.width,t.geometry.height,i),this.uiCanvas.promise.then(()=>{this.applyFrame(this.dataPatched.geometry.frame,i.shared)})}updateByPatchedOpGeometry(e,t,i){super.updateByPatchedOpGeometry(e,t,i),e.type===0&&(e.props.frame!==void 0&&this.applyFrame(e.props.frame,i.shared),(e.props.width!==void 0||e.props.height!==void 0)&&this.applySize(e.props,i.shared))}applySize(e,t){let i=(e==null?void 0:e.width)??this.dataPatched.geometry.width,r=(e==null?void 0:e.height)??this.dataPatched.geometry.height;this.uiCanvas.applySize({width:i,height:r}),this.applyGeometryParametersFromFrame(t)}applyFrame(e,t){this.uiCanvas.applyFrame(e),this.applyGeometryParametersFromFrame(t),this.applyMaterialParametersFromFrame({shared:t})}applyGeometryParametersFromFrame(e){var i;let t=this.frame;t&&(Object.assign(this.data,{geometry:Object.assign(this.data.geometry,{cornerRadius:t.cornerRadius,cornerType:0})}),Object.assign(this.dataPatched,{geometry:Object.assign(this.dataPatched.geometry,{cornerRadius:t.cornerRadius,cornerType:0})}),(i=this.localGeometry)==null||i.dispose(),this.localGeometry=Yw(this.dataPatched.geometry,e,this.data.flatShading,this))}applyMaterialParametersFromFrame(e){let t=this.frame;if(t){let i=t.data.backgroundBlur;Object.assign(this.data.material.layers[0].data.texture,{image:this.uiCanvas.uuid}),Object.assign(this.data.material.layers[1].data,{roughness:i.radius,alpha:i.enabled?1:0}),Object.assign(this.dataPatched.material.layers[0].data.texture,{image:this.uiCanvas.uuid}),Object.assign(this.dataPatched.material.layers[1].data,{roughness:i.radius,alpha:i.enabled?1:0}),this.material.reset(this.dataPatched.material,e,!0)}}updateEntity2DByOp(e,t,i,r){this.uiCanvas.updateEntity2DByOp(e,t,i,r),e===this.frameId&&t.type===0&&(t.props.cornerRadius!==void 0?this.applyGeometryParametersFromFrame(r):pr(t.path,["backgroundBlur"])&&this.applyMaterialParametersFromFrame({shared:r}))}get frame(){return this.uiCanvas.frame}get frameId(){var e;return(e=this.frame)==null?void 0:e.uuid}removeInteractionGeometry(e){super.removeInteractionGeometry(e),this.applySize({},e)}updateGeometryInteractions(e,t){super.updateGeometryInteractions(e,t),this.applySize({width:e.width,height:e.height},t)}},aFe=class{constructor(e,t,i){this.variables=[],this.currentTextureIndex=0;let r=or,n=new co,s=new Cf;s.position.z=1;let a={passThruTexture:{value:null}},o=u(d(),a),l=new yr(new au(2,2),o);n.add(l),this.setDataType=function(f){return r=f,this},this.addVariable=function(f,p,v){let m=this.createShaderMaterial(p),g={name:f,initialValueTexture:v,material:m,dependencies:null,renderTargets:[],wrapS:null,wrapT:null,minFilter:Ci,magFilter:Ci};return this.variables.push(g),g},this.setVariableDependencies=function(f,p){f.dependencies=p},this.init=function(){if(i.capabilities.isWebGL2===!1&&i.extensions.has("OES_texture_float")===!1)return"No OES_texture_float support for float textures.";if(i.capabilities.maxVertexTextures===0)return"No support for vertex shader textures.";for(let f=0;f<this.variables.length;f++){let p=this.variables[f];p.renderTargets[0]=this.createRenderTarget(e,t,p.wrapS,p.wrapT,p.minFilter,p.magFilter),p.renderTargets[1]=this.createRenderTarget(e,t,p.wrapS,p.wrapT,p.minFilter,p.magFilter),this.renderTexture(p.initialValueTexture,p.renderTargets[0]),this.renderTexture(p.initialValueTexture,p.renderTargets[1]);let v=p.material,m=v.uniforms;if(p.dependencies!==null)for(let g=0;g<p.dependencies.length;g++){let y=p.dependencies[g];if(y.name!==p.name){let x=!1;for(let _=0;_<this.variables.length;_++)if(y.name===this.variables[_].name){x=!0;break}if(!x)return"Variable dependency not found. Variable="+p.name+", dependency="+y.name}m[y.name]={value:null},v.fragmentShader=`
uniform sampler2D `+y.name+`;
`+v.fragmentShader}}return this.currentTextureIndex=0,null},this.compute=function(){let f=this.currentTextureIndex,p=this.currentTextureIndex===0?1:0;for(let v=0,m=this.variables.length;v<m;v++){let g=this.variables[v];if(g.dependencies!==null){let y=g.material.uniforms;for(let x=0,_=g.dependencies.length;x<_;x++){let M=g.dependencies[x];y[M.name].value=M.renderTargets[f].texture}}this.doRenderTarget(g.material,g.renderTargets[p])}this.currentTextureIndex=p},this.getCurrentRenderTarget=function(f){return f.renderTargets[this.currentTextureIndex]},this.getAlternateRenderTarget=function(f){return f.renderTargets[this.currentTextureIndex===0?1:0]},this.dispose=function(){l.geometry.dispose(),l.material.dispose();let f=this.variables;for(let p=0;p<f.length;p++){let v=f[p];v.initialValueTexture&&v.initialValueTexture.dispose();let m=v.renderTargets;for(let g=0;g<m.length;g++)m[g].dispose()}};function c(f){f.defines.resolution="vec2( "+e.toFixed(1)+", "+t.toFixed(1)+" )"}this.addResolutionDefine=c;function u(f,p){p=p||{};let v=new ki({uniforms:p,vertexShader:h(),fragmentShader:f});return c(v),v}this.createShaderMaterial=u,this.createRenderTarget=function(f,p,v,m,g,y){return f=f||e,p=p||t,v=v||Tr,m=m||Tr,g=g||Ci,y=y||Ci,new Ni(f,p,{wrapS:v,wrapT:m,minFilter:g,magFilter:y,format:Lr,type:r,depthBuffer:!1})},this.createTexture=function(){let f=new Float32Array(e*t*4),p=new Da(f,e,t,Lr,or);return p.needsUpdate=!0,p},this.renderTexture=function(f,p){a.passThruTexture.value=f,this.doRenderTarget(o,p),a.passThruTexture.value=null},this.doRenderTarget=function(f,p){let v=i.getRenderTarget(),m=i.xr.enabled,g=i.shadowMap.autoUpdate,y=i.outputEncoding,x=i.toneMapping;i.xr.enabled=!1,i.shadowMap.autoUpdate=!1,i.outputEncoding=sc,i.toneMapping=Jc,l.material=f,i.setRenderTarget(p),i.render(n,s),l.material=o,i.xr.enabled=m,i.shadowMap.autoUpdate=g,i.outputEncoding=y,i.toneMapping=x,i.setRenderTarget(v)};function h(){return`void main()	{

	gl_Position = vec4( position, 1.0 );

}
`}function d(){return`uniform sampler2D passThruTexture;

void main() {

	vec2 uv = gl_FragCoord.xy / resolution.xy;

	gl_FragColor = texture2D( passThruTexture, uv );

}
`}}},_s=new Rs,CM=new N,oFe=class{constructor(e){let t=e.geometry;if(!t.isBufferGeometry||t.attributes.position.itemSize!==3)throw new Error("THREE.MeshSurfaceSampler: Requires BufferGeometry triangle mesh.");t.index&&(console.warn("THREE.MeshSurfaceSampler: Converting geometry to non-indexed BufferGeometry."),t=t.toNonIndexed()),this.geometry=t,this.randomFunction=Math.random,this.positionAttribute=this.geometry.getAttribute("position"),this.colorAttribute=this.geometry.getAttribute("color"),this.weightAttribute=null,this.distribution=null}setWeightAttribute(e){return this.weightAttribute=e?this.geometry.getAttribute(e):null,this}build(){let e=this.positionAttribute,t=this.weightAttribute,i=new Float32Array(e.count/3);for(let n=0;n<e.count;n+=3){let s=1;t&&(s=t.getX(n)+t.getX(n+1)+t.getX(n+2)),_s.a.fromBufferAttribute(e,n),_s.b.fromBufferAttribute(e,n+1),_s.c.fromBufferAttribute(e,n+2),s*=_s.getArea(),i[n/3]=s}this.distribution=new Float32Array(e.count/3);let r=0;for(let n=0;n<i.length;n++)r+=i[n],this.distribution[n]=r;return this}setRandomGenerator(e){return this.randomFunction=e,this}sample(e,t,i){let r=this.distribution[this.distribution.length-1],n=this.binarySearch(this.randomFunction()*r);return this.sampleFace(n,e,t,i)}binarySearch(e){let t=this.distribution,i=0,r=t.length-1,n=-1;for(;i<=r;){let s=Math.ceil((i+r)/2);if(s===0||t[s-1]<=e&&t[s]>e){n=s;break}else e<t[s]?r=s-1:i=s+1}return n}sampleFace(e,t,i,r){let n=this.randomFunction(),s=this.randomFunction();return n+s>1&&(n=1-n,s=1-s),_s.a.fromBufferAttribute(this.positionAttribute,e*3),_s.b.fromBufferAttribute(this.positionAttribute,e*3+1),_s.c.fromBufferAttribute(this.positionAttribute,e*3+2),t.set(0,0,0).addScaledVector(_s.a,n).addScaledVector(_s.b,s).addScaledVector(_s.c,1-(n+s)),i!==void 0&&_s.getNormal(i),r!==void 0&&this.colorAttribute!==void 0&&(_s.a.fromBufferAttribute(this.colorAttribute,e*3),_s.b.fromBufferAttribute(this.colorAttribute,e*3+1),_s.c.fromBufferAttribute(this.colorAttribute,e*3+2),CM.set(0,0,0).addScaledVector(_s.a,n).addScaledVector(_s.b,s).addScaledVector(_s.c,1-(n+s)),r.r=CM.x,r.g=CM.y,r.b=CM.z),this}};function lFe(e){let t=new Float32Array(e*e*2);for(let i=0;i<e;i++)for(let r=0;r<e;r++){let n=i*e+r;t[n*2+0]=i/(e-1),t[n*2+1]=r/(e-1)}return t}function cFe(e){let t=Math.ceil(Math.sqrt(e));return Math.max(t,1)}function uFe(e,t){let i=new yr(e.geometry,e.material),r=[],n=[],s=new N,a=new N;i.geometry.index!==null&&(i.geometry=i.geometry.toNonIndexed());let o=new oFe(i).build();for(let u=0;u<t;u++)o.sample(s,a),r.push(s.x,s.y,s.z),n.push(a.x,a.y,a.z);let l=new Float32Array(r),c=new Float32Array(n);return{positions:l,normals:c}}function G9(e,t){let i=e,r=new Float32Array(4*t*t);for(let s=0;s<t*t;s++)r[4*s]=i[3*s],r[4*s+1]=i[3*s+1],r[4*s+2]=i[3*s+2],r[4*s+3]=0;let n=new Da(r,t,t,Lr,or);return n.needsUpdate=!0,n}function hFe({size:e}){let t=new Float32Array(4*e*e);for(let r=0;r<e*e;r++)t[4*r]=r,t[4*r+1]=0,t[4*r+2]=0,t[4*r+3]=0;let i=new Da(t,e,e,Lr,or);return i.needsUpdate=!0,i}function dFe(e){let t=new Float32Array(4*e*e);for(let r=0;r<e*e;r++)t[4*r]=0,t[4*r+1]=0,t[4*r+2]=0,t[4*r+3]=0;let i=new Da(t,e,e,Lr,or);return i.needsUpdate=!0,i}var fFe=`
// uniform sampler2D uCurrentPosition; // Pass in the variable from GPGPU
// uniform sampler2D uCurrentVelocity; // Pass in the variable from GPGPU
// uniform sampler2D uCurrentEmissionRate; // Pass in the variable from GPGPU
uniform sampler2D uOriginalPosition;
uniform float uTime;
uniform float uSpeed;     // update speed of the particles
uniform vec3 uWorldOffset;    
uniform vec4 uWorldQuaternion;
uniform float uMaxLifeTime;
uniform vec3 uEmitterSize;
uniform float uFPSRatio;     // 1  for 60 FPS

float random (vec2 st) {
    return fract(sin(dot(st.xy,
        vec2(12.9898,78.233)))*
        43758.5453123);
}
vec3 applyQuaternionToVector( vec4 q, vec3 v ){
    return v + 2.0 * cross( q.xyz, cross( q.xyz, v ) + q.w * v );
}

vec3 applyForce(vec3 force, float mass) {
    vec3 acceleration = force / mass;
    
    return acceleration;
  }
  

void main() {
    vec2 vUv = gl_FragCoord.xy / resolution.xy;
    vec3 position = texture2D( uCurrentPosition, vUv ).xyz;
    float currentLife = texture2D( uCurrentPosition, vUv ).w;   // from 1 to 0
    float isSpawning = texture2D( uCurrentEmissionRate, vUv ).r;        // 1. = spawning, 0. = not spawning
    float isActive = texture2D( uCurrentEmissionRate, vUv ).g;          // 1. = active, 0. = not active
    float timeStart = texture2D( uCurrentEmissionRate, vUv ).b;         // timeStart in seconds when the particle was emitted
    vec3 originalPosition = ((texture2D( uOriginalPosition, vUv ).xyz) * uEmitterSize);
    vec3 velocity = texture2D( uCurrentVelocity, vUv ).xyz;
    float collisionFlag = texture2D( uCurrentVelocity, vUv ).w;             // 1. = collided, 0. = not collided
    float lifeTime = uMaxLifeTime;

    // Calculate the position adjustment based on collision
    //     if (collisionFlag > .5) {  
    float isColliding = step(0.5, collisionFlag); // 1.0 if collisionFlag > 0.5, otherwise 0.0
    float bounceOffset = 3.0 * isColliding; // Becomes 3.0 if colliding, 0.0 otherwise
    vec3 collisionAdjustedVelocity = velocity * (1.0 + bounceOffset);

    // Update position based on collision or normal movement
    vec3 fpsVelocity = velocity * min(uFPSRatio, 5.0);
    position += mix(fpsVelocity, collisionAdjustedVelocity, isColliding);

    // EMISSION RATE - BIRTH
    // if (isSpawning == 1.0) {
    // Better Approach to avoid If statement
    vec3 newPosition = applyQuaternionToVector(uWorldQuaternion, originalPosition) + uWorldOffset;
    originalPosition = mix(originalPosition, newPosition, isSpawning);
    position = mix(position, originalPosition, isSpawning);;
    timeStart = mix(timeStart, uTime, isSpawning);

    // Calculate timeLeft for life normalization
    float timeLeft = max(lifeTime - (uTime - timeStart), 0.0);
    float life_Normalize = timeLeft / lifeTime;

    // Use isActive to blend between the calculated color and black
    vec4 activeColor = vec4(position, life_Normalize);
    // if (isActive == 1.0) {
    gl_FragColor = mix(vec4(0.0), activeColor, isActive);

}
`,pFe=`

    vec3 mod289(vec3 x) {
      return x - floor(x * (1.0 / 289.0)) * 289.0;
    }
    
    vec4 mod289(vec4 x) {
    return x - floor(x * (1.0 / 289.0)) * 289.0;
    }
    
    vec4 permute(vec4 x) {
        return mod289(((x*34.0)+1.0)*x);
    }
    
    vec4 taylorInvSqrt(vec4 r)
    {
    return 1.79284291400159 - 0.85373472095314 * r;
    }
    
    vec3 fade(vec3 t) {
  return t*t*t*(t*(t*6.0-15.0)+10.0);
}

    float snoise(vec3 v)
    {
    const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;
    const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);
    vec3 i  = floor(v + dot(v, C.yyy) );
    vec3 x0 =   v - i + dot(i, C.xxx) ;
    vec3 g = step(x0.yzx, x0.xyz);
    vec3 l = 1.0 - g;
    vec3 i1 = min( g.xyz, l.zxy );
    vec3 i2 = max( g.xyz, l.zxy );
    vec3 x1 = x0 - i1 + C.xxx;
    vec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y
    vec3 x3 = x0 - D.yyy;      // -1.0+3.0*C.x = -0.5 = -D.y
    
    // Permutations
    i = mod289(i);
    vec4 p = permute( permute( permute(
                i.z + vec4(0.0, i1.z, i2.z, 1.0 ))
              + i.y + vec4(0.0, i1.y, i2.y, 1.0 ))
              + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));
    
    // Gradients: 7x7 points over a square, mapped onto an octahedron.
    // The ring size 17*17 = 289 is close to a multiple of 49 (49*6 = 294)
    float n_ = 0.142857142857; // 1.0/7.0
    vec3  ns = n_ * D.wyz - D.xzx;
    
    vec4 j = p - 49.0 * floor(p * ns.z * ns.z);  //  mod(p,7*7)
    
    vec4 x_ = floor(j * ns.z);
    vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)
    
    vec4 x = x_ *ns.x + ns.yyyy;
    vec4 y = y_ *ns.x + ns.yyyy;
    vec4 h = 1.0 - abs(x) - abs(y);
    
    vec4 b0 = vec4( x.xy, y.xy );
    vec4 b1 = vec4( x.zw, y.zw );
    
    vec4 s0 = floor(b0)*2.0 + 1.0;
    vec4 s1 = floor(b1)*2.0 + 1.0;
    vec4 sh = -step(h, vec4(0.0));
    
    vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;
    vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;
    
    vec3 p0 = vec3(a0.xy,h.x);
    vec3 p1 = vec3(a0.zw,h.y);
    vec3 p2 = vec3(a1.xy,h.z);
    vec3 p3 = vec3(a1.zw,h.w);
    
    //Normalise gradients
    vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));
    p0 *= norm.x;
    p1 *= norm.y;
    p2 *= norm.z;
    p3 *= norm.w;
    
    // Mix final noise value
    vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);
    m = m * m;
    return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1),
                                  dot(p2,x2), dot(p3,x3) ) );
    }
    
    vec3 snoiseVec3( vec3 x ){
    
      float s  = snoise(vec3( x ));
      float s1 = snoise(vec3( x.y - 19.1 , x.z + 33.4 , x.x + 47.2 ));
      float s2 = snoise(vec3( x.z + 74.2 , x.x - 124.5 , x.y + 99.4 ));
      vec3 c = vec3( s , s1 , s2 );
      return c;
    
    }
    
      
    vec3 curlNoise( vec3 p, float seed){
      p += seed;
      const float e = .1;
      vec3 dx = vec3( e   , 0.0 , 0.0 );
      vec3 dy = vec3( 0.0 , e   , 0.0 );
      vec3 dz = vec3( 0.0 , 0.0 , e   );
    
      vec3 p_x0 = snoiseVec3( p - dx );
      vec3 p_x1 = snoiseVec3( p + dx );
      vec3 p_y0 = snoiseVec3( p - dy );
      vec3 p_y1 = snoiseVec3( p + dy );
      vec3 p_z0 = snoiseVec3( p - dz );
      vec3 p_z1 = snoiseVec3( p + dz );
    
      float x = p_y1.z - p_y0.z - p_z1.y + p_z0.y;
      float y = p_z1.x - p_z0.x - p_x1.z + p_x0.z;
      float z = p_x1.y - p_x0.y - p_y1.x + p_y0.x;
    
      const float divisor = 1.0 / ( 2.0 * e );
      return normalize( vec3( x , y , z ) * divisor );
    
    }


// Classic Perlin noise
float cnoise(vec3 P)
{
  vec3 Pi0 = floor(P); // Integer part for indexing
  vec3 Pi1 = Pi0 + vec3(1.0); // Integer part + 1
  Pi0 = mod289(Pi0);
  Pi1 = mod289(Pi1);
  vec3 Pf0 = fract(P); // Fractional part for interpolation
  vec3 Pf1 = Pf0 - vec3(1.0); // Fractional part - 1.0
  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);
  vec4 iy = vec4(Pi0.yy, Pi1.yy);
  vec4 iz0 = Pi0.zzzz;
  vec4 iz1 = Pi1.zzzz;

  vec4 ixy = permute(permute(ix) + iy);
  vec4 ixy0 = permute(ixy + iz0);
  vec4 ixy1 = permute(ixy + iz1);

  vec4 gx0 = ixy0 * (1.0 / 7.0);
  vec4 gy0 = fract(floor(gx0) * (1.0 / 7.0)) - 0.5;
  gx0 = fract(gx0);
  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);
  vec4 sz0 = step(gz0, vec4(0.0));
  gx0 -= sz0 * (step(0.0, gx0) - 0.5);
  gy0 -= sz0 * (step(0.0, gy0) - 0.5);

  vec4 gx1 = ixy1 * (1.0 / 7.0);
  vec4 gy1 = fract(floor(gx1) * (1.0 / 7.0)) - 0.5;
  gx1 = fract(gx1);
  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);
  vec4 sz1 = step(gz1, vec4(0.0));
  gx1 -= sz1 * (step(0.0, gx1) - 0.5);
  gy1 -= sz1 * (step(0.0, gy1) - 0.5);

  vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);
  vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);
  vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);
  vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);
  vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);
  vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);
  vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);
  vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);

  vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));
  g000 *= norm0.x;
  g010 *= norm0.y;
  g100 *= norm0.z;
  g110 *= norm0.w;
  vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));
  g001 *= norm1.x;
  g011 *= norm1.y;
  g101 *= norm1.z;
  g111 *= norm1.w;

  float n000 = dot(g000, Pf0);
  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));
  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));
  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));
  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));
  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));
  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));
  float n111 = dot(g111, Pf1);

  vec3 fade_xyz = fade(Pf0);
  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);
  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);
  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x); 
  return 2.2 * n_xyz;
}


vec3 fbm_vec3(vec3 p, float frequency, float offset)
{
  return vec3(
    cnoise((p+vec3(offset))*frequency),
    cnoise((p+vec3(offset+20.0))*frequency),
    cnoise((p+vec3(offset-30.0))*frequency)
  );
}

`,mFe=`
  #ifdef USE_COLLIDER
    float restitution = max(uBounce * 2., .01); // Energy Loss
    // SPHERE COLLIDER
    // **************************************************************
    #ifdef USE_SPHERE_COLLIDER       
      // Convert collider size to radii (assuming uColliderSize is the diameter in each axis)
      vec3 radii = uColliderSize;
      // Adjust position relative to collider
      vec3 relPos = position - uColliderPos;
      // Apply rotation of the collider to the relative position
      relPos = applyQuaternionToVector(uColliderQuaternionInvert, relPos);            
      // Scale relative position by radii (for ellipsoid collision detection)
      vec3 scaledPos = relPos / radii;
      // Calculate ellipsoidal distance
      float dist = length(scaledPos); // Distance in terms of ellipsoid
      
      // Check for collision
      if (dist <= 1. + particleSize / length(radii) && collisionFlag == 0.0) {
          // Compute the normal at the collision point, accounting for particle size
        vec3 adjustedPos = scaledPos * (1.0 + particleSize / length(radii));          
        // Compute the normal at the collision point
        vec3 normal = ellipsoidNormal(adjustedPos, radii);
        // Rotate the normal back to world space
        normal = applyQuaternionToVector(uColliderQuaternion, normal);
        // Reflect the velocity vector off the normal
        velocity = reflect(velocity, normal) * restitution;

        collisionFlag = 1.0;
      } else {
        collisionFlag = 0.0;
      }
    #endif

    // BOX COLLIDER or PLANE COLLIDER 
    // **************************************************************
    #ifdef USE_BOX_COLLIDER
      // Box dimensions and repulsion variables
      vec3 boxHalfSize = uColliderSize / 2.0;
      // Convert world position to box's local space
      vec3 localPos = applyQuaternionToVector(uColliderQuaternionInvert, position - uColliderPos);      
      // Collision detection
      vec3 localDistance = abs(localPos) - boxHalfSize;
      float distToSurface = max(localDistance.x, max(localDistance.y, localDistance.z));    

      // Collision Detected
      if (distToSurface <= particleSize * 0.5 && collisionFlag == 0.0) {      
        // Find the nearest face normal for bounce direction
        vec3 normal;
        if (localDistance.x > localDistance.y && localDistance.x > localDistance.z) {
            normal = vec3(sign(localPos.x), 0.0, 0.0);
        } else if (localDistance.y > localDistance.z) {
            normal = vec3(0.0, sign(localPos.y), 0.0);
        } else {
            normal = vec3(0.0, 0.0, sign(localPos.z));
        }            
        // Rotate normal back to world space
        normal = applyQuaternionToVector(uColliderQuaternion, normal);      
        // Reflect velocity and apply repulsion force
        velocity = reflect(velocity, normal) * restitution;
        
        collisionFlag = 1.0;
      } else {
        collisionFlag = 0.0;
      }
    #endif      
  #endif      
  // END COLLIDER    
`,gFe=`
  #ifdef USE_ATTRACTOR

      #ifdef USE_SPHERE_COLLIDER      
        // Convert collider size to radii (assuming uColliderSize is the diameter in each axis)
        vec3 radii = uColliderSize;
        // Adjust position relative to collider
        vec3 relPos = position - uColliderPos;
        // Apply rotation of the collider to the relative position
        relPos = applyQuaternionToVector(uColliderQuaternionInvert, relPos);            
        // Scale relative position by radii (for ellipsoid collision detection)
        vec3 scaledPos = relPos / radii;
        // Calculate ellipsoidal distance
        float distToSurface = length(scaledPos); // Distance in terms of ellipsoid
        float insideCheck = 1.0;

      #endif


      #ifdef USE_BOX_COLLIDER
        // Box dimensions
        vec3 boxHalfSize = uColliderSize / 2.0;
        // Convert world position to box's local space
        vec3 localPos = applyQuaternionToVector(uColliderQuaternionInvert, position - uColliderPos);      
        vec3 localDistance = abs(localPos) - boxHalfSize;
        float distToSurface = max(localDistance.x, max(localDistance.y, localDistance.z));
        float insideCheck = particleSize;
      #endif      
  
      // Apply vortex force inside the Helper
      #ifdef USE_FORCE_LOCAL_SPACE
        if (distToSurface <= insideCheck ) {    
            // Define parameters for the attractor field
            #ifdef USE_SPHERE_COLLIDER      
              float attractorStrength = (1.0 - distToSurface ) * uForceIntensity; // Adjust as needed
            #endif

            #ifdef USE_BOX_COLLIDER
              float attractorStrength = max((1.0 - insideCheck / distToSurface), 0.) * uForceIntensity; // Adjust as needed
              #endif

            float attractorDamping = uForceDamping;  // Adjust as needed (higher values will attenuate velocity more)
          
            // Use the same radii calculation code as for the collider
            vec3 attractorRadii = uColliderSize;
            // Adjust position relative to attractor center
            vec3 relPos = position - uColliderPos;
            // Apply rotation of the collider to the relative position
            relPos = applyQuaternionToVector(uColliderQuaternionInvert, relPos);            
            // Scale relative position by radii (for ellipsoid attraction)
            vec3 scaledPos = relPos / attractorRadii;

            // Calculate ellipsoidal distance as attractor radius
            float attractorRadius = length(scaledPos);
            // Calculate the distance from the attractor center
            vec3 relativePosition = position - uColliderPos;
            // Calculate the force vector towards the attractor center
            vec3 attractorForce = normalize(relativePosition) * attractorStrength;
            // Apply the attractor force to the particle
            velocity -= attractorForce;
            // Attenuate the particle's velocity
            velocity *= attractorDamping;
        }
      #else 
            // Calculate the distance from the attractor center
            vec3 relativePosition = position - uColliderPos;
            // Calculate the force vector towards the attractor center
            vec3 attractorForce = normalize(relativePosition) * uForceIntensity;
            // Apply the attractor force to the particle
            velocity -= attractorForce;
            // Attenuate the particle's velocity
            velocity *= uForceDamping;
      #endif    
  #endif      
`,vFe=`
  #ifdef USE_VORTEX
    // Box dimensions
    vec3 boxHalfSize = uColliderSize / 2.0;
    // Convert world position to box's local space
    vec3 localPos = applyQuaternionToVector(uColliderQuaternionInvert, position - uColliderPos);      
    vec3 localDistance = abs(localPos) - boxHalfSize;
    float distToSurface = max(localDistance.x, max(localDistance.y, localDistance.z));

    // Apply vortex force inside the box
    if (distToSurface <= particleSize) {
      float vortexStrength = uForceIntensity;
      vec3 localTopCenter = vec3(0.0, 0., 0.0);

      // Transform the local top center to the world space
      vec3 vortexCenter = uColliderPos + applyQuaternionToVector(uColliderQuaternion, localTopCenter);
      // Calculate the vector from particle to vortex center
      vec3 vortexVector = vortexCenter - position;

      // Calculate the rotation axis from the inverse of the collider's quaternion and the fixed up vector
      // Note: important to add a tiny z component to the up vector to avoid instability
      vec3 upVector = vec3(0.0, 1.0, 0.01);
      vec3 rotationAxis = cross(upVector, applyQuaternionToVector(uColliderQuaternion, vortexVector));
      rotationAxis = normalize(rotationAxis);

      // Add rotational component to velocity
      float rotationSpeed = length(vortexVector * vortexStrength * 3.0) ; 

      vec3 rotationVelocity = rotationAxis * rotationSpeed;
      // velocity += rotationVelocity * 0.005 ;
      velocity = rotationVelocity * 0.005 ;

      // Calculate vortex force
      // vec3 vortexForce = normalize(vortexVector) * uSpeed * .1 ;
      // Apply the vortex force to the particle
      vec3 originDirection = applyQuaternionToVector(uWorldQuaternion, directions);
      velocity += applyForce( originDirection * uSpeed * (1. - uForceDamping) , mass * .5);
    }
  #endif      
`,yFe=`
// uniform sampler2D uCurrentPosition; // Pass in the variable from GPGPU
// uniform sampler2D uCurrentVelocity; // Pass in the variable from GPGPU
// uniform sampler2D uCurrentEmissionRate; // Pass in the variable from GPGPU
uniform sampler2D uOriginalPosition;
uniform sampler2D uDirections;     
uniform vec3 uDirectionsAxis;
uniform vec4 uWorldQuaternion;
uniform vec3 uGravity;        
uniform float uNoiseStrength;     // Variation of the noise
uniform float uNoiseScale;        // Scale of the noise
uniform float uNoiseSeed;         // Seed of the noise
uniform float particleSize;
uniform float uSpeed;     // update speed of the particles
uniform float uRandomMassFactor;

// COLLIDER
uniform vec3 uColliderPos;                // Collider Position
uniform vec3 uColliderSize;               // Collider Dimension
uniform vec4 uColliderQuaternion;         // Collider Rotation
uniform vec4 uColliderQuaternionInvert;   // Collider Rotation
uniform float uBounce;                    // Bounce factor
uniform float uForceDamping;
uniform float uForceIntensity;


`+pFe+`
float rand(vec2 co){
    return fract(sin(dot(co, vec2(12.9898, 78.233))) * 43758.5453);
}
vec3 applyQuaternionToVector( vec4 q, vec3 v ){
    return v + 2.0 * cross( q.xyz, cross( q.xyz, v ) + q.w * v );
 } 
vec3 applyForce(vec3 force, float mass) {
  vec3 acceleration = force / mass;
  
  return acceleration;
}

vec4 conjugate(vec4 q) {
  return vec4(q.w, -q.x, -q.y, -q.z);
}

// Function to compute the normal of the ellipsoid at a given point
vec3 ellipsoidNormal(vec3 p, vec3 radii) {
  return normalize(p / (radii * radii));
}

float friction = .3;

void main() {
    vec2 vUv = gl_FragCoord.xy / resolution.xy;
    vec3 position = texture2D( uCurrentPosition, vUv ).xyz;
    vec3 originalPosition = texture2D( uOriginalPosition, vUv ).xyz;
    float timeLeft = texture2D( uCurrentPosition, vUv ).w;
    vec3 directions = texture2D( uDirections, vUv ).xyz;    
    vec3 velocity = texture2D( uCurrentVelocity, vUv ).xyz;
    float mass = rand(originalPosition.xy) * 0.5 + 0.5;
    float isSpawning = texture2D( uCurrentEmissionRate, vUv ).x;        // 1. = spawning, 0. = not spawning
    float isActive = texture2D( uCurrentEmissionRate, vUv ).y;          // 1. = active, 0. = not active
    float collisionFlag =texture2D( uCurrentVelocity, vUv ).w;          // Indicate collision

    // Randomness Mass
    mass = (1.0 - (uRandomMassFactor * mass));
    
    if (isActive == 1.0) {
      // **************************************************************
      // FORCES NOISES
      // **************************************************************
      #ifdef USE_CURL_NOISE
        if (uNoiseScale > 0.0 ) {
          velocity = curlNoise(position * uNoiseScale * .002, uNoiseSeed) * ( uNoiseStrength + 1.0) * .05 * uSpeed;
        }
        // Variation of the noise Over Time
        if (uNoiseStrength > 0.0 && uNoiseScale == 0.0 ) {
          velocity += curlNoise( position, uNoiseSeed)  * uNoiseStrength * 0.05 * uSpeed;
        }
      #endif
      // **************************************************************
      #ifdef USE_SIMPLEX_NOISE
        if (uNoiseScale > 0.0 ) {
          velocity = vec3(snoise(position * uNoiseScale * .001) * ( uNoiseStrength + 1.0) * .1);
          velocity *= uSpeed;
        }
        // Variation of the noise Over Time
        if (uNoiseStrength > 0.0 && uNoiseScale == 0.0) {
          velocity += vec3(snoise(position * uNoiseStrength * .001) * .05 * uSpeed);
        }
      #endif
      // ************************************************************** 
      #ifdef USE_FBM_NOISE
        if (uNoiseScale > 0.0 ) {
          velocity = fbm_vec3(position * uNoiseScale * .001, ( uNoiseStrength + 1.0), uNoiseSeed);
          velocity *= uSpeed;
        }
        // Variation of the noise Over Time
        if (uNoiseStrength > 0.0 && uNoiseScale == 0.0 ) {      
          velocity += fbm_vec3(position * uNoiseStrength * .001, ( uNoiseStrength + 1.0), uNoiseSeed) * .1 * uSpeed;
        }
      #endif

      // COLLIDER
      ${mFe}
      // ATTRACTION
      ${gFe}  
      // VORTEX
      ${vFe}
    } 
    // End isActive

    // SPAWN BIRTH 
    // **************************************************************
    // if (isSpawning == 1.)
    #ifdef USE_NORMALS
      velocity = mix(velocity, applyQuaternionToVector(uWorldQuaternion, directions) * uSpeed, isSpawning);
    #else
      velocity = mix(velocity, applyQuaternionToVector(uWorldQuaternion, uDirectionsAxis) * uSpeed, isSpawning);    
    #endif
    
    // if (collisionFlag == 0.0)
    velocity += applyForce(uGravity, mass * .5) * (1.0 - collisionFlag);

    gl_FragColor = vec4(velocity, collisionFlag);
}
`,Eie=`

  // Linear Fade In
  float linearFadeIn(float t) {
    return t;
  }


  // linear fade out
  float linearFadeOut(float t) {
    return 1.0 - t;
  }
  
  float linearInOut(float t) {
    return t < 0.5 ? t :  (1.0 - t);  
  }

    // lerp
    float lerp(float a, float b, float t) {
      return a + (b - a) * t;
    }

  // Ease In Out Quart
  float exponentialInOut(float t) {
    return t < 0.4 ? lerp(0.0, 1.0, t / 0.4) :
    t > 0.6 ? lerp(1.0, 0.0, (t - 0.6) / 0.4) :
    1.0;
   }

  // constant
  float constant(float t) {
    return 1.0;
  } 
`,xFe=`

float rand(vec3 co){
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

vec3 applyQuaternionToVector( vec4 q, vec3 v ){
  return v + 2.0 * cross( q.xyz, cross( q.xyz, v ) + q.w * v );
}

vec3 applyForce(vec3 force, float mass) {
  vec3 acceleration = force / mass;
    
  return acceleration;
}
`,wFe=`
vec3 rgb2xyz (in vec3 rgb) {
    float r = rgb.r;
	float g = rgb.g;
	float b = rgb.b;

	r = r > 0.04045 ? pow(((r + 0.055) / 1.055), 2.4) : (r / 12.92);
	g = g > 0.04045 ? pow(((g + 0.055) / 1.055), 2.4) : (g / 12.92);
	b = b > 0.04045 ? pow(((b + 0.055) / 1.055), 2.4) : (b / 12.92);

	float x = (r * 0.4124) + (g * 0.3576) + (b * 0.1805);
	float y = (r * 0.2126) + (g * 0.7152) + (b * 0.0722);
	float z = (r * 0.0193) + (g * 0.1192) + (b * 0.9505);
    
    vec3 xyz = vec3(
        (r * 0.4124) + (g * 0.3576) + (b * 0.1805) * 100.0,
        (r * 0.2126) + (g * 0.7152) + (b * 0.0722) * 100.0,
        (r * 0.0193) + (g * 0.1192) + (b * 0.9505) * 100.0
    );
    return(xyz);
}

vec3 xyz2lab (in vec3 xyz) {
	float x = xyz.x / 95.047;
	float y = xyz.y / 100.0;
	float z = xyz.z / 108.883;

	x = x > 0.008856 ? pow(x, 1.0 / 3.0) : (7.787 * x) + (16.0 / 116.0);
	y = y > 0.008856 ? pow(y, 1.0 / 3.0) : (7.787 * y) + (16.0 / 116.0);
	z = z > 0.008856 ? pow(z, 1.0 / 3.0) : (7.787 * z) + (16.0 / 116.0);

    vec3 lab = vec3((116.0 * y) - 16.0, 500.0 * (x - y), 200.0 * (y - z));
    return(lab);
}

vec3 rgb2lab(in vec3 rgb) {
    vec3 xyz = rgb2xyz(rgb);
    vec3 lab = xyz2lab(xyz);
    return(lab);
}

vec3 xyz2rgb (in vec3 xyz) {
	float x = xyz.x / 100.0;
	float y = xyz.y / 100.0;
	float z = xyz.z / 100.0;
	
    
	float r = (x *  3.2406) + (y * -1.5372) + (z * -0.4986);
	float g = (x * -0.9689) + (y *  1.8758) + (z *  0.0415);
	float b = (x *  0.0557) + (y * -0.2040) + (z *  1.0570);

	r = r > 0.0031308 ? ((1.055 * pow(r, 1.0 / 2.4)) - 0.055) : r * 12.92;
	g = g > 0.0031308 ? ((1.055 * pow(g, 1.0 / 2.4)) - 0.055) : g * 12.92;
	b = b > 0.0031308 ? ((1.055 * pow(b, 1.0 / 2.4)) - 0.055) : b * 12.92;

	r = min(max(0.0, r), 1.0);
	g = min(max(0.0, g), 1.0);
	b = min(max(0.0, b), 1.0);

	return(vec3(r, g, b));
}

vec3 lab2xyz (in vec3 lab) {
    float l = lab.x;
	float a = lab.y;
	float b = lab.z;

  	float y = (l + 16.0) / 116.0;
	float x = a / 500.0 + y;
	float z = y - b / 200.0;

	float y2 = pow(y, 3.0);
	float x2 = pow(x, 3.0);
	float z2 = pow(z, 3.0);

  	y = y2 > 0.008856 ? y2 : (y - 16.0 / 116.0) / 7.787;
	x = x2 > 0.008856 ? x2 : (x - 16.0 / 116.0) / 7.787;
	z = z2 > 0.008856 ? z2 : (z - 16.0 / 116.0) / 7.787;

	x *= 95.047;
	y *= 100.0;
	z *= 108.883;

	return(vec3(x, y, z));
}
vec3 lab2rgb (in vec3 lab) {
    vec3 xyz = lab2xyz(lab);
    vec3 rgb = xyz2rgb(xyz);
    return(rgb);
}

`,bFe=`
  uniform sampler2D uPosition;
  uniform float uSize;
  uniform float uSizeEnd;
  uniform vec3 uWorldOffset;
  uniform vec4 uWorldQuaternion;
  // Billboard Behavior - Currently at Zero, but we can change that
  uniform float uRotation;
  uniform float uRotationEnd;
  uniform vec2 center;

  // Randomness
  uniform float uRandScaleFactor;
  uniform float uRandRotationFactor;

  attribute vec2 ref;

  varying float v_LifeLeft;    // normalized lifetime 1 to 0
  varying vec2 vUv;
  varying vec2 vRef;

  ${xFe}
  ${Eie}
`,_Fe=({easeSize:e="linearFadeOut"})=>`
  vUv = uv;  
  vRef = ref;
  // Normalized LifeTime 1 to 0
  float lifeLeft = texture2D(uPosition, ref).w;
  v_LifeLeft = lifeLeft;
  // Position From DataTexture Simulation
  vec3 pos = texture2D(uPosition, ref).rgb - uWorldOffset;
  // Apply World Quaternion
  pos = applyQuaternionToVector(uWorldQuaternion, pos);  
            
  #ifdef  USE_SIZE_END
    // Scaled Over Time
    float t = 1. - lifeLeft;
    float currentSize = mix(uSize, uSizeEnd, t); // Linearly interpolate between uSize and uSizeEnd
    vec3 scaledPosition = position * vec3(currentSize);
  #else
    // Change Size Behavior over LifeTime
    float easeSize = ${e}(1. - lifeLeft);
    // Scaled Over Time
    vec3 scaledPosition = position * vec3(uSize * easeSize);
  #endif

  // Billboard Behavior
  vec2 scale;
  scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
  scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );    
  // Randomness 
  float randRef = rand(ref);
  scale *= (1.0 - (uRandScaleFactor * randRef));
  // Rotation
  float randRotation =  2.0 * PI * ( uRandRotationFactor * randRef);
  float originalRotation = (1.0 - uRotation) * 2.0 * PI;
  float originalRotationEnd = (1.0 - uRotationEnd) * 2.0 * PI;
  // OverTime
  float finalRotation = mix(originalRotation + randRotation, originalRotationEnd + randRotation, lifeLeft);

  vec2 alignedPosition = ( scaledPosition.xy - ( center - vec2( 0.5 ) ) ) * scale;
  vec2 rotatedPosition;
  rotatedPosition.x = cos( finalRotation ) * alignedPosition.x - sin( finalRotation ) * alignedPosition.y;
  rotatedPosition.y = sin( finalRotation ) * alignedPosition.x + cos( finalRotation ) * alignedPosition.y;
  
  mat4 instanceMatrix = mat4(
    vec4(1.0, 0.0, 0.0, 0.0),
    vec4(0.0, 1.0, 0.0, 0.0),
    vec4(0.0, 0.0, 1.0, 0.0),
    vec4(pos.x, pos.y, pos.z, 1.0)
  );  

  mvPosition = modelViewMatrix * instanceMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
  mvPosition.xy += rotatedPosition;
  gl_Position = projectionMatrix  * mvPosition;   
`,SFe=`
  uniform vec4 uColor;                // start color
  uniform vec4 uColor2;               // end color
  uniform sampler2D uTexture;         // texture
  varying float v_LifeLeft;   // normalized lifetime 1 to 0
  varying vec2 vUv;
  varying vec2 vRef;

  float random(vec2 co) {
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
  }
  `+Eie+`  
  ${wFe}

`,MFe=({easeOpacity:e="linearFadeOut"})=>`  
  // if Particle is dead, hide it
  if (v_LifeLeft <= 0.005 ) {
    discard;
  }

  #ifdef USE_RANDOM_COLORING
    float randVal = random(vRef); // Generate a random value based on the reference
    vec4 color = mix(uColor, uColor2, randVal); // Interpolate between the two colors
  #else
    vec4 color = mix(uColor, uColor2, 1. - v_LifeLeft);
  #endif

  // Opacity over Life Time
  float finalAlpha = ${e}(1. - v_LifeLeft);  
  vec4 textureColor = texture2D(uTexture, vUv).rgba; 
  finalColor = textureColor.rgb * color.rgb;
  finalAlpha = color.a * textureColor.a * finalAlpha;
  
  gl_FragColor = vec4(finalColor, finalAlpha);     

`,EFe=class extends ki{constructor(e,t){super(),this.needsJitter=!0,this.type="ParticleMaterial",this.easeOpacity="linearFadeIn",this.easeSize="linearFadeIn",this.useSizeEnd=!1,this.isColoringRandom=!1,this.init(e,t),this.context=t}reset(){}init(e,t){this.transparent=!0,this.depthTest=!0,this.depthWrite=!1,this.easeOpacity=e.ease,this.easeSize=e.easeSize,this.layers=[],jn.startContext(jn.globalContext),this.lightLayer=new Bc(0,"",{...cs.defaultData("light","phong"),visible:!1},new $N,{},t.shared),jn.endContext(jn.globalContext),this.build()}updateState(e){e.coloring!==void 0&&(this.isColoringRandom=e.coloring==="random"),e.color!==void 0&&(e.color instanceof Array?this.uniforms.uColor.value=e.color:this.uniforms.uColor.value=this.context.shared.color(e.color)),e.color2!==void 0&&(e.color2 instanceof Array?this.uniforms.uColor2.value=e.color2:this.uniforms.uColor2.value=this.context.shared.color(e.color2)),e.size!==void 0&&(this.uniforms.uSize.value=e.size[0],this.uniforms.uSizeEnd.value=e.size[1],e.size[0]!==e.size[1]?this.useSizeEnd=!0:this.useSizeEnd=!1),e.ease!==void 0&&(this.easeOpacity=e.ease,this.build()),e.easeSize!==void 0&&(this.easeSize=e.easeSize,this.build()),this.needsUpdate=!0}onBeforeCompile(e){this.build(),e.defines=this.defines,e.uniforms=this.uniforms,e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader}build(){let e=new Ste;return e.needsJitter=this.needsJitter,e.addFragmentParsCode(iIe),e.buildShader("vertex",this.fragment),e.buildShader("fragment",this.fragment),e.addFragmentFinalCode(rIe),this.isColoringRandom&&e.define("USE_RANDOM_COLORING"),this.useSizeEnd&&e.define("USE_SIZE_END"),e.addVertexParsCode(bFe),e.addFragmentParsCode(SFe),e.addVertexFinalCode(_Fe({easeSize:this.easeSize})),e.addFragmentFinalCode(MFe({easeOpacity:this.easeOpacity})),this.vertexShader=e.getCode("vertex"),this.fragmentShader=e.getCode("fragment"),this.defines=e.defines,this.uniforms={...e.uniforms,...this.uniforms},this.extensions=e.extensions,this}get nodeMaterial(){return this}get fragment(){return this.lightLayer.node}getDefines(){return this.defines}nodeMaterialDispose(){this.layers.forEach(e=>e.dispose()),super.dispose()}},QR=class{constructor(e,t,i,r){this.type="SphereEmitterShape",this.targetMesh=void 0,this.size=e,this.type=i,this.textureSize=cFe(t);let n=1;this.targetMesh=(r==null?void 0:r.type)==="Mesh"&&r?r:this.getMesh(i,n);let{positions:s,dataTexture:a,dataTextureNormals:o}=this.createPositions(this.textureSize,this.targetMesh??this.getMesh(i,n));this.positionsTexture=a,this.positionsAttribute=s,this.directionsTexture=o}createPositions(e,t){let{positions:i,normals:r}=uFe(t,e*e),n=G9(i,e),s=G9(r,e);return{dataTexture:n,positions:i,dataTextureNormals:s}}getMesh(e,t){let i=null;switch(e){case"SphereEmitterShape":{i=new l0(t*.5,32,32);break}case"TorusEmitterShape":{i=new s$(t*.5,.3,15,40);break}case"ConeEmitterShape":{i=new aN(t,t,15);break}case"BoxEmitterShape":{i=new ac(t,t,t);break}case"PlaneEmitterShape":{i=new au(t,t),i.rotateX(-Math.PI/2);break}case"MeshEmitterShape":{i=new l0(t,32,32);break}default:{i=new l0(t,32,32);break}}return new yr(i,new Ch({color:16711680}))}applyToShader(e,t){this.size=new N().fromArray(t.size),e.uEmitterSize.value=this.size}dispose(){this.positionsTexture.dispose(),this.directionsTexture.dispose(),this.positionsAttribute=new Float32Array}};function bv(e){let t={...e},i=RA.defaultData;t.forceFieldObjectId&&(t.colliderEntityId=t.forceFieldObjectId);let r={...i.shape,...t.shape},n={...i.renderMaterial,...t.renderMaterial};return{...i,...t,shape:r,renderMaterial:n}}var AFe=`
// uniform sampler2D uCurrentPosition; // Pass in the variable from GPGPU
// uniform sampler2D uCurrentVelocity; // Pass in the variable from GPGPU
// uniform sampler2D uCurrentEmissionRate; // Pass in the variable from GPGPU

uniform sampler2D uIndex; // Texture with corresponding index
uniform float uLastIndexEmitted; // Last emitted index
uniform float uParticlesToEmit; // Number of particles to emit on that frame
uniform float uTime;

void main() {
    vec2 vUv = gl_FragCoord.xy / resolution.xy;
    float particleIndex = texture(uIndex, vUv).x;
    float timeLeft = texture2D( uCurrentPosition, vUv ).w;
    float isActive = texture2D( uCurrentEmissionRate, vUv ).g;    // 1. = active, 0. = not active
    float timeStart = texture2D( uCurrentEmissionRate, vUv ).b;


    // ********** Detect Colision to Create a flag and use it in position **********
    // We are doing this here, so

    // ********** Emit Particles **********
    // X = isSpawning 0.0 or 1.0
    // Y = isActive 0.0 or 1.0
    // Check if the vertex index is between the first value and the last value
    // if (particleIndex >= uLastIndexEmitted && particleIndex < uLastIndexEmitted + uParticlesToEmit) {
    //     // Emit a particle by writing 1 to the red channel of the color output
    //     // r: 1. == emit the particle
    //     // g: 1. == particle is now active
    //     timeStart = uTime;
    //     gl_FragColor = vec4(1.0, 1.0, timeStart, 1.0);
    // } else {
    //     // The Particle is either already emitted or not in the range of the particles to emit
    //     // Do not emit a particle by writing 0 to the red channel of the color output        
    //     gl_FragColor = vec4(0.0, isActive, timeStart, 1.0);
    // }
    // Determine if the particle is within the emission range
    float emitLowerBound = step(uLastIndexEmitted, particleIndex);
    float emitUpperBound = step(particleIndex, uLastIndexEmitted + uParticlesToEmit - 1.0);
    float emitParticle = emitLowerBound * emitUpperBound; // 1.0 if in range, 0.0 otherwise

    // Set timeStart and color
    timeStart = mix(timeStart, uTime, emitParticle);
    gl_FragColor = vec4(emitParticle, mix(isActive, 1.0, emitParticle), timeStart, 1.0);


}
`,ZR=10,TFe=class extends rr{constructor(e,t){super(),this.type="ParticleEmitter",this.debugMode=!1,this.worldSpace=!0,this.rootObject=null,this.gpuCompute=null,this.positionSimRT=null,this.velocitySimRT=null,this.emissionRateSimRT=null,this.emitterShape=void 0,this.isEmitting=!1,this.hasBeenReset=!1,this.emittedParticlesAmount=0,this.lastEmitTime=0,this.globalTime=0,this.targetFPS=60,this.previousRatio=1,this.lerpFactor=.4,this.particlesAmount=0,this.noiseStrength=0,this.noiseScale=0,this.isBillboardBased=!0,this.simFeaturesDefinition={USE_COLLIDER:!1,USE_ATTRACTOR:!1,USE_VORTEX:!1,USE_SPHERE_COLLIDER:!1,USE_BOX_COLLIDER:!1,USE_FORCE_LOCAL_SPACE:!1,USE_NORMALS:!1,USE_CURL_NOISE:!0,USE_SIMPLEX_NOISE:!1,USE_FBM_NOISE:!1},this.textureLoader=new Mwe,this.currentWorldPosition=new N,this.systemQuaternion=new ri,this.worldGravity=new N(0,0,0),this.directionAxis=new N(0,0,0),this.colliderV3=new N(0,0,0),this.colliderQuaternion=new ri(0,0,0,1),this.matrixAutoUpdate=!0,this.renderer=e,this.system=t,this.shared=t.context.shared;let i=t.data;this.material=new EFe(i.renderMaterial,t.context),this.material.uniforms={uSize:{value:0},uSizeEnd:{value:0},uColor:{value:i.renderMaterial.color},uColor2:{value:i.renderMaterial.color2},uPosition:{value:new N(0,0,0)},uEmissionData:{value:new N(0,0,0)},uTexture:{value:this.defaultTexture},uWorldOffset:{value:new N(0,0,0)},uWorldQuaternion:{value:new ai(0,0,0,1)},uRandScaleFactor:{value:i.randomScale??0},uRandRotationFactor:{value:i.randomRotation??0},uRotation:{value:i.renderMaterial.spriteRotation[0]??0},uRotationEnd:{value:i.renderMaterial.spriteRotation[1]??0}},this.setTexture(this.material.uniforms,i.renderMaterial.texture),this.init(i)}setTexture(e,t){let i=t.data;if(typeof t=="string"){let r=this.shared.image(t),n=new jr(r.img);n.needsUpdate=!0,e.uTexture.value=n;return}if(typeof i!="string"){let r=new Image;r.onload=()=>{let a=new jr(r);a.needsUpdate=!0,e.uTexture.value=a};let n=new Blob([i],{type:"image/*"}),s=URL.createObjectURL(n);r.src=s}}updateGeometryAttributes(e,t){var r;let i=lFe(t);!((r=this.emitterShape)!=null&&r.positionsAttribute)||e.geometry.setAttribute("ref",new Dw(i,2))}applyWorldSpace(){if(!this.system.started||!this.worldSpace||!this.positionSimRT||!this.velocitySimRT)return;let e=this.system;e.getWorldQuaternion(this.systemQuaternion),this.systemQuaternion.invert(),e.getWorldPosition(this.currentWorldPosition),this.material.uniforms.uWorldOffset.value=this.currentWorldPosition,this.material.uniforms.uWorldQuaternion.value.copy(this.systemQuaternion.normalize()),this.positionSimRT.material.uniforms.uWorldOffset.value=this.currentWorldPosition,this.systemQuaternion.invert(),this.positionSimRT.material.uniforms.uWorldQuaternion.value.copy(this.systemQuaternion.normalize()),this.velocitySimRT.material.uniforms.uWorldQuaternion.value.copy(this.systemQuaternion.normalize())}update(e,t){var a;if(!this.gpuCompute||!this.positionSimRT||!this.velocitySimRT||!this.emissionRateSimRT||this.hasBeenReset)return;if(this.checkIfAllParticlesAreDead()&&!this.hasBeenReset){this.reset();return}this.applyWorldSpace(),this.globalTime=e,this.positionSimRT.material.uniforms.uTime.value=e,this.emissionRateSimRT.material.uniforms.uTime.value=e;let i=1e3/t,r=this.targetFPS/i,n=this.previousRatio+(r-this.previousRatio)*this.lerpFactor;this.positionSimRT.material.uniforms.uFPSRatio.value=n,this.previousRatio=n;let s=this.isEmitting?this.GoEmitSomeParticles(e,this.system.data.birthRatePerSec):0;this.emissionRateSimRT.material.uniforms.uLastIndexEmitted.value=this.emittedParticlesAmount,this.emissionRateSimRT.material.uniforms.uParticlesToEmit.value=s,this.material.uniforms.uPosition.value=(a=this.gpuCompute.getCurrentRenderTarget(this.positionSimRT))==null?void 0:a.texture,this.system.colliderEntities.length>0&&this.renderColliders(),this.gpuCompute.compute()}renderColliders(){if(!this.velocitySimRT)return;let e=this.system.colliderEntities[0],t=this.simFeaturesDefinition.USE_COLLIDER||this.simFeaturesDefinition.USE_ATTRACTOR||this.simFeaturesDefinition.USE_VORTEX;if(e.destroyedInAction&&t&&this.init(bv({...this.system.data,colliderEntityId:null})),!e||e.destroyedInAction)return;e.getWorldPosition(this.colliderV3),this.colliderV3.y===0&&(this.colliderV3.y=1e-4),this.velocitySimRT.material.uniforms.uColliderPos.value.copy(this.colliderV3);let i=e.data.size;this.colliderV3.fromArray(i),this.velocitySimRT.material.uniforms.uColliderSize.value.copy(this.simFeaturesDefinition.USE_SPHERE_COLLIDER?this.colliderV3.multiplyScalar(.5):this.colliderV3),e.getWorldQuaternion(this.colliderQuaternion),this.velocitySimRT.material.uniforms.uColliderQuaternion.value.copy(this.colliderQuaternion.normalize()),this.velocitySimRT.material.uniforms.uColliderQuaternionInvert.value.copy(this.colliderQuaternion.normalize().invert())}updateState(e){!this.velocitySimRT||!this.positionSimRT||(e.renderMaterial&&this.updateMaterialState(e.renderMaterial),this.updateParticleState(e))}updateVariableState(e,t){if(!this.velocitySimRT||!this.positionSimRT)return;t[2]==="size"&&this.material.updateState({size:[e,this.material.uniforms.uSizeEnd.value]}),t[2]==="sizeEnd"&&this.material.updateState({size:[this.material.uniforms.uSize.value,e]});let i=(r,n)=>{let s=[...this.system.data.shape.size];s[r]=n,this.updateParticleState({shape:{...this.system.data.shape,size:s}})};t[2]==="shape_size_0"&&i(0,e),t[2]==="shape_size_1"&&i(1,e),t[2]==="shape_size_2"&&i(2,e),t[2]==="speed"&&(this.velocitySimRT.material.uniforms.uSpeed.value=e/ZR),t[2]==="gravity"&&this.worldGravity.set(0,e/100,0),t[2]==="noiseStrength"&&(this.noiseStrength=e,this.velocitySimRT.material.uniforms.uNoiseStrength.value=this.noiseStrength),t[2]==="noiseScale"&&(this.noiseScale=e,this.velocitySimRT.material.uniforms.uNoiseScale.value=this.noiseScale),t[2]==="direction_x"&&(this.directionAxis=this.getDirectionAxis([Number(e),this.system.data.direction[1],this.system.data.direction[2]])),t[2]==="direction_y"&&(this.directionAxis=this.getDirectionAxis([this.system.data.direction[0],Number(e),this.system.data.direction[2]])),t[2]==="direction_z"&&(this.directionAxis=this.getDirectionAxis([this.system.data.direction[0],this.system.data.direction[1],Number(e)]))}updateMaterialState(e){this.material.updateState({...e,size:e.size?[Number(this.shared.getVariable(e.size[0],[this.uuid,"particles","size"])),Number(this.shared.getVariable(e.size[1],[this.uuid,"particles","sizeEnd"]))]:[0,0]}),e.texture&&(this.setTexture(this.material.uniforms,e.texture),this.material.needsUpdate=!0)}updateParticleState(e){var t,i,r;if(!(!this.positionSimRT||!this.velocitySimRT)){if(this.shouldReInitGPUCompute(e)&&this.init(bv(this.system.data)),e.life!==void 0&&(this.positionSimRT.material.uniforms.uMaxLifeTime.value=e.life),e.speed!==void 0&&(this.velocitySimRT.material.uniforms.uSpeed.value=Number(this.shared.getVariable(e.speed,[this.uuid,"particles","speed"]))/ZR),e.collisionBounce!==void 0&&(this.velocitySimRT.material.uniforms.uBounce.value=e.collisionBounce),e.noiseStrength!==void 0&&(this.noiseStrength=Number(this.shared.getVariable(e.noiseStrength,[this.uuid,"particles","noiseStrength"])),this.velocitySimRT.material.uniforms.uNoiseStrength.value=this.noiseStrength),e.noiseScale!==void 0&&(this.noiseScale=Number(this.shared.getVariable(e.noiseScale,[this.uuid,"particles","noiseScale"])),this.velocitySimRT.material.uniforms.uNoiseScale.value=this.noiseScale),e.noiseSeed!==void 0&&(this.velocitySimRT.material.uniforms.uNoiseSeed.value=e.noiseSeed),e.randomMass!==void 0&&(this.velocitySimRT.material.uniforms.uRandomMassFactor.value=e.randomMass),((t=e.renderMaterial)==null?void 0:t.size)!==void 0){let n=this.shared.getVariable(e.renderMaterial.size[0],[this.uuid,"particles","size"]);this.velocitySimRT.material.uniforms.particleSize.value=Number(n)}if(((i=e.renderMaterial)==null?void 0:i.spriteRotation)!==void 0&&(this.material.uniforms.uRotation.value=e.renderMaterial.spriteRotation[0],this.material.uniforms.uRotationEnd.value=e.renderMaterial.spriteRotation[1]),e.shape!==void 0){let n=e.shape.size??this.system.data.shape.size,s=[Number(this.shared.getVariable(n[0],[this.uuid,"particles","shape_size_0"])),Number(this.shared.getVariable(n[1],[this.uuid,"particles","shape_size_1"])),Number(this.shared.getVariable(n[2],[this.uuid,"particles","shape_size_2"]))],a={...bv(this.system.data).shape,size:s};(r=this.emitterShape)==null||r.applyToShader(this.positionSimRT.material.uniforms,a)}if(e.gravity!==void 0&&(this.worldGravity.set(0,Number(this.shared.getVariable(this.system.data.gravity,[this.uuid,"particles","gravity"]))/100,0),this.velocitySimRT.material.uniforms.uGravity={value:this.worldGravity}),e.direction!==void 0){let n=this.getDirectionFromVariable(e.direction);this.directionAxis=this.getDirectionAxis(n),this.velocitySimRT.material.uniforms.uDirectionsAxis.value=this.directionAxis}e.randomRotation!==void 0&&(this.material.uniforms.uRandRotationFactor.value=e.randomRotation),e.randomScale!==void 0&&(this.material.uniforms.uRandScaleFactor.value=e.randomScale)}}updateForceFieldParameters(e){!this.velocitySimRT||(e.forceIntensity!==void 0&&(this.velocitySimRT.material.uniforms.uForceIntensity.value=e.forceIntensity),e.forceDambing!==void 0&&(this.velocitySimRT.material.uniforms.uForceDamping.value=e.forceDambing))}getDirectionAxis(e){let t=[Number(e[0])*Tt.DEG2RAD,Number(e[1])*Tt.DEG2RAD,Number(e[2])*Tt.DEG2RAD],i=new Wn(t[0],t[1],t[2],"XYZ");return this.directionAxis.set(0,1,0).applyEuler(i).normalize(),this.velocitySimRT&&(this.velocitySimRT.material.uniforms.uDirectionsAxis.value=this.directionAxis),this.directionAxis}shouldReInitGPUCompute(e){let{birthRatePerSec:t,rootObjectType:i,colliderEntityId:r,shape:n,emitTimeDuration:s,emitTimeCycle:a,life:o,directionMode:l,noiseType:c}=e;return t!==void 0||i!==void 0||r||r===null||a!==void 0||n!==void 0||o!==void 0||s!==void 0||l!==void 0||c!==void 0}init(e){this.dispose(),this.particlesAmount=this.getMaxParticlesAmount({birthRatePerSecond:e.birthRatePerSec,particleMaxLifeTime:e.life,loopDuration:e.emitTimeCycle==="infinity"?0:e.emitTimeDuration}),this.particlesAmount>1e5&&(console.warn("The maximum number of particles is limited to 100000."),this.particlesAmount=1e5),this.emitterShape=this.createShape(e.shape,this.particlesAmount);let t=setInterval(()=>{if(this.emitterShape)if(isNaN(this.emitterShape.positionsTexture.source.data.data[0])){this.init(e);return}else clearInterval(t)},100);if(!this.emitterShape)return;let i=new aFe(this.emitterShape.textureSize,this.emitterShape.textureSize,this.renderer),r=this.updateSimulationDefinition(e),n=i.addVariable("uCurrentPosition",r+fFe,this.emitterShape.positionsTexture),s=i.addVariable("uCurrentVelocity",r+yFe,this.emitterShape.directionsTexture),a=i.addVariable("uCurrentEmissionRate",AFe,dFe(this.emitterShape.textureSize));i.setVariableDependencies(n,[n,s,a]),i.setVariableDependencies(s,[n,s,a]),i.setVariableDependencies(a,[n,s,a]);let o=hFe({size:this.emitterShape.textureSize}),l={uOriginalPosition:{value:this.emitterShape.positionsTexture},uWorldOffset:{value:new N(0,0,0)},uWorldQuaternion:{value:new ai(0,0,0,1)},uTime:{value:0},uFPSRatio:{value:1},uMaxLifeTime:{value:e.life},uEmitterSize:{value:new N(Number(this.shared.getVariable(e.shape.size[0],[this.uuid,"particles","shape_size_0"])),Number(this.shared.getVariable(e.shape.size[1],[this.uuid,"particles","shape_size_1"])),Number(this.shared.getVariable(e.shape.size[2],[this.uuid,"particles","shape_size_2"])))},particleSize:{value:0}};n.material.uniforms=l;let c=this.getDirectionFromVariable(e.direction);this.directionAxis=this.getDirectionAxis(c),this.worldGravity.set(0,Number(this.shared.getVariable(this.system.data.gravity,[this.uuid,"particles","gravity"]))/100,0),this.noiseStrength=Number(this.shared.getVariable(e.noiseStrength,[this.uuid,"particles","noiseStrength"])),this.noiseScale=Number(this.shared.getVariable(e.noiseScale,[this.uuid,"particles","noiseScale"]));let u=e.colliderEntityId&&this.system.getColliderData(e.colliderEntityId),h={uOriginalPosition:{value:this.emitterShape.positionsTexture},uDirections:{value:this.emitterShape.directionsTexture},uDirectionsAxis:{value:this.directionAxis},uWorldQuaternion:{value:new ai(0,0,0,1)},uColliderPos:{value:new N(0,0,0)},uColliderSize:{value:new N(0,0,0)},uForceIntensity:{value:u?u.forceIntensity:0},uForceDamping:{value:u?u.forceDambing:0},uColliderQuaternion:{value:new ai(0,0,0,1)},uColliderQuaternionInvert:{value:new ai(0,0,0,1)},particleSize:{value:0},uGravity:{value:this.worldGravity},uNoiseStrength:{value:this.noiseStrength},uNoiseScale:{value:this.noiseScale},uNoiseSeed:{value:e.noiseSeed},uRandomMassFactor:{value:e.randomMass},uBounce:{value:e.collisionBounce},uSpeed:{value:Number(this.shared.getVariable(e.speed,[this.uuid,"particles","speed"]))/ZR}};s.material.uniforms=h;let d={uIndex:{value:o},uTime:{value:0},uLastIndexEmitted:{value:0},uParticlesToEmit:{value:0}};a.material.uniforms=d;let f=[Number(this.shared.getVariable(e.shape.size[0],[this.uuid,"particles","shape_size_0"])),Number(this.shared.getVariable(e.shape.size[1],[this.uuid,"particles","shape_size_1"])),Number(this.shared.getVariable(e.shape.size[2],[this.uuid,"particles","shape_size_2"]))],p={...bv(this.system.data).shape,size:f};this.emitterShape.applyToShader(n.material.uniforms,p),i.init(),this.gpuCompute=i,this.positionSimRT=n,this.velocitySimRT=s,this.emissionRateSimRT=a,this.rootObject=this.createPrimaryEmitter(this.emitterShape.textureSize),this.add(this.rootObject),this.material.needsUpdate=!0}getDirectionFromVariable(e){let t=Number(this.shared.getVariable(e[0],[this.uuid,"particles","direction_x"])),i=Number(this.shared.getVariable(e[1],[this.uuid,"particles","direction_y"])),r=Number(this.shared.getVariable(e[2],[this.uuid,"particles","direction_z"]));return[t,i,r]}updateSimulationDefinition(e){if(this.simFeaturesDefinition.USE_COLLIDER=!1,this.simFeaturesDefinition.USE_ATTRACTOR=!1,this.simFeaturesDefinition.USE_VORTEX=!1,this.simFeaturesDefinition.USE_SPHERE_COLLIDER=!1,this.simFeaturesDefinition.USE_BOX_COLLIDER=!1,this.simFeaturesDefinition.USE_FORCE_LOCAL_SPACE=!1,this.simFeaturesDefinition.USE_NORMALS=!1,this.simFeaturesDefinition.USE_CURL_NOISE=!1,this.simFeaturesDefinition.USE_SIMPLEX_NOISE=!1,this.simFeaturesDefinition.USE_FBM_NOISE=!1,e.colliderEntityId&&this.system.colliderEntities.length>0){let i=this.system.getColliderData(e.colliderEntityId);switch(i==null?void 0:i.forceType){case"attractor":this.simFeaturesDefinition.USE_ATTRACTOR=!0;break;case"collider":this.simFeaturesDefinition.USE_COLLIDER=!0;break;case"vortex":this.simFeaturesDefinition.USE_VORTEX=!0;break}let r=i==null?void 0:i.colliderType;r==="sphere"&&(this.simFeaturesDefinition.USE_SPHERE_COLLIDER=!0),r==="box"&&(this.simFeaturesDefinition.USE_BOX_COLLIDER=!0),(i==null?void 0:i.forceRange)==="helper"&&(this.simFeaturesDefinition.USE_FORCE_LOCAL_SPACE=!0)}e.directionMode==="normals"&&(this.simFeaturesDefinition.USE_NORMALS=!0),e.noiseType==="curl"&&(this.simFeaturesDefinition.USE_CURL_NOISE=!0),e.noiseType==="simplex"&&(this.simFeaturesDefinition.USE_SIMPLEX_NOISE=!0),e.noiseType==="fbm"&&(this.simFeaturesDefinition.USE_FBM_NOISE=!0);let t="";for(let[i,r]of Object.entries(this.simFeaturesDefinition))r&&(t+=`#define ${i}
`);return t}createShape(e,t){this.emitterShape&&this.emitterShape.dispose();let i=new N(Number(this.shared.getVariable(e.size[0],[this.uuid,"particles","shape_size_0"])),Number(this.shared.getVariable(e.size[1],[this.uuid,"particles","shape_size_1"])),Number(this.shared.getVariable(e.size[2],[this.uuid,"particles","shape_size_2"])));if(e.type==="MeshEmitterShape"){let r=null;return this.system.context.scene.traverseEntity(n=>{n.uuid===e.fromMeshId&&(r=n)}),r?new QR(i,t,e.type,r):new QR(i,t,"SphereEmitterShape")}else return new QR(i,t,e.type)}createPrimaryEmitter(e){let t,i=e*e;return t=new Fxe(new au(1,1,1),this.material,i),this.updateGeometryAttributes(t,e),this.material.needsUpdate=!0,t.onBeforeRender=()=>{this.applyWorldSpace()},t}getMaxParticlesAmount({birthRatePerSecond:e,particleMaxLifeTime:t,loopDuration:i=0}){return Math.ceil(e*(t+i))}dispose(){var e,t,i;!this.gpuCompute||((t=(e=this.rootObject)==null?void 0:e.parent)==null||t.remove(this.rootObject),this.gpuCompute.dispose(),this.material.nodeMaterialDispose(),(i=this.emitterShape)==null||i.dispose())}GoEmitSomeParticles(e,t){let i=e-this.lastEmitTime,r=1/t;if(i>=r){let n=Math.max(1,Math.floor(i/r));return this.lastEmitTime=e,this.emittedParticlesAmount+n>this.particlesAmount&&(this.emittedParticlesAmount=0),this.emittedParticlesAmount+=n,n}return 0}checkIfAllParticlesAreDead(){return this.lastEmitTime+this.system.data.life+1<this.globalTime}reset(){this.hasBeenReset=!0,this.lastEmitTime=0,this.emittedParticlesAmount=0,this.gpuCompute&&this.init(bv(this.system.data))}startEmitting(e){this.isEmitting=!0,this.hasBeenReset=!1,this.lastEmitTime=e}stopEmitting(){this.isEmitting=!1}},Nx=class extends za{constructor(e,t,i){super(e,t),this.type="ParticleSystem",this.geometry=new Nt,this.actualTime=0,this.currentLoopTime=0,this.started=!1,this.stopped=!1,this.timeoutId=void 0,this.isFrozen=!1,this.isIdle=!0,this.emitter=null,this.colliderEntities=[],this.renderer=null,this.isPreWarm=!1,this._hasOnAfterRenderBeenCalled=!1,this.onAfterRender=r=>{this._hasOnAfterRenderBeenCalled||(this._hasOnAfterRenderBeenCalled=!0,this.init(r))},this.context=i,this.data={...t,...bv(t)},this.geometry.setAttribute("position",new _t([],3)),this.material=new Ch({colorWrite:!1}),this.frustumCulled=!1}init(e){this.renderer=e,this.emitter=new TFe(e,this),this.add(this.emitter),this.updateParticleState(this.data)}update(e){if(!this.isReady||!this.started||this.isFrozen||this.isIdle)return;this.actualTime+=e,this.stopped||(this.currentLoopTime+=e);let t=this.data.emitTimeCycle==="one_time";if((this.data.emitTimeCycle==="loop"||t)&&this.currentLoopTime>this.data.emitTimeDuration*1e3&&(this.stopped||(this.stop(),t||this.start(this.data.emitTimeDelay*1e3))),this.emitter&&this.started){let i=this.actualTime/1e3;this.emitter.update(i,e)}this.scale.set(1,1,1),this.updateMatrix()}isReady(){return!!this.emitter}hasCollider(e){return this.colliderEntities.some(t=>t.identity===e)}getColliderData(e){let t=this.colliderEntities.find(i=>i.identity===e);return t?t.data:null}updateByPatchedOp(e,t,i){super.updateByPatchedOp(e,t,i),pr(e.path,["renderMaterial"])&&this.updateParticleState({renderMaterial:{...this.data.renderMaterial,...fs.drop(e,1).props}}),pr(e.path,["shape"])&&this.updateParticleState({shape:{...this.data.shape,...fs.drop(e,1).props}})}updateState(e,t){super.updateState(e,t),this.updateParticleState(e)}updateParticleState(e){if(this.emitter){if(e.colliderEntityId!==void 0&&e.colliderEntityId!==null){let t=this.context.scene.find(e.colliderEntityId);this.colliderEntities=t?[t]:[]}e.colliderEntityId===null&&(this.colliderEntities=[]),this.emitter.updateState(e),e.emitTimeCycle&&this.started&&this.start()}}updateFromColliderEntity(e){!this.emitter||(this.emitter.updateForceFieldParameters(e),this.stop(),this.start())}start(e=0){var t;if(this.currentLoopTime=0,e){this.timeoutId=window.setTimeout(()=>{this.start(0)},e);return}this.started=!0,this.stopped=!1,this.isFrozen=!1,(t=this.emitter)==null||t.startEmitting(this.actualTime/1e3)}froze(){this.isFrozen=!0}unFroze(){this.isFrozen=!1}stop(){var e;this.stopped=!0,this.currentLoopTime=0,(e=this.emitter)==null||e.stopEmitting(),clearTimeout(this.timeoutId)}reset(){var e;this.started=!1,this.stopped=!1,(e=this.emitter)==null||e.reset()}wakeUp(){this.isIdle=!1}sleep(){this.isIdle=!0,this.reset()}};function CFe(){try{let e=window.location.href;if(e.includes("reducesubdiv=")){let t=e.indexOf("reducesubdiv=")+13;return parseInt(e.slice(t,t+1))}}catch{}}var KR=CFe();function PFe(e,t,i){var n;KR!==void 0&&(((n=t==null?void 0:t.geometry)==null?void 0:n.subdivisions)??0)>KR&&(console.log("reducing subdivisions",t.name,t.geometry.subdivisions),t.geometry.subdivisions=KR);let r;return t.geometry.type==="TextGeometry"?new s4(e,t,i):t.geometry.type==="InputGeometry"?new f4(e,t,i):(t.geometry.type==="SubdivGeometry"?r=new Qw(e,t,i):t.geometry.type==="PathGeometry"?r=new d4(e,t,i):t.geometry.type==="VectorGeometry"?r=new nFe(e,t,i):t.geometry.type==="BooleanGeometry"?r=new Pm(e,t,i):t.geometry.type==="ShapeBlendGeometry"?r=new Dm(e,t,i):t.geometry.type==="UIGeometry"?r=new ia(e,t,i):r=new Rn(e,t,i),r)}function m4(e,t,i){return console.assert(t.type!==void 0),t.type==="Mesh"?PFe(e,t,i):t.type==="Empty"?new v0(e,t):t.type==="Particle"?new Nx(e,t,i):t.type==="ParticleCollider"?new Ux(e,t,i):t.type==="Splat"?new v0(e,t):t.type==="Bone"?new sFe(e,t):t.type==="Page"?new hs(e,t,i):t.type==="PointLight"?new rFe(e,t,i):t.type==="SpotLight"?new pie(e,t,i):t.type==="DirectionalLight"?new fie(e,t,i):t.type==="Component"||t.type==="Instance"?new y0(e,t,i):Am.is(t.type)?new aa(e,t):(console.error(t),new v0(e,t))}Hd.createEntity=m4;function DFe(e,t,i){let r=m4(e.identity,t,i),n=e.children,s=e.attachedPaths,a=e.parent,o=e.component,l=e.instances,c=e.overrideData,u=e.uuid,h=e.stateSelection;e.dispose();for(let d of Object.keys(e))delete e[d];Object.setPrototypeOf(e,Object.getPrototypeOf(r));for(let d of Object.keys(r))e[d]=r[d];e.children=[...e.children,...n],e.attachedPaths=s,e.parent=a,e.component=o,e.instances=l,e.uuid=u,e.overrideData=c,e.updateState(e.data,i),h&&e.changeSelectedState(h,i),e.resetBBoxNeedsUpdate()}Hd.changeEntityProptotype=DFe;Hd.Cloner=fl;function RFe(e,t,i,r){e.updateByOp(t,i,r,!1)}var Up=5,kx=new Nt;kx.setAttribute("position",new Qt(new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),3));var l2=class extends pwe{constructor(e){super({...e,depthTest:!1,depthWrite:!1,glslVersion:WO,vertexShader:`
				precision highp float;
				in vec3 position;
				void main() {
					gl_Position = vec4(position, 1);
				}
			`})}customProgramCacheKey(){return""}};function IFe(){return{shapeInput:()=>`
			const float posRowCoord = ${.5/Up};  // vec4: px py pz opType
			const float quatRowCoord = ${1.5/Up};  // vec4: qx qy qz qw
			const float param1RowCoord = ${2.5/Up};// vec4: type param1 param2 param3
			const float param2RowCoord = ${3.5/Up};// vec4: blendRange roundness scale param4
			const float colorRowCoord = ${4.5/Up}; // vec4: r g b a
			uniform sampler2D shapesDataTexture;
			vec4 shapePos(float iin) { 
				vec4 r = texture(shapesDataTexture, vec2(iin, posRowCoord));
				return r;
			}
			vec4 shapeQuat(float iin) {
				vec4 r = texture(shapesDataTexture, vec2(iin, quatRowCoord));
				return r;
			}
			vec4 shapeParams1(float iin) {
				vec4 r = texture(shapesDataTexture, vec2(iin, param1RowCoord));
				return r;
			}
			vec4 shapeParams2(float iin) {
				vec4 r = texture(shapesDataTexture, vec2(iin, param2RowCoord));
				return r;
			}
			vec4 shapeColor(float iin) {
				vec4 r = texture(shapesDataTexture, vec2(iin, colorRowCoord));
				return r;
			}
		`,getxyzi:`
			// this code must complement lookup
			float xi = mod(gl_FragCoord.x - 0.5, VOXEL_RESOLUTION);
			float yi = mod(gl_FragCoord.y - 0.5, VOXEL_RESOLUTION);
			float zi = floor((gl_FragCoord.x - 0.5) * INV_VOXEL_RESOLUTION) + floor((gl_FragCoord.y - 0.5) * INV_VOXEL_RESOLUTION) * Z_LAYERS_PER_ROW;
		`,lookup:`
			uniform sampler2D potentialPassTexture;
			uniform sampler2D voxelPassTexture; // includes normal (in xyz) and key (in w)
			
			// box or marching cube lookup value in value texture, integer box coord inputs
			// this code must complement codebits.getxyzi
			vec4 look(float xi, float yi, float zi, sampler2D rt) {// range 0 .. numv etc
				vec2 uv = vec2(
					mod(zi, Z_LAYERS_PER_ROW) + (xi + 0.5) / VOXEL_RESOLUTION,
					floor(zi / Z_LAYERS_PER_ROW) + (yi + 0.5) / VOXEL_RESOLUTION
				); 
				uv /= Z_LAYERS_PER_ROW;
				return texture(rt, uv);
			}
		`,getpart:`
			float getpart(inout float a, float b) {
				float t = floor(a/b);
				float r = a - t*b;
				a = t;
				return r;
			}
		`,triTable:new Float32Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,1,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,1,1,8,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,2,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,0,10,2,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,2,9,9,2,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,2,8,10,2,8,9,10,-1,-1,-1,-1,-1,-1,-1,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,11,0,0,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,11,3,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,11,1,11,9,1,11,8,9,-1,-1,-1,-1,-1,-1,-1,1,10,3,3,10,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,10,0,10,8,0,10,11,8,-1,-1,-1,-1,-1,-1,-1,0,9,3,9,11,3,9,10,11,-1,-1,-1,-1,-1,-1,-1,10,8,9,11,8,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,4,4,3,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,1,0,7,4,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,1,4,1,7,4,1,3,7,-1,-1,-1,-1,-1,-1,-1,10,2,1,7,4,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,4,3,4,0,3,10,2,1,-1,-1,-1,-1,-1,-1,-1,10,2,9,2,0,9,7,4,8,-1,-1,-1,-1,-1,-1,-1,9,10,2,7,9,2,3,7,2,4,9,7,-1,-1,-1,-1,7,4,8,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,4,11,4,2,11,4,0,2,-1,-1,-1,-1,-1,-1,-1,1,0,9,7,4,8,11,3,2,-1,-1,-1,-1,-1,-1,-1,11,7,4,11,4,9,2,11,9,1,2,9,-1,-1,-1,-1,1,10,3,10,11,3,4,8,7,-1,-1,-1,-1,-1,-1,-1,10,11,1,11,4,1,4,0,1,4,11,7,-1,-1,-1,-1,8,7,4,11,0,9,10,11,9,3,0,11,-1,-1,-1,-1,11,7,4,9,11,4,10,11,9,-1,-1,-1,-1,-1,-1,-1,4,5,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,5,9,3,8,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,5,0,0,5,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,5,8,5,3,8,5,1,3,-1,-1,-1,-1,-1,-1,-1,10,2,1,4,5,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,0,3,10,2,1,5,9,4,-1,-1,-1,-1,-1,-1,-1,10,2,5,2,4,5,2,0,4,-1,-1,-1,-1,-1,-1,-1,5,10,2,5,2,3,4,5,3,8,4,3,-1,-1,-1,-1,4,5,9,11,3,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,11,0,11,8,0,5,9,4,-1,-1,-1,-1,-1,-1,-1,4,5,0,5,1,0,11,3,2,-1,-1,-1,-1,-1,-1,-1,5,1,2,8,5,2,11,8,2,5,8,4,-1,-1,-1,-1,11,3,10,3,1,10,4,5,9,-1,-1,-1,-1,-1,-1,-1,5,9,4,1,8,0,1,10,8,10,11,8,-1,-1,-1,-1,0,4,5,11,0,5,10,11,5,3,0,11,-1,-1,-1,-1,8,4,5,10,8,5,11,8,10,-1,-1,-1,-1,-1,-1,-1,8,7,9,9,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,9,3,5,9,3,7,5,-1,-1,-1,-1,-1,-1,-1,8,7,0,7,1,0,7,5,1,-1,-1,-1,-1,-1,-1,-1,3,5,1,7,5,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,7,9,7,5,9,2,1,10,-1,-1,-1,-1,-1,-1,-1,2,1,10,0,5,9,0,3,5,3,7,5,-1,-1,-1,-1,2,0,8,5,2,8,7,5,8,2,5,10,-1,-1,-1,-1,5,10,2,3,5,2,7,5,3,-1,-1,-1,-1,-1,-1,-1,5,9,7,9,8,7,2,11,3,-1,-1,-1,-1,-1,-1,-1,7,5,9,2,7,9,0,2,9,11,7,2,-1,-1,-1,-1,11,3,2,8,1,0,8,7,1,7,5,1,-1,-1,-1,-1,1,2,11,7,1,11,5,1,7,-1,-1,-1,-1,-1,-1,-1,8,5,9,7,5,8,3,1,10,11,3,10,-1,-1,-1,-1,0,7,5,9,0,5,0,11,7,10,0,1,0,10,11,-1,0,10,11,3,0,11,0,5,10,7,0,8,0,7,5,-1,5,10,11,5,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,0,6,10,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,0,9,6,10,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,1,8,9,1,6,10,5,-1,-1,-1,-1,-1,-1,-1,5,6,1,1,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,6,1,6,2,1,8,0,3,-1,-1,-1,-1,-1,-1,-1,5,6,9,6,0,9,6,2,0,-1,-1,-1,-1,-1,-1,-1,8,9,5,2,8,5,6,2,5,8,2,3,-1,-1,-1,-1,11,3,2,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,0,11,0,2,11,5,6,10,-1,-1,-1,-1,-1,-1,-1,9,1,0,11,3,2,6,10,5,-1,-1,-1,-1,-1,-1,-1,6,10,5,2,9,1,2,11,9,11,8,9,-1,-1,-1,-1,11,3,6,3,5,6,3,1,5,-1,-1,-1,-1,-1,-1,-1,11,8,0,5,11,0,1,5,0,6,11,5,-1,-1,-1,-1,6,11,3,6,3,0,5,6,0,9,5,0,-1,-1,-1,-1,9,5,6,11,9,6,8,9,11,-1,-1,-1,-1,-1,-1,-1,6,10,5,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,4,3,7,4,10,5,6,-1,-1,-1,-1,-1,-1,-1,0,9,1,6,10,5,7,4,8,-1,-1,-1,-1,-1,-1,-1,5,6,10,7,9,1,3,7,1,4,9,7,-1,-1,-1,-1,2,1,6,1,5,6,8,7,4,-1,-1,-1,-1,-1,-1,-1,5,2,1,6,2,5,4,0,3,7,4,3,-1,-1,-1,-1,7,4,8,5,0,9,5,6,0,6,2,0,-1,-1,-1,-1,9,3,7,4,9,7,9,2,3,6,9,5,9,6,2,-1,2,11,3,4,8,7,5,6,10,-1,-1,-1,-1,-1,-1,-1,6,10,5,2,7,4,0,2,4,11,7,2,-1,-1,-1,-1,9,1,0,8,7,4,11,3,2,6,10,5,-1,-1,-1,-1,1,2,9,2,11,9,11,4,9,4,11,7,6,10,5,-1,7,4,8,5,11,3,1,5,3,6,11,5,-1,-1,-1,-1,11,1,5,6,11,5,11,0,1,4,11,7,11,4,0,-1,9,5,0,5,6,0,6,3,0,3,6,11,7,4,8,-1,9,5,6,11,9,6,9,7,4,9,11,7,-1,-1,-1,-1,9,4,10,10,4,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,6,10,4,10,9,4,3,8,0,-1,-1,-1,-1,-1,-1,-1,1,0,10,0,6,10,0,4,6,-1,-1,-1,-1,-1,-1,-1,1,3,8,6,1,8,4,6,8,10,1,6,-1,-1,-1,-1,9,4,1,4,2,1,4,6,2,-1,-1,-1,-1,-1,-1,-1,8,0,3,9,2,1,9,4,2,4,6,2,-1,-1,-1,-1,4,2,0,6,2,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,4,2,8,6,2,4,-1,-1,-1,-1,-1,-1,-1,9,4,10,4,6,10,3,2,11,-1,-1,-1,-1,-1,-1,-1,2,8,0,11,8,2,10,9,4,6,10,4,-1,-1,-1,-1,2,11,3,6,1,0,4,6,0,10,1,6,-1,-1,-1,-1,1,4,6,10,1,6,1,8,4,11,1,2,1,11,8,-1,4,6,9,6,3,9,3,1,9,3,6,11,-1,-1,-1,-1,1,11,8,0,1,8,1,6,11,4,1,9,1,4,6,-1,6,11,3,0,6,3,4,6,0,-1,-1,-1,-1,-1,-1,-1,8,4,6,8,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,6,10,7,10,8,7,10,9,8,-1,-1,-1,-1,-1,-1,-1,3,7,0,7,10,0,10,9,0,10,7,6,-1,-1,-1,-1,7,6,10,7,10,1,8,7,1,0,8,1,-1,-1,-1,-1,7,6,10,1,7,10,3,7,1,-1,-1,-1,-1,-1,-1,-1,6,2,1,8,6,1,9,8,1,7,6,8,-1,-1,-1,-1,9,6,2,1,9,2,9,7,6,3,9,0,9,3,7,-1,0,8,7,6,0,7,2,0,6,-1,-1,-1,-1,-1,-1,-1,2,3,7,2,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,3,2,8,6,10,9,8,10,7,6,8,-1,-1,-1,-1,7,0,2,11,7,2,7,9,0,10,7,6,7,10,9,-1,0,8,1,8,7,1,7,10,1,10,7,6,11,3,2,-1,1,2,11,7,1,11,1,6,10,1,7,6,-1,-1,-1,-1,6,9,8,7,6,8,6,1,9,3,6,11,6,3,1,-1,1,9,0,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,7,6,0,7,0,11,3,0,6,11,-1,-1,-1,-1,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,0,3,6,7,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,1,0,6,7,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,1,8,1,3,8,6,7,11,-1,-1,-1,-1,-1,-1,-1,2,1,10,7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,2,1,8,0,3,7,11,6,-1,-1,-1,-1,-1,-1,-1,0,9,2,9,10,2,7,11,6,-1,-1,-1,-1,-1,-1,-1,7,11,6,3,10,2,3,8,10,8,9,10,-1,-1,-1,-1,3,2,7,7,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,0,7,0,6,7,0,2,6,-1,-1,-1,-1,-1,-1,-1,6,7,2,7,3,2,9,1,0,-1,-1,-1,-1,-1,-1,-1,2,6,1,6,8,1,8,9,1,6,7,8,-1,-1,-1,-1,6,7,10,7,1,10,7,3,1,-1,-1,-1,-1,-1,-1,-1,6,7,10,10,7,1,7,8,1,8,0,1,-1,-1,-1,-1,7,3,0,10,7,0,9,10,0,7,10,6,-1,-1,-1,-1,10,6,7,8,10,7,9,10,8,-1,-1,-1,-1,-1,-1,-1,4,8,6,6,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,6,3,6,0,3,6,4,0,-1,-1,-1,-1,-1,-1,-1,11,6,8,6,4,8,1,0,9,-1,-1,-1,-1,-1,-1,-1,6,4,9,3,6,9,1,3,9,6,3,11,-1,-1,-1,-1,4,8,6,8,11,6,1,10,2,-1,-1,-1,-1,-1,-1,-1,10,2,1,11,0,3,11,6,0,6,4,0,-1,-1,-1,-1,8,11,4,11,6,4,9,2,0,9,10,2,-1,-1,-1,-1,3,9,10,2,3,10,3,4,9,6,3,11,3,6,4,-1,3,2,8,2,4,8,2,6,4,-1,-1,-1,-1,-1,-1,-1,2,4,0,2,6,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,4,3,2,6,4,2,8,3,4,-1,-1,-1,-1,4,9,1,2,4,1,6,4,2,-1,-1,-1,-1,-1,-1,-1,3,1,8,1,6,8,6,4,8,1,10,6,-1,-1,-1,-1,0,1,10,6,0,10,4,0,6,-1,-1,-1,-1,-1,-1,-1,3,6,4,8,3,4,3,10,6,9,3,0,3,9,10,-1,4,9,10,4,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,9,4,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,0,5,9,4,6,7,11,-1,-1,-1,-1,-1,-1,-1,1,0,5,0,4,5,11,6,7,-1,-1,-1,-1,-1,-1,-1,6,7,11,4,3,8,4,5,3,5,1,3,-1,-1,-1,-1,4,5,9,2,1,10,11,6,7,-1,-1,-1,-1,-1,-1,-1,7,11,6,10,2,1,3,8,0,5,9,4,-1,-1,-1,-1,11,6,7,10,4,5,10,2,4,2,0,4,-1,-1,-1,-1,8,4,3,4,5,3,5,2,3,2,5,10,6,7,11,-1,3,2,7,2,6,7,9,4,5,-1,-1,-1,-1,-1,-1,-1,4,5,9,6,8,0,2,6,0,7,8,6,-1,-1,-1,-1,2,6,3,6,7,3,0,5,1,0,4,5,-1,-1,-1,-1,8,2,6,7,8,6,8,1,2,5,8,4,8,5,1,-1,4,5,9,6,1,10,6,7,1,7,3,1,-1,-1,-1,-1,10,6,1,6,7,1,7,0,1,0,7,8,4,5,9,-1,10,0,4,5,10,4,10,3,0,7,10,6,10,7,3,-1,10,6,7,8,10,7,10,4,5,10,8,4,-1,-1,-1,-1,5,9,6,9,11,6,9,8,11,-1,-1,-1,-1,-1,-1,-1,11,6,3,3,6,0,6,5,0,5,9,0,-1,-1,-1,-1,8,11,0,11,5,0,5,1,0,11,6,5,-1,-1,-1,-1,3,11,6,5,3,6,1,3,5,-1,-1,-1,-1,-1,-1,-1,10,2,1,11,5,9,8,11,9,6,5,11,-1,-1,-1,-1,3,11,0,11,6,0,6,9,0,9,6,5,10,2,1,-1,5,8,11,6,5,11,5,0,8,2,5,10,5,2,0,-1,3,11,6,5,3,6,3,10,2,3,5,10,-1,-1,-1,-1,9,8,5,8,2,5,2,6,5,2,8,3,-1,-1,-1,-1,6,5,9,0,6,9,2,6,0,-1,-1,-1,-1,-1,-1,-1,8,5,1,0,8,1,8,6,5,2,8,3,8,2,6,-1,6,5,1,6,1,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,6,3,1,10,6,1,6,8,3,9,6,5,6,9,8,-1,0,1,10,6,0,10,0,5,9,0,6,5,-1,-1,-1,-1,8,3,0,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,6,5,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,11,11,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,11,5,7,11,0,3,8,-1,-1,-1,-1,-1,-1,-1,7,11,5,11,10,5,0,9,1,-1,-1,-1,-1,-1,-1,-1,5,7,10,7,11,10,1,8,9,1,3,8,-1,-1,-1,-1,2,1,11,1,7,11,1,5,7,-1,-1,-1,-1,-1,-1,-1,3,8,0,7,2,1,5,7,1,11,2,7,-1,-1,-1,-1,5,7,9,7,2,9,2,0,9,7,11,2,-1,-1,-1,-1,2,5,7,11,2,7,2,9,5,8,2,3,2,8,9,-1,10,5,2,5,3,2,5,7,3,-1,-1,-1,-1,-1,-1,-1,0,2,8,2,5,8,5,7,8,5,2,10,-1,-1,-1,-1,1,0,9,3,10,5,7,3,5,2,10,3,-1,-1,-1,-1,2,8,9,1,2,9,2,7,8,5,2,10,2,5,7,-1,5,3,1,5,7,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,0,1,7,0,5,7,1,-1,-1,-1,-1,-1,-1,-1,3,0,9,5,3,9,7,3,5,-1,-1,-1,-1,-1,-1,-1,7,8,9,7,9,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,8,5,8,10,5,8,11,10,-1,-1,-1,-1,-1,-1,-1,4,0,5,0,11,5,11,10,5,0,3,11,-1,-1,-1,-1,9,1,0,10,4,8,11,10,8,5,4,10,-1,-1,-1,-1,4,11,10,5,4,10,4,3,11,1,4,9,4,1,3,-1,1,5,2,5,8,2,8,11,2,8,5,4,-1,-1,-1,-1,11,4,0,3,11,0,11,5,4,1,11,2,11,1,5,-1,5,2,0,9,5,0,5,11,2,8,5,4,5,8,11,-1,5,4,9,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,2,2,5,3,5,4,3,4,8,3,-1,-1,-1,-1,2,10,5,4,2,5,0,2,4,-1,-1,-1,-1,-1,-1,-1,2,10,3,10,5,3,5,8,3,8,5,4,9,1,0,-1,2,10,5,4,2,5,2,9,1,2,4,9,-1,-1,-1,-1,5,4,8,3,5,8,1,5,3,-1,-1,-1,-1,-1,-1,-1,5,4,0,5,0,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,4,8,3,5,8,5,0,9,5,3,0,-1,-1,-1,-1,5,4,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,11,4,11,9,4,11,10,9,-1,-1,-1,-1,-1,-1,-1,3,8,0,7,9,4,7,11,9,11,10,9,-1,-1,-1,-1,11,10,1,4,11,1,0,4,1,11,4,7,-1,-1,-1,-1,4,1,3,8,4,3,4,10,1,11,4,7,4,11,10,-1,7,11,4,4,11,9,11,2,9,2,1,9,-1,-1,-1,-1,4,7,9,7,11,9,11,1,9,1,11,2,3,8,0,-1,4,7,11,2,4,11,0,4,2,-1,-1,-1,-1,-1,-1,-1,4,7,11,2,4,11,4,3,8,4,2,3,-1,-1,-1,-1,10,9,2,9,7,2,7,3,2,9,4,7,-1,-1,-1,-1,7,10,9,4,7,9,7,2,10,0,7,8,7,0,2,-1,10,7,3,2,10,3,10,4,7,0,10,1,10,0,4,-1,2,10,1,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,4,7,1,4,3,1,7,-1,-1,-1,-1,-1,-1,-1,1,9,4,7,1,4,1,8,0,1,7,8,-1,-1,-1,-1,3,0,4,3,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,10,9,8,11,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,0,3,11,9,3,10,9,11,-1,-1,-1,-1,-1,-1,-1,10,1,0,8,10,0,11,10,8,-1,-1,-1,-1,-1,-1,-1,10,1,3,10,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,2,1,9,11,1,8,11,9,-1,-1,-1,-1,-1,-1,-1,9,0,3,11,9,3,9,2,1,9,11,2,-1,-1,-1,-1,11,2,0,11,0,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,2,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,10,8,2,9,8,10,-1,-1,-1,-1,-1,-1,-1,2,10,9,2,9,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,10,8,2,8,1,0,8,10,1,-1,-1,-1,-1,2,10,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,1,8,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]),numTrisTable:new Float32Array([0,1,1,2,1,2,2,3,1,2,2,3,2,3,3,2,1,2,2,3,2,3,3,4,2,3,3,4,3,4,4,3,1,2,2,3,2,3,3,4,2,3,3,4,3,4,4,3,2,3,3,2,3,4,4,3,3,4,4,3,4,5,5,2,1,2,2,3,2,3,3,4,2,3,3,4,3,4,4,3,2,3,3,4,3,4,4,5,3,4,4,5,4,5,5,4,2,3,3,4,3,4,2,3,3,4,4,5,4,5,3,2,3,4,4,3,4,5,3,2,4,5,5,4,5,2,4,1,1,2,2,3,2,3,3,4,2,3,3,4,3,4,4,3,2,3,3,4,3,4,4,5,3,2,4,3,4,3,5,2,2,3,3,4,3,4,4,5,3,4,4,5,4,5,5,4,3,4,4,3,4,5,5,4,4,3,5,2,5,4,2,1,2,3,3,4,3,4,4,5,3,4,4,5,2,3,3,2,3,4,4,5,4,5,5,2,4,3,5,4,3,2,4,1,3,4,4,5,4,5,3,4,4,5,5,2,3,4,2,1,2,3,3,2,3,4,2,1,3,2,4,1,2,1,1,0])}}var c2=new Cf,LFe=class{constructor(){this.pyramidPassScene=new co,this.pyramidPassMaterial=new l2({name:"PyramidPass"}),this.pyramidPassUniforms={inputTexture:{value:void 0},inputWidth:{value:0},inputHeight:{value:0},inputShiftX:{value:0},outputShiftX:{value:0}},this.pyramidTopLevelReadPixelBuffer=new Float32Array(4);let e=`
			precision highp float;
			precision highp sampler2D;
			layout(location = 0) out vec4 pc_FragColor;
			uniform sampler2D inputTexture;
			uniform float inputWidth;
			uniform float inputHeight;
			uniform float inputShiftX;
			uniform float outputShiftX;
			const vec2 half_unit_coord = vec2(0.5);
			const vec4 one = vec4(1.0);
			void main() {
				vec2 inputSize = vec2(inputWidth, inputHeight);
				vec2 input_pixel_uv = 1. / inputSize;
				vec2 coord = gl_FragCoord.xy - half_unit_coord;
				coord.x -= outputShiftX;
				coord = coord * 2. + half_unit_coord;
				coord.x += inputShiftX;

				// sample bottom left corner
				vec2 input_uv = coord / inputSize;
				float bl = texture(inputTexture, input_uv).r;

				// sample bottom right corner
				input_uv.x += input_pixel_uv.x;
				float br = texture(inputTexture, input_uv).r;

				// sample top right corner
				input_uv.y += input_pixel_uv.y;
				float tr = texture(inputTexture, input_uv).r;

				// sample top left corner
				input_uv.x -= input_pixel_uv.x;
				float tl = texture(inputTexture, input_uv).r;

				pc_FragColor.a = bl;
				pc_FragColor.b = pc_FragColor.a + br;
				pc_FragColor.g = pc_FragColor.b + tr;
				pc_FragColor.r = pc_FragColor.g + tl; 
			}
		`;this.pyramidPassMaterial.fragmentShader=e,this.pyramidPassMaterial.uniforms=this.pyramidPassUniforms,this.pyramidPassMaterial.depthTest=!1,this.pyramidPassMaterial.depthWrite=!1;let t=new yr(kx,this.pyramidPassMaterial);t.frustumCulled=!1,this.pyramidPassScene.add(t)}renderPyramid(e,t,i,r,n){new hN().min.setScalar(0);let s=t.length-1,a=new ai;i.getViewport(a),this.pyramidPassUniforms.inputShiftX.value=0,this.pyramidPassUniforms.outputShiftX.value=0;let o=s-1;for(let c=o;c>=0;c--){let u=c%2===o%2?n[0]:n[1],h=c===o?r:c%2===o%2?n[1]:n[0];this.pyramidPassUniforms.inputTexture.value=Array.isArray(h.texture)?h.texture[1]:h.texture,this.pyramidPassUniforms.inputWidth.value=h.width,this.pyramidPassUniforms.inputHeight.value=h.height,i.setRenderTarget(u);let d=t[c],f=i.getPixelRatio();i.setViewport(this.pyramidPassUniforms.outputShiftX.value/f,0,d/f,d/f),c===2&&e%2!==0&&i.setViewport(this.pyramidPassUniforms.outputShiftX.value/f,0,3/f,3/f),i.render(this.pyramidPassScene,c2);let p=this.pyramidPassUniforms.inputShiftX.value;this.pyramidPassUniforms.inputShiftX.value=this.pyramidPassUniforms.outputShiftX.value,this.pyramidPassUniforms.outputShiftX.value=p,c<o&&(this.pyramidPassUniforms.outputShiftX.value+=t[c+1])}i.setViewport(a);let l=t.length%2===0?0:1;return i.readRenderTargetPixelsAsync(n[l],n[l].width-1,0,1,1,this.pyramidTopLevelReadPixelBuffer).then(()=>this.pyramidTopLevelReadPixelBuffer[0])}},Il=24,Es=96,Cc=IFe(),Pu=2,Aie=class extends Rn{constructor(e,t,i){super(e,t,i),this.data=t,this.needsRebuild=!0,this.customDepthMaterialNeedsUpdate=!1,this._npart=-1,this.spatialn=1,this.drawRangeNeedsForceUpdate=!0,this._resolutionLevel=-1,this.resolution=64,this.spatialDivisions=25,this.zLayersPerRow=8,this.basePyramidSize=512,this.pyramidTexture1Width=341,this.pyramidTexture1Height=256,this.pyramidTexture2Width=170,this.pyramidTexture2Height=128,this.numLevels=9,this.pyramidLevelSizes=[1,2,4,8,16,32,64,128,256,512],this.bboxSize=0,this.bboxOffset=0,this.shapesDataTexture={value:void 0},this.spatialscene=new co,this.potentialPassScene=new co,this.voxelPassScene=new co,this._spatialPassRenderTargets=[],this._potentialPassRenderTargets=[],this._voxelPassRenderTargets=[],this._pyramidRenderTargets=[],this.geometry=new Nt,this.geometry.drawRange.count=0,this.spatialPassUniforms={span:{value:-1},shapesDataTexture:this.shapesDataTexture,npart:{value:this.npart},spatialn:{value:this.spatialn}},this.spatialMesh=new yr(kx,this.spatialPassMaterial()),this.spatialMesh.frustumCulled=!1,this.spatialscene.add(this.spatialMesh);let r=new Da(Cc.triTable,16,256,KE,or);r.needsUpdate=!0;let n=new Da(Cc.numTrisTable,256,1,KE,or);n.needsUpdate=!0,this.voxelPassUniforms={potentialPassTexture:{value:void 0},numTrisTable:{value:n}},this.voxelMesh=new yr(kx,this.voxelPassMaterial()),this.voxelMesh.frustumCulled=!1,this.voxelPassScene.add(this.voxelMesh),this.potentialPassUniforms={shapesDataTexture:this.shapesDataTexture,spatialPassTexture:{value:void 0},npart:{value:this.npart},spatialn:{value:this.spatialn}},this.potentialMesh=new yr(kx,this.potentialPassMaterial()),this.potentialMesh.frustumCulled=!1,this.potentialPassScene.add(this.potentialMesh),this.marchPassUniforms={triTable:{value:r},potentialPassTexture:{value:void 0},voxelPassTexture:{value:void 0},pyramidTexture1:{value:void 0},pyramidTexture1Size:{value:void 0},pyramidTexture2:{value:void 0},pyramidTexture2Size:{value:void 0}},this.frustumCulled=!1,this.onBeforeShadowPass=s=>{if(UFe.call(this),this.npart===0){this.geometry.drawRange.count=0;return}let a=this.material.root;if(!a.shadersPatchedForShapeBlend)this.patchVertexShaderForShapeBlend(a),a.shadersPatchedForShapeBlend=!0,this.customDepthMaterialNeedsUpdate=!0;else if(this.customDepthMaterialNeedsUpdate){this.customDepthMaterialNeedsUpdate=!1,this.customDepthMaterial=new ki({vertexShader:a.vertexShader,fragmentShader:`
						#include <packing>
						void main()
						{
							gl_FragColor = packDepthToRGBA(gl_FragCoord.z);
						}
					`,uniforms:a.uniforms,defines:this.material.defines}),this.isMeshDepthMaterial=!0,this.customDistanceMaterial=new ki({vertexShader:a.vertexShader,fragmentShader:`
					#include <common>
					#include <packing>
					uniform vec3 referencePosition;
					uniform float nearDistance;
					uniform float farDistance;
					// World-space position
					varying vec3 vWPosition;
					void main()
					{
						float dist = length(vWPosition - referencePosition);
						dist = (dist - nearDistance) / (farDistance - nearDistance);
						dist = saturate(dist);
						// Required by Three.js for this to work
						gl_FragColor = packDepthToRGBA( dist );
					}`,uniforms:{nearDistance:{value:0},farDistance:{value:0},referencePosition:{value:new N},opacity:{value:0},...a.uniforms},defines:this.material.defines});let c=this.customDistanceMaterial;c.referencePosition=new N,c.nearDistance=0,c.farDistance=0,c.opacity=1,c.isMeshDistanceMaterial=!0}if(this.spatialPassUniforms.npart.value=this.npart,this.spatialPassUniforms.spatialn.value=this.spatialn,this.potentialPassUniforms.npart.value=this.npart,this.potentialPassUniforms.spatialn.value=this.spatialn,this.needsRebuild){this.needsRebuild=!1,this.spatialMesh.material.defines.RES=this.resolutionLevel,this.spatialMesh.material.needsUpdate=!0,this.potentialMesh.material.defines.RES=this.resolutionLevel,this.potentialPassUniforms.spatialPassTexture.value=this.spatialPassRenderTarget.texture,this.potentialMesh.material.needsUpdate=!0,this.voxelMesh.material.defines.RES=this.resolutionLevel,this.voxelMesh.material.needsUpdate=!0,this.voxelPassUniforms.potentialPassTexture.value=this.potentialPassRenderTarget.texture,this.marchPassUniforms.potentialPassTexture.value=this.potentialPassRenderTarget.texture,this.marchPassUniforms.voxelPassTexture.value=this.voxelPassRenderTarget.texture[0],this.material.defines.RES=this.resolutionLevel,this.material.defines.LEVELS=this.pyramidLevelSizes.length,this.material.defines.LOOP=this.pyramidLevelSizes.length%2===0?this.pyramidLevelSizes.length-3:this.pyramidLevelSizes.length-2,this.material.defines.HALF=this.pyramidLevelSizes.length%2===0?1:0,this.material.needsUpdate=!0;let c=this.pyramidLevelSizes.length%2===0?0:1,u=this.pyramidLevelSizes.length%2===0?1:0;this.marchPassUniforms.pyramidTexture2.value=this.pyramidRenderTarget[c].texture,this.marchPassUniforms.pyramidTexture2Size.value=new Me(this.pyramidRenderTarget[c].width,this.pyramidRenderTarget[c].height),this.marchPassUniforms.pyramidTexture1.value=this.pyramidRenderTarget[u].texture,this.marchPassUniforms.pyramidTexture1Size.value=new Me(this.pyramidRenderTarget[u].width,this.pyramidRenderTarget[u].height),Object.assign(this.material.uniforms,this.marchPassUniforms)}let o=s.shadowMap.enabled;s.shadowMap.enabled=!1;let l=s.getRenderTarget();s.setRenderTarget(this.spatialPassRenderTarget),s.render(this.spatialscene,c2),s.setRenderTarget(this.potentialPassRenderTarget),s.render(this.potentialPassScene,c2),s.setRenderTarget(this.voxelPassRenderTarget),s.render(this.voxelPassScene,c2),Aie.streamCompaction.renderPyramid(this.resolutionLevel,this.pyramidLevelSizes,s,this.voxelPassRenderTarget,this.pyramidRenderTarget).then(c=>{this.material.wireframe&&(c*3>this.geometry.attributes.position.count||this.drawRangeNeedsForceUpdate)&&(this.geometry.dispose(),this.geometry=new Nt,this.geometry.userData.parameters={width:this.bboxSize,height:this.bboxSize,depth:this.bboxSize,centerOffset:[this.bboxOffset,this.bboxOffset,this.bboxOffset]},this.geometry.attributes.position=new Qt(new Float32Array(c*3*2),3)),(c*3>this.geometry.drawRange.count||this.drawRangeNeedsForceUpdate)&&(this.geometry.drawRange.count=Math.floor(c*1.2)*3),this.drawRangeNeedsForceUpdate=!1}),s.shadowMap.enabled=o,s.setRenderTarget(l)}}set npart(e){e!==this._npart&&(this.drawRangeNeedsForceUpdate=!0,this._npart=e,this.spatialn=Math.ceil(e/(4*Il)))}get npart(){return this._npart}set resolutionLevel(e){let t=Math.min(8,Math.max(5,e));if(t!==this._resolutionLevel){switch(this._resolutionLevel=t,this.resolution=Math.pow(2,t),this.resolutionLevel){case 5:this.pyramidLevelSizes=[1,2,4,6,12,24,48,96,192],this.bboxSize=31*8*Pu,this.bboxOffset=8*Pu*-1/2;break;case 6:this.pyramidLevelSizes=[1,2,4,8,16,32,64,128,256,512],this.bboxSize=63*4*Pu,this.bboxOffset=4*Pu*-1/2;break;case 7:this.pyramidLevelSizes=[1,2,4,6,12,24,48,96,192,384,768,1536],this.bboxSize=127*2*Pu,this.bboxOffset=2*Pu*-1/2;break;case 8:this.pyramidLevelSizes=[1,2,4,8,16,32,64,128,256,512,1024,2048,4096],this.bboxSize=255*Pu,this.bboxOffset=Pu*-1/2;break}this.pyramidTexture1Width=0,this.pyramidTexture2Width=0,this.pyramidTexture1Height=this.pyramidLevelSizes[this.pyramidLevelSizes.length-2],this.pyramidTexture2Height=this.pyramidLevelSizes[this.pyramidLevelSizes.length-3];for(let i=this.pyramidLevelSizes.length-2;i>=0;i--)(this.pyramidLevelSizes.length-2)%2===i%2?this.pyramidTexture1Width+=this.pyramidLevelSizes[i]:this.pyramidTexture2Width+=this.pyramidLevelSizes[i];this.basePyramidSize=this.pyramidLevelSizes[this.pyramidLevelSizes.length-1],this.zLayersPerRow=this.basePyramidSize/this.resolution,this.numLevels=this.pyramidLevelSizes.length-1,this.geometry.userData.parameters={width:this.bboxSize,height:this.bboxSize,depth:this.bboxSize,centerOffset:[this.bboxOffset,this.bboxOffset,this.bboxOffset]},this.needsRebuild=!0}}get resolutionLevel(){return this._resolutionLevel}get spatialPassRenderTarget(){let e=this._spatialPassRenderTargets[this.resolutionLevel];return e||(e=new Ni(this.spatialDivisions*this.spatialn,this.spatialDivisions**2,{format:Lr,type:or,stencilBuffer:!1,depthBuffer:!1,generateMipmaps:!1,minFilter:Ci,magFilter:Ci}),this._spatialPassRenderTargets[this.resolutionLevel]=e),e}get potentialPassRenderTarget(){let e=this._potentialPassRenderTargets[this.resolutionLevel];return e||(e=new Ni(this.basePyramidSize,this.basePyramidSize,{format:Lr,type:or,stencilBuffer:!1,depthBuffer:!1,generateMipmaps:!1,minFilter:Ci,magFilter:Ci}),this._potentialPassRenderTargets[this.resolutionLevel]=e),e}get voxelPassRenderTarget(){let e=this._voxelPassRenderTargets[this.resolutionLevel];return e||(e=new UJ(this.basePyramidSize,this.basePyramidSize,2,{stencilBuffer:!1,depthBuffer:!1,generateMipmaps:!1,minFilter:Ci,magFilter:Ci}),e.texture[0].format=Lr,e.texture[0].type=or,e.texture[1].format=KE,e.texture[1].type=or,this._voxelPassRenderTargets[this.resolutionLevel]=e),e}get pyramidRenderTarget(){let e=this._pyramidRenderTargets[this.resolutionLevel];if(!e){let t=new Ni(this.pyramidTexture1Width,this.pyramidTexture1Height,{format:Lr,type:or,stencilBuffer:!1,depthBuffer:!1,magFilter:Ci,minFilter:Ci}),i=new Ni(this.pyramidTexture2Width,this.pyramidTexture2Height,{format:Lr,type:or,stencilBuffer:!1,depthBuffer:!1,magFilter:Ci,minFilter:Ci});e=[t,i],this._pyramidRenderTargets[this.resolutionLevel]=e}return e}updateState(e,t){let i=this.material;super.updateState(e,t),i!==this.material&&(this.needsRebuild=!0),e.geometry&&(this.resolutionLevel=e.geometry.resolutionLevel,this.geometry.userData.parameters={width:this.bboxSize,height:this.bboxSize,depth:this.bboxSize,centerOffset:[this.bboxOffset,this.bboxOffset,this.bboxOffset]}),e.wireframe&&!this.geometry.getAttribute("position")?this.geometry.setAttribute("position",new Qt(new Float32Array(this.geometry.drawRange.count*3),3)):!e.wireframe&&this.geometry.getAttribute("position")&&this.geometry.deleteAttribute("position")}spatialPassMaterial(){let e=`
			precision highp float;
			out vec4 pc_FragColor;
			const float spatialDivisions = ${this.spatialDivisions}.;
			uniform float span;
			uniform float npart;
			uniform float spatialn;
			${Cc.shapeInput()}

			vec3 low, high;     // range of current div; subset of -1 .. 1 with span border

			// lookup one element/channel's worth of spheres for current division
			// stating with low sphere number lowi
			// gives a key to which spheres from lowi..lowi+23 are active within given div (low..high)
			float spatialKey(float lowi) {
				float t = 0.;
				for (float ii = ${Il-1}.; ii >= 0.; ii--) {
					float i = ii + lowi;
					float iin = (i + 0.5) / ${Es}.;
					vec4 shape = shapePos(iin);
					vec3 d = shape.xyz;
					float op = shape.w;
	
					t *= 2.;
					t += (
						low.x < d.x && d.x < high.x &&
						low.y < d.y && d.y < high.y &&
						low.z < d.z && d.z < high.z &&
						i < npart || op == -2. // always include if op is -2, which is the intersection operation
					) ? 1. : 0.;
				}
				return t;
			}

			${Cc.getpart}

			void main() {               // spatialial fragment shader
				// find active div
				vec3 div;                               // which div is current
				// out holds x=> x, lowi faster moving and y=> z, y faster moving
				float yz = float(gl_FragCoord.y - 0.5);     // contains  z, y faster moving
				div.y = getpart(yz, spatialDivisions);
				div.z = yz; // getpart(yz, spatialDivisions.z); // what's left, should be the same as getpart

				float lx = float(gl_FragCoord.x - 0.5);     // contains x, lowi faster moving
				float lowi = getpart(lx, spatialn) * ${4*Il}.;
				div.x = lx;

				low = div / spatialDivisions * 2. - 1. - span;
				high = (div+1.) / spatialDivisions * 2. - 1. + span;

				// find active range of spheres
				pc_FragColor.x = spatialKey(lowi);
				pc_FragColor.y = spatialKey(lowi+${Il}.);
				pc_FragColor.z = spatialKey(lowi+${2*Il}.);
				pc_FragColor.w = spatialKey(lowi+${3*Il}.);
			}
		`;return new l2({name:"Spatial Pass",fragmentShader:e,uniforms:this.spatialPassUniforms})}potentialPassMaterial(){let e=`
			precision highp float;
			out vec4 pc_FragColor;

			${Cc.shapeInput()}
			uniform sampler2D spatialPassTexture;

			const float res = float(RES);
			const float VOXEL_RESOLUTION = pow(2., res);
			const float Z_LAYERS_PER_ROW = ceil(pow(2., res / 2.));
			const float VOXEL_RESOLUTION_SUB1 = VOXEL_RESOLUTION - 1.;
			const float INV_VOXEL_RESOLUTION = 1.0 / VOXEL_RESOLUTION;

			uniform float npart;
			uniform float spatialn;
			const float spatialDivisions = ${this.spatialDivisions}.;
			const float spatialDivisions2 = spatialDivisions * spatialDivisions;
			const float spatialDivisionsSub1 = spatialDivisions - 1.;

			${Cc.getpart}

			vec3 packRGBAToVec3(vec4 color) {
				uint r = uint(color.r * 255.);
				uint g = uint(color.g * 255.);
				uint combined = (r << 8) | g; 
				return vec3(float(combined) * 0.00001525902, color.b, color.a); // 1/65535
			}

			void applyQuaternionToVector(in vec4 q, inout vec3 v) {
				v += 2.0 * cross(q.xyz, cross(q.xyz, v) + q.w * v);
			}

			/**
			 * SDF functions (reference: https://iquilezles.org/articles/distfunctions/)
			 */

			// branchless version of "Smooth Union, Subtraction and Intersection - bound, bound, bound" in above reference
			float smoothOperation(float op, float sdf, float d, float k) {
			  //        union: op =  1 => signSubtract =  1, signIntersection =  1
			  //     subtract: op = -1 => signSubtract = -1, signIntersection =  1
				// intersection: op = -2 => signSubtract = -1, signIntersection = -1

				float signSubtract = clamp(op, -1., 1.);
				float signIntersection = 2. * (op - signSubtract) + 1.;
				float h = clamp(
					0.5 + signSubtract * 0.5 * (sdf - signSubtract * signIntersection * d) / k,
					0.0,
					1.0
				);
				return mix(sdf, signSubtract * signIntersection * d, h) - 
							 signSubtract * k * h * (1.0 - h);
			}

			float sdSphere( vec3 p, float s )
			{
				return length(p)-s;
			}

			float sdEllipsoid( vec3 p, vec3 r )
			{
				float k0 = length(p/r);
				float k1 = length(p/(r*r));
				return k0*(k0-1.0)/k1;
			}

			float sdBox( vec3 p, vec3 b )
			{
				vec3 q = abs(p) - b;
				return length(max(q,0.0)) + min(max(q.x,max(q.y,q.z)),0.0);
			}

			float sdTorus( vec3 p, vec2 t )
			{
				vec2 q = vec2(length(p.xy)-t.x,p.z);
				return length(q)-t.y;
			}

			float sdCappedTorus( vec3 p, vec2 sc, float ra, float rb)
			{
				p.x = abs(p.x);
				float k = (sc.y*p.x>sc.x*p.y) ? dot(p.xy,sc) : length(p.xy);
				return sqrt( dot(p,p) + ra*ra - 2.0*ra*k ) - rb;
			}

			float dot2( in vec2 v ) { return dot(v,v); }
			float sdCappedCone( vec3 p, float h, float r1, float r2 )
			{
				vec2 q = vec2( length(p.xz), p.y );
				vec2 k1 = vec2(r2,h);
				vec2 k2 = vec2(r2-r1,2.0*h);
				vec2 ca = vec2(q.x-min(q.x,(q.y<0.0)?r1:r2), abs(q.y)-h);
				vec2 cb = q - k1 + k2*clamp( dot(k1-q,k2)/dot2(k2), 0.0, 1.0 );
				float s = (cb.x<0.0 && ca.y<0.0) ? -1.0 : 1.0;
				return s*sqrt( min(dot2(ca),dot2(cb)) );
			}

			float sdCappedCylinder( vec3 p, float h, float r )
			{
				vec2 d = abs(vec2(length(p.xz),p.y)) - vec2(r,h);
				return min(max(d.x,d.y),0.0) + length(max(d,0.0));
			}

			float maxBlend = 0.0;
			// compute potential from A (=24) spheres, using the bit flags in 'activeKey'
			// to avoid lookup/compute for inactive spheres
			// return field potential, side effect updates track,
			// compute and return +ve and -ve values separately
			void fillSpatialInner(
				float ii,
				float activeKey,
				vec3 corner,
				inout float sdf,
				inout float colorDivisor,
				inout vec4 trackColor
			) {
				for (float i = 0.; i < ${Il}.; i++) {
					if (activeKey < 1.) break; // activeKey exhausted, no more active spheres
					activeKey *= 0.5;
					if (fract(activeKey) < 0.5) continue;

					float iin = (i + ii + 0.5) * ${1/Es};
					vec4 shape = shapePos(iin);
					vec4 quat = shapeQuat(iin);
					vec4 params1 = shapeParams1(iin);
					vec4 params2 = shapeParams2(iin);

					vec3 p = corner - shape.xyz;
					applyQuaternionToVector(quat, p);
					p /= params2.z; // scale
					float d; // d in -1..1 coordinates
					switch (int(params1.x)) {
						case 0: d = sdSphere(p, params1.y); break;
						case 1: d = sdEllipsoid(p, params1.yzw); break;
						case 2: d = sdBox(p, params1.yzw); break;
						case 3: d = sdCappedCylinder(p, params1.y, params1.z); break;
						case 4: d = sdCappedCone(p, params1.y, params1.z, params1.w); break;
						case 5: d = sdTorus(p, params1.yz); break;
						case 6: d = sdCappedTorus(p, params1.yz, params1.w, params2.w); break;
					}
					d -= params2.y; // rounded edge
					d *= params2.z; // scale

					float k = params2.x;
					float op = shape.w;

					sdf = smoothOperation(shape.w, sdf, d, k);

					float isNegativeOne = step(-1.5, op) * step(op, -0.5); // 1 when op == -1, 0 otherwise
					float colorCull = smoothstep(maxBlend, 0., -d);
					float cullFactor = mix(1.0, colorCull, isNegativeOne);
					trackColor *= cullFactor;
					colorDivisor *= cullFactor;

					maxBlend = max(maxBlend, k);

					k += 2. * INV_VOXEL_RESOLUTION; // avoid division by zero, and other color artifacts with very small k
					float nearness = smoothstep(k, 0., d);

					vec4 color = shapeColor(iin);
					nearness *= float(color.a >= 0.);

					colorDivisor += nearness;
					trackColor += color * nearness;
				}
			}

			vec3 div;
			// compute potential from all spheres; collect +ve and =ve values separately
			// work in blocks of A*4 (=96) spheres, using the bit flags in 4 float channel 'activeKey' values
			// TODO check if extra vec3 output useful, not really used at present
			float fillSpatial(vec3 corner, inout vec4 trackColor) {
				float sdf = 1e3; // hack: initialize to large value
				float colorDivisor = 0.;
				// spatialPassTexture holds x=> lowi, x faster moving and y=> z, y faster moving
				float divyz = (div.y + div.z * spatialDivisions + 0.5) / (spatialDivisions2);
				for (float ii = 0.; ii < spatialn; ii++) {
					float i = ii * ${4*Il}.;

					vec4 activeKey = texture(spatialPassTexture, vec2((div.x * spatialn + ii + 0.5)/(spatialn * spatialDivisions), divyz));
					fillSpatialInner(i, activeKey.x, corner, sdf, colorDivisor, trackColor);
					fillSpatialInner(i+${Il}., activeKey.y, corner, sdf, colorDivisor, trackColor);
					fillSpatialInner(i+${2*Il}., activeKey.z, corner, sdf, colorDivisor, trackColor);
					fillSpatialInner(i+${3*Il}., activeKey.w, corner, sdf, colorDivisor, trackColor);
				}

				trackColor /= colorDivisor;
				return mix(sdf, 0.0, step(1e20 - 0.1, sdf));
			}

			void main() {
				${Cc.getxyzi}    // get xi yi zi from 2d position

				vec3 xyzi = vec3(xi,yi,zi);
				vec3 corner = xyzi / VOXEL_RESOLUTION_SUB1 * 2. - 1.;  // -1..1 coords

				div = floor(xyzi / VOXEL_RESOLUTION_SUB1 * spatialDivisionsSub1);

				vec4 c = vec4(0.);
				float t = fillSpatial(corner, c);

				pc_FragColor = vec4(t, packRGBAToVec3(c)); // RGB texture
			}
		`;return new l2({name:"PotentialPass",fragmentShader:e,uniforms:this.potentialPassUniforms})}voxelPassMaterial(){let e=`
			precision highp float;
			layout(location = 0) out vec4 pc_FragColor;
			layout(location = 1) out vec4 numTris;

			const float res = float(RES);
			const float VOXEL_RESOLUTION = pow(2., res);
			const float VOXEL_RESOLUTION_SUB1 = VOXEL_RESOLUTION - 1.; 
			const float Z_LAYERS_PER_ROW = ceil(pow(2., res / 2.));
			const float INV_VOXEL_RESOLUTION = 1.0 / VOXEL_RESOLUTION;
			uniform sampler2D numTrisTable; // 256 x 1

			float keyi(float f000, float f100, float f010, float f110, float f001, float f101, float f011, float f111) {
				return (float(f000 < 0.) * 1.) +
							 (float(f100 < 0.) * 2.) +
							 (float(f010 < 0.) * 8.) +
							 (float(f110 < 0.) * 4.) +
							 (float(f001 < 0.) * 16.) +
							 (float(f101 < 0.) * 32.) +
							 (float(f011 < 0.) * 128.) +
							 (float(f111 < 0.) * 64.);
			}

			${Cc.lookup}

			vec3 compNormi(float xi, float yi, float zi) {
				float dx = look(xi + 1., yi, zi, potentialPassTexture).r - look(xi - 1., yi, zi, potentialPassTexture).r;
				float dy = look(xi, yi + 1., zi, potentialPassTexture).r - look(xi, yi - 1., zi, potentialPassTexture).r;
				float dz = look(xi, yi, zi + 1., potentialPassTexture).r - look(xi, yi, zi - 1., potentialPassTexture).r;
				// if we allow (common) 0,0,0 case through then NaN can spread
				// eg r = vec4(compNorm i(???), 1.) will pollute r.w
				if (dx == 0.0 && dy == 0.0 && dz == 0.0) {
					return vec3(0.199, 0.299, 0.399);
				}
				return normalize(vec3(dx, dy, dz));
			}

			void main() {
				${Cc.getxyzi}    // get xi yi zi from 2d

				vec3 normal = compNormi(xi, yi, zi);  // even if our key is -1 this may be needed by a neighbouring voxel

				if (xi >= VOXEL_RESOLUTION_SUB1 || yi >= VOXEL_RESOLUTION_SUB1 || zi >= VOXEL_RESOLUTION_SUB1) {
					pc_FragColor = vec4(normal, 0.);
					numTris = vec4(0.);
					return;
				}

				float
					f000 = look(xi, yi, zi, potentialPassTexture).r,
					f100 = look(xi+1., yi, zi, potentialPassTexture).r,
					f010 = look(xi, yi+1., zi, potentialPassTexture).r,
					f110 = look(xi+1., yi+1., zi, potentialPassTexture).r,
					f001 = look(xi, yi, zi+1., potentialPassTexture).r,
					f101 = look(xi+1., yi, zi+1., potentialPassTexture).r,
					f011 = look(xi, yi+1., zi+1., potentialPassTexture).r,
					f111 = look(xi+1., yi+1., zi+1., potentialPassTexture).r;
				float key = keyi(f000, f100, f010, f110, f001, f101, f011, f111);

				pc_FragColor = vec4(normal, key);

				numTris = texture(numTrisTable, vec2((key + 0.5) / 256., 0.5));
			}
		`;return new l2({name:"VoxelPass",fragmentShader:e,uniforms:this.voxelPassUniforms})}patchVertexShaderForShapeBlend(e){let t=`
		#ifdef SHAPEBLEND 
			precision highp sampler2D;

			uniform float isol;

			uniform sampler2D triTable;     // 256 x 16
			uniform sampler2D pyramidTexture1;
			uniform vec2 pyramidTexture1Size;
			uniform sampler2D pyramidTexture2;
			uniform vec2 pyramidTexture2Size;

			const vec2 halfPixelOffset = vec2(0.5, 0.5);

			const vec2 rShift = vec2(0., 1.);
			const vec2 gShift = vec2(1., 1.);
			const vec2 bShift = vec2(1., 0.);

			const float res = float(RES);
			const float VOXEL_RESOLUTION = pow(2., res);
			const float Z_LAYERS_PER_ROW = ceil(pow(2., res / 2.));
			const float INV_VOXEL_RESOLUTION = 1.0 / VOXEL_RESOLUTION;

			const float scale_factor = ${Pu}.;

			#if SHAPEBLEND == 5
				const float levelShiftX[7] = float[7](4., 6., 12., 24., 48., 96., 192.);
				const float scale = 8. * scale_factor;
				const vec3 originOffset = vec3(16.);
			#elif SHAPEBLEND == 7
				const float levelShiftX[10] = float[10](4., 6., 12., 24., 48., 96., 192., 384., 768., 1536.); 
				const float scale = 2. * scale_factor;
				const vec3 originOffset = vec3(64.);
			#elif SHAPEBLEND == 8
				const float levelShiftX[11] = float[11](4., 8., 16., 32., 64., 128., 256., 512., 1024., 2048., 4096.);
				const float scale = scale_factor;
				const vec3 originOffset = vec3(128.);
			#else
				const float levelShiftX[8] = float[8](4., 8., 16., 32., 64., 128., 256., 512.);
				const float scale = 4. * scale_factor;
				const vec3 originOffset = vec3(32.);
			#endif

			${Cc.lookup}

			const vec3 offsets[24] = vec3[](
				vec3(0., 0., 0.), vec3(1., 0., 0.),
				vec3(1., 0., 0.), vec3(1., 1., 0.),
				vec3(0., 1., 0.), vec3(1., 1., 0.),
				vec3(0., 0., 0.), vec3(0., 1., 0.),
				vec3(0., 0., 1.), vec3(1., 0., 1.),
				vec3(1., 0., 1.), vec3(1., 1., 1.),
				vec3(0., 1., 1.), vec3(1., 1., 1.),
				vec3(0., 0., 1.), vec3(0., 1., 1.),
				vec3(0., 0., 0.), vec3(0., 0., 1.),
				vec3(1., 0., 0.), vec3(1., 0., 1.),
				vec3(1., 1., 0.), vec3(1., 1., 1.),
				vec3(0., 1., 0.), vec3(0., 1., 1.)
			);

			vec2 computeShiftedPosition1(vec2 xy, float levelOriginX) {
				vec2 xyShifted = xy;
				xyShifted.x += levelOriginX;
				return (xyShifted + halfPixelOffset) / pyramidTexture1Size;
			}

			vec2 computeShiftedPosition2(vec2 xy, float levelOriginX) {
				vec2 xyShifted = xy;
				xyShifted.x += levelOriginX;
				return (xyShifted + halfPixelOffset) / pyramidTexture2Size;
			}

			vec4 unpackVec3ToRGBA(vec3 vec) {
				uint combined = uint(vec.x * 65535.0 + 0.5); // Add 0.5 for rounding
				float g = float(combined & uint(0xFF)) * 0.00392156862; // 1/255
				float r = float((combined >> 8) & uint(0xFF)) * 0.00392156862; 
		
				return vec4(r, g, vec.y, vec.z);
			}

			out vec4 marchColor;
			// end of marchvertPre
		#endif
		`,i=`
		#ifdef SHAPEBLEND
			float triIndex = floor(float(gl_VertexID/3));
			float vertexIndex = float(gl_VertexID);
			
			// Initial pyramid lookup
			float levelOriginX1 = pyramidTexture1Size.x - 2.;
			float levelOriginX2 = pyramidTexture2Size.x - 1.;
			vec2 xy = vec2(0.);
			vec4 lookUp = texture(pyramidTexture2, computeShiftedPosition2(xy, levelOriginX2));
			
			// Early exit check
			if (triIndex >= lookUp.r) return;
			
			// Optimize loop variables
			float start = 0.;
			vec4 triIndexVec = vec4(triIndex);
			
			// Main position computation loop
			for (int i = 0; i < LOOP;) {
				// Compute boundaries
				vec4 ends = lookUp + vec4(start);
				vec4 starts = vec4(ends.gba, start);
				vec4 check = vec4(greaterThanEqual(triIndexVec, starts)) * 
											vec4(lessThan(triIndexVec, ends));
				
				// Update position
				xy *= 2.;
				xy += check.r * rShift + check.g * gShift + check.b * bShift;
				
				// Update loop variables
				start = dot(check, starts);
				levelOriginX2 -= levelShiftX[i];
				
				// Update lookup
				lookUp = texture(pyramidTexture1, computeShiftedPosition1(xy, levelOriginX1));
				i++;

				ends = lookUp + vec4(start);
				starts = vec4(ends.gba, start);
				check = vec4(greaterThanEqual(triIndexVec, starts)) * 
											vec4(lessThan(triIndexVec, ends));
				
				// Update position
				xy *= 2.;
				xy += check.r * rShift + check.g * gShift + check.b * bShift;
				
				// Update loop variables
				start = dot(check, starts);
				levelOriginX1 -= levelShiftX[i];
				
				// Update lookup
				lookUp = texture(pyramidTexture2, computeShiftedPosition2(xy, levelOriginX2));

				i++;
			}

			#if HALF == 1
				vec4 ends = lookUp + vec4(start);
				vec4 starts = vec4(ends.gba, start);
				vec4 check = vec4(greaterThanEqual(triIndexVec, starts)) * vec4(lessThan(triIndexVec, ends));
			
				// Update position
				xy *= 2.;
				xy += check.r * rShift + check.g * gShift + check.b * bShift;
			
				// Update loop variables
				start = dot(check, starts);
			#endif
			
			// Compute final coordinates
			vec3 gridPos;
			gridPos.x = mod(xy.x, VOXEL_RESOLUTION);
			gridPos.y = mod(xy.y, VOXEL_RESOLUTION);
			gridPos.z = floor(xy.x * INV_VOXEL_RESOLUTION) + 
									floor(xy.y * INV_VOXEL_RESOLUTION) * Z_LAYERS_PER_ROW;
			
			// Vertex key computation
			vertexIndex -= start * 3.;
			float vk = vertexIndex * 0.0625 + 0.03125; // Optimized division by 16 and addition of 1/32
			
			// Voxel lookup and edge computation
			vec4 voxel = look(gridPos.x, gridPos.y, gridPos.z, voxelPassTexture);
			float key = (voxel.w + 0.5) * 0.00390625; // Optimized division by 256
			
			// Edge lookup and offset computation
			float edgeNum = texture(triTable, vec2(vk, key)).x;
			int edgeIndex = int(edgeNum) * 2;
			
			// Compute edge positions
			vec3 p1 = gridPos + offsets[edgeIndex];
			vec3 p2 = gridPos + offsets[edgeIndex + 1];
			
			// Compute potentials and normals
			vec4 potential1 = look(p1.x, p1.y, p1.z, potentialPassTexture);
			vec4 potential2 = look(p2.x, p2.y, p2.z, potentialPassTexture);
			
			// Final position and normal computation
			float mu = potential1.r / (potential1.r - potential2.r);

			marchColor = mix(
				unpackVec3ToRGBA(potential1.gba),
				unpackVec3ToRGBA(potential2.gba),
				mu
			);

			transformed = p1 + (p2 - p1) * mu;
			transformed -= originOffset;
			transformed *= scale;
			vec4 data1 = look(p1.x, p1.y, p1.z, voxelPassTexture);
			vec4 data2 = look(p2.x, p2.y, p2.z, voxelPassTexture);
			objectNormal = normalize(mix(data1.xyz, data2.xyz, mu));
			transformedNormal = normalMatrix * objectNormal;
			#ifndef FLAT_SHADED
				vNormal = transformedNormal;
			#endif
		#endif
		`;e.vertexShader=t+e.vertexShader.replace("#include <project_vertex>",i+`
#include <project_vertex>`);let r=e.fragmentShader.match(/vec3 diffuseColor[^\n]*\n/);if(!r)return;let n=`
		#ifdef SHAPEBLEND_C
			#if SHAPEBLEND_C == 1
				${r[0].replace(/nodeU0,/g,"marchColor.rgb,").replace(/nodeU\d+(?=,g_uid\d+_calpha\))/g,"marchColor.a")}
			#else
				${r[0]}
			#endif
		#else
			${r[0]}
		#endif
		`;e.fragmentShader=`in vec4 marchColor;
`+e.fragmentShader.replace(r[0],n),Object.assign(e.uniforms,this.marchPassUniforms)}initDebugPass(e){console.log("fboToDebug.width",e.width,e.height),this.geometry=new au(e.width,e.height),this.geometry.userData={parameters:{width:4,height:4}};let t={inputTexture:{value:Array.isArray(e.texture)?e.texture[1]:e.texture},pyramidTextureSize:{value:void 0}},i=r=>{r.vertexShader=`
				precision highp float;

				varying vec2 vUv;

				void main() {
						gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
						vUv = uv;
				}
			`,r.fragmentShader=`
				layout(location = 1) out vec4 gVelocity;

				precision highp float;
				
				uniform sampler2D inputTexture;
				varying vec2 vUv;

				uniform vec2 pyramidTextureSize;

				void main() {
						// Sample the input texture using UV coordinates
						gl_FragColor = texture(inputTexture, vUv);
						gVelocity = vec4(0.0);
				}
			`,t.pyramidTextureSize.value=new Me(this.pyramidRenderTarget.width,this.pyramidRenderTarget.height),Object.assign(r.uniforms,t)};this.material.shapeBlendhack=i,this.material.root.shapeBlendhack=i}},Dm=Aie;Dm.streamCompaction=new LFe;var OFe=new ft,zFe=new ft,Gg=new ri,cd=new N,PM=new N,BFe=new ri;function FFe(e,t=0){let i=this.children.length;for(;i--;){let r=this.children[i];Tm.is(r)&&Tie.call(r,e,t+1)}}function Tie(e,t=0){if(e(this,t)!==!0){let i=this.children.length;for(;i--;){let r=this.children[i];Tm.is(r)&&Tie.call(r,e,t+1)}}}function UFe(){if(this.shapesDataTexture.value===void 0){let a=new Da(new Float32Array(4*Es*Up),Es,Up,Lr,or);this.shapesDataTexture.value=a}let e=this.shapesDataTexture.value,t=e.image.data;e.needsUpdate=!0;let i=0,r=this.data.geometry.blendRange,n=OFe.copy(this.matrixWorld).invert(),s=0;FFe.call(this,a=>{var g;if(a.visible===!1)return!0;let o;if(a instanceof fl||a instanceof Ux||a instanceof Nx)return;a instanceof Os?o=a.object:o=a;let l=(g=a.data)==null?void 0:g.cloner;if(Fi.is(a)&&l&&!l.hideBase&&l.type!=="radial"&&l.disabled!==!0||!(o instanceof Rn))return;let c=o.geometry.userData.parameters,u=c.shapeBlendNode;if(u===void 0)return;if(zFe.multiplyMatrices(n,a.matrixWorld).decompose(PM,Gg,cd),c.type==="TorusGeometry"&&c.arc!==360){let y=c.arc*Math.PI/180;y=y/4,Gg.multiply(BFe.set(0,0,Math.sin(y),Math.cos(y)))}let h=u.overrideGlobalBlend?u.blendRange:r;h=h/this.bboxSize*2,t[s*4]=(PM.x-this.bboxOffset)/this.bboxSize*2,t[s*4+1]=(PM.y-this.bboxOffset)/this.bboxSize*2,t[s*4+2]=(PM.z-this.bboxOffset)/this.bboxSize*2,t[s*4+3]=u.operation===0?1:u.operation===2?-1:-2,t[Es*4+s*4]=-Gg.x,t[Es*4+s*4+1]=-Gg.y,t[Es*4+s*4+2]=-Gg.z,t[Es*4+s*4+3]=Gg.w;let d=new Float32Array(4),f=0;if(c.type==="SphereGeometry")c.width===c.height&&c.width===c.depth?d[0]=0:d[0]=1,d[1]=c.width/this.bboxSize,d[2]=c.height/this.bboxSize,d[3]=c.depth/this.bboxSize,i=Math.max(i,d[1]*cd.x+h,d[2]*cd.x+h,d[3]*cd.x+h);else if(c.type==="CubeGeometry"){f=c.cornerRadius;let y=c.width,x=c.height,_=c.depth;d[0]=2,d[1]=(y-2*f)/this.bboxSize,d[2]=(x-2*f)/this.bboxSize,d[3]=(_-2*f)/this.bboxSize,i=Math.max(i,Math.sqrt(y**2+x**2+_**2)/this.bboxSize*cd.x+h)}else if(c.type==="CylinderGeometry"){f=c.cornerRadius;let y=c.height,x=c.radiusBottom,_=c.radiusTop;if(_>=x){let M=Math.atan2(_-x,y),S=(Math.PI/2-M)/2;_-=f/Math.tan(S),x-=f*Math.tan(S)}else if(x>_){let M=Math.atan2(x-_,y),S=(Math.PI/2-M)/2;_-=f*Math.tan(S),x-=f/Math.tan(S)}d[1]=(c.height-2*f)/this.bboxSize,x===_?(d[0]=3,d[2]=x/this.bboxSize*2):(d[0]=4,d[2]=x/this.bboxSize*2,d[3]=_/this.bboxSize*2),i=Math.max(i,d[1]*4*cd.x+h)}else if(c.type==="TorusGeometry"){if(d[0]=5,d[1]=(c.width-c.depth)/this.bboxSize,d[2]=c.depth/this.bboxSize,c.arc!==360){d[0]=6,d[3]=d[1],t[Es*12+s*4+3]=d[2];let y=2*Math.atan2(d[2]/2,d[1]),x=c.arc*Math.PI/180/2-y;d[1]=Math.sin(x),d[2]=Math.cos(x)}i=Math.max(i,c.width*cd.x/this.bboxSize+h)}t.set(d,Es*8+s*4),t[Es*12+s*4]=h,t[Es*12+s*4+1]=f/this.bboxSize*2,t[Es*12+s*4+2]=cd.x;let p=o.material,v=p.uniforms.nodeU0.node.value,m=p.uniforms.nodeU1.value;u.operation!==0&&!u.useColor&&(m=-1),t[Es*16+s*4]=v.r,t[Es*16+s*4+1]=v.g,t[Es*16+s*4+2]=v.b,t[Es*16+s*4+3]=m,m<1&&this.material.defines.SHAPEBLEND_C===1&&(this.material.transparent=!0),s++}),this.npart=s,this.spatialPassUniforms.span.value=i*1.4}var Cie=512;function H9(e,t){let i=!1,r=e.layers.mask&Cie,n=t.getLayersOfType("transmission"),s=t.getLayersOfType("outline");return s.length>0&&(e.layers.set(8),n.length>0&&e.layers.enable(3),i=!0,n4(e),r4(e)),n.length===0&&s.length===0&&e.layers.set(0),r&&e.layers.set(9),e instanceof xy&&e.needsAO&&e.layers.enable(5),i}function j9(e,t){if(!t.layers)return!1;let i=e.layers.mask&Cie,r=!1,n=t.getLayersOfType("transmission").filter(a=>a.data.visible),s=t.getLayersOfType("outline").filter(a=>a.data.visible);return n.length>0&&(e.layers.set(3),s.length>0&&e.layers.enable(8),r=!0),n.length===0&&s.length===0&&e.layers.set(0),i&&e.layers.set(9),e.needsAO&&e.layers.enable(5),r}function NFe(e){let t=!1;return e.traverseEntity(i=>{if(i instanceof xy)if(Array.isArray(i.material))for(let r=0;r<i.material.length;r++)H9(i,i.material[r])&&(t=!0);else H9(i,i.material)&&(t=!0)}),t}function kFe(e){let t=!1;return e.traverseEntity(i=>{if(i instanceof xy)if(Array.isArray(i.material))for(let r=0;r<i.material.length;r++)j9(i,i.material[r])&&(t=!0);else j9(i,i.material)&&(t=!0)}),t}var VFe=new p$,GFe=new ft,HFe=new sy;function PB(e,t,i,r=!1){let n=e.cloner;if(n)for(let s of n.children){let a=GFe.copy(s.matrixWorld).invert(),o=HFe.copy(t.ray).applyMatrix4(a),l=e.matrixWorld;o.applyMatrix4(l);let c=VFe;c.set(o.origin,o.direction),c.near=t.near,c.far=t.far;let u=c.intersectObject(e,!1);u.length>0&&i.push({...u[0],object:r?s:e})}}var jFe=class{constructor(){this._constraints=new Map}setConstraint(e,t){t===null?this._constraints.delete(e):this._constraints.set(e,t)}removeDependencies(e){this._constraints.delete(e)}applyConstraints(e){let t=new Set;this._constraints.forEach((i,r)=>{let n=[r,i],s=i;for(;this._constraints.has(s);){if(s=this._constraints.get(s),n.includes(s)){console.warn(`circular dependency detected: ${n.join(" -> ")}`);break}t.has(s)||n.push(s)}for(let a=n.length-2;a>=0;a--)if(!t.has(n[a])){let o=e.find(n[a]);o?o.applyPathSnapping(e):console.warn(`missing entity ${n[a]}`),t.add(n[a])}})}findDependency(e,t){let i=e;for(;this._constraints.has(i);)if(i=this._constraints.get(i),i===t)return!0;return!1}},WFe="AGFzbQEAAAAADwhkeWxpbmsuMAEEAAAAAAETA2AAAGAIf39/f39/f38AYAABfwISAQNlbnYGbWVtb3J5AgMAgIAEAwQDAAECBzkDEV9fd2FzbV9jYWxsX2N0b3JzAAALc29ydEluZGV4ZXMAARNlbXNjcmlwdGVuX3Rsc19pbml0AAIK3gMDAwABC9IDAwF/BnwBfgJAIAdFDQAgAysDUCEMIAMrAzAhDSADKwMQIQ5BACEDRP///////+9/IQtEAAAAAAAAEAAhCgNAIAIgA0ECdGoCfyAOIAEgA0EMbGoiCCoCALuiIA0gCCoCBLuioCAMIAgqAgi7oqBEAAAAAAAAsECiIgmZRAAAAAAAAOBBYwRAIAmqDAELQYCAgIB4CzYCACAJIAsgCSALYxshCyAJIAogCSAKZBshCiADQQFqIgMgB0cNAAsgB0UNACAGuCAKIAuhoyEJQQAhAwNAAn8gCSACIANBAnRqIgEoAgC3IAuhoiIKmUQAAAAAAADgQWMEQCAKqgwBC0GAgICAeAshCCABIAg2AgAgBCAIQQJ0aiIBIAEoAgBBAWo2AgAgA0EBaiIDIAdHDQALCyAGQQJPBEAgBCgCACEIQQEhAwNAIAQgA0ECdGoiASABKAIAIAhqIgg2AgAgA0EBaiIDIAZHDQALCyAHQQFrIgGtIQ8DQCAEIAIgD6dBAnQiA2ooAgBBAnRqIgcgBygCAEEBayIHNgIAIAUgASAHa0ECdGogACADaigCADYCACAPUCEDIA9CAX0hDyADRQ0ACyAGBEAgBEEAIAZBAnT8CwALCwQAQQAL",Wd=class{};rx(Wd,"DepthMapRange",65536),rx(Wd,"MemoryPageSize",65536),rx(Wd,"BytesPerFloat",4),rx(Wd,"BytesPerInt",4);function XFe(e){let t,i,r,n,s,a,o,l,c,u,h,d,f,p,v,m;function g(D){let R=new Float64Array(u,a,16);for(let O=0;O<16;O++)R[O]=D[O];let L;if(r>1){t.exports.sortIndexes(n,s,c,a,o,l,d.DepthMapRange,r);let O=new Uint32Array(r);L=O.buffer,O.set(new Uint32Array(u,l,r))}else if(r===1){let O=new Uint32Array(r);O[0]=new Uint32Array(u,n,i)[0],L=O.buffer}else L=new ArrayBuffer(0);e.postMessage({sortDone:!0,indexesBuffer:L},[L])}function y(D,R,L){let O=new Float32Array(u,s,i*3);r=0;let H=new Uint32Array(u,n,i);for(let j=0;j<L.length-1;j++){let Y=R[j],z=D[j].elements,V=Y.filter(k=>k.enabled&&k.mode==="Include").map(k=>k.type==="Box"?S(k):C(k)),U=Y.filter(k=>k.enabled&&k.mode==="Exclude").map(k=>k.type==="Box"?S(k):C(k));for(let k=L[j];k<L[j+1];k++){let X=f[k*3],re=f[k*3+1],q=f[k*3+2];if((V.length===0||_(X,re,q,V))&&(U.length===0||!_(X,re,q,U))){let ee=1/(z[3]*X+z[7]*re+z[11]*q+z[15]);O[r*3]=(z[0]*X+z[4]*re+z[8]*q+z[12])*ee,O[r*3+1]=(z[1]*X+z[5]*re+z[9]*q+z[13])*ee,O[r*3+2]=(z[2]*X+z[6]*re+z[10]*q+z[14])*ee,H[r]=k,r++}}}}function x(D,R){let L=[],O=R.filter(Y=>Y.enabled&&Y.mode==="Include").map(Y=>Y.type==="Box"?S(Y):C(Y)),H=R.filter(Y=>Y.enabled&&Y.mode==="Exclude").map(Y=>Y.type==="Box"?S(Y):C(Y)),j=D.length;for(let Y=0;Y<j;Y+=3){let z=D[Y],V=D[Y+1],U=D[Y+2];(O.length===0||_(z,V,U,O))&&(H.length===0||!_(z,V,U,H))||L.push(Y/3)}return L}function _(D,R,L,O,H){return O.some(j=>{let Y=M(D,R,L,j.invRotationMatrix,j.cropCenter);return Array.isArray(j)?E(Y.x,Y.y,Y.z,j):A(Y.x,Y.y,Y.z,j)})}function M(D,R,L,O,H){let j=D-H[0],Y=R-H[1],z=L-H[2],V=1/(O[3]*j+O[7]*Y+O[11]*z+O[15]);return{x:(O[0]*j+O[4]*Y+O[8]*z+O[12])*V+H[0],y:(O[1]*j+O[5]*Y+O[9]*z+O[13])*V+H[1],z:(O[2]*j+O[6]*Y+O[10]*z+O[14])*V+H[2]}}function S(D){let R=D.cropSize[0]/2,L=D.cropSize[1]/2,O=D.cropSize[2]/2,H=[D.cropCenter[0]-R,D.cropCenter[1]-L,D.cropCenter[2]-O,D.cropCenter[0]+R,D.cropCenter[1]+L,D.cropCenter[2]+O],j=T(D.cropRotation);return Object.assign(H,{invRotationMatrix:j,cropCenter:D.cropCenter})}function T(D){let R=[],L=D[0]*Math.PI/180,O=D[1]*Math.PI/180,H=D[2]*Math.PI/180,j=Math.cos(L),Y=Math.sin(L),z=Math.cos(O),V=Math.sin(O),U=Math.cos(H),k=Math.sin(H),X=j*U,re=j*k,q=Y*U,ee=Y*k;return R[0]=z*U,R[1]=-z*k,R[2]=V,R[4]=re+q*V,R[5]=X-ee*V,R[6]=-Y*z,R[8]=ee-X*V,R[9]=q+re*V,R[10]=j*z,R[12]=0,R[13]=0,R[14]=0,R[3]=0,R[7]=0,R[11]=0,R[15]=1,R}function E(D,R,L,O){return D>=O[0]&&D<=O[3]&&R>=O[1]&&R<=O[4]&&L>=O[2]&&L<=O[5]}function C(D){let R=2/D.cropSize[0],L=2/D.cropSize[1],O=2/D.cropSize[2],H=T(D.cropRotation);return{invRadiusX:R,invRadiusY:L,invRadiusZ:O,cropCenter:D.cropCenter,invRotationMatrix:H}}function A(D,R,L,O){let H=(D-O.cropCenter[0])*O.invRadiusX,j=(R-O.cropCenter[1])*O.invRadiusY,Y=(L-O.cropCenter[2])*O.invRadiusZ;return H*H+j*j+Y*Y<=1}e.onmessage=D=>{if(D.data.getCroppedIndexes){let R=new Uint32Array(x(new Float32Array(D.data.positions),D.data.crops)).buffer;e.postMessage({outOfBoundsIndexes:R},[R])}else if(D.data.positions)h=D.data.positions,f=new Float32Array(h),v=D.data.meshMatrixWorlds,m=D.data.cropsArray,p=D.data.meshIndexIntervals,y(v,m,p),e.postMessage({sortSetupComplete:!0});else if(D.data.sort||D.data.newMatrixWorlds||D.data.newCropsArray)(D.data.newMatrixWorlds||D.data.newCropsArray)&&(m=D.data.newCropsArray||m,v=D.data.newMatrixWorlds||v,y(v,m,p)),g(D.data.sort.view,D.data.sort.cameraPosition);else if(D.data.init){d=D.data.init.Constants,i=D.data.init.splatCount;let R=d.BytesPerInt,L=d.BytesPerFloat*3,O=new Uint8Array(D.data.init.sorterWasmBytes),H=R+L,j=i*H,Y=i*d.BytesPerInt*2+d.DepthMapRange*d.BytesPerInt*2,z=d.MemoryPageSize*32,V=j+Y+z,U=Math.floor(V/d.MemoryPageSize)+1,k={module:{},env:{memory:new WebAssembly.Memory({initial:U*2,maximum:U*3,shared:!0})}};WebAssembly.compile(O).then(X=>WebAssembly.instantiate(X,k)).then(X=>{t=X,n=0,s=i*R,a=s+i*L,c=a+16*d.BytesPerFloat*2,o=c+i*d.BytesPerInt,l=o+d.DepthMapRange*d.BytesPerInt,u=k.env.memory.buffer,e.postMessage({sortSetupPhase1Complete:!0})})}}}function qFe(e){let t=new Worker(URL.createObjectURL(new Blob(["(",XFe.toString(),")(self)"],{type:"application/javascript"}))),i=atob(WFe),r=new Uint8Array(i.length);for(let n=0;n<i.length;n++)r[n]=i.charCodeAt(n);return t.postMessage({init:{sorterWasmBytes:r.buffer,splatCount:e,Constants:{BytesPerFloat:Wd.BytesPerFloat,BytesPerInt:Wd.BytesPerInt,DepthMapRange:Wd.DepthMapRange,MemoryPageSize:Wd.MemoryPageSize}}}),t}var JR=function(){let e=new Float32Array(1),t=new Int32Array(e.buffer);return function(i){return e[0]=i,t[0]}}(),YFe=function(e,t,i,r){return e+(t<<8)+(i<<16)+(r<<24)},DM=new Me;function W9(e){let t=!1;return e.scene.objects.traverse((i,r)=>{if(r.visible===!1)return!0;r.type==="Splat"&&(t=!0)}),t}var u2=class extends yr{constructor(e,t,i,r,n=!1,s=1,a,o){super(i,r),this.splatCount=t,this.meshIndexIntervals=a,this.meshMatrixWorlds=o,this.splatBuffers=e,this.geometry=i,this.material=r,this.splatDataTextures=null,this.halfPrecisionCovariancesOnGPU=n,this.devicePixelRatio=s,this.resetLocalSplatDataAndTexturesFromSplatBuffer()}static buildMesh(e,t,i=!1,r=1,n,s){let a=u2.buildGeomtery(t),o=u2.buildMaterial(n);return new u2(e,t,a,o,i,r,n,s)}static buildMaterial(e){let t=`
            precision highp float;
            #include <common>

            attribute uint splatIndex;

            uniform highp sampler2D covariancesTexture;
            uniform highp usampler2D centersColorsTexture;
            uniform vec2 focal;
            uniform vec2 viewport;
            uniform vec2 basisViewport;
            uniform vec2 covariancesTextureSize;
            uniform vec2 centersColorsTextureSize;
						uniform highp sampler2D meshMatrixWorldsTexture;
						uniform uint meshIndexIntervals[257];
						uniform float orthoZoom;

            varying vec4 vColor;
            varying vec2 vUv;

            varying vec2 vPosition;

            const vec4 encodeNorm4 = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0);
            const uvec4 mask4 = uvec4(uint(0x000000FF), uint(0x0000FF00), uint(0x00FF0000), uint(0xFF000000));
            const uvec4 shift4 = uvec4(0, 8, 16, 24);
            vec4 uintToRGBAVec (uint u) {
               uvec4 urgba = mask4 & u;
               urgba = urgba >> shift4;
               vec4 rgba = vec4(urgba) * encodeNorm4;
               return rgba;
            }

            vec2 getDataUV(in int stride, in int offset, in vec2 dimensions) {
                vec2 samplerUV = vec2(0.0, 0.0);
                float d = float(splatIndex * uint(stride) + uint(offset)) / dimensions.x;
                samplerUV.y = float(floor(d)) / dimensions.y;
                samplerUV.x = fract(d);
                return samplerUV;
            }

            void main () {
                uvec4 sampledCenterColor = texture(centersColorsTexture, getDataUV(1, 0, centersColorsTextureSize));
                vec3 splatCenter = uintBitsToFloat(uvec3(sampledCenterColor.gba));
                vColor = uintToRGBAVec(sampledCenterColor.r);

                vPosition = position.xy * 2.0;

								uint meshIndex;
								for (int i = 1; i < 257; i++) {
									if (splatIndex < meshIndexIntervals[i]) {
										meshIndex = uint(i - 1);
										break;
									}
								}

								float strideMulmeshIndex = float(4u*meshIndex);
								float meshMatrixWorldsTextureLength = float(256*4);

								mat4 modelMat = mat4(
									texture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+0.0)/meshMatrixWorldsTextureLength, 0)),
									texture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+1.0)/meshMatrixWorldsTextureLength, 0)),
									texture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+2.0)/meshMatrixWorldsTextureLength, 0)),
									texture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+3.0)/meshMatrixWorldsTextureLength, 0))
								);
								mat4 modelViewMat = viewMatrix * modelMat;
								vec4 viewCenter = modelViewMat * vec4(splatCenter, 1.0); 
                vec4 clipCenter = projectionMatrix * viewCenter;

                vec2 sampledCovarianceA = texture(covariancesTexture, getDataUV(3, 0, covariancesTextureSize)).rg;
                vec2 sampledCovarianceB = texture(covariancesTexture, getDataUV(3, 1, covariancesTextureSize)).rg;
                vec2 sampledCovarianceC = texture(covariancesTexture, getDataUV(3, 2, covariancesTextureSize)).rg;

                vec3 cov3D_M11_M12_M13 = vec3(sampledCovarianceA.rg, sampledCovarianceB.r);
                vec3 cov3D_M22_M23_M33 = vec3(sampledCovarianceB.g, sampledCovarianceC.rg);

                // Compute the 2D covariance matrix from the upper-right portion of the 3D covariance matrix
                mat3 Vrk = mat3(
                    cov3D_M11_M12_M13.x, cov3D_M11_M12_M13.y, cov3D_M11_M12_M13.z,
                    cov3D_M11_M12_M13.y, cov3D_M22_M23_M33.x, cov3D_M22_M23_M33.y,
                    cov3D_M11_M12_M13.z, cov3D_M22_M23_M33.y, cov3D_M22_M23_M33.z
                );
                float s = 1.0 / (viewCenter.z * viewCenter.z);

                mat3 W = transpose(mat3(modelViewMat));
                mat3 T = orthoZoom > 0.0 ? W : W * mat3(
									focal.x / viewCenter.z, 0., -(focal.x * viewCenter.x) * s,
									0., focal.y / viewCenter.z, -(focal.y * viewCenter.y) * s,
									0., 0., 0.
								);
                mat3 cov2Dm = transpose(T) * Vrk * T;
                cov2Dm[0][0] += 0.3;
                cov2Dm[1][1] += 0.3;

                // We are interested in the upper-left 2x2 portion of the projected 3D covariance matrix because
                // we only care about the X and Y values. We want the X-diagonal, cov2Dm[0][0],
                // the Y-diagonal, cov2Dm[1][1], and the correlation between the two cov2Dm[0][1]. We don't
                // need cov2Dm[1][0] because it is a symetric matrix.
                vec3 cov2Dv = vec3(cov2Dm[0][0], cov2Dm[0][1], cov2Dm[1][1]);

                vec3 ndcCenter = clipCenter.xyz / clipCenter.w;

                // We now need to solve for the eigen-values and eigen vectors of the 2D covariance matrix
                // so that we can determine the 2D basis for the splat. This is done using the method described
                // here: https://people.math.harvard.edu/~knill/teaching/math21b2004/exhibits/2dmatrices/index.html
                //
                // This is a different approach than in the original work at INRIA. In that work they compute the
                // max extents of the 2D covariance matrix in screen space to form an axis aligned bounding rectangle
                // which forms the geometry that is actually rasterized. They then use the inverse 2D covariance
                // matrix (called 'conic') to determine fragment opacity.
                float a = cov2Dv.x;
                float d = cov2Dv.z;
                float b = cov2Dv.y;
                float D = a * d - b * b;
                float trace = a + d;
                float traceOver2 = 0.5 * trace;
                float term2 = sqrt(trace * trace / 4.0 - D);
                float eigenValue1 = traceOver2 + term2;
								float eigenValue2 = max(traceOver2 - term2, 0.00); // prevent negative eigen value

                const float maxSplatSize = 1024.0;
                vec2 eigenVector1 = normalize(vec2(b, eigenValue1 - a));
                // since the eigen vectors are orthogonal, we derive the second one from the first
                vec2 eigenVector2 = vec2(eigenVector1.y, -eigenVector1.x);
                vec2 basisVector1 = eigenVector1 * min(sqrt(2.0 * eigenValue1), maxSplatSize);
                vec2 basisVector2 = eigenVector2 * min(sqrt(2.0 * eigenValue2), maxSplatSize);

                vec2 ndcOffset = vec2(vPosition.x * basisVector1 + vPosition.y * basisVector2) * basisViewport;

								if (orthoZoom > 0.0) {
									ndcOffset *= orthoZoom;
								}

                gl_Position = vec4(ndcCenter.xy + ndcOffset, ndcCenter.z, 1.0);
            }`,i=`
            precision highp float;
            #include <common>

            uniform vec3 debugColor;

            varying vec4 vColor;
            varying vec2 vUv;

            varying vec2 vPosition;
						layout(location = 1) out vec4 gVelocity; 

            void main () {
                // compute the negative squared distance from the center of the splat to the
                // current fragment in the splat's local space.
                float A = -dot(vPosition, vPosition);
                if (A < -4.0) discard;
                vec3 color = vColor.rgb;
                A = exp(A) * vColor.a;
                gl_FragColor = vec4(color.rgb, A);
								gVelocity = vec4(0.0); // so it is ignored by TAA
            }`,r={covariancesTexture:{type:"t",value:null},centersColorsTexture:{type:"t",value:null},meshIndexIntervals:{value:e},meshMatrixWorldsTexture:{type:"t",value:null},focal:{type:"v2",value:new Me},viewport:{type:"v2",value:new Me},basisViewport:{type:"v2",value:new Me},debugColor:{type:"v3",value:new Yt},covariancesTextureSize:{type:"v2",value:new Me(1024,1024)},centersColorsTextureSize:{type:"v2",value:new Me(1024,1024)},orthoZoom:{type:"f",value:-1}};return new ki({uniforms:r,vertexShader:t,fragmentShader:i,transparent:!0,alphaTest:1,blending:nm,depthTest:!0,depthWrite:!1,side:na})}static buildGeomtery(e){let t=new Nt;t.setIndex([0,1,2,0,2,3]);let i=new Float32Array(4*3),r=new Qt(i,3);t.setAttribute("position",r),r.setXYZ(0,-1,-1,0),r.setXYZ(1,-1,1,0),r.setXYZ(2,1,1,0),r.setXYZ(3,1,-1,0),r.needsUpdate=!0;let n=new d$().copy(t),s=new Uint32Array(e),a=new Dw(s,1,!1);return a.setUsage(_ge),n.setAttribute("splatIndex",a),n.instanceCount=e,n}resetLocalSplatDataAndTexturesFromSplatBuffer(){this.updateLocalSplatDataFromSplatBuffer(),this.allocateAndStoreLocalSplatDataInTextures()}updateLocalSplatDataFromSplatBuffer(){this.splatBuffers.forEach(r=>r.buildPreComputedBuffers()),this.covariances=new Float32Array(this.splatCount*6),this.colors=new Uint8Array(this.splatCount*4),this.centers=new Float32Array(this.splatCount*3);let e=0,t=0,i=0;for(let r of this.splatBuffers){let n=r.nsplats;this.colors.subarray(e,e+n*4).set(r.colorsA),e+=n*4,this.centers.subarray(t,t+n*3).set(r.decoded.xyz.denormDequant().data),t+=n*3,this.covariances.subarray(i,i+n*6).set(new Float32Array(r.precomputedCovarianceBufferData)),i+=n*6}}allocateAndStoreLocalSplatDataInTextures(){let e=this.splatCount,t=new Me(4096,1024);for(;t.x*t.y*2<e*6;)t.y*=2;let i=new Me(4096,1024);for(;i.x*i.y*4<e*4;)i.y*=2;let r,n;if(this.halfPrecisionCovariancesOnGPU){n=new Uint16Array(t.x*t.y*2);for(let u=0;u<this.covariances.length;u++)n[u]=$we.toHalfFloat(this.covariances[u]);r=new Da(n,t.x,t.y,rA,Th)}else n=new Float32Array(t.x*t.y*2),n.set(this.covariances),r=new Da(n,t.x,t.y,rA,or);r.needsUpdate=!0,this.material.uniforms.covariancesTexture.value=r,this.material.uniforms.covariancesTextureSize.value.copy(t);let s=new Uint32Array(i.x*i.y*4);for(let u=0;u<e;u++){let h=u*4,d=u*3,f=u*4;s[f]=YFe(this.colors[h],this.colors[h+1],this.colors[h+2],this.colors[h+3]),s[f+1]=JR(this.centers[d]),s[f+2]=JR(this.centers[d+1]),s[f+3]=JR(this.centers[d+2])}let a=new Da(s,i.x,i.y,CJ,ch);a.internalFormat="RGBA32UI",a.needsUpdate=!0,this.material.uniforms.centersColorsTexture.value=a,this.material.uniforms.centersColorsTextureSize.value.copy(i);let o=256*4,l=new Float32Array(256*16);for(let u=0;u<this.meshMatrixWorlds.length;u++)l.set(this.meshMatrixWorlds[u].elements,u*16);let c=new Da(l,o,1,Lr,or);c.needsUpdate=!0,this.material.uniforms.meshMatrixWorldsTexture.value=c,this.material.uniformsNeedUpdate=!0,this.splatDataTextures={covariances:{data:n,texture:r,size:t},centerColors:{data:s,texture:a,size:i},meshMatrixWorlds:{data:l,texture:c}}}updateIndexes(e){let t=this.geometry;t.attributes.splatIndex.set(e),t.attributes.splatIndex.needsUpdate=!0,t.instanceCount=e.length}updateUniforms(e,t,i,r){this.splatCount>0&&(DM.set(e.x*this.devicePixelRatio,e.y*this.devicePixelRatio),this.material.uniforms.viewport.value.copy(DM),this.material.uniforms.basisViewport.value.set(2/DM.x,2/DM.y),this.material.uniforms.focal.value.set(t,i),this.material.uniforms.orthoZoom.value=r,this.material.uniformsNeedUpdate=!0)}getSplatDataTextures(){return this.splatDataTextures}getSplatCount(){return this.splatCount}getCenters(){return this.centers}getColors(){return this.colors}getCovariances(){return this.covariances}dispose(){this.geometry.dispose(),this.material.dispose(),this.splatDataTextures&&(this.splatDataTextures.covariances.texture.dispose(),this.splatDataTextures.centerColors.texture.dispose(),this.splatDataTextures.meshMatrixWorlds.texture.dispose()),this.removeFromParent()}},Pie,QFe=new Promise(e=>{Pie=e}),X9=!1,RM;function ZFe(){if(X9)return;if(RM)return RM;async function e(){let t=await Af(()=>import("./gaussian-splat-compression-ro4O0smp.js"),[]);Pie(t),X9=!0}return RM=e(),RM}var Die;QFe.then(e=>Die=e);var KFe=class{constructor(e={}){rx(this,"updateView",function(){let t=new ft,i=[],r=new N(0,0,-1),n=new N(0,0,-1),s=new N,a=new N;return function(o=!1,l){let c=this.updateMatrixWorldsInWorkerIfNeeded(),u=this.cropsChanged();if(!o){n.set(0,0,-1).applyQuaternion(l.quaternion);let d=!1,f=!1;if(n.dot(r)<=.95&&(d=!0),a.copy(l.position).sub(s).length()>=1&&(f=!0),!d&&!f&&!c&&!u&&!this.needsInitialRender)return}this.needsInitialRender=!1,s.copy(l.position),r.copy(n),t.copy(l.matrixWorld).invert(),t.premultiply(this.dummyPerspectiveMatrix),i[0]=l.position.x,i[1]=l.position.y,i[2]=l.position.z;let h={sort:{view:t.elements,cameraPosition:i,splatRenderCount:this.splatRenderCount,splatSortCount:this.splatRenderCount},...c?{newMatrixWorlds:this.meshMatrixWorlds}:{},...u?{newCropsArray:this.cropsArray}:{}};this.sortRunning?this.queuedMessage=h:(this.queuedMessage=null,this.sortRunning=!0,this.sortWorker.postMessage(h))}}()),this.scene=e.scene,this.currentPage=null,this.devicePixelRatio=window.devicePixelRatio,this.sortWorker=null,this.splatRenderCount=0,this.splatSortCount=0,this.splatMesh=null,this.sortRunning=!1,this.meshMatrixWorlds=null,this.meshMatrixWorldsOld=null,this.cropsArray=null,this.splatEntries=null,this.queuedMessage=null,this.needsInitialRender=!0,this.dummyPerspectiveMatrix=new ft().makePerspective(-1,1,-1,1,.1,1e3)}updateSplatMeshUniforms(e,t){let i=new Me;this.splatMesh!==null&&this.splatMesh.getSplatCount()>0&&(e.getSize(i),this.cameraFocalLengthX=t.projectionMatrix.elements[0]*this.devicePixelRatio*i.x*.45,this.cameraFocalLengthY=t.projectionMatrix.elements[5]*this.devicePixelRatio*i.y*.45,this.splatMesh.updateUniforms(i,this.cameraFocalLengthX,this.cameraFocalLengthY,t.isPerspectiveCamera?-1:t.zoom*this.devicePixelRatio))}loadSplat(e={}){this.activePage=this.scene.activePage,e.position&&(e.position=new N().fromArray(e.position)),e.orientation&&(e.orientation=new ri().fromArray(e.orientation)),e.halfPrecisionCovariances=!!e.halfPrecisionCovariances;let t=[];if(this.splatEntries=t,this.activePage.traverseVisibleEntity(s=>{s.data.type==="Splat"&&t.push(s)}),this.splatMesh&&this.splatMesh.dispose(),t.length===0)return this.splatMesh=null,!1;this.meshMatrixWorlds=t.map(s=>s.matrixWorld),this.meshMatrixWorldsOld=t.map(s=>s.matrixWorld.clone()),this.cropsArray=t.map(s=>s.data.crops.map(a=>a.data));let i=t.map(s=>new Die.GSplineBuffer(new Uint8Array(s.data.buffer).buffer)),r=0,n=[0];for(let s of i)r+=s.getSplatCount(),n.push(r);return this.setupSplatMesh(i,r,e.position,e.orientation,e.halfPrecisionCovariances,this.devicePixelRatio,n,this.meshMatrixWorlds),this.setupSortWorker(r),!0}updateMatrixWorldsInWorkerIfNeeded(){let e=this.splatDataTextures.meshMatrixWorlds.data;for(let t=0;t<this.meshMatrixWorlds.length;t++)e.set(this.meshMatrixWorlds[t].elements,t*16);return this.splatDataTextures.meshMatrixWorlds.texture.needsUpdate=!0,this.meshMatrixWorlds.every((t,i)=>t.equals(this.meshMatrixWorldsOld[i]))?!1:(this.meshMatrixWorldsOld=this.meshMatrixWorlds.map(t=>t.clone()),!0)}cropsChanged(){let e=!1;return this.splatEntries.forEach((t,i)=>{var r;t.data.crops.forEach((n,s)=>{this.cropsArray[i][s]===void 0?(e=!0,this.cropsArray[i][s]=n.data):Object.entries(n.data).forEach(([a,o])=>{var l;Array.isArray(o)&&o.some((c,u)=>c!==this.cropsArray[i][s][a][u])?(e=!0,this.cropsArray[i][s][a]=o):o!==((l=this.cropsArray[i][s])==null?void 0:l[a])&&(e=!0,this.cropsArray[i][s][a]=o)})}),t.data.crops.length!==((r=this.cropsArray[i])==null?void 0:r.length)&&(this.cropsArray[i].length=t.data.crops.length,e=!0)}),e}setupSplatMesh(e,t,i=new N,r=new ri,n=!1,s=1,a,o){this.splatMesh=u2.buildMesh(e,t,n,s,a,o),this.splatMesh.position.copy(i),this.splatMesh.quaternion.copy(r),this.splatMesh.frustumCulled=!1,this.splatMesh.renderOrder=99999,this.splatRenderCount=t,this.splatMesh.onBeforeRender=(l,c,u)=>this.update(l,u)}setupSortWorker(e){this.sortWorker=qFe(e),this.sortWorker.onmessage=t=>{var i;t.data.sortDone?(this.sortRunning=!1,(i=this.splatMesh)==null||i.updateIndexes(new Uint32Array(t.data.indexesBuffer)),this.lastSortTime=t.data.sortTime,this.queuedMessage&&(this.sortWorker.postMessage(this.queuedMessage),this.queuedMessage=null)):t.data.sortCanceled?this.sortRunning=!1:t.data.sortSetupPhase1Complete?this.sortWorker.postMessage({positions:this.splatMesh.getCenters().buffer,meshMatrixWorlds:this.splatMesh.meshMatrixWorlds,meshIndexIntervals:this.splatMesh.meshIndexIntervals,cropsArray:this.cropsArray}):t.data.sortSetupComplete&&(this.splatDataTextures=this.splatMesh.getSplatDataTextures(),this.scene.activePage.add(this.splatMesh),this.needsInitialRender=!0)}}update(e,t){this.splatMesh!==null&&(this.updateSplatMeshUniforms(e,t),this.updateView(!1,t))}getSplatMesh(){return this.splatMesh}},DB=new Ch;DB.wireframe=!0;var q9=new N,g4=class extends co{constructor(e,t){super(),this.data=e,this.sharedAssets=t,this.enableHelpers=!1,this.wireframeState=!1,this.needsTransmissionDirty=!0,this.needsNormalDirty=!0,this._needsTransmission=!1,this._needsNormal=!1,this.geometryCacheChanged=!1,this.splatViewer=null,this.shapeBlendIntances=[],this.entityByUuid={},this.entityIdentityToEntity={},this.toExpandCloner=new Set,this.toUpdateCloner=new Set,this.pendingCommands=[],this.pathConstraints=new jFe,this.invisibleObjects=new v0("jflkdsafjasdifjaslk",{...Bz.defaultData,visible:!1,name:"buildin invisible"}),this.needsRecomputeInstances=!1,this.init(e,t),this.matrixAutoUpdate=!1,this.errorPage=new hs("fdasfa",{...H0.defaultData,name:""},{shared:t,scene:this})}markGeometryCacheDirty(){this.geometryCacheChanged=!0}markNeedsUpdateRendererDirty(){this.needsTransmissionDirty=!0,this.needsNormalDirty=!0}needsTransmission(){return this.needsTransmissionDirty&&(this._needsTransmission=kFe(this),this.needsTransmissionDirty=!1),this._needsTransmission}needsNormal(){return this.needsNormalDirty&&(this._needsNormal=NFe(this),this.needsNormalDirty=!1),this._needsNormal}registerInstanceAndSetUuid(e){let t=e.identity.join("-"),i=this.entityIdentityToEntity[t];i&&(e.uuid=i.uuid),this.entityIdentityToEntity[t]=e,this.entityByUuid[e.uuid]=e}markPenumbraSizeDirty(){for(let e of this.children)e instanceof hs&&(e.penumbraSizeArrayCache=null)}findInstance(e){return this.entityIdentityToEntity[e.join("-")]}get bgColor(){return this.activePage.bgColor}get postprocessing(){return this.activePage.data.postprocessing}getWithSortKey(e){let t=this.find(e);if(t===void 0)return;let i=[],r=t;for(;r!==this;){let n=r;r=r.parent;let s=r.children.indexOf(n);i.splice(0,0,s)}return{entity:t,sortKey:i}}getAllSorted(e){let t=[];for(let i of e){let r=this.getWithSortKey(i.id);r!==void 0&&t.push(r)}return t.sort((i,r)=>eee(i.sortKey,r.sortKey)),t.map(i=>i.entity)}nonExistOrDescendantOf(e,t){let i=this.find(e);if(i===void 0)return!0;for(;i;){if(i.uuid===t)return!0;i=i.parent}return!1}find(e){if(this.activePage&&this.activePage.personalCamera.parent){if(e==="f23858d0-4a3b-4bd8-8173-66ed0af7f6fb-personalCamera")return this.activePage.personalCamera;if(e===gy)return this.activePage.personalCamera}if(e===""||e===void 0)return;let t=this.entityByUuid[e];return t===void 0?this.getObjectByProperty("uuid",e):t}find2D(e){for(let t of this.children)if(t instanceof hs&&t.uiScene){let i=t.uiScene.find(e);if(i)return i}}findScene2DfromObject2D(e){for(let t of this.children)if(t instanceof hs&&t.uiScene&&t.uiScene.find(e))return t.uiScene}find2DInUIObjects(e){let t;return this.traverseEntity(i=>{t===void 0&&i instanceof ia&&(t=i.uiCanvas.find(e))}),t}traverse2D(e){for(let t of this.children)t instanceof hs&&t.uiScene&&t.uiScene.traverse(e)}debugEnsureEntity(e){let t=this.find(e);if(t){if(Array.isArray(t.identity)&&this.findInstance(t.identity)===void 0){console.error("not found instance");debugger}}else{console.error("not found");debugger}}addPendingExpandCloner(e){this.toExpandCloner.add(e)}addPendingUpdateCloner(e){this.toUpdateCloner.add(e)}markToExpandCloner(e){this.toExpandCloner.add(e),e.traverseEntityAncestors(t=>{this.toExpandCloner.add(t)})}doPendingExpandCloner(){this.toExpandCloner.forEach(e=>{e.expandCloner(this)}),this.toExpandCloner.clear()}doPendingUpdateCloner(){this.toUpdateCloner.forEach(e=>{var t;(t=e.cloner)==null||t.update()}),this.toUpdateCloner.clear()}doPendingUpdates(){this.doPendingExpandCloner(),this.doPendingUpdateCloner(),this.applyPendingCommands()}addPendingCommand(e){this.pendingCommands.push(e)}applyPendingCommands(){this.pendingCommands.forEach(e=>e()),this.pendingCommands.length=0}updateByLibOp(e,t){e.path.length===1&&e.path[0]==="components"&&e.type===1&&this.createChildrenObjects([{...e.data.asset,id:e.id}],this.invisibleObjects,t)}updateTreeByOp(e,t){var i;if(e.path.length===0&&e.type===7){let r=e.parent===null?this:this.find(e.parent);if(r===void 0)throw new Error("unexpected");let n=this.createObject(e.id,e.data,e.children,r,e.localIndex,t);n.updateVisible(this),n.resetBBoxNeedsUpdate(),ql(n)&&fh(n.parent)&&(n.invalidateUpstreamBooleanData(),n.parent.invalidateDownstreamBooleanData().recomputeBoolean()),this.markNeedsRecomputeInstancesForAncessors(r),this.markNeedsRecomputeInstancesForChildren(n),this.markToExpandCloner(n),this.markPenumbraSizeDirty(),n.updatePathSnapping()}else if(e.path.length===0&&e.type===8){let r=this.find(e.id);if(r===void 0)throw new Error("unexpected");r.traverseEntity(s=>{s instanceof Dm&&(this.shapeBlendIntances=this.shapeBlendIntances.filter(a=>a!==s))}),this.markToExpandCloner(r),r.resetBBoxNeedsUpdate(),this.unregisterObject(r);let n=r.parent;this.markNeedsRecomputeInstancesForAncessors(n),this.markNeedsRecomputeInstancesForChildren(r),this.markPenumbraSizeDirty(),r.parent.remove(r),fh(r.parent)&&(r.parent.invalidateUpstreamBooleanData(),r.parent.invalidateDownstreamBooleanData().recomputeBoolean()),ql(r)&&(r.freeBooleanPointer(),n instanceof Pm&&n.invalidateDownstreamBooleanData().recomputeBoolean()),r instanceof d4&&r.detachShape(),this.disposeAndUnregisterEntityRecursivelyIfNotReregistered(r),this.pathConstraints.removeDependencies(r.uuid),r.updatePathSnapping()}else if(e.path.length===0&&e.type===9){let r=this.find(e.id);if(r===void 0)throw new Error("unexpected");this.markNeedsRecomputeInstancesForChildren(r);let n=r.parent;this.markNeedsRecomputeInstancesForAncessors(n),(i=r.cloner)==null||i.resetOnMove(),this.markToExpandCloner(r);let s=e.parent===null?this:this.find(e.parent);if(s===void 0)throw new Error("unexpected");s.add(r),this.markNeedsRecomputeInstancesForAncessors(s),this.markToExpandCloner(r),r.invalidateClonerTransform(r),r.updateVisible(this),r.resetBBoxNeedsUpdate(),this.markPenumbraSizeDirty();let a=e.localIndex;s.children.splice(a,0,s.children.pop()),ql(r)&&(r.invalidateUpstreamBooleanData(),fh(r.parent)?r.parent.invalidateDownstreamBooleanData().recomputeBoolean():n instanceof Pm&&n.invalidateDownstreamBooleanData().recomputeBoolean()),r.updatePathSnapping()}this.markNeedsUpdateRendererDirty(),this.markGeometryCacheDirty()}get playPage(){return this.find(this.data.publish.playPage)??this.errorPage}updatePage(e){var t;this.activePage&&this.activePage.onDeactive(),this.activePage=this.errorPage;for(let i of this.children)i instanceof hs&&(i.visible=i.uuid===e,i.visible&&(this.activePage=i,this.activePage.onActive(this)));this.activePage!==((t=this.splatViewer)==null?void 0:t.activePage)&&this.reloadSplats()}updateEntityByOp(e,t,i,r){if(t.type===0){if(("overrides"in t.props||"component"in t.props)&&this.markNeedsRecomputeInstances(),"visible"in t.props&&this.markPenumbraSizeDirty(),t.path.includes("overrides")&&"states"in t.props){let{rest:s}=t.props;t={...t,props:s},this.markNeedsRecomputeInstances()}t.path[0]==="pathSnapping"&&t.props.pathId!==void 0&&this.pathConstraints.setConstraint(e,t.props.pathId)}let n=this.find(e);if(n)try{RFe(n,t,i,{scene:this,shared:r}),n instanceof Rn&&n.updateGeometryGroupsIfNeeded()}catch(s){console.error(s)}}updateEntity2DByOp(e,t,i,r,n,s=[]){e.updateEntityByOp(t,i,r,n),this.traverseEntity(a=>{(a instanceof ia||a instanceof hs)&&(s.includes(a.frameId??"")||a.frameId===t)&&a.updateEntity2DByOp(t,i,r,n)})}get activeCamera(){return this.activePage.activeCamera}switchActiveCamera(e){this.activePage.switchActiveCamera(e)}isInvisibleObjects(e){return e===this.invisibleObjects||e.hasAnccestor(this.invisibleObjects)}init(e,t){let i=Object.entries(t.data.lib.components).map((r,n)=>({data:r[1].asset.data,children:r[1].asset.children,id:r[0],fi:n}));this.invisibleObjects.updateState(this.invisibleObjects.data,{scene:this,shared:t}),this.add(this.invisibleObjects),this.createChildrenObjects(i,this.invisibleObjects,t),this.createChildrenObjects(e.objects,this,t),this.updatePage(e.publish.playPage),this.activePage.switchToPlayCamera(),this.expandInstances(t,!0),this.traverseEntity(r=>{r instanceof aa&&r.updateUp()}),this.doPendingExpandCloner(),this.applyPendingCommands()}markNeedsRecomputeInstances(){this.needsRecomputeInstances=!0}markNeedsRecomputeInstancesForChildren(e){e.traverseEntity(t=>{(t.data.type==="Component"||t.data.type==="Instance")&&this.markNeedsRecomputeInstances()})}markNeedsRecomputeInstancesForAncessors(e){Fi.is(e)&&(e.data.type==="Component"&&this.markNeedsRecomputeInstances(),e.traverseAncestors(t=>{Fi.is(t)&&t.data.type==="Component"&&this.markNeedsRecomputeInstances()}))}relativeizeInner(e,t,i,r,n,s,a){if(e){let o=r.find(e);o&&o!==r&&n.forInstancesRec(l=>{l.data=kw(l.data,c=>{let u=c.events.data(a.id),h=l.goUp(s);if(h){let d=[...$$(h.identity),e].join("-"),f=this.entityIdentityToEntity[d];if(f){let p=f.uuid,v=Xn.zoom(u,t);v[i]=p}else console.warn("cannot find instance")}}).data})}}rewriteActions(e,t,i,r,n,s){e.forEach(a=>{a.data.type==="Transition"?this.relativeizeInner(a.data.object,[...t,a.id],"object",i,r,n,s):a.data.type==="Animation"?this.relativeizeInner(a.data.object,[...t,a.id],"object",i,r,n,s):a.data.type==="Conditional"&&(this.rewriteActions(a.data.ifActions,[...t,a.id,"ifActions"],i,r,n,s),this.rewriteActions(a.data.elseActions,[...t,a.id,"elseActions"],i,r,n,s))})}rewriteEventsBeforeGoToPlayMode(){this.traverseEntity(e=>{if(e instanceof y0&&typeof e.identity=="string"&&e.data.type==="Component")return e.traverseEntity((t,i)=>{t.data.events.forEach(r=>{if(r.data.type==="GameControl"){let n=!1;if(t.forInstancesRec(s=>{s.data=kw(s.data,a=>{s.isInstanceRoot||(a.events.delete(r.id),n=!0)}).data}),n===!1)for(let s of NA.list)this.rewriteActions(r.data.gameActions[s],["gameActions",s],e,t,i,r)}else r.data.type==="Conditional"?(r.data.condition.type==="Distance"?(this.relativeizeInner(r.data.condition.fromObject,["condition"],"fromObject",e,t,i,r),this.relativeizeInner(r.data.condition.toObject,["condition"],"toObject",e,t,i,r)):r.data.condition.type==="State"?this.relativeizeInner(r.data.condition.object,["condition"],"object",e,t,i,r):r.data.condition.type==="Comparison"&&(r.data.condition.lOperand.type==="Property"&&this.relativeizeInner(r.data.condition.lOperand.value[0],["condition","lOperand","value"],0,e,t,i,r),r.data.condition.rOperand.type==="Property"&&this.relativeizeInner(r.data.condition.rOperand.value[0],["condition","rOperand","value"],0,e,t,i,r)),this.rewriteActions(r.data.inActions,["inActions"],e,t,i,r),this.rewriteActions(r.data.outActions,["outActions"],e,t,i,r)):"actions"in r.data&&this.rewriteActions(r.data.actions,["actions"],e,t,i,r)})}),!0})}expandInstances(e,t,i){let r=new Set;this.traverseEntity(n=>{if(n instanceof y0&&n.isInstanceRoot)return n.expandInstanceChildren({scene:this,shared:e,pendingDeletes:r}),t||n.resetBBoxNeedsUpdate(),i&&n.traverseEntity(s=>{i.addClip(s)}),!0});for(let n of r)this.disposeAndUnregisterEntityRecursivelyIfNotReregistered(n),p4(n)}recomputeInstances(e,t){this.needsRecomputeInstances&&(this.needsRecomputeInstances=!1,this.traverseEntity(i=>{i instanceof y0&&i.isInstanceRoot&&(i.component=void 0)}),this.expandInstances(e,!1,t))}disposeAndUnregisterEntityRecursivelyIfNotReregistered(e){e.traverseEntity(t=>{let i=typeof t.identity=="string"?t.identity:t.identity.join("-");this.entityIdentityToEntity[i]===t&&(delete this.entityByUuid[t.uuid],delete this.entityIdentityToEntity[i]),t.dispose()})}clearScene(){for(let e of this.children)Fi.is(e)&&e.disposeRecursively();this.children.length=0}resetAfterClear(e,t){this.init(e,t)}raycast(e){return this.raycast1(e,!1)}raycast1(e,t){let i=[],r=n=>{for(let s of n.children){let a=s.cloner;if(Fi.is(s)&&!s.raycastLock&&(s.visible||a!=null&&a.object.data.visible))if(t===!0&&s.isInstanceRoot){let o=[];if(e.intersectObject(s,!0,o),o.length){let l=o[0];l.object=s,l.point.applyMatrix4(l.object.matrixWorld);let c=s.matrixWorld.clone().invert();l.point.applyMatrix4(c),i.push(l)}}else(ql(s)||yB(s)&&this.enableHelpers&&s.objectHelper.visible)&&(e.intersectObject(s,!1,i),PB(s,e,i)),r(s)}};return r(this.activePage),i}raycastWithClones(e){let t=[],i=r=>{for(let n of r.children){let s=n.cloner;Fi.is(n)&&(n.visible||s!=null&&s.object.data.visible)&&((ql(n)||yB(n)&&this.enableHelpers&&n.objectHelper.visible)&&(e.intersectObject(n,!1,t),PB(n,e,t,!0)),i(n))}};return i(this),t}forEachEntity(e){for(let t of this.children)Fi.is(t)&&e(t)}traverseConcreteEntity(e){for(let t of this.children)Fi.is(t)&&t.isConcreteEntity&&t.traverseEntity(e)}traverseEntity(e){for(let t of this.children)Fi.is(t)&&t.traverseEntity(e)}updateFont(e,t){this.traverseEntity(i=>{if(i instanceof Rn&&i.data.type==="Mesh"&&(i.data.geometry.type==="TextGeometry"||i.data.geometry.type==="InputGeometry")&&i.data.geometry.font===e){let r=i.geometry,n=i.data.geometry;r.updateFont(e,t).then(()=>{r.update(n);let s=i.invalidateDownstreamBooleanData();fh(s)&&s.recomputeBoolean()})}})}traverseObject(e){for(let t of this.children)Tm.is(t)&&t.traverseObject(e)}traverseVisibleEntity(e){for(let t of this.children)Fi.is(t)&&t.visible&&t.traverseVisibleEntity(e)}dispose(){this.clearScene()}createChildrenObjects(e,t,i){let r=0;for(let n of e)this.createObject(n.id,n.data,n.children,t,r,i),r+=1}registerObjectCreatedInLegacy(e){this.entityByUuid[e.uuid]=e}unregisterObject(e){delete this.entityByUuid[e.uuid];for(let t of e.children)this.unregisterObject(t)}createObject(e,t,i,r,n,s){var l;let a={scene:this,shared:s},o=m4(e,t,a);return o instanceof Dm&&this.shapeBlendIntances.push(o),o&&(this.entityByUuid[e]=o,r.add(o),r.children.splice(n,0,r.children.pop()),i.length>0&&(o.isInstanceRoot?console.error("instance should not have children!"):this.createChildrenObjects(i,o,s)),o.updateState(t,a),o instanceof Rn&&o.updateGeometryGroupsIfNeeded(),o.updateVisible(this),o.cloner&&this.toExpandCloner.add(o),(l=t.pathSnapping)!=null&&l.pathId&&this.pathConstraints.setConstraint(e,t.pathSnapping.pathId)),t.type==="Empty"&&t.animations&&o.traverseEntity(c=>{let u=c.dataPatched;if(c instanceof Rn&&u.bones&&u.boneInverses){let h=u.bones.map(p=>this.find(p)),d=u.boneInverses.map(p=>new ft().fromArray(p)),f=new iN(h,d);c.bind(f,c.bindMatrix)}else c.matrixAutoUpdate=!0}),o}getCenter(e){let t=[];for(let r=0,n=e.length;r<n;++r){let{id:s,recursive:a}=e[r],o=this.find(s),l=a?o.recursiveBBox:o.singleBBox;t.push(...l.vertices)}let i=new vn;return i.setFromPoints(t),i.getCenter(q9),q9}copyMatrixWorld(e,t){if(e===null){t.identity();return}let i=this.find(e);i?t.copy(i.matrixWorld):t.identity()}copyParentMatrixWorld(e,t){var r;if(e===null){t.identity();return}let i=(r=this.find(e))==null?void 0:r.parent;i?t.copy(i.matrixWorld):t.identity()}traverseMaterial(e){this.traverseEntity(t=>{if(t instanceof za)if(Array.isArray(t.material))for(let i=0;i<t.material.length;i++)t.material[i]instanceof yf&&e(t.material[i]);else t.material instanceof yf&&e(t.material)})}updateViewPlaneSize(e,t,i=!1){this.traverseConcreteEntity(r=>{r instanceof aa&&r.setViewplaneSize(e,t,i)})}initializeSplatViewer(){this.splatViewer=new KFe({scene:this}),this.reloadSplats()}reloadSplats(){var e;(e=this.splatViewer)==null||e.loadSplat()}},h2=(e,t)=>{let i=t.x-e.x,r=t.y-e.y;return Math.sqrt(i*i+r*r)},JFe=(e,t)=>{let i=t.x-e.x,r=t.y-e.y;return eUe(Math.atan2(r,i))},$Fe=(e,t,i)=>{let r={x:0,y:0};return i=RB(i),r.x=e.x-t*Math.cos(i),r.y=e.y-t*Math.sin(i),r},RB=e=>e*(Math.PI/180),eUe=e=>e*(180/Math.PI),tUe=e=>isNaN(e.buttons)?e.pressure!==0:e.buttons!==0,$R=new Map,Y9=e=>{$R.has(e)&&clearTimeout($R.get(e)),$R.set(e,setTimeout(e,100))},iT=(e,t,i)=>{let r=t.split(/[ ,]+/g),n;for(let s=0;s<r.length;s+=1)n=r[s],e.addEventListener?e.addEventListener(n,i,!1):e.attachEvent&&e.attachEvent(n,i)},Q9=(e,t,i)=>{let r=t.split(/[ ,]+/g),n;for(let s=0;s<r.length;s+=1)n=r[s],e.removeEventListener?e.removeEventListener(n,i):e.detachEvent&&e.detachEvent(n,i)},Rie=e=>(e.preventDefault(),e.type.match(/^touch/)?e.changedTouches:e),Z9=()=>{if(typeof window>"u")return;let e=window.pageXOffset!==void 0?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,t=window.pageYOffset!==void 0?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop;return{x:e,y:t}},IB=(e,t)=>{t.top||t.right||t.bottom||t.left?(e.style.top=t.top,e.style.right=t.right,e.style.bottom=t.bottom,e.style.left=t.left):(e.style.left=t.x+"px",e.style.top=t.y+"px")},v4=(e,t,i)=>{let r=Iie(e);for(let n in r)if(r.hasOwnProperty(n))if(typeof t=="string")r[n]=t+" "+i;else{let s="";for(let a=0,o=t.length;a<o;a+=1)s+=t[a]+" "+i+", ";r[n]=s.slice(0,-2)}return r},iUe=(e,t)=>{let i=Iie(e);for(let r in i)i.hasOwnProperty(r)&&(i[r]=t);return i},Iie=e=>{let t={};return t[e]="",["webkit","Moz","o"].forEach(function(i){t[i+e.charAt(0).toUpperCase()+e.slice(1)]=""}),t},eI=(e,t)=>{for(let i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e},rUe=(e,t)=>{let i={};for(let r in e)e.hasOwnProperty(r)&&t.hasOwnProperty(r)?i[r]=t[r]:e.hasOwnProperty(r)&&(i[r]=e[r]);return i},LB=(e,t)=>{if(e.length)for(let i=0,r=e.length;i<r;i+=1)t(e[i]);else t(e)},nUe=(e,t,i)=>({x:Math.min(Math.max(e.x,t.x-i),t.x+i),y:Math.min(Math.max(e.y,t.y-i),t.y+i)});typeof window<"u"&&(Lie="ontouchstart"in window,Oie=!!window.PointerEvent,zie=!!window.MSPointerEvent);var Lie,Oie,zie,C1={touch:{start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},mouse:{start:"mousedown",move:"mousemove",end:"mouseup"},pointer:{start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"},MSPointer:{start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}},Yv,Zw={};Oie?Yv=C1.pointer:zie?Yv=C1.MSPointer:Lie?(Yv=C1.touch,Zw=C1.mouse):Yv=C1.mouse;function Qm(){}Qm.prototype.on=function(e,t){var i=this,r=e.split(/[ ,]+/g),n;i._handlers_=i._handlers_||{};for(var s=0;s<r.length;s+=1)n=r[s],i._handlers_[n]=i._handlers_[n]||[],i._handlers_[n].push(t);return i};Qm.prototype.off=function(e,t){var i=this;return i._handlers_=i._handlers_||{},e===void 0?i._handlers_={}:t===void 0?i._handlers_[e]=null:i._handlers_[e]&&i._handlers_[e].indexOf(t)>=0&&i._handlers_[e].splice(i._handlers_[e].indexOf(t),1),i};Qm.prototype.trigger=function(e,t){var i=this,r=e.split(/[ ,]+/g),n;i._handlers_=i._handlers_||{};for(var s=0;s<r.length;s+=1)n=r[s],i._handlers_[n]&&i._handlers_[n].length&&i._handlers_[n].forEach(function(a){a.call(i,{type:n,target:i},t)})};Qm.prototype.config=function(e){var t=this;t.options=t.defaults||{},e&&(t.options=rUe(t.options,e))};Qm.prototype.bindEvt=function(e,t){var i=this;return i._domHandlers_=i._domHandlers_||{},i._domHandlers_[t]=function(){typeof i["on"+t]=="function"?i["on"+t].apply(i,arguments):console.warn('[WARNING] : Missing "on'+t+'" handler.')},iT(e,Yv[t],i._domHandlers_[t]),Zw[t]&&iT(e,Zw[t],i._domHandlers_[t]),i};Qm.prototype.unbindEvt=function(e,t){var i=this;return i._domHandlers_=i._domHandlers_||{},Q9(e,Yv[t],i._domHandlers_[t]),Zw[t]&&Q9(e,Zw[t],i._domHandlers_[t]),delete i._domHandlers_[t],this};var y4=Qm;function Kn(e,t){return this.identifier=t.identifier,this.position=t.position,this.frontPosition=t.frontPosition,this.collection=e,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:1,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(t),this.options.mode==="dynamic"&&(this.options.restOpacity=0),this.id=Kn.id,Kn.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}Kn.prototype=new y4;Kn.constructor=Kn;Kn.id=0;Kn.prototype.buildEl=function(e){return this.ui={},this.options.dataOnly?this:(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front),this)};Kn.prototype.stylize=function(){if(this.options.dataOnly)return this;var e=this.options.fadeTime+"ms",t=iUe("borderRadius","50%"),i=v4("transition","opacity",e),r={};return r.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},r.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:"rgba(255, 255, 255, .4)",border:"solid 2px rgba(0, 0, 0, .1)"},r.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:"rgba(255, 255, 255, .8)",border:"solid 2px rgba(0, 0, 0, .1)"},eI(r.el,i),this.options.shape==="circle"&&eI(r.back,t),eI(r.front,t),this.applyStyles(r),this};Kn.prototype.applyStyles=function(e){for(var t in this.ui)if(this.ui.hasOwnProperty(t))for(var i in e[t])this.ui[t].style[i]=e[t][i];return this};Kn.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)?this:(this.options.zone.appendChild(this.ui.el),this)};Kn.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)?this:(this.options.zone.removeChild(this.ui.el),this)};Kn.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()};Kn.prototype.show=function(e){var t=this;return t.options.dataOnly||(clearTimeout(t.removeTimeout),clearTimeout(t.showTimeout),clearTimeout(t.restTimeout),t.addToDom(),t.restCallback(),setTimeout(function(){t.ui.el.style.opacity=1},0),t.showTimeout=setTimeout(function(){t.trigger("shown",t.instance),typeof e=="function"&&e.call(this)},t.options.fadeTime)),t};Kn.prototype.hide=function(e){var t=this;if(t.options.dataOnly)return t;if(t.ui.el.style.opacity=t.options.restOpacity,clearTimeout(t.removeTimeout),clearTimeout(t.showTimeout),clearTimeout(t.restTimeout),t.removeTimeout=setTimeout(function(){var i=t.options.mode==="dynamic"?"none":"block";t.ui.el.style.display=i,typeof e=="function"&&e.call(t),t.trigger("hidden",t.instance)},t.options.fadeTime),t.options.restJoystick){let i=t.options.restJoystick,r={};r.x=i===!0||i.x!==!1?0:t.instance.frontPosition.x,r.y=i===!0||i.y!==!1?0:t.instance.frontPosition.y,t.setPosition(e,r)}return t};Kn.prototype.setPosition=function(e,t){var i=this;i.frontPosition={x:t.x,y:t.y};var r=i.options.fadeTime+"ms",n={};n.front=v4("transition",["top","left"],r);var s={front:{}};s.front={left:i.frontPosition.x+"px",top:i.frontPosition.y+"px"},i.applyStyles(n),i.applyStyles(s),i.restTimeout=setTimeout(function(){typeof e=="function"&&e.call(i),i.restCallback()},i.options.fadeTime)};Kn.prototype.restCallback=function(){var e=this,t={};t.front=v4("transition","none",""),e.applyStyles(t),e.trigger("rested",e.instance)};Kn.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}};Kn.prototype.computeDirection=function(e){var t=e.angle.radian,i=Math.PI/4,r=Math.PI/2,n,s,a;if(t>i&&t<i*3&&!e.lockX?n="up":t>-i&&t<=i&&!e.lockY?n="left":t>-i*3&&t<=-i&&!e.lockX?n="down":e.lockY||(n="right"),e.lockY||(t>-r&&t<r?s="left":s="right"),e.lockX||(t>0?a="up":a="down"),e.force>this.options.threshold){var o={},l;for(l in this.direction)this.direction.hasOwnProperty(l)&&(o[l]=this.direction[l]);var c={};this.direction={x:s,y:a,angle:n},e.direction=this.direction;for(l in o)o[l]===this.direction[l]&&(c[l]=!0);if(c.x&&c.y&&c.angle)return e;(!c.x||!c.y)&&this.trigger("plain",e),c.x||this.trigger("plain:"+s,e),c.y||this.trigger("plain:"+a,e),c.angle||this.trigger("dir dir:"+n,e)}else this.resetDirection();return e};var sUe=Kn;function yn(e,t){var i=this;i.nipples=[],i.idles=[],i.actives=[],i.ids=[],i.pressureIntervals={},i.manager=e,i.id=yn.id,yn.id+=1,i.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:1,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},i.config(t),(i.options.mode==="static"||i.options.mode==="semi")&&(i.options.multitouch=!1),i.options.multitouch||(i.options.maxNumberOfNipples=1);let r=getComputedStyle(i.options.zone.parentElement);return r&&r.display==="flex"&&(i.parentIsFlex=!0),i.updateBox(),i.prepareNipples(),i.bindings(),i.begin(),i.nipples}yn.prototype=new y4;yn.constructor=yn;yn.id=0;yn.prototype.prepareNipples=function(){var e=this,t=e.nipples;t.on=e.on.bind(e),t.off=e.off.bind(e),t.options=e.options,t.destroy=e.destroy.bind(e),t.ids=e.ids,t.id=e.id,t.processOnMove=e.processOnMove.bind(e),t.processOnEnd=e.processOnEnd.bind(e),t.get=function(i){if(i===void 0)return t[0];for(var r=0,n=t.length;r<n;r+=1)if(t[r].identifier===i)return t[r];return!1}};yn.prototype.bindings=function(){var e=this;e.bindEvt(e.options.zone,"start"),e.options.zone.style.touchAction="none",e.options.zone.style.msTouchAction="none"};yn.prototype.begin=function(){var e=this,t=e.options;if(t.mode==="static"){var i=e.createNipple(t.position,e.manager.getIdentifier());i.add(),e.idles.push(i)}};yn.prototype.createNipple=function(e,t){var i=this,r=i.manager.scroll,n={},s=i.options,a={x:i.parentIsFlex?r.x:r.x+i.box.left,y:i.parentIsFlex?r.y:r.y+i.box.top};if(e.x&&e.y)n={x:e.x-a.x,y:e.y-a.y};else if(e.top||e.right||e.bottom||e.left){var o=document.createElement("DIV");o.style.display="hidden",o.style.top=e.top,o.style.right=e.right,o.style.bottom=e.bottom,o.style.left=e.left,o.style.position="absolute",s.zone.appendChild(o);var l=o.getBoundingClientRect();s.zone.removeChild(o),n=e,e={x:l.left+r.x,y:l.top+r.y}}var c=new sUe(i,{color:s.color,size:s.size,threshold:s.threshold,fadeTime:s.fadeTime,dataOnly:s.dataOnly,restJoystick:s.restJoystick,restOpacity:s.restOpacity,mode:s.mode,identifier:t,position:e,zone:s.zone,frontPosition:{x:0,y:0},shape:s.shape});return s.dataOnly||(IB(c.ui.el,n),IB(c.ui.front,c.frontPosition)),i.nipples.push(c),i.trigger("added "+c.identifier+":added",c),i.manager.trigger("added "+c.identifier+":added",c),i.bindNipple(c),c};yn.prototype.updateBox=function(){var e=this;e.box=e.options.zone.getBoundingClientRect()};yn.prototype.bindNipple=function(e){var t=this,i,r=function(n,s){i=n.type+" "+s.id+":"+n.type,t.trigger(i,s)};e.on("destroyed",t.onDestroyed.bind(t)),e.on("shown hidden rested dir plain",r),e.on("dir:up dir:right dir:down dir:left",r),e.on("plain:up plain:right plain:down plain:left",r)};yn.prototype.pressureFn=function(e,t,i){var r=this,n=0;clearInterval(r.pressureIntervals[i]),r.pressureIntervals[i]=setInterval((function(){var s=e.force||e.pressure||e.webkitForce||0;s!==n&&(t.trigger("pressure",s),r.trigger("pressure "+t.identifier+":pressure",s),n=s)}).bind(r),100)};yn.prototype.onstart=function(e){var t=this,i=t.options,r=e;e=Rie(e),t.updateBox();var n=function(s){t.actives.length<i.maxNumberOfNipples?t.processOnStart(s):r.type.match(/^touch/)&&(Object.keys(t.manager.ids).forEach(function(a){if(Object.values(r.touches).findIndex(function(l){return l.identifier===a})<0){var o=[e[0]];o.identifier=a,t.processOnEnd(o)}}),t.actives.length<i.maxNumberOfNipples&&t.processOnStart(s))};return LB(e,n),t.manager.bindDocument(),!1};yn.prototype.processOnStart=function(e){var t=this,i=t.options,r,n=t.manager.getIdentifier(e),s=e.force||e.pressure||e.webkitForce||0,a={x:e.pageX,y:e.pageY},o=t.getOrCreate(n,a);o.identifier!==n&&t.manager.removeIdentifier(o.identifier),o.identifier=n;var l=function(u){u.trigger("start",u),t.trigger("start "+u.id+":start",u),u.show(),s>0&&t.pressureFn(e,u,u.identifier),t.processOnMove(e)};if((r=t.idles.indexOf(o))>=0&&t.idles.splice(r,1),t.actives.push(o),t.ids.push(o.identifier),i.mode!=="semi")l(o);else{var c=h2(a,o.position);if(c<=i.catchDistance)l(o);else{o.destroy(),t.processOnStart(e);return}}return o};yn.prototype.getOrCreate=function(e,t){var i=this,r=i.options,n;return/(semi|static)/.test(r.mode)?(n=i.idles[0],n?(i.idles.splice(0,1),n):r.mode==="semi"?i.createNipple(t,e):(console.warn("Coudln't find the needed nipple."),!1)):(n=i.createNipple(t,e),n)};yn.prototype.processOnMove=function(e){var t=this,i=t.options,r=t.manager.getIdentifier(e),n=t.nipples.get(r),s=t.manager.scroll;if(!tUe(e)){this.processOnEnd(e);return}if(!n){console.error("Found zombie joystick with ID "+r),t.manager.removeIdentifier(r);return}if(i.dynamicPage){var a=n.el.getBoundingClientRect();n.position={x:s.x+a.left,y:s.y+a.top}}n.identifier=r;var o=n.options.size/2,l={x:e.pageX,y:e.pageY};i.lockX&&(l.y=n.position.y),i.lockY&&(l.x=n.position.x);var c=h2(l,n.position),u=JFe(l,n.position),h=RB(u),d=c/o,f={distance:c,position:l},p,v;if(n.options.shape==="circle"?(p=Math.min(c,o),v=$Fe(n.position,p,u)):(v=nUe(l,n.position,o),p=h2(v,n.position)),i.follow){if(c>o){let x=l.x-v.x,_=l.y-v.y;n.position.x+=x,n.position.y+=_,n.el.style.top=n.position.y-(t.box.top+s.y)+"px",n.el.style.left=n.position.x-(t.box.left+s.x)+"px",c=h2(l,n.position)}}else l=v,c=p;var m=l.x-n.position.x,g=l.y-n.position.y;n.frontPosition={x:m,y:g},i.dataOnly||IB(n.ui.front,n.frontPosition);var y={identifier:n.identifier,position:l,force:d,pressure:e.force||e.pressure||e.webkitForce||0,distance:c,angle:{radian:h,degree:u},vector:{x:m/o,y:-g/o},raw:f,instance:n,lockX:i.lockX,lockY:i.lockY};y=n.computeDirection(y),y.angle={radian:RB(180-u),degree:180-u},n.trigger("move",y),t.trigger("move "+n.id+":move",y)};yn.prototype.processOnEnd=function(e){var t=this,i=t.options,r=t.manager.getIdentifier(e),n=t.nipples.get(r),s=t.manager.removeIdentifier(n.identifier);!n||(i.dataOnly||n.hide(function(){i.mode==="dynamic"&&(n.trigger("removed",n),t.trigger("removed "+n.id+":removed",n),t.manager.trigger("removed "+n.id+":removed",n),n.destroy())}),clearInterval(t.pressureIntervals[n.identifier]),n.resetDirection(),n.trigger("end",n),t.trigger("end "+n.id+":end",n),t.ids.indexOf(n.identifier)>=0&&t.ids.splice(t.ids.indexOf(n.identifier),1),t.actives.indexOf(n)>=0&&t.actives.splice(t.actives.indexOf(n),1),/(semi|static)/.test(i.mode)?t.idles.push(n):t.nipples.indexOf(n)>=0&&t.nipples.splice(t.nipples.indexOf(n),1),t.manager.unbindDocument(),/(semi|static)/.test(i.mode)&&(t.manager.ids[s.id]=s.identifier))};yn.prototype.onDestroyed=function(e,t){var i=this;i.nipples.indexOf(t)>=0&&i.nipples.splice(i.nipples.indexOf(t),1),i.actives.indexOf(t)>=0&&i.actives.splice(i.actives.indexOf(t),1),i.idles.indexOf(t)>=0&&i.idles.splice(i.idles.indexOf(t),1),i.ids.indexOf(t.identifier)>=0&&i.ids.splice(i.ids.indexOf(t.identifier),1),i.manager.removeIdentifier(t.identifier),i.manager.unbindDocument()};yn.prototype.destroy=function(){var e=this;e.unbindEvt(e.options.zone,"start"),e.nipples.forEach(function(i){i.destroy()});for(var t in e.pressureIntervals)e.pressureIntervals.hasOwnProperty(t)&&clearInterval(e.pressureIntervals[t]);e.trigger("destroyed",e.nipples),e.manager.unbindDocument(),e.off()};var aUe=yn;function xs(e){var t=this;t.ids={},t.index=0,t.collections=[],t.scroll=Z9(),t.config(e),t.prepareCollections();var i=function(){var n;t.collections.forEach(function(s){s.forEach(function(a){n=a.el.getBoundingClientRect(),a.position={x:t.scroll.x+n.left,y:t.scroll.y+n.top}})})};if(typeof window>"u")return t.collections;iT(window,"resize",function(){Y9(i)});var r=function(){t.scroll=Z9()};return iT(window,"scroll",function(){Y9(r)}),t.collections}xs.prototype=new y4;xs.constructor=xs;xs.prototype.prepareCollections=function(){var e=this;e.collections.create=e.create.bind(e),e.collections.on=e.on.bind(e),e.collections.off=e.off.bind(e),e.collections.destroy=e.destroy.bind(e),e.collections.get=function(t){var i;return e.collections.every(function(r){return i=r.get(t),!i}),i}};xs.prototype.create=function(e){return this.createCollection(e)};xs.prototype.createCollection=function(e){var t=this,i=new aUe(t,e);return t.bindCollection(i),t.collections.push(i),i};xs.prototype.bindCollection=function(e){var t=this,i,r=function(n,s){i=n.type+" "+s.id+":"+n.type,t.trigger(i,s)};e.on("destroyed",t.onDestroyed.bind(t)),e.on("shown hidden rested dir plain",r),e.on("dir:up dir:right dir:down dir:left",r),e.on("plain:up plain:right plain:down plain:left",r)};xs.prototype.bindDocument=function(){var e=this;e.binded||(e.bindEvt(document,"move").bindEvt(document,"end"),e.binded=!0)};xs.prototype.unbindDocument=function(e){var t=this;(!Object.keys(t.ids).length||e===!0)&&(t.unbindEvt(document,"move").unbindEvt(document,"end"),t.binded=!1)};xs.prototype.getIdentifier=function(e){var t;return e?(t=e.identifier===void 0?e.pointerId:e.identifier,t===void 0&&(t=this.latest||0)):t=this.index,this.ids[t]===void 0&&(this.ids[t]=this.index,this.index+=1),this.latest=t,this.ids[t]};xs.prototype.removeIdentifier=function(e){var t={};for(var i in this.ids)if(this.ids[i]===e){t.id=i,t.identifier=this.ids[i],delete this.ids[i];break}return t};xs.prototype.onmove=function(e){var t=this;return t.onAny("move",e),!1};xs.prototype.onend=function(e){var t=this;return t.onAny("end",e),!1};xs.prototype.oncancel=function(e){var t=this;return t.onAny("end",e),!1};xs.prototype.onAny=function(e,t){var i=this,r,n="processOn"+e.charAt(0).toUpperCase()+e.slice(1);t=Rie(t);var s=function(o,l,c){c.ids.indexOf(l)>=0&&(c[n](o),o._found_=!0)},a=function(o){r=i.getIdentifier(o),LB(i.collections,s.bind(null,o,r)),o._found_||i.removeIdentifier(r)};return LB(t,a),!1};xs.prototype.destroy=function(){var e=this;e.unbindDocument(!0),e.ids={},e.index=0,e.collections.forEach(function(t){t.destroy()}),e.off()};xs.prototype.onDestroyed=function(e,t){var i=this;if(i.collections.indexOf(t)<0)return!1;i.collections.splice(i.collections.indexOf(t),1)};var oUe=xs,K9=new oUe,lUe={create:function(e){return K9.create(e)},factory:K9},Bie=new Map,Vx=new Map,Zp=class{constructor(e,t,i,r){this.data=t;let{audio:n,volume:s,delay:a,loop:o}=t;if(!n)throw new Error("Missing property");let l=typeof n=="string"?r.getAudio(n).src:n.data;this.audioPlayer=new fx({src:l,volume:s,delay:a,loop:o}),Vx.has(i.uuid)?Vx.get(i.uuid).push(this):Vx.set(i.uuid,[this]),Bie.set(e,this)}playByToggle(){this.data.toggle==="stop"?this.audioPlayer.status==="playing"?this.audioPlayer.stop():(this.audioPlayer.stop(),this.audioPlayer.play()):this.data.toggle==="pause"?this.audioPlayer.status==="playing"?this.audioPlayer.pause():this.audioPlayer.play():(this.audioPlayer.stop(),this.audioPlayer.play())}dispose(){this.audioPlayer.stop()}},OB=class{constructor(e){this.data=e}dispatch(){this.data.playAudio?this.pauseAudio(this.data.playAudio):this.data.object?this.pauseAllAudiosFromObject(this.data.object):this.pauseAllAudios()}pauseAudio(e){let t=Bie.get(e);!t||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{t.audioPlayer[this.data.interaction](),this.disposeDelay()},this.data.delay)):t.audioPlayer[this.data.interaction]())}pauseAllAudiosFromObject(e){let t=Vx.get(e);!(t!=null&&t.length)||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{t.forEach(i=>i.audioPlayer[this.data.interaction]()),this.disposeDelay()},this.data.delay)):t.forEach(i=>i.audioPlayer[this.data.interaction]()))}pauseAllAudios(){let e=[...Vx.values()];!e.length||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{e.forEach(t=>{t.forEach(i=>{i.audioPlayer[this.data.interaction]()})}),this.disposeDelay()},this.data.delay)):e.forEach(t=>{t.forEach(i=>{i.audioPlayer[this.data.interaction]()})}))}disposeDelay(){clearTimeout(this.timeoutId),delete this.timeoutId}dispose(){clearTimeout(this.timeoutId),delete this.timeoutId}},Fie=class{constructor(e,t,i,r,n){if(this.data=t,this.shared=r,this.condition=n,t.interaction==="play")this.interaction=new Zp(e,t,i,r);else if(t.interaction==="pause"||t.interaction==="stop")this.interaction=new OB(t);else throw new Error("Missing property")}dispatchBasic(){if(Sr(this.shared,this.condition)===!1)return!1;this.interaction instanceof Zp?this.interaction.playByToggle():this.interaction.dispatch()}dispatchConditional(){if(Sr(this.shared,this.condition)===!1)return!1;this.interaction instanceof Zp?this.interaction.audioPlayer.play():this.interaction.dispatch()}dispatchGameControl(e){if(Sr(this.shared,this.condition)===!1)return!1;this.interaction instanceof Zp&&(e==="start"?this.interaction.audioPlayer.play():this.interaction.audioPlayer.stop())}dispose(){this.interaction.dispose()}},Uie=class{constructor(e,t,i,r){this.data=e,this.page=t,this.shared=i,this.condition=r,this.delay=0,this.emission=e.emission,e.delay!==void 0&&(this.delay=e.delay),this.particleSystem=this.page.scene.find(this.data.emitterObjectId)}toggleEmitting(){this.particleSystem.started&&!this.particleSystem.stopped?this.stop(this.delay):this.start(this.delay)}toggleFroze(){this.particleSystem.started&&!this.particleSystem.isFrozen?this.freeze(this.delay):this.unFreeze(this.delay)}start(e=0){if(e){this.delayTimerId=window.setTimeout(()=>{this.start(0),this.clearDelay()},e);return}this.particleSystem.start()}stop(e=0){if(e){this.delayTimerId=window.setTimeout(()=>{this.stop(0),this.clearDelay()},e);return}this.particleSystem.stop()}freeze(e=0){if(e){this.delayTimerId=window.setTimeout(()=>{this.freeze(0),this.clearDelay()},e);return}this.particleSystem.froze()}unFreeze(e=0){if(e){this.delayTimerId=window.setTimeout(()=>{this.unFreeze(0),this.clearDelay()},e);return}this.particleSystem.unFroze()}reset(e=0){if(e){this.delayTimerId=window.setTimeout(()=>{this.reset(0),this.clearDelay()},e);return}this.particleSystem.reset()}reverseFromCurrent(){switch(this.emission){case"emitToggle":this.toggleEmitting();break;case"pauseToggle":this.toggleFroze();break}}dispatchBasic(){if(Sr(this.shared,this.condition)===!1||!this.particleSystem)return!1;switch(this.emission){case"start":this.start(this.delay);break;case"emitToggle":this.toggleEmitting();break;case"pause":this.freeze(this.delay);break;case"pauseToggle":this.toggleFroze();break;case"stop":this.stop(this.delay);break;case"reset":this.reset(this.delay);break}}dispatchConditional(){if(Sr(this.shared,this.condition)===!1||!this.particleSystem)return!1;switch(this.emission){case"start":this.start(this.delay);break;case"stop":this.stop(this.delay);break;case"reset":this.reset(this.delay);break}}dispatchGameControl(e){if(Sr(this.shared,this.condition)===!1||!this.particleSystem)return!1;e==="start"?this.start(this.delay):this.stop(this.delay)}dispose(){!this.particleSystem||(this.particleSystem.reset(),this.clearDelay())}clearDelay(){this.delayTimerId&&(clearTimeout(this.delayTimerId),delete this.delayTimerId)}},cUe="text/plain",uUe="us-ascii",J9=(e,t)=>t.some(i=>i instanceof RegExp?i.test(e):i===e),hUe=(e,{stripHash:t})=>{let i=/^data:(?<type>[^,]*?),(?<data>[^#]*?)(?:#(?<hash>.*))?$/.exec(e);if(!i)throw new Error(`Invalid URL: ${e}`);let{type:r,data:n,hash:s}=i.groups,a=r.split(";");s=t?"":s;let o=!1;a[a.length-1]==="base64"&&(a.pop(),o=!0);let l=(a.shift()||"").toLowerCase(),c=[...a.map(u=>{let[h,d=""]=u.split("=").map(f=>f.trim());return h==="charset"&&(d=d.toLowerCase(),d===uUe)?"":`${h}${d?`=${d}`:""}`}).filter(Boolean)];return o&&c.push("base64"),(c.length>0||l&&l!==cUe)&&c.unshift(l),`data:${c.join(";")},${o?n.trim():n}${s?`#${s}`:""}`};function dUe(e,t){if(t={defaultProtocol:"http:",normalizeProtocol:!0,forceHttp:!1,forceHttps:!1,stripAuthentication:!0,stripHash:!1,stripTextFragment:!0,stripWWW:!0,removeQueryParameters:[/^utm_\w+/i],removeTrailingSlash:!0,removeSingleSlash:!0,removeDirectoryIndex:!1,sortQueryParameters:!0,...t},e=e.trim(),/^data:/i.test(e))return hUe(e,t);if(/^view-source:/i.test(e))throw new Error("`view-source:` is not supported as it is a non-standard protocol");let i=e.startsWith("//");!i&&/^\.*\//.test(e)||(e=e.replace(/^(?!(?:\w+:)?\/\/)|^\/\//,t.defaultProtocol));let r=new URL(e);if(t.forceHttp&&t.forceHttps)throw new Error("The `forceHttp` and `forceHttps` options cannot be used together");if(t.forceHttp&&r.protocol==="https:"&&(r.protocol="http:"),t.forceHttps&&r.protocol==="http:"&&(r.protocol="https:"),t.stripAuthentication&&(r.username="",r.password=""),t.stripHash?r.hash="":t.stripTextFragment&&(r.hash=r.hash.replace(/#?:~:text.*?$/i,"")),r.pathname){let s=/\b[a-z][a-z\d+\-.]{1,50}:\/\//g,a=0,o="";for(;;){let c=s.exec(r.pathname);if(!c)break;let u=c[0],h=c.index,d=r.pathname.slice(a,h);o+=d.replace(/\/{2,}/g,"/"),o+=u,a=h+u.length}let l=r.pathname.slice(a,r.pathname.length);o+=l.replace(/\/{2,}/g,"/"),r.pathname=o}if(r.pathname)try{r.pathname=decodeURI(r.pathname)}catch{}if(t.removeDirectoryIndex===!0&&(t.removeDirectoryIndex=[/^index\.[a-z]+$/]),Array.isArray(t.removeDirectoryIndex)&&t.removeDirectoryIndex.length>0){let s=r.pathname.split("/"),a=s[s.length-1];J9(a,t.removeDirectoryIndex)&&(s=s.slice(0,-1),r.pathname=s.slice(1).join("/")+"/")}if(r.hostname&&(r.hostname=r.hostname.replace(/\.$/,""),t.stripWWW&&/^www\.(?!www\.)[a-z\-\d]{1,63}\.[a-z.\-\d]{2,63}$/.test(r.hostname)&&(r.hostname=r.hostname.replace(/^www\./,""))),Array.isArray(t.removeQueryParameters))for(let s of[...r.searchParams.keys()])J9(s,t.removeQueryParameters)&&r.searchParams.delete(s);if(t.removeQueryParameters===!0&&(r.search=""),t.sortQueryParameters){r.searchParams.sort();try{r.search=decodeURIComponent(r.search)}catch{}}t.removeTrailingSlash&&(r.pathname=r.pathname.replace(/\/$/,""));let n=e;return e=r.toString(),!t.removeSingleSlash&&r.pathname==="/"&&!n.endsWith("/")&&r.hash===""&&(e=e.replace(/\/$/,"")),(t.removeTrailingSlash||r.pathname==="/")&&r.hash===""&&t.removeSingleSlash&&(e=e.replace(/\/$/,"")),i&&!t.normalizeProtocol&&(e=e.replace(/^http:\/\//,"//")),t.stripProtocol&&(e=e.replace(/^(?:https?:)?\/\//,"")),e}var fUe=class{constructor({url:e,context:t},i,r,n){if(this.controlsManager=i,this.shared=r,this.condition=n,!e)throw new Error("Missing property");this.url=e.startsWith("mailto:")?e:dUe(e,{removeTrailingSlash:!1,removeSingleSlash:!1,stripWWW:!1}),this.context=t??"tab"}dispatch(){var e;if(Sr(this.shared,this.condition)===!1)return!1;zb?window.location.assign(this.url):(this.context==="tab"||J$&&this.context==="none"?window.open(this.url,"_blank"):this.context==="window"?window.open(this.url,"_blank",`width=${window.innerWidth}, height=${window.innerHeight}`):window.open(this.url,"_parent"),(e=this.controlsManager.orbitControls)==null||e.onPointerUp($t[0]),PCe())}},Nie=class{constructor(e,t,i,r,n){this.data=e,this.page=t,this.controlsManager=i,this.shared=r,this.condition=n,this.timeoutIdQueue=[],this.dispatchInner=()=>{this.objects.forEach(this.destroyCallback)},this.destroyCallback=s=>{var c,u;this.timeoutIdQueue.shift();let a=this.page.scene.find(s);if(a===void 0)return;let o=this.controlsManager.sharedGameControlGlobals.rapierWorld,l=o?(c=a.dataPatched.physics)==null?void 0:c.fusedBody:!0;if(a.cloner){for(let h of a.cloner.children)l?(h.playModeVisible=!1,h.rigidBody&&((u=a.dataPatched.physics)==null?void 0:u.rigidBody)==="positioned"&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(h.rigidBody.collider(0).handle),o.removeRigidBody(h.rigidBody),h.rigidBody=void 0),h.bvhGeometry&&(h.bvhGeometry=void 0)):this.clone===void 0||this.clone===h?(h.playModeVisible=!1,h.rigidBody&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(h.rigidBody.collider(0).handle),o.removeRigidBody(h.rigidBody),h.rigidBody=void 0)):h.playModeVisible===void 0&&(h.playModeVisible=!0);(l||this.clone===void 0||this.clone===!1)&&(a.visible=!1,a.rigidBody&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(a.rigidBody.collider(0).handle),o.removeRigidBody(a.rigidBody),a.rigidBody=void 0),a.bvhGeometry&&(a.bvhGeometry=void 0))}else a.rigidBody&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(a.rigidBody.collider(0).handle),o.removeRigidBody(a.rigidBody),a.rigidBody=void 0),a.bvhGeometry&&(a.bvhGeometry=void 0),a.visible=!1;o===void 0?this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim=this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.filter(h=>h.bvhGeometry!==void 0):this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim=this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.filter(h=>h.rigidBody!==void 0),a.destroyedInAction=!0,this.controlsManager.requestRender()},this.objects=[...e.objects]}dispatch(e){if(Sr(this.shared,this.condition)===!1)return!1;this.clone=e,this.data.delay?this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,this.data.delay*1e3)):this.dispatchInner()}dispatchFromStart(){if(Sr(this.shared,this.condition)===!1)return!1;this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,this.data.delay*1e3))}dispose(){this.timeoutIdQueue.forEach(e=>window.clearTimeout(e))}},kie=class{constructor(e,t,i,r,n){this.data=e,this.page=t,this.shared=i,this.eventManager=r,this.condition=n,this.shared=i}dispatch(){if(Sr(this.shared,this.condition)===!1)return!1;clearTimeout(this.timeoutId),delete this.timeoutId,this.timeoutId=window.setTimeout(()=>{var e;this.shared.reset(this.shared.data,!0),P4(this.page,this.shared,!0),this.eventManager.reset(),(e=this.eventManager.controlsManager.gameControl)==null||e.reset(!0),this.page.switchToPlayCamera(),this.eventManager.controlsManager.requestRender(),delete this.timeoutId},(this.data.delay??0)*1e3)}dispose(){clearTimeout(this.timeoutId),delete this.timeoutId}},Vie={update:null,begin:null,loopBegin:null,changeBegin:null,change:null,changeComplete:null,timelineChangeComplete:null,loopComplete:null,complete:null,loop:1,direction:"normal",autoplay:!0,timelineOffset:0,rewind:!0},x4={duration:1e3,delay:0,endDelay:0,startOnceDelay:0,pingPongDelayCorrection:0,pingPongEndDelayCorrection:0,easing:"easeOutElastic(1, .5)",round:0},pUe=["translateX","translateY","translateZ","rotate","rotateX","rotateY","rotateZ","scale","scaleX","scaleY","scaleZ","skew","skewX","skewY","perspective","matrix","matrix3d"],rT={CSS:{},springs:{}};function Jl(e,t,i){return Math.min(Math.max(e,t),i)}function Gx(e,t){return e.indexOf(t)>-1}function tI(e,t){return e.apply(null,t)}var ni={arr:function(e){return Array.isArray(e)},obj:function(e){return Gx(Object.prototype.toString.call(e),"Object")},pth:function(e){return ni.obj(e)&&e.hasOwnProperty("totalLength")},svg:function(e){return e instanceof SVGElement},inp:function(e){return e instanceof HTMLInputElement},dom:function(e){return!("isNode"in e)&&(e.nodeType||ni.svg(e))},str:function(e){return typeof e=="string"},fnc:function(e){return typeof e=="function"},und:function(e){return typeof e>"u"},hex:function(e){return/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(e)},rgb:function(e){return/^rgb/.test(e)},hsl:function(e){return/^hsl/.test(e)},col:function(e){return ni.hex(e)||ni.rgb(e)||ni.hsl(e)},key:function(e){return!Vie.hasOwnProperty(e)&&!x4.hasOwnProperty(e)&&e!=="targets"&&e!=="keyframes"}};function Gie(e){var t=/\(([^)]+)\)/.exec(e);return t?t[1].split(",").map(function(i){return parseFloat(i)}):[]}function Hie(e,t){var i=Gie(e),r=Jl(ni.und(i[0])?1:i[0],.1,100),n=Jl(ni.und(i[1])?100:i[1],.1,100),s=Jl(ni.und(i[2])?10:i[2],.1,100),a=Jl(ni.und(i[3])?0:i[3],.1,100),o=Math.sqrt(n/r),l=s/(2*Math.sqrt(n*r)),c=l<1?o*Math.sqrt(1-l*l):0,u=1,h=l<1?(l*o+-a)/c:-a+o;function d(p){var v=t?t*p/1e3:p;return l<1?v=Math.exp(-v*l*o)*(u*Math.cos(c*v)+h*Math.sin(c*v)):v=(u+h*v)*Math.exp(-v*o),p===0||p===1?p:1-v}function f(){var p=rT.springs[e];if(p)return p;for(var v=1/6,m=0,g=0;;)if(m+=v,d(m)===1){if(g++,g>=16)break}else g=0;var y=m*v*1e3;return rT.springs[e]=y,y}return t?d:f}function mUe(e){return e===void 0&&(e=10),function(t){return Math.ceil(Jl(t,1e-6,1)*e)*(1/e)}}var gUe=function(){var e=11,t=1/(e-1);function i(u,h){return 1-3*h+3*u}function r(u,h){return 3*h-6*u}function n(u){return 3*u}function s(u,h,d){return((i(h,d)*u+r(h,d))*u+n(h))*u}function a(u,h,d){return 3*i(h,d)*u*u+2*r(h,d)*u+n(h)}function o(u,h,d,f,p){var v,m,g=0;do m=h+(d-h)/2,v=s(m,f,p)-u,v>0?d=m:h=m;while(Math.abs(v)>1e-7&&++g<10);return m}function l(u,h,d,f){for(var p=0;p<4;++p){var v=a(h,d,f);if(v===0)return h;var m=s(h,d,f)-u;h-=m/v}return h}function c(u,h,d,f){if(!(0<=u&&u<=1&&0<=d&&d<=1))return;var p=new Float32Array(e);if(u!==h||d!==f)for(var v=0;v<e;++v)p[v]=s(v*t,u,d);function m(g){for(var y=0,x=1,_=e-1;x!==_&&p[x]<=g;++x)y+=t;--x;var M=(g-p[x])/(p[x+1]-p[x]),S=y+M*t,T=a(S,u,d);return T>=.001?l(g,S,u,d):T===0?S:o(g,y,y+t,u,d)}return function(g){return u===h&&d===f||g===0||g===1?g:s(m(g),h,f)}}return c}(),jie=function(){var e={linear:function(){return function(r){return r}}},t={Sine:function(){return function(r){return 1-Math.cos(r*Math.PI/2)}},Circ:function(){return function(r){return 1-Math.sqrt(1-r*r)}},Back:function(){return function(r){return r*r*(3*r-2)}},Bounce:function(){return function(r){for(var n,s=4;r<((n=Math.pow(2,--s))-1)/11;);return 1/Math.pow(4,3-s)-7.5625*Math.pow((n*3-2)/22-r,2)}},Elastic:function(r,n){r===void 0&&(r=1),n===void 0&&(n=.5);var s=Jl(r,1,10),a=Jl(n,.1,2);return function(o){return o===0||o===1?o:-s*Math.pow(2,10*(o-1))*Math.sin((o-1-a/(Math.PI*2)*Math.asin(1/s))*(Math.PI*2)/a)}}},i=["Quad","Cubic","Quart","Quint","Expo"];return i.forEach(function(r,n){t[r]=function(){return function(s){return Math.pow(s,n+2)}}}),Object.keys(t).forEach(function(r){var n=t[r];e["easeIn"+r]=n,e["easeOut"+r]=function(s,a){return function(o){return 1-n(s,a)(1-o)}},e["easeInOut"+r]=function(s,a){return function(o){return o<.5?n(s,a)(o*2)/2:1-n(s,a)(o*-2+2)/2}}}),e}();function w4(e,t){if(ni.fnc(e))return e;var i=e.split("(")[0],r=jie[i],n=Gie(e);switch(i){case"spring":return Hie(e,t);case"cubicBezier":return tI(gUe,n);case"steps":return tI(mUe,n);default:return tI(r,n)}}function Wie(e){try{var t=document.querySelectorAll(e);return t}catch{return}}function YC(e,t){for(var i=e.length,r=arguments.length>=2?arguments[1]:void 0,n=[],s=0;s<i;s++)if(s in e){var a=e[s];t.call(r,a,s,e)&&n.push(a)}return n}function QC(e){return e.reduce(function(t,i){return t.concat(ni.arr(i)?QC(i):i)},[])}function $9(e){return ni.arr(e)?e:(ni.str(e)&&(e=Wie(e)||e),e instanceof NodeList||e instanceof HTMLCollection?[].slice.call(e):[e])}function b4(e,t){return e.some(function(i){return i===t})}function _4(e){var t={};for(var i in e)t[i]=e[i];return t}function zB(e,t){var i=_4(e);for(var r in e)i[r]=t.hasOwnProperty(r)?t[r]:e[r];return i}function ZC(e,t){var i=_4(e);for(var r in t)i[r]=ni.und(e[r])?t[r]:e[r];return i}function vUe(e){var t=/rgb\((\d+,\s*[\d]+,\s*[\d]+)\)/g.exec(e);return t?"rgba("+t[1]+",1)":e}function yUe(e){var t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,i=e.replace(t,function(o,l,c,u){return l+l+c+c+u+u}),r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(i),n=parseInt(r[1],16),s=parseInt(r[2],16),a=parseInt(r[3],16);return"rgba("+n+","+s+","+a+",1)"}function xUe(e){var t=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(e)||/hsla\((\d+),\s*([\d.]+)%,\s*([\d.]+)%,\s*([\d.]+)\)/g.exec(e),i=parseInt(t[1],10)/360,r=parseInt(t[2],10)/100,n=parseInt(t[3],10)/100,s=t[4]||1;function a(d,f,p){return p<0&&(p+=1),p>1&&(p-=1),p<1/6?d+(f-d)*6*p:p<1/2?f:p<2/3?d+(f-d)*(2/3-p)*6:d}var o,l,c;if(r==0)o=l=c=n;else{var u=n<.5?n*(1+r):n+r-n*r,h=2*n-u;o=a(h,u,i+1/3),l=a(h,u,i),c=a(h,u,i-1/3)}return"rgba("+o*255+","+l*255+","+c*255+","+s+")"}function wUe(e){if(ni.rgb(e))return vUe(e);if(ni.hex(e))return yUe(e);if(ni.hsl(e))return xUe(e)}function xh(e){var t=/[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?(%|px|pt|em|rem|in|cm|mm|ex|ch|pc|vw|vh|vmin|vmax|deg|rad|turn)?$/.exec(e);if(t)return t[1]}function bUe(e){if(Gx(e,"translate")||e==="perspective")return"px";if(Gx(e,"rotate")||Gx(e,"skew"))return"deg"}function BB(e,t){return ni.fnc(e)?e(t.target,t.id,t.total):e}function Wc(e,t){return e.getAttribute(t)}function S4(e,t,i){var r=xh(t);if(b4([i,"deg","rad","turn"],r))return t;var n=rT.CSS[t+i];if(!ni.und(n))return n;var s=100,a=document.createElement(e.tagName),o=e.parentNode&&e.parentNode!==document?e.parentNode:document.body;o.appendChild(a),a.style.position="absolute",a.style.width=s+i;var l=s/a.offsetWidth;o.removeChild(a);var c=l*parseFloat(t);return rT.CSS[t+i]=c,c}function Xie(e,t,i){if(t in e.style){var r=t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),n=e.style[t]||getComputedStyle(e).getPropertyValue(r)||"0";return i?S4(e,n,i):n}}function M4(e,t){if(ni.dom(e)&&!ni.inp(e)&&(Wc(e,t)||ni.svg(e)&&e[t]))return"attribute";if(ni.dom(e)&&b4(pUe,t))return"transform";if(ni.dom(e)&&t!=="transform"&&Xie(e,t))return"css";if(e[t]!=null)return"object"}function qie(e){if(ni.dom(e)){for(var t=e.style.transform||"",i=/(\w+)\(([^)]*)\)/g,r=new Map,n;n=i.exec(t);)r.set(n[1],n[2]);return r}}function _Ue(e,t,i,r){var n=Gx(t,"scale")?1:0+bUe(t),s=qie(e).get(t)||n;return i&&(i.transforms.list.set(t,s),i.transforms.last=t),r?S4(e,s,r):s}function E4(e,t,i,r){switch(M4(e,t)){case"transform":return _Ue(e,t,r,i);case"css":return Xie(e,t,i);case"attribute":return Wc(e,t);default:return e[t]||0}}function A4(e,t){var i=/^(\*=|\+=|-=)/.exec(e);if(!i)return e;var r=xh(e)||0,n=parseFloat(t),s=parseFloat(e.replace(i[0],""));switch(i[0][0]){case"+":return n+s+r;case"-":return n-s+r;case"*":return n*s+r}}function Yie(e,t){if(ni.col(e))return wUe(e);if(/\s/g.test(e))return e;var i=xh(e),r=i?e.substr(0,e.length-i.length):e;return t?r+t:r}function T4(e,t){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function SUe(e){return Math.PI*2*Wc(e,"r")}function MUe(e){return Wc(e,"width")*2+Wc(e,"height")*2}function EUe(e){return T4({x:Wc(e,"x1"),y:Wc(e,"y1")},{x:Wc(e,"x2"),y:Wc(e,"y2")})}function Qie(e){for(var t=e.points,i=0,r,n=0;n<t.numberOfItems;n++){var s=t.getItem(n);n>0&&(i+=T4(r,s)),r=s}return i}function AUe(e){var t=e.points;return Qie(e)+T4(t.getItem(t.numberOfItems-1),t.getItem(0))}function Zie(e){if(e.getTotalLength)return e.getTotalLength();switch(e.tagName.toLowerCase()){case"circle":return SUe(e);case"rect":return MUe(e);case"line":return EUe(e);case"polyline":return Qie(e);case"polygon":return AUe(e)}}function TUe(e){var t=Zie(e);return e.setAttribute("stroke-dasharray",t),t}function CUe(e){for(var t=e.parentNode;ni.svg(t)&&ni.svg(t.parentNode);)t=t.parentNode;return t}function Kie(e,t){var i=t||{},r=i.el||CUe(e),n=r.getBoundingClientRect(),s=Wc(r,"viewBox"),a=n.width,o=n.height,l=i.viewBox||(s?s.split(" "):[0,0,a,o]);return{el:r,viewBox:l,x:l[0]/1,y:l[1]/1,w:a/l[2],h:o/l[3]}}function PUe(e,t){var i=ni.str(e)?Wie(e)[0]:e,r=t||100;return function(n){return{property:n,el:i,svg:Kie(i),totalLength:Zie(i)*(r/100)}}}function DUe(e,t){function i(o){o===void 0&&(o=0);var l=t+o>=1?t+o:0;return e.el.getPointAtLength(l)}var r=Kie(e.el,e.svg),n=i(),s=i(-1),a=i(1);switch(e.property){case"x":return(n.x-r.x)*r.w;case"y":return(n.y-r.y)*r.h;case"angle":return Math.atan2(a.y-s.y,a.x-s.x)*180/Math.PI}}function e7(e,t){var i=/[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?/g,r=Yie(ni.pth(e)?e.totalLength:e,t)+"";return{original:r,numbers:r.match(i)?r.match(i).map(Number):[0],strings:ni.str(e)||t?r.split(i):[]}}function Jie(e){var t=e?QC(ni.arr(e)?e.map($9):$9(e)):[];return YC(t,function(i,r,n){return n.indexOf(i)===r})}function $ie(e){var t=Jie(e);return t.map(function(i,r){return{target:i,id:r,total:t.length,transforms:{list:qie(i)}}})}function RUe(e,t){var i=_4(t);if(/^spring/.test(i.easing)&&(i.duration=Hie(i.easing)),ni.arr(e)){var r=e.length,n=r===2&&!ni.obj(e[0]);n?e={value:e}:ni.fnc(t.duration)||(i.duration=t.duration/r)}var s=ni.arr(e)?e:[e];return s.map(function(a,o){var l=ni.obj(a)&&!ni.pth(a)?a:{value:a};return ni.und(l.delay)&&(l.delay=o?0:t.delay),ni.und(l.endDelay)&&(l.endDelay=o===s.length-1?t.endDelay:0),l}).map(function(a){return ZC(a,i)})}function IUe(e){for(var t=YC(QC(e.map(function(s){return Object.keys(s)})),function(s){return ni.key(s)}).reduce(function(s,a){return s.indexOf(a)<0&&s.push(a),s},[]),i={},r=function(s){var a=t[s];i[a]=e.map(function(o){var l={};for(var c in o)ni.key(c)?c==a&&(l.value=o[c]):l[c]=o[c];return l})},n=0;n<t.length;n++)r(n);return i}function LUe(e,t){var i=[],r=t.keyframes;r&&(t=ZC(IUe(r),t));for(var n in t)ni.key(n)&&i.push({name:n,tweens:RUe(t[n],e)});return i}function OUe(e,t){var i={};for(var r in e){var n=BB(e[r],t);ni.arr(n)&&(n=n.map(function(s){return BB(s,t)}),n.length===1&&(n=n[0])),i[r]=n}return i.duration=parseFloat(i.duration),i.delay=parseFloat(i.delay),i}function zUe(e,t){var i;return e.tweens.map(function(r){var n=OUe(r,t),s=n.value,a=ni.arr(s)?s[1]:s,o=xh(a),l=E4(t.target,e.name,o,t),c=i?i.to.original:l,u=ni.arr(s)?s[0]:c,h=xh(u)||xh(l),d=o||h;return ni.und(a)&&(a=c),n.from=e7(u,d),n.to=e7(A4(a,u),d),n.start=i?i.end:0,n.end=n.start+n.delay+n.duration+n.endDelay,n.easing=w4(n.easing,n.duration),n.isPath=ni.pth(s),n.isColor=ni.col(n.from.original),n.isColor&&(n.round=1),i=n,n})}var ere={css:function(e,t,i){return e.style[t]=i},attribute:function(e,t,i){return e.setAttribute(t,i)},object:function(e,t,i){return e[t]=i},transform:function(e,t,i,r,n){if(r.list.set(t,i),t===r.last||n){var s="";r.list.forEach(function(a,o){s+=o+"("+a+") "}),e.style.transform=s}}};function tre(e,t){var i=$ie(e);i.forEach(function(r){for(var n in t){var s=BB(t[n],r),a=r.target,o=xh(s),l=E4(a,n,o,r),c=o||xh(l),u=A4(Yie(s,c),l),h=M4(a,n);ere[h](a,n,u,r.transforms,!0)}})}function BUe(e,t){var i=M4(e.target,t.name);if(i){var r=zUe(t,e),n=r[r.length-1];return{type:i,property:t.name,animatable:e,tweens:r,duration:n.end,delay:r[0].delay,endDelay:n.endDelay}}}function FUe(e,t){return YC(QC(e.map(function(i){return t.map(function(r){return BUe(i,r)})})),function(i){return!ni.und(i)})}function ire(e,t){var i=e.length,r=function(s){return s.timelineOffset?s.timelineOffset:0},n={};return n.duration=i?Math.max.apply(Math,e.map(function(s){let a=s.startOnceDelay??0,o=s.pingPongDelayCorrection??0,l=s.pingPongEndDelayCorrection??0;return r(s)+a+o+l+s.duration*(s.loop??1)})):t.duration,n.delay=i?Math.min.apply(Math,e.map(function(s){let a=s.startOnceDelay??0,o=s.pingPongDelayCorrection??0;return r(s)+a+o+s.delay})):t.delay,n.endDelay=i?n.duration-Math.max.apply(Math,e.map(function(s){let a=s.startOnceDelay??0,o=s.pingPongDelayCorrection??0,l=s.pingPongEndDelayCorrection??0;return r(s)+a+o+s.duration*(s.loop??1)-s.endDelay-l})):t.endDelay,n}var t7=0;function UUe(e){var t=zB(Vie,e),i=zB(x4,e),r=LUe(i,e),n=$ie(e.targets),s=FUe(n,r),a=ire(s,i),o=t7;return t7++,ZC(t,{id:o,children:[],animatables:n,animations:s,duration:a.duration,delay:a.delay,endDelay:a.endDelay,startOnceDelay:i.startOnceDelay,pingPongDelayCorrection:i.pingPongDelayCorrection,pingPongEndDelayCorrection:i.pingPongEndDelayCorrection})}var yl=[],i7=[],d2,NUe=function(){function e(){d2=requestAnimationFrame(t)}function t(i){var r=yl.length;if(r){for(var n=0;n<r;){var s=yl[n];s.paused?(yl.splice(n,1),r-=1):(s.tick(i),n++)}e()}else d2=cancelAnimationFrame(d2)}return e}();function kUe(e){document.hidden?(yl.forEach(function(t){return t.pause(e.timeStamp)}),i7=yl.slice(0),gn.running=yl=[]):i7.forEach(function(t){return t.play(e.timeStamp)})}typeof document<"u"&&document.addEventListener("visibilitychange",kUe);function gn(e){e===void 0&&(e={});var t=0,i=0,r=0,n,s,a=0,o=null;function l(S){var T=window.Promise&&new Promise(function(E){return o=E});return S.finished=T,T}var c=UUe(e);l(c);function u(){var S=c.direction;S!=="alternate"&&(c.direction=S!=="normal"?"normal":"reverse"),c.reversed=!c.reversed,s.forEach(function(T){(T.loop===1||T.loop%2===0)&&(T.reversed=c.reversed)})}function h(){c.direction="normal",c.reversed=!1,s.forEach(function(S){return S.reversed=!1})}function d(S){return c.reversed?c.duration-S:S}function f(){t=0,i=d(c.currentTime)*(1/gn.speed)}function p(S,T,E=!1){T&&(c.reversed?T.seek(T.duration*T.loop-(S-T.timelineOffset-T.pingPongDelayCorrection),E):T.seek(S-T.timelineOffset-T.startOnceDelay-T.pingPongDelayCorrection,E))}function v(S,T=!1){if(c.reversed)for(var E=a;E--;)p(S,s[E],T);else for(var C=0;C<a;C++)p(S,s[C],T)}function m(S){var ne,ce,pe,ge,we,le,ve,ie,Ce,Pe;var T=0,E=c.animations,C=E.length;for(c.direction!=="alternate"&&((ne=c.parent)==null?void 0:ne.direction)==="alternate"?((ce=c.parent)==null?void 0:ce.rewind)===!1&&c.reversePlayback===!0&&c.rewind===!1&&((pe=c.parent)!=null&&pe.reversed&&c.direction==="alternate"?S=c.duration-c.delay+c.endDelay-S:S=c.duration+c.delay-c.endDelay-S):_(!1,(ge=c.parent)==null?void 0:ge.rewind,c.rewind,(we=c.parent)==null?void 0:we.reversePlayback,c.reversePlayback)&&((le=c.parent)!=null&&le.reversed&&c.direction==="alternate"?S=c.duration-c.delay+c.endDelay-S:S=c.duration+c.delay-c.endDelay-S);T<C;){var A=E[T],D=A.animatable,R=A.tweens,L=R.length-1,O=R[L];L&&(O=YC(R,function(be){return S<be.end})[0]||O);let Ne;(ve=c.parent)!=null&&ve.reversed&&c.direction==="alternate"?Ne=Jl(S-O.start-O.endDelay,0,O.duration)/O.duration:Ne=Jl(S-O.start-O.delay,0,O.duration)/O.duration;for(var H=isNaN(Ne)?1:O.easing(Ne),j=O.to.strings,Y=O.round,z=[],V=O.to.numbers.length,U=void 0,k=0;k<V;k++){var X=void 0;let be,Le;c.direction!=="alternate"?((ie=c.parent)==null?void 0:ie.rewind)===!1&&c.reversePlayback===!0&&c.rewind===!1?(be=O.to.numbers[k],Le=O.from.numbers[k]||0):(Le=O.to.numbers[k],be=O.from.numbers[k]||0):_(!0,(Ce=c.parent)==null?void 0:Ce.rewind,c.rewind,(Pe=c.parent)==null?void 0:Pe.reversePlayback,c.reversePlayback)?(be=O.to.numbers[k],Le=O.from.numbers[k]||0):(Le=O.to.numbers[k],be=O.from.numbers[k]||0),O.isPath?X=DUe(O.value,H*Le):X=be+H*(Le-be),Y&&(O.isColor&&k>2||(X=Math.round(X*Y)/Y)),z.push(X)}var re=j.length;if(!re)U=z[0];else{U=j[0];for(var q=0;q<re;q++){j[q];var ee=j[q+1],$=z[q];isNaN($)||(ee?U+=$+ee:U+=$+" ")}}ere[A.type](D.target,A.property,U,D.transforms),A.currentValue=U,T++}}function g(S){c[S]&&!c.passThrough&&c[S](c)}function y(){c.remaining&&c.remaining!==!0&&c.remaining--}let x={0:!1,1:!0,2:!1,3:!0,4:!1,5:!1,6:!1,7:!1,8:!1,9:!0,10:!0,11:!1,12:!1,13:!1,14:!0,15:!0,16:!1,17:!0,18:!0,19:!1,20:!1,21:!1,22:!0,23:!0,24:!1,25:!0,26:!1,27:!0,28:!1,29:!1,30:!1,31:!1};function _(S,T,E,C,A){return x[S<<4|T<<3|E<<2|C<<1|A]}function M(S,T=!1){var R;var E=c.duration;let C=c.delay,A=E-c.endDelay;(R=c.parent)!=null&&R.reversed&&c.direction==="alternate"&&(C=c.endDelay,A=E-c.delay);var D=d(S);if(c.progress=Jl(D/E*100,0,100),T||(c.reversePlayback=D<c.currentTime),a&&v(D,T),!c.began&&c.currentTime>=0&&(c.began=!0,g("begin")),!c.loopBegan&&c.currentTime>0&&(c.loopBegan=!0,g("loopBegin")),(c.reversed||D>=0)&&D<=C&&c.currentTime!==0&&(m(0),g("change")),(D>=A&&c.currentTime!==E+c.pingPongDelayCorrection||!E)&&(m(E),g("change")),D>C&&D<A?(c.changeBegan||(c.changeBegan=!0,c.changeCompleted=!1,g("changeBegin")),m(D),g("change")):c.changeBegan?(c.changeCompleted=!0,c.changeBegan=!1,g("change"),a&&g("timelineChangeComplete")):c.began&&D>A&&g("changeComplete"),c.currentTime=Jl(D,0,E+c.pingPongDelayCorrection),c.began&&g("update"),S>=E)if(y(),!c.remaining)c.paused=!0,c.completed||(c.completed=!0,g("loopComplete"),g("complete"),!c.passThrough&&"Promise"in window&&(o(),l(c)));else{a?t+=c.duration/gn.speed:t+=c.duration;for(let L of s)L.setStartTime(0),L.remaining=L.loop;g("loopComplete"),c.loopBegan=!1,c.direction==="alternate"?u():a&&h()}}return c.reset=function(){var S=c.direction;c.passThrough=!1,c.currentTime=0,c.progress=0,c.paused=!0,c.began=!1,c.loopBegan=!1,c.changeBegan=!1,c.completed=!1,c.changeCompleted=!1,c.reversePlayback=!1,c.reversed=S==="reverse",c.remaining=c.loop,s=c.children,a=s.length;for(var T=a;T--;)c.children[T].reset();m(c.reversed?c.duration:0)},c.setStartTime=function(S){t=S},c.set=function(S,T){return tre(S,T),c},c.tick=function(S){r=S,t||(t=r),M((r+(i-t))*gn.speed)},c.seek=function(S,T=!1){M(S-t,T)},c.pause=function(S){c.paused=!0,a&&(n=S??performance.now())},c.play=function(S){!c.paused||(c.completed&&c.reset(),c.paused=!1,yl.push(c),a&&n!==void 0&&(t+=(S??performance.now())-n),d2||NUe())},c.reverse=function(){u(),c.completed=!c.reversed,f()},c.restart=function(){c.reset(),c.play()},c.reset(),c.autoplay&&c.play(),c}function r7(e,t){for(var i=t.length;i--;)b4(e,t[i].animatable.target)&&t.splice(i,1)}function VUe(e){for(var t=Jie(e),i=yl.length;i--;){var r=yl[i],n=r.animations,s=r.children;r7(t,n);for(var a=s.length;a--;){var o=s[a],l=o.animations;r7(t,l),!l.length&&!o.children.length&&s.splice(a,1)}!n.length&&!s.length&&r.pause()}}function GUe(e,t){t===void 0&&(t={});var i=t.direction||"normal",r=t.easing?w4(t.easing):null,n=t.grid,s=t.axis,a=t.from||0,o=a==="first",l=a==="center",c=a==="last",u=ni.arr(e),h=parseFloat(u?e[0]:e),d=u?parseFloat(e[1]):0,f=xh(u?e[1]:e)||0,p=t.start||0+(u?h:0),v=[],m=0;return function(g,y,x){if(o&&(a=0),l&&(a=(x-1)/2),c&&(a=x-1),!v.length){for(var _=0;_<x;_++){if(!n)v.push(Math.abs(a-_));else{var M=l?(n[0]-1)/2:a%n[0],S=l?(n[1]-1)/2:Math.floor(a/n[0]),T=_%n[0],E=Math.floor(_/n[0]),C=M-T,A=S-E,D=Math.sqrt(C*C+A*A);s==="x"&&(D=-C),s==="y"&&(D=-A),v.push(D)}m=Math.max.apply(Math,v)}r&&(v=v.map(function(L){return r(L/m)*m})),i==="reverse"&&(v=v.map(function(L){return s?L<0?L*-1:-L:Math.abs(m-L)}))}var R=u?(d-h)/m:h;return p+R*(Math.round(v[y]*100)/100)+f}}function HUe(e){e===void 0&&(e={});var t=gn(e);return t.duration=0,t.add=function(i,r){var n=yl.indexOf(t),s=t.children;n>-1&&yl.splice(n,1);function a(d){d.passThrough=!0}for(var o=0;o<s.length;o++)a(s[o]);var l=ZC(i,zB(x4,e));l.targets=l.targets||e.targets;var c=t.duration;l.autoplay=!1,l.timelineOffset=ni.und(r)?c:A4(r,c),a(t);var u=gn(l);a(u),s.push(u),u.parent=t;var h=ire(s,e);return t.delay=h.delay,t.endDelay=h.endDelay,t.duration=h.duration,u.loop===!0&&(t.duration=1/0),t.seek(0),t.reset(),t.autoplay&&t.play(),t},t}gn.version="3.2.0";gn.speed=1;gn.running=yl;gn.remove=VUe;gn.get=E4;gn.set=tre;gn.convertPx=S4;gn.path=PUe;gn.setDashoffset=TUe;gn.stagger=GUe;gn.timeline=HUe;gn.easing=w4;gn.penner=jie;gn.random=function(e,t){return Math.floor(Math.random()*(t-e+1))+e};var rre=gn,n7=new N,s7=new N,a7=new ri;function jUe(e,t,i,r){if(r===0)return i.copy(e);if(r===1)return i.copy(t);let n=e.w*t.w+e.x*t.x+e.y*t.y+e.z*t.z;if(n>=1)return i.copy(e);let s=1-n*n;if(s<=Number.EPSILON){let u=1-r;return i.w=u*e.w+r*t.w,i.x=u*e.x+r*t.x,i.y=u*e.y+r*t.y,i.z=u*e.z+r*t.z,i.normalize(),i}let a=Math.sqrt(s),o=Math.atan2(a,n),l=Math.sin((1-r)*o)/a,c=Math.sin(r*o)/a;return i.w=e.w*l+t.w*c,i.x=e.x*l+t.x*c,i.y=e.y*l+t.y*c,i.z=e.z*l+t.z*c,i}function Ps(e,t,i,r,n,s){let a=i[e]!==void 0?i[e]:void 0,o=r[e];if(o==null)return;let l=a!=null?typeof a=="string"?Number(n.getVariable(a)??0):a:t[e],c=typeof o=="string"?Number(n.getVariable(o)??0):o;if(l!==c)return{update:u=>{let h=Tt.lerp(l,c,u);s?t[e]=Math.trunc(h):t[e]=h},start:()=>{t[e]=l},end:()=>{t[e]=c}}}function C4(e,t,i,r,n,s){let a=i[e]?i[e]:void 0,o=r[e];if(!o)return;let l=t[e],c=[...a??l].map(h=>typeof h=="string"?Number(n.getVariable(h)??0):h),u=[...o].map(h=>typeof h=="string"?Number(n.getVariable(h)??0):h);if(!(c.length!==u.length||CN(c,u)))return{update:h=>{c.forEach((d,f)=>{let p=Tt.lerp(d,u[f],h);t[e][f]=s?Math.trunc(p):p})},start:()=>{Object.assign(t[e],c)},end:()=>{Object.assign(t[e],u)}}}function nT(e,t,i){return t.forEach((r,n)=>{e.setComponent(n,typeof r=="string"?Number(i.getVariable(r)??0):r)}),e}function o7(e,t,i,r,n){let s=i[e]?i[e]:void 0,a=r[e];if(!a)return;let o=t[e],l=s?nT(new N,s,n):o.clone(),c=nT(new N,a,n);if(!l.equals(c))return{update:u=>{o.lerpVectors(l,c,u)},start:()=>{o.copy(l)},end:()=>{o.copy(c)}}}function l7(e,t,i){return t.forEach((r,n)=>{e.setComponent(n,typeof r=="string"?Number(i.getVariable(r)??0):r)}),e}function sT(e,t,i,r,n){let s=i[e]?i[e]:void 0,a=r[e];if(!a)return;let o=t[e],l=!(o instanceof Me),c=o instanceof Me?o:new Me().fromArray(o),u=s?l7(new Me,s,n):c.clone(),h=l7(new Me,a,n);if(!u.equals(h))return{update:d=>{c.lerpVectors(u,h,d),l&&(t[e]=c.toArray())},start:()=>{c.copy(u),l&&(t[e]=c.toArray())},end:()=>{c.copy(h),l&&(t[e]=c.toArray())}}}function WUe(e,t,i,r){let n=i[e]?i[e]:void 0,s=r[e];if(!s)return;let a=t[e],o=n?new ft().fromArray(n):a.clone(),l=new N,c=new ri,u=new N;o.decompose(l,c,u);let h=new ft().fromArray(s),d=new N,f=new ri,p=new N;if(h.decompose(d,f,p),!o.equals(h))return{update:v=>{a7.slerpQuaternions(c,f,v),n7.lerpVectors(l,d,v),s7.lerpVectors(u,p,v),a.compose(n7,a7,s7)},start:()=>{a.compose(l,c,u)},end:()=>{a.compose(d,f,p)}}}function XUe(e,t,i,r,n){let s=i[e]?i[e]:void 0,a=r[e];if(!a)return;let o=t[e],l=s?typeof s=="string"?n.getColor(s).clone():new Yt().setRGB(s.r,s.g,s.b):o.clone(),c=typeof a=="string"?n.getColor(a).clone():new Yt().setRGB(a.r,a.g,a.b);if(l.equals(c))return;let u=o.clone();return{update:h=>{var d,f;u.lerpColors(l,c,h),(f=(d=t[e])==null?void 0:d.copy)==null||f.call(d,u)},start:()=>{u.copy(l)},end:()=>{u.copy(c)}}}function IM(e,t,i,r,n){let s=i[e]?i[e]:void 0,a=r[e];if(!a)return;let o=t[e],l=new Bs(o.r,o.g,o.b,o.a),c=s?typeof s=="string"?n.getColor(s).clone():new Bs(s.r,s.g,s.b,s.a):l.clone(),u=typeof a=="string"?n.getColor(a).clone():new Bs(a.r,a.g,a.b,a.a);if(!c.equals(u))return{update:h=>{l.lerpColors(c,u,h);let d=Tt.lerp(c.a,u.a,h);l.a=d,t[e]={r:l.r,g:l.g,b:l.b,a:l.a}},start:()=>{l.copy(c)},end:()=>{l.copy(u)}}}function Df(e,t,i,r,n){if(typeof t[e]=="number")return Ps(e,t,i??{},r,n);if(Array.isArray(t[e]))return C4(e,t,i??{},r,n)}function qUe(e,t,i,r){var o,l,c,u;let n=[],s=e.cameraType==="OrthographicCamera"?(o=t.orthographic)==null?void 0:o.zoom:(l=t.perspective)==null?void 0:l.zoom,a=e.cameraType==="OrthographicCamera"?(c=i.orthographic)==null?void 0:c.zoom:(u=i.perspective)==null?void 0:u.zoom;if(a!==void 0){let h=s??e.zoom,d=a;h!==d&&n.push({update:f=>{e.zoom=Tt.lerp(h,d,f),e.updateProjectionMatrix()},start:()=>{e.zoom=h,e.updateProjectionMatrix()},end:()=>{e.zoom=d,e.updateProjectionMatrix()}})}if(i.targetOffset!==void 0){let h=Ps("targetOffset",e,t,i,r);h&&n.push(h)}return n}function YUe(e,t,i,r){if(i.scaleBaked===void 0)return;let n=(t.scaleBaked??e.data.geometry.scaleBaked).map(o=>typeof o=="string"?Number(r.getVariable(o)??0):o),s=i.scaleBaked.map(o=>typeof o=="string"?Number(r.getVariable(o)??0):o);if(lm.isEqual(n,s))return;let a=[];return a.push({update:o=>{e.updateGeometryInteractions({scaleBaked:[Tt.lerp(n[0],s[0],o),Tt.lerp(n[1],s[1],o),Tt.lerp(n[2],s[2],o)]},r),e.invalidateDownstreamBooleanData(),e.refreshAttachedClonersInteractions()},start:()=>{e.updateGeometryInteractions({scaleBaked:n},r),e.invalidateDownstreamBooleanData(),e.refreshAttachedClonersInteractions()},end:()=>{e.updateGeometryInteractions({scaleBaked:s},r),e.invalidateDownstreamBooleanData(),e.refreshAttachedClonersInteractions()}}),a}function QUe(e,t,i,r){if(!i.extrusion)return;let n=e.extrusion,s=t.extrusion??{},a=i.extrusion,o=[];return zee.forEach(l=>{let c=Df(l,n,s,a,r);c&&o.push(c)}),o}function ZUe(e,t,i,r){let n=[];if(!("geometry"in i))return n;let s=e.geometry.userData.parameters,a="geometry"in t?t.geometry:{},o=i.geometry;if(e instanceof Qw){let l=YUe(e,a,o,r);l&&n.push(...l)}else{let l={};if(Object.assign(l,$c(s,oR),$c(a,oR)),oR.forEach(c=>{let u=Df(c,l,a,o,r);u&&n.push(u)}),e instanceof d4){Object.assign(l,{extrusion:{...s.extrusion}});let c=QUe(l,a,o,r);c&&n.push(...c)}n.length&&n.push({update:c=>{e.updateGeometryInteractions(l,r),e.updateGeometryGroupsIfNeeded(),e.refreshAttachedClonersInteractions()},start:c=>{e.updateGeometryInteractions(l,r),e.updateGeometryGroupsIfNeeded(),e.refreshAttachedClonersInteractions()},end:c=>{e.updateGeometryInteractions(l,r),e.updateGeometryGroupsIfNeeded(),e.refreshAttachedClonersInteractions()}})}return n}function KUe(e,t,i,r){let n=[];if(i.intensity!==void 0){let s=Ps("intensity",e,t,i,r);s&&n.push(s)}if(i.color!==void 0){let s=XUe("color",e,t,i,r);s&&n.push(s)}return n}function JUe(e,t,i,r){let n=[];if(Array.isArray(e.material)){if(!("materials"in i&&i.materials))return n;let s="materials"in t&&t.materials?t.materials:[],a=i.materials;e.material.forEach((o,l)=>{if(!a[l])return;let c=s[l]??{},u=a[l];typeof c=="string"||typeof u=="string"||n.push(...c7(o,c,u,r))})}else{if(!("material"in i&&i.material))return n;let s="material"in t&&t.material?t.material:{},a=i.material;if(typeof s=="string"||typeof a=="string")return n;n.push(...c7(e.material,s,a,r))}return n}function c7(e,t,i,r){var a;let n=[],s=qv(i,r)||!!t.layers&&qv(t,r);n.push(oNe(e,s));for(let o of e.layers){let l=(a=t.layers)==null?void 0:a.data(o.uuid),c=i.layers.data(o.uuid);if(!c||o.type!=="light"&&(!(o.visible??!0)||!(c.visible??!0)))continue;let u=o.getNames().filter(h=>!Iee.some(d=>h.includes(d)));for(let h of u)try{let d=o.getValue(h),f;if(h==="colors")f=sNe(o,l,c,h);else if(Array.isArray(d))h==="steps"&&(f=nNe(o,l,c,h));else if(typeof d=="number")f=$Ue(o,l,c,h,r);else{if(typeof d=="boolean")continue;d instanceof Me?f=eNe(o,l,c,h):d instanceof N?f=tNe(o,l,c,h,r):d instanceof Bs?f=rNe(o,l,c,h,r):d instanceof Yt?f=iNe(o,l,c,h,r):"isTexture"in d&&(f=aNe(o,l,c,h))}f&&(Array.isArray(f)?n.push(...f):n.push(f))}catch(d){console.error(`lerpMaterial: unexpected material layer for ${h}`,d)}}return n}function $Ue(e,t,i,r,n){if(!e.hasValue(r)||!(r in i))return;let s=t?t[r]:e.getValue(r),a=i[r],o=typeof s=="string"?Number(n.getVariable(s)??0):s,l=typeof a=="string"?Number(n.getVariable(a)??0):a;if(o!==l)return{update:c=>{e.setValue(r,Tt.lerp(o,l,c))},start:()=>{e.setValue(r,o)},end:()=>{e.setValue(r,l)}}}function eNe(e,t,i,r){if(!e.hasValue(r)||!(r in i))return;let n=e.getValue(r),s=t?new Me().fromArray(t[r]):n.clone(),a=new Me().fromArray(i[r]);if(!s.equals(a))return{update:o=>{n.lerpVectors(s,a,o)},start:()=>{n.copy(s)},end:()=>{n.copy(a)}}}function tNe(e,t,i,r,n){if(!e.hasValue(r)||!(r in i))return;let s=e.getValue(r),a=t?t[r]:void 0,o=i[r],l=a?nT(new N,a,n):s.clone(),c=nT(new N,o,n);if(!l.equals(c))return{update:u=>{s.lerpVectors(l,c,u)},start:()=>{s.copy(l)},end:()=>{s.copy(c)}}}function iNe(e,t,i,r,n){if(!e.hasValue(r)||!(r in i))return;let s=t?t[r]:void 0,a=i[r],o=e.getValue(r),l=s?typeof s=="string"?n.getColor(s).clone():new Yt().setRGB(s.r,s.g,s.b):o.clone(),c=typeof a=="string"?n.getColor(a).clone():new Yt().setRGB(a.r,a.g,a.b);if(l.equals(c))return;let u=o.clone();return{update:h=>{e.getValue(r)!==u&&e.setValue(r,u),u.lerpColors(l,c,h)},start:()=>{u.copy(l)},end:()=>{u.copy(c)}}}function rNe(e,t,i,r,n){if(!e.hasValue(r)||!(r in i))return;let s=t?t[r]:void 0,a=i[r],o=e.getValue(r),l=s?typeof s=="string"?n.getColor(s).clone():new Yt().setRGB(s.r,s.g,s.b):o.clone(),c=typeof a=="string"?n.getColor(a).clone():new Bs(a.r,a.g,a.b,a.a);if(l.equals(c))return;let u=o.clone();return{update:h=>{e.getValue(r)!==u&&e.setValue(r,u),u.lerpColors(l,c,h)},start:()=>{u.copy(l)},end:()=>{u.copy(c)}}}function nNe(e,t,i,r="steps"){if(!e.hasValue(r)||!(r in i))return;let n=[],s=e.getValue(r),a=t?t[r]:s,o=i[r];return CN(a,o)||n.push({update:l=>{let c=[...s];for(let u=0;u<s.length;++u){let h=a[u],d=o[u];c[u]=Tt.lerp(h,d,l)}e.setValue(r,c)},start:()=>{e.setValue(r,a)},end:()=>{e.setValue(r,o)}}),n.length?n:void 0}function sNe(e,t,i,r="colors"){if(!e.hasValue(r)||!(r in i))return;let n=[],s=e.getValue(r),a=t?t[r]:s.map(l=>l.toArray()),o=i[r];for(let l=0;l<s.length;++l){let c=[...a[l]],u=[...o[l]];DA.isEqual(c,u)||n.push({update:h=>{s[l].fromArray(DA.lerp(c,u,h))},start:()=>{s[l].fromArray(c)},end:()=>{s[l].fromArray(u)}})}return n.length?n:void 0}function aNe(e,t,i,r="texture"){var m,g;if(!e.hasValue(r)||!(r in i))return;let n=e.getNode("rotation"),s=((m=t==null?void 0:t[r])==null?void 0:m.rotation)??0,a=((g=i[r])==null?void 0:g.rotation)??0;if(n&&s!==a)return{update:y=>{n.value=Tt.lerp(s,a,y)*Tt.DEG2RAD},start:()=>{n.value=s*Tt.DEG2RAD},end:()=>{n.value=a*Tt.DEG2RAD}};let o=e.getNode("mat");if(!o)return;let l=t?t[r]:o,c=i[r],u=[...l.repeat],h=[...l.offset],d=[...c.repeat],f=[...c.offset],p=l.rotation??0,v=c.rotation??0;if(!dh.isEqual(u,d)||!dh.isEqual(h,f)||p!==v)return{update:y=>{o.repeat=dh.lerp(u,d,y),o.offset=dh.lerp(h,f,y),o.rotation=Tt.lerp(p,v,y),o.updateMatrix()},start:()=>{o.repeat=[...u],o.offset=[...h],o.rotation=p,o.updateMatrix()},end:()=>{o.repeat=[...d],o.offset=[...f],o.rotation=v,o.updateMatrix()}}}function oNe(e,t){return{update:()=>{e.transparent=t}}}var iI=new N,u7=new Wn;function lNe(e,t,i,r,n){var p,v,m,g,y,x;let s=[],a,o,l,c,u,h,d,f;if(e instanceof ys?(a=sT("position",e,t,i,n),a&&s.push(a),l=Ps("rotation",e,t,i,n),l&&s.push(l),c=sT("shear",e,t,i,n),c&&s.push(c)):(f={slide:((p=t.pathSnapping)==null?void 0:p.slide)??((v=e.updatedPathSnapping)==null?void 0:v.slide)??((m=e.dataPatched.pathSnapping)==null?void 0:m.slide)??0,offset:((g=t.pathSnapping)==null?void 0:g.offset)??((y=e.updatedPathSnapping)==null?void 0:y.offset)??((x=e.dataPatched.pathSnapping)==null?void 0:x.offset)??0},h=Ps("slide",f,t.pathSnapping??e.updatedPathSnapping??e.dataPatched.pathSnapping,i.pathSnapping??e.dataPatched.pathSnapping,n),h&&s.push(h),d=Ps("offset",f,t.pathSnapping??e.updatedPathSnapping??e.dataPatched.pathSnapping,i.pathSnapping??e.dataPatched.pathSnapping,n),d&&s.push(d),!h&&!d&&(a=o7("position",e,t,i,n),a&&s.push(a),o=o7("scale",e,t,i,n),o&&s.push(o),l=cNe(e,t,i,r,n),l&&s.push(l),u=WUe("hiddenMatrix",e,t,i),u&&s.push(u))),a||o||l||u||h||d){let _=e instanceof ys?()=>{e.updateWorldMatrix(!0,!1,!0),e.resetBBoxNeedsUpdate()}:()=>{var M;e.updateMatrix(),e.hasNonUniformScale&&(e.updateMatrixWorld(),e.updateMatrixWorldSVD()),(M=e.parent)!=null&&M.matrixWorldFusedFalse&&(e.matrixWorld.multiplyMatrices(e.parent.matrixWorldFusedFalse,e.matrix),e.matrixWorldNeedsUpdate=!1),ql(e)&&fh(e.parent)&&e.invalidateDownstreamBooleanData(!0),e.updatePathSnapping(Object.assign({},t.pathSnapping,f))};s.push({update:_,start:_,end:_})}return s}function cNe(e,t,i,r,n){var u;let s=t!=null&&t.rotation?t.rotation.map(h=>(typeof h=="string"?Number(n.getVariable(h)??0):h)*Tt.DEG2RAD):void 0,a=(u=i.rotation)==null?void 0:u.map(h=>(typeof h=="string"?Number(n.getVariable(h)??0):h)*Tt.DEG2RAD);if(!a)return;let o=s?new N().fromArray(s):new N().setFromEuler(e.rotation),l=new N().fromArray(a);if(o.equals(l))return;let c=iI.subVectors(l,o);if(r&&c.toArray().every(h=>Math.abs(h)<2*Math.PI)){let h=new ri().setFromEuler(u7.setFromVector3(o)),d=new ri().setFromEuler(u7.setFromVector3(l));return{update:f=>{jUe(h,d,e.quaternion,f)},start:()=>{e.rotation.setFromVector3(o)},end:()=>{e.rotation.setFromVector3(l)}}}else return{update:h=>{iI.lerpVectors(o,l,h),e.rotation.setFromVector3(iI)},start:()=>{e.rotation.setFromVector3(o)},end:()=>{e.rotation.setFromVector3(l)}}}function uNe(e,t,i,r){let n=[];if(!("cloner"in i)||!e.cloner)return n;let s=e.cloner,a="cloner"in t?t.cloner:{},o=i.cloner;Aee.forEach(f=>{let p;f==="count"?p=Ps("count",s.parameters,a,o,r,!0):p=Df(f,s.parameters,a??{},o,r),p&&n.push(p)});let l=hNe(s,a,o,r);l!=null&&l.length&&n.push(...l);let c=dNe(s,a,o,r);c!=null&&c.length&&n.push(...c);let u=fNe(s,a,o,r);u!=null&&u.length&&n.push(...u);let h=pNe(s,a,o,r);h!=null&&h.length&&n.push(...h);let d=mNe(s,a,o,r);return d!=null&&d.length&&n.push(...d),n.length&&n.push({update:()=>{s.update()}}),n}function hNe(e,t,i,r){if(e.parameters.type!=="radial")return;let n=t.radial,s=i.radial;if(!s)return;let a=e.parameters.radial,o=[];return Tee.forEach(l=>{let c=Df(l,a,n??{},s,r);c&&o.push(c)}),o}function dNe(e,t,i,r){if(e.parameters.type!=="linear")return;let n=t.linear,s=i.linear;if(!s)return;let a=[],o=e.parameters.linear;return Cee.forEach(l=>{let c=Df(l,o,n??{},s,r);c&&a.push(c)}),a}function fNe(e,t,i,r){if(e.parameters.type!=="grid")return;let n=t.grid,s=i.grid;if(!s)return;let a=[],o=e.parameters.grid;return Pee.forEach(l=>{let c;l==="count"?c=C4(l,o,n??{},s,r,!0):c=Df(l,o,n??{},s,r),c&&a.push(c)}),a}function pNe(e,t,i,r){if(e.parameters.type!=="toObject")return;let n=t.toObject,s=i.toObject;if(!s)return;let a=[],o=e.parameters.toObject;return Dee.forEach(l=>{let c;l==="count"?c=Ps(l,o,n??{},s,r,!0):c=Df(l,o,n??{},s,r),c&&a.push(c)}),a}function mNe(e,t,i,r){if(!e.parameters.randomness)return;let n=t.randomnessObject,s=i.randomnessObject;if(!s)return;let a=[],o=e.parameters.randomnessObject;return Ree.forEach(l=>{let c=Df(l,o,n??{},s,r);c&&a.push(c)}),a}function gNe(e,t){return{update:()=>{e instanceof ds&&(e.fill.enabled=t)}}}function vNe(e,t){return{update:()=>{e instanceof ds&&(e.stroke.enabled=t)}}}function yNe(e,t){return{update:()=>{e instanceof ds&&(e.dropShadow.enabled=t)}}}function xNe(e,t){return{update:()=>{e instanceof ds&&(e.innerShadow.enabled=t)}}}function wNe(e,t){return{update:()=>{e instanceof ds&&(e.backgroundBlur.enabled=t)}}}function bNe(e,t){return{update:()=>{e instanceof ds&&(e.layerBlur.enabled=t)}}}function _Ne(e,t,i,r,n){let s=[],a,o,l,c,u,h,d,f,p,v,m,g,y,x,_;if("width"in e&&(a=Ps("width",e,t,i,n),a&&s.push(a)),"height"in e&&(o=Ps("height",e,t,i,n),o&&s.push(o)),e instanceof ds||e instanceof tu){let M={...t.fill},S={...i.fill};M.enabled!==void 0&&M.enabled!==S.enabled&&(s.push(gNe(e,!0)),M.enabled||Object.assign(M,{enabled:!0,color:{...M.color,a:0}}),S.enabled||Object.assign(S,{enabled:!0,color:{...S.color,a:0}})),l=IM("color",e.fill,M,S,n),l&&s.push(l)}if(e instanceof ds){let M={...t.stroke},S={...i.stroke};(M.enabled||S.enabled)&&(s.push(vNe(e,!0)),M.enabled||Object.assign(M,{enabled:!0,color:{...M.color,a:0}}),S.enabled||Object.assign(S,{enabled:!0,color:{...S.color,a:0}})),c=IM("color",e.stroke,M,S,n),c&&s.push(c),u=Ps("thickness",e.stroke,M,S,n),u&&s.push(u)}if(e instanceof ds){let M={...t.dropShadow},S={...i.dropShadow};(M.enabled||S.enabled)&&(s.push(yNe(e,!0)),M.enabled||Object.assign(M,{enabled:!0,color:{...M.color,a:0}}),S.enabled||Object.assign(S,{enabled:!0,color:{...S.color,a:0}})),h=IM("color",e.dropShadow,M,S,n),h&&s.push(h),d=Ps("blurRadius",e.dropShadow,M,S,n),d&&s.push(d),p=Ps("spread",e.dropShadow,M,S,n),p&&s.push(p),f=sT("offset",e.dropShadow,M,S,n),f&&s.push(f)}if(e instanceof ds){let M={...t.innerShadow},S={...i.innerShadow};(M.enabled||S.enabled)&&(s.push(xNe(e,!0)),M.enabled||Object.assign(M,{enabled:!0,color:{...M.color,a:0}}),S.enabled||Object.assign(S,{enabled:!0,color:{...S.color,a:0}})),v=IM("color",e.innerShadow,M,S,n),v&&s.push(v),m=Ps("blurRadius",e.innerShadow,M,S,n),m&&s.push(m),y=Ps("spread",e.innerShadow,M,S,n),y&&s.push(y),g=sT("offset",e.innerShadow,M,S,n),g&&s.push(g)}if(e instanceof ds||e instanceof tu){let M={...t.backgroundBlur},S={...i.backgroundBlur};(M.enabled||S.enabled)&&(s.push(wNe(e,!0)),M.enabled||Object.assign(M,{enabled:!0,radius:0}),S.enabled||Object.assign(S,{enabled:!0,radius:0})),x=Ps("radius",e.backgroundBlur,M,S,n),x&&s.push(x)}if(e instanceof ds){let M={...t.layerBlur},S={...i.layerBlur};(M.enabled||S.enabled)&&(s.push(bNe(e,!0)),M.enabled||Object.assign(M,{enabled:!0,radius:0}),S.enabled||Object.assign(S,{enabled:!0,radius:0})),_=Ps("radius",e.layerBlur,M,S,n),_&&s.push(_)}if(e instanceof tu||e instanceof Gb){let M=C4("cornerRadius",e,t,i,n);M&&s.push(M)}return s}function h7(e,t,i,r,n){let s=[];return e.data.visible&&s.push(...lNe(e,t,i,n,r)),e instanceof ys?s.push(..._Ne(e,t,i,n,r)):(e.data.visible&&s.push(...uNe(e,t,i,r)),ql(e)?(e instanceof Rn&&e.data.visible&&s.push(...ZUe(e,t,i,r)),e.data.visible&&s.push(...JUe(e,t,i,r))):oOe(e)?e.data.visible&&s.push(...KUe(e,t,i,r)):aOe(e)&&s.push(...qUe(e,t,i,r))),s.length?{update:a=>{s.forEach(o=>o.update(a))},start:a=>{s.forEach(o=>{var l;return(l=o.start)==null?void 0:l.call(o,a)})},end:a=>{s.forEach(o=>{var l;return(l=o.end)==null?void 0:l.call(o,a)})}}:void 0}var d7=new N;function P4(e,t,i=!1){var s;let r=[],n=a=>{let o=a.data;delete a.states,a.currentState=null,a.reversibleToState=null,a.currentTransitionEvent=null;for(let l of o.states){let c={...l.data};a.states||(a.states={}),a.states[l.id]=Yp.patch(o,c)}p7(e.scene,a,null,t,o.events.find(l=>l.data.type==="Follow"||l.data.type==="LookAt")!==void 0),f7(e)};e.scene.traverse2D(n),e.traverseChildren(a=>{var u,h,d,f,p,v;if(i&&((u=a.rigidBody)==null||u.setTranslation(a.position0,!0),(h=a.rigidBody)==null||h.setRotation(a.rotation0,!0),(d=a.rigidBody)==null||d.setLinvel(d7,!0),(f=a.rigidBody)==null||f.setAngvel(d7,!0)),!Fi.is(a))return;let o=a.uuid,l=a.data;if(delete a.states,a.uuid===gy)return;let c=!1;r.some(m=>{var g;return(g=e.scene.find(o))==null?void 0:g.isDescendantOf(m)})?c=!0:((p=l.physics)==null?void 0:p.fusedBody)===!0&&l.physics.rigidBody==="dynamic"&&r.push(o),a.data=l,a.currentState=null,a.reversibleToState=null,a.currentTransitionEvent=null;for(let m of l.states){let g={...m.data};e.data.globalPhysics.usePhysics===!0&&l.physics&&(l.physics.rigidBody==="dynamic"||c)&&(m.data.position!==void 0&&delete g.position,m.data.rotation!==void 0&&delete g.rotation,m.data.hiddenMatrix!==void 0&&delete g.hiddenMatrix),a.states||(a.states={}),a.states[m.id]=Wp.patch(l,g)}p7(e.scene,a,null,t,l.events.find(m=>m.data.type==="Follow"||m.data.type==="LookAt")!==void 0),a instanceof ia&&a.frame&&(a.frame.traverse(m=>n(m)),(v=a.uiCanvas)==null||v.applySize())}),f7(e),e.frame&&(e.frame.traverse(a=>n(a)),(s=e.uiCanvas)==null||s.applySize())}function f7(e){e.traverseEntity(t=>{for(let i of t.data.events){let r=[];switch(i.data.type){case"Follow":case"MouseHover":case"Scroll":case"MouseDown":case"MouseUp":case"MousePress":case"KeyUp":case"KeyDown":case"KeyPress":case"Collision":r.push(...i.data.actions);break;case"GameControl":for(let n of Object.values(i.data.gameActions))r.push(...n);break;case"DragDrop":r.push(...i.data.dragDropActions.drag,...i.data.dragDropActions.drop);break;case"Conditional":r.push(...i.data.inActions,...i.data.outActions);break}for(let n of r)if(n.data.type==="Create"&&n.data.hideBase==="Yes"){let s=e.scene.find(n.data.object);s&&(s.visible=!1)}}})}function p7(e,t,i,r,n=!1){if(t instanceof Rn&&!(t instanceof Dm)&&t.removeInteractionGeometry(r),t instanceof ys?t.changeSelectedState(i,{shared:r},n):t.changeSelectedState(i,{scene:e,shared:r},n),t instanceof Rn&&t.updateGeometryGroupsIfNeeded(),t instanceof aa&&t.updateCameraState(t.dataPatched,{scene:e,shared:r}),!(t instanceof ys)){if(t.cloner)for(let s of t.cloner.children)s.playModeVisible=void 0;t.updateVisible()}}function nre(e){let t;if(e.easing===5){let{control1:i,control2:r}=e;t=`cubicBezier(
			${i[0]}, ${i[1]}, ${r[0]}, ${r[1]}
		)`}else if(e.easing===6){let{mass:i,stiffness:r,damping:n,velocity:s}=e;t=`spring( ${i}, ${r}, ${n}, ${s} )`}else{let i;switch(e.easing){case 0:i=Md.linear;break;case 1:i=Md.ease;break;case 2:i=Md.easeIn;break;case 3:i=Md.easeOut;break;case 4:i=Md.easeInOut;break;default:i=Md.linear}let[r,n,s,a]=i;t=`cubicBezier( ${r}, ${n}, ${s}, ${a} )`}return{duration:Math.max(e.duration,1e-4),easing:t}}function FB(e){let t={delay:0,loop:e.repeat===-1?!0:e.repeat+1};if(e.repeat===0)t.direction="normal",t.rewind=!1;else switch(e.direction){case"pingpong":t.direction="alternate",t.rewind=!1;break;case"pingpong-rewind":t.direction="alternate",t.rewind=!0;break;default:t.direction="normal",t.rewind=!1;break}switch(t.delay=0,t.endDelay=0,t.startOnceDelay=0,t.pingPongDelayCorrection=0,t.pingPongEndDelayCorrection=0,e.delayDirection){case"start-once":t.startOnceDelay=e.delay;break;case"start":t.delay=e.delay;break;case"end":t.endDelay=e.delay;break;case"start-end":case void 0:t.delay=e.delay,t.endDelay=e.delay;break}return t.direction==="alternate"&&(t.delay/=2,t.endDelay/=2,e.delayDirection==="start"?(t.pingPongDelayCorrection=t.delay,typeof t.loop=="number"&&t.loop%2===0&&(t.pingPongEndDelayCorrection=t.delay)):e.delayDirection==="end"?typeof t.loop=="number"&&t.loop%2!==0&&(t.pingPongEndDelayCorrection=t.endDelay):e.delayDirection==="start-end"&&(t.pingPongDelayCorrection=t.delay,t.pingPongEndDelayCorrection=t.endDelay)),t}var SNe={type:"beginState"},MNe={type:"completeState",isfromEntity:!1},m7=class{constructor(e,t,i,r,n,s){if(this.object=e,this.data=r,this.sharedAssets=n,this.allowSlerp=s,this.targets={t:0},this.firstLoop=!0,this._changeBegan=!1,this._changeCompleted=!0,this.onChange=()=>{this.callback&&(this.callback.update(this.targets.t),this.object.requestRender()),this.targets.t===0||this.targets.t===1?this._changeCompleted||(this._changeCompleted=!0,this._changeBegan=!1,this.onChangeComplete()):(this._changeCompleted&&(this._changeCompleted=!1),this._changeBegan||(this._changeBegan=!0,this.onChangeBegin()))},this.onChangeBegin=()=>{this.object.reversibleToState=this.to.id;let a=this.targets.t>.5?this.from.id:this.to.id;this.object.prevState!==this.object.currentState&&(this.object.prevState=this.object.currentState),this.object.currentState=a,this.object.dispatchEvent({type:"beginState",state:a}),this.object instanceof ys||this.object.traverseEntity(o=>{o!==this.object&&o instanceof aa&&o.dispatchEvent(SNe)})},this.onChangeComplete=()=>{this.firstLoop&&(this.onFirstLoop(),this.firstLoop=!1),this.object.reversibleToState=this.to.id;let a=this.targets.t<.5?this.from.id:this.to.id;this.object.prevState!==this.object.currentState&&(this.object.prevState=this.object.currentState),this.object.currentState=a,this.object.dispatchEvent({type:"completeState",state:a}),this.object instanceof ys||this.object.traverseEntity(o=>{o!==this.object&&o instanceof aa&&o.dispatchEvent(MNe)})},this.onFirstLoop=()=>{this.useCurrentState&&(this.callback=h7(this.object,this.from.data,this.to.data,this.sharedAssets,this.allowSlerp))},t===void 0){let a=f2(this.object,this.object.currentState===i?this.object.prevState:this.object.currentState);if(!a)throw new Error("Missing property");this.from=a}else{let a=f2(this.object,t);if(!a)throw new Error("Missing property");this.from=a}if(i===void 0)throw new Error("Missing property");{let a=f2(this.object,i);if(!a)throw new Error("Missing property");this.to=a}this.useCurrentState=t===void 0||i===void 0,this.params={targets:this.targets,t:1,autoplay:!1,...FB(r),...nre(r),change:this.onChange},this.callback=h7(this.object,t===void 0?{}:this.from.data,i===void 0?{}:this.to.data,this.sharedAssets,this.allowSlerp)}get changeBegan(){return this._changeBegan}get changeCompleted(){return this._changeCompleted}},sre=class extends Vs{constructor(e,t,i,r,n){var a;if(super(),this.eventType=e,this.data=t,this.page=i,this.shared=r,this.condition=n,this.toggleIsForward=!1,this.timelineNeedsRebuild=!1,this.hasPlayedOnce=!1,this.onTimelineChangeComplete=()=>{var o;this.data.tweens[0].data.direction!=="normal"&&(this.toggleIsForward=!this.toggleIsForward),this.timelineNeedsRebuild!==!1&&((o=this.timeline)==null||o.pause(),this.buildTimeline({isForward:this.toggleIsForward,needsRebuild:!1,isRebuild:!0}),this.timeline.play())},!t.object)throw new Error("Missing property");let s=this.page.scene.find(t.object)??((a=this.page.uiCanvas)==null?void 0:a.find(t.object))??this.page.scene.find2DInUIObjects(t.object);if(!s)throw new Error("Missing property");if(!s.states)throw new Error("Missing property");if(this.object=s,t.tweens.length<2)throw new Error("Missing property");this.tweens=Array(this.data.tweens.length-1),this.startOnceDelay=t.tweens[0].data.delayDirection==="start-once"?t.tweens[0].data.delay:0,this.init()}get playing(){var e;return((e=this.timeline)==null?void 0:e.paused)===!1}get changeBegan(){return this.tweens.some(e=>e.changeBegan)??!1}init(){this.initialCurrentState=f2(this.object,this.object.currentState).id,this.toggleIsForward=!1}get currentState(){return this.data.runMode==="Toggle"&&d8(this.eventType)?this.initialCurrentState:this.object.currentState}buildTimeline({isForward:e=!0,needsRebuild:t=!1,isRebuild:i=!1}={}){var r,n,s,a;try{let o=FB(this.data.tweens[0].data);i&&typeof o.loop=="number"&&o.loop--,(r=this.timeline)==null||r.pause(),this.timeline=rre.timeline({autoplay:!1,...o,...o.loop===!0||o.loop>1?{timelineChangeComplete:this.onTimelineChangeComplete}:{}});let l=this.tweens.findIndex(c=>c==null?void 0:c.changeBegan);if(t===!0&&(this.timelineNeedsRebuild=!0),e){let c=l===-1?0:l;for(let u=c;u<this.data.tweens.length-1;u++){let h=this.data.tweens[u],d=this.data.tweens[u+1],f;u===c&&(this.object.wasMovedByUser===!0||((n=this.object.previousAction)==null?void 0:n.changeBegan)===!0)?(f=void 0,this.object instanceof aa&&(this.object.wasMovedByUser=!1)):f=h.data.state===void 0?this.currentState:h.data.state;let p=new m7(this.object,f,d.data.state===void 0?this.currentState:d.data.state,d.data,this.shared,this.data.allowSlerp??!1);l!==-1&&u===c&&Object.assign(p.params,{startOnceDelay:0}),this.tweens[u]=p,this.timeline.add(p.params,this.timeline.duration+(u===c?o.delay:0))}this.timeline.duration+=o.endDelay}else{let c=l===-1?this.data.tweens.length-1:l+1;for(let u=c;u>0;u--){let h=this.data.tweens[u],d=this.data.tweens[u-1],f;u===c&&(this.object.wasMovedByUser===!0||((s=this.object.previousAction)==null?void 0:s.changeBegan)===!0)?(f=void 0,this.object instanceof aa&&(this.object.wasMovedByUser=!1)):f=h.data.state===void 0?this.currentState:h.data.state;let p=new m7(this.object,f,d.data.state===void 0?this.currentState:d.data.state,h.data,this.shared,this.data.allowSlerp??!1);l!==-1&&u===c&&Object.assign(p.params,{startOnceDelay:0}),this.tweens[u-1]=p,this.timeline.add(p.params,this.timeline.duration+(u===c?o.endDelay:0))}this.timeline.duration+=o.delay}}catch(o){o instanceof Error&&console.error(o.message)}((a=this.object.previousAction)==null?void 0:a.playing)===!0&&this.object.previousAction.pause(),this.object.previousAction=this}play(){if(Sr(this.shared,this.condition)===!1||d8(this.eventType)&&this.data.runMode==="Once"&&this.hasPlayedOnce||(this.hasPlayedOnce=!0,this.playing))return!1;clearTimeout(this.timeoutId);let e=FB(this.data.tweens[0].data).pingPongDelayCorrection;this.timeoutId=window.setTimeout(()=>{try{this.buildTimeline(),this.timeline.play()}catch(t){t instanceof Error&&console.error(t.message)}},this.startOnceDelay+e)}pause(){var e;(e=this.timeline)==null||e.pause(),clearTimeout(this.timeoutId),this.tweens=Array(this.data.tweens.length-1),delete this.timeoutId}stop(){this.pause();let e=this.data.tweens[0].data.state===void 0?this.initialCurrentState:this.data.tweens[0].data.state;this.object instanceof ys?this.object.changeSelectedState(e,{shared:this.shared}):this.object.changeSelectedState(e,{scene:this.page.scene,shared:this.shared}),this.object.currentState=e}seek(e){var t;if(Sr(this.shared,this.condition)===!1)return!1;this.timeline===void 0&&this.buildTimeline(),(t=this.timeline)==null||t.seek(e*this.timeline.duration,!0)}toggle(e){var t;if(Sr(this.shared,this.condition)===!1)return!1;clearTimeout(this.timeoutId),this.toggleIsForward=e??!this.toggleIsForward,this.playing?((t=this.timeline)==null||t.pause(),this.buildTimeline({isForward:this.toggleIsForward,needsRebuild:!0}),this.timeline.play()):this.timeoutId=window.setTimeout(()=>{var i;(i=this.timeline)==null||i.pause(),this.buildTimeline({isForward:this.toggleIsForward}),this.timeline.play()},this.startOnceDelay)}playFromCurrent(){this.toggle(!0)}reverseFromCurrent(){this.toggle(!1)}dispose(){this.pause()}};function f2(e,t){var n;let i,r;if(typeof t=="string"?(i=t,r=(n=e.states)==null?void 0:n[i]):t===null&&(i=null,r=e.data),!(i===void 0||r===void 0))return{id:i,data:r}}var ENe={type:"beginState"},g7={type:"completeState",isfromEntity:!1},v7={type:"requestRender"},are=class extends Vs{constructor(e,t,i,r){super(),this.data=e,this.page=t,this.shared=i,this.condition=r,this.toggleIsForward=!1,this.posStart=new N,this.posEnd=new N,this.qStart=new ri,this.qEnd=new ri,this.zoomStart=1,this.zoomEnd=1}init(){}get playing(){return this.animation&&this.animation.began&&!this.animation.completed}buildAnimation(e=!1){if(!this.data.animate)return;let t=this.page.scene.find(this.data.targetCamera);if(!t||!t.visible)throw new ReferenceError("Target camera not founded or not visible");let i={t:0};this.posStart.copy(this.page.activeCamera.position),this.qStart.copy(this.page.activeCamera.quaternion),this.zoomStart=this.page.activeCamera.zoom,this.animation=rre({targets:i,t:1,...nre(this.data),update:()=>{i.t===0&&(this.data.runMode==="Toggle"&&!this.toggleIsForward?this.fromCamera&&(this.posEnd.copy(this.fromCamera.position),this.qEnd.copy(this.fromCamera.quaternion),this.zoomEnd=this.fromCamera.zoom,this.switchCamera(this.fromCamera.uuid)):(this.posEnd.copy(t.position),this.qEnd.copy(t.quaternion),this.zoomEnd=t.zoom,this.fromCamera=this.page.activeCamera,this.switchCamera(t.uuid)),this.page.activeCamera.dispatchEvent(ENe));let r=this.page.activeCamera;r.position.lerpVectors(this.posStart,this.posEnd,i.t),r.quaternion.slerpQuaternions(this.qStart,this.qEnd,i.t),r.zoom=this.zoomStart+(this.zoomEnd-this.zoomStart)*i.t,r.wasMovedBySwitchCameraAction=!0,r.updateMatrix(),r.updateMatrixWorld(),r.updateProjectionMatrix(),r.dispatchEvent(v7),i.t===1&&r.dispatchEvent(g7)}})}switchCamera(e){let t=this.page.activeCamera,i=this.page.scene.find(e);if(!i||!i.visible)throw new ReferenceError("Target camera not founded or not visible");this.page.switchActiveCamera(i),t.dispatchEvent({type:"cameraChange",camera:i})}play(){if(Sr(this.shared,this.condition)===!1)return!1;if(!this.playing&&this.page.activeCamera.uuid!==this.data.targetCamera)try{clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout(()=>{var e;delete this.timeoutId,this.data.animate?(this.buildAnimation(),(e=this.animation)==null||e.play()):this.switchCamera(this.data.targetCamera)},this.data.delay*1e3)}catch{}}pause(){var e;(e=this.animation)==null||e.pause(),clearTimeout(this.timeoutId),delete this.timeoutId}toggle(e){var t,i;if(Sr(this.shared,this.condition)===!1)return!1;if(window.clearTimeout(this.timeoutId),delete this.timeoutId,e!==this.toggleIsForward)try{this.playing?((t=this.animation)==null||t.pause(),this.toggleIsForward=e??!this.toggleIsForward,this.buildAnimation(!0),(i=this.animation)==null||i.play()):this.timeoutId=window.setTimeout(()=>{var r,n;this.toggleIsForward=e??!this.toggleIsForward,this.data.animate?((r=this.animation)==null||r.pause(),this.buildAnimation(),(n=this.animation)==null||n.play()):(this.toggleIsForward?(this.fromCamera=this.page.activeCamera,this.switchCamera(this.data.targetCamera)):this.fromCamera&&this.switchCamera(this.fromCamera.uuid),this.page.activeCamera.dispatchEvent(g7),this.page.activeCamera.dispatchEvent(v7))},this.data.delay*1e3)}catch{}}playFromCurrent(){this.toggle(!0)}reverseFromCurrent(){this.toggle(!1)}dispose(){this.pause(),this.toggleIsForward=!1}};function ore(e){let t=e==null?void 0:e.tracks.filter(i=>i.ValueTypeName==="vector"||i.ValueTypeName==="quaternion").map(i=>i.times.length);if(t!=null&&t.length){let i=$Te(t);return i&&i>2?i:2}return 2}var lre=class extends Vs{constructor(e,t,i,r,n){var l,c,u;super(),this.data=e,this.page=t,this.animationControls=i,this.shared=r,this.condition=n,this.startOnceDelay=0,this.toggleIsForward=!1;let s=e.object,a=t.scene.find(e.object);a&&Array.isArray(a.identity)&&(s=a.identity[0]),this.data={...e,object:s};let o=this.animationControls.clipIdToAction[e.clipId+"/"+s];if(this.duration=((l=o==null?void 0:o.getClip())==null?void 0:l.duration)??1,this.data.crop2){let h=ore(o==null?void 0:o.getClip());this.leftFrameTime=this.data.crop2[0]/(h-1)*this.duration,this.rightFrameTime=this.data.crop2[1]/(h-1)*this.duration}else{let h=(u=(c=o==null?void 0:o.getClip())==null?void 0:c.tracks[0])==null?void 0:u.times.length;h&&h>1?(this.leftFrameTime=this.data.crop[0]/h*this.duration,this.rightFrameTime=this.data.crop[1]/h*this.duration):(this.leftFrameTime=0,this.rightFrameTime=this.duration)}this.startOnceDelay=e.delay}get playing(){var e;return((e=this.threeAnimAction)==null?void 0:e.isRunning())??!1}play(e=!1){if(Sr(this.shared,this.condition)===!1)return!1;window.clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout(()=>{var i;if(this.threeAnimAction=this.animationControls.play(this.data),!this.threeAnimAction)return;this.threeAnimAction.reset(),this.threeAnimAction.time=this.leftFrameTime,this.threeAnimAction._clip.start=this.leftFrameTime,this.threeAnimAction._clip.duration=this.rightFrameTime;let t=this.data.object;Object.entries(this.animationControls.clipIdToAction).forEach(([r,n])=>{let s=r.split("/")[1];this.threeAnimAction!==n&&s===t&&n.isRunning()&&(e?n.fadeOut(.2):n.stop())}),e&&((i=this.threeAnimAction)==null||i.fadeIn(.2))},this.startOnceDelay)}pause(){this.threeAnimAction&&(this.threeAnimAction.paused=!0),window.clearTimeout(this.timeoutId),delete this.timeoutId}stop(){var e;(e=this.threeAnimAction)==null||e.fadeOut(.2)}seek(e){this.threeAnimAction=this.animationControls.play(this.data),this.threeAnimAction&&(this.threeAnimAction.paused=!0,this.threeAnimAction.time=Tt.clamp(this.threeAnimAction.time+1/60*e,this.leftFrameTime,this.rightFrameTime-16e-5),this.animationControls.needsUpdate=!0,this.animationControls.requestRender())}toggle(e,t=!1){if(Sr(this.shared,this.condition)===!1)return!1;this.toggleIsForward=e??!this.toggleIsForward,this.threeAnimAction&&(this.threeAnimAction._loopCount=0),this.playing?this.threeAnimAction&&(this.threeAnimAction.timeScale=this.toggleIsForward?1:-1,this.toggleIsForward?(this.threeAnimAction._clip.start=this.leftFrameTime,this.threeAnimAction._clip.duration=this.rightFrameTime):(this.threeAnimAction._clip.start=this.rightFrameTime,this.threeAnimAction._clip.duration=this.leftFrameTime)):this.timeoutId=window.setTimeout(()=>{var i;if(this.threeAnimAction=this.animationControls.play(this.data),this.threeAnimAction){this.toggleIsForward?(this.threeAnimAction.time=this.leftFrameTime,this.threeAnimAction._clip.start=this.leftFrameTime,this.threeAnimAction._clip.duration=this.rightFrameTime):(this.threeAnimAction.time=this.rightFrameTime,this.threeAnimAction._clip.start=this.rightFrameTime,this.threeAnimAction._clip.duration=this.leftFrameTime),this.threeAnimAction.paused=!1,this.threeAnimAction.timeScale=this.toggleIsForward?1:-1;let r=this.data.clipId.split("/")[1];Object.entries(this.animationControls.clipIdToAction).forEach(([n,s])=>{let a=n.split("/")[1];this.threeAnimAction!==s&&a===r&&s.isRunning()&&(t?s.fadeOut(.2):s.stop())}),t&&((i=this.threeAnimAction)==null||i.fadeIn(.2))}},this.startOnceDelay)}playFromCurrent(){this.toggle(!0)}reverseFromCurrent(){this.toggle(!1)}dispose(){var t;let e=(t=this.animationControls.clipIdToAction[this.data.clipId+"/"+this.data.object])==null?void 0:t.getClip();e&&(e.duration=this.duration),this.pause()}},cre=class{constructor(e,t,i,r,n){this.data=e,this.page=t,this.eventManager=i,this.shared=r,this.condition=n,this.timeOutId=-1,this.scene=t.scene}dispatch(){if(Sr(this.shared,this.condition)===!1)return!1;this.data.target!==this.page.uuid&&(window.clearTimeout(this.timeOutId),this.timeOutId=window.setTimeout(()=>{this.play()},this.data.delay*1e3))}dispose(){window.clearTimeout(this.timeOutId)}play(){if(this.scene.children.every(t=>t.uuid!==this.data.target||t.data.uiScene))return;this.data.transition==="fade"&&this.data.duration>0&&this.eventManager.eventContext.renderer.renderFromSceneForSceneTransitionPass(this.scene,this.scene.activeCamera,this.data.duration*1e3),this.eventManager.deactivate(),this.eventManager.controlsManager.deactivate();let e=this.scene.activeCamera;this.scene.updatePage(this.data.target),this.scene.traverseVisibleEntity(t=>{t.type==="ParticleSystem"&&(t.sleep(),t.wakeUp(),t.data.autoPlay?t.start():t.stop())}),this.scene.activePage.switchToPlayCamera(),this.scene.activeCamera.copyViewPlaneSize(e),P4(this.scene.activePage,this.shared),this.eventManager.activate(),this.eventManager.controlsManager.activate(this.eventManager)}},ure=class{constructor(e,t,i,r){this.data=e,this.page=t,this.shared=i,this.condition=r,this.evaluatedCondition=!1}checkConditions(){this.evaluatedCondition=Sr(this.shared,this.condition)}dispatch(){if(this.evaluatedCondition===!1)return!1;let e=this.shared.getVariable(this.data.variableId),t=hte(this.data.expression,this.shared,Ls.typeOfVariable(e));t!==void 0&&this.shared.updateVariable(this.data.variableId,typeof t=="string"?{textValue:t}:t)}dispose(){}},hre=class{constructor(e,t,i,r){this.data=e,this.page=t,this.shared=i,this.condition=r,this.timeoutId=null}dispatchInner(){if(Sr(this.shared,this.condition)===!1)return!1;let e=this.shared.getDynamicVariablePlayState(this.data.variableId);if(this.data.mode==="PlayPause")this.shared.getDynamicVariableToggleIsForward(this.data.variableId)===void 0&&this.shared.setDynamicVariableToggleIsForward(this.data.variableId,!0),this.shared.setDynamicVariablePlayState(this.data.variableId,e==="Playing"?"Paused":"Playing");else if(this.data.mode==="Play"&&e!=="Playing")this.shared.getDynamicVariableToggleIsForward(this.data.variableId)===void 0&&this.shared.setDynamicVariableToggleIsForward(this.data.variableId,!0),this.shared.setDynamicVariablePlayState(this.data.variableId,"Playing");else if(this.data.mode==="Stop"&&e!=="Stopped")this.shared.setDynamicVariablePlayState(this.data.variableId,"Stopped");else if(this.data.mode==="Pause"&&e!=="Paused")this.shared.setDynamicVariablePlayState(this.data.variableId,"Paused");else if(this.data.mode==="Restart")this.shared.setDynamicVariablePlayState(this.data.variableId,"Restarted");else if(this.data.mode==="Toggle"){let t=this.shared.getDynamicVariableToggleIsForward(this.data.variableId);e==="Playing"?this.shared.setDynamicVariableToggleIsForward(this.data.variableId,t===void 0?!1:!t):(this.shared.setDynamicVariableToggleIsForward(this.data.variableId,!t),this.shared.setDynamicVariablePlayState(this.data.variableId,"Playing"))}}dispatch(){let e=this.data.delay,t=this.shared.getDynamicVariablePlayState(this.data.variableId);this.data.mode==="PlayPause"&&t==="Playing"&&(e=this.data.pauseDelay),e!==0?(this.timeoutId&&window.clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout(()=>{this.timeoutId=null,this.dispatchInner()},e)):this.dispatchInner()}dispose(){this.timeoutId&&window.clearTimeout(this.timeoutId)}},ANe=class{constructor(e,t,i,r){this.data=e,this.page=t,this.shared=i,this.condition=r}dispatch(){if(Sr(this.shared,this.condition)===!1)return!1;(this.data.target==="single"?this.data.variableId?[this.data.variableId]:[]:Object.keys(this.shared.getVariables())).forEach(e=>{var i;this.shared.getVariable(e);let t=(i=this.shared.data.variables.data(e))==null?void 0:i.value;t!==void 0&&this.shared.updateVariable(e,t),this.shared.enableLocalStorageForPersistentVariables&&localStorage.removeItem(mB(e))})}dispose(){}},TNe=class{constructor(e,t,i,r){this.data=e,this.page=t,this.shared=i,this.condition=r}dispatch(){var e;if(Sr(this.shared,this.condition)===!1)return!1;this.data.userAPIId&&((e=this.shared.getUserAPI(this.data.userAPIId))==null||e.callUserAPI(this.shared))}dispose(){}};function Sr(e,t){if(t===void 0)return!0;if(t.expression.length===0)return!1;let i=hte(t.expression,e,"boolean");return t.negate?!i:!!i}function zn(e,t,i,r,n,s){let a={Audio:[],Video:[],Particles:[],Link:[],Destroy:[],Create:[],Reset:[],Transition:[],SwitchCamera:[],Animation:[],SceneTransition:[],SetVariable:[],DynamicVariablePlay:[],ClearLocalStorage:[],UserAPI:[]},o=l=>({id:c,data:u})=>{try{u.type==="Audio"?Qs[e.type].includes("Audio")&&a.Audio.push(new Fie(c,u,s,r,l)):u.type==="Video"&&!(s instanceof ys)?Qs[e.type].includes("Video")&&a.Video.push(new fre(c,u,s,r,l)):u.type==="Particles"?Qs[e.type].includes("Particles")&&a.Particles.push(new Uie(u,i,r,l)):u.type==="Link"?Qs[e.type].includes("Link")&&a.Link.push(new fUe(u,n.controlsManager,r,l)):u.type==="Create"?Qs[e.type].includes("Create")&&a.Create.push(new pre(u,i,n.controlsManager,r,l)):u.type==="Destroy"?Qs[e.type].includes("Destroy")&&a.Destroy.push(new Nie(u,i,n.controlsManager,r,l)):u.type==="Reset"?Qs[e.type].includes("Reset")&&a.Reset.push(new kie(u,i,r,n,l)):u.type==="Transition"?Qs[e.type].includes("Transition")&&a.Transition.push(new sre(e.type,u,i,r,l)):u.type==="SwitchCamera"?Qs[e.type].includes("SwitchCamera")&&a.SwitchCamera.push(new are(u,i,r,l)):u.type==="SceneTransition"?Qs[e.type].includes("SceneTransition")&&a.SceneTransition.push(new cre(u,i,n,r,l)):u.type==="Animation"?Qs[e.type].includes("Animation")&&a.Animation.push(new lre(u,i,n.animationControls,r,l)):u.type==="SetVariable"?Qs[e.type].includes("SetVariable")&&a.SetVariable.push(new ure(u,i,r,l)):u.type==="DynamicVariablePlay"?Qs[e.type].includes("DynamicVariablePlay")&&a.DynamicVariablePlay.push(new hre(u,i,r,l)):u.type==="Conditional"?Qs[e.type].includes("Conditional")&&(u.ifActions.forEach(o({expression:u.condition,negate:!1})),u.elseActions.forEach(o({expression:u.condition,negate:!0}))):u.type==="ClearLocalStorage"?Qs[e.type].includes("ClearLocalStorage")&&a.ClearLocalStorage.push(new ANe(u,i,r,l)):u.type==="UserAPI"&&Qs[e.type].includes("UserAPI")&&a.UserAPI.push(new TNe(u,i,r,l))}catch{}};return t.forEach(o()),a}function gs(e){Object.values(e).forEach(t=>{t.forEach(i=>{(i instanceof Fie||i instanceof fre||i instanceof Uie||i instanceof lre||i instanceof sre||i instanceof pre||i instanceof Nie||i instanceof are||i instanceof cre||i instanceof kie||i instanceof ure||i instanceof hre)&&i.dispose()})})}function CNe(e,t){let i;if("material"in e){let r=e.material;Array.isArray(r)?i=e.material[0].layers.find(n=>n.uuid===t):i=e.material.layers.find(n=>n.uuid===t)}if(i)return i.color.texture.image.img instanceof HTMLVideoElement?i.color.texture.image.img:void 0}var dre=new Map,Hx=new Map,x0=class{constructor(e,t,i){this.data=t,this.delay=0,this.status="stopped";let{layerId:r,loop:n,volume:s,delay:a}=t;if(this.object=i,r===void 0)throw new Error("Missing property");let o=CNe(i,r);o&&(this.videoElement=o,this.videoElement.loop=n===1/0,zb&&(this.videoElement.autoplay=!0),s!==void 0&&(this.videoElement.volume=s)),a!==void 0&&(this.delay=a),Hx.has(i.uuid)?Hx.get(i.uuid).push(this):Hx.set(i.uuid,[this]),dre.set(e,this),this.pause()}mute(){!this.videoElement||(this.videoElement.muted=!0)}unMute(){!this.videoElement||(this.videoElement.muted=!1)}play(e){if(!this.videoElement)return;let t=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);e?(this.mute(),this.delay+=150):t?(this.mute(),window.setTimeout(()=>{this.unMute()},100)):this.unMute(),this.delayTimerId=window.setTimeout(()=>{if(!this.videoElement)return;let i=this.videoElement.play();i!==void 0&&i.then(r=>{}).catch(r=>{this.play()}),this.clearDelay()},this.delay),this.status="playing"}clearDelay(){this.delayTimerId&&(clearTimeout(this.delayTimerId),delete this.delayTimerId)}pause(){!this.videoElement||(this.videoElement.pause(),this.status="paused")}stop(){!this.videoElement||(this.videoElement.pause(),this.videoElement.currentTime=0,this.status="stopped",this.clearDelay())}playByToggle(){this.data.toggle==="stop"?this.status==="playing"?this.stop():(this.stop(),this.play()):this.data.toggle==="pause"?this.status==="playing"?this.pause():this.play():(this.stop(),this.play())}dispose(){!this.videoElement||(this.stop(),this.videoElement.muted=!0)}},UB=class{constructor(e){this.data=e}dispatch(){this.data.playVideo?this.pauseVideo(this.data.playVideo):this.data.object?this.pauseAllVideosFromObject(this.data.object):this.pauseAllVideos()}pauseVideo(e){let t=dre.get(e);!t||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{t[this.data.interaction](),this.disposeDelay()},this.data.delay)):t[this.data.interaction]())}pauseAllVideosFromObject(e){let t=Hx.get(e);!(t!=null&&t.length)||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{t.forEach(i=>i[this.data.interaction]()),this.disposeDelay()},this.data.delay)):t.forEach(i=>i[this.data.interaction]()))}pauseAllVideos(){let e=[...Hx.values()];!e.length||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{e.forEach(t=>{t.forEach(i=>{i[this.data.interaction]()})}),this.disposeDelay()},this.data.delay)):e.forEach(t=>{t.forEach(i=>{i[this.data.interaction]()})}))}disposeDelay(){clearTimeout(this.timeoutId),delete this.timeoutId}dispose(){clearTimeout(this.timeoutId),delete this.timeoutId}},fre=class{constructor(e,t,i,r,n){if(this.data=t,this.shared=r,this.condition=n,t.interaction==="play")this.interaction=new x0(e,t,i);else if(t.interaction==="pause"||t.interaction==="stop")this.interaction=new UB(t);else throw new Error("Missing property")}dispatchBasic(){if(Sr(this.shared,this.condition)===!1)return!1;this.interaction instanceof x0?this.interaction.playByToggle():this.interaction.dispatch()}dispatchConditional(){if(Sr(this.shared,this.condition)===!1)return!1;this.interaction instanceof x0?this.interaction.play():this.interaction.dispatch()}dispose(){this.interaction.dispose()}},y7=(()=>{let e,t,i,r;function n(o){!e&&!x7()&&(t==null?void 0:t.sharedGameControlGlobals.createdObjects.length)>0&&(e=requestAnimationFrame(s)),o&&(t=o,r=o.requestRender)}function s(o){let l=i?o-i:0,c=t.sharedGameControlGlobals.createdObjects,u=t.sharedGameControlGlobals.nCreatedPerAction,h=c.length,d=0;for(;d<h;){let f=c[d];f.userData.createdTime===void 0&&(f.userData.createdTime=o),f.userData.lifetime===void 0&&f.userData.quantity===void 0||f.userData.lifetime&&o-f.userData.createdTime<f.userData.lifetime||f.userData.quantity&&u[f.userData.actionId]<=f.userData.quantity?(f.userData.velocity&&(f.position.addScaledVector(f.userData.velocity,l/1e3),f.updateMatrix(),r()),d++):(u[f.userData.actionId]>f.userData.quantity&&u[f.userData.actionId]--,c.splice(d,1),f.removeFromParent(),t.sharedGameControlGlobals.rapierWorld&&f.rigidBody?(t.sharedGameControlGlobals.colliderToEntity.delete(f.rigidBody.collider(0).handle),t.sharedGameControlGlobals.rapierWorld.removeRigidBody(f.rigidBody)):(f.bvhGeometry=void 0,t.sharedGameControlGlobals.entitiesWithTransformAnim=t.sharedGameControlGlobals.entitiesWithTransformAnim.filter(p=>p.bvhGeometry!==void 0)),h--,r())}e=d>0?requestAnimationFrame(s):void 0,i=d>0?o:void 0}function a(){x7()?e&&(cancelAnimationFrame(e),e=void 0,i=void 0):n()}return typeof document<"u"&&document.addEventListener("visibilitychange",a),n})();function x7(){return!!document&&document.hidden}var w7=new ri,PNe=new N,DNe=new N,pre=class{constructor(e,t,i,r,n){this.data=e,this.page=t,this.controlsManager=i,this.shared=r,this.condition=n,this.intervalId=null,this.timeoutIdQueue=[],this.uniqueId=Tt.generateUUID(),this.dispatch=()=>{if(Sr(this.shared,this.condition)===!1)return!1;this.data.delay?this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,this.data.delay*1e3)):this.dispatchInner()},this.dispatchFromStart=()=>{if(Sr(this.shared,this.condition)===!1)return!1;this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,this.data.delay*1e3))},this.dispatchThrottled=vCe(this.dispatch,1e3/this.data.creationSpeed),this.dispatchStart=()=>{this.intervalId===null&&(this.intervalId=window.setInterval(this.dispatch,1e3/this.data.creationSpeed))},this.dispatchStop=()=>{this.intervalId!==null&&(window.clearInterval(this.intervalId),this.intervalId=null)},this.dispatchInner=()=>{this.timeoutIdQueue.shift();let a=new Os(this.object);if(a.playModeVisible=!0,a.expand(),this.data.coordinateSystem!=="world"){let l=this.data.coordinateSystem,c=this.page.scene.find(l);c&&(c.updateMatrixWorldSVD(),a.hiddenMatrix.copy(c.matrixWorldRigid))}a.scale.copy(this.object.scale),a.position.fromArray(this.data.position),a.rotation.fromArray(this.data.rotation),a.updateMatrix(),this.page.add(a);let o=this.controlsManager.sharedGameControlGlobals;o.createdObjects.push(a),o.nCreatedPerAction[this.uniqueId]===void 0?o.nCreatedPerAction[this.uniqueId]=1:o.nCreatedPerAction[this.uniqueId]++,a.updateWorldMatrix(!0,!0),a.traverseObject(this.traverseObjectCB),y7(),this.controlsManager.requestRender()},this.traverseObjectCB=a=>{var u,h,d,f;a.hasNonUniformScale&&a.updateMatrixWorldSVD();let o;if(this.controlsManager.sharedGameControlGlobals.rapierWorld){if(a instanceof fl)if(a.objectForSample){if(a.objectForSample.dataPatched.physics.fusedBody)return;o=a.object}else return a.object.dataPatched.physics.fusedBody===!0&&a.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(a instanceof Os)o=a.object;else if(o=a,(u=o.dataPatched.cloner)==null?void 0:u.hideBase)return!0}else{if(a instanceof fl)return;a instanceof Os?o=a.object:o=a}this.data.destroy==="Time"?a.userData.lifetime=this.data.lifetime*1e3:this.data.destroy==="Quantity"&&(a.userData.quantity=this.data.destroyAfterQuantity,a.userData.actionId=this.uniqueId);let l=new N().fromArray(this.data.velocity),c=o.dataPatched;if(!(c.physics.enabled==="visibility"?!c.visible:!c.physics.enabled)&&(this.controlsManager.sharedGameControlGlobals.rapierWorld?(this.controlsManager.addRigidBody(a,o,{fromCreate:!0,dynamic:this.data.dynamic}),this.data.destroy==="Collision"&&((h=a.rigidBody)==null||h.collider(0).setActiveEvents(1),a.userData.hasCollisionDestroy=!0),a.matrixWorld.decompose(PNe,w7,DNe),l.applyQuaternion(w7),this.data.velocity.some(p=>p!==0)&&this.data.dynamic&&((d=a.rigidBody)==null||d.setLinvel(l.divideScalar(this.controlsManager.pixelsPerMeter),!0))):("geometry"in a.object&&this.controlsManager.addBoundsTree(a),this.data.velocity.some(p=>p!==0)&&this.data.dynamic&&(a.userData.velocity=l)),((f=o.dataPatched.physics)==null?void 0:f.fusedBody)===!0))return!0};let s=this.page.scene.find(this.data.object);if(!s)throw new Error("Missing Property");if(this.object=s,this.data.coordinateSystem!=="world"&&!this.page.scene.find(this.data.coordinateSystem))throw new Error("Missing Property");y7(i)}dispose(){this.intervalId!==null&&(window.clearInterval(this.intervalId),this.intervalId=null),this.timeoutIdQueue.forEach(e=>window.clearTimeout(e)),this.dispatchThrottled.cancel(),this.page.remove(...this.controlsManager.sharedGameControlGlobals.createdObjects),this.controlsManager.sharedGameControlGlobals.createdObjects=[]}},mre=200,rI=.02,nI=.3,RNe=65;new N;var b7=new N,_7=new N,INe=new N,ba=new N,Wa=new N,ud=new N,sI=new ft,S7=new ft,LNe=new ft;new ft;var Ll=new ri,Du=new ri,Pc=new Wn(0,0,0,"YXZ"),ONe=new N(1,0,0),Ol=new N(0,1,0),zNe=new N(0,0,1),M7=new N(1,1,1);new uo;var BNe=1,FNe=.025,UNe=16e-6,E7=12,NNe=20,as=new vl,el=new vn,kNe={type:"requestRender"},VNe={type:"updateMatrix"},A7=Math.PI/6,NB=class extends Vs{constructor(e,t,i,r,n,s,a,o,l){var p;super(),this.object=e,this.domElement=t,this.data=i,this.gloabalPhysics=r,this.controlsManager=n,this.cameraFollow=s,this.camera=a,this.page=o,this.sharedAssets=l,this.enableDamping=!0,this.hiddenMatrix0=new ft,this.target0=new N,this.zoom0=1,this.rotForce=1,this.moveForce=1,this.pixelsPerMeter=mre,this.euler0=new Wn(0,0,0,"YXZ"),this.position0Cam=new N,this.quat0Cam=new ri,this.scale0Cam=new N,this.hiddenMatrix0Cam=new ft,this.threshEndTranslate=.01,this.threshEndRotate=1e-8,this.threshEndRotVel=.005,this.collider={type:"capsule",radius:40,segment:new vl(new N(0,-40,0),new N(0,40,0)),matrix:new ft,position:new N,rotation:new ri},this.euler=new Wn(0,0,0,"YXZ"),this.eulerDelta=new N,this.lastPosition=new N,this.lastCameraQuaternion=new ri,this.lastCameraPosition=new N,this.PI_2=Math.PI/2,this.prevMouse=new Me,this.velocityTarget=new N,this.velocity=new N,this.directionXZ=new N,this.rotVelocityStick=new N,this.rotVelocityTarget=new N,this.rotVelocity=new N,this.rotDirection=new N,this.nonColliderRotOffset=new ft,this.nonColliderPosOffset=new ft,this.firstPointerId=-1,this.rot=new N,this.path=[],this.movementState={moveNegZ:0,movePosZ:0,moveNegX:0,movePosX:0,moveNegY:0,movePosY:0,rotPosX:0,rotNegX:0,rotPosY:0,rotNegY:0,jump:0,run:0},this.vrEulerYOffset=0,this.onObject=!1,this.actionState={},this.keyAssignments=[["moveNegZ","W"],["moveNegX","A"],["movePosZ","S"],["movePosX","D"],["rotPosX","ArrowUp"],["rotPosY","ArrowLeft"],["rotNegX","ArrowDown"],["rotNegY","ArrowRight"],["jump"," "]],this.collisionEnabled=!0,this.offsetMatrix=new ft,this.objectToTarget=new N,this.objectToTarget0=new N,this.objectToCamXZ=new N,this.objectToCamXZ0=new N,this.targetToCamera=new N,this.targetToCamera0=new N,this.cameraPolarAxis0=new N,this.targetPos=new N,this.targetQuat=new ri,this.lerpFactorPos=new N().setScalar(.3),this.lerpFactorPosStart=.3,this.lerpFactorPosEnd=.3,this.lerpFactorRotStart=.3,this.lerpFactorRotEnd=.3,this.lerpFactorPosCamera=.3,this.lerpFactorRotCamera=.3,this.objXZQuat=new ri,this.objXZQuatInv=new ri,this.objXZRotMat=new ft,this.isFirstPerson=!1,this.didHit=!1,this.groundVelocity=new N,this.pushedVelocity=new N,this.groundYRotation=0,this.objectRealQuat=new ri,this.colliderWorldQuat=new ri,this.groundNormal=new N,this.groundTilt=new ri,this.groundTiltInv=new ri,this.lastHitObj=null,this.isFirstFrame=!0,this.rotationAccumWhenOrientWithCamera=0,this.navMeshPathDest=null,this.position=new N,this.quaternion=new ri,this.scale=new N,this.initialAction=!0,this.onPointerDown=v=>{var m;!(v.target===this.domElement||v.target instanceof HTMLElement&&v.target.tagName==="SPLINE-VIEWER"&&((m=v.target.shadowRoot)!=null&&m.contains(this.domElement)))||this.firstPointerId!==-1||(this.firstPointerId=v.pointerId,this.domElement.ownerDocument.addEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.addEventListener("pointerup",this.onPointerUp),this.rotBy!=="keys"&&!Do&&!Kj&&this.domElement.requestPointerLock(),this.prevMouse.set(v.clientX,v.clientY))},this.onPointerUp=v=>{this.firstPointerId=-1,this.domElement.ownerDocument.removeEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.removeEventListener("pointerup",this.onPointerUp),v.pointerType==="mouse"&&this.domElement.ownerDocument.exitPointerLock()},this.onPointerMove=v=>{if(v.pointerId!==this.firstPointerId)return;let m=v.clientX-this.prevMouse.x,g=v.clientY-this.prevMouse.y;this.prevMouse.set(v.clientX,v.clientY),v.pointerType==="mouse"&&this.rotBy!=="keys"&&(Kj&&TCe<15.5&&!Do?(this.eulerDelta.y=-m*this.mouseOrbitSensitivity,this.eulerDelta.x=-g*this.mouseOrbitSensitivity):(this.eulerDelta.y=-v.movementX*this.mouseOrbitSensitivity,this.eulerDelta.x=-v.movementY*this.mouseOrbitSensitivity)),v.pointerType!=="mouse"&&this.rotByTouch==="drag"&&(this.eulerDelta.y=-m*this.mouseOrbitSensitivity*5,this.eulerDelta.x=-g*this.mouseOrbitSensitivity*5),this.controlsManager.requestRender()},this.onPointerlockChange=v=>{this.domElement.ownerDocument.pointerLockElement===this.domElement?NB.isLocked=!0:NB.isLocked=!1},this.onPointerlockError=()=>{console.error("SPE.GameControls: Unable to use Pointer Lock API")},this.handleVisibilityChange=()=>{if(document!=null&&document.hidden)for(let v in this.movementState)this.movementState[v]=0},this.onKeyDown=v=>{!(v.target instanceof HTMLInputElement)&&(v.code==="ArrowLeft"||v.code==="ArrowUp"||v.code==="ArrowRight"||v.code==="ArrowDown"||v.code==="Space")&&v.preventDefault();for(let m of this.keyAssignments)if(v.key.toUpperCase()===m[1]||v.key===m[1]){this.movementState[m[0]]=1;break}this.controlsManager.requestRender()},this.onKeyUp=v=>{for(let m of this.keyAssignments)if(v.key.toUpperCase()===m[1]||v.key===m[1]||v.code.slice(3,v.code.length).toUpperCase()===m[1]){this.movementState[m[0]]=0;break}},this.copyVRGamePadValues=(v,m)=>{for(let g=2;g<4;g++){let y=v.axes[g];m===0?g===2?this.movementState.movePosX=y:this.movementState.movePosZ=y:(v.buttons[3].pressed?this.movementState.jump=1:this.movementState.jump=0,g===2?(Math.abs(this.movementState.rotPosY)<.3&&Math.abs(y)>=.3&&(this.vrEulerYOffset+=y<0?1:-1),this.movementState.rotPosY=y):this.moveMode==="fly"&&(this.movementState.moveNegY=y))}},this.sharedGameControlGlobals=n.sharedGameControlGlobals,e===a&&(this.isFirstPerson=!0),this.hiddenMatrix0.copy(this.object.hiddenMatrix),this.object.parent?this.object.hiddenMatrix.copy(this.object.parent.matrixWorld).invert():this.object.hiddenMatrix.identity(),this.object.matrix.copy(this.object.matrixWorld),this.object.matrix.decompose(this.position,this.quaternion,this.scale),this.euler0.setFromQuaternion(this.quaternion,"YXZ");let c=this.euler0.clone(),u=c.y;if(this.objectRealQuat.copy(this.quaternion),c.y=0,this.quaternion.setFromEuler(c),this.objXZQuat.copy(this.quaternion),this.objXZQuatInv.copy(this.objXZQuat).invert(),this.objXZRotMat.makeRotationFromQuaternion(this.quaternion),c.set(0,u,0),this.quaternion.setFromEuler(c),this.rot.setFromEuler(c),this.object.matrixAutoUpdate=!1,(this.isFirstPerson||this.cameraFollow===!0)&&(this.target0.copy(this.camera.getTarget()),this.zoom0=this.camera.zoom),this.cameraFollow===!0){this.position0Cam.copy(this.camera.position),this.quat0Cam.copy(this.camera.quaternion),this.scale0Cam.copy(this.camera.scale),this.hiddenMatrix0Cam.copy(this.camera.hiddenMatrix),this.camera.parent?(this.camera.hiddenMatrix.copy((p=this.camera)==null?void 0:p.parent.matrixWorld),this.camera.matrix.copy(this.camera.matrixWorld)):this.camera.hiddenMatrix.identity(),this.camera.matrix.copy(this.camera.matrixWorld),this.camera.matrix.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.camera.matrixAutoUpdate=!1,this.offsetMatrix.copy(this.object.matrix).invert().multiply(this.camera.matrix);let v=new N(0,0,-1).applyQuaternion(this.camera.quaternion),m=new N().subVectors(this.position,this.camera.position);this.objectToCamXZ.copy(m),this.objectToCamXZ.y=0,this.objectToCamXZ0.copy(this.objectToCamXZ);let g,y;Math.abs(v.y)<1e-6?(m.y=0,v.y=0,y=m.projectOnVector(v)):m.y/v.y>0?y=v.multiplyScalar(m.y/v.y):y=v.multiplyScalar(m.length()),this.targetToCamera0.copy(y).negate(),g=this.camera.position.clone().add(y),this.objectToTarget0.subVectors(g,this.position);let x=new Wn().setFromQuaternion(this.camera.quaternion,"YXZ");this.cameraPolarOffset=-x.x,x.x=0,x.z=0,x.y-=Math.PI/2,this.cameraPolarAxis0.set(0,0,-1).applyEuler(x)}if(this.object instanceof aa&&(this.object.matrixAutoUpdate=!1),this.euler.setFromQuaternion(this.quaternion,"YXZ"),this.rotByTouch=i.rotByTouch??"joystick",this.rotBy=i.rotBy??"keys",this.rotationMode=i.rotationMode??"normal",this.moveMode=i.moveMode??"walk",this.collisionEnabled=i.collisionEnabled,this.speedTranslate=(i.speedTranslate??250)*BNe,this.speedOrbit=(i.speedRotate??100)*FNe,this.mouseOrbitSensitivity=(i.speedRotate??100)*UNe,this.keyAssignments=i.keyAssignments.map(v=>{let m=[v[0],v[1]];return m[1]===""?m[1]="ArrowUp":m[1]===""?m[1]="ArrowLeft":m[1]===""?m[1]="ArrowDown":m[1]===""?m[1]="ArrowRight":m[1]===""?m[1]="Shift":m[1]===""?m[1]="Enter":m[1]==="Space"?m[1]=" ":m[1]===""?m[1]="Meta":m[1]==="Ctrl"?m[1]="Control":m[1]==="Esc"&&(m[1]="Escape"),m}),i.rotBy==="mouse"){let v;v=this.keyAssignments.findIndex(m=>m[0]==="rotNegX"),v!==-1&&(this.keyAssignments[v][1]=""),v=this.keyAssignments.findIndex(m=>m[0]==="rotPosX"),v!==-1&&(this.keyAssignments[v][1]=""),v=this.keyAssignments.findIndex(m=>m[0]==="rotPosY"),v!==-1&&(this.keyAssignments[v][1]=""),v=this.keyAssignments.findIndex(m=>m[0]==="rotNegY"),v!==-1&&(this.keyAssignments[v][1]="")}this.lerpFactorPosStart=1-.02**(1/((i.delayPos[0]??.3)*60)),this.lerpFactorPosEnd=1-.02**(1/((i.delayPos[1]??.3)*60)),this.lerpFactorPos.setScalar(this.lerpFactorPosStart),this.lerpFactorRotStart=1-.02**(1/((i.delayRot[0]??.3)*60)),this.lerpFactorRotEnd=1-.02**(1/((i.delayRot[1]??.3)*60)),this.lerpFactorPosCamera=1-.02**(1/((i.delayPosCamera??.3)*60)),this.lerpFactorRotCamera=1-.02**(1/((i.delayRotCamera??.3)*60)),this.gravity=(this.gloabalPhysics.gravity??V0.defaultData.gravity)*E7,this.usePhysics=this.gloabalPhysics.usePhysics??V0.defaultData.usePhysics,this.jumpPower=i.jumpPower*NNe,this.resetYPosition=this.position.y+Math.abs(i.resetYPosition)*(this.gravity>0?1:-1),this.alignToGround=i.alignToGround??!1,this.orientMode=i.autoOrientMove?i.orientMode:"none",this.orientWith=i.orientWith??kA.defaultDataThirdPerson.orientWith,this.slopeThresh=RNe*Math.PI/180,i.collider.type==="capsule"?(this.collider.radius=i.collider.radius,this.collider.segment.start.y=i.collider.height/2-i.collider.radius,this.collider.segment.end.y=-this.collider.segment.start.y,this.offset=i.collider.height*rI/this.pixelsPerMeter,this.stepThresh=i.collider.height*nI/this.pixelsPerMeter,this.colliderHeight=i.collider.height):i.collider.type==="sphere"?(this.collider.radius=i.collider.radius,this.collider.segment.start.y=0,this.collider.segment.end.y=0,this.offset=2*i.collider.radius*rI/this.pixelsPerMeter,this.stepThresh=2*i.collider.radius*nI/this.pixelsPerMeter,this.colliderHeight=i.collider.radius*2):(this.offset=i.collider.height*rI/this.pixelsPerMeter,this.stepThresh=i.collider.height*nI/this.pixelsPerMeter,this.colliderHeight=i.collider.height),this.collider.type=i.collider.type;let h=new N().fromArray(i.collider.position),d=new ri().setFromEuler(new Wn().fromArray([...i.collider.rotation,"XYZ"]));this.collider.position.copy(h).multiply(this.scale),this.collider.rotation.copy(d),this.collider.matrix.compose(h,d,M7),i.cameraXAxis!==void 0&&(this.cameraXAxis=i.cameraXAxis,this.cameraYAxis=i.cameraYAxis,this.minPolarAngle=i.cameraRotXLimits[0],this.maxPolarAngle=i.cameraRotXLimits[1],this.minAzimuthAngleRel=i.cameraRotYLimits[0],this.maxAzimuthAngleRel=i.cameraRotYLimits[1]),this.forwardDir=i.forwardDirection??"-z",this.isFirstPerson&&(this.forwardDir="-z"),this.runMultiplier=i.runMultiplier??2;let f=i.navmesh.destinationHelperRadius*2;if(f>0){let v=new kt;v.push({fi:0,data:{...cs.defaultData("light","phong"),alpha:0},id:"layer1"}),v.push({fi:0,data:{...cs.defaultData("color"),color:i.navmesh.destinationHelperColor,alpha:i.navmesh.destinationHelperColor.a},id:"layer2"});let m=new e4({layers:v},{scene:this.page.scene,shared:this.sharedAssets});this.navMeshPathDest=new yr(jee.create({parameters:{width:f,height:f/10,hollow:.7}}),m),this.navMeshPathDest.material.userData.opacity0=i.navmesh.destinationHelperColor.a}this.activate()}reset(e=!1){if(this.object.hiddenMatrix.copy(this.hiddenMatrix0),e){this.object.updateMatrix(),this.object.updateMatrixWorld(),this.object.matrix.copy(this.object.matrixWorld),this.object.matrix.decompose(this.position,this.quaternion,this.scale),this.object.parent?this.object.hiddenMatrix.copy(this.object.parent.matrixWorld).invert():this.object.hiddenMatrix.identity();let t=new Wn().setFromQuaternion(this.quaternion,"YXZ"),i=t.y;this.objectRealQuat.copy(this.quaternion),t.y=0,this.quaternion.setFromEuler(t),this.objXZQuat.copy(this.quaternion),this.objXZQuatInv.copy(this.objXZQuat).invert(),this.objXZRotMat.makeRotationFromQuaternion(this.quaternion),t.set(0,i,0),this.quaternion.setFromEuler(t),this.rot.setFromEuler(t),this.euler.setFromQuaternion(this.quaternion,"YXZ"),this.velocityTarget.set(0,0,0),this.velocity.set(0,0,0)}else this.object instanceof aa?this.object.matrixAutoUpdate=!0:this.object.updateMatrix();this.cameraFollow===!0&&(this.camera.quaternion.copy(this.quat0Cam),this.camera.position.copy(this.position0Cam),this.camera.scale.copy(this.scale0Cam),this.camera.hiddenMatrix.copy(this.hiddenMatrix0Cam),this.camera.matrixAutoUpdate=!0),this.controlsManager.requestRender()}activate(){this.instantiateActions(),this.domElement.ownerDocument.addEventListener("pointerdown",this.onPointerDown),this.domElement.ownerDocument.addEventListener("keydown",this.onKeyDown),this.domElement.ownerDocument.addEventListener("keyup",this.onKeyUp),this.domElement.ownerDocument.addEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.addEventListener("pointerlockerror",this.onPointerlockError),this.domElement.ownerDocument.addEventListener("visibilitychange",this.handleVisibilityChange)}deactivate(){this.disposeActions(),this.domElement.ownerDocument.removeEventListener("pointerdown",this.onPointerDown),this.domElement.ownerDocument.removeEventListener("keydown",this.onKeyDown),this.domElement.ownerDocument.removeEventListener("keyup",this.onKeyUp),this.domElement.ownerDocument.removeEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.removeEventListener("pointerlockerror",this.onPointerlockError),this.domElement.ownerDocument.removeEventListener("visibilitychange",this.handleVisibilityChange)}dispose(){var e;this.deactivate(),(e=this.navMeshPathDest)!=null&&e.parent&&this.page.remove(this.navMeshPathDest)}instantiateActions(){let e=this.data,t=this.sharedAssets;e.gameActions!==void 0&&(this.actions={},NA.list.forEach(i=>{this.actions[i]=zn({...e,disabled:!1,type:"GameControl"},e.gameActions[i],this.page,t,this.controlsManager.eventManager,this.object)})),this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.dispatchStopEvent("jump"),this.dispatchStartEvent("idle"),this.initialAction&&(this.initialAction=!1)}disposeActions(){this.initialAction=!1,this.dispatchStopEvent("idle"),this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.dispatchStopEvent("jump"),gs(this.actions.idle),gs(this.actions.move),gs(this.actions.run),gs(this.actions.jump)}dispatchStartEvent(e){this.actions[e]!==void 0&&(this.actionState[e]||(this.actionState[e]=!0,this.actions[e].Transition.forEach(t=>{t.play()}),this.actions[e].Animation.forEach(t=>{t.play(this.initialAction===!1)}),this.actions[e].Create.forEach(t=>{t.dispatchStart()}),this.actions[e].Audio.forEach(t=>{t.dispatchGameControl("start")}),this.actions[e].Particles.forEach(t=>{t.dispatchGameControl("start")})))}dispatchStopEvent(e){this.actions[e]!==void 0&&(!this.actionState[e]||(this.actionState[e]=!1,this.actions[e].Transition.forEach(t=>{t.stop(),t.object.currentState!==null&&t.object.changeSelectedState(null,{scene:this.page.scene,shared:this.sharedAssets})}),this.actions[e].Create.forEach(t=>{t.dispatchStop()}),this.actions[e].Audio.forEach(t=>{t.dispatchGameControl("stop")}),this.actions[e].Particles.forEach(t=>{t.dispatchGameControl("stop")})))}get colliderWorldPosition(){return ba.copy(this.collider.position).applyQuaternion(this.objectRealQuat).add(this.position)}update(e,t,i){var o,l,c,u,h,d,f,p,v;if(this.gravity<0?this.position.y<this.resetYPosition:this.position.y>this.resetYPosition)return this.reset(!0),!0;this.sharedGameControlGlobals.gamePads.forEach(this.copyVRGamePadValues);let r=(this.isFirstFrame?16.6:e)/1e3;this.isFirstFrame&&(this.isFirstFrame=!1);let n=r*60,s=!1;if(this.usePhysics&&this.collisionEnabled){let m=Wa.set(0,(this.velocity.y===0?this.pixelsPerMeter*Math.max(Math.abs(this.gravity)/(10*E7),1)*(this.gravity>0?1:-1):this.velocity.y)*r,0).divideScalar(this.pixelsPerMeter),g=this.sharedGameControlGlobals.rapierWorld.castShape(this.colliderWorldPosition.divideScalar(this.pixelsPerMeter),this.colliderWorldQuat,m,(o=this.object.rigidBody)==null?void 0:o.collider(0).shape,1,!1,16,void 0,void 0,this.object.rigidBody);if(g){this.onObject=!0,this.groundNormal.set(g.normal2.x,g.normal2.y,g.normal2.z).applyQuaternion(this.colliderWorldQuat).negate(),this.alignToGround&&this.groundTiltAdjustment(this.groundNormal),Math.acos(this.groundNormal.y)<this.slopeThresh&&(s=!0),((l=g.collider.parent())==null?void 0:l.bodyType())===0&&Math.acos(this.groundNormal.y)*(180/Math.PI)>45&&(this.onObject=!1);let y=g.collider.parent();this.groundYRotation=0,this.groundVelocity.set(0,0,0);for(let x of this.sharedGameControlGlobals.entitiesWithTransformAnim)if(x.rigidBody===y&&x.userData.isFollowingObj!==this.object.uuid){(x.hasNonUniformScale?x.matrixWorldRigid:x.matrixWorld).decompose(ba,Du,Wa),this.groundVelocity.subVectors(ba,x.prevT),this.object.getWorldPosition(Wa).add(this.collider.position).sub(ba),this.groundYRotation=Pc.setFromQuaternion(Du).y-x.prevR.y,ud.copy(Wa).applyAxisAngle(Ol,this.groundYRotation),this.groundVelocity.add(ud.sub(Wa)).divideScalar(r);break}}else this.onObject=!1}if(this.moveMode==="walk"&&this.collisionEnabled&&(this.movementState.jump===1&&this.onObject&&(this.velocityTarget.y=this.jumpPower,this.movementState.jump=0,this.dispatchStopEvent("idle"),this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.dispatchStopEvent("jump"),this.dispatchStartEvent("jump"),this.onObject=!1),this.onObject?this.velocityTarget.y/=2:this.velocityTarget.y+=this.gravity*n),this.moveMode==="fly"&&(this.velocityTarget.y=(this.movementState.movePosY-this.movementState.moveNegY)*this.speedTranslate),this.directionXZ.z=this.movementState.movePosZ-this.movementState.moveNegZ,this.directionXZ.x=this.movementState.movePosX-this.movementState.moveNegX,this.forwardDir==="+z"&&this.directionXZ.multiplyScalar(-1),this.directionXZ.manhattanLength()>0&&(this.path=[]),this.navMeshPathDest){let m=this.navMeshPathDest.material;if(this.moveMode==="walk"&&this.path.length>1){this.navMeshPathDest.position.copy(this.path[this.path.length-1]),this.navMeshPathDest.parent||this.page.add(this.navMeshPathDest);let g=ba.subVectors(this.path[1],this.position),y=Wa.subVectors(this.path[1],this.path[0]);g.dot(y)<0?this.path.shift():(this.directionXZ.x=y.x,this.directionXZ.z=y.z),m.opacity=m.userData.opacity0}else m.opacity-=.05*m.userData.opacity0,this.navMeshPathDest.material.opacity<=0&&this.navMeshPathDest.parent&&this.page.remove(this.navMeshPathDest)}this.directionXZ.normalize(),this.movementState.run?this.moveForce=this.runMultiplier:this.moveForce=1,this.velocityTarget.z=this.directionXZ.z*this.speedTranslate*this.moveForce,this.velocityTarget.x=this.directionXZ.x*this.speedTranslate*this.moveForce,(this.moveMode==="walk"?this.velocityTarget.x+this.velocityTarget.z===0:this.velocityTarget.manhattanLength()===0)?this.lerpFactorPos.setScalar(this.lerpFactorPosEnd):this.lerpFactorPos.setScalar(this.lerpFactorPosStart),this.moveMode==="walk"&&(this.lerpFactorPos.y=1),this.didHit===!1&&this.pushedVelocity.manhattanLength()===0||this.usePhysics===!1?(this.velocity.x+=(this.velocityTarget.x-this.velocity.x)*(1-(1-this.lerpFactorPos.x)**n),this.velocity.y+=(this.velocityTarget.y-this.velocity.y)*(1-(1-this.lerpFactorPos.y)**n),this.velocity.z+=(this.velocityTarget.z-this.velocity.z)*(1-(1-this.lerpFactorPos.z)**n)):this.velocity.copy(this.velocityTarget),(this.moveMode==="walk"?this.velocity.x**2+this.velocity.z**2<this.speedTranslate:this.velocity.lengthSq()<this.speedTranslate)?(this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.onObject&&(this.dispatchStopEvent("jump"),this.dispatchStartEvent("idle"))):(this.dispatchStopEvent("idle"),this.onObject&&(this.dispatchStopEvent("jump"),this.movementState.run?(this.dispatchStopEvent("move"),this.dispatchStartEvent("run")):(this.dispatchStopEvent("run"),this.dispatchStartEvent("move"))));let a=INe.copy(this.velocity);if(this.orientMode!=="none"&&this.isFirstPerson===!1){let m=Wa.copy(a);m.y=0,a.set(0,a.y,m.length()*(this.forwardDir==="+z"?1:-1))}if(this.directionXZ.manhattanLength()>0&&this.orientMode!=="none"&&this.isFirstPerson===!1)if(this.orientWith==="camera"&&this.path.length<=1){let m=ba;this.camera.getWorldDirection(m);let g=ud.copy(Ol).multiplyScalar(m.dot(Ol));m.sub(g);let y=Wa.copy(this.directionXZ);y.x*=-1,this.rot.y=m.angleTo(y)*(m.cross(y).y>0?-1:1)+this.rotationAccumWhenOrientWithCamera}else this.rot.y=(this.path.length>1?0:this.euler.y)+Math.atan2(-this.directionXZ.z,this.directionXZ.x)+Math.PI/2*(this.forwardDir==="+z"?1:-1);if(Pc.setFromVector3(this.rot),this.moveMode==="walk"&&(Pc.x=0),a.applyEuler(Pc),s&&(Du.setFromUnitVectors(Ol,this.groundNormal),a.applyQuaternion(Du)),i){let m=Pc.set(0,this.vrEulerYOffset*A7,0);i.applyEuler(m),a.x+=i.x,a.z+=i.z,this.nonColliderPosOffset.elements[13]+=i.y*r}if(this.usePhysics===!0){let m=Wa;this.pushedVelocity.set(0,0,0);for(let g of this.sharedGameControlGlobals.entitiesWithTransformAnim){let y=ud.setFromMatrixPosition(g.matrixWorld).sub(g.prevT).divideScalar(r).divideScalar(this.pixelsPerMeter),x=g.rigidBody.collider(0).castCollider(y,this.object.rigidBody.collider(0),ba.copy(a).divideScalar(this.pixelsPerMeter),r,!1);y.multiplyScalar(this.pixelsPerMeter);let _=Fi.is(g)?g:g.object;if(x!==null&&this.lastHitObj!==_){let M;g instanceof Os&&(M=g);let S=this.sharedGameControlGlobals.entityToCollisionEvents[_.uuid];if(S)for(let T of S)T.data.target==="character"&&(T.dispatch(M),_.dispatchEvent(VB));this.lastHitObj=_}if(x!==null){this.pushedVelocity.copy(y),m.copy(x.normal1).applyQuaternion(g.quaternion);break}}if(this.pushedVelocity.manhattanLength()!==0){let g=m.dot(a);g<0&&a.addScaledVector(m,-g),a.add(this.pushedVelocity)}else a.add(this.groundVelocity)}if(this.rotDirection.y=Number(this.movementState.rotPosY)-Number(this.movementState.rotNegY),this.rotDirection.x=Number(this.movementState.rotPosX)-Number(this.movementState.rotNegX),this.rotDirection.normalize(),this.rotationMode==="normal"&&(this.movementState.rotPosX||this.movementState.rotNegX)||this.rotationMode==="steer"&&(this.movementState.rotPosX||this.movementState.rotNegX)&&(this.movementState.movePosZ||this.movementState.moveNegZ||this.moveMode==="walk")?this.rotVelocityStick.x=-this.rotDirection.x*this.speedOrbit*this.rotForce:this.rotVelocityStick.x=0,this.rotationMode==="normal"&&(this.movementState.rotPosY||this.movementState.rotNegY)||this.rotationMode==="steer"&&(this.movementState.rotPosY||this.movementState.rotNegY)&&(this.movementState.movePosZ||this.movementState.moveNegZ)?this.rotVelocityStick.y=-this.rotDirection.y*this.speedOrbit*this.rotForce:this.rotVelocityStick.y=0,this.rotVelocityTarget.subVectors(this.eulerDelta.divideScalar(r),this.rotVelocityStick),this.rotVelocityTarget.manhattanLength()===0?this.rotVelocity.lerp(this.rotVelocityTarget,1-(1-this.lerpFactorRotEnd)**n):this.rotVelocity.lerp(this.rotVelocityTarget,1-(1-this.lerpFactorRotStart)**n),this.euler.x+=this.rotVelocity.x*r,this.euler.y+=this.rotVelocity.y*r+this.groundYRotation,this.rotVelocityTarget.y===0&&this.directionXZ.manhattanLength()===0?this.rotationAccumWhenOrientWithCamera=0:(this.cameraFollow===!1||this.cameraYAxis==="Locked")&&(this.rotationAccumWhenOrientWithCamera+=this.rotVelocity.y*r),this.isFirstPerson===!1&&this.orientMode!=="none"&&this.directionXZ.manhattanLength()>0){if(this.orientMode==="radial"){this.objectToCamXZ.copy(this.objectToCamXZ0).applyAxisAngle(Ol,this.euler.y-this.euler0.y);let m=Wa.copy(this.objectToCamXZ).normalize(),g=ud.copy(a).multiplyScalar(r);g.y=0;let y=g.sub(ba.copy(m).multiplyScalar(g.dot(m))).cross(m).y;this.euler.y-=Math.atan2(y,this.objectToCamXZ.length())}}else this.rot.y+=this.rotVelocity.y*r+this.groundYRotation,this.rotVelocityTarget.y!==0&&(this.cameraFollow===!1||this.cameraYAxis==="Locked")&&(this.euler.y=this.rot.y);if(this.cameraFollow===!0&&(this.moveMode==="walk"?this.cameraXAxis==="Limit"?this.euler.x=Tt.clamp(this.euler.x,-this.maxPolarAngle+this.cameraPolarOffset+1e-6,-this.minPolarAngle+this.cameraPolarOffset-1e-6):this.euler.x=Tt.clamp(this.euler.x,-this.PI_2+this.cameraPolarOffset,this.PI_2+this.cameraPolarOffset):this.cameraXAxis==="Limit"&&(this.euler.x=Tt.clamp(this.euler.x,-this.PI_2,this.PI_2))),this.moveMode==="fly"?this.rot.x=this.euler.x:this.isFirstPerson&&(t?(Pc.copy(t),Pc.y=0):(Pc.copy(this.euler),Pc.y=0),this.nonColliderRotOffset.makeRotationFromEuler(Pc)),t&&(this.moveMode==="walk"?(this.rot.y=t.y,this.rot.x=0,this.rot.z=0):this.rot.setFromEuler(t),this.rot.y+=this.vrEulerYOffset*A7),Ll.setFromAxisAngle(ONe,this.rot.x),Du.setFromAxisAngle(Ol,this.rot.y),Du.multiply(Ll),Ll.setFromAxisAngle(zNe,this.rot.z),Du.multiply(Ll),this.quaternion.copy(Du),this.objectRealQuat.multiplyQuaternions(this.quaternion,this.objXZQuat),this.colliderWorldQuat.copy(this.objectRealQuat).multiply(this.collider.rotation),this.collisionEnabled)if(this.usePhysics){let m=Wa.copy(a).multiplyScalar(r/this.pixelsPerMeter),g=null;this.didHit=!1;let y=new N;for(let x=0;x<5;x++){let _=m.length(),M=ud.copy(m).normalize();if(g=this.sharedGameControlGlobals.rapierWorld.castShape(this.colliderWorldPosition.divideScalar(this.pixelsPerMeter).add(y),this.colliderWorldQuat,M,(c=this.object.rigidBody)==null?void 0:c.collider(0).shape,_,!1,24,void 0,void 0,this.object.rigidBody),g!==null){this.didHit=!0;let S=this.sharedGameControlGlobals.colliderToEntity.get(g.collider.handle);if(S!==this.lastHitObj&&x===0){this.lastHitObj=S;let A=this.sharedGameControlGlobals.entityToCollisionEvents[S==null?void 0:S.uuid];if(A){for(let D of A)if(D.data.target==="character"){let R=((u=this.sharedGameControlGlobals.rapierWorld)==null?void 0:u.getCollider(g.collider.handle))._parent,L;if(S.cloner){for(let O of S.cloner.children)if(O.rigidBody===R){L=O;break}}D.dispatch(L),S.dispatchEvent(VB)}}}let T=b7.set(g.normal2.x,g.normal2.y,g.normal2.z).applyQuaternion(this.colliderWorldQuat),E=_7.copy(M).multiplyScalar(g.toi).dot(T),C=g.toi;if(C===0&&(this.position.y+=this.offset*this.pixelsPerMeter),E>this.offset&&(C=g.toi*(E-this.offset)/E,y.addScaledVector(M,C)),m.copy(M).multiplyScalar(_-C),Math.acos(-T.y)>this.slopeThresh){let A=this.colliderWorldPosition.divideScalar(this.pixelsPerMeter).add(y),D=ud.copy(g.witness2).applyQuaternion(this.colliderWorldQuat);D.y=0;let R=A.add(D);R.y+=this.stepThresh;let L=this.sharedGameControlGlobals.rapierWorld.castShape(R,this.colliderWorldQuat,m,(h=this.object.rigidBody)==null?void 0:h.collider(0).shape,1,!1,24,void 0,void 0,this.object.rigidBody);L!==null&&L.toi===0&&(T.y=0,T.normalize())}m.addScaledVector(T,-m.dot(T))}else{x===0&&this.directionXZ.manhattanLength()!==0&&(this.lastHitObj=null),y.add(m);break}}this.position.addScaledVector(y,this.pixelsPerMeter),(d=this.object.rigidBody)==null||d.setTranslation(ba.copy(this.position).divideScalar(this.pixelsPerMeter),!0),(f=this.object.rigidBody)==null||f.setRotation(Ll.copy(this.quaternion).premultiply(this.groundTilt).multiply(this.objXZQuat),!0)}else{let m=this.onObject?1:5,g=a.multiplyScalar(r/m);for(let y=0;y<m;y++)this.position.add(g),this.collisionAdjustment(r/m)}else this.position.addScaledVector(a,r);if(this.moveMode==="walk"&&this.onObject&&(this.velocityTarget.y=0,this.velocity.y=0),this.quaternion.premultiply(this.groundTilt).multiply(this.objXZQuat),this.object.matrix.compose(this.position,this.quaternion,this.scale),this.object.matrixWorldNeedsUpdate=!0,this.object.matrix.multiply(this.nonColliderPosOffset).multiply(this.nonColliderRotOffset),this.quaternion.premultiply(this.groundTiltInv).multiply(this.objXZQuatInv),this.cameraFollow===!0){this.updateFollowArms();let m=this.objectToTarget.add(this.position),g=this.targetToCamera.add(m);sI.lookAt(g,m,Ol).setPosition(g),sI.decompose(this.targetPos,this.targetQuat,ba),this.camera.quaternion.slerp(this.targetQuat,1-(1-this.lerpFactorRotCamera)**n),this.camera.position.lerp(this.targetPos,1-(1-this.lerpFactorPosCamera)**n),this.camera.updateMatrix(),this.camera.updateMatrixWorld(),this.cameraYAxis==="Limit"&&this.orientMode==="cartesian"&&(this.euler.y=Tt.clamp(this.euler.y,this.minAzimuthAngleRel,this.maxAzimuthAngleRel)),this.euler.x=Tt.clamp(this.euler.x,-this.PI_2+(this.cameraPolarOffset<0?this.cameraPolarOffset:0),this.PI_2+(this.cameraPolarOffset>0?this.cameraPolarOffset:0))}return this.eulerDelta.set(0,0,0),this.object.dispatchEvent(VNe),this.path.length<2&&this.lastPosition.distanceToSquared(this.position)<this.threshEndTranslate&&Math.abs(this.rotVelocity.x)<this.threshEndRotVel&&Math.abs(this.rotVelocity.y)<this.threshEndRotVel&&(this.camera===void 0||this.isFirstPerson||this.lastCameraPosition.distanceToSquared(this.camera.position)<this.threshEndTranslate&&8*(1-this.lastCameraQuaternion.dot(this.camera.quaternion))<this.threshEndRotate)&&(this.moveMode==="fly"||this.onObject===!0||this.collisionEnabled===!1)&&(this.navMeshPathDest===null||this.navMeshPathDest.material.opacity<-.04*((v=(p=this.navMeshPathDest)==null?void 0:p.material)==null?void 0:v.userData.opacity0))?!1:(this.camera&&(this.lastCameraPosition.copy(this.camera.position),this.lastCameraQuaternion.copy(this.camera.quaternion)),this.lastPosition.copy(this.position),this.object.dispatchEvent(kNe),!0)}updateFollowArms(){this.objectToTarget.copy(this.objectToTarget0),this.targetToCamera.copy(this.targetToCamera0);let e=Ll.setFromAxisAngle(Ol,this.cameraYAxis==="Limit"&&this.orientMode!=="radial"?Tt.clamp(this.euler.y-this.euler0.y,this.minAzimuthAngleRel,this.maxAzimuthAngleRel):this.euler.y-this.euler0.y);(this.cameraYAxis!=="Locked"||this.orientMode==="radial")&&this.objectToTarget.applyQuaternion(e);let t;this.cameraXAxis==="Limit"?t=Tt.clamp(this.euler.x,-this.maxPolarAngle+this.cameraPolarOffset+1e-6,-this.minPolarAngle+this.cameraPolarOffset-1e-6):t=Tt.clamp(this.euler.x,-this.PI_2+this.cameraPolarOffset+1e-6,this.PI_2+this.cameraPolarOffset-1e-6);let i=ba.copy(this.cameraPolarAxis0);(this.cameraYAxis!=="Locked"||this.orientMode==="radial")&&i.applyQuaternion(e);let r=Du.setFromAxisAngle(i,t);this.cameraYAxis!=="Locked"&&this.targetToCamera.applyQuaternion(e),this.cameraXAxis!=="Locked"&&this.targetToCamera.applyQuaternion(r)}groundTiltAdjustment(e){Ol.angleTo(e)*180/Math.PI<15||Ol.angleTo(e)*180/Math.PI>85?Ll.identity():Ll.setFromUnitVectors(Ol,e),this.groundTilt.slerp(Ll,.06),this.groundTiltInv.copy(this.groundTilt).invert()}collisionAdjustment(e){var n;let t=_7.set(0,0,0);this.object.matrix.compose(this.position,this.quaternion,this.scale);let i=sI.multiplyMatrices(this.object.matrix,this.objXZRotMat).multiply(this.collider.matrix).decompose(ba,Ll,Wa).compose(ba,Ll,M7);this.sharedGameControlGlobals.entitiesWithTransformAnim.forEach(s=>{if(s===this.object||s.isDescendantOf(this.object))return;el.makeEmpty(),s.updateMatrixWorldSVD();let a=s.matrixWorldRigid,o=S7.copy(a).invert(),l=LNe.copy(S7).multiply(i);as.copy(this.collider.segment),as.start.applyMatrix4(l),as.end.applyMatrix4(l);let c=b7.copy(this.position).applyMatrix4(o);el.expandByPoint(as.start),el.expandByPoint(as.end),el.min.addScalar(-this.collider.radius),el.max.addScalar(this.collider.radius),s.bvhGeometry.boundsTree.shapecast({traverseBoundsOrder(u){return u.distanceToPoint(as.end)},intersectsBounds:u=>u.intersectsBox(el),intersectsTriangle:u=>{let h=ba,d=Wa,f=u.closestPointToSegment(as,h,d);if(f<this.collider.radius){let p=this.collider.radius-f,v=d.sub(h).normalize(),m=ud.copy(c);m.addScaledVector(v,p);let g=m.applyMatrix4(a).sub(this.position);t.add(g),as.start.addScaledVector(v,p),as.end.addScaledVector(v,p)}}})}),el.makeEmpty(),as.copy(this.collider.segment),as.start.applyMatrix4(i),as.end.applyMatrix4(i),el.expandByPoint(as.start),el.expandByPoint(as.end),el.min.addScalar(-this.collider.radius),el.max.addScalar(this.collider.radius),(n=this.sharedGameControlGlobals.staticMeshBVH)==null||n.shapecast({traverseBoundsOrder(s){return s.distanceToPoint(as.end)},intersectsBounds:s=>s.intersectsBox(el),intersectsTriangle:s=>{let a=ba,o=Wa,l=s.closestPointToSegment(as,a,o);if(l<this.collider.radius){let c=this.collider.radius-l,u=o.sub(a).normalize();this.alignToGround&&this.groundTiltAdjustment(u),t.addScaledVector(u,c),as.start.addScaledVector(u,c),as.end.addScaledVector(u,c)}}}),this.onObject=Math.abs(t.y)>Math.abs(e*this.velocity.y*.25),this.onObject&&this.dispatchStopEvent("jump");let r=Math.max(0,t.length()-1e-5);t.normalize().multiplyScalar(r),this.position.add(t)}},gre=NB;gre.isLocked=!1;var GNe=Tf(bJ());function vre(e){let t=e.elements,i=t[0]**2+t[1]**2+t[2]**2,r=t[4]**2+t[5]**2+t[6]**2,n=t[8]**2+t[9]**2+t[10]**2,s=t[0]**2+t[4]**2+t[8]**2,a=t[1]**2+t[5]**2+t[9]**2,o=t[2]**2+t[6]**2+t[10]**2,l=1e-8;return i<l||r<l||n<l||s<l||a<l||o<l}function Ju(e,t){let i=new Nt;if(t&&vre(t))return i.setAttribute("position",new _t([],3)),i.setIndex([]),i;if(!e.getAttribute("position"))return i.setAttribute("position",new _t([],3)),i.setIndex([]),i;let{positions:r,triIndices:n}=jC(e.getAttribute("position"),e.getIndex());return i.setAttribute("position",new _t(r,3)),i.setIndex(n),t&&i.applyMatrix4(t),i}var HNe=new ft,jNe=new ft,Dc=[[0,0,0],[0,0,0],[0,0,0]];function yre(e){let t=e.elements;Dc[0][0]=t[0],Dc[0][1]=t[4],Dc[0][2]=t[8],Dc[1][0]=t[1],Dc[1][1]=t[5],Dc[1][2]=t[9],Dc[2][0]=t[2],Dc[2][1]=t[6],Dc[2][2]=t[10];let{u:i,v:r}=(0,GNe.SVD)(Dc),n=HNe.set(i[0][0],i[0][1],i[0][2],0,i[1][0],i[1][1],i[1][2],0,i[2][0],i[2][1],i[2][2],0,0,0,0,1),s=jNe.set(r[0][0],r[0][1],r[0][2],0,r[1][0],r[1][1],r[1][2],0,r[2][0],r[2][1],r[2][2],0,0,0,0,1);return n.multiply(s.transpose())}var WNe=class extends p${constructor(){super(),this.layers.enable(3),this.layers.enable(8),this.layers.enable(9)}setFromCamera(e,t){t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,-1).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):t.isPerspectiveCamera?(this.ray.origin.set(e.x,e.y,-1).unproject(t),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):console.error("Raycaster: Unsupported camera type.")}intersectVisibleObjects(e,t=!0,i=[]){return e.forEach(r=>{r.visible&&this.intersectObject(r,t,i)}),i}createRaycastLineHelper(){let e=new Pf({color:65280,linewidth:10}),t=new N(this.ray.origin.x,this.ray.origin.y,this.ray.origin.z),i=new N(this.ray.direction.x,this.ray.direction.y,this.ray.direction.z),r=this.camera.far-this.camera.near,n=new N().addVectors(t,i.multiplyScalar(r)),s=new Nt;return s.setFromPoints([t,n]),new cA(s,e)}},xre=e=>e instanceof v0||e instanceof y0;function XNe(e,t){return e.distance-t.distance}function wre(e,t,i){if(!(!Ku(t)||!t.visible)){ql(t)&&t.raycast(e,i);for(let r of t.children)wre(e,r,i)}}function p2(e,t,i,r=!1){if(!r&&!i.some(s=>aT(e,s)!==void 0))return[];let n=[];return t.children.forEach(s=>wre(e,s,n)),n.sort(XNe),n}function kB(e){let t=[];if(e.length){let i=e[0].object;Ku(i)&&t.push(i);let r=i.parent;for(;r;)xre(r)&&t.push(r),r=r.parent}return t}function $u(e,t,i,r){let n=e.frame;if(n){let s=t[0]*n.width,a=(1-t[1])*n.height;for(let o of i){let l=o===n.uuid?n:n.find(o);if(l!=null&&l.intersects(s,a))return r(l),!0}}return!1}function aT(e,t){if(ql(t)){if(t.visible){let i=[];return t.raycast(e,i),i.length?i[0]:void 0}}else if(xre(t))return bre(e,t)}function bre(e,t){if(!(!Ku(t)||!t.visible)){if(ql(t)){let i=[];if(t.raycast(e,i),i.length)return i[0]}for(let i of t.children){let r=bre(e,i);if(r)return r}}}function qNe(e,t,i){return{x:(e-(i.left+window.scrollX))/i.width*2-1,y:-((t-(i.top+window.scrollY))/i.height)*2+1}}function YNe(e,t,i){return{x:(e-(i.left+window.scrollX))/i.width,y:1-(t-(i.top+window.scrollY))/i.height}}var QNe=class{constructor(e,t,i,r,n,s,a,o){this.renderer=e,this.publish=t,this.scene=i,this.getCamera=r,this.sharedAssets=n,this.requestRender=s,this.isExport=a,this.frame=o,this.raycaster=new WNe,this._useWindowEvents=!1,this.pointerWorld={x:0,y:0},this.pointerScreen={x:0,y:0},this._useWindowEvents=t.mouseEventTarget==="window",this.domElement=e.domElement,this.eventElement=this._useWindowEvents?window:e.domElement,this._domRect=this.domElement.getBoundingClientRect()}get stopRaycast(){return this.publish.stopRaycast}get page(){return this.scene.activePage}set useWindowEvents(e){this._useWindowEvents=e,this.eventElement=e?window:this.renderer.domElement}get useWindowEvents(){return this._useWindowEvents}set domRect(e){this._domRect=e}get domRect(){return this._domRect}updateRaycaster(e){var r;let{pageX:t,pageY:i}=((r=e.touches)==null?void 0:r.length)>0?e.touches[0]:e;this.pointerWorld=qNe(t,i,this._domRect),this.pointerScreen=YNe(t,i,this._domRect),this.raycaster.setFromCamera(this.pointerWorld,this.getCamera())}},ua=class{constructor(e){this.eventContext=e,this.domEventsNeeded=new Set,this.hasVideoAction=!1}connect(){}disconnect(){}},D4=[["start","Start"],["keyDown","KeyDown"],["keyUp","KeyUp"],["mouseDown","MouseDown"],["mouseUp","MouseUp"],["mouseHover","MouseHover"],["collision","Collision"],["lookAt","LookAt"],["follow","Follow"],["scroll","Scroll"]],_re=e=>{var t;return(t=D4.find(([i,r])=>r===e))==null?void 0:t[0]},Hb=e=>{var t;return(t=D4.find(([i])=>i===e))==null?void 0:t[1]},ZNe=(e,t)=>{let i=_re(e);if(i){let r=new CustomEvent(i,{bubbles:!0});return Object.defineProperty(r,"target",{writable:!1,value:t}),r}},KNe=class extends ua{constructor(){super(...arguments),this.objectsPerEvents=new Map,this.splineEvents={},this.onBeginEvent=e=>{var r;if(!e.eventName||!e.target||e.eventName==="Scroll")return;let t=(r=this.splineEvents[_re(e.eventName)])==null?void 0:r[e.target.uuid];if(!t)return;e.eventName==="Scroll"&&e.deltaY!==void 0&&Object.assign(t,{deltaY:e.deltaY});let{domElement:i}=this.eventContext;i.dispatchEvent(t)}}connect(){let{page:e}=this.eventContext;e.traverseEntity(t=>{var i,r;if((i=t.data)!=null&&i.events.length){for(let[n,s]of D4)if(t.data.events.some(a=>a.data.type===s&&!a.data.disabled)){this.objectsPerEvents.has(n)?(r=this.objectsPerEvents.get(n))==null||r.push(t):this.objectsPerEvents.set(n,[t]);let a={id:t.uuid,name:t.name},o=ZNe(s,a),l=this.splineEvents[n];l?l[t.uuid]=o:this.splineEvents[n]={[t.uuid]:o}}}}),this.objectsPerEvents.forEach(t=>{t.forEach(i=>{i.addEventListener("beginEvent",this.onBeginEvent)})})}disconnect(){this.objectsPerEvents.forEach(e=>{e.forEach(t=>{t.removeEventListener("beginEvent",this.onBeginEvent)})})}},JNe=class{constructor(e,t,i,r,n,s){if(this.id=e,this.data=t,this.object=i,this.entered=!1,(t.type==="KeyDown"||t.type==="KeyUp"||t.type==="KeyPress")&&!t.key)throw new Error("Missing property");this.actions=zn(t,t.actions,r,n,s,i)}disconnect(){gs(this.actions)}dispatchHeld(e){this.actions.Create.forEach(t=>{e&&t.dispatchThrottled.cancel(),t.dispatchThrottled()})}dispatch(e=!1){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),this.data.type==="MousePress"||this.data.type==="KeyPress"?this.entered||(this.entered=!0,this.actions.Transition.forEach(t=>t.playFromCurrent()),this.actions.Animation.forEach(t=>t.playFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.playFromCurrent()),this.actions.Create.forEach(t=>t.dispatchStart())):(this.actions.Transition.some(t=>t.playing&&t.data.runMode!=="Toggle")||this.actions.Transition.forEach(t=>{t.data.runMode==="Toggle"?t.toggle():t.play()}),this.actions.SwitchCamera.some(t=>t.playing&&t.data.runMode!=="Toggle")||this.actions.SwitchCamera.forEach(t=>{t.data.runMode==="Toggle"?t.toggle():t.play()}),this.actions.Animation.forEach(t=>{t.data.runMode==="Toggle"?t.toggle():t.play()})),this.actions.Link.forEach(t=>{t.dispatch()}),this.actions.SceneTransition.forEach(t=>{t.dispatch()}),e===!1&&this.actions.Create.forEach(t=>{t.dispatch()}),this.actions.Destroy.forEach(t=>{t.dispatch()}),this.actions.Reset.forEach(t=>{t.dispatch()}),this.actions.Audio.forEach(t=>{t.dispatchBasic()}),this.actions.Video.forEach(t=>{t.dispatchBasic()}),this.actions.Particles.forEach(t=>{t.dispatchBasic()}),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch()),this.actions.ClearLocalStorage.forEach(t=>t.dispatch()),this.actions.UserAPI.forEach(t=>t.dispatch())}dispatchRelease(){this.entered&&(this.entered=!1,this.actions.Transition.forEach(e=>e.reverseFromCurrent()),this.actions.Particles.forEach(e=>e.reverseFromCurrent()),this.actions.Animation.forEach(e=>e.reverseFromCurrent()),this.actions.SwitchCamera.forEach(e=>e.reverseFromCurrent()),this.actions.Create.forEach(e=>e.dispatchStop()))}dispatchUserEvent(e){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),e?(this.actions.Transition.forEach(t=>t.reverseFromCurrent()),this.actions.Animation.forEach(t=>t.reverseFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.reverseFromCurrent())):(this.actions.Transition.forEach(t=>t.playFromCurrent()),this.actions.Animation.forEach(t=>t.playFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.playFromCurrent())),this.actions.Link.forEach(t=>{t.dispatch()}),this.actions.SceneTransition.forEach(t=>{t.dispatch()}),this.actions.Create.forEach(t=>{t.dispatch()}),this.actions.Destroy.forEach(t=>{t.dispatch()}),this.actions.Reset.forEach(t=>{t.dispatch()}),this.actions.Audio.forEach(t=>{t.dispatchBasic()}),this.actions.Video.forEach(t=>{t.dispatchBasic()}),this.actions.Particles.forEach(t=>{t.dispatchBasic()}),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch()),this.actions.ClearLocalStorage.forEach(t=>t.dispatch()),this.actions.UserAPI.forEach(t=>t.dispatch())}},$Ne=class extends ua{constructor(e,t,i){super(e),this.eventManager=t,this.useForRaycastProperty=i,this.objectsPerTypes={MouseDown:[],MouseUp:[],MousePress:[],KeyDown:[],KeyUp:[],KeyPress:[]},this.canvasMouseEvents=[],this.eventsPerObjects={MouseDown:{},MouseUp:{},MousePress:{},KeyDown:{},KeyUp:{},KeyPress:{}},this.heldKeys={},this.heldKeysPress={},this._prevObjects=[],this.sceneInterects=null,this.onCanvasRaycast=r=>{if(this.useForRaycastProperty===!0&&this.sceneInterects===null){this.eventContext.updateRaycaster(r);let{raycaster:n,page:s}=this.eventContext,a=p2(n,s,[],!0);this.sceneInterects=a,a.length&&(this.eventContext.sharedAssets.raycastProperty={x:a[0].point.x,y:a[0].point.y,z:a[0].point.z,objX:a[0].object.matrixWorld.elements[12],objY:a[0].object.matrixWorld.elements[13],objZ:a[0].object.matrixWorld.elements[14]})}},this.onCanvasMouseDown=r=>{(r.target===this.eventContext.domElement||r.target.tagName==="SPLINE-VIEWER")&&this.canvasMouseEvents.forEach(n=>{(n.data.type==="MouseDown"||n.data.type==="MousePress")&&(this.onCanvasRaycast(r),n.dispatch())})},this.onCanvasMouseUp=r=>{(r.target===this.eventContext.domElement||r.target.tagName==="SPLINE-VIEWER")&&this.canvasMouseEvents.forEach(n=>{n.data.type==="MouseUp"?(this.onCanvasRaycast(r),n.dispatch()):n.data.type==="MousePress"&&n.dispatchRelease()})},this.onMouseDown=r=>{$t.length>1||(this.eventContext.updateRaycaster(r),this.handleMouseEvent("MouseDown"))},this.onMouseUp=r=>{$t.length>1||(this.eventContext.updateRaycaster(r),this.handleMouseEvent("MouseUp"))},this.onMousePressDown=r=>{$t.length>1||(this.eventContext.updateRaycaster(r),this.handleMousePressEvent())},this.onMousePressRelease=r=>{$t.length>1||(this.eventContext.updateRaycaster(r),this.handleMousePressEvent(!0))},this.onKeyDown=r=>{this.heldKeys[r.key]||(this.handleKeyEvent(r,"KeyDown"),this.handleKeyEventHeld(r,"KeyDown",!0)),this.heldKeys[r.key]=!0},this.onKeyUp=r=>{this.handleKeyEvent(r,"KeyUp"),this.handleKeyEventHeld(r,"KeyUp",!0)},this.onKeyPressDown=r=>{this.heldKeysPress[r.key]?this.handleKeyEventHeld(r,"KeyPress"):(this.handleKeyEvent(r,"KeyPress"),this.handleKeyEventHeld(r,"KeyPress",!0)),this.heldKeysPress[r.key]=!0},this.onKeyPressUp=r=>{this.handleKeyEvent(r,"KeyPress",!0)},this.releaseHeldKey=r=>{delete this.heldKeys[r.key]},this.releaseHeldKeyPress=r=>{delete this.heldKeysPress[r.key]},this._onUserEvent=({eventName:r,target:n,reverse:s})=>{var o,l,c,u;if(!r||!n)return;let a=Hb(r);a&&(a==="MouseDown"||a==="MouseUp"||a==="MousePress"?(n.dispatchEvent({type:"beginEvent",eventName:a}),(l=(o=this.eventsPerObjects[a])==null?void 0:o[n.uuid])==null||l.forEach(h=>{h.dispatchUserEvent(s)})):(a==="KeyDown"||a==="KeyUp"||a==="KeyPress")&&(n.dispatchEvent({type:"beginEvent",eventName:a}),(u=(c=this.eventsPerObjects[a])==null?void 0:c[n.uuid])==null||u.forEach(h=>{h.dispatchUserEvent()})))}}connect(){var n,s,a,o,l,c;let{page:e,sharedAssets:t,domElement:i}=this.eventContext,r=(u,h)=>{var f,p;if(!((f=u.data)!=null&&f.events.length))return;let d=["MouseDown","MouseUp","MousePress","KeyDown","KeyUp","KeyPress"];for(let v of d){let m=this.eventsPerObjects[v];if(u.data.events.filter(({data:g})=>g.type===v&&g.disabled!==!0).forEach(({id:g,data:y})=>{try{let x=new JNe(g,y,u,e,t,this.eventManager);x.actions.Video.length&&(this.hasVideoAction=!0),(y.type==="MouseDown"||y.type==="MouseUp"||y.type==="MousePress")&&(y.mode==="Canvas"||y.mode==="Window")?this.canvasMouseEvents.push(x):(m[u.uuid]?m[u.uuid].some(_=>_.id===x.id)||m[u.uuid].push(x):m[u.uuid]=[x],u instanceof Dm&&u.traverseChildren(_=>{var M;if(!_.visible)return!0;_ instanceof Rn&&((M=_.data.geometry.shapeBlendNode)==null?void 0:M.operation)!==2&&(m[_.uuid]?m[_.uuid].push(x):m[_.uuid]=[x])}))}catch{}}),((p=m[u.uuid])==null?void 0:p.length)&&(this.objectsPerTypes[v].push(u instanceof ys&&(v==="MouseDown"||v==="MouseUp"||v==="MousePress")?h:u),u instanceof Dm)){let g=this.objectsPerTypes[v];u.traverseChildren(y=>{if(!y.visible)return!0;y instanceof Rn&&g.indexOf(y)===-1&&g.push(y)})}}};e.traverseEntity(u=>{var h;(u instanceof ia||u instanceof hs)&&((h=u.frame)==null||h.traverse(d=>{r(d,u)})),r(u)}),this.heldKeys={},this.heldKeysPress={},this.domEventsNeeded.clear(),i.addEventListener("pointerdown",this.onCanvasMouseDown),i.addEventListener("pointerup",this.onCanvasMouseUp),((n=this.objectsPerTypes.MouseDown)!=null&&n.length||this.useForRaycastProperty)&&(this.domEventsNeeded.add("pointerdown"),i.addEventListener("pointerdown",this.onMouseDown)),(s=this.objectsPerTypes.MouseUp)!=null&&s.length&&(this.domEventsNeeded.add("pointerup"),i.addEventListener("pointerup",this.onMouseUp)),(a=this.objectsPerTypes.MousePress)!=null&&a.length&&(this.domEventsNeeded.add("pointerdown"),i.addEventListener("pointerdown",this.onMousePressDown),this.domEventsNeeded.add("pointerup"),i.addEventListener("pointerup",this.onMousePressRelease)),(o=this.objectsPerTypes.KeyDown)!=null&&o.length&&(this.domEventsNeeded.add("keydown"),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keyup",this.releaseHeldKey)),(l=this.objectsPerTypes.KeyUp)!=null&&l.length&&(this.domEventsNeeded.add("keyup"),document.addEventListener("keyup",this.onKeyUp)),(c=this.objectsPerTypes.KeyPress)!=null&&c.length&&(this.domEventsNeeded.add("keydown"),document.addEventListener("keydown",this.onKeyPressDown),document.addEventListener("keyup",this.releaseHeldKeyPress),this.domEventsNeeded.add("keyup"),document.addEventListener("keyup",this.onKeyPressUp)),Object.entries(this.objectsPerTypes).forEach(([u,h])=>{h.forEach(d=>{d.addEventListener("userEvent",this._onUserEvent)})})}disconnect(){let{domElement:e}=this.eventContext;this.domEventsNeeded.clear(),this.heldKeys={},this.heldKeysPress={},e.removeEventListener("pointerdown",this.onCanvasMouseDown),e.removeEventListener("pointerup",this.onCanvasMouseUp),e.removeEventListener("pointerdown",this.onMouseDown),e.removeEventListener("pointerdown",this.onMousePressDown),e.removeEventListener("pointerup",this.onMouseUp),e.removeEventListener("pointerup",this.onMousePressRelease),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keyup",this.onKeyUp),document.removeEventListener("keydown",this.onKeyPressDown),document.removeEventListener("keyup",this.onKeyPressUp),document.removeEventListener("keyup",this.releaseHeldKey),Object.values(this.eventsPerObjects).forEach(t=>{Object.values(t).forEach(i=>{i.forEach(r=>{r.disconnect()})})}),this.canvasMouseEvents.forEach(t=>{t.disconnect()}),Object.entries(this.objectsPerTypes).forEach(([t,i])=>{i.forEach(r=>{r.removeEventListener("userEvent",this._onUserEvent)})})}handleMouseEvent(e){var o,l,c,u;let{stopRaycast:t,raycaster:i,page:r,pointerScreen:n}=this.eventContext,s=this.objectsPerTypes[e],a=s.filter(h=>!(h instanceof ys));if(!(!s.length&&!this.useForRaycastProperty)&&!(r.uiCanvas&&$u(r,[n.x,n.y],Object.keys(this.eventsPerObjects[e]),h=>{this.handleObjectMouseEventDispatch(h,e)}))){if(t||this.useForRaycastProperty){let h;if(this.sceneInterects===null?h=p2(i,r,a,this.useForRaycastProperty):(h=this.sceneInterects,this.sceneInterects=null),this.useForRaycastProperty&&h.length&&(this.eventContext.sharedAssets.raycastProperty={x:h[0].point.x,y:h[0].point.y,z:h[0].point.z,objX:h[0].object.matrixWorld.elements[12],objY:h[0].object.matrixWorld.elements[13],objZ:h[0].object.matrixWorld.elements[14]}),t){let d=[((l=(o=h[0])==null?void 0:o.uv)==null?void 0:l.x)??0,((u=(c=h[0])==null?void 0:c.uv)==null?void 0:u.y)??0];kB(h).forEach(f=>{f instanceof ia&&$u(f,d,Object.keys(this.eventsPerObjects[e]),p=>{this.handleObjectMouseEventDispatch(p,e)}),this.eventsPerObjects[e][f.uuid]&&this.handleObjectMouseEventDispatch(f,e)})}}t||a.forEach(h=>{var f,p;let d=aT(i,h);d&&(this.handleObjectMouseEventDispatch(h,e),h instanceof ia&&$u(h,[((f=d==null?void 0:d.uv)==null?void 0:f.x)??0,((p=d==null?void 0:d.uv)==null?void 0:p.y)??0],Object.keys(this.eventsPerObjects[e]),v=>{this.handleObjectMouseEventDispatch(v,e)}))})}}handleMousePressEvent(e=!1){let t="MousePress",i=this.objectsPerTypes[t],r=i.filter(s=>!(s instanceof ys)),n=[];if(i.length){if(!e){let{stopRaycast:s,raycaster:a,page:o,pointerScreen:l}=this.eventContext,c=!1;if(o.uiCanvas&&(c=$u(o,[l.x,l.y],Object.keys(this.eventsPerObjects[t]),u=>{n.push(u)})),s&&!c){let u=p2(a,o,r);n=kB(u),u.forEach(h=>{var d,f;h.object instanceof ia&&$u(h.object,[((d=h==null?void 0:h.uv)==null?void 0:d.x)??0,((f=h==null?void 0:h.uv)==null?void 0:f.y)??0],Object.keys(this.eventsPerObjects[t]),p=>{n.push(p)})})}else r.forEach(u=>{var d,f;let h=aT(a,u);h&&(n.push(u),u instanceof ia&&$u(u,[((d=h==null?void 0:h.uv)==null?void 0:d.x)??0,((f=h==null?void 0:h.uv)==null?void 0:f.y)??0],Object.keys(this.eventsPerObjects[t]),p=>{n.push(p)}))})}this._prevObjects.length&&this._prevObjects.forEach(s=>{n.includes(s)||this.handleObjectMouseEventDispatchRelease(s,t)}),n.length&&n.forEach(s=>{this.handleObjectMouseEventDispatch(s,t)}),this._prevObjects=n}}handleObjectMouseEventDispatch(e,t){var i,r;e.dispatchEvent({type:"beginEvent",eventName:t}),(r=(i=this.eventsPerObjects[t])==null?void 0:i[e.uuid])==null||r.forEach(n=>{n.dispatch()})}handleObjectMouseEventDispatchRelease(e,t){var i,r;e.dispatchEvent({type:"beginEvent",eventName:t}),(r=(i=this.eventsPerObjects[t])==null?void 0:i[e.uuid])==null||r.forEach(n=>{n.dispatchRelease()})}handleKeyEvent(e,t,i=!1){this.objectsPerTypes[t].forEach(r=>{let n=this.eventsPerObjects[t][r.uuid];n.some(({data:s})=>"key"in s&&s.key===e.key)&&r.dispatchEvent({type:"beginEvent",eventName:t}),n.forEach(s=>{"key"in s.data&&s.data.key===e.key&&(i?s.dispatchRelease():s.dispatch(!0))})})}handleKeyEventHeld(e,t,i=!1){this.objectsPerTypes[t].forEach(r=>{this.eventsPerObjects[t][r.uuid].forEach(n=>{"key"in n.data&&n.data.key===e.key&&n.dispatchHeld(i)})})}},e4e=new N,t4e=new N,Sre=class{constructor(e,t,i,r,n){this.actionsIn=zn(e,e.inActions,i,r,n,t),this.actionsOut=zn(e,e.outActions,i,r,n,t)}disconnect(){gs(this.actionsIn),gs(this.actionsOut)}},i4e=class extends Sre{constructor(e,t,i,r,n,s){super(t,i,r,n,s),this.id=e,this.data=t,this.object=i,this.stage="out",this.objects=[],this.onUpdateMatrixWorld=()=>{for(let d of this.objects)if(!d.visible)return;let c=e4e.setFromMatrixPosition(this.objects[0].matrixWorld),u=t4e.setFromMatrixPosition(this.objects[1].matrixWorld),h=c.distanceTo(u)<=this.distance?"in":"out";if(this.stage!==h){this.stage=h;let d=h==="in"?this.actionsIn:this.actionsOut;d.Audio.forEach(f=>f.dispatchConditional()),d.Particles.forEach(f=>f.dispatchConditional()),d.Video.forEach(f=>f.dispatchConditional()),d.Link.forEach(f=>f.dispatch()),d.Create.forEach(f=>f.dispatch()),d.Destroy.forEach(f=>f.dispatch()),d.Reset.forEach(f=>f.dispatch()),d.Transition.forEach(f=>{f.object.currentTransitionEvent!==this&&(f.object.currentTransitionEvent=this),f.init()}),d.Transition.forEach(f=>f.play()),d.Animation.forEach(f=>f.play()),d.SwitchCamera.forEach(f=>f.play()),d.SceneTransition.forEach(f=>f.dispatch()),d.SetVariable.forEach(f=>f.checkConditions()),d.SetVariable.forEach(f=>f.dispatch()),d.DynamicVariablePlay.forEach(f=>f.dispatch()),d.ClearLocalStorage.forEach(f=>f.dispatch()),d.UserAPI.forEach(f=>f.dispatch())}};let{distance:a,fromObject:o,toObject:l}=t.condition;this.distance=a;for(let c of[o,l]){if(!c)throw new Error("Missing property");let u=r.find(c);if(!u)throw new Error("Missing property");this.objects.push(u)}}connect(){window.setTimeout(()=>{this.objects.forEach(e=>{e.addEventListener("updateMatrixWorld",this.onUpdateMatrixWorld)}),this.onUpdateMatrixWorld()},0)}disconnect(){super.disconnect(),this.stage="out",this.objects.forEach(e=>{e.removeEventListener("updateMatrixWorld",this.onUpdateMatrixWorld)})}},r4e=class extends Sre{constructor(e,t,i,r,n,s){var l;super(t,i,r,n,s),this.id=e,this.data=t,this.object=i,this.onBegin=({target:c,state:u})=>{this.toState!==u&&(this.actionsOut.Audio.forEach(h=>h.dispatchConditional()),this.actionsOut.Particles.forEach(h=>h.dispatchConditional()),this.actionsOut.Video.forEach(h=>h.dispatchConditional()),this.actionsOut.Link.forEach(h=>h.dispatch()),this.actionsOut.Create.forEach(h=>h.dispatch()),this.actionsOut.Destroy.forEach(h=>h.dispatch()),this.actionsOut.Reset.forEach(h=>h.dispatch()),this.actionsIn.Transition.forEach(h=>h.pause()),this.object.currentTransitionEvent=this,this.actionsOut.Transition.forEach(h=>h.play()),this.actionsOut.Animation.forEach(h=>h.play()),this.actionsIn.SwitchCamera.forEach(h=>h.pause()),this.actionsOut.SwitchCamera.forEach(h=>h.play()),this.actionsOut.SceneTransition.forEach(h=>h.dispatch()),this.actionsOut.SetVariable.forEach(h=>h.checkConditions()),this.actionsOut.SetVariable.forEach(h=>h.dispatch()),this.actionsOut.DynamicVariablePlay.forEach(h=>h.dispatch()),this.actionsOut.ClearLocalStorage.forEach(h=>h.dispatch()),this.actionsOut.UserAPI.forEach(h=>h.dispatch()))},this.onComplete=({target:c,state:u})=>{this.toState===u&&(this.actionsIn.Audio.forEach(h=>h.dispatchConditional()),this.actionsIn.Particles.forEach(h=>h.dispatchConditional()),this.actionsIn.Video.forEach(h=>h.dispatchConditional()),this.actionsIn.Link.forEach(h=>h.dispatch()),this.actionsIn.Create.forEach(h=>h.dispatch()),this.actionsIn.Destroy.forEach(h=>h.dispatch()),this.actionsIn.Reset.forEach(h=>h.dispatch()),this.actionsOut.Transition.forEach(h=>h.pause()),this.actionsOut.Transition.forEach(h=>h.pause()),this.object.currentTransitionEvent=this,this.actionsIn.Transition.forEach(h=>h.play()),this.actionsIn.Animation.forEach(h=>h.play()),this.actionsOut.SwitchCamera.forEach(h=>h.pause()),this.actionsIn.SwitchCamera.forEach(h=>h.play()),this.actionsIn.SceneTransition.forEach(h=>h.dispatch()),this.actionsIn.SetVariable.forEach(h=>h.checkConditions()),this.actionsIn.SetVariable.forEach(h=>h.dispatch()),this.actionsIn.DynamicVariablePlay.forEach(h=>h.dispatch()),this.actionsOut.ClearLocalStorage.forEach(h=>h.dispatch()),this.actionsOut.UserAPI.forEach(h=>h.dispatch()))};let{condition:a}=t;if(!a.object)throw new Error("Missing property");let o=r.find(a.object)??r.scene.find2D(a.object);if(!o)throw new Error("Missing property");if(this.toObject=o,a.state&&!((l=this.toObject.states)!=null&&l[a.state]))throw new Error("Missing property");this.toState=a.state}connect(){jp(this.actionsOut).forEach(e=>{var t;(t=this.actionsOut[e])!=null&&t.length&&this.toObject.addEventListener("beginState",this.onBegin)}),jp(this.actionsIn).forEach(e=>{var t;(t=this.actionsIn[e])!=null&&t.length&&this.toObject.addEventListener("completeState",this.onComplete)})}disconnect(){super.disconnect(),jp(this.actionsOut).forEach(e=>{var t;(t=this.actionsIn[e])!=null&&t.length&&this.toObject.removeEventListener("beginState",this.onBegin)}),jp(this.actionsIn).forEach(e=>{var t;(t=this.actionsIn[e])!=null&&t.length&&this.toObject.removeEventListener("completeState",this.onComplete)})}},n4e=class extends ua{constructor(e,t){super(e),this.eventManager=t,this.eventsPerConditions={Comparison:[],Distance:[],State:[]},this.hasVideoAction=!1}connect(){super.connect();let{page:e,sharedAssets:t}=this.eventContext;e.traverseEntity(i=>{var r;if((r=i.data)!=null&&r.events.length){for(let{id:n,data:s}of i.data.events)if(!s.disabled&&s.type==="Conditional")try{let a;s.condition.type==="Comparison"||(s.condition.type==="Distance"?a=new i4e(n,s,i,e,t,this.eventManager):s.condition.type==="State"&&(a=new r4e(n,s,i,e,t,this.eventManager))),a&&(this.eventsPerConditions[s.condition.type].push(a),(a.actionsIn.Video.length||a.actionsOut.Video.length)&&(this.hasVideoAction=!0))}catch{}}}),Object.values(this.eventsPerConditions).forEach(i=>i.forEach(r=>r.connect()))}disconnect(){super.disconnect(),Object.values(this.eventsPerConditions).forEach(e=>e.forEach(t=>t.disconnect()))}},P1=new N,hd=new N,tp=new N,T7=new Ka,s4e=.01,er=new N,Gn=new N,C7=new N,Kp=new ri,aI=new Wn,a4e=new ft,oI=new Dn,Hg=new N,Rc=new N,jg=.2;function lI(e,t){!t||(t[0]<t[1]&&(e.x=Math.min(Math.max(e.x,t[0]),t[1])),t[2]<t[3]&&(e.y=Math.min(Math.max(e.y,t[2]),t[3])),t[4]<t[5]&&(e.z=Math.min(Math.max(e.z,t[4]),t[5])))}var o4e=function(){let e=new ft;return(t,i,r)=>{let n=t.obj;e.copy(n.hiddenMatrix),n.parent!==null&&e.premultiply(n.parent.matrixWorld),e.invert(),n.position.copy(i),t.reference==="global"&&lI(n.position,t.limits),n.position.applyMatrix4(e),t.reference==="parent"?lI(n.position,t.limits):t.reference==="local"&&(Kp.copy(t.quat0).invert(),n.position.sub(t.position0),n.position.applyQuaternion(Kp),lI(n.position,t.limits),Kp.invert(),n.position.applyQuaternion(Kp),n.position.add(t.position0)),e.multiply(r??n.matrixWorld).decompose(er,n.quaternion,Gn),n.updateMatrix(),n.hasNonUniformScale&&(n.updateMatrixWorld(),n.updateMatrixWorldSVD()),n instanceof za&&fh(n.parent)&&n.invalidateDownstreamBooleanData(!0)}}(),l4e=class{constructor(e,t,i,r,n,s,a){this.object=e,this.id=t,this.data=i,this.dropDestIds=[],this.activeIdx=null,this.wasDragEventTriggered=!1,this.resetDampingFactor=this.data.resetSpeed===0?1:8/this.data.resetSpeed+1,this.snapDampingFactor=this.data.snapSpeed===0?1:8/this.data.snapSpeed+1,this.actionsDrag=zn(i,i.dragDropActions.drag,r,n,s,this.object),this.actionsDrop=zn(i,i.dragDropActions.drop,r,n,s,this.object);let o=[];this.data.objects.forEach(l=>{let c=r.find(l);!c||c.data.visible!==!1&&(o.push(c),a[c.uuid]&&a[c.uuid].forEach(u=>{let h=r.find(u);!h||h.data.visible!==!1&&o.push(h)}))}),this.data.dropDestinations.forEach(l=>{let c=r.find(l);!c||c.data.visible!==!1&&(this.dropDestIds.push(c.uuid),a[c.uuid]&&a[c.uuid].forEach(u=>{let h=r.find(u);!h||h.data.visible!==!1&&this.dropDestIds.push(h.uuid)}))}),this.dragItems=o.map(l=>(this.data.planeMode==="locked"&&(l.userData.lockedPlane=!0),l.userData.worldPosition0=new N().setFromMatrixPosition(l.matrixWorld),{obj:l,fromPosition:new N().setFromMatrixPosition(l.matrixWorld),pointStart:new N,pointEnd:new N,paused:!0,currentDampingFactor:this.data.dampingFactor,reset:!1,position0:new N().copy(l.position),quat0:new ri().copy(l.quaternion),snapped:!1,orientationMatrix:new ft,limits:this.data.limits,reference:this.data.referenceFrame}))}get activeDragItem(){return this.activeIdx!==null?this.dragItems[this.activeIdx]:null}dispose(){gs(this.actionsDrag),gs(this.actionsDrop),this.dragItems.forEach(e=>{e.fromPosition.copy(e.obj.userData.worldPosition0),e.pointStart.copy(e.fromPosition),e.pointEnd.copy(e.pointStart),e.obj.recursiveBBoxNeedsUpdate=!0,e.obj.userData.lockedPlane=void 0,e.obj.position.copy(e.position0),e.obj.quaternion.copy(e.quat0),e.obj.updateMatrix()})}},c4e=class extends ua{constructor(e,t){super(e),this.eventManager=t,this.events=[],this.lastDropDestination=null,this.dragTimeout=null,this.onPointerDown=i=>{var a;if($t.length>1)return;this.eventContext.updateRaycaster(i);let{raycaster:r,page:n}=this.eventContext,s=n.raycastWithClones(r);if(this.lastDropDestination=null,s.length===0){this.activeEvent=null;return}for(let o of this.events){let l=0;for(let{obj:c,pointEnd:u,pointStart:h}of o.dragItems){if(c===s[0].object||c===s[0].object.object||Fi.is(c)&&c.isAncestorOf(s[0].object.uuid)){if(o.activeIdx=l,o.activeDragItem.reset=!1,o.activeDragItem.currentDampingFactor=o.data.dampingFactor,o.activeDragItem.snapped=!1,o.data.cursor==="hand"&&this.setCursor("grabbing"),this.eventManager.controlsManager.usePhysics){o.activeDragItem.obj.rigidBody&&o.activeDragItem.obj.rigidBody.setBodyType(2,!0);let d=o.activeDragItem.obj;c.hasNonUniformScale&&c.updateMatrixWorldSVD(),(d.hasNonUniformScale?d.matrixWorldRigid:d.matrixWorld).decompose(er,Kp,Gn),aI.setFromQuaternion(Kp),d.prevR===void 0?(d.prevR=aI.clone(),d.prevT=er.clone()):(d.prevR.copy(aI),d.prevT.copy(er)),this.eventManager.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.push(o.activeDragItem.obj)}this.calcPlaneIntersectPos(c,h,o.data.plane,o.data.referenceFrame),u.copy(h),(this.eventManager.controlsManager.usePhysics&&((a=c.data.physics)==null?void 0:a.rigidBody)==="dynamic"||o.data.drop===!1||o.data.resetOnSnapFail===!1)&&o.activeDragItem.fromPosition.setFromMatrixPosition(o.activeDragItem.obj.matrixWorld),this.activeEvent=o,this.eventManager.controlsManager.orbitControls&&(this.eventManager.controlsManager.orbitControls.enabled=!1);return}l++}}this.activeEvent=null},this.onPointerMove=i=>{var a,o,l,c;if($t.length>1)return;this.eventContext.updateRaycaster(i);let{raycaster:r,page:n}=this.eventContext,s=n.raycastWithClones(r);if($t.length===0){let u=!1;for(let h of this.events){for(let{obj:d}of h.dragItems)if(d===((a=s[0])==null?void 0:a.object)||d===((l=(o=s[0])==null?void 0:o.object)==null?void 0:l.object)||Fi.is(d)&&d.isAncestorOf((c=s[0])==null?void 0:c.object.uuid)){switch(u=!0,h.data.cursor){case"hand":this.setCursor("grab");break;case"move":this.setCursor("move");break}break}if(u)break}u||this.setCursor("default");return}if(this.activeEvent&&this.activeEvent.activeDragItem){let u=this.activeEvent.activeDragItem;u.snapped=!1;let h;if(this.activeEvent.data.drop&&(h=s.filter(d=>u.obj!==d.object&&!u.obj.isAncestorOf(d.object.uuid)&&!(d.object instanceof v0)&&(this.activeEvent.data.dropOn==="all"||this.activeEvent.dropDestIds.some(f=>f===d.object.uuid||n.scene.find(f).isAncestorOf(d.object.uuid))))[0]),h){let d=C7.copy(h.face.normal).applyMatrix3(oI.getNormalMatrix(h.object.matrixWorld));if(this.activeEvent.data.snapTo==="center")u.fromPosition.setFromMatrixPosition(h.object.matrixWorld);else if(this.activeEvent.data.snapTo==="surface"){if(u.fromPosition.copy(h.point),this.activeEvent.data.snapSurfaceMode==="bbox"){er.copy(d).applyMatrix3(oI.setFromMatrix4(u.obj.matrixWorld).transpose());let f=u.obj;er.x>jg?Gn.x=-f.recursiveBBox.min.x:er.x<-jg&&(Gn.x=-f.recursiveBBox.max.x),er.y>jg?Gn.y=-f.recursiveBBox.min.y:er.y<-jg&&(Gn.y=-f.recursiveBBox.max.y),er.z>jg?Gn.z=-f.recursiveBBox.min.z:er.z<-jg&&(Gn.z=-f.recursiveBBox.max.z),Gn.applyMatrix3(oI.invert())}else Gn.copy(d).multiplyScalar(this.activeEvent.data.snapSurfaceOffset);u.fromPosition.add(Gn)}this.activeEvent.data.autoOrient&&(er.set(0,1,0).cross(d),er.length()<1e-4&&er.set(-1,0,0).cross(d),Gn.crossVectors(C7,er),u.orientationMatrix.makeBasis(er,Gn,d)),u.pointStart.copy(u.fromPosition),u.pointEnd.copy(u.pointStart),u.currentDampingFactor=this.activeEvent.snapDampingFactor,u.snapped=!0,this.lastDropDestination!==h.object&&(this.lastDropDestination=h.object,this.activeEvent.actionsDrop.Transition.forEach(f=>{f.play()}),this.activeEvent.actionsDrop.Animation.forEach(f=>{f.play()}),this.activeEvent.actionsDrop.Audio.forEach(f=>{f.dispatchGameControl("start")}),this.activeEvent.actionsDrop.Particles.forEach(f=>{f.dispatchGameControl("start")}),this.activeEvent.actionsDrop.Create.forEach(f=>{f.dispatchThrottled()}))}else u.orientationMatrix.makeRotationFromQuaternion(u.quat0),this.lastDropDestination=null,u.currentDampingFactor=this.activeEvent.data.dampingFactor,this.calcPlaneIntersectPos(u.obj,u.pointEnd,this.activeEvent.data.plane,this.activeEvent.data.referenceFrame),this.activeEvent.actionsDrop.Transition.forEach(d=>{d.stop(),d.object.currentState!==null&&d.object.changeSelectedState(null,{scene:this.eventContext.page.scene,shared:this.eventContext.sharedAssets})}),this.activeEvent.actionsDrop.Animation.forEach(d=>{d.stop()}),this.activeEvent.actionsDrop.Audio.forEach(d=>{d.dispatchGameControl("stop")}),this.activeEvent.actionsDrop.Particles.forEach(d=>{d.dispatchGameControl("stop")});this.activeEvent.actionsDrag.Create.forEach(d=>{d.dispatchThrottled()}),this.activeEvent.actionsDrag.SetVariable.forEach(d=>d.checkConditions()),this.activeEvent.actionsDrag.SetVariable.forEach(d=>d.dispatch()),this.activeEvent.actionsDrag.DynamicVariablePlay.forEach(d=>d.dispatch()),this.activeEvent.actionsDrag.ClearLocalStorage.forEach(d=>d.dispatch()),this.activeEvent.actionsDrag.UserAPI.forEach(d=>d.dispatch()),this.activeEvent.wasDragEventTriggered===!1&&(this.activeEvent.wasDragEventTriggered=!0,this.activeEvent.actionsDrag.Transition.forEach(d=>{d.play()}),this.activeEvent.actionsDrag.Animation.forEach(d=>{d.play()}),this.activeEvent.actionsDrag.Audio.forEach(d=>{d.dispatchGameControl("start")}),this.activeEvent.actionsDrag.Particles.forEach(d=>{d.dispatchGameControl("start")})),this.dragTimeout&&window.clearTimeout(this.dragTimeout),this.dragTimeout=window.setTimeout(()=>{!this.activeEvent||(this.activeEvent.wasDragEventTriggered=!1,this.activeEvent.actionsDrag.Audio.forEach(d=>{d.dispatchGameControl("stop")}),this.activeEvent.actionsDrag.Particles.forEach(d=>{d.dispatchGameControl("stop")}),this.activeEvent.actionsDrag.Transition.forEach(d=>{d.stop(),d.object.currentState!==null&&d.object.changeSelectedState(null,{scene:this.eventContext.page.scene,shared:this.eventContext.sharedAssets})}),this.activeEvent.actionsDrag.Animation.forEach(d=>{d.stop()}))},500),this.updateDragItem(u),u.obj.dispatchEvent({type:"requestRender"})}},this.onPointerUp=i=>{var r;if(this.activeEvent&&this.activeEvent.activeDragItem){this.activeEvent.data.cursor==="hand"&&this.setCursor("grab");let n=((r=this.activeEvent.activeDragItem.obj.data.physics)==null?void 0:r.rigidBody)==="dynamic";this.activeEvent.activeDragItem.snapped===!1&&this.activeEvent.data.drop&&this.activeEvent.data.resetOnSnapFail&&(this.eventManager.controlsManager.usePhysics===!1||!n)&&(this.activeEvent.activeDragItem.reset=this.activeEvent.data.resetOnSnapFail,this.activeEvent.activeDragItem.paused=!1,this.activeEvent.activeDragItem.currentDampingFactor=this.activeEvent.resetDampingFactor),this.eventManager.controlsManager.usePhysics&&n&&(this.eventManager.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.pop(),this.activeEvent.activeDragItem.obj.rigidBody.setBodyType(0,!0),this.activeEvent.activeDragItem.paused=!0),this.activeEvent.wasDragEventTriggered===!0&&(this.activeEvent.wasDragEventTriggered=!1,this.activeEvent.actionsDrag.Transition.forEach(s=>{s.stop(),s.object.currentState!==null&&s.object.changeSelectedState(null,{scene:this.eventContext.page.scene,shared:this.eventContext.sharedAssets})}),this.activeEvent.actionsDrag.Animation.forEach(s=>{s.stop()}),this.activeEvent.actionsDrag.Audio.forEach(s=>{s.dispatchGameControl("stop")}),this.activeEvent.actionsDrag.Particles.forEach(s=>{s.dispatchGameControl("stop")}),this.activeEvent.actionsDrop.SetVariable.forEach(s=>s.checkConditions()),this.activeEvent.actionsDrop.SetVariable.forEach(s=>s.dispatch()),this.activeEvent.actionsDrop.DynamicVariablePlay.forEach(s=>s.dispatch()),this.activeEvent.actionsDrop.ClearLocalStorage.forEach(s=>s.dispatch()),this.activeEvent.actionsDrop.UserAPI.forEach(s=>s.dispatch())),this.eventManager.controlsManager.orbitControls&&(this.eventManager.controlsManager.orbitControls.enabled=!0)}}}connect(){let e={};if(this.eventContext.page.traverseEntity(i=>{i.component&&(e[i.component.uuid]?e[i.component.uuid].push(i.uuid):e[i.component.uuid]=[i.uuid])}),this.eventContext.page.traverseEntity(i=>{var r;(r=i.data)==null||r.events.filter(n=>n.data.type==="DragDrop"&&!n.data.disabled).forEach(n=>{this.events.push(new l4e(i,n.id,n.data,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager,e))})}),!this.events.length)return;this.domEventsNeeded.clear(),this.domEventsNeeded.add("pointerdown");let t=this.eventContext.domElement;t.addEventListener("pointerdown",this.onPointerDown),t.addEventListener("pointermove",this.onPointerMove),t.addEventListener("pointerup",this.onPointerUp),this.domEventsNeeded.add("pointermove")}disconnect(){if(!this.events.length)return;this.domEventsNeeded.clear();let e=this.eventContext.domElement;e.removeEventListener("pointerdown",this.onPointerDown),e.removeEventListener("pointermove",this.onPointerMove),e.removeEventListener("pointerup",this.onPointerUp),this.events.forEach(t=>t.dispose())}setCursor(e){this.eventContext.domElement.style.cursor=e}onAnimationFrameDamping(){for(let e of this.events)for(let t of e.dragItems)t.paused||this.updateDragItem(t,!0)}calcPlaneIntersectPos(e,t,i,r){let{getCamera:n,raycaster:s}=this.eventContext;n().getWorldDirection(hd),hd.negate();let a=Kp.identity();switch(r==="parent"?a4e.multiplyMatrices(e.parent.matrixWorld,e.hiddenMatrix).decompose(er,a,Gn):r==="local"&&e.matrixWorld.decompose(er,a,Gn),i){case"x":er.set(1,0,0).applyQuaternion(a),Hg.copy(hd).cross(er),Rc.copy(er).cross(Hg);break;case"y":er.set(0,1,0).applyQuaternion(a),Hg.copy(hd).cross(er),Rc.copy(er).cross(Hg);break;case"z":er.set(0,0,1).applyQuaternion(a),Hg.copy(hd).cross(er),Rc.copy(er).cross(Hg);break;case"xy":Rc.set(0,0,1).applyQuaternion(a);break;case"yz":Rc.set(1,0,0).applyQuaternion(a);break;case"xz":Rc.set(0,1,0).applyQuaternion(a);break;case"adaptive":hd.angleTo(Gn.set(0,1,0))>Math.PI/6?(er.crossVectors(Gn.set(0,1,0),hd),Rc.crossVectors(er,Gn)):Rc.set(0,1,0);break;default:Rc.copy(hd);break}tp.setFromMatrixPosition(e.matrixWorld);let o=e.userData.lockedPlane?e.userData.worldPosition0:tp;if(T7.setFromNormalAndCoplanarPoint(Rc,o),!!s.ray.intersectPlane(T7,t)&&(i==="x"||i==="y"||i==="z")){let l=Gn.subVectors(t,o).dot(er);t.copy(o).addScaledVector(er,l)}}updateDragItem(e,t=!1){var i,r;tp.setFromMatrixPosition(e.obj.matrixWorld),e.reset==="current"?P1.subVectors(e.fromPosition,tp).divideScalar(e.currentDampingFactor):e.reset==="original"?(P1.subVectors(e.obj.userData.worldPosition0,tp).divideScalar(e.currentDampingFactor),e.fromPosition.copy(e.obj.userData.worldPosition0),e.pointStart.copy(e.fromPosition),e.pointEnd.copy(e.pointStart)):P1.subVectors(e.pointEnd,e.pointStart).add(e.fromPosition).sub(tp).divideScalar(e.currentDampingFactor),e.paused=e.currentDampingFactor>1?P1.length()<s4e:!0,(this.activeEvent&&this.activeEvent.data.dampingFactor===1||t)&&o4e(e,P1.add(tp),(i=this.activeEvent)!=null&&i.data.drop&&((r=this.activeEvent)!=null&&r.data.autoOrient)?e.orientationMatrix:null),e.obj.dispatchEvent({type:"beginEvent",eventName:"DragDrop"}),this.eventManager.requestRender()}},Wg=new N,cI=new N,Ru=new N,Iu=new N,P7=new Ka,u4e=.01,h4e={type:"requestRender"},d4e=function(){let e=new N,t=new N;return(i,r,n)=>n>0?(e.subVectors(i,r),e.length()<=n?i:t.copy(r).add(e.normalize().multiplyScalar(n))):r}(),D7=function(){let e=new ft;return(t,i)=>{t.position.copy(i),t.parent!==null&&(e.copy(t.parent.matrixWorld).invert(),t.position.applyMatrix4(e)),e.copy(t.hiddenMatrix).invert(),t.position.applyMatrix4(e),t.updateMatrix(),t.hasNonUniformScale&&(t.updateMatrixWorld(),t.updateMatrixWorldSVD()),t instanceof za&&fh(t.parent)&&t.invalidateDownstreamBooleanData(!0)}}(),f4e=class{constructor(e,t,i,r,n,s){this.data=e,this.id=t,this.object=i,this.paused=!1,this.currentDampingFactor=1,this.snapComplete=!1,this.isReset=!1,this.worldPosition0=new N,this.timeoutId=null,this.delayFinished=!0,this.wasOutside=!1,this.data={...gz.defaultData,...e,...e.resetOnPointerLeave===void 0&&{resetOnPointerLeave:!1}},e.target===void 0||e.target==="cursor"||(this.target=r.find(e.target)),this.data.dampingFactor&&(this.currentDampingFactor=this.data.dampingFactor),this.resetDampingFactor=80/this.data.resetSpeed+1,this.object.getWorldPosition(this.worldPosition0),this.actions=zn(e,e.actions,r,n,s,i)}},p4e=class extends ua{constructor(e,t){super(e),this.eventManager=t,this.events=[],this.pairOfEventListeners=[],this.onMouseMove=i=>{if(!($t.length>1)){this.eventContext.updateRaycaster(i);for(let r of this.events)r.target===void 0&&this.updateSingleEvent(r)}},this.onMouseEnter=i=>{for(let r of this.events)r.target===void 0&&(r.isReset=!1,r.currentDampingFactor=r.data.dampingFactor)},this.onMouseLeave=i=>{for(let r of this.events)r.target===void 0&&(r.data.resetOnPointerLeave&&(r.isReset=!0,r.currentDampingFactor=r.resetDampingFactor),this.updateSingleEvent(r))},this.onTargetChange=i=>()=>{this.updateSingleEvent(i)}}connect(){let{page:e}=this.eventContext;if(e.traverseEntity(r=>{var s,a;let n=(s=r.data)==null?void 0:s.events.find(o=>o.data.type==="Follow"&&!o.data.disabled);n&&(!e.data.globalPhysics.usePhysics||((a=r.dataPatched.physics)==null?void 0:a.rigidBody)!=="dynamic")&&this.events.push(new f4e(n.data,n.id,r,e,this.eventContext.sharedAssets,this.eventManager))}),!this.events.length)return;let{domElement:t,eventElement:i}=this.eventContext;this.domEventsNeeded.clear(),Do&&(this.domEventsNeeded.add("pointerdown"),t.addEventListener("pointerdown",this.onMouseMove)),this.domEventsNeeded.add("pointermove"),i.addEventListener("pointermove",this.onMouseMove),this.eventContext.useWindowEvents||(t.addEventListener("pointerenter",this.onMouseEnter),t.addEventListener("pointerleave",this.onMouseLeave));for(let r of this.events)if(r.target!==void 0){let n=r.target,s=this.onTargetChange(r);this.pairOfEventListeners.push([n,s]),n.addEventListener("requestRender",s)}}disconnect(){if(!this.events.length)return;let{domElement:e,eventElement:t}=this.eventContext;this.domEventsNeeded.clear(),Do&&e.removeEventListener("pointerdown",this.onMouseMove),t.removeEventListener("pointermove",this.onMouseMove),e.removeEventListener("pointerenter",this.onMouseEnter),e.removeEventListener("pointerleave",this.onMouseLeave);for(let[i,r]of this.pairOfEventListeners)i.removeEventListener("requestRender",r);for(let i of this.events)i.paused=!0,i.isReset=!1,gs(i.actions)}onAnimationFrameDamping(){for(let e of this.events)e.paused||this.updateSingleEvent(e,!0)}updateSingleEvent(e,t=!1){var a;this.events.forEach(o=>{o.actions.Create.forEach(l=>{l.dispatchThrottled()})});let{plane:i,limitDistance:r,limitDistanceEnabled:n}=e.data;if(e.object.getWorldPosition(Ru),e.isReset)Iu.copy(e.worldPosition0);else if(e.target)e.target.getWorldPosition(Iu);else{let{getCamera:o,raycaster:l}=this.eventContext;if(i==="custom"?(o().getWorldDirection(cI),cI.negate(),Wg.copy(cI)):i==="xy"?Wg.set(0,0,1):i==="xz"?Wg.set(0,1,0):i==="yz"&&Wg.set(1,0,0),P7.setFromNormalAndCoplanarPoint(Wg,Ru),!l.ray.intersectPlane(P7,Iu))return}if(!e.isReset){if(Iu.distanceTo(e.worldPosition0)>r&&n&&e.target)if(e.snapComplete=!1,e.data.snapDelay&&(e.delayFinished=!1,typeof window<"u"&&e.timeoutId!==null&&(window.clearTimeout(e.timeoutId),e.timeoutId=null)),e.wasOutside=!0,e.data.resetAfterDistanceLimit)Iu.copy(e.worldPosition0),e.currentDampingFactor=e.resetDampingFactor;else return;else if(e.wasOutside&&(e.data.snapDelay&&typeof window<"u"&&(e.timeoutId=window.setTimeout(()=>{e.delayFinished=!0,e.paused=!1,this.updateSingleEvent(e)},e.data.snapDelay*1e3)),e.currentDampingFactor=e.data.dampingFactor,e.wasOutside=!1),e.delayFinished===!1)return}e.data.enabledTranslation[0]===!1&&(Iu.x=Ru.x),e.data.enabledTranslation[1]===!1&&(Iu.y=Ru.y),e.data.enabledTranslation[2]===!1&&(Iu.z=Ru.z);let s=d4e(Ru,Iu,e.wasOutside?0:e.data.maxDelta);if(e.currentDampingFactor>1){let o=Wg.subVectors(s,Ru).divideScalar(e.currentDampingFactor);Ru.add(o),t&&D7(e.object,Ru),e.paused=o.length()<u4e}else D7(e.object,s),e.paused=!0;(a=e.object)==null||a.dispatchEvent({type:"beginEvent",eventName:"Follow"}),e.object.dispatchEvent(h4e)}},D1=new N,LM=new N,R1=new ft,Xg=new ri,dd=new ri,I1=new N,L1=new N,ip=new N,Lu=new N,uI=new Ka,m4e=1e-6,g4e={type:"requestRender"},v4e={type:"changeRotation"},R7=function(){let e=new ft;return function(t,i){t.parent!==null?e.multiplyMatrices(t.parent.matrixWorld,t.hiddenMatrix):e.copy(t.hiddenMatrix),i.premultiply(yre(e).invert()),t.rotation.setFromRotationMatrix(i),t.updateMatrix(),t instanceof za&&fh(t.parent)&&t.invalidateDownstreamBooleanData(!0)}}(),y4e=class{constructor(e,t,i,r){this.id=t,this.object=i,this.paused=!1,this.currentDampingFactor=1,this.isReset=!1,this.worldQuaternion0=new ri,this.timeoutId=null,this.delayFinished=!0,this.wasOutside=!1,this.data={...vz.defaultData,...e,...e.resetOnPointerLeave===void 0&&{resetOnPointerLeave:!1}},e.target===void 0||e.target==="cursor"||(this.target=r.find(e.target)),this.data.dampingFactor&&(this.currentDampingFactor=this.data.dampingFactor),this.object.getWorldQuaternion(this.worldQuaternion0),this.resetDampingFactor=80/this.data.resetSpeed+1}},x4e=class extends ua{constructor(){super(...arguments),this.events=[],this.pairOfEventListeners=[],this.pairOfUserEventListeners=[],this.onMouseMove=e=>{if(!($t.length>1)){this._lastMouseEvent=e,this.eventContext.updateRaycaster(e);for(let t of this.events)t.target===void 0&&this.updateSingleEvent(t)}},this.onMouseEnter=e=>{for(let t of this.events)t.target===void 0&&(t.isReset=!1,t.currentDampingFactor=t.data.dampingFactor)},this.onMouseLeave=e=>{for(let t of this.events)t.target===void 0&&(t.data.resetOnPointerLeave&&(t.isReset=!0,t.currentDampingFactor=t.resetDampingFactor),this.updateSingleEvent(t))},this.onScroll=e=>{if(this._lastMouseEvent){let t=new PointerEvent("pointermove",{clientX:this._lastMouseEvent.clientX,clientY:this._lastMouseEvent.clientY,bubbles:!0,cancelable:!0,view:window});this.eventContext.eventElement.dispatchEvent(t)}},this.onTargetChange=e=>()=>{this.updateSingleEvent(e)},this.createUserEventListener=e=>({eventName:t,target:i})=>{if(!t||!i)return;let r=Hb(t);r&&r==="LookAt"&&this.updateSingleEvent(e)}}connect(){let{page:e}=this.eventContext;if(e.traverseEntity(r=>{var s,a;let n=(s=r.data)==null?void 0:s.events.find(o=>o.data.type==="LookAt"&&!o.data.disabled);n&&(!e.data.globalPhysics.usePhysics||((a=r.dataPatched.physics)==null?void 0:a.rigidBody)!=="dynamic")&&this.events.push(new y4e(n.data,n.id,r,e))}),!this.events.length)return;let{domElement:t,eventElement:i}=this.eventContext;this.domEventsNeeded.clear(),Do&&(this.domEventsNeeded.add("pointerdown"),t.addEventListener("pointerdown",this.onMouseMove)),this.domEventsNeeded.add("pointermove"),i.addEventListener("pointermove",this.onMouseMove),this.eventContext.useWindowEvents?i.addEventListener("scroll",this.onScroll):(t.addEventListener("pointerenter",this.onMouseEnter),t.addEventListener("pointerleave",this.onMouseLeave));for(let r of this.events){if(r.target!==void 0){let a=this.onTargetChange(r),o=r.target;this.pairOfEventListeners.push([o,a]),o.addEventListener("requestRender",a)}let n=this.createUserEventListener(r),s=r.object;this.pairOfUserEventListeners.push([s,n]),s.addEventListener("userEvent",n)}}disconnect(){if(!this.events.length)return;let{domElement:e,eventElement:t}=this.eventContext;this.domEventsNeeded.clear(),Do&&e.removeEventListener("pointerdown",this.onMouseMove),t.removeEventListener("pointermove",this.onMouseMove),e.removeEventListener("pointerenter",this.onMouseEnter),e.removeEventListener("pointerleave",this.onMouseLeave),t.removeEventListener("scroll",this.onScroll);for(let[i,r]of this.pairOfEventListeners)i.removeEventListener("requestRender",r);for(let[i,r]of this.pairOfUserEventListeners)i.removeEventListener("userEvent",r);for(let i of this.events)i.paused=!0,i.isReset=!1}onAnimationFrameDamping(){for(let e of this.events)e.paused||this.updateSingleEvent(e)}updateSingleEvent(e){var d;let{tilt:t,axis:i,distance:r,plane:n,limitDistance:s,enabledRotation:a,limitDistanceEnabled:o}=e.data,{getCamera:l,raycaster:c}=this.eventContext,{object:u,target:h}=e;if(u.getWorldPosition(I1),!e.isReset)if(e.target)e.target.getWorldPosition(L1);else{if(n==="custom"?(l().getWorldDirection(LM),LM.negate(),uI.setFromNormalAndCoplanarPoint(LM,I1)):(n==="xy"?D1.set(0,0,1):n==="xz"?D1.set(0,1,0):n==="yz"&&D1.set(1,0,0),uI.setFromNormalAndCoplanarPoint(D1,I1)),!c.ray.intersectPlane(uI,L1))return;r>0&&(n==="custom"||n===void 0)&&L1.addScaledVector(LM,r)}if(e.isReset||(h?t==="target"?ip.copy(h.up).applyMatrix4(R1.extractRotation(h.matrixWorld)).normalize():a.some(f=>f===!1)?(i==="x"?(Lu.set(0,0,1),a[2]===!1&&Lu.set(0,1,0)):i==="y"?(Lu.set(1,0,0),a[0]===!1&&Lu.set(0,0,1)):(Lu.set(0,1,0),a[1]===!1&&Lu.set(1,0,0)),ip.copy(Lu).applyQuaternion(e.worldQuaternion0).normalize()):ip.set(0,1,0):n==="custom"?ip.set(0,1,0):ip.copy(D1)),e.isReset)dd.copy(e.worldQuaternion0);else if(I1.distanceTo(L1)>s&&o&&h)if(e.data.snapDelay&&(e.delayFinished=!1,typeof window<"u"&&e.timeoutId!==null&&(window.clearTimeout(e.timeoutId),e.timeoutId=null)),e.wasOutside=!0,e.data.resetAfterDistanceLimit)dd.copy(e.worldQuaternion0),e.currentDampingFactor=e.resetDampingFactor;else return;else{if(e.wasOutside&&(e.data.snapDelay&&typeof window<"u"&&(e.timeoutId=window.setTimeout(()=>{e.delayFinished=!0,e.paused=!1,this.updateSingleEvent(e)},e.data.snapDelay*1e3)),e.currentDampingFactor=e.data.dampingFactor,e.wasOutside=!1),e.delayFinished===!1)return;w4e(R1,L1,I1,ip,i,Lu),dd.setFromRotationMatrix(R1),Xg.setFromUnitVectors(Lu.applyQuaternion(dd),ip),a.some(f=>f===!1)&&t!=="target"&&dd.premultiply(Xg).normalize()}e.currentDampingFactor>1?(u.updateWorldMatrix(!0,!1),Xg.setFromRotationMatrix(yre(u.matrixWorld)),Xg.slerp(dd,1/e.currentDampingFactor),R7(u,R1.makeRotationFromQuaternion(Xg)),e.paused=8*(1-Xg.dot(dd))<m4e):(R7(u,R1.makeRotationFromQuaternion(dd)),e.paused=!0),(d=e.object)==null||d.dispatchEvent({type:"beginEvent",eventName:"LookAt"}),u.dispatchEvent(g4e),u.dispatchEvent(v4e)}},tl=new N,Vn=new N,cn=new N;function w4e(e,t,i,r,n,s){let a=e.elements;cn.subVectors(t,i),cn.lengthSq()===0&&(cn.z=1),cn.normalize(),Vn.crossVectors(r,cn),Vn.lengthSq()===0&&(Math.abs(r.z)===1?cn.x+=1e-4:cn.z+=1e-4,cn.normalize(),Vn.crossVectors(r,cn)),Vn.normalize(),tl.crossVectors(cn,Vn),n==="x"?s.z===1?[Vn,tl,cn]=[cn,Vn,tl]:(Vn.negate(),[Vn,cn]=[cn,Vn]):n==="y"?s.x===1?[Vn,tl,cn]=[tl,cn,Vn]:(Vn.negate(),[tl,cn]=[cn,tl]):s.x===1&&(Vn.negate(),[Vn,tl]=[tl,Vn]),a[0]=Vn.x,a[4]=tl.x,a[8]=cn.x,a[1]=Vn.y,a[5]=tl.y,a[9]=cn.y,a[2]=Vn.z,a[6]=tl.z,a[10]=cn.z}var b4e=class{constructor(e,t,i,r,n,s){this.id=e,this.data=t,this.object=i,this.entered=!1,this.actions=zn(t,t.actions,r,n,s,i)}disconnect(){gs(this.actions)}dispatchEnter(){this.actions.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())}),this.entered||(this.entered=!0,this.actions.Transition.forEach(e=>e.playFromCurrent()),this.actions.Animation.forEach(e=>e.play()),this.actions.Create.forEach(e=>e.dispatchStart()),this.actions.Particles.forEach(e=>e.dispatchBasic()),this.actions.Destroy.forEach(e=>e.dispatch()),this.actions.SwitchCamera.forEach(e=>e.playFromCurrent()),this.actions.SceneTransition.forEach(e=>e.dispatch()),this.actions.SetVariable.forEach(e=>e.checkConditions()),this.actions.SetVariable.forEach(e=>e.dispatch()),this.actions.DynamicVariablePlay.forEach(e=>e.dispatch()),this.actions.ClearLocalStorage.forEach(e=>e.dispatch()),this.actions.UserAPI.forEach(e=>e.dispatch()))}dispatchLeave(){this.actions.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())}),this.entered&&(this.entered=!1,this.actions.Create.forEach(e=>e.dispatchStop()),this.actions.Transition.forEach(e=>e.reverseFromCurrent()),this.actions.Particles.forEach(e=>e.reverseFromCurrent()),this.actions.SwitchCamera.forEach(e=>e.reverseFromCurrent()))}dispatchUserEvent(e){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),e?(this.actions.Transition.forEach(t=>t.reverseFromCurrent()),this.actions.Particles.forEach(t=>t.reverseFromCurrent()),this.actions.Animation.forEach(t=>t.reverseFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.reverseFromCurrent())):(this.actions.Transition.forEach(t=>t.playFromCurrent()),this.actions.Animation.forEach(t=>t.playFromCurrent()),this.actions.Create.forEach(t=>t.dispatch()),this.actions.Particles.forEach(t=>t.dispatchBasic()),this.actions.Destroy.forEach(t=>t.dispatch()),this.actions.SwitchCamera.forEach(t=>t.playFromCurrent())),this.actions.SceneTransition.forEach(t=>t.dispatch()),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch()),this.actions.ClearLocalStorage.forEach(t=>t.dispatch()),this.actions.UserAPI.forEach(t=>t.dispatch())}},_4e=class extends ua{constructor(e,t){super(e),this.eventManager=t,this.eventsPerObjects={},this.objects=[],this.objects2D=[],this._prevObjects=[],this.onMouseDown=i=>{$t.length>1||(this.eventContext.updateRaycaster(i),this.handleMouseHoverEvent())},this.onMouseUp=i=>{$t.length>1||this.handleMouseHoverEvent(!0)},this.onMouseMove=i=>{$t.length>1||(this.eventContext.updateRaycaster(i),this.handleMouseHoverEvent())},this.onUserEvent=({eventName:i,target:r,reverse:n})=>{var a;if(!i||!r)return;let s=Hb(i);s&&s==="MouseHover"&&(r.dispatchEvent({type:"beginEvent",eventName:"MouseHover"}),(a=this.eventsPerObjects[r.uuid])==null||a.forEach(o=>o.dispatchUserEvent(n)))}}connect(){let{page:e,sharedAssets:t}=this.eventContext,i=(n,s)=>{var a,o;if(!(!n.visible||!((a=n.data)!=null&&a.events.length))){for(let{id:l,data:c}of n.data.events)if(!c.disabled&&c.type==="MouseHover")try{let u=new b4e(l,c,n,e,t,this.eventManager);this.eventsPerObjects[n.uuid]?this.eventsPerObjects[n.uuid].push(u):this.eventsPerObjects[n.uuid]=[u]}catch{}(o=this.eventsPerObjects[n.uuid])!=null&&o.length&&this.objects.push(n instanceof ys?s:n)}};if(e.traverseEntity(n=>{var s;(n instanceof ia||n instanceof hs)&&((s=n.frame)==null||s.traverse(a=>{i(a,n)})),i(n)}),!this.objects.length)return;let{domElement:r}=this.eventContext;this.domEventsNeeded.clear(),Do&&(this.domEventsNeeded.add("pointerdown"),r.addEventListener("pointerdown",this.onMouseDown),this.domEventsNeeded.add("pointerup"),r.addEventListener("pointerup",this.onMouseUp)),this.domEventsNeeded.add("pointermove"),r.addEventListener("pointermove",this.onMouseMove),this.objects.forEach(n=>{n.addEventListener("userEvent",this.onUserEvent)})}disconnect(){if(!this.objects.length)return;let{domElement:e}=this.eventContext;this.domEventsNeeded.clear(),Do&&(e.removeEventListener("pointerdown",this.onMouseDown),e.removeEventListener("pointerup",this.onMouseUp)),e.removeEventListener("pointermove",this.onMouseMove),Object.values(this.eventsPerObjects).forEach(t=>{t.forEach(i=>{i.disconnect()})}),this.objects.forEach(t=>{t.removeEventListener("userEvent",this.onUserEvent)})}handleMouseHoverEvent(e=!1){let t=[];if(!e){let{stopRaycast:i,raycaster:r,page:n,pointerScreen:s}=this.eventContext,a=!1;if(n.uiCanvas&&(a=$u(n,[s.x,s.y],Object.keys(this.eventsPerObjects),o=>{t.push(o)})),i&&!a){let o=p2(r,n,this.objects);t=kB(o),o.forEach(l=>{var c,u;l.object instanceof ia&&$u(l.object,[((c=l==null?void 0:l.uv)==null?void 0:c.x)??0,((u=l==null?void 0:l.uv)==null?void 0:u.y)??0],Object.keys(this.eventsPerObjects),h=>{t.push(h)})})}else this.objects.forEach(o=>{var c,u;let l=aT(r,o);l&&(t.push(o),o instanceof ia&&$u(o,[((c=l==null?void 0:l.uv)==null?void 0:c.x)??0,((u=l==null?void 0:l.uv)==null?void 0:u.y)??0],Object.keys(this.eventsPerObjects),h=>{t.push(h)}))})}this._prevObjects.length&&this._prevObjects.forEach(i=>{var r;t.includes(i)||(i.dispatchEvent({type:"beginEvent",eventName:"MouseHover"}),(r=this.eventsPerObjects[i.uuid])==null||r.forEach(n=>n.dispatchLeave()))}),t.length&&t.forEach(i=>{var r;i.dispatchEvent({type:"beginEvent",eventName:"MouseHover"}),(r=this.eventsPerObjects[i.uuid])==null||r.forEach(n=>n.dispatchEnter())}),this._prevObjects=t}},S4e=class{constructor(e,t,i,r,n,s){this.id=e,this.data=t,this.object=i,this.scrollCounter=0,this.actions=zn(t,t.actions,r,n,s,i)}connect(){this.scrollCounter=0}disconnect(){gs(this.actions)}dispatch(e){this.actions.Transition.forEach(r=>{r.object.currentTransitionEvent!==this&&(r.object.currentTransitionEvent=this,r.init())});let t=e>0?1:-1;this.scrollCounter+=t,this.scrollCounter=Math.min(Math.max(this.scrollCounter,0),this.data.steps);let i=this.scrollCounter/this.data.steps;this.actions.Transition.forEach(r=>r.seek(i)),this.actions.Animation.forEach(r=>r.seek(t)),this.actions.Create.forEach(r=>r.dispatchThrottled()),this.actions.SetVariable.forEach(r=>r.checkConditions()),this.actions.SetVariable.forEach(r=>r.dispatch()),this.actions.DynamicVariablePlay.forEach(r=>r.dispatch()),this.actions.ClearLocalStorage.forEach(r=>r.dispatch()),this.actions.UserAPI.forEach(r=>r.dispatch())}dispatchUserEvent(e){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),e?(this.actions.Transition.forEach(t=>t.reverseFromCurrent()),this.actions.Animation.forEach(t=>t.reverseFromCurrent())):(this.actions.Transition.forEach(t=>{t.playFromCurrent()}),this.actions.Animation.forEach(t=>{t.playFromCurrent()})),this.actions.Create.forEach(t=>t.dispatchThrottled()),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch()),this.actions.ClearLocalStorage.forEach(t=>t.dispatch()),this.actions.UserAPI.forEach(t=>t.dispatch())}},M4e=class{constructor(e,t,i,r,n,s,a){this.id=e,this.data=t,this.object=i,this.domElement=s,this.eventManager=a,this.scrollStart=0,this.scrollEnd=0,this.actions=zn(t,t.actions,r,n,a,i)}getStickyParentElement(){let e=this.domElement;for(;e;){if(window.getComputedStyle(e).position==="sticky")return e;e=e.parentElement}return null}computeScrollBounds(){let e=this.getStickyParentElement(),t=e==null?void 0:e.parentElement,i=this.domElement.getBoundingClientRect(),r={top:i.top,bottom:i.bottom,left:i.left,right:i.right,width:i.width,height:i.height};if(t){let c=t.getBoundingClientRect(),u=window.getComputedStyle(e),h=parseFloat(u.marginTop)+parseFloat(u.marginBottom),d=parseFloat(u.top),f=parseFloat(u.bottom),p=c.height-h;if(!isNaN(d))i.top===d?(r.top+=c.top-d,r.bottom+=c.top-d):i.top<0&&(r.top-=p-i.height,r.bottom-=p-i.height);else if(!isNaN(f)){let v=document.body.clientHeight??window.innerHeight,m=window.innerWidth-(document.documentElement.clientWidth??window.innerWidth);i.bottom===v-f?(r.top+=c.top-i.height+f+m,r.bottom+=c.top-i.height+f+m):i.bottom<v-f&&(r.top-=p-i.height,r.bottom-=p-i.height)}}let n=document.body,s=document.documentElement,a=window.pageYOffset||s.scrollTop||n.scrollTop,o=s.clientTop||n.clientTop||0,l=Math.round(r.top+a-o);if(this.data.startFrom==="enter"){let c=window.innerHeight,u=r.height,h=this.data.enterAnchor,d=h==="top"?c:h==="bottom"?c-u:c-u*.5;this.scrollStart=l-d}else this.scrollStart=0;this.scrollStart+=this.data.startOffset??0,this.scrollEnd=this.scrollStart+(this.data.endAfter??400),this.box=r,this.computeScroll({x:window.scrollX,y:window.scrollY})}connect(){this.computeScrollBounds()}disconnect(){gs(this.actions)}handleResize(){this.computeScrollBounds()}get isInvalidBox(){return this.box===void 0||this.box.width===0&&this.box.height===0&&this.box.top===0&&this.box.bottom===0}computeScroll({x:e,y:t}){this.actions.Transition.forEach(n=>{n.object.currentTransitionEvent!==this&&(n.object.currentTransitionEvent=this,n.init())});let i=this.scrollEnd-this.scrollStart,r=Math.min(1,Math.max(0,(t-this.scrollStart)/i));this.actions.Transition.forEach(n=>n.seek(r)),this.actions.Animation.forEach(n=>n.seek(r)),this.actions.Create.forEach(n=>n.dispatchThrottled()),this.actions.SetVariable.forEach(n=>n.checkConditions()),this.actions.SetVariable.forEach(n=>n.dispatch()),this.actions.DynamicVariablePlay.forEach(n=>n.dispatch()),this.actions.ClearLocalStorage.forEach(n=>n.dispatch()),this.actions.UserAPI.forEach(n=>n.dispatch())}dispatch(e){this.isInvalidBox&&this.computeScrollBounds(),this.computeScroll(e)}dispatchUserEvent(e){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),e?(this.actions.Transition.forEach(t=>t.reverseFromCurrent()),this.actions.Animation.forEach(t=>t.reverseFromCurrent())):(this.actions.Transition.forEach(t=>{t.playFromCurrent()}),this.actions.Animation.forEach(t=>{t.playFromCurrent()})),this.actions.Create.forEach(t=>t.dispatchThrottled()),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch()),this.actions.ClearLocalStorage.forEach(t=>t.dispatch()),this.actions.UserAPI.forEach(t=>t.dispatch())}},E4e=class extends ua{constructor(e,t){super(e),this.managers=t,this.wheelEventsPerObject=new Map,this.scrollEventsPerObject=new Map,this.isInview=!0,this.handleResize=()=>{[...this.scrollEventsPerObject.entries()].forEach(([i,r])=>{r.forEach(n=>n.handleResize())})},this.onScroll=i=>{if(!this.isInview)return;let r={y:window.scrollY,x:window.scrollX};[...this.scrollEventsPerObject.entries()].forEach(([n,s])=>{n.dispatchEvent({type:"beginEvent",eventName:"Scroll",scroll:r}),s.forEach(a=>a.dispatch(r))})},this.onWheel=i=>{!this.isInview||i.ctrlKey||[...this.wheelEventsPerObject.entries()].forEach(([r,n])=>{r.dispatchEvent({type:"beginEvent",eventName:"Scroll",deltaY:i.deltaY}),n.forEach(s=>s.dispatch(i.deltaY))})},this.onUserEvent=({eventName:i,target:r,reverse:n})=>{var a;if(!i||!r)return;let s=Hb(i);s&&s==="Scroll"&&(r.dispatchEvent({type:"beginEvent",eventName:"Scroll"}),(a=this.wheelEventsPerObject.get(r))==null||a.forEach(o=>{o.dispatchUserEvent(n)}))}}connect(){let{page:e,sharedAssets:t,domElement:i,isExport:r}=this.eventContext,n=s=>{var a,o,l;if((a=s.data)!=null&&a.events.length){for(let{id:c,data:u}of s.data.events)if(!u.disabled&&u.type==="Scroll")if(u.trigger==="load"||!r){let h=new S4e(c,u,s,e,t,this.managers);this.wheelEventsPerObject.has(s)?(o=this.wheelEventsPerObject.get(s))==null||o.push(h):this.wheelEventsPerObject.set(s,[h])}else{let h=new M4e(c,u,s,e,t,i,this.managers);this.scrollEventsPerObject.has(s)?(l=this.scrollEventsPerObject.get(s))==null||l.push(h):this.scrollEventsPerObject.set(s,[h])}}};e.traverseEntity(s=>{var a;(s instanceof ia||s instanceof hs)&&((a=s.frame)==null||a.traverse(o=>{n(o)})),n(s)}),this.intersectionObserver=new IntersectionObserver(s=>{let a=s[0];a&&(this.isInview=a.isIntersecting)},{root:null}),this.intersectionObserver.observe(this.eventContext.domElement),[...this.wheelEventsPerObject.entries()].forEach(([s,a])=>{a.forEach(o=>o.connect()),s.addEventListener("userEvent",this.onUserEvent)}),[...this.scrollEventsPerObject.entries()].forEach(([s,a])=>{a.forEach(o=>o.connect()),s.addEventListener("userEvent",this.onUserEvent)}),[...this.wheelEventsPerObject.values()].some(s=>s.length)&&(this.domEventsNeeded.add("wheel"),window.addEventListener("wheel",this.onWheel)),[...this.scrollEventsPerObject.values()].some(s=>s.length)&&(this.domEventsNeeded.add("scroll"),window.addEventListener("scroll",this.onScroll),window.addEventListener("resize",this.handleResize))}disconnect(){window.removeEventListener("wheel",this.onWheel),window.removeEventListener("scroll",this.onScroll),window.removeEventListener("resize",this.handleResize),this.intersectionObserver.unobserve(this.eventContext.domElement),this.domEventsNeeded.clear(),[...this.wheelEventsPerObject.entries()].forEach(([e,t])=>{t.forEach(i=>i.disconnect()),e.removeEventListener("userEvent",this.onUserEvent)}),[...this.scrollEventsPerObject.entries()].forEach(([e,t])=>{t.forEach(i=>i.disconnect()),e.removeEventListener("userEvent",this.onUserEvent)})}},A4e=class{constructor(e,t,i,r,n,s){this.id=e,this.data=t,this.object=i,this.actions=zn(t,t.actions,r,n,s,i)}disconnect(){gs(this.actions)}dispatch(){this.actions.Transition.forEach(e=>{e.play()}),this.actions.Animation.forEach(e=>{e.play()}),this.actions.SwitchCamera.forEach(e=>{e.play()}),this.actions.SceneTransition.forEach(e=>{e.dispatch()}),this.actions.Reset.forEach(e=>e.dispatch()),this.actions.SetVariable.forEach(e=>e.checkConditions()),this.actions.SetVariable.forEach(e=>e.dispatch()),this.actions.DynamicVariablePlay.forEach(e=>e.dispatch()),this.actions.ClearLocalStorage.forEach(e=>e.dispatch()),this.actions.UserAPI.forEach(e=>e.dispatch()),this.actions.Create.forEach(e=>{e.dispatchFromStart()}),this.actions.Destroy.forEach(e=>{e.dispatchFromStart()})}dispatchAfter(e){this.actions.Audio.forEach(t=>{(t.interaction.data.triggerAfter??"any")===e&&(t.interaction instanceof Zp?t.interaction.audioPlayer.play():t.interaction instanceof OB&&t.interaction.dispatch())}),this.actions.Video.forEach(t=>{let i=t.interaction.data.triggerAfter??"autoplay";i===e&&(t.interaction instanceof x0?t.interaction.play(i==="autoplay"):t.interaction instanceof UB&&t.interaction.dispatch())}),this.actions.Particles.forEach(t=>{(t.data.triggerAfter??"any")===e&&t.dispatchBasic()})}dispatchUserEvent(e){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),e?(this.actions.Transition.forEach(t=>t.reverseFromCurrent()),this.actions.Animation.forEach(t=>t.reverseFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.reverseFromCurrent())):(this.actions.Transition.forEach(t=>t.playFromCurrent()),this.actions.Animation.forEach(t=>t.playFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.playFromCurrent())),this.actions.SceneTransition.forEach(t=>t.dispatch()),this.actions.Reset.forEach(t=>t.dispatch()),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch()),this.actions.ClearLocalStorage.forEach(t=>t.dispatch()),this.actions.UserAPI.forEach(t=>t.dispatch()),this.actions.Create.forEach(t=>{t.dispatch()}),this.actions.Destroy.forEach(t=>{t.dispatch()}),this.actions.Audio.forEach(t=>{t.interaction instanceof Zp?t.interaction.audioPlayer.play():t.interaction instanceof OB&&t.interaction.dispatch()}),this.actions.Video.forEach(t=>{t.interaction instanceof x0?t.interaction.play():t.interaction instanceof UB&&t.interaction.dispatch()}),this.actions.Particles.forEach(t=>{t.dispatchBasic()})}},T4e=class extends ua{constructor(e,t){super(e),this.eventManager=t,this.eventsPerObject=new Map,this.eventsAfterPerObject=new Map,this.onMouseDown=()=>{[...this.eventsAfterPerObject.entries()].forEach(([i,r])=>{i.dispatchEvent({type:"beginEvent",eventName:"Start"}),r.forEach(n=>{n.dispatchAfter("mouseDown")})})},this.onKeyDown=()=>{[...this.eventsAfterPerObject.entries()].forEach(([i,r])=>{i.dispatchEvent({type:"beginEvent",eventName:"Start"}),r.forEach(n=>{n.dispatchAfter("keyDown")})})},this.onAny=()=>{let{domElement:i,isExport:r}=this.eventContext,n=r?document:i;n.removeEventListener("pointerdown",this.onAny),n.removeEventListener("mousedown",this.onAny),document.removeEventListener("keydown",this.onAny),[...this.eventsAfterPerObject.entries()].forEach(([s,a])=>{s.dispatchEvent({type:"beginEvent",eventName:"Start"}),a.forEach(o=>{o.dispatchAfter("any")})})},this.onSceneTransitionAudioVideoPlay=()=>{[...this.eventsAfterPerObject.entries()].forEach(([i,r])=>{i.dispatchEvent({type:"beginEvent",eventName:"Start"}),r.forEach(n=>{n.actions.Audio.forEach(s=>{s.interaction instanceof Zp&&s.interaction.audioPlayer.play()}),n.actions.Video.forEach(s=>{let a=s.interaction.data.triggerAfter??"autoplay";s.interaction instanceof x0&&s.interaction.play(a==="autoplay")}),n.actions.Particles.forEach(s=>{s.dispatchBasic()})})})},this.onPlay=()=>{[...this.eventsAfterPerObject.entries()].forEach(([i,r])=>{i.dispatchEvent({type:"beginEvent",eventName:"Start"}),r.forEach(n=>{n.dispatchAfter("autoplay")})})},this.onUserEvent=({eventName:i,target:r,reverse:n})=>{var a,o;if(!i||!r)return;let s=Hb(i);s&&s==="Start"&&(r instanceof ys||r.dispatchEvent({type:"beginEvent",eventName:"Start"}),(a=this.eventsPerObject.get(r))==null||a.forEach(l=>{l.dispatchUserEvent(n)}),(o=this.eventsAfterPerObject.get(r))==null||o.forEach(l=>{l.dispatchUserEvent(n)}))}}connect(){let{sharedAssets:e,page:t}=this.eventContext,i=r=>{var n,s,a,o,l;if((n=r.data)!=null&&n.events.length)for(let{id:c,data:u}of r.data.events){if(u.disabled||u.type!=="Start")continue;let h=new A4e(c,u,r,t,e,this.eventManager);(h.actions.Transition.length||h.actions.Animation.length||h.actions.SwitchCamera.length||h.actions.Create.length||h.actions.Destroy.length||h.actions.SceneTransition.length||h.actions.Reset.length||h.actions.SetVariable.length||h.actions.DynamicVariablePlay.length||h.actions.ClearLocalStorage.length||h.actions.UserAPI.length)&&(this.eventsPerObject.has(r)?(s=this.eventsPerObject.get(r))==null||s.push(h):this.eventsPerObject.set(r,[h])),h.actions.Audio.length&&(this.eventsAfterPerObject.has(r)?(a=this.eventsAfterPerObject.get(r))==null||a.push(h):this.eventsAfterPerObject.set(r,[h])),h.actions.Video.length&&(this.hasVideoAction=!0,this.eventsAfterPerObject.has(r)?(o=this.eventsAfterPerObject.get(r))==null||o.push(h):this.eventsAfterPerObject.set(r,[h])),h.actions.Particles.length&&(this.eventsAfterPerObject.has(r)?(l=this.eventsAfterPerObject.get(r))==null||l.push(h):this.eventsAfterPerObject.set(r,[h]))}};if(t.traverseEntity(r=>{var n;(r instanceof ia||r instanceof hs)&&((n=r.frame)==null||n.traverse(s=>{i(s)})),i(r)}),[...this.eventsAfterPerObject.values()].some(r=>r.length)){if(this.eventManager.activateCount===0){let{domElement:r,isExport:n}=this.eventContext,s=n?document:r;s.addEventListener("pointerdown",this.onMouseDown,{once:!0}),s.addEventListener("mousedown",this.onMouseDown,{once:!0}),document.addEventListener("keydown",this.onKeyDown,{once:!0}),s.addEventListener("pointerdown",this.onAny),s.addEventListener("mousedown",this.onAny),document.addEventListener("keydown",this.onAny),[...this.eventsAfterPerObject.entries()].forEach(([a,o])=>{a.addEventListener("userEvent",this.onUserEvent)})}else this.onSceneTransitionAudioVideoPlay();this.onPlay()}[...this.eventsPerObject.entries()].forEach(([r,n])=>{r.dispatchEvent({type:"beginEvent",eventName:"Start"}),n.forEach(s=>s.dispatch()),r.addEventListener("userEvent",this.onUserEvent)})}disconnect(){if([...this.eventsAfterPerObject.values()].some(e=>e.length)){let{domElement:e,isExport:t}=this.eventContext,i=t?document:e;i.removeEventListener("pointerdown",this.onMouseDown),i.removeEventListener("mousedown",this.onMouseDown),document.removeEventListener("keydown",this.onKeyDown),i.removeEventListener("pointerdown",this.onAny),i.removeEventListener("mousedown",this.onAny),document.removeEventListener("keydown",this.onAny),[...this.eventsAfterPerObject.entries()].forEach(([r,n])=>{r.removeEventListener("userEvent",this.onUserEvent),n.forEach(s=>s.disconnect())})}[...this.eventsPerObject.entries()].forEach(([e,t])=>{e.removeEventListener("userEvent",this.onUserEvent),t.forEach(i=>i.disconnect())}),this.eventsPerObject.clear(),this.eventsAfterPerObject.clear()}},C4e=class{constructor(e,t,i,r,n,s){this.id=e,this.data=t,this.object=i,this.initialDisabled=!1,this.actions=zn(t,t.actions,r,n,s,i),this.target=t.target}disconnect(){gs(this.actions)}dispatch(e){this.initialDisabled||(this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),this.object.dispatchEvent({type:"beginEvent",eventName:"Collision"}),this.actions.Transition.forEach(t=>{t.data.runMode==="Toggle"?t.toggle():t.play()}),this.actions.Animation.forEach(t=>{t.data.runMode==="Toggle"?t.toggle():t.play()}),this.actions.Reset.forEach(t=>{t.dispatch()}),this.actions.Link.forEach(t=>{t.dispatch()}),this.actions.Reset.forEach(t=>{t.dispatch()}),this.actions.Create.forEach(t=>{t.dispatch()}),this.actions.Destroy.forEach(t=>{t.dispatch(e??!1)}),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch()),this.actions.Audio.forEach(t=>{t.dispatchBasic()}),this.actions.Particles.forEach(t=>{t.dispatchBasic()}),this.actions.Video.forEach(t=>{t.dispatchBasic()}),this.actions.ClearLocalStorage.forEach(t=>t.dispatch()),this.actions.UserAPI.forEach(t=>t.dispatch()))}},P4e=class extends ua{constructor(e,t,i,r,n){super(e),this.sharedVariables=t,this.eventManager=i,this.needsMouse=r,this.needsRaycast=n,this.dynamicVars=[],this.variablesToWatch=[],this.prevMouseProperty=null,this.prevRaycastProperty=null,this.pauseTime=0,this.isOutOfFocus=!1,this.events=[],this.onFrame=s=>{let a=this.eventContext.sharedAssets;if(this.rafId=window.requestAnimationFrame(this.onFrame),this.isOutOfFocus)return;let o=new Date,l=[],c=[];for(let d=0;d<this.propertiesToWatch.length;d++){let{objectId:f,property:p,prevValue:v}=this.propertiesToWatch[d],m=this.eventContext.scene.find(f),g=xz.propertyPaths[p];if(g[0]==="width"||g[0]==="height"||g[0]==="depth")m=m.geometry.userData.parameters[g[0]];else for(let y=0;y<g.length;y++)m=m[g[y]];v===null?this.propertiesToWatch[d].prevValue=m instanceof N?m.clone():m:(m instanceof N?!m.equals(v):v!==m)&&(c.push({objId:f,property:p}),m instanceof N?this.propertiesToWatch[d].prevValue.copy(m):this.propertiesToWatch[d].prevValue=m)}for(let d=0;d<this.variablesToWatch.length;d++){let{id:f,prevValue:p}=this.variablesToWatch[d],v=a.getVariable(f);v!==p&&(l.push(f),this.variablesToWatch[d].prevValue=v)}for(let d=0;d<this.dynamicVars.length;d++){let{id:f,expectedTime:p,last:v,data:m,timerSeconds:g,startValue:y}=this.dynamicVars[d],x=1e3;if((m.dynamicVariableType==="timer"||m.dynamicVariableType==="stopwatch")&&m.format==="number3decimal"?x=1:m.dynamicVariableType==="counter"?x=m.updateInterval:m.dynamicVariableType==="random"&&(x=m.isStatic?1/0:m.updateInterval),p===-1){this.dynamicVars[d].last=s,this.dynamicVars[d].expectedTime=s+x;continue}if(!((a.getDynamicVariablePlayState(f)==="Stopped"||a.getDynamicVariablePlayState(f)==="Restarted")&&(this.dynamicVars[d].last=s,this.dynamicVars[d].expectedTime=s+x,m.dynamicVariableType==="counter"&&a.getVariable(f)!==y&&(a.updateVariable(f,y),this.eventManager.requestRender()),(m.dynamicVariableType==="timer"||m.dynamicVariableType==="stopwatch")&&this.dynamicVars[d].timerSeconds!==y&&(this.dynamicVars[d].timerSeconds=y,a.updateVariable(f,ol.getFormattedTimerTime(y,m)),this.eventManager.requestRender()),a.getDynamicVariablePlayState(f)==="Restarted"&&a.setDynamicVariablePlayState(f,"Playing"),a.getDynamicVariablePlayState(f)==="Stopped"))){if(a.getDynamicVariablePlayState(f)==="Paused"){this.dynamicVars[d].deltaToExpectedTime===void 0&&(this.dynamicVars[d].deltaToExpectedTime=Math.max(this.dynamicVars[d].expectedTime-s,0)),this.dynamicVars[d].last=s-(x-this.dynamicVars[d].deltaToExpectedTime),this.dynamicVars[d].expectedTime=s+this.dynamicVars[d].deltaToExpectedTime;continue}else this.dynamicVars[d].deltaToExpectedTime=void 0;if(s>=p)if(this.dynamicVars[d].last=s,this.dynamicVars[d].expectedTime+=x,m.dynamicVariableType==="random"){let _=m.min+Math.random()*(m.max-m.min),M=m.decimals;_=Math.round(_*Math.pow(10,M))/Math.pow(10,M),a.updateVariable(f,_),l.push(f),this.eventManager.requestRender()}else if(m.dynamicVariableType==="counter"){let _=a.getVariable(f),M=a.getDynamicVariableToggleIsForward(f)??!0,S=a.getVariable(f)+m.increment*(M?1:-1);m.hasEnd&&(S=m.increment>0?Tt.clamp(S,y,m.endValue):Tt.clamp(S,m.endValue,y),S===y&&a.setDynamicVariableToggleIsForward(f,void 0),m.repeat?S===m.endValue&&(S=y):(S===y||S===m.endValue)&&a.setDynamicVariablePlayState(f,"Paused")),S!==_&&(l.push(f),a.updateVariable(f,S),this.eventManager.requestRender())}else if(m.dynamicVariableType==="time"){let _=a.getVariable(f),M=XW(o,m);if(typeof _=="object"&&"textValue"in _&&typeof M=="object"&&"textValue"in M){if(Array.isArray(_.textValue)&&Array.isArray(M.textValue)){if(_.textValue.every((S,T)=>S===M.textValue[T]))continue}else if(_.textValue===M.textValue)continue}else if(_===M)continue;a.updateVariable(f,M),l.push(f),this.eventManager.requestRender()}else{let _=Ls.isTextValue(m.endValue)?I7(m.endValue.textValue):m.endValue,M=a.getDynamicVariableToggleIsForward(f)??!0,S=g+(s-v)/1e3*(m.dynamicVariableType==="timer"?-1:1)*(M?1:-1);S=Math.max(S,0),m.hasEnd&&(S=m.dynamicVariableType==="stopwatch"?Tt.clamp(S,y,_):Tt.clamp(S,_,y),S===y&&a.setDynamicVariableToggleIsForward(f,void 0),m.repeat?Math.abs(S-_)<(m.format==="number3decimal"?1e-4:.1)&&(S=y):(Math.abs(S-y)<(m.format==="number3decimal"?1e-4:.1)||Math.abs(S-_)<(m.format==="number3decimal"?1e-4:.1))&&a.setDynamicVariablePlayState(f,"Paused")),S!==g&&(l.push(f),this.dynamicVars[d].timerSeconds=S,a.updateVariable(f,ol.getFormattedTimerTime(S,m)),this.eventManager.requestRender())}}}let u=!1;a.mouseProperty!==this.prevMouseProperty&&(this.prevMouseProperty=a.mouseProperty,u=!0);let h=!1;a.raycastProperty!==this.prevRaycastProperty&&(this.prevRaycastProperty=a.raycastProperty,h=!0),this.events.forEach(d=>{(l.includes(d.data.variableId)||c.find(f=>f.objId===d.data.objectId&&f.property===d.data.property)||d.data.variableId==="mouseProperty"&&u||d.data.variableId==="raycastProperty"&&h)&&(d.dispatch(),this.eventManager.requestRender())})},this.onBlur=()=>{this.pause()},this.onFocus=()=>{this.resume()}}pause(){this.isOutOfFocus||(this.isOutOfFocus=!0,this.pauseTime=Date.now())}resume(){if(!this.isOutOfFocus)return;this.isOutOfFocus=!1;let e=Date.now()-this.pauseTime;for(let t=0;t<this.dynamicVars.length;t++)this.dynamicVars[t].last+=e,this.dynamicVars[t].expectedTime+=e}connect(){this.eventContext.page.traverseEntity(t=>{var i;(i=t.data)==null||i.events.filter(r=>r.data.type==="VariableChange"&&!r.data.disabled).forEach(r=>{this.events.push(new D4e(r.id,r.data,t,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager))})}),this.propertiesToWatch=this.events.filter(t=>t.data.variableId==="objectProperty"&&t.data.objectId!==null).map(t=>({objectId:t.data.objectId,property:t.data.property,prevValue:null}));let e=this.eventContext.sharedAssets;this.sharedVariables.forEach(({id:t,data:i})=>{if(!("dynamicVariableType"in i)){this.events.find(n=>n.data.variableId===t)&&this.variablesToWatch.push({id:t,prevValue:e.getVariable(t)});return}let r;if(i.dynamicVariableType==="timer"||i.dynamicVariableType==="stopwatch"){let n;if(Ls.isTextValue(i.value)&&Array.isArray(i.value.textValue)){let s=i.value.textValue;s.length===3?n=s[2]+s[1]*60+s[0]*3600:n=s[1]+s[0]*60}else n=i.value;r=n,this.dynamicVars.push({id:t,last:-1,expectedTime:-1,data:i,timerSeconds:n,startValue:r})}else i.dynamicVariableType==="time"&&e.updateVariable(t,XW(new Date,i)),i.dynamicVariableType==="counter"&&(r=Ls.isTextValue(i.value)?I7(i.value.textValue):i.value),this.dynamicVars.push({id:t,last:-1,expectedTime:-1,data:i,startValue:r})}),this.rafId=window.requestAnimationFrame(this.onFrame),window.addEventListener("blur",this.onBlur),window.addEventListener("focus",this.onFocus)}disconnect(){window.removeEventListener("blur",this.onBlur),window.removeEventListener("focus",this.onFocus),this.rafId&&(window.cancelAnimationFrame(this.rafId),this.rafId=void 0),this.events.forEach(e=>e.dispose())}},D4e=class{constructor(e,t,i,r,n,s){this.id=e,this.data=t,this.object=i,this.actions=zn(t,t.actions,r,n,s,i)}dispatch(){let e=this.actions;e.Audio.forEach(t=>t.dispatchConditional()),e.Particles.forEach(t=>t.dispatchConditional()),e.Video.forEach(t=>t.dispatchConditional()),e.Create.forEach(t=>t.dispatch()),e.Destroy.forEach(t=>t.dispatch()),e.Reset.forEach(t=>t.dispatch()),e.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this),t.init()}),e.Transition.forEach(t=>t.play()),e.Animation.forEach(t=>t.play()),e.SwitchCamera.forEach(t=>t.play()),e.SceneTransition.forEach(t=>t.dispatch()),e.SetVariable.forEach(t=>t.checkConditions()),e.SetVariable.forEach(t=>t.dispatch()),e.DynamicVariablePlay.forEach(t=>t.dispatch()),e.ClearLocalStorage.forEach(t=>t.dispatch()),e.UserAPI.forEach(t=>t.dispatch())}dispose(){gs(this.actions)}};function I7(e){return e.length===3?e[2]+e[1]*60+e[0]*3600:e[1]+e[0]*60}var R4e="https://unpkg.com/@splinetool/runtime@1.9.75/build/",I4e="https://unpkg.com/@splinetool/navmesh-wasm@1.9.75/build/",L4e=`
(async function() {
	const [wasmImport, wasmBinary] = await Promise.all([
		import('${R4e}' + 'navmesh.js'),
		fetch('${I4e}' + 'navmesh.wasm').then((res) => res.arrayBuffer()),
	]);
	const wasmModule = wasmImport.default;
	self.module = await wasmModule({ wasmBinary });
	postMessage('ready');
})();
`,O4e=`
(async function() {
	const [wasmImport, wasmBinary] = await Promise.all([
		import(self.location.origin + '/_libraries/navmesh.js'),
		fetch(self.location.origin + '/_libraries/navmesh.wasm').then((res) => res.arrayBuffer()),
	]);
	const wasmModule = wasmImport.default;
	self.module = await wasmModule({ wasmBinary });
	postMessage('ready');
})();
`,z4e=`

onmessage = function(messageEvent) {
	const meshData = messageEvent.data;
	const positions = meshData[0];
	const offset = meshData[1];
	const indices = meshData[2];
	const indicesLength = meshData[3];
	const parameters = meshData[4];

	const module = self.module;
	const rc = new module.rcConfig();
	rc.cs = parameters.cs;
	rc.ch = parameters.ch;
	rc.borderSize = parameters.borderSize ? parameters.borderSize : 0;
	rc.tileSize = parameters.tileSize ? parameters.tileSize : 0;
	rc.walkableSlopeAngle = parameters.walkableSlopeAngle;
	rc.walkableHeight = parameters.walkableHeight;
	rc.walkableClimb = parameters.walkableClimb;
	rc.walkableRadius = parameters.walkableRadius;
	rc.maxEdgeLen = parameters.maxEdgeLen;
	rc.maxSimplificationError = parameters.maxSimplificationError;
	rc.minRegionArea = parameters.minRegionArea;
	rc.mergeRegionArea = parameters.mergeRegionArea;
	rc.maxVertsPerPoly = parameters.maxVertsPerPoly;
	rc.detailSampleDist = parameters.detailSampleDist;
	rc.detailSampleMaxError = parameters.detailSampleMaxError;

	if (!self.navMesh) {
		self.navMesh = new module.NavMesh();
	}
	self.navMesh.build(positions, offset, indices, indicesLength, rc);

	const navmeshData = navMesh.getNavmeshData();
	const arrView = new Uint8Array(module.HEAPU8.buffer, navmeshData.dataPointer, navmeshData.size);
	const ret = new Uint8Array(navmeshData.size);
	ret.set(arrView);
	navMesh.freeNavmeshData(navmeshData);

	postMessage(ret);
}
`,B4e=.001,F4e={cs:6,ch:2,walkableSlopeAngle:90,walkableHeight:20,walkableClimb:5,walkableRadius:0,maxEdgeLen:12,maxSimplificationError:1.3,minRegionArea:8,mergeRegionArea:20,maxVertsPerPoly:6,detailSampleDist:6,detailSampleMaxError:1},Mre,zi,Ss;ICe.then(e=>{Mre=e,zi=new e.Vec3,Ss=new e.Vec3});var U4e=new N,N4e=class{constructor(e=!1,t=!1){this.usePhysics=e,this.isExport=t,this.onPointerDown=i=>{if($t.length!==1)return;let{raycaster:r,page:n}=this.eventContext;this.eventContext.updateRaycaster(i);let s=n.raycastWithClones(r);if(s.length!==0){if(this.gameControl){let a=U4e.copy(this.gameControl.colliderWorldPosition);a.y-=this.gameControl.colliderHeight/2,this.gameControl.path=this.computePath(a,s[0].point)}this.eventContext.requestRender()}},this.traverseWithPhysics=(i,r)=>n=>{var d,f,p,v,m,g,y;let s;if(n instanceof fl)if(n.objectForSample){if(n.objectForSample.dataPatched.physics.fusedBody)return;s=n.object}else return n.object.dataPatched.physics.fusedBody===!0&&n.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(n instanceof Os)s=n.object;else if(s=n,((d=s.dataPatched.cloner)==null?void 0:d.disabled)===!1&&((f=s.dataPatched.cloner)==null?void 0:f.hideBase)&&((p=s.dataPatched.physics)==null?void 0:p.fusedBody)!==!0)return!0;if(r&&!s.userData.navmesh)return;let a=s.dataPatched;if(!a.visible&&((v=a.physics)==null?void 0:v.enabled)!==!0)return!0;n.updateMatrixWorldSVD();let o=oT(a),l=s.userData.hasDestroy,c=s.userData.hasDrag,u=!1,h=!1;for(let x of a.events)x.data.disabled!==!0&&(x.data.type==="GameControl"?u=!0:x.data.type==="Follow"&&(h=!0));if(u||o||h||l||c)return!0;if(this.usePhysics&&((m=a.physics)==null?void 0:m.rigidBody)==="dynamic"){if(this.usePhysics&&((g=a.physics)!=null&&g.fusedBody))return!0}else if("geometry"in n&&n.geometry&&i.push(Ju(n.geometry,n.matrixWorld)),this.usePhysics&&((y=a.physics)==null?void 0:y.fusedBody))return n.traverseObject((x,_)=>{var T,E;if(_===0)return;let M;if(x instanceof fl)if(x.objectForSample){if(x.objectForSample.dataPatched.physics.fusedBody)return;M=x.object}else return x.object.dataPatched.physics.fusedBody===!0&&x.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(x instanceof Os)M=x.object;else if(M=x,(T=x.dataPatched.cloner)==null?void 0:T.hideBase)return!0;let S=M.dataPatched;if(!S.visible&&((E=S.physics)==null?void 0:E.enabled)!==!0)return!0;"geometry"in x&&x.geometry&&i.push(Ju(x.geometry,x.matrixWorld))}),!0},this.traverseNoPhysics=(i,r)=>n=>{let s;if(n instanceof fl)return;n instanceof Os?s=n.object:s=n;let a=s.dataPatched;if(a.physics.enabled==="visibility"?!a.visible:!a.physics.enabled)return!0;if(r&&!s.userData.navmesh)return;let o=n.geometry,l=s.userData.hasDestroy===!0,c=s.userData.hasDrag===!0;if(oT(a)||l||c||s.dataPatched.events.some(u=>u.data.disabled!==!0&&u.data.type==="GameControl"))return!0;o&&i.push(Ju(o,n.matrixWorld))},this.navmeshWasm=Mre,this.navMesh=new this.navmeshWasm.NavMesh,this._workerURL=URL.createObjectURL(new Blob([(t?L4e:O4e)+z4e])),this._worker=new Worker(this._workerURL)}init(e,t,i){this.gameControl=t,this.eventContext=i,this.setDefaultQueryExtent(new N().setScalar(e.ch*e.walkableRadius*1.2)),this._worker.onmessage=()=>{this.createNavMesh(i.page,e,r=>{this.buildFromNavmeshData(r.data)})},this.eventContext.renderer.domElement.addEventListener("pointerdown",this.onPointerDown)}createNavMesh(e,t,i){t.objects.forEach(l=>{var u;let c=e.scene.find(l);c.traverseEntity(h=>{h.userData.navmesh=!0}),(u=c.cloner)==null||u.traverseObject(h=>{h.userData.navmesh=!0})});let r=[],n=(this.usePhysics?this.traverseWithPhysics:this.traverseNoPhysics)(r,t.zones==="custom");if(e.traverseChildren(n),t.objects.forEach(l=>{var u;let c=e.scene.find(l);c.traverseEntity(h=>{h.userData.navmesh=void 0}),(u=c.cloner)==null||u.traverseObject(h=>{h.userData.navmesh=void 0})}),r.length===0)return!1;let s=Qp(r),{positions:a,triIndices:o}=jC(s.getAttribute("position"),s.getIndex());return this._worker.postMessage([a,a.length/3,o,o.length,{...F4e,...t}]),this._worker.onmessage=i,!0}createDebugNavGeometry(){let e,t,i=this.navMesh.getDebugNavMesh(),r=i.getTriangleCount(),n=new Uint32Array(r*3),s=new Float32Array(r*3*3);for(e=0;e<r*3;e++)n[e]=e;for(e=0;e<r;e++)for(t=0;t<3;t++){let o=i.getTriangle(e).getPoint(t);s[e*9+t*3+0]=o.x,s[e*9+t*3+1]=o.y,s[e*9+t*3+2]=o.z}let a=new Nt;return a.setIndex(new Qt(n,1)),a.setAttribute("position",new Qt(s,3)),a}getClosestPoint(e){return zi.x=e.x,zi.y=e.y,zi.z=e.z,this.navMesh.getClosestPoint(zi)}getClosestPointToRef(e,t){zi.x=e.x,zi.y=e.y,zi.z=e.z;let i=this.navMesh.getClosestPoint(zi);t.set(i.x,i.y,i.z)}getRandomPointAround(e,t){return zi.x=e.x,zi.y=e.y,zi.z=e.z,this.navMesh.getRandomPointAround(zi,t)}getRandomPointAroundToRef(e,t,i){zi.x=e.x,zi.y=e.y,zi.z=e.z;let r=this.navMesh.getRandomPointAround(zi,t);i.set(r.x,r.y,r.z)}moveAlong(e,t){return zi.x=e.x,zi.y=e.y,zi.z=e.z,Ss.x=t.x,Ss.y=t.y,Ss.z=t.z,this.navMesh.moveAlong(zi,Ss)}moveAlongToRef(e,t,i){return zi.x=e.x,zi.y=e.y,zi.z=e.z,Ss.x=t.x,Ss.y=t.y,Ss.z=t.z,this.navMesh.moveAlong(zi,Ss)}computePath(e,t){let i=this.getClosestPoint(t);if(Ss.x=i.x,Ss.y=i.y,Ss.z=i.z,Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2)+Math.pow(t.z-i.z,2))>this.getDefaultQueryExtent().y)return[];this.getClosestPoint(e);let r=this.navMesh.computePath(zi,Ss),n=r.getPointCount(),s=[];for(let a=0;a<n;a++){let o=r.getPoint(a);s.push(new N(o.x,o.y,o.z))}return s}createCrowd(e,t){return new k4e(this,e,t)}setDefaultQueryExtent(e){zi.x=e.x,zi.y=e.y,zi.z=e.z,this.navMesh.setDefaultQueryExtent(zi)}getDefaultQueryExtent(){return this.navMesh.getDefaultQueryExtent()}buildFromNavmeshData(e){let t=e.length*e.BYTES_PER_ELEMENT,i=this.navmeshWasm._malloc(t),r=new Uint8Array(this.navmeshWasm.HEAPU8.buffer,i,t);r.set(e);let n=new this.navmeshWasm.NavmeshData;n.dataPointer=r.byteOffset,n.size=e.length,this.navMesh.buildFromNavmeshData(n),this.navmeshWasm._free(r.byteOffset)}getNavmeshData(){let e=this.navMesh.getNavmeshData(),t=new Uint8Array(this.navmeshWasm.HEAPU8.buffer,e.dataPointer,e.size),i=new Uint8Array(e.size);return i.set(t),this.navMesh.freeNavmeshData(e),i}getDefaultQueryExtentToRef(e){let t=this.navMesh.getDefaultQueryExtent();e.set(t.x,t.y,t.z)}dispose(){var e;this.navMesh.destroy(),this._worker.terminate(),URL.revokeObjectURL(this._workerURL),(e=this.eventContext)==null||e.renderer.domElement.removeEventListener("pointerdown",this.onPointerDown)}addCylinderObstacle(e,t,i){return zi.x=e.x,zi.y=e.y,zi.z=e.z,this.navMesh.addCylinderObstacle(zi,t,i)}addBoxObstacle(e,t,i){return zi.x=e.x,zi.y=e.y,zi.z=e.z,Ss.x=t.x,Ss.y=t.y,Ss.z=t.z,this.navMesh.addBoxObstacle(zi,Ss,i)}removeObstacle(e){this.navMesh.removeObstacle(e)}isSupported(){return this.navmeshWasm!==void 0}},k4e=class{constructor(e,t,i){this.navmeshWasmWrapper=e,this.transforms=[],this.agents=new Array,this.reachRadii=new Array,this._agentDestinationArmed=new Array,this._agentDestination=new Array,this.crowd=new this.navmeshWasmWrapper.navmeshWasm.Crowd(t,i,this.navmeshWasmWrapper.navMesh.getNavMesh())}onReachTarget(e,t){}addAgent(e,t,i){let r=new this.navmeshWasmWrapper.navmeshWasm.dtCrowdAgentParams;r.radius=t.radius,r.height=t.height,r.maxAcceleration=t.maxAcceleration,r.maxSpeed=t.maxSpeed,r.collisionQueryRange=t.collisionQueryRange,r.pathOptimizationRange=t.pathOptimizationRange,r.separationWeight=t.separationWeight,r.updateFlags=7,r.obstacleAvoidanceType=0,r.queryFilterType=0,r.userData=0;let n=this.crowd.addAgent(new this.navmeshWasmWrapper.navmeshWasm.Vec3(e.x,e.y,e.z),r);return this.transforms.push(i),this.agents.push(n),this.reachRadii.push(t.reachRadius?t.reachRadius:t.radius),this._agentDestinationArmed.push(!1),this._agentDestination.push(new N(0,0,0)),n}getAgentPosition(e){return this.crowd.getAgentPosition(e)}getAgentPositionToRef(e,t){let i=this.crowd.getAgentPosition(e);t.set(i.x,i.y,i.z)}getAgentVelocity(e){return this.crowd.getAgentVelocity(e)}getAgentVelocityToRef(e,t){let i=this.crowd.getAgentVelocity(e);t.set(i.x,i.y,i.z)}getAgentNextTargetPath(e){return this.crowd.getAgentNextTargetPath(e)}getAgentNextTargetPathToRef(e,t){let i=this.crowd.getAgentNextTargetPath(e);t.set(i.x,i.y,i.z)}getAgentState(e){return this.crowd.getAgentState(e)}overOffmeshConnection(e){return this.crowd.overOffmeshConnection(e)}agentGoto(e,t){this.crowd.agentGoto(e,new this.navmeshWasmWrapper.navmeshWasm.Vec3(t.x,t.y,t.z));let i=this.agents.indexOf(e);i>-1&&(this._agentDestinationArmed[i]=!0,this._agentDestination[i].set(t.x,t.y,t.z))}agentTeleport(e,t){this.crowd.agentTeleport(e,new this.navmeshWasmWrapper.navmeshWasm.Vec3(t.x,t.y,t.z))}updateAgentParameters(e,t){let i=this.crowd.getAgentParameters(e);t.radius!==void 0&&(i.radius=t.radius),t.height!==void 0&&(i.height=t.height),t.maxAcceleration!==void 0&&(i.maxAcceleration=t.maxAcceleration),t.maxSpeed!==void 0&&(i.maxSpeed=t.maxSpeed),t.collisionQueryRange!==void 0&&(i.collisionQueryRange=t.collisionQueryRange),t.pathOptimizationRange!==void 0&&(i.pathOptimizationRange=t.pathOptimizationRange),t.separationWeight!==void 0&&(i.separationWeight=t.separationWeight),this.crowd.setAgentParameters(e,i)}removeAgent(e){this.crowd.removeAgent(e);let t=this.agents.indexOf(e);t>-1&&(this.agents.splice(t,1),this.transforms.splice(t,1),this.reachRadii.splice(t,1),this._agentDestinationArmed.splice(t,1),this._agentDestination.splice(t,1))}getAgents(){return this.agents}update(e){if(this.navmeshWasmWrapper.navMesh.update(),e<=B4e)return;let t=1/60,i=10;{let r=Math.floor(e/t);r>i&&(r=i),r<1&&(r=1);let n=e/r;for(let s=0;s<r;s++)this.crowd.update(n)}for(let r=0;r<this.agents.length;r++){let n=this.agents[r],s=this.getAgentPosition(n);if(this.transforms[r].copy(s),this._agentDestinationArmed[r]){let a=s.x-this._agentDestination[r].x,o=s.z-this._agentDestination[r].z,l=this.reachRadii[r],c=this._agentDestination[r].y-this.reachRadii[r],u=this._agentDestination[r].y+this.reachRadii[r],h=a*a+o*o;s.y>c&&s.y<u&&h<l*l&&(this.onReachTarget(n,this._agentDestination[r]),this._agentDestinationArmed[r]=!1)}}}setDefaultQueryExtent(e){let t=new this.navmeshWasmWrapper.navmeshWasm.Vec3(e.x,e.y,e.z);this.crowd.setDefaultQueryExtent(t)}getDefaultQueryExtent(){return this.crowd.getDefaultQueryExtent()}getDefaultQueryExtentToRef(e){let t=this.crowd.getDefaultQueryExtent();e.set(t.x,t.y,t.z)}getCorners(e){let t,i=this.crowd.getCorners(e),r=i.getPointCount(),n=[];for(t=0;t<r;t++){let s=i.getPoint(t);n.push(new N(s.x,s.y,s.z))}return n}dispose(){this.crowd.destroy()}};function V4e(e){let t=!1;return e.scene.objects.forEach(i=>{i.data.type==="Page"&&!t&&i.data.publish.gameControlObject&&Gw.traverseModuleInstances(e,i.id,(r,n,s)=>{for(let a of s)a.data.type==="GameControl"&&a.data.navmesh.enabled&&(t=!0)})}),t}var G4e={type:"change"},L7={type:"changeZoom"},H4e={type:"changePan"},rp={type:"start"},np={type:"end",changed:!0},j4e={type:"end",changed:!1},hI=new ri,O7=new Me,W4e=2*Math.PI,X4e=1e-8,q4e=.01,dI=new N,OM=new Me,fI=new N,zM=new ri,z7=new ft,Y4e={type:"requestRender"},Ere=class extends Vs{constructor(e,t,i={isPlayMode:!1,isExport:!1}){super(),this.object=e,this.domElement=t,this.options=i,this.enabled=!0,this.useKeyEvents=!0,this.enableDamping=!1,this.enableZoom=!0,this.enableRotate=!0,this.enablePan=!0,this.autoRotate=!1,this.rotationLimitsMode=0,this.panLimitsMode=0,this.rotationSoftLimit=2,this.panSoftLimit=2,this.hoverRotatePanMode=0,this.zoomLimitsEnabled=!1,this.mouseButtons=[0,5],this.mouseButtonsPlay=[3,4,5],this.touches=[null,Zo.DOLLY_ROTATE,Zo.PAN],this.offset=new N,this.eye=new N,this.lastPosition=new N,this.lastQuaternion=new ri,this.current=new Me,this.overShoot=new Me,this.overRatio=new Me,this.spherical=new cj,this.sphericalDelta=new cj,this.panOffset=new N,this.panLeftV=new N,this.panUpV=new N,this.panV=new N,this.rotateStart=new Me,this.rotateEnd=new Me,this.rotateDelta=new Me,this.panStart=new Me,this.panEnd=new Me,this.panDelta=new Me,this.dollyStart=new Me,this.dollyEnd=new Me,this.dollyDelta=new Me,this.rotationRangeFactor=new Me,this.panRangeFactor=new Me,this.state=-1,this.zoomChanged=!1,this.isPointerDown=!1,this.isThetaFlipped=!1,this.prevScale=0,this.scale=1,this.gesture=!1,this.timer=-1,this.timerHover=-1,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPhi=0,this.maxPhi=Math.PI,this.minTheta=-1/0,this.maxTheta=1/0,this.minH=0,this.maxH=Math.PI,this.minV=-1/0,this.maxV=1/0,this.autoRotateClockwise=!0,this.isPanOverShoot=!1,this.isRotateOverShoot=!1,this.resetHoverEffectOnPointerLeave=!1,this.hasChange=!1,this.useWindowEvents=!1,this.isTouchZoom=!0,this.autoRotateSpeed=2,this.dampingFactor=.125,this.zoomSpeed=2,this.rotateSpeed=1,this.panSpeed=1,this.hoverRotatePanStrength=.1,this.hoverRotateDamping=this.dampingFactor,this.thetaIsFree=!1,this.phiIsFree=!1,this.needsUpdate=!0,this.onCameraChange=r=>{this.object.removeEventListener("beginState",this.onBeginState),this.object.removeEventListener("completeState",this.onCompleteState),this.object.removeEventListener("cameraChange",this.onCameraChange),this.object=r.camera,this.object.addEventListener("beginState",this.onBeginState),this.object.addEventListener("completeState",this.onCompleteState),this.object.addEventListener("cameraChange",this.onCameraChange)},this.update=()=>{this.object.updateWorldMatrix(!0,!1),this.object.matrixWorld.decompose(fI,zM,dI),this.offset.copy(fI).sub(this.target),this.spherical.setFromVector3(this.offset),this.object.isUpVectorFlipped&&(this.spherical.phi*=-1,this.spherical.theta-=Math.PI),this.autoRotate&&this.state===-1&&this.rotateLeft((this.autoRotateClockwise===!0?1:-1)*this.getAutoRotationAngle()),this.rotationLimitsMode!==0&&this.applyLimits(this.sphericalDelta,this.rotationLimitsMode,this.rotationSoftLimit,this.maxTheta,this.minTheta,this.maxPhi,this.minPhi,this.rotationRangeFactor),this.rotationLimitsMode!==2&&(this.spherical.phi+=this.sphericalDelta.phi),(this.rotationLimitsMode!==1||this.autoRotate===!0)&&(this.spherical.theta+=this.sphericalDelta.theta),this.spherical.radius*=this.scale,this.zoomLimitsEnabled&&this.object.isPerspectiveCamera&&(this.spherical.radius=Math.max(this.minDistance,Math.min(this.maxDistance,this.spherical.radius))),this.panLimitsMode!==0&&(this.target.applyQuaternion(hI.copy(zM).invert()),this.panOffset.applyQuaternion(hI),this.applyLimits(this.panOffset,this.panLimitsMode,this.panSoftLimit,this.maxH,this.minH,this.maxV,this.minV,this.panRangeFactor),this.target.applyQuaternion(zM),this.panOffset.applyQuaternion(zM)),this.panLimitsMode===2&&(this.panOffset.y=0),this.panLimitsMode===1&&(this.panOffset.x=0),this.state===-1&&!this.gesture?(this.panOffset.multiplyScalar(1-this.dampingFactor),this.target.add(this.panOffset)):(this.target.add(this.panOffset),this.panOffset.set(0,0,0)),this.offset.setFromSpherical(this.spherical),fI.copy(this.target).add(this.offset),this.object.position.copy(this.target).add(this.offset),this.object.parent&&(z7.copy(this.object.parent.matrixWorld).invert(),this.object.position.applyMatrix4(z7));let r=this.spherical.phi%W4e;if(this.eye.copy(this.offset).normalize(),this.object.up.copy(rr.DEFAULT_UP).applyAxisAngle(this.eye,this.object.angleOffsetFromUp),r>0&&r>Math.PI||r<0&&r>-Math.PI?(this.object.up.negate(),this.object.lookAt(this.target),this.object.isUpVectorFlipped=!0):(this.object.lookAt(this.target),this.object.isUpVectorFlipped=!1),this.state===-1||this.enableDamping===!0){let n=this.hoverRotatePanMode===1?this.hoverRotateDamping:this.dampingFactor;this.sphericalDelta.theta*=1-n,this.sphericalDelta.phi*=1-n}else this.sphericalDelta.set(0,0,0);return this.scale=1,this.zoomChanged||this.lastPosition.distanceToSquared(this.object.position)>q4e||8*(1-this.lastQuaternion.dot(this.object.quaternion))>X4e?(this.dispatchEvent(G4e),this.object.dispatchEvent(Y4e),this.lastPosition.copy(this.object.position),this.lastQuaternion.copy(this.object.quaternion),this.zoomChanged=!1,!0):(this.isPanOverShoot=!1,this.isRotateOverShoot=!1,this.object.wasMovedBySwitchCameraAction=!1,this.sphericalDelta.set(0,0,0),this.panOffset.set(0,0,0),!1)},this.onPointerDown=r=>{this.enabled!==!1&&(r.pointerType==="touch"||r.pointerType==="pen"&&Do?this.onPointerDownTouch(r):this.onPointerDownMouse(r),this.state!==-1&&(this.isPointerDown=!0,this.dispatchEvent(rp),this.domElement.addEventListener("pointermove",this.onPointerMove),this.domElement.addEventListener("pointerup",this.onPointerUp),r.stopPropagation(),r.pointerType==="touch"||r.pointerType==="pen"&&Do||this.domElement.setPointerCapture(r.pointerId)))},this.onPointerLeave=r=>{this.resetHoverEffectOnPointerLeave&&!this.useWindowEvents?(this.hoverRotatePanMode===1?(this.sphericalDelta.theta=-this.spherical.theta,this.sphericalDelta.phi=-this.spherical.phi,dI.subVectors(this.position0,this.target0),this.spherical.setFromVector3(dI),this.sphericalDelta.theta+=this.spherical.theta,this.sphericalDelta.phi+=this.spherical.phi,this.sphericalDelta.theta/=8,this.sphericalDelta.phi/=8):this.hoverRotatePanMode===2&&this.panOffset.subVectors(this.target0,this.target).divideScalar(8),this.update()):this.pointerLeaveEvent=r},this.onPointerEnter=r=>{this.resetHoverEffectOnPointerLeave||this.pointerLeaveEvent===void 0?OM.set(r.clientX-this.domElement.clientWidth/2,r.clientY-this.domElement.clientHeight/2):OM.set(r.clientX-this.pointerLeaveEvent.clientX,r.clientY-this.pointerLeaveEvent.clientY),this.hoverRotatePanMode===1?(this.rotateDelta.copy(OM).multiplyScalar(this.rotateSpeed*this.hoverRotatePanStrength).rotateAround(O7,-this.object.angleOffsetFromUp),this.rotateLeft(2*Math.PI*this.rotateDelta.x/this.domElement.clientHeight),this.rotateUp(2*Math.PI*this.rotateDelta.y/this.domElement.clientHeight),this.rotateStart.set(r.clientX,r.clientY)):this.hoverRotatePanMode===2&&(this.panDelta.copy(OM).multiplyScalar(this.panSpeed*this.hoverRotatePanStrength),this.pan(this.panDelta.x,this.panDelta.y),this.panStart.set(r.clientX,r.clientY)),this.update()},this.onPointerMove=r=>{this.enabled!==!1&&(this.checkRaycastLock()||(r.pointerType==="touch"||r.pointerType==="pen"&&Do?this.onPointerMoveTouch(r):this.onPointerMoveMouse(r),r.stopPropagation()))},this.onPointerUp=r=>{this.isPointerDown=!1,$t.length===0&&(this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp)),$t.length>1&&r.preventDefault(),this.hasChange?this.dispatchEvent(np):this.dispatchEvent(j4e),this.state=-1,r&&(r.stopPropagation(),r.pointerType==="touch"||r.pointerType==="pen"&&Do||this.domElement.releasePointerCapture(r.pointerId))},this.onPointerDownMouse=r=>{let n;switch(this.useKeyEvents?n=this.mouseButtons[r.button]:n=this.mouseButtonsPlay[r.button],n){case 0:if(r.altKey===!0&&!r.shiftKey&&!WS(r)){if(this.enableRotate===!1)return;this.handleMouseDownRotate(r),this.state=0}else if(this.key===" "){if(this.enablePan===!1)return;this.handleMouseDownPan(r),this.state=2}break;case 4:if(this.enablePan===!1)return;this.handleMouseDownPan(r),this.state=2;break;case 3:if(WS(r)||r.shiftKey){if(this.enablePan===!1)return;this.handleMouseDownPan(r),this.state=2}else{if(this.enableRotate===!1)return;this.handleMouseDownRotate(r),this.state=0}break;case 5:if(WS(r)||r.shiftKey){if(this.enableRotate===!1)return;this.handleMouseDownRotate(r),this.state=0}else{if(this.enablePan===!1)return;this.handleMouseDownPan(r),this.state=2}break;default:this.state=-1}},this.onPointerMoveMouse=r=>{switch(this.state){case 0:if(this.enableRotate===!1)return;this.handleMouseMoveRotate(r);break;case 1:if(this.enableZoom===!1)return;this.handleMouseMoveDolly(r);break;case 2:if(this.enablePan===!1)return;this.handleMouseMovePan(r);break}this.object.wasMovedByUser=!0},this.onPointerDownTouch=r=>{switch($t.length>1&&r.preventDefault(),this.touches[$t.length-1]){case Zo.ROTATE:if(this.enableRotate===!1){this.state=-1;return}this.handleTouchStartRotate(),this.state=3;break;case Zo.PAN:if(this.enablePan===!1){this.state=-1;return}this.handleTouchStartPan(),this.state=4;break;case Zo.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this.handleTouchStartDollyPan(),this.state=5;break;case Zo.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this.handleTouchStartDollyRotate(),this.state=6;break;default:this.state=-1}},this.onPointerMoveTouch=r=>{switch($t.length>1&&r.preventDefault(),this.state){case 3:if(this.enableRotate===!1)return;this.handleTouchMoveRotate(r),this.update();break;case 4:if(this.enablePan===!1)return;this.handleTouchMovePan(r),this.update();break;case 5:if(this.enableZoom===!1&&this.enablePan===!1)return;this.handleTouchMoveDollyPan(r),this.update();break;case 6:if(this.enableZoom===!1&&this.enableRotate===!1)return;this.handleTouchMoveDollyRotate(r),this.update();break;default:this.state=-1}this.object.wasMovedByUser=!0},this.dispatchEndDebounced=Fw(()=>this.dispatchEvent(np),33),this.onMouseWheel=r=>{this.enabled===!1||this.enableZoom===!1&&this.enablePan===!1||this.checkRaycastLock()||(!this.options.isExport&&this.domElement.clientHeight===document.body.clientHeight&&this.domElement.clientWidth===document.body.clientWidth&&r.preventDefault(),this.dispatchEvent(rp),this.handleMouseWheel(r),this.dispatchEndDebounced(),this.object.wasMovedByUser=!0)},this.onGesture=r=>{if(r.preventDefault(),this.enabled!==!1&&!this.checkRaycastLock()&&!zb)if(r.type==="gesturechange"){if(this.enableZoom===!1||this.isTouchZoom===!1)return;this.dispatchEvent(rp),r.scale>this.prevScale?this.dollyIn(this.getZoomScale()):r.scale<this.prevScale&&this.dollyOut(this.getZoomScale()),this.prevScale=r.scale,this.update(),this.object.wasMovedByUser=!0}else this.dispatchEvent(np)},this.onContextMenu=r=>{r.preventDefault()},this.onTouchEnd=r=>{r.preventDefault()},this.onKeyDown=r=>{this.enabled!==!1&&(this.key=r.key,r.key===" "&&this.dispatchEvent(rp))},this.onKeyUp=r=>{this.enabled!==!1&&(this.key=void 0,this.state!==-1&&r.key==="Alt"&&this.onPointerUp($t[0]),r.key===" "&&this.dispatchEvent(np))},this.onPointerHover=r=>{r.pointerType!=="mouse"||this.enabled===!1||this.state!==-1||this.hoverRotatePanMode===2&&this.isPanOverShoot||this.hoverRotatePanMode===1&&this.isRotateOverShoot||(this.isPointerDown=!0,this.hoverRotatePanMode===2?this.handleMouseMovePan(r,this.hoverRotatePanStrength):this.hoverRotatePanMode===1&&this.handleMouseMoveRotate(r,this.hoverRotatePanStrength))},this.onBeginState=()=>{this.enabled=!1,this.needsUpdate=!1},this.onCompleteState=r=>{r.isfromEntity&&this.options.isPlayMode||(this.enabled=!0,this.needsUpdate=!0,this.object.updateUp(),this.object.getTarget(this.target))},this.target=this.object.getTarget(),this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.quat0=this.object.quaternion.clone(),this.isUpVectorFlipped0=this.object.isUpVectorFlipped,this.offset.copy(this.object.position).sub(this.target),this.spherical.setFromVector3(this.offset),this.object.isUpVectorFlipped&&(this.spherical.phi*=-1,this.spherical.theta-=Math.PI),this.initialSphericalRadius=this.spherical.radius,this.addEventListenersToCamera()}dispatchEvent(e){e.type==="start"?this.hasChange=!1:this.hasChange=!0,super.dispatchEvent(e)}addEventListenersToCamera(){this.object.addEventListener("beginState",this.onBeginState),this.object.addEventListener("completeState",this.onCompleteState),this.object.addEventListener("cameraChange",this.onCameraChange)}removeEventListenersFromCamera(){this.object.removeEventListener("beginState",this.onBeginState),this.object.removeEventListener("completeState",this.onCompleteState),this.object.removeEventListener("cameraChange",this.onCameraChange)}updateUseWindowEvents(e){if(window.removeEventListener("pointermove",this.onPointerHover),this.domElement.removeEventListener("pointermove",this.onPointerHover),this.useWindowEvents=e,this.hoverRotatePanMode!==0&&(this.useWindowEvents?window.addEventListener("pointermove",this.onPointerHover):this.domElement.addEventListener("pointermove",this.onPointerHover)),this.domElement.removeEventListener("pointerleave",this.onPointerLeave),this.domElement.removeEventListener("pointerenter",this.onPointerEnter),window.removeEventListener("pointerleave",this.onPointerLeave),window.removeEventListener("pointerenter",this.onPointerEnter),this.hoverRotatePanMode!==0&&!this.useWindowEvents){let t=this.useWindowEvents?window:this.domElement;t.addEventListener("pointerleave",this.onPointerLeave),t.addEventListener("pointerenter",this.onPointerEnter)}}fromJSON(e,t){this.setEnableDampingSpeed(e.enableDamping),this.enablePan=e.enablePan,this.enableZoom=e.enableZoom,this.enableRotate=e.enableRotate,this.rotationLimitsMode=e.rotationLimitsMode,this.thetaIsFree=e.rotationHorizontalOffset.min===e.rotationHorizontalOffset.max&&e.rotationHorizontalOffset.min===Math.PI,this.phiIsFree=e.rotationVerticalOffset.min===e.rotationVerticalOffset.max&&e.rotationVerticalOffset.min===Math.PI,this.panLimitsMode=e.panLimitsMode,this.panSoftLimit=e.panSoftLimit,this.rotationSoftLimit=e.rotationSoftLimit,this.hoverRotatePanMode=e.hoverRotatePanMode,this.hoverRotateDamping=e.hoverRotateDamping??this.dampingFactor,this.useWindowEvents=t==="window",this.hoverRotatePanMode!==0&&(this.useWindowEvents?window.addEventListener("pointermove",this.onPointerHover):this.domElement.addEventListener("pointermove",this.onPointerHover));let i=e.hoverRotatePanStrength/100;this.hoverRotatePanStrength=i**2,this.zoomLimitsEnabled=e.zoomLimitsEnabled,this.minZoom=e.zoomLimits.min,this.maxZoom=Math.max(e.zoomLimits.min,e.zoomLimits.max),this.minDistance=1e3/this.maxZoom,this.maxDistance=Math.max(this.minDistance,1e3/e.zoomLimits.min),this.autoRotate=e.autoRotate,this.autoRotateSpeed=e.autoRotateSpeed,this.autoRotateClockwise=e.autoRotateClockwise;let r=this.object.getTarget().applyQuaternion(hI.copy(this.object.quaternion).invert());this.minV=-e.panVerticalOffset.min+r.y,this.maxV=e.panVerticalOffset.max+r.y,this.minH=-e.panHorizontalOffset.min+r.x,this.maxH=e.panHorizontalOffset.max+r.x,this.panRangeFactor.set(this.maxH-this.minH,this.maxV-this.minV).divideScalar(2),this.rotationRangeFactor.setScalar(Math.PI).divideScalar(4),this.minPhi=Ic(this.spherical.phi-e.rotationVerticalOffset.min),this.maxPhi=Ic(this.spherical.phi+e.rotationVerticalOffset.max),this.minTheta=Ic(Ic(this.spherical.theta)-e.rotationHorizontalOffset.min),this.maxTheta=Ic(Ic(this.spherical.theta)+e.rotationHorizontalOffset.max),this.isThetaFlipped=this.minTheta>this.maxTheta,e.orbitTouches===1&&(this.touches[0]=Zo.ROTATE),e.panTouches===1&&(this.touches[0]=Zo.PAN),e.orbitTouches===2&&(this.touches[1]=Zo.DOLLY_ROTATE),e.panTouches===2&&(this.touches[1]=Zo.DOLLY_PAN),e.orbitTouches===3&&(this.touches[2]=Zo.ROTATE),e.panTouches===3&&(this.touches[2]=Zo.PAN),this.isTouchZoom=e.isTouchZoom,this.resetHoverEffectOnPointerLeave=e.resetHoverEffectOnPointerLeave??!1}connect(){if(this.domElement.addEventListener("contextmenu",this.onContextMenu),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("wheel",this.onMouseWheel),window.addEventListener("keydown",this.onKeyDown,!1),window.addEventListener("keyup",this.onKeyUp,!1),this.domElement.addEventListener("gesturestart",this.onGesture),this.domElement.addEventListener("gesturechange",this.onGesture),this.domElement.addEventListener("gestureend",this.onGesture),this.domElement.addEventListener("touchend",this.onTouchEnd),this.hoverRotatePanMode!==0&&!this.useWindowEvents){let e=this.useWindowEvents?window:this.domElement;e.addEventListener("pointerleave",this.onPointerLeave),e.addEventListener("pointerenter",this.onPointerEnter)}this.pointerLeaveEvent=void 0}dispose(){this.removeEventListenersFromCamera(),this.domElement.removeEventListener("contextmenu",this.onContextMenu),this.domElement.removeEventListener("pointerdown",this.onPointerDown),this.domElement.removeEventListener("wheel",this.onMouseWheel),window.removeEventListener("keydown",this.onKeyDown,!1),window.removeEventListener("keyup",this.onKeyUp,!1),this.domElement.removeEventListener("pointermove",this.onPointerHover),window.removeEventListener("pointermove",this.onPointerHover),this.domElement.removeEventListener("gesturestart",this.onGesture),this.domElement.removeEventListener("gesturechange",this.onGesture),this.domElement.removeEventListener("gestureend",this.onGesture),this.domElement.removeEventListener("touchend",this.onTouchEnd),this.domElement.removeEventListener("pointerleave",this.onPointerLeave),this.domElement.removeEventListener("pointerenter",this.onPointerEnter),window.removeEventListener("pointerleave",this.onPointerLeave),window.removeEventListener("pointerenter",this.onPointerEnter),this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp)}applyLimits(e,t,i,r,n,s,a,o){this.overShoot.set(0,0);let l,c,u;e instanceof N?(l=e.x,c=e.y,this.current.set(this.target.x,this.target.y),u=!0):(l=e.theta,c=e.phi,this.current.set(Ic(this.spherical.theta),Ic(this.spherical.phi)),u=!1),i===0&&(this.current.x+=l,this.current.y+=c),(t===3||t===2)&&(!u&&this.isThetaFlipped?this.current.x>r&&this.current.x<0?this.overShoot.x=r-this.current.x:this.current.x<n&&this.current.x>0&&(this.overShoot.x=n-this.current.x):this.current.x>r?this.overShoot.x=r-this.current.x:this.current.x<n&&(this.overShoot.x=n-this.current.x)),(t===3||t===1)&&(this.current.y>s?this.overShoot.y=s-this.current.y:this.current.y<a&&(this.overShoot.y=a-this.current.y)),u||(this.overShoot.x=Ic(this.overShoot.x),this.overShoot.y=Ic(this.overShoot.y)),i!==0?(this.overRatio.copy(this.overShoot).divide(o),this.overRatio.x=Math.min(Math.abs(this.overRatio.x),1),this.overRatio.y=Math.min(Math.abs(this.overRatio.y),1),i===1&&(this.overRatio.x=B7(Math.abs(this.overRatio.x)),this.overRatio.y=B7(Math.abs(this.overRatio.y))),this.isPointerDown||i===1?i===2&&(this.overRatio.x>.9&&!this.thetaIsFree||this.overRatio.y>.9&&!this.phiIsFree)?this.isPointerDown=!1:(l*this.overShoot.x<0&&!this.thetaIsFree&&(l*=1-this.overRatio.x),c*this.overShoot.y<0&&!this.phiIsFree&&(c*=1-this.overRatio.y)):i===2&&(!u&&(this.overRatio.x>.002&&!this.thetaIsFree||this.overRatio.y>.002&&!this.phiIsFree)||u&&(Math.abs(this.overShoot.x)>2||Math.abs(this.overShoot.y)>2)?(this.thetaIsFree||(l=this.overShoot.x*.05),this.phiIsFree||(c=this.overShoot.y*.05),u?this.isPanOverShoot=!0:this.isRotateOverShoot=!0):u?this.isPanOverShoot=!1:this.isRotateOverShoot=!1)):(l+=this.overShoot.x,c+=this.overShoot.y),e instanceof N?(e.x=l,e.y=c):(this.thetaIsFree||(e.theta=l),this.phiIsFree||(e.phi=c))}setEnableDampingSpeed(e){this.enableDamping=e,this.rotateSpeed=e===!0?.2:1}stopDamping(){this.sphericalDelta.theta=0,this.sphericalDelta.phi=0}getAutoRotationAngle(){return 2*Math.PI/60/60*this.autoRotateSpeed}getZoomScale(){return Math.pow(.95,this.zoomSpeed)}rotateLeft(e){this.sphericalDelta.theta-=e}rotateUp(e){this.sphericalDelta.phi-=e}panLeft(e,t){this.panLeftV.setFromMatrixColumn(t,0),this.panLeftV.multiplyScalar(-e),this.panOffset.add(this.panLeftV)}panUp(e,t){this.panUpV.setFromMatrixColumn(t,1),this.panUpV.multiplyScalar(e),this.panOffset.add(this.panUpV)}pan(e,t){let i=this.domElement;if(i&&this.object.isPerspectiveCamera){let r=this.object.position;this.panV.copy(r).sub(this.target);let n=this.panV.length();n*=Math.tan(this.object.fov/2*Math.PI/180),this.panLeft(2*e*n/i.clientHeight,this.object.matrixWorld),this.panUp(2*t*n/i.clientHeight,this.object.matrixWorld)}else i&&this.object.isOrthographicCamera&&(this.panLeft(e*(this.object.right-this.object.left)/this.object.zoom/i.clientWidth,this.object.matrixWorld),this.panUp(t*(this.object.top-this.object.bottom)/this.object.zoom/i.clientHeight,this.object.matrixWorld));this.dispatchEvent(H4e)}dollyOut(e){this.object.isPerspectiveCamera?this.scale/=e:this.object.isOrthographicCamera&&(this.object.zoom*=e,this.zoomLimitsEnabled&&(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom))),this.object.updateProjectionMatrix(),this.zoomChanged=!0),this.dispatchEvent(L7)}dollyIn(e){this.object.isPerspectiveCamera?this.scale*=e:this.object.isOrthographicCamera&&(this.object.zoom/=e,this.zoomLimitsEnabled&&(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom))),this.object.updateProjectionMatrix(),this.zoomChanged=!0),this.dispatchEvent(L7)}zoomOut(e=this.getZoomScale()){this.dispatchEvent(rp),this.dollyOut(e),this.dispatchEvent(np)}zoomIn(e=this.getZoomScale()){this.dispatchEvent(rp),this.dollyIn(e),this.dispatchEvent(np)}setZoom(e){if(this.dispatchEvent(rp),this.object.isPerspectiveCamera){let t=this.initialSphericalRadius/e/this.spherical.radius;this.scale=t}else this.object.isOrthographicCamera&&(this.object.zoom=e,this.zoomLimitsEnabled&&(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom))),this.object.updateProjectionMatrix(),this.zoomChanged=!0);this.dispatchEvent(np)}handleMouseDownRotate(e){this.rotateStart.set(e.clientX,e.clientY)}handleMouseDownDolly(e){this.dollyStart.set(e.clientX,e.clientY)}handleMouseDownPan(e){this.panStart.set(e.clientX,e.clientY)}handleMouseMoveRotate(e,t=1){e.movementX!==void 0?this.rotateDelta.set(e.movementX,e.movementY):(this.rotateEnd.set(e.clientX,e.clientY),this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart),this.rotateStart.copy(this.rotateEnd)),this.rotateDelta.multiplyScalar(this.rotateSpeed*t).rotateAround(O7,-this.object.angleOffsetFromUp);let i=this.domElement,r=this.useWindowEvents?window.innerHeight:i.clientHeight,n=2*Math.PI*this.rotateDelta.x/r,s=2*Math.PI*this.rotateDelta.y/r;this.rotateLeft(n),this.rotateUp(s),this.update()}handleMouseMoveDolly(e){this.dollyEnd.set(e.clientX,e.clientY),this.dollyDelta.subVectors(this.dollyEnd,this.dollyStart),this.dollyDelta.y>0?this.dollyOut(this.getZoomScale()):this.dollyDelta.y<0&&this.dollyIn(this.getZoomScale()),this.dollyStart.copy(this.dollyEnd),this.update()}handleMouseMovePan(e,t=1){e.movementX!==void 0?this.panDelta.set(e.movementX,e.movementY):(this.panEnd.set(e.clientX,e.clientY),this.panDelta.subVectors(this.panEnd,this.panStart),this.panStart.copy(this.panEnd)),this.panDelta.multiplyScalar(this.panSpeed*t),this.pan(this.panDelta.x,this.panDelta.y),this.update()}handleMouseWheel(e){if(ACe===!1&&WS(e)===!1&&CCe(e)===!0){if(this.enablePan===!1)return;this.gesture?(this.panDelta.set(-e.deltaX,-e.deltaY).multiplyScalar(this.panSpeed),this.panDelta.x=Math.min(Math.abs(this.panDelta.x),100)*(this.panDelta.x<0?-1:1),this.panDelta.y=Math.min(Math.abs(this.panDelta.y),100)*(this.panDelta.y<0?-1:1),e.altKey?this.pan(0,this.panDelta.y):e.shiftKey?this.pan(this.panDelta.x,0):this.pan(this.panDelta.x,this.panDelta.y),this.update()):(this.gesture=!0,this.isPointerDown=!0),window.clearTimeout(this.timer),this.timer=window.setTimeout(()=>{this.gesture=!1,this.isPointerDown=!1},30)}else{if(this.enableZoom===!1||this.gesture)return;e.deltaY===0?e.deltaX<0?this.dollyIn(this.getZoomScale()):e.deltaX>0&&this.dollyOut(this.getZoomScale()):e.deltaY<0?this.dollyIn(this.getZoomScale()):e.deltaY>0&&this.dollyOut(this.getZoomScale()),this.update(),this.gesture=!1,this.isPointerDown=!1}}handleTouchStartRotate(){if($t.length===2){let e=.5*($t[0].pageX+$t[1].pageX),t=.5*($t[0].pageY+$t[1].pageY);this.rotateStart.set(e,t)}else this.rotateStart.set($t[0].pageX,$t[0].pageY)}handleTouchStartPan(){if($t.length===2){let e=.5*($t[0].pageX+$t[1].pageX),t=.5*($t[0].pageY+$t[1].pageY);this.panStart.set(e,t)}else this.panStart.set($t[0].pageX,$t[0].pageY)}handleTouchStartDolly(){let e=$t[0].pageX-$t[1].pageX,t=$t[0].pageY-$t[1].pageY,i=Math.sqrt(e*e+t*t);this.dollyStart.set(0,i)}handleTouchStartDollyPan(){this.enableZoom&&this.isTouchZoom===!0&&this.handleTouchStartDolly(),this.enablePan&&this.handleTouchStartPan()}handleTouchStartDollyRotate(){this.enableZoom&&this.isTouchZoom===!0&&this.handleTouchStartDolly(),this.enableRotate&&this.handleTouchStartRotate()}handleTouchMoveRotate(e){if($t.length===2){let i=iR(e),r=.5*(e.pageX+i.x),n=.5*(e.pageY+i.y);this.rotateEnd.set(r,n)}else{if(e.pointerId!==$t[0].pointerId)return;this.rotateEnd.set(e.pageX,e.pageY)}this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart).multiplyScalar(this.rotateSpeed);let t=this.domElement;t&&(this.rotateLeft(2*Math.PI*this.rotateDelta.x/t.clientHeight),this.rotateUp(2*Math.PI*this.rotateDelta.y/t.clientHeight)),this.rotateStart.copy(this.rotateEnd)}handleTouchMovePan(e){if($t.length===2){let t=iR(e),i=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);this.panEnd.set(i,r)}else{if(e.pointerId!==$t[0].pointerId)return;this.panEnd.set(e.pageX,e.pageY)}this.panDelta.subVectors(this.panEnd,this.panStart).multiplyScalar(this.panSpeed),this.pan(this.panDelta.x,this.panDelta.y),this.panStart.copy(this.panEnd)}handleTouchMoveDolly(e){let t=iR(e),i=e.pageX-t.x,r=e.pageY-t.y,n=Math.sqrt(i*i+r*r);this.dollyEnd.set(0,n),this.dollyDelta.set(0,Math.pow(this.dollyEnd.y/this.dollyStart.y,this.zoomSpeed)),this.dollyOut(this.dollyDelta.y),this.dollyStart.copy(this.dollyEnd)}handleTouchMoveDollyPan(e){this.enableZoom&&this.isTouchZoom===!0&&this.handleTouchMoveDolly(e),this.enablePan&&this.handleTouchMovePan(e)}handleTouchMoveDollyRotate(e){this.enableZoom&&this.isTouchZoom===!0&&this.handleTouchMoveDolly(e),this.enableRotate&&this.handleTouchMoveRotate(e)}checkRaycastLock(){var e;if(this.object.data.raycastLock){if(this.options.isPlayMode)return!1;{let t=(e=this.options)==null?void 0:e.showCameraLock;return t&&t(),!0}}else return!1}};function Ic(e){let t=Math.PI*2;for(;e<=-Math.PI;)e+=t;for(;e>Math.PI;)e-=t;return e}function B7(e){return 1-Math.pow(1-e,4)}var F7=class{constructor(e,t,i,r,n,s){this.id=e,this.data=t,this.object=i,this.page=r,this.currentIntersectedObjects=[],this.actions=zn(t,t.actions,r,n,s,i),this.target=t.target,this.triggeringObjects=[];for(let a of t.triggeringObjects){let o=r.scene.find(a);o&&this.triggeringObjects.push(o)}}isValidTriggeringObject(e){return this.target==="all"?!0:this.triggeringObjects.some(t=>t===e||t.isAncestorOf(e.uuid)||e.isAncestorOf(t.uuid))}disconnect(){gs(this.actions)}dispatch(){this.object.destroyedInAction||(this.actions.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())}),this.object.dispatchEvent({type:"beginEvent",eventName:"Trigger"}),this.actions.Transition.forEach(e=>{e.data.runMode==="Toggle"?e.toggle():e.play()}),this.actions.SwitchCamera.forEach(e=>{e.data.runMode==="Toggle"?e.toggle():e.play()}),this.actions.Link.forEach(e=>{e.dispatch()}),this.actions.Reset.forEach(e=>{e.dispatch()}),this.actions.Create.forEach(e=>{e.dispatch()}),this.actions.Destroy.forEach(e=>{e.dispatch(!1)}),this.actions.Audio.forEach(e=>{e.dispatchBasic()}),this.actions.Particles.forEach(e=>{e.dispatchBasic()}),this.actions.Video.forEach(e=>{e.dispatchBasic()}),this.actions.SceneTransition.forEach(e=>{e.dispatch()}),this.actions.SetVariable.forEach(e=>e.checkConditions()),this.actions.SetVariable.forEach(e=>e.dispatch()),this.actions.DynamicVariablePlay.forEach(e=>e.dispatch()),this.actions.ClearLocalStorage.forEach(e=>e.dispatch()),this.actions.UserAPI.forEach(e=>e.dispatch()))}},Vi;OCe.then(e=>Vi=e);var En=new N,zl=new ri,fd=new N,pI=new Wn(0,0,0,"YXZ"),U7=new Wn(0,0,0,"XYZ"),Bl=new N,mI=new N,gI=new N(1,1,1),qg=new ri,BM=new ft,N7=new ft,Q4e={type:"updateMatrix"},k7=new ri,vI=new uo,VB={type:"beginEvent",eventName:"Collision"},Z4e={type:"beginEvent",eventName:"Trigger"};function K4e(e){if(Gw.physicsEnabled(e.scene.objects))return!0;let t=!1;return e.scene.objects.traverse((i,r)=>{if(r.events){if(Array.isArray(r.events)){for(let n of r.events)if(n.data.disabled!==!0&&n.data.type==="GameControl"&&n.data.collisionEnabled){t=!0;break}}else for(let n of Object.values(r.events))if(n.disabled!==!0&&n.type==="GameControl"&&n.collisionEnabled){t=!0;break}}}),t}var oT=e=>e.states.some(t=>t.data.position!==void 0||t.data.rotation!==void 0||t.data.hiddenMatrix!==void 0||t.data.cloner!==void 0||t.data.pathSnapping!==void 0),J4e=class{constructor(e){this.eventContext=e,this.isEnabled=!1,this.gameControl=null,this.joysticks=[],this.joystickToGameControls=[],this.sharedGameControlGlobals={entitiesWithTransformAnim:[],entityToCollisionEvents:{},colliderToEntity:new Map,triggers:[],gamePads:[],createdObjects:[],nCreatedPerAction:{}},this.sensorToTriggerEvent={},this.eventManager=void 0,this.needsCollisionDetection=!1,this.initializationCounter=-1,this.rigidBodyToMesh=new Map,this.nActiveRigidBodies=0,this.collisionEvents=[],this.isExport=!1,this.processRigidBody=t=>{if(t.bodyType()!==Vi.RigidBodyType.Dynamic)return;t.isSleeping()||this.nActiveRigidBodies++;let[i,r,n]=this.rigidBodyToMesh.get(t.handle);if(En.copy(t.translation()).multiplyScalar(this.pixelsPerMeter),zl.copy(t.rotation()),i.matrixWorld.compose(En,zl,r),i.hasNonUniformScale&&i.matrixWorld.multiply(i.shearScale),i.dispatchEvent(Q4e),n){let s=i.cloner;if(s&&s.objectForSample===void 0){s.matrixWorld.copy(i.matrixWorld);for(let a of s.children)a.updateMatrixWorld(!0)}for(let a of i.children)a.updateMatrixWorld(!0)}},this.accumulator=0,this.handleCollisionEvents=(t,i,r)=>{var a,o,l,c;if(r===!1)return;let n,s;if(this.sensorToTriggerEvent[t]?(n=this.sensorToTriggerEvent[t],s=this.sharedGameControlGlobals.colliderToEntity.get(i)):this.sensorToTriggerEvent[i]&&(n=this.sensorToTriggerEvent[i],s=this.sharedGameControlGlobals.colliderToEntity.get(t)),n&&s&&n.isValidTriggeringObject(s)){n.dispatch();return}for(let u=this.sharedGameControlGlobals.createdObjects.length-1;u>=0;u--){let h=this.sharedGameControlGlobals.createdObjects[u];if(h.userData.hasCollisionDestroy&&(((a=h.rigidBody)==null?void 0:a.collider(0).handle)===t||((o=h.rigidBody)==null?void 0:o.collider(0).handle)===i)){this.sharedGameControlGlobals.createdObjects.splice(u,1),h.removeFromParent(),requestAnimationFrame(()=>{var d;return(d=this.sharedGameControlGlobals.rapierWorld)==null?void 0:d.removeRigidBody(h.rigidBody)});break}}if(((l=this.gameControl)==null?void 0:l.object)!==void 0&&this.gameControl.object===this.sharedGameControlGlobals.colliderToEntity.get(t)){let u=this.sharedGameControlGlobals.colliderToEntity.get(i),h=this.sharedGameControlGlobals.entityToCollisionEvents[u.uuid];if(h===void 0)return;for(let d of h)d.data.target==="character"&&this.dispatchCollisionEvent(d,u,i)}else if(((c=this.gameControl)==null?void 0:c.object)!==void 0&&this.gameControl.object===this.sharedGameControlGlobals.colliderToEntity.get(i)){let u=this.sharedGameControlGlobals.colliderToEntity.get(t),h=this.sharedGameControlGlobals.entityToCollisionEvents[u.uuid];if(h===void 0)return;for(let d of h)d.data.target==="character"&&this.dispatchCollisionEvent(d,u,t)}else{let u=this.sharedGameControlGlobals.colliderToEntity.get(t),h=this.sharedGameControlGlobals.entityToCollisionEvents[u.uuid];if(h!==void 0)for(let p of h)p.data.target==="scene"&&this.dispatchCollisionEvent(p,u,t);let d=this.sharedGameControlGlobals.colliderToEntity.get(i),f=this.sharedGameControlGlobals.entityToCollisionEvents[d==null?void 0:d.uuid];if(f!==void 0)for(let p of f)p.data.target==="scene"&&this.dispatchCollisionEvent(p,d,i)}},this.isExport=e.isExport,this.sharedAssets=e.sharedAssets,this.renderer=e.renderer,this.requestRender=e.requestRender,this.domElement=this.renderer.domElement,this.pixelsPerMeter=mre,this.gravity=this.page.data.globalPhysics.gravity}get page(){return this.eventContext.page}attachVRControllers(e){e.forEach(t=>{t.addEventListener("connected",i=>{"gamepad"in i.data&&"axes"in i.data.gamepad&&this.sharedGameControlGlobals.gamePads.push(i.data.gamepad)})})}markIsDestroyTarget(){this.page.traverseVisibleEntity(e=>{var i,r;let t=e.dataPatched;for(let n of t.events){if(n.data.disabled===!0)continue;let s=(r=(i=n.data.actions)==null?void 0:i.find(a=>a.data.type==="Destroy"))==null?void 0:r.data;if(s)for(let a of s.objects){let o=this.page.scene.find(a);o&&(o.userData.hasDestroy=!0)}}})}markIsDragObject(){this.page.traverseVisibleEntity(e=>{let t=e.dataPatched;for(let i of t.events)if(!(i.data.disabled===!0||i.data.type!=="DragDrop"))for(let r of i.data.objects){let n=this.page.scene.find(r);n&&(n.userData.hasDrag=!0)}})}initBVH(){let e=[];if(this.page.traverseChildren(t=>{var c,u;let i,r=t instanceof Ux,n=t instanceof Nx;if(t instanceof fl||r||n)return;t instanceof Os?i=t.object:i=t;let s=i.dataPatched;if(((c=s.physics)==null?void 0:c.enabled)==="visibility"?!s.visible:!((u=s.physics)!=null&&u.enabled))return!0;let a=t.geometry,o=i.userData.hasDestroy===!0,l=i.userData.hasDrag===!0;if(oT(s)||o||l||i.dataPatched.events.some(h=>h.data.disabled!==!0&&(h.data.type==="GameControl"||h.data.type==="Follow")))return t.updateMatrixWorldSVD(),this.addBoundsTree(t),!0;a&&e.push(Ju(a,t.matrixWorld))}),e.length>0){let t=Qp(e,!1);this.sharedGameControlGlobals.staticMeshBVH=new Bx(t)}}addRigidBody(e,t,i){if(vre(e.matrixWorld))return;let r=[],n="geometry"in e?e.geometry:void 0,s=t.dataPatched;if((n==null?void 0:n.getAttribute("position"))!==void 0&&r.push(Ju(n,e.shearScale)),s.physics.fusedBody){let a=this.gatherChildrenGeom(e,r);e.traverseObject(a),e.children.forEach(l=>l.updateMatrixWorld(!0));let o=e.cloner;o&&o.objectForSample===void 0&&s.physics.rigidBody==="dynamic"&&(o.traverseObject(a),o.children.forEach(l=>l.updateMatrixWorld(!0)))}if(r.length>0){let a,o=!i.fromCreate&&s.physics.rigidBody==="dynamic"||i.fromCreate&&i.dynamic;o?(a=Vi.RigidBodyDesc.dynamic(),a.setLinearDamping(s.physics.damping).setAngularDamping(s.physics.damping).setAdditionalMass(1e-9).setGravityScale(s.physics.gravityScale).enabledRotations(...s.physics.enabledRotation).enabledTranslations(...s.physics.enabledTranslation)):(i.hasTransformAnim||i.hasFollow||i.hasDrag)&&!i.fromCreate?(a=Vi.RigidBodyDesc.kinematicPositionBased(),this.sharedGameControlGlobals.entitiesWithTransformAnim.push(e)):a=Vi.RigidBodyDesc.fixed();let l=Qp(r);(e.hasNonUniformScale?e.matrixWorldRigid:e.matrixWorld).decompose(En,zl,fd),e.position0=En.clone().divideScalar(this.pixelsPerMeter),e.rotation0=zl.clone(),En.divideScalar(this.pixelsPerMeter),a.setTranslation(En.x,En.y,En.z).setRotation(zl),n?l==null||l.scale(1/this.pixelsPerMeter,1/this.pixelsPerMeter,1/this.pixelsPerMeter):l==null||l.scale(fd.x/this.pixelsPerMeter,fd.y/this.pixelsPerMeter,fd.z/this.pixelsPerMeter);let c=this.sharedGameControlGlobals.rapierWorld.createRigidBody(a);o&&this.rigidBodyToMesh.set(c.handle,[e,fd.clone(),s.physics.fusedBody]);let u=!(s.geometry===void 0||s.geometry.type==="SubdivGeometry"||s.geometry.type==="NonParametricGeometry"||s.geometry.type==="BooleanGeometry"||s.geometry.type==="VectorGeometry"||s.geometry.type==="StarGeometry"||s.geometry.type==="RectangleGeometry"||s.geometry.type==="EllipseGeometry"||s.geometry.type==="TriangleGeometry"||s.geometry.type==="TorusGeometry"||s.geometry.type==="HelixGeometry");try{this.addCollider(c,s.physics,l,t,u)}catch{try{this.addCollider(c,s.physics,l,t,!1)}catch(h){console.error(h)}}e.rigidBody=c}}addBoundsTree(e){var i,r;let t=[];if(((i=e.geometry)==null?void 0:i.getAttribute("position"))!==void 0&&((r=e.geometry)==null?void 0:r.getAttribute("position").count)>0&&t.push(Ju(e.geometry,e.shearScale)),e.traverseObject(this.gatherChildrenGeom(e,t)),e.children.forEach(n=>n.updateMatrixWorld(!0)),t.length>0){let n=Qp(t,!1);e.bvhGeometry=n,n.getAttribute("position").count>0&&(e.bvhGeometry.boundsTree=new Bx(n),this.sharedGameControlGlobals.entitiesWithTransformAnim.push(e))}}addCollider(e,t,i,r,n=!0){var o,l;if((i==null?void 0:i.getAttribute("position").count)===0||((o=i==null?void 0:i.getIndex())==null?void 0:o.count)===0)return;let s;i&&(t.colliderType==="trimesh"?s=Vi.ColliderDesc.trimesh(i.getAttribute("position").array,i.getIndex().array):s=Vi.ColliderDesc.convexMesh(i.getAttribute("position").array,n?i.getIndex().array:void 0)),s.setFrictionCombineRule(Vi.CoefficientCombineRule.Average).setRestitutionCombineRule(Vi.CoefficientCombineRule.Average).setDensity(t.density).setFriction(t.friction).setRestitution(t.restitution);let a=this.sharedGameControlGlobals.rapierWorld.createCollider(s,e);this.sharedGameControlGlobals.colliderToEntity.set(a.handle,r),(l=this.sharedGameControlGlobals.entityToCollisionEvents[r.uuid])!=null&&l.some(c=>c.target==="scene")&&a.setActiveEvents(Vi.ActiveEvents.COLLISION_EVENTS)}gatherChildrenGeom(e,t){return(i,r)=>{var o;if(r===0)return;let n;if(i instanceof fl)if(i.objectForSample){if(i.objectForSample.dataPatched.physics.fusedBody)return;n=i.object}else return i.object.dataPatched.physics.fusedBody===!0&&i.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(i instanceof Os)n=i.object;else if(n=i,(o=n.dataPatched.cloner)==null?void 0:o.hideBase)return!0;let s=n.dataPatched;if(s.physics.enabled==="visibility"?!s.visible:!s.physics.enabled)return!0;r===1?e.hasNonUniformScale?i.matrixWorld.multiplyMatrices(e.shearScale,i.hiddenMatrix):i.matrixWorld.copy(i.hiddenMatrix):i.matrixWorld.multiplyMatrices(i.parent.matrixWorld,i.hiddenMatrix),i.matrixWorld.multiply(i.matrix);let a=i.geometry;(a==null?void 0:a.getAttribute("position"))!==void 0&&t.push(Ju(a,i.matrixWorld))}}activate(e){var d,f;if(this.isEnabled)return;this.isEnabled=!0,this.eventManager=e,this.usePhysics=this.page.data.globalPhysics.usePhysics;let t=this.page.playCamera,i=!1,r=5,n=8,s=9,a="drag",o=this.page.data.publish.gameControlObject,l=o!==null?this.page.find(o):null,c=null;if(l)for(let p of l.data.events){if(p.data.disabled||p.data.type!=="GameControl")continue;let v=l;for(;this.usePhysics&&((d=v=v.parent)==null?void 0:d.parent)!==null;)(f=v.data.physics)==null||f.fusedBody;p.data.collisionEnabled&&(this.needsCollisionDetection=!0),c===null&&(c=p.data)}if(this.page.traverseEntity(p=>{for(let v of p.dataPatched.events)if(v.data.disabled===!1&&v.data.type==="Trigger")return this.needsCollisionDetection=!0,!0}),l&&c&&(l.data.visible===!0||l.data.physics.enabled===!0)){i=i||c.camera===t.uuid||l.uuid===t.uuid;let p=new gre(l,this.renderer.domElement,c,this.eventContext.page.data.globalPhysics,this,l.uuid!==t.uuid&&c.camera===t.uuid,t,this.page,this.sharedAssets);this.gameControl=p,r=c.joystickPosLoc,n=c.joystickRotLoc,s=c.jumpTouchButtonLoc,a=c.rotByTouch,Do&&c.touchControl&&(this.joystickToGameControls[r]="pos",c.moveMode==="walk"&&(this.joystickToGameControls[s]="jmp"),a==="joystick"&&(this.joystickToGameControls[n]="rot"))}if(this.gameControl&&this.gameControl.data.navmesh.enabled){let p=this.gameControl.data;if(!this.navigationMeshWrapper){this.navigationMeshWrapper=new N4e(this.usePhysics,this.isExport);let v;p.collider.type==="sphere"?v=p.collider.radius*2:v=p.collider.height,v=Math.floor(v/p.navmesh.ch-1),this.navigationMeshWrapper.init({...p.navmesh,walkableHeight:v},this.gameControl,this.eventContext)}}if(i===!1){let{enableRotate:p,enablePan:v,enableZoom:m,autoRotate:g,hoverRotatePanMode:y}=this.eventManager.publish.orbitControls;(p||v||m||g||y!==0)&&(this.orbitControls=new Ere(t,this.renderer.domElement,{isExport:this.isExport,isPlayMode:!0}),this.orbitControls.addEventListener("change",this.requestRender),this.orbitControls.addEventListener("end",this.requestRender),this.orbitControls.addEventListener("start",this.requestRender),this.orbitControls.fromJSON(this.eventManager.publish.orbitControls,this.eventManager.publish.mouseEventTarget),this.orbitControls.useKeyEvents=!1,this.orbitControls.addEventListenersToCamera(),this.orbitControls.connect(),this.orbitControls.update())}let u=this.renderer.domElement.width/this.renderer.getPixelRatio(),h=this.renderer.domElement.height/this.renderer.getPixelRatio();this.joystickToGameControls.forEach((p,v)=>{let m=document.body.appendChild(document.createElement("div")),[g,y,x]=this.eventManager.eventContext.publish.joystickSizeAndXYOffset[v],_=(u-5*g)/4+g,M={},S=p==="jmp",T=S?0:g;v<10?(v<5?M.top=T/2:M.bottom=T/2,M.left=T/2+v%5*_):v===10?(M.left=T/2,M.top=h/2):(M.right=T/2,M.top=h/2),M.top?M.top-=y[1]:M.bottom+=y[1],M.left?M.left+=y[0]:M.right-=y[0];for(let A in M)M[A]+="px";if(S){let A=m.appendChild(document.createElement("div"));Object.assign(A.style,M,{position:"absolute",width:g+"px",height:g+"px",backgroundColor:`rgba(255,255,255,${x==="show"?.4:0})`,zIndex:"9999",borderRadius:g+"px",border:x==="show"?"solid 2px rgba(0, 0, 0, .1)":"none",display:"flex",alignItems:"center",justifyContent:"center",touchAction:"none"});let D=g/16*16*.4;x==="show"&&(A.innerHTML=`
						<svg width="${D}" height="${g*.4}" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
							<path d="M2 10L8 4L14 10" stroke="black" stroke-opacity="40%" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
						</svg>
					`),A.addEventListener("pointerdown",()=>{this.gameControl.movementState.jump=1,this.requestRender()}),A.addEventListener("touchend",R=>R.preventDefault()),this.joysticks[v]=[void 0,m];return}let E={zone:m,mode:"static",position:M,size:g};x==="hide"&&(E.restOpacity=0);let C=lUe.create(E);C.on("move",(A,D)=>{let R=this.gameControl;p==="pos"?D.force<.2?R.moveForce=0:(R.movementState.movePosZ=Math.sin(-D.angle.radian),R.movementState.movePosX=Math.cos(-D.angle.radian),D.force>1.2?R.movementState.run=1:R.movementState.run=0,D.force<.3?R.moveForce=(D.force-.2)/.1:R.moveForce=1):p==="rot"&&(D.force<.2?R.rotForce=0:(R.movementState.rotPosX=D.vector.y,R.movementState.rotPosY=-D.vector.x,D.force<.3?R.rotForce=(D.force-.2)/.1:R.rotForce=1)),this.requestRender()}),C.on("end",(A,D)=>{let R=this.gameControl;p==="pos"?(R.movementState.movePosZ=0,R.movementState.movePosX=0,R.moveForce=1):p==="rot"&&(R.movementState.rotPosX=0,R.movementState.rotPosY=0,R.rotForce=1)}),this.joysticks[v]=[C,m]}),this.markIsDestroyTarget(),this.markIsDragObject(),this.rebuildBVH(),this.initializationCounter++,window.setTimeout(()=>{this.collisionEvents.forEach(p=>p.initialDisabled=!1)},80)}initPhysics(){var a;(a=this.sharedGameControlGlobals.rapierWorld)==null||a.free(),this.sharedGameControlGlobals.rapierWorld=new Vi.World(new Vi.Vector3(0,this.gravity,0)),this.events=new Vi.EventQueue(!0);let e=[],t=[];if(this.page.traverseChildren(o=>{var g,y,x,_;let l;if(o instanceof fl)if(o.objectForSample){if(o.objectForSample.dataPatched.physics.fusedBody)return;l=o.object}else return o.object.dataPatched.physics.fusedBody===!0&&o.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(o instanceof Os)l=o.object;else{if(o instanceof Nx||o instanceof Ux)return;if(l=o,((g=l.dataPatched.cloner)==null?void 0:g.disabled)===!1&&((y=l.dataPatched.cloner)==null?void 0:y.hideBase)&&((x=l.dataPatched.physics)==null?void 0:x.fusedBody)!==!0)return!0}let c=l.dataPatched,u;for(let M of c.events)M.data.disabled!==!0&&M.data.type==="GameControl"&&(u=M.data);if(!c.physics||(c.physics.enabled==="visibility"?!c.visible:!c.physics.enabled))return!0;o.updateMatrixWorldSVD();let h=oT(c),d=!1,f=l.userData.hasDestroy,p=l.userData.hasDrag,v=!1;for(let M of c.events)if(M.data.disabled!==!0){if(M.data.type==="Collision"){d=!0;let S=new C4e(M.id,M.data,l,this.page,this.sharedAssets,this.eventManager);S.initialDisabled=!0,this.collisionEvents.push(S),this.sharedGameControlGlobals.entityToCollisionEvents[l.uuid]&&this.sharedGameControlGlobals.entityToCollisionEvents[l.uuid].every(T=>T.id!==M.id)?this.sharedGameControlGlobals.entityToCollisionEvents[l.uuid].push(S):this.sharedGameControlGlobals.entityToCollisionEvents[l.uuid]=[S]}else if(M.data.type==="Follow"){v=!0;let S=M.data.target;o.traverseVisible(T=>{T.userData.isFollowingObj=S})}}c.physics.rigidBody==="dynamic"&&c.physics.fusedBody===!1&&(o.matrixWorldFusedFalse=o.matrixWorld.clone());let m=o.geometry;if(u!==void 0){let M=Vi.RigidBodyDesc.kinematicPositionBased();(o.hasNonUniformScale?o.matrixWorldRigid:o.matrixWorld).decompose(En,zl,fd),o.position0=En.clone().divideScalar(this.pixelsPerMeter),o.rotation0=zl.clone(),En.divideScalar(this.pixelsPerMeter),M.setTranslation(En.x,En.y,En.z).setRotation(zl);let S=this.sharedGameControlGlobals.rapierWorld.createRigidBody(M);o.rigidBody=S;let T;u.collider.type==="sphere"?T=Vi.ColliderDesc.ball(u.collider.radius/this.pixelsPerMeter):u.collider.type==="capsule"?T=Vi.ColliderDesc.capsule((u.collider.height/2-u.collider.radius)/this.pixelsPerMeter,u.collider.radius/this.pixelsPerMeter):T=Vi.ColliderDesc.cuboid(u.collider.width/this.pixelsPerMeter/2,u.collider.height/this.pixelsPerMeter/2,u.collider.depth/this.pixelsPerMeter/2),T.setFrictionCombineRule(Vi.CoefficientCombineRule.Average).setRestitutionCombineRule(Vi.CoefficientCombineRule.Average).setDensity(c.physics.density).setFriction(c.physics.friction).setRestitution(c.physics.restitution);let E=this.sharedGameControlGlobals.rapierWorld.createCollider(T,S);this.sharedGameControlGlobals.colliderToEntity.set(E.handle,l),En.fromArray(u.collider.position).multiply(fd.setFromMatrixScale(l.matrixWorld)).divideScalar(this.pixelsPerMeter),E.setTranslationWrtParent(En);let C=new ri().setFromEuler(new Wn().setFromVector3(new N().fromArray(u.collider.rotation)));E.setRotationWrtParent(C),E.setActiveEvents(Vi.ActiveEvents.COLLISION_EVENTS),this.generateSensorColliderDescs(l,!0)}else c.physics.rigidBody==="dynamic"||h||v||f||p||d?(this.addRigidBody(o,l,{hasFollow:v,hasTransformAnim:h,hasDrag:p}),this.generateSensorColliderDescs(l,c.physics.fusedBody)):(m&&e.push(Ju(m,o.matrixWorld)),c.physics.fusedBody&&o.traverseObject((M,S)=>{var A;if(S===0)return;let T;if(M instanceof fl)if(M.objectForSample){if(M.objectForSample.dataPatched.physics.fusedBody)return;T=M.object}else return M.object.dataPatched.physics.fusedBody===!0&&M.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else{if(M instanceof Nx||M instanceof Ux)return;if(M instanceof Os)T=M.object;else if(T=M,(A=T.dataPatched.cloner)==null?void 0:A.hideBase)return!0}let E=T.dataPatched;if(E.physics.enabled==="visibility"?!E.visible:!E.physics.enabled)return!0;let C=M.geometry;(C==null?void 0:C.getAttribute("position"))!==void 0&&e.push(Ju(C,M.matrixWorld))}),this.generateSensorColliderDescs(l,c.physics.fusedBody,t));if(((_=c.physics)==null?void 0:_.fusedBody)===!0||u)return!0}),e.length===0)return;let i=Qp(e);i.scale(1/this.pixelsPerMeter,1/this.pixelsPerMeter,1/this.pixelsPerMeter);let r=Vi.RigidBodyDesc.fixed(),n=this.sharedGameControlGlobals.rapierWorld.createRigidBody(r),s=Vi.ColliderDesc.trimesh(i.getAttribute("position").array,i.getIndex().array).setFrictionCombineRule(Vi.CoefficientCombineRule.Multiply).setRestitutionCombineRule(Vi.CoefficientCombineRule.Multiply).setFriction(1).setRestitution(1);this.sharedGameControlGlobals.rapierWorld.createCollider(s,n);for(let[o,l]of t){let c=this.sharedGameControlGlobals.rapierWorld.createCollider(o,n);this.sensorToTriggerEvent[c.handle]=l}}updatePositions(){return this.nActiveRigidBodies=0,this.sharedGameControlGlobals.rapierWorld.forEachRigidBody(this.processRigidBody),this.nActiveRigidBodies>0}rebuildBVH(){this.usePhysics?this.initPhysics():(this.page.traverseEntity(e=>{for(let t of e.dataPatched.events)if(t.data.type==="Trigger"&&t.data.disabled!==!0){let i=new F7(t.id,t.data,e,this.page,this.sharedAssets,this.eventManager),r=new ft().compose(Bl.fromArray(t.data.position),qg.setFromEuler(U7.fromArray(t.data.rotation)),gI);if(t.data.triggerZone==="box"){let n=new vn;n.min.fromArray(t.data.size).multiplyScalar(-.5),n.max.fromArray(t.data.size).multiplyScalar(.5),this.sharedGameControlGlobals.triggers.push([n,r,e,i])}else this.sharedGameControlGlobals.triggers.push([t.data.radius,r,e,i])}}),this.needsCollisionDetection&&this.initBVH())}disconnectEvents(){this.collisionEvents.forEach(e=>e.disconnect()),this.sharedGameControlGlobals.triggers.forEach(e=>e[3].disconnect()),this.sharedGameControlGlobals.triggers.length=0}deactivate(){var e,t,i,r;if(this.isEnabled){this.isEnabled=!1,this.page.traverse(n=>{let s=n;s.matrixWorldFusedFalse&&(s.matrixWorldFusedFalse=void 0),s.rigidBody&&(s.rigidBody=void 0),s.position0&&(s.position0=void 0),s.rotation0&&(s.rotation0=void 0)}),(e=this.sharedGameControlGlobals.rapierWorld)==null||e.free(),this.sharedGameControlGlobals.rapierWorld=void 0,this.sharedGameControlGlobals.staticMeshBVH=void 0,this.accumulator=0,this.sharedGameControlGlobals.entitiesWithTransformAnim=[],this.disconnectEvents(),(t=this.gameControl)==null||t.reset(),(i=this.gameControl)==null||i.dispose(),this.gameControl=null,this.initializationCounter=-1,this.joysticks.forEach(([n,s])=>{n==null||n.destroy(),s.remove()}),this.joystickToGameControls=[],this.joysticks=[],this.orbitControls&&(this.orbitControls.dispose(),this.orbitControls=void 0),(r=this.navigationMeshWrapper)==null||r.dispose(),this.navigationMeshWrapper=void 0;for(let n of Object.values(this.sharedGameControlGlobals.entityToCollisionEvents))n.forEach(s=>s.disconnect());this.sharedGameControlGlobals.entityToCollisionEvents={},this.page.updateMatrixWorld(!0)}}update(e,t,i){if(!this.isEnabled)return!0;let r=!0;if(this.orbitControls!==void 0&&this.orbitControls.needsUpdate&&(r=!this.orbitControls.update()),this.initializationCounter>=0&&this.initializationCounter<2?(this.initializationCounter++,r=!1):this.initializationCounter===2&&this.gameControl&&(r=!this.gameControl.update(e,t,i)&&r),this.usePhysics===!1&&this.checkTrigger(),this.usePhysics){let n=.016666666666666666;if(e===0)r=this.stepPhysics()&&r;else{let s=e/1e3;s<n&&s>n*.55&&(s=n),this.accumulator+=s;let a=performance.now(),o=0,l=6;for(;this.accumulator>=n&&o<l&&(r=this.stepPhysics()&&r,this.accumulator-=n,o++,!(performance.now()-a>n*1e3)););this.accumulator=this.accumulator%n}}return r}stepPhysics(){var e;for(let t of this.sharedGameControlGlobals.entitiesWithTransformAnim){(t.hasNonUniformScale?t.matrixWorldRigid:t.matrixWorld).decompose(En,zl,fd),pI.setFromQuaternion(zl);let i=t;i.prevR===void 0?(i.prevR=pI.clone(),i.prevT=En.clone()):(i.prevR.copy(pI),i.prevT.copy(En)),t.rigidBody&&(t.rigidBody.setNextKinematicTranslation(En.divideScalar(this.pixelsPerMeter)),t.rigidBody.setNextKinematicRotation(zl))}return this.sharedGameControlGlobals.rapierWorld.step(this.events),(e=this.events)==null||e.drainCollisionEvents(this.handleCollisionEvents),!this.updatePositions()}dispatchCollisionEvent(e,t,i){var s;let r=((s=this.sharedGameControlGlobals.rapierWorld)==null?void 0:s.getCollider(i))._parent,n;if(t.cloner){for(let a of t.cloner.children)if(a.rigidBody===r){n=a;break}}e.dispatch(n),t.dispatchEvent(VB)}updateUseWindowEvents(e){var t;(t=this.orbitControls)==null||t.updateUseWindowEvents(e)}generateSensorColliderDescs(e,t,i){let r=N7.copy(e.matrixWorld).invert();e.traverseEntity((n,s)=>{if(t===!1&&s===1)return!0;for(let a of n.dataPatched.events)if(a.data.type==="Trigger"&&a.data.disabled!==!0){let o=new F7(a.id,a.data,n,this.page,this.sharedAssets,this.eventManager),l;if(a.data.triggerZone==="box"?l=Vi.ColliderDesc.cuboid(...a.data.size.map(c=>c/(2*this.pixelsPerMeter))):l=Vi.ColliderDesc.ball(a.data.radius/this.pixelsPerMeter),l.setDensity(0).setSensor(!0).setActiveEvents(Vi.ActiveEvents.COLLISION_EVENTS),Bl.fromArray(a.data.position),qg.setFromEuler(U7.fromArray(a.data.rotation)),BM.compose(Bl,qg,gI).premultiply(n.matrixWorld),i?(BM.decompose(Bl,qg,mI),l.setActiveCollisionTypes(Vi.ActiveCollisionTypes.KINEMATIC_FIXED|Vi.ActiveCollisionTypes.DYNAMIC_FIXED)):(BM.premultiply(r).decompose(Bl,qg,mI),e.rigidBody.bodyType()===Vi.RigidBodyType.Dynamic||(e.rigidBody.bodyType()===Vi.RigidBodyType.Fixed?l.setActiveCollisionTypes(Vi.ActiveCollisionTypes.KINEMATIC_FIXED|Vi.ActiveCollisionTypes.DYNAMIC_FIXED):l.setActiveCollisionTypes(Vi.ActiveCollisionTypes.KINEMATIC_KINEMATIC|Vi.ActiveCollisionTypes.DYNAMIC_KINEMATIC))),Bl.divideScalar(this.pixelsPerMeter),l.setTranslation(Bl.x,Bl.y,Bl.z),l.setRotation(qg),i)i.push([l,o]);else{let c=this.sharedGameControlGlobals.rapierWorld.createCollider(l,e.rigidBody);this.sensorToTriggerEvent[c.handle]=o}}})}checkTrigger(){let e;for(let t=0;t<this.sharedGameControlGlobals.triggers.length;t++){let[i,r,n,s]=this.sharedGameControlGlobals.triggers[t];for(let a=0;a<this.sharedGameControlGlobals.entitiesWithTransformAnim.length;a++){let o=this.sharedGameControlGlobals.entitiesWithTransformAnim[a];if(n===o||s.isValidTriggeringObject(Fi.is(o)?o:o.object)===!1)continue;let l=N7.copy(n.matrixWorld).decompose(Bl,k7,mI).compose(Bl,k7,gI).multiply(r),c=BM.copy(o.matrixWorld).invert().multiply(l);i instanceof vn?e=o.bvhGeometry.boundsTree.intersectsBox(i,c):(vI.radius=i,vI.center.setFromMatrixPosition(c),e=o.bvhGeometry.boundsTree.intersectsSphere(vI)),e?s.currentIntersectedObjects.indexOf(o)===-1&&(s.currentIntersectedObjects.push(o),s.dispatch(),n.dispatchEvent(Z4e)):s.currentIntersectedObjects=s.currentIntersectedObjects.filter(u=>u!==o)}}}};function $4e(e){let t=this._clip.duration,i=this._clip.start??0,r=this.loop,n=this.time+e,s=this._loopCount,a=r===QU;if(e===0)return s===-1?n:a&&(s&1)===1?t-(n-i):n;if(r===PJ){s===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(n>=t)n=t;else if(n<0)n=0;else{this.time=n;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(s===-1&&(e>=0?(s=0,this._setEndings(!0,this.repetitions===0,a)):this._setEndings(this.repetitions===0,!0,a)),n>=t||n<i){let o=Math.floor((n-i)/(t-i));n-=(t-i)*o,s+=Math.abs(o);let l=this.repetitions-s;if(l<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,a||(n=e>0?t:i,this.repetitions===1&&(n=t)),this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(l===1){let c=e<0;this._setEndings(c,!c,a)}else this._setEndings(!1,!1,a);this._loopCount=s,this.time=n,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}else this.time=n;if(a&&(s&1)===1)return t-(n-i)}return n}var V7=!1,eke=class{constructor(e,t,i,r){this.scene=e,this.requestRender=t,this.updateDisplayProgress=i,this.animationInspectorState=r,this.clipIdToAction={},this.activeClip=null,this.needsUpdate=!1,this.addClip=n=>{n.data.type==="Empty"&&n.data.animations&&n.data.animations.forEach((s,a)=>{let o=s[0]+"/";if(Array.isArray(n.identity)?o+=n.identity[0]:o+=n.uuid,this.clipIdToAction[o])return;let l=JO.parse(JSON.parse(s[2]));n.animations[a]=l;let c=this.mixer.clipAction(l,n);V7===!1&&(Object.getPrototypeOf(c)._updateTime=$4e,V7=!0),c.clampWhenFinished=!0,this.clipIdToAction[o]=c})},this.mixer=new Wwe(e),this.scene.traverseEntity(this.addClip)}deleteClip(e,t){let i=this.scene.find(t);if(!i)return;let r=i.animations.find(s=>s.uuid===e);if(!r)return;let n=this.clipIdToAction[e];!n||(n.stop(),this.mixer.uncacheClip(r),delete this.clipIdToAction[e],i.animations=i.animations.filter(s=>s.uuid!==e))}get isPlaying(){return Object.values(this.clipIdToAction).some(e=>e.isRunning())}playFromInspector(e){this.mixer.stopAllAction();let t=this.clipIdToAction[e];!t||(t.play(),this.activeClip=t.getClip(),this.requestRender())}onExitPlayMode(){Object.values(this.clipIdToAction).forEach(e=>{e.repetitions=1/0,e.loop=DJ}),this.mixer.stopAllAction(),this.requestRender()}play(e){let t=e.clipId+"/"+e.object,i=this.clipIdToAction[t];if(i)return e&&(e.repeat>=0&&(i.repetitions=e.repeat+1),e.direction==="pingpong"&&e.repeat!==0&&(i.loop=QU)),i.play(),i.paused=!1,this.requestRender(),i}resumeFromInspector(e){let t=this.clipIdToAction[e];!t||(t.play(),t.paused=!1,this.requestRender())}pauseFromInspector(e){let t=this.clipIdToAction[e];!t||(t.paused=!0)}stop(){this.mixer.stopAllAction(),this.requestRender()}update(e){var t;if(this.needsUpdate)this.needsUpdate=!1;else if(this.isPlaying===!1||(t=this.animationInspectorState)!=null&&t.isScrubbing)return;this.mixer.update(e/1e3),this.activeClip&&this.updateDisplayProgress(Math.round(this.mixer.time/this.activeClip.duration*(this.maxFrames-1)%(this.maxFrames-1))),this.requestRender()}get maxFrames(){return ore(this.activeClip??void 0)}setProgressFromInspector(e,t){if(!this.clipIdToAction[t])return;this.activeClip!==this.clipIdToAction[t].getClip()&&this.playFromInspector(t);let i=this.clipIdToAction[t].paused;this.clipIdToAction[t].paused=!1,this.mixer.setTime(Math.min(e/(this.maxFrames-1),.9999)*this.activeClip.duration),this.requestRender(),i&&(this.clipIdToAction[t].paused=!0)}},yI=new WeakMap,tke=class extends Rb{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,i,r){let n=new $O(this.manager);n.setPath(this.path),n.setResponseType("arraybuffer"),n.setRequestHeader(this.requestHeader),n.setWithCredentials(this.withCredentials),n.load(e,s=>{this.decodeDracoFile(s,t).catch(r)},i,r)}decodeDracoFile(e,t,i,r){let n={attributeIDs:i||this.defaultAttributeIDs,attributeTypes:r||this.defaultAttributeTypes,useUniqueIDs:!!i};return this.decodeGeometry(e,n).then(t)}decodeGeometry(e,t){let i=JSON.stringify(t);if(yI.has(e)){let o=yI.get(e);if(o.key===i)return o.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let r,n=this.workerNextTaskID++,s=e.byteLength,a=this._getWorker(n,s).then(o=>(r=o,new Promise((l,c)=>{r._callbacks[n]={resolve:l,reject:c},r.postMessage({type:"decode",id:n,taskConfig:t,buffer:e},[e])}))).then(o=>this._createGeometry(o.geometry));return a.catch(()=>!0).then(()=>{r&&n&&this._releaseTask(r,n)}),yI.set(e,{key:i,promise:a}),a}_createGeometry(e){let t=new Nt;e.index&&t.setIndex(new Qt(e.index.array,1));for(let i=0;i<e.attributes.length;i++){let r=e.attributes[i],n=r.name,s=r.array,a=r.itemSize;t.setAttribute(n,new Qt(s,a))}return t}_loadLibrary(e,t){let i=new $O(this.manager);return i.setPath(this.decoderPath),i.setResponseType(t),i.setWithCredentials(this.withCredentials),new Promise((r,n)=>{i.load(e,r,void 0,n)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;let e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(i=>{let r=i[0];e||(this.decoderConfig.wasmBinary=i[1]);let n=ike.toString(),s=["/* draco decoder */",r,"","/* worker */",n.substring(n.indexOf("{")+1,n.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([s]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){let r=new Worker(this.workerSourceURL);r._callbacks={},r._taskCosts={},r._taskLoad=0,r.postMessage({type:"init",decoderConfig:this.decoderConfig}),r.onmessage=function(n){let s=n.data;switch(s.type){case"decode":r._callbacks[s.id].resolve(s);break;case"error":r._callbacks[s.id].reject(s);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+s.type+'"')}},this.workerPool.push(r)}else this.workerPool.sort(function(r,n){return r._taskLoad>n._taskLoad?-1:1});let i=this.workerPool[this.workerPool.length-1];return i._taskCosts[e]=t,i._taskLoad+=t,i})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}};function ike(){let e,t;onmessage=function(a){let o=a.data;switch(o.type){case"init":e=o.decoderConfig,t=new Promise(function(u){e.onModuleLoaded=function(h){u({draco:h})},DracoDecoderModule(e)});break;case"decode":let l=o.buffer,c=o.taskConfig;t.then(u=>{let h=u.draco,d=new h.Decoder,f=new h.DecoderBuffer;f.Init(new Int8Array(l),l.byteLength);try{let p=i(h,d,f,c),v=p.attributes.map(m=>m.array.buffer);p.index&&v.push(p.index.array.buffer),self.postMessage({type:"decode",id:o.id,geometry:p},v)}catch(p){console.error(p),self.postMessage({type:"error",id:o.id,error:p.message})}finally{h.destroy(f),h.destroy(d)}});break}};function i(a,o,l,c){let u=c.attributeIDs,h=c.attributeTypes,d,f,p=o.GetEncodedGeometryType(l);if(p===a.TRIANGULAR_MESH)d=new a.Mesh,f=o.DecodeBufferToMesh(l,d);else if(p===a.POINT_CLOUD)d=new a.PointCloud,f=o.DecodeBufferToPointCloud(l,d);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!f.ok()||d.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+f.error_msg());let v={index:null,attributes:[]};for(let m in u){let g=self[h[m]],y,x;if(c.useUniqueIDs)x=u[m],y=o.GetAttributeByUniqueId(d,x);else{if(x=o.GetAttributeId(d,a[u[m]]),x===-1)continue;y=o.GetAttribute(d,x)}v.attributes.push(n(a,o,d,m,g,y))}return p===a.TRIANGULAR_MESH&&(v.index=r(a,o,d)),a.destroy(d),v}function r(a,o,l){let c=l.num_faces()*3,u=c*4,h=a._malloc(u);o.GetTrianglesUInt32Array(l,u,h);let d=new Uint32Array(a.HEAPF32.buffer,h,c).slice();return a._free(h),{array:d,itemSize:1}}function n(a,o,l,c,u,h){let d=h.num_components(),f=l.num_points()*d,p=f*u.BYTES_PER_ELEMENT,v=s(a,u),m=a._malloc(p);o.GetAttributeDataArrayForAllPoints(l,h,v,p,m);let g=new u(a.HEAPF32.buffer,m,f).slice();return a._free(m),{name:c,array:g,itemSize:d}}function s(a,o){switch(o){case Float32Array:return a.DT_FLOAT32;case Int8Array:return a.DT_INT8;case Int16Array:return a.DT_INT16;case Int32Array:return a.DT_INT32;case Uint8Array:return a.DT_UINT8;case Uint16Array:return a.DT_UINT16;case Uint32Array:return a.DT_UINT32}}}var Xd;function rke(){return Xd||(Xd=new tke,Xd.setDecoderPath("https://www.gstatic.com/draco/versioned/decoders/1.5.2/").preload()),Xd.decoderPending}async function nke(e){if(Xd){let t={attributeIDs:Xd.defaultAttributeIDs,attributeTypes:Xd.defaultAttributeTypes,useUniqueIDs:!1},i;try{i=await Xd.decodeGeometry(new Int8Array(e).buffer,t)}catch(r){console.error(r)}if(i)return{index:i.index?{array:i.index.array}:void 0,attributes:Object.entries(i.attributes).map(([r,n])=>({name:r,itemSize:n.itemSize,array:n.array}))}}return null}async function ske(e,t){let[i,r]=fee(pz.deserialize(new Uint8Array(e)));return Uee(i),r.result().data}function ake(e){let t=[];return e.scene.objects.traverse((i,r)=>{r.type==="Mesh"&&r.geometry.type==="NonParametricGeometry"&&r.geometry.data.draco!==void 0&&t.push(r)}),t}async function oke(e){for(let t of e){let i=await nke(t.geometry.data.draco);if(i){let r=t.geometry.data;i.index&&(r.index={array:i.index.array,itemSize:1,normalized:!1,type:"Uint32Array"});let n={};i.attributes.forEach(({name:s,array:a,itemSize:o})=>{n[s]={array:a,itemSize:o,type:"Float32Array",normalized:!1}}),r.attributes=n,r.draco=void 0}}}var lke=class{constructor(){this._clickCount=0,this._lastTime=0,this._lastPosition=[0,0],this._delay=500,this._distance=2,this._onMouseDown=e=>{let t=[e.clientX,e.clientY],i=new Date().getTime();if(this._clickCount>0){let r=t[0]-this._lastPosition[0],n=t[1]-this._lastPosition[1];Math.sqrt(r*r+n*n)>this._distance&&(this._clickCount=0)}this._lastPosition=t,this._clickCount=i-this._lastTime>this._delay?1:this._clickCount+1,this._lastTime=i},this._onMouseUp=e=>{}}start(e,t=500,i=2){this._target&&this.stop(),this.reset(),this._delay=t,this._distance=i,this._target=e,this._target.addEventListener("pointerdown",this._onMouseDown,!1),this._target.addEventListener("pointerup",this._onMouseUp,!1)}stop(){this._target&&(this._target.removeEventListener("pointerdown",this._onMouseDown,!1),this._target.removeEventListener("pointerup",this._onMouseUp,!1),this._target=void 0)}get clickCount(){return this._clickCount}reset(){this._clickCount=0,this._lastTime=0,this._lastPosition=[0,0]}},cke=class{constructor(e,t,i,r,n,s,a,o){this.eventId=e,this.id=t,this.data=i,this.dataEvent=r,this.object=n,this.stage=!1,this.actions=zn(r,i.actions,s,a,o,n)}disconnect(){gs(this.actions)}dispatchIn(){this.actions.Audio.forEach(e=>e.dispatchBasic()),this.actions.Particles.forEach(e=>e.dispatchBasic()),this.actions.Video.forEach(e=>e.dispatchBasic()),this.actions.Create.forEach(e=>e.dispatch()),this.actions.Destroy.forEach(e=>e.dispatch()),this.actions.Reset.forEach(e=>e.dispatch()),this.actions.Link.forEach(e=>e.dispatch()),this.actions.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())}),this.actions.Transition.forEach(e=>e.toggle()),this.actions.Animation.forEach(e=>e.play()),this.actions.SwitchCamera.forEach(e=>e.play()),this.actions.SceneTransition.forEach(e=>e.dispatch()),this.actions.SetVariable.forEach(e=>e.checkConditions()),this.actions.SetVariable.forEach(e=>e.dispatch()),this.actions.DynamicVariablePlay.forEach(e=>e.dispatch()),this.actions.ClearLocalStorage.forEach(e=>e.dispatch()),this.actions.UserAPI.forEach(e=>e.dispatch())}dispatchOut(){this.actions.Transition.forEach(e=>{e.toggle()})}},uke=class extends ua{constructor(e,t){super(e),this.eventManager=t,this.breakpoints=[],this.resize=(i,r)=>{this.breakpoints.forEach(n=>{let s=yz.deviceToSize(n.data.size),a=n.dataEvent.orientation==="horizontal"?i:r,o;switch(n.data.operator){case"<":o=a<s[0];break;case">":o=a>s[0];break;case"<>":o=a>s[0]&&a<s[1];break}n.stage!==o&&(n.stage=o,n.stage?n.dispatchIn():n.dispatchOut())})},this.onResizeObserver=new ResizeObserver(i=>{for(let r of i){let{width:n,height:s}=r.contentRect;this.resize(n,s)}})}connect(){let{page:e,sharedAssets:t,domElement:i}=this.eventContext;this.onResizeObserver.observe(i);let r=n=>{var s;if(!(!n.visible||!((s=n.data)!=null&&s.events.length)))for(let{data:a,id:o}of n.data.events)a.disabled||a.type==="Resize"&&a.breakpoints.forEach(({data:l,id:c})=>{try{let u=new cke(o,c,l,a,n,e,t,this.eventManager);this.breakpoints.push(u)}catch{}})};e.traverseEntity(n=>{var s;(n instanceof ia||n instanceof hs)&&((s=n.frame)==null||s.traverse(a=>{r(a)})),r(n)})}disconnect(){this.onResizeObserver.disconnect(),this.breakpoints.forEach(e=>{e.disconnect()}),this.breakpoints=[]}},hke=class extends ua{constructor(e,t){super(e),this.eventManager=t,this.userAPIs={},this.events=[],this.onSuccess=({userAPIId:i})=>{this.events.forEach(r=>{r.data.userAPIId===i&&r.dispatchSuccess()})},this.onError=({userAPIId:i})=>{this.events.forEach(r=>{r.data.userAPIId===i&&r.dispatchError()})},this.userAPIs=e.sharedAssets.getUserAPIs()}connect(){this.eventContext.page.traverseEntity(e=>{var t;(t=e.data)==null||t.events.filter(i=>i.data.type==="API"&&!i.data.disabled).forEach(i=>{this.events.push(new dke(i.id,i.data,e,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager))})}),Object.entries(this.userAPIs).forEach(([e,t])=>{t.on("success",this.onSuccess),t.on("error",this.onError),t.autostart&&t.callUserAPI(this.eventContext.sharedAssets)})}disconnect(){Object.entries(this.userAPIs).forEach(([e,t])=>{t.off("success",this.onSuccess),t.off("error",this.onError)})}},dke=class{constructor(e,t,i,r,n,s){this.id=e,this.data=t,this.object=i,this.successActions=zn(t,t.successActions,r,n,s,i),this.errorActions=zn(t,t.errorActions,r,n,s,i)}dispatchSuccess(){this.dispatchActions(this.successActions)}dispatchError(){this.dispatchActions(this.errorActions)}dispatchActions(e){e.Audio.forEach(t=>t.dispatchConditional()),e.Particles.forEach(t=>t.dispatchConditional()),e.Video.forEach(t=>t.dispatchConditional()),e.Create.forEach(t=>t.dispatch()),e.Destroy.forEach(t=>t.dispatch()),e.Reset.forEach(t=>t.dispatch()),e.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this),t.init()}),e.Transition.forEach(t=>t.play()),e.Animation.forEach(t=>t.play()),e.SwitchCamera.forEach(t=>t.play()),e.SceneTransition.forEach(t=>t.dispatch()),e.SetVariable.forEach(t=>t.checkConditions()),e.SetVariable.forEach(t=>t.dispatch()),e.DynamicVariablePlay.forEach(t=>t.dispatch()),e.ClearLocalStorage.forEach(t=>t.dispatch()),e.UserAPI.forEach(t=>t.dispatch())}},fke=class extends ua{constructor(e,t){super(e),this.eventManager=t,this.userWebhooks={},this.events=[],this.onMessage=({userWebhookId:i})=>{this.events.forEach(r=>{r.data.userWebhookId===i&&r.dispatch()})},this.userWebhooks=e.sharedAssets.getUserWebhooks()}connect(){this.eventContext.page.traverseEntity(e=>{var t;(t=e.data)==null||t.events.filter(i=>i.data.type==="WEBHOOK"&&!i.data.disabled).forEach(i=>{this.events.push(new pke(i.id,i.data,e,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager))})}),Object.entries(this.userWebhooks).forEach(([e,t])=>{t.connect(),t.on("message",this.onMessage)})}disconnect(){Object.entries(this.userWebhooks).forEach(([e,t])=>{t.off("message",this.onMessage),t.disconnect()})}},pke=class{constructor(e,t,i,r,n,s){this.id=e,this.data=t,this.object=i,this.actions=zn(t,t.actions,r,n,s,i)}dispatch(){let e=this.actions;e.Audio.forEach(t=>t.dispatchConditional()),e.Particles.forEach(t=>t.dispatchConditional()),e.Video.forEach(t=>t.dispatchConditional()),e.Create.forEach(t=>t.dispatch()),e.Destroy.forEach(t=>t.dispatch()),e.Reset.forEach(t=>t.dispatch()),e.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this),t.init()}),e.Transition.forEach(t=>t.play()),e.Animation.forEach(t=>t.play()),e.SwitchCamera.forEach(t=>t.play()),e.SceneTransition.forEach(t=>t.dispatch()),e.SetVariable.forEach(t=>t.checkConditions()),e.SetVariable.forEach(t=>t.dispatch()),e.DynamicVariablePlay.forEach(t=>t.dispatch()),e.ClearLocalStorage.forEach(t=>t.dispatch()),e.UserAPI.forEach(t=>t.dispatch())}};function mke(){let e=document.createElement("textarea");return e.style.position="fixed",e.style.top="200px",e.style.left="400px",e.style.zIndex="-1",e.style.border="1px solid rgba(255,0,0,0.5)",e.style.width="10px",e.style.height="500px",e.style.color="white",e.style.opacity="0.5",e.style.background="transparent",e.style.display="none",e.style.margin="0px",e.style.padding="0px",e.style.boxSizing="content-box",e.style.pointerEvents="none",e}var gke=new N(0,0,1),G7=new N,H7=new N,j7=new Dn,vke=class{constructor(e,t,i,r,n){this.containerScene=e,this.raycaster=t,this.sharedAssets=i,this.requestRender=r,this.onExit=n,this.htmlInput=null,this.virtualInput=null,this.helper=new die,this.doubleClickHandler=new lke,this.isDragging=!1,this.plane=new Ka,this.caretInterval=0,this.planeIntersection=new N,this.projected=new Me,this._lastIndex=0,this._isFirstDragMove=!1,this.selectionOnDragStart=0,this.onTextMaterialChanged=()=>{var a;let s=(a=this.virtualInput)==null?void 0:a.data;if(this.virtualInput!==void 0&&s){let o=s.material,l=typeof o=="string"?this.sharedAssets.data.materials[o]:o,c=MBe(l,this.sharedAssets);this.helper.setCaretColor(c)}},this.stopAnimateTextCursor=()=>{clearInterval(this.caretInterval),this.helper&&(this.helper.caretMesh.visible=!1)},this.startAnimateTextCursor=()=>{this.stopAnimateTextCursor(),this.helper&&(this.helper.caretMesh.visible=!0,this.caretInterval=setInterval(()=>{this.helper&&(this.helper.caretMesh.visible=!this.helper.caretMesh.visible),this.requestRender()},600))},this.handleCaretUpdate=s=>{if(!this.htmlInput||!this.virtualInput)return;let a=this.helper,o=(s==null?void 0:s.key)==="ArrowLeft"||(s==null?void 0:s.key)==="ArrowRight",l=(s==null?void 0:s.key)==="ArrowUp"||(s==null?void 0:s.key)==="ArrowDown";this.htmlInput.selectionStart===this.htmlInput.selectionEnd?(a.setCaretPosition(this.htmlInput.selectionStart,{horizontalKeyMove:o,verticalKeyMove:l}),this.startAnimateTextCursor()):a.setSelection(this.htmlInput.selectionStart,this.htmlInput.selectionEnd),this.requestRender()},this.containerScene.add(this.helper)}createInput(){return this.htmlInput=mke(),this.htmlInput}connect(){}disconnect(){var e;this.stopAnimateTextCursor(),this.helper.hide(),(e=this.htmlInput)==null||e.remove(),this.doubleClickHandler.stop()}handleMouseDown(){var s,a;if(!this.htmlInput||!this.virtualInput)return!0;this.getPointOnPlane();let e=this.doubleClickHandler.clickCount,{index:t,lineIndex:i,characterIndex:r}=this.helper.getSelectionFromPosition(this.projected.x,this.projected.y,e>1?"inside":"previous")??{index:0,lineIndex:0,characterIndex:0};(a=(s=this.virtualInput)==null?void 0:s.wrappedText)!=null&&a.length&&this.virtualInput.wrappedText[i][Math.max(0,r-1)]===`
`&&(t--,r--),this._lastIndex=t,this._isFirstDragMove=!0;let n=this.checkClickedObject();if(e===1){if(n===null)return this.onExit(this.virtualInput),!0;this.selectionOnDragStart=t,this.isDragging=!0,this.setInputSelection(t)}else n===this.virtualInput&&(e===2?this.selectClosestWord(i,r):e>2&&(this.setInputSelection(0,this.htmlInput.value.length),this.doubleClickHandler.reset()))}handleMouseUp(){this.applyRangeToTextInput(),this.isDragging=!1,this._isFirstDragMove=!1}handleMouseMove(){!this.virtualInput||(this._isFirstDragMove&&this.doubleClickHandler.clickCount>1&&(this.selectionOnDragStart=this._lastIndex,this.isDragging=!0,this.setInputSelection(this._lastIndex)),this._isFirstDragMove=!1,this.getPointOnPlane(),this.applyRangeToTextInput())}focus(e){var t;if(this.virtualInput=e,this.updateTextInputStyles(),this.htmlInput)if(e){let i=(t=this.data)==null?void 0:t.geometry.text;this.htmlInput.value=typeof i=="string"?"":(i==null?void 0:i.textValue.toString())??""}else this.htmlInput.value=""}blur(){}get data(){let{virtualInput:e}=this;if(e)return e.dataPatched}applyRangeToTextInput(){var n;if(!this.isDragging||!this.virtualInput||!this.htmlInput)return;let e=this.selectionOnDragStart,{index:t,lineIndex:i,characterIndex:r}=this.helper.getSelectionFromPosition(this.projected.x,this.projected.y,this.doubleClickHandler.clickCount>2?"inside":"previous")??{index:0};i!==void 0&&r!==void 0&&((n=this.virtualInput)==null?void 0:n.wrappedText[i][r-1])===`
`&&t--,this.htmlInput.setSelectionRange(Math.min(e,t),Math.max(e,t))}checkClickedObject(){if(this.virtualInput){let e=this.raycaster.intersectObject(this.virtualInput,!1);if(e.length>0){let t=e[0];if(t.object instanceof f4)return t.object}}return null}selectClosestWord(e,t){if(!this.virtualInput)return;let i=this.virtualInput.wrappedText,r=i[e],n=t+1,s=t;r[t]!==" "&&(n=this.findNextCharOccurence(r,t,"forward"," "),s=this.findNextCharOccurence(r,t,"backward"," "),s>0&&s++,n>=r.length-1&&e===i.length-1&&n++);let a=this.helper,o=a.getGlobalIndexFromLineAndCharIndexes(i,e,s),l=a.getGlobalIndexFromLineAndCharIndexes(i,e,n);this.setInputSelection(o,l)}findNextCharOccurence(e,t,i,r=" "){let n=Math.max(0,e.length-1),s=i==="forward"?n:0,a=i==="forward"?1:-1,o=Math.max(Math.min(t,n),0);for(;o!==s;)if(o+=a,e.charAt(o)===r)return o;return s}getPointOnPlane(){var t;let e=(t=this.virtualInput)==null?void 0:t.data;if(!(!this.virtualInput||!e)&&this.raycaster.ray.intersectsPlane(this.plane)){this.planeIntersection===null&&(this.planeIntersection=new N);let i=this.raycaster.ray.intersectPlane(this.plane,this.planeIntersection);if(i){this.planeIntersection.copy(this.virtualInput.worldToLocal(i));let r=typeof e.geometry.width=="number"?e.geometry.width:1,n=typeof e.geometry.height=="number"?e.geometry.height:1;this.projected.set(i.x+r*.5,i.y-n*.5)}}}updatePlane(){var t;let e=(t=this.virtualInput)==null?void 0:t.data;this.virtualInput&&e&&(j7.getNormalMatrix(this.virtualInput.matrixWorld),G7.copy(gke).applyMatrix3(j7).normalize(),this.virtualInput.localToWorld(H7.set(0,0,e.geometry.depth)),this.plane.setFromNormalAndCoplanarPoint(G7,H7))}setInputSelection(e,t=e){var i;(i=this.htmlInput)==null||i.setSelectionRange(e,t),setTimeout(()=>{var r;(r=this.htmlInput)==null||r.focus()})}updateTextInputStyles(){var t;let e=(t=this.virtualInput)==null?void 0:t.data;this.virtualInput&&e&&this.htmlInput&&(this.htmlInput.style.fontSize=e.geometry.fontSize+"px",this.htmlInput.style.letterSpacing=e.geometry.letterSpacing*e.geometry.fontSize+"px",this.htmlInput.style.lineHeight=e.geometry.fontSize*e.geometry.lineHeight+"px",this.htmlInput.style.width=e.geometry.width+"px",this.htmlInput.style.height=e.geometry.height+"px",this.htmlInput.style.textAlign=yke(e.geometry.horizontalAlign))}};function yke(e){return e===4?"justify":e===2?"right":e===3?"center":"left"}var Are=(e,t)=>{if(typeof e=="string"){let i=t.data(e);if(i)return Are(i.value,t)}return Ls.getDisplayedValue(e)};function W7(e,t){let i=e.text,r="";if(typeof i=="string"){let n=t.variables.data(r);n&&(r=Are(n.value,t.variables))}else r=i.textValue.toString();return r}var xke=class extends ua{constructor(e,t){super(e),this.eventManager=t,this._textInputs=[],this.sceneHelpers=new co,this.helper=new die,this._onMouseDownFocusIn=i=>{if($t.length>1)return;this.eventContext.updateRaycaster(i);let r=null;if(this.eventContext.raycaster){for(let n of this._textInputs)if(this.eventContext.raycaster.intersectObject(n,!0).length>0){r=n;break}}this.focusOnTextInput(r),this._onCaretUpdate(),this._onMouseUp(),this.textInputManager.doubleClickHandler.start(this.eventContext.domElement),this.textInputManager.doubleClickHandler._onMouseDown(i),this._onMouseDown(i)},this.onExit=()=>{let{virtualInput:i}=this.textInputManager;if(i===null)return;let r=this.textInputManager.htmlInput;this.helper.hide(),r==null||r.setSelectionRange(r.value.length,r.value.length),this.eventManager.controlsManager.orbitControls&&(this.eventManager.controlsManager.orbitControls.enabled=!0);let{domElement:n}=this.eventContext;n.removeEventListener("pointerdown",this._onMouseDown,!1),n.removeEventListener("pointerup",this._onMouseUp,!1),n.removeEventListener("pointermove",this._onMouseMove,!1),window.removeEventListener("keydown",this._onKeyPress),this.textInputManager.doubleClickHandler.reset(),n.addEventListener("pointerdown",this._onMouseDownFocusIn),this.eventContext.renderer.sceneHelpersOnTop=void 0,this.eventContext.renderer.pipeline.disableHelpers()},this._onMouseDown=i=>{this.eventContext.updateRaycaster(i),this.textInputManager.handleMouseDown(),this.textInputManager.virtualInput&&this.eventContext.raycaster.intersectObject(this.textInputManager.virtualInput,!0).length>0&&this.eventManager.controlsManager.orbitControls&&(this.eventManager.controlsManager.orbitControls.enabled=!1)},this._onMouseUp=()=>{this.textInputManager.handleMouseUp(),this.eventManager.controlsManager.orbitControls&&!this.eventManager.controlsManager.orbitControls.enabled&&(this.eventManager.controlsManager.orbitControls.enabled=!0)},this._onMouseMove=i=>{this.eventContext.updateRaycaster(i),this.textInputManager.handleMouseMove()},this._onTextEdit=i=>{let{htmlInput:r,virtualInput:n,helper:s}=this.textInputManager;if(!r||!n)return;let a=r.value;n.textGeometry.setText(a).then(()=>{this.eventContext.requestRender()});let o=n.data;s.update();let l=o.geometry.text;if(typeof l=="string"){let c=l;this.eventContext.sharedAssets.updateVariable(c,{textValue:a})}this.textInputManager.updateTextInputStyles(),this._onCaretUpdate()},this._onCaretUpdate=i=>{this.textInputManager.handleCaretUpdate(i)},this._onKeyPress=i=>{i.key==="Escape"&&this.onExit()},this.textInputManager=new vke(this.sceneHelpers,e.raycaster,e.sharedAssets,e.requestRender,this.onExit)}connect(){let e=[];if(this.eventContext.scene.traverseEntity(r=>{r instanceof f4&&e.push(r)}),this._textInputs=e,e.length===0)return;let{domElement:t}=this.eventContext;t.addEventListener("pointerdown",this._onMouseDownFocusIn),this.textInputManager.connect();let i=this.textInputManager.createInput();document.body.appendChild(i),i.style.display="none",i.addEventListener("keyup",this._onCaretUpdate),i.addEventListener("keydown",this._onCaretUpdate),i.addEventListener("beforeinput",this._onCaretUpdate),i.addEventListener("paste",this._onCaretUpdate),i.addEventListener("cut",this._onCaretUpdate),i.addEventListener("select",this._onCaretUpdate),i.addEventListener("selectstart",this._onCaretUpdate)}disconnect(){let e=this.textInputManager.htmlInput,{domElement:t}=this.eventContext;t.removeEventListener("pointerdown",this._onMouseDownFocusIn),e==null||e.removeEventListener("keyup",this._onCaretUpdate),e==null||e.removeEventListener("keydown",this._onCaretUpdate),e==null||e.removeEventListener("beforeinput",this._onCaretUpdate),e==null||e.removeEventListener("paste",this._onCaretUpdate),e==null||e.removeEventListener("cut",this._onCaretUpdate),e==null||e.removeEventListener("select",this._onCaretUpdate),e==null||e.removeEventListener("selectstart",this._onCaretUpdate),this._textInputs.forEach(i=>{let r=W7(i.data.geometry,this.eventContext.sharedAssets.data);i.textGeometry.setText(r)}),t.removeEventListener("pointerdown",this._onMouseDown,!1),t.removeEventListener("pointerup",this._onMouseUp,!1),t.removeEventListener("pointermove",this._onMouseMove,!1),window.addEventListener("keydown",this._onKeyPress),this.eventContext.renderer.sceneHelpersOnTop=void 0,this.eventContext.renderer.pipeline.disableHelpers(),this.textInputManager.disconnect()}focusOnTextInput(e){this.textInputManager.focus(e),this.textInputManager.onTextMaterialChanged();let t=this.textInputManager.htmlInput;if(!t||e===null)return;this.textInputManager.updateTextInputStyles(),this.eventContext.renderer.sceneHelpersOnTop=this.sceneHelpers,this.eventContext.renderer.pipeline.enableHelpers(),this.textInputManager.isDragging=!1;let i=W7(e.textGeometry.userData.parameters,this.eventContext.sharedAssets.data);t.value=i,t.setSelectionRange(0,0),this.textInputManager.helper.show(e),t.style.display="block",t.addEventListener("input",this._onTextEdit),this.textInputManager.updatePlane();let{domElement:r}=this.eventContext;r.removeEventListener("pointerdown",this._onMouseDownFocusIn),r.addEventListener("pointerdown",this._onMouseDown,!1),r.addEventListener("pointerup",this._onMouseUp,!1),r.addEventListener("pointermove",this._onMouseMove,!1),window.addEventListener("keydown",this._onKeyPress)}},wke=class extends ua{constructor(e,t){super(e),this.eventManager=t,this.events=[],this.onVoice=({value:i,frequencies:r})=>{this.events.forEach(n=>{n.dispatch()})}}connect(){this.openAIRealtime=this.eventContext.sharedAssets.openAIRealtime,this.openAIRealtime&&(this.eventContext.page.traverseEntity(e=>{var t;(t=e.data)==null||t.events.filter(i=>i.data.type==="AIAssistantListener"&&!i.data.disabled).forEach(i=>{this.events.push(new bke(i.id,i.data,e,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager))})}),this.openAIRealtime.on("voice",this.onVoice))}disconnect(){var e;(e=this.openAIRealtime)==null||e.off("voice",this.onVoice)}},bke=class{constructor(e,t,i,r,n,s){this.id=e,this.data=t,this.object=i,this.actions=zn(t,t.actions,r,n,s,i)}dispatch(){this.dispatchActions(this.actions)}dispatchActions(e){e.Audio.forEach(t=>t.dispatchConditional()),e.Particles.forEach(t=>t.dispatchConditional()),e.Video.forEach(t=>t.dispatchConditional()),e.Create.forEach(t=>t.dispatch()),e.Destroy.forEach(t=>t.dispatch()),e.Reset.forEach(t=>t.dispatch()),e.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this),t.init()}),e.Transition.forEach(t=>t.play()),e.Animation.forEach(t=>t.play()),e.SwitchCamera.forEach(t=>t.play()),e.SceneTransition.forEach(t=>t.dispatch()),e.SetVariable.forEach(t=>t.checkConditions()),e.SetVariable.forEach(t=>t.dispatch()),e.DynamicVariablePlay.forEach(t=>t.dispatch()),e.ClearLocalStorage.forEach(t=>t.dispatch()),e.UserAPI.forEach(t=>t.dispatch())}},_ke=class extends ua{constructor(e,t){super(e),this.eventManager=t,this.events=[],this.onTriggerEvent=({description:i,direction:r})=>{let n=this.events.find(s=>s.data.description===i);n&&(r==="backward"?n.dispatchReverse():n.dispatch())}}connect(){this.openAIRealtime=this.eventContext.sharedAssets.openAIRealtime,this.openAIRealtime&&(this.eventContext.page.traverseEntity(e=>{var t;(t=e.data)==null||t.events.filter(i=>i.data.type==="AIAssistantTrigger"&&!i.data.disabled).forEach(i=>{this.events.push(new Ske(i.id,i.data,e,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager))})}),this.openAIRealtime.on("trigger_event",this.onTriggerEvent))}disconnect(){var e;(e=this.openAIRealtime)==null||e.off("trigger_event",this.onTriggerEvent)}},Ske=class{constructor(e,t,i,r,n,s){this.id=e,this.data=t,this.object=i,this.actions=zn(t,t.actions,r,n,s,i)}dispatch(){let e=this.actions;e.Audio.forEach(t=>t.dispatchConditional()),e.Particles.forEach(t=>t.dispatchConditional()),e.Video.forEach(t=>t.dispatchConditional()),e.Create.forEach(t=>t.dispatch()),e.Destroy.forEach(t=>t.dispatch()),e.Reset.forEach(t=>t.dispatch()),e.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this),t.init()}),e.Transition.forEach(t=>t.play()),e.Animation.forEach(t=>t.play()),e.SwitchCamera.forEach(t=>t.play()),e.SceneTransition.forEach(t=>t.dispatch()),e.SetVariable.forEach(t=>t.checkConditions()),e.SetVariable.forEach(t=>t.dispatch()),e.DynamicVariablePlay.forEach(t=>t.dispatch()),e.ClearLocalStorage.forEach(t=>t.dispatch()),e.UserAPI.forEach(t=>t.dispatch())}dispatchReverse(){let e=this.actions;e.Transition.forEach(t=>t.reverseFromCurrent()),e.Particles.forEach(t=>t.reverseFromCurrent()),e.Animation.forEach(t=>t.reverseFromCurrent()),e.SwitchCamera.forEach(t=>t.reverseFromCurrent()),e.Create.forEach(t=>t.dispatchStop())}},Mke=class{constructor(e,t,i,r,n){this.publish=e,this.controlsManager=t,this.animationControls=i,this.eventContext=r,this.sharedVariables=n,this.isEnabled=!1,this.activateCount=0,this.needsMouse=!1,this.needsRaycast=!1,this.onTouchMovePreventScroll=s=>{let a=window.parent!==window,o=document.documentElement.scrollHeight>document.documentElement.clientHeight||document.documentElement.scrollWidth>document.documentElement.clientWidth;(s.touches.length>1||this.preventTouchScroll||a===!1&&o===!1)&&s.preventDefault()},this.onMouseWheelPreventScroll=s=>{this.preventScroll&&s.preventDefault()},this.onMouseMove=s=>{this.eventContext.sharedAssets.mouseProperty={...this.getMousePosition(s),pressed:s.buttons>0}},this.onMouseDown=s=>{this.eventContext.sharedAssets.mouseProperty={...this.getMousePosition(s),pressed:!0}},this.onMouseUp=s=>{this.eventContext.sharedAssets.mouseProperty={...this.getMousePosition(s),pressed:!1}},this.getMousePosition=s=>{var c;let{domRect:a}=this.eventContext,{pageX:o,pageY:l}=((c=s.touches)==null?void 0:c.length)>0?s.touches[0]:s;return{x:o-(a.left+window.scrollX),y:l-(a.top+window.scrollY)}},this.stopRaycast=e.stopRaycast,this.preventScroll=e.preventScroll,this.preventTouchScroll=e.preventTouchScroll,this.hideCursor=e.hideCursor,this.requestRender=r.requestRender}activate(e=!1){var r;if(this.isEnabled)return;this.isEnabled=!0,this.initializeActionsDependentStates(),this.needsMouse&&(this.eventContext.domElement.addEventListener("pointermove",this.onMouseMove),this.eventContext.domElement.addEventListener("pointerdown",this.onMouseDown)),this.handlers={Spline:new KNe(this.eventContext),VariableChange:new P4e(this.eventContext,this.sharedVariables,this,this.needsMouse,this.needsRaycast),API:new hke(this.eventContext,this),WEBHOOK:new fke(this.eventContext,this),AIAssistantListener:new wke(this.eventContext,this),AIAssistantTrigger:new _ke(this.eventContext,this),Conditional:new n4e(this.eventContext,this),Start:new T4e(this.eventContext,this),Basic:new $Ne(this.eventContext,this,this.needsRaycast),MouseHover:new _4e(this.eventContext,this),Scroll:new E4e(this.eventContext,this),Follow:new p4e(this.eventContext,this),DragDrop:new c4e(this.eventContext,this),LookAt:new x4e(this.eventContext),Resize:new uke(this.eventContext,this),Textfields:new xke(this.eventContext,this)};let{page:t,domElement:i}=this.eventContext;this.hideCursor&&(i.style.cursor="none"),t.traverseEntity(n=>{n.addEventListener("requestRender",this.requestRender)}),Object.values(this.handlers).forEach(n=>n.connect()),i.addEventListener("wheel",this.onMouseWheelPreventScroll),i.addEventListener("touchmove",this.onTouchMovePreventScroll),this.activateCount++,e||((r=this.eventContext.sharedAssets.openAIRealtime)==null||r.connect())}deactivate(e=!1){var r,n;if(!this.isEnabled)return;this.isEnabled=!1,this.eventContext.domElement.removeEventListener("pointermove",this.onMouseMove),this.eventContext.domElement.removeEventListener("pointerdown",this.onMouseDown),this.eventContext.domElement.removeEventListener("pointerup",this.onMouseUp),this.eventContext.sharedAssets.mouseProperty=null,this.eventContext.sharedAssets.raycastProperty=null;let{page:t,domElement:i}=this.eventContext;i.style.cursor="",Object.values(this.handlers).forEach(s=>s.disconnect()),(r=this.controlsManager.gameControl)==null||r.disposeActions(),this.controlsManager.disconnectEvents(),t.traverseEntity(s=>{s.removeEventListener("requestRender",this.requestRender),s.destroyedInAction=!1}),i.removeEventListener("touchmove",this.onTouchMovePreventScroll),i.removeEventListener("wheel",this.onMouseWheelPreventScroll),this.animationControls.onExitPlayMode(),e||((n=this.eventContext.sharedAssets.openAIRealtime)==null||n.disconnect())}get isPaused(){return this.isEnabled}pause(){this.deactivate()}resume(){this.activate()}reset(){this.deactivate(!0),this.activate(!0),this.controlsManager.deactivate(),this.controlsManager.activate(this),this.controlsManager.page.updateMatrixWorld(!0),this.controlsManager.rebuildBVH()}updateUseWindowEvents(e){let t=this.isEnabled;t&&this.deactivate(),this.eventContext.useWindowEvents=e,t&&this.activate()}initializeActionsDependentStates(){let e=this.eventContext.sharedAssets;e.resetDynamicVariablePlayState();let t=i=>{if(i.data.type==="Conditional"&&(i.data.ifActions.forEach(t),i.data.elseActions.forEach(t)),i.data.type==="Conditional"||i.data.type==="SetVariable")for(let r of i.data.type==="Conditional"?i.data.condition:i.data.expression)"id"in r&&Array.isArray(r.id)&&(r.id[0]==="mouse"&&(this.needsMouse=!0),r.id[0]==="raycast"&&(this.needsRaycast=!0));i.data.type==="DynamicVariablePlay"&&i.data.variableId!==""&&(i.data.mode==="Play"||i.data.mode==="PlayPause"||i.data.mode==="Toggle")&&e.setDynamicVariablePlayState(i.data.variableId,"Stopped")};this.eventContext.page.traverseEntity(i=>{var r;if((r=i.data)!=null&&r.events.length)for(let n of i.data.events)if(n.data.type==="VariableChange"&&(n.data.variableId==="mouseProperty"&&(this.needsMouse=!0),n.data.variableId==="raycastProperty"&&(this.needsRaycast=!0)),n.data.type==="Conditional")for(let s of["inActions","outActions"])n.data[s].forEach(t);else if(n.data.type==="DragDrop")for(let s of["drag","drop"])n.data.dragDropActions[s].forEach(t);else if(n.data.type==="GameControl")for(let s of["idle","move","jump","run"])n.data.gameActions[s].forEach(t);else if(n.data.type==="Resize")for(let s of n.data.breakpoints)s.data.actions.forEach(t);else n.data.type==="LookAt"||n.data.type==="API"||n.data.actions.forEach(t)})}},Eke=class{constructor(e,t,i,r,n){this._aspect=1,this.enableResponsive=!1,this._renderer=e,this._camera=t,this._frameSize=new Me().copy(i),this._editorSize=new Me().copy(r),this._aspect=t.aspect,this._fov=n??t.fov}set frameSize(e){this._frameSize.copy(e)}updateRenderer(){!this._renderer||this._renderer.setSize(this._frameSize.x,this._frameSize.y)}updateViewport(){if(!this._renderer||!this._camera||this._camera.cameraType!=="PerspectiveCamera")return;let e=this._frameSize.x,t=this._frameSize.y,i=this._editorSize.y;this._aspect=e/t,t<=i&&(this._camera.zoom*=i/t),this._renderer.setViewport(0,0,e,t)}updateCamera(e=!0){if(this._camera)if(this._camera.cameraType==="PerspectiveCamera"){let t=this._frameSize.y,i=this._editorSize.y,r=this._fov;if(e&&t>i){let n=Ake(t,1080,2160,1,15)/100;r*=t/i,r*=1-n}this._camera.aspect=this._aspect,this._camera.fov=r,this._camera.updateProjectionMatrix()}else this._camera.setViewplaneSize(this._frameSize.x,this._frameSize.y,this.enableResponsive)}setCamera(e){this._camera=e,this._aspect=e.aspect,this._fov=e.fov}revert(){let e=window.innerWidth,t=window.innerHeight;this._renderer&&(this._renderer.setViewport(0,0,e,t),this._renderer.setSize(e,t)),this._camera&&(this._camera.aspect=e/t,this._camera.fov=this._fov,this._camera.setViewplaneSize(e,t,this.enableResponsive),this._camera.updateProjectionMatrix())}};function Ake(e,t,i,r,n){return(e-t)/(i-t)*(n-r)+r}var Tke=class{get sharedAssets(){return this.shared}constructor(e,t={},i=!0){this.shared=new i4(e.shared,t,!0,i),this.scene=new g4(e.scene,this.sharedAssets),this.shared.setEntityOpContext({scene:this.scene,shared:this.shared})}reset(e,t){this.scene.clearScene(),this.sharedAssets.reset(e.shared),this.scene.resetAfterClear(e.scene,this.sharedAssets)}resetPersonalCameraFromDocumentData(){for(let e of this.scene.children)e instanceof hs&&!e.uiScene&&e.personalCamera.updateState(e.data.camera,{scene:this.scene,shared:this.shared})}dispose(){this.scene.dispose(),this.shared.dispose()}gc(){this.shared.geometryCache.startGc(),this.shared.geometryCache2.startGc(),this.scene.traverseEntity(e=>{e instanceof Rn&&e.markGeometryAsReachable(this.shared)}),this.shared.geometryCache.endGc(),this.shared.geometryCache2.endGc()}},Cke=class{constructor({x:e=10,y:t=10}){this._startTime=0;let i=document.getElementById("spe-perfs");i?this.element=i:(this.element=document.createElement("div"),document.body.appendChild(this.element),this.element.style.position="absolute",this.element.style.zIndex="10000",this.element.style.fontFamily="monospace",this.element.style.background="black",this.element.style.color="white",this.element.style.padding="10px",this.element.style.opacity="0.5",this.element.style.fontSize="11px",this.element.setAttribute("id","spe-perfs")),this.element.style.left=`${e}px`,this.element.style.top=`${t}px`}dispose(){var e;(e=this.element.parentElement)==null||e.removeChild(this.element)}start(){this._startTime=performance.now()}end(){let e=performance.now()-this._startTime;this.element.innerHTML=e.toFixed(3)+" ms"}};function Pke(e){let t;if(e.index)for(let i=0;i<e.index.array.length;i+=3)t=e.index.array[i],e.index.array[i]=e.index.array[i+2],e.index.array[i+2]=t}function jx(e){return e instanceof Qw?"SubdivObject":e.geometry.type==="NonParametricGeometry"?"NonParametric":"Mesh"}function Dke(e,t){let i={};return e.traverseEntity(r=>{var l;if(!r.visible||!(r instanceof za)||r.type!=="Mesh"||Array.isArray(r.material)||r.states&&Object.keys(r.states).length)return;let n=r.parent;for(;n;){if(n instanceof za&&r.states&&Object.keys(r.states).length)return;n=n.parent}let s=r.material.uuid,a=t.shared.materials[s];if(a){if(!ps.isMergable(a))return}else{let c=(l=t.scene.objects.get(r.uuid))==null?void 0:l.data;if(c&&"material"in c&&typeof c.material!="string"){if(!ps.isMergable(c.material))return;s=ps.getHash(c.material)}}i[s]||(i[s]={});let o=i[s][jx(r)];if(o){if(o.push(r),r.cloner)for(let c of r.cloner.children)o.push(c)}else if(i[s][jx(r)]=[r],r.cloner)for(let c of r.cloner.children)i[s][jx(r)].push(c)}),i}function Rke(e){let t=0;return Object.values(e).forEach(i=>{Object.values(i).forEach(r=>{let n=r.length;n>t&&(t=n)})}),t}function Ike(e,t){let i=Dke(t,e),r=Rke(i),n=new Array(r),s=0,a=new Array(r),o=0,l=new Array(r),c=0,u=new Array(r),h=0;for(let[d,f]of Object.entries(i))for(let p of Object.values(f)){if(o=0,c=0,p.forEach(m=>{m instanceof za&&(a[o++]=m.geometry.clone(),l[c++]=m)}),c<2)continue;for(let m=0;m<c;m++)l[m].updateWorldMatrix(!0,!1),a[m].applyMatrix4(l[m].matrixWorld),l[m].matrixWorld.determinant()<0&&Pke(a[m]);let v=Qp(a.slice(0,o),!1);if(v){let m;switch(d){case"SubdivObject":{console.warn("Turning subdiv object into mesh"),m=new yr(v,l[0].material);break}default:{m=new yr(v,l[0].material);break}}m.castShadow=l[0].castShadow,m.receiveShadow=l[0].receiveShadow,t.add(m);let g=y=>{h=0;for(let x of y)x.children&&g(x.children),x instanceof za&&(Array.isArray(x.material)||i[x.material.uuid]&&i[x.material.uuid][jx(x)]&&i[x.material.uuid][jx(x)].length>1||(u[h++]=x));for(let x=0;x<h;x++)t.attach(u[x])};for(let y=0;y<c;y++){let x=l[y];g(x.children),n[s++]=x}}}for(let d=0;d<s;d++)n[d].removeFromParent()}var Lke=Tf(Pme(),1),Oke=new Me;function zke(e){let t="The Spline Runtime only accepts .splinecode files that are generated from Spline export panel.";e.endsWith(".spline")?console.warn(t+" The .spline files are only meant to be used by the Editor."):e.endsWith(".splinecode")||console.warn(t)}var Bke=class{constructor(e,{renderOnDemand:t,renderMode:i="auto"}={}){this._viewportMode=1,this._viewportWidth=window.innerWidth,this._viewportHeight=window.innerHeight,this._proxyObjectCache=new Map,this._variablesCache=new Map,this._isPaused=!1,this._renderRequested=!1,this._skipRender=!1,this.time=performance.now(),this.dt=0,this.currentTAAFrame=0,this.disposed=!1,this._requestRenderAutoMode=()=>{this._skipRender=!1},this.requestRender=()=>{this._renderRequested=!0},this.render=r=>{var n,s,a,o,l,c,u,h,d,f,p,v,m;if(this.time=r,this._lastTime&&(this.dt=this.time-this._lastTime),this._lastTime=this.time,(n=this._perfs)==null||n.start(),!this._renderer){(s=this._perfs)==null||s.end();return}if(!this._isPaused&&(this.renderMode==="manual"&&!this._renderRequested||this.renderMode==="auto"&&this._skipRender)){(a=this._perfs)==null||a.end();return}if(this._renderRequested=!1,this._skipRender=!0,this._controls&&(this._skipRender=this._controls.update(this.dt)),this._eventManager&&((o=this._eventManager.handlers)!=null&&o.Start.hasVideoAction||(l=this._eventManager.handlers)!=null&&l.Basic.hasVideoAction||(c=this._eventManager.handlers)!=null&&c.Conditional.hasVideoAction)&&(this._skipRender=!1),(u=this._animationControls)==null||u.update(this.dt),this._skipRender?(this.currentTAAFrame++,this.currentTAAFrame<32?this._skipRender=!1:this.currentTAAFrame=0):this.currentTAAFrame=0,(h=this._scene)==null||h.traverseVisibleEntity(g=>{g.type==="ParticleSystem"&&(g.update(this.dt),this._skipRender=!1)}),this._scene&&this._scene.activeCamera!==this._camera&&(this._camera=this._scene.activeCamera),(d=this._eventManager)!=null&&d.isEnabled&&(((f=this._eventManager.handlers)==null?void 0:f.Follow).onAnimationFrameDamping(),((p=this._eventManager.handlers)==null?void 0:p.LookAt).onAnimationFrameDamping(),((v=this._eventManager.handlers)==null?void 0:v.DragDrop).onAnimationFrameDamping()),this._scene&&this._camera){if(this._scene.pathConstraints.applyConstraints(this._scene),this._renderer.sceneTransitionTimeRemaining>0){this._renderer.sceneTransitionTimeRemaining-=this.dt;let g=1-this._renderer.sceneTransitionTimeRemaining/this._renderer.sceneTransitionDuration;this._renderer.pipeline.sceneTransitionPass.uniforms.mixRatio.value=g,this._skipRender=!1}else this._renderer.pipeline.sceneTransitionFromTexture=null;this._renderer.renderSplineScene(this._scene,this._camera)}this.canvas.dispatchEvent(this._renderedEvent),(m=this._perfs)==null||m.end()},this._resize=r=>{var n,s,a,o,l,c,u,h,d,f;if(this._renderer){if(this._viewportMode===1&&this._frameView&&(this._frameView.frameSize=Oke.set(this._viewportWidth,this._viewportHeight)),r){let p=this._viewportWidth,v=this._viewportHeight;this._renderer.setSize(p-1,v-1,!1),this._renderer.setSize(p,v,!1)}else this._renderer.setSize(this._viewportWidth,this._viewportHeight,!1);if(this._camera=(n=this._scene)==null?void 0:n.activeCamera,(u=this._scene)==null||u.updateViewPlaneSize(((a=(s=this._frameView)==null?void 0:s.frameSize)==null?void 0:a.x)??this._viewportWidth,((l=(o=this._frameView)==null?void 0:o.frameSize)==null?void 0:l.y)??this._viewportHeight,((c=this._frameView)==null?void 0:c.enableResponsive)??!1),this._camera){let p=Object.values(((h=this._data)==null?void 0:h.frames)??{})[0].preset??"fullscreen";(d=this._frameView)==null||d.setCamera(this._camera),(f=this._frameView)==null||f.updateCamera(p!=="fullscreen"),this._camera.cameraType==="PerspectiveCamera"&&(this._camera.aspect=this._viewportWidth/this._viewportHeight),this._camera.updateProjectionMatrix()}this.eventManager&&(this.eventManager.eventContext.domRect=this.canvas.getBoundingClientRect()),this._requestRenderAutoMode()}},this._debouncedResize=Fw(this._resize,10),this._onScroll=r=>{this.eventManager&&(this.eventManager.eventContext.domRect=this.canvas.getBoundingClientRect())},this.canvas=e,this.renderMode=t?"auto":i,this._renderedEvent=new CustomEvent("rendered",{bubbles:!0}),Object.defineProperty(this._renderedEvent,"target",{writable:!1,value:this}),window.location.search.includes("perfs")&&(this._perfs=new Cke({x:10,y:10})),DCe(e)}async load(e,t,i){zke(e),this.disposed=!1;let r=await(await fetch(e,i)).arrayBuffer();await this.start(r,{variables:t})}async start(e,{interactive:t=!0,variables:i}={}){var l,c,u,h;if(this.disposed)return;let r=await ske(e);this._data=r;let n=ake(r);r.version&&(0,Lke.default)(r.version,"1.9.75")>0&&console.warn("Your .splinecode file is more recent than the library. Please upgrade @splinetool/runtime to the latest version."),await Promise.all([n.length&&rke(),m9(r)&&ORe(),NLe(r)&&DRe(),Gw.physicsEnabled(r.scene.objects)&&zCe(),h9(r)&&mLe(),W9(r)&&ZFe(),fLe(r)&&dLe(),B9(r)&&BBe(),V4e(r)&&LCe()].filter(Boolean)),n.length&&await oke(n),(l=this._eventManager)==null||l.deactivate(),(c=this._controls)==null||c.deactivate(),(u=this._scene)==null||u.dispose();let s=new Tke(r);if(s.resetPersonalCameraFromDocumentData(),this._scene=s.scene,this._sharedAssetsManager=s.sharedAssets,this._camera=this._scene.activeCamera,window.location.search.includes("merge-geometries")){let d=performance.now();Ike(r,s.scene);let f=performance.now();console.log("Merged geometries in ",f-d," ms")}m9(r)&&this._scene.traverse(d=>{fh(d)&&d.recomputeBoolean()}),this._sharedAssetsManager.setRequestRender(()=>{var d;this._requestRenderAutoMode(),(d=this._scene)==null||d.traverse(f=>{f instanceof fl&&f.pendingMediaLoad&&f.update()})}),(h=this._scene)==null||h.traverse(d=>{d.type==="ParticleSystem"&&(d.wakeUp(),d.data.autoPlay?d.start():d.stop())});let a=Object.keys(r.shared.fonts).map(d=>this._sharedAssetsManager.getFont(d).loadingPromise);if(Promise.all(a).then(()=>{s.scene.markNeedsUpdateRendererDirty(),this._requestRenderAutoMode()}),h9(r)&&K4e(r)&&await Promise.all(a),B9(r)){let d=[];this._scene.traverseEntity(f=>{(f instanceof ia||f instanceof hs)&&f.uiCanvas&&d.push(f.uiCanvas)}),await Promise.all(d.map(f=>f.promise))}if(this._scene.rewriteEventsBeforeGoToPlayMode(),P4(this._scene.activePage,this._sharedAssetsManager),!this._renderer&&(this._renderer=new _Be({canvas:this.canvas,antialias:!1,alpha:!0,stencil:!1,depth:!1,powerPreference:"high-performance"}),this._renderer.hdTransmission=r.scene.publish.hdTransmission===!0,this._renderer.setPixelRatio(window.devicePixelRatio),this._renderer.pipeline.enableUIOverlay(),this._renderer.pipeline.addEventListener("smaaloaded",this._requestRenderAutoMode),r.shared.images.SplineWatermark)){let d=this._sharedAssetsManager.getImage("SplineWatermark");await d.loadPromise;let f=d.getTexture(1001);this._renderer.pipeline.setWatermark(f)}W9(r)&&this._scene.initializeSplatViewer(),r.scene.blueNoiseTextureData!==void 0&&this._renderer.pipeline.updateBlueNoiseTexture(r.scene.blueNoiseTextureData);let o=Object.values(r.frames)[0];if(this._frameView?this._frameView.setCamera(this._camera):(o.preset==="fullscreen"?(this._viewportMode=1,this.canvas.style.display="block",this.canvas.parentElement&&(this._viewportWidth=this.canvas.parentElement.clientWidth||300,this.canvas.style.width="100%"),this.canvas.parentElement&&(this._viewportHeight=this.canvas.parentElement.clientHeight||150,this.canvas.style.height="100%")):(this._viewportMode=2,this._viewportWidth=o.size[0],this._viewportHeight=o.size[1],this.canvas.style.width=`${this._viewportWidth}px`,this.canvas.style.height=`${this._viewportHeight}px`),this._renderer.setSize(this._viewportWidth,this._viewportHeight,!1),this._frameView=new Eke(this._renderer,this._camera,new Me(this._viewportWidth,this._viewportHeight),new Me(window.innerWidth,window.innerHeight)),this._frameView.enableResponsive=(o.allowResponsive??!1)&&o.preset==="fullscreen"),t){let d=new QNe(this._renderer,this.data.scene.publish,this._scene,()=>this._scene.activeCamera,this._sharedAssetsManager,this._requestRenderAutoMode,!0,o);this._scene.updateMatrixWorld(!0),this._controls=new J4e(d),this._animationControls=new eke(this._scene,this._requestRenderAutoMode),this._eventManager=new Mke(r.scene.publish,this._controls,this._animationControls,d,r.shared.variables),this._eventManager.activate(),this._controls.activate(this._eventManager)}this._resize(),this._scene.activePage.data.postprocessing.depthOfField.enabled&&Promise.all(this._sharedAssetsManager.getImageLoadPromises()).then(()=>{this._resize(!0)}),i!==void 0&&this.setVariables(i),this.dt===0&&(this.render(performance.now()),setTimeout(()=>{var d;(d=this._renderer)==null||d.setAnimationLoop(this.render)},0)),this._resizeObserverTimeout=setTimeout(()=>{!this._resizeObserver&&this.canvas.parentElement&&(this._resizeObserver=new ResizeObserver(()=>{this._viewportWidth=this.canvas.clientWidth,this._viewportHeight=this.canvas.clientHeight,this._debouncedResize()}),this._resizeObserver.observe(this.canvas.parentElement))},300),document.addEventListener("scroll",this._onScroll)}setVariables(e){if(this._data!==void 0){let t=Object.entries(e);for(let[i,r]of t)this.setVariable(i,r)}}setVariable(e,t){var r;let i=this._getVariableByName(e);if(i&&!("dynamicVariableType"in i.data)){let n=t;typeof i.data.value=="number"?n=typeof t=="number"?t:typeof t=="boolean"?t===!0?1:0:parseFloat(t):typeof i.data.value=="boolean"?n=typeof t=="number"?!!t:typeof t=="boolean"?t:t.toLocaleLowerCase()==="false"?!1:!!t:typeof i.data.value!="string"&&i.data.value.textValue!==void 0&&(n=t.toString());let s=typeof n=="string"?{textValue:n}:n;(r=this._sharedAssetsManager)==null||r.updateVariable(i.id,s),this.requestRender(),this._requestRenderAutoMode()}else i===void 0?console.warn(`No variable named ${e} was found in your Spline file. Make sure to create it from Spline editor.`):"dynamicVariableType"in i.data&&console.warn(`Dynamic variables like ${e} cannot be updated from code.`)}getVariables(){let e={};return this._data&&this._data.shared.variables.forEach(t=>{e[t.data.name]===void 0&&(e[t.data.name]=this._getVariableValue(this._sharedAssetsManager.getVariable(t.id)))}),e}getVariable(e){let t=this._getVariableByName(e);if(t){let i=this._sharedAssetsManager.getVariable(t.id);return this._getVariableValue(i)}}_getVariableValue(e){return typeof e!="string"&&Ls.isTextValue(e)?Ls.getDisplayedValue(e):e}_getVariableByName(e){if(this._data){if(this._variablesCache.has(e))return this._variablesCache.get(e);let t=this._data.shared.variables.find(i=>i.data.name===e);return t&&this._variablesCache.set(e,t),t}}findObjectById(e){var i;let t=(i=this._scene)==null?void 0:i.getObjectByProperty("uuid",e);return this._createProxyObject(t)}findObjectByName(e){var i;let t=(i=this._scene)==null?void 0:i.getObjectByName(e);return this._createProxyObject(t)}getAllObjects(){var t;let e=[];return(t=this._scene)==null||t.traverseEntity(i=>{if(i.uuid!==gy&&!this._scene.isInvisibleObjects(i)&&!(i instanceof hs)){let r=this._createProxyObject(i);r&&e.push(r)}}),e}getSplineEvents(){var e,t;return((t=(e=this._eventManager)==null?void 0:e.handlers)==null?void 0:t.Spline).splineEvents}emitEvent(e,t){var i;(i=this.findObjectById(t)||this.findObjectByName(t))==null||i.emitEvent(e)}emitEventReverse(e,t){var i;(i=this.findObjectById(t)||this.findObjectByName(t))==null||i.emitEventReverse(e)}addEventListener(e,t){this.canvas.addEventListener(e,t)}removeEventListener(e,t){this.canvas.removeEventListener(e,t)}setZoom(e){var t,i;((t=this._controls)==null?void 0:t.orbitControls)instanceof Ere&&((i=this._controls)==null||i.orbitControls.setZoom(e))}get eventManager(){return this._eventManager}get controls(){return this._controls}setSize(e,t){this._viewportWidth=e,this._viewportHeight=t,this._viewportMode=2,this._resize()}setBackgroundColor(e){var a;let{r:t,g:i,b:r,a:n}={r:0,g:0,b:0,a:1},s=new Bs(t,i,r,n);try{s.setStyle(e)}catch{console.error("This is not a valid css color",e)}(a=this._scene)==null||a.activePage.setBackgroundColor(s),this._requestRenderAutoMode()}dispose(){var e,t,i,r,n,s,a;this.disposed=!0,(e=this._eventManager)==null||e.deactivate(),(t=this._scene)==null||t.dispose(),(i=this._sharedAssetsManager)==null||i.dispose(),this._proxyObjectCache.forEach(o=>{xj.unsubscribe(o)}),this._variablesCache.clear(),(r=this._renderer)==null||r.setAnimationLoop(null),(n=this._renderer)==null||n.dispose(),this._renderer=void 0,(s=this._sharedAssetsManager)==null||s.dispose(),this._resizeObserver&&(this._resizeObserver.disconnect(),this._resizeObserver=void 0),this._resizeObserverTimeout!==void 0&&clearTimeout(this._resizeObserverTimeout),this.canvas.style.width="",this.canvas.style.height="",this.canvas.removeAttribute("width"),this.canvas.removeAttribute("height"),this._frameView&&(this._frameView=void 0),(a=this._controls)==null||a.deactivate(),this.dt=0,RCe(this.canvas),document.removeEventListener("scroll",this._onScroll)}get isStopped(){return this._isPaused}stop(){var e,t,i;this._isPaused||((e=this._renderer)==null||e.setAnimationLoop(null),this._isPaused=!0,(t=this._eventManager)==null||t.pause(),(i=this._controls)!=null&&i.orbitControls&&(this._controls.orbitControls.enabled=!1))}play(){var e,t,i;!this._isPaused||(this._isPaused=!1,(e=this._eventManager)==null||e.resume(),(t=this._controls)!=null&&t.orbitControls&&(this._controls.orbitControls.enabled=!0),(i=this._renderer)==null||i.setAnimationLoop(this.render))}setGlobalEvents(e){var t;(t=this._eventManager)==null||t.updateUseWindowEvents(e)}get data(){return this._data}_createProxyObject(e){var n;if(e==null)return;if(this._proxyObjectCache.has(e.uuid))return this._proxyObjectCache.get(e.uuid);let t;e.traverseAncestors(s=>{s instanceof hs&&(t=s.name)});let i={name:e.name,uuid:e.uuid,visible:e.visible,intensity:e.intensity,position:e.position,rotation:e.rotation,scale:e.scale,type:e.data.type,page:t,parentUuid:e.parent instanceof hs||e instanceof g4||(n=e.parent)==null?void 0:n.uuid,emitEvent(s){e.dispatchEvent({type:"userEvent",eventName:s})},emitEventReverse(s){e.dispatchEvent({type:"userEvent",eventName:s,reverse:!0})}},r=xj(i,(s,a)=>{var o;typeof e[s]!="object"&&((o=Object.getOwnPropertyDescriptor(e,s))!=null&&o.writable)&&(e[s]=a),this._requestRenderAutoMode(),e.updateMatrix()});return this._proxyObjectCache.set(e.uuid,r),r}setUIWasmUrl(e){Wte.skiaWasmUrl=e}},Fke="Expected a function",X7=NaN,Uke="[object Symbol]",Nke=/^\s+|\s+$/g,kke=/^[-+]0x[0-9a-f]+$/i,Vke=/^0b[01]+$/i,Gke=/^0o[0-7]+$/i,Hke=parseInt,jke=typeof W_=="object"&&W_&&W_.Object===Object&&W_,Wke=typeof self=="object"&&self&&self.Object===Object&&self,Xke=jke||Wke||Function("return this")(),qke=Object.prototype,Yke=qke.toString,Qke=Math.max,Zke=Math.min,xI=function(){return Xke.Date.now()};function Kke(e,t,i){var r,n,s,a,o,l,c=0,u=!1,h=!1,d=!0;if(typeof e!="function")throw new TypeError(Fke);t=q7(t)||0,GB(i)&&(u=!!i.leading,h="maxWait"in i,s=h?Qke(q7(i.maxWait)||0,t):s,d="trailing"in i?!!i.trailing:d);function f(S){var T=r,E=n;return r=n=void 0,c=S,a=e.apply(E,T),a}function p(S){return c=S,o=setTimeout(g,t),u?f(S):a}function v(S){var T=S-l,E=S-c,C=t-T;return h?Zke(C,s-E):C}function m(S){var T=S-l,E=S-c;return l===void 0||T>=t||T<0||h&&E>=s}function g(){var S=xI();if(m(S))return y(S);o=setTimeout(g,v(S))}function y(S){return o=void 0,d&&r?f(S):(r=n=void 0,a)}function x(){o!==void 0&&clearTimeout(o),c=0,r=l=n=o=void 0}function _(){return o===void 0?a:y(xI())}function M(){var S=xI(),T=m(S);if(r=arguments,n=this,l=S,T){if(o===void 0)return p(l);if(h)return o=setTimeout(g,t),f(l)}return o===void 0&&(o=setTimeout(g,t)),a}return M.cancel=x,M.flush=_,M}function GB(e){var t=typeof e;return!!e&&(t=="object"||t=="function")}function Jke(e){return!!e&&typeof e=="object"}function $ke(e){return typeof e=="symbol"||Jke(e)&&Yke.call(e)==Uke}function q7(e){if(typeof e=="number")return e;if($ke(e))return X7;if(GB(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=GB(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=e.replace(Nke,"");var i=Vke.test(e);return i||Gke.test(e)?Hke(e.slice(2),i?2:8):kke.test(e)?X7:+e}var e5e=Kke;const t5e=gF(e5e);function i5e(e){return t=>{e.forEach(i=>{typeof i=="function"?i(t):i!=null&&(i.current=t)})}}const r5e=[],n5e={width:"100%",height:"100%"},s5e=_e.forwardRef(function({className:e,children:t,debounceTime:i=300,ignoreDimensions:r=r5e,parentSizeStyles:n,enableDebounceLeadingCall:s=!0,resizeObserverPolyfill:a,...o},l){const c=_e.useRef(null),u=_e.useRef(0),[h,d]=_e.useState({width:0,height:0,top:0,left:0}),f=_e.useMemo(()=>{const p=Array.isArray(r)?r:[r];return t5e(v=>{d(m=>Object.keys(m).filter(g=>m[g]!==v[g]).every(g=>p.includes(g))?m:v)},i,{leading:s})},[i,s,r]);return _e.useEffect(()=>{const p=a||window.ResizeObserver,v=new p(m=>{m.forEach(g=>{const{left:y,top:x,width:_,height:M}=(g==null?void 0:g.contentRect)??{};u.current=window.requestAnimationFrame(()=>{f({width:_,height:M,top:x,left:y})})})});return c.current&&v.observe(c.current),()=>{window.cancelAnimationFrame(u.current),v.disconnect(),f.cancel()}},[f,a]),Te.jsx("div",{style:{...n5e,...n},ref:i5e([l,c]),className:e,...o,children:t({...h,ref:c.current,resize:f})})}),a5e=_e.forwardRef(({scene:e,style:t,onSplineMouseDown:i,onSplineMouseUp:r,onSplineMouseHover:n,onSplineKeyDown:s,onSplineKeyUp:a,onSplineStart:o,onSplineLookAt:l,onSplineFollow:c,onSplineScroll:u,onLoad:h,renderOnDemand:d=!0,children:f,...p},v)=>{const m=_e.useRef(null),[g,y]=_e.useState(!0),[x,_]=_e.useState();if(x)throw x;return _e.useEffect(()=>{y(!0);let M;const S=[{name:"mouseDown",cb:i},{name:"mouseUp",cb:r},{name:"mouseHover",cb:n},{name:"keyDown",cb:s},{name:"keyUp",cb:a},{name:"start",cb:o},{name:"lookAt",cb:l},{name:"follow",cb:c},{name:"scroll",cb:u}];if(m.current){M=new Bke(m.current,{renderOnDemand:d});async function T(){await M.load(e);for(let E of S)E.cb&&M.addEventListener(E.name,E.cb);y(!1),h==null||h(M)}T().catch(E=>{_(E)})}return()=>{for(let T of S)T.cb&&M.removeEventListener(T.name,T.cb);M.dispose()}},[e]),Te.jsx(s5e,{ref:v,parentSizeStyles:{overflow:"hidden",...t},debounceTime:50,...p,children:()=>Te.jsxs(Te.Fragment,{children:[g&&f,Te.jsx("canvas",{ref:m,style:{display:g?"none":"block"}})]})})}),o5e=({className:e})=>{const t=_e.useRef(null);return _e.useEffect(()=>{const i=t.current;if(!i)return;const r=i.getContext("2d");if(!r){console.error("2D context not supported");return}const n=()=>{i.width=i.clientWidth,i.height=i.clientHeight};n(),window.addEventListener("resize",n);let s,a=0;const o=["#DAA520","#FF4500","#000000","#FFFFFF","#800080","#FFA500","#00FF00","#0000FF"],l=()=>{const c=i.width,u=i.height;r.clearRect(0,0,c,u);const h=c/2,d=u/2,f=Math.min(c,u)*.3;r.save(),r.translate(h,d),r.rotate(a),r.fillStyle=o[0],r.fillRect(-f/2,-f/2,f,f),r.strokeStyle="#FFFFFF",r.lineWidth=2,r.strokeRect(-f/2,-f/2,f,f),r.fillStyle=o[1],r.beginPath(),r.moveTo(f/2,-f/2),r.lineTo(f/2+f/4,-f/2-f/4),r.lineTo(f/2+f/4,f/2-f/4),r.lineTo(f/2,f/2),r.closePath(),r.fill(),r.stroke(),r.fillStyle=o[2],r.beginPath(),r.moveTo(-f/2,-f/2),r.lineTo(-f/2+f/4,-f/2-f/4),r.lineTo(f/2+f/4,-f/2-f/4),r.lineTo(f/2,-f/2),r.closePath(),r.fill(),r.stroke(),r.restore(),a+=.02,s=requestAnimationFrame(l)};return l(),()=>{window.removeEventListener("resize",n),cancelAnimationFrame(s)}},[]),Te.jsx("div",{className:e,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",overflow:"hidden"},children:Te.jsx("canvas",{ref:t,style:{width:"100%",height:"100%",display:"block"}})})},l5e=()=>{const[e,t]=_e.useState(!0);return _e.useEffect(()=>{setTimeout(()=>t(!1),2e3)},[]),Te.jsxs("div",{className:"relative min-h-screen",children:[e?Te.jsx(o5e,{}):Te.jsx(a5e,{scene:"https://prod.spline.design/9ZtAYys33HZWYmFx/scene.splinecode",className:"absolute inset-0 z-20"}),Te.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-transparent to-black/30 z-10"}),Te.jsx("div",{className:"container mx-auto px-6 relative z-20 pt-32",children:Te.jsxs(Mi.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.8},className:"text-center mb-16",children:[Te.jsxs(Mi.h1,{className:"text-4xl md:text-6xl font-bold text-white mb-6",initial:{opacity:0},animate:{opacity:1},transition:{delay:.2},children:[" Hey there! I'm"," ",Te.jsx("span",{className:"text-transparent bg-clip-text bg-gradient-to-r from-[#DAA520] to-[#FF4500]",children:"Sahal"})]}),Te.jsx(Mi.div,{className:"text-2xl md:text-4xl font-semibold text-[#FF4500] mb-4 h-[60px]",initial:{opacity:0},animate:{opacity:1},transition:{delay:.3},children:Te.jsx(pme,{sequence:["Python Full Stack Developer",2e3,"Django Expert",2e3,"React Developer",2e3,"WordPress Developer",2e3],wrapper:"span",speed:50,repeat:1/0})}),Te.jsx(Mi.p,{className:"text-xl text-gray-300 mb-8 max-w-3xl mx-auto z-50",initial:{opacity:0},animate:{opacity:1},transition:{delay:.4},children:"I'm a passionate and results-driven Full Stack Developer specializing in Python, Django, React.js, and PostgreSQL. I build scalable, high-performance web applications that provide seamless user experiences."}),Te.jsxs(Mi.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.6},className:"space-x-4 mb-16",children:[Te.jsxs(oh,{to:"/portfolio",className:"inline-flex items-center px-8 py-3 bg-gradient-to-r from-[#DAA520] to-[#FF4500] text-white rounded-full hover:from-[#FF6347] hover:to-[#FFD700] transition-all duration-300 transform hover:scale-105 group mt-5",children:["View My Work",Te.jsx(eme,{className:"ml-2 w-5 h-5 group-hover:translate-x-1 transition-transform"})]}),Te.jsx("a",{href:"/assets/resume.pdf",className:"inline-flex items-center px-8 py-3 border-2 border-white/20 text-white rounded-full hover:bg-white/10 transition-all duration-300 transform hover:scale-105 mt-5",target:"_blank",rel:"noopener noreferrer",children:"Download CV"})]})]})})]})},Y7=()=>{const e=[{icon:Te.jsx(vJ,{className:"w-6 h-6"}),title:"Frontend Development",description:"React.js, TypeScript, JavaScript, Tailwind CSSxc "},{icon:Te.jsx(sme,{className:"w-6 h-6"}),title:"Backend Development",description:"Python, Django, REST APIs"},{icon:Te.jsx(tme,{className:"w-6 h-6"}),title:"Database Management",description:"PostgreSQL, Database Design"},{icon:Te.jsx(ime,{className:"w-6 h-6"}),title:"Full Stack Projects",description:"E-commerce, Blogging Platforms"}];return Te.jsx("section",{className:"py-20 bg-gradient-to-br from-gray-900/20 to-gray-800/20",children:Te.jsxs("div",{className:"container mx-auto px-6",children:[Te.jsxs(Mi.div,{initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},transition:{duration:.8,delay:.2},viewport:{once:!0},className:"text-center mb-16",children:[Te.jsx(Mi.h2,{initial:{scale:.9},whileInView:{scale:1},transition:{duration:.5,delay:.4},className:"text-5xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-yellow-400 to-orange-500 mb-4",children:"About Me"}),Te.jsx(Mi.p,{initial:{opacity:0},whileInView:{opacity:1},transition:{duration:.8,delay:.6},className:"text-lg text-gray-300 max-w-2xl mx-auto mb-8",children:"I'm a passionate Full Stack Developer with expertise in Python and modern web technologies. I specialize in building scalable web applications using Django and React."}),Te.jsxs(Mi.div,{initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},transition:{duration:.8,delay:.8},className:"mt-4 flex justify-center space-x-6",children:[Te.jsx("a",{href:"https://github.com/m0hammedsahal",target:"_blank",rel:"noopener noreferrer",className:"text-[#FF4500] hover:text-[#DAA520] transition-transform transform hover:scale-110",children:Te.jsx(iA,{className:"w-6 h-6"})}),Te.jsx("a",{href:"https://www.linkedin.com/in/mhd-sahal-5a9b0128a/",target:"_blank",rel:"noopener noreferrer",className:"text-[#FF4500] hover:text-[#DAA520] transition-transform transform hover:scale-110",children:Te.jsx(yJ,{className:"w-6 h-6"})}),Te.jsx("a",{href:"sahald369@gmail.com",className:"text-[#FF4500] hover:text-[#DAA520] transition-transform transform hover:scale-110",children:Te.jsx(xJ,{className:"w-6 h-6"})})]})]}),Te.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8",children:e.map((t,i)=>Te.jsxs(Mi.div,{initial:{opacity:0,y:30,scale:.9},whileInView:{opacity:1,y:0,scale:1},whileHover:{scale:1.05,rotateY:180},transition:{duration:.5,delay:i*.2,type:"spring",stiffness:150},viewport:{once:!0},className:"p-8 bg-gray-800/30 rounded-2xl hover:shadow-2xl transition-all cursor-pointer relative",style:{transformStyle:"preserve-3d"},children:[Te.jsxs(Mi.div,{className:"flex flex-col items-center",style:{backfaceVisibility:"hidden"},children:[Te.jsx("div",{className:"w-14 h-14 bg-yellow-900 rounded-full flex items-center justify-center text-yellow-400 mb-6",children:t.icon}),Te.jsx("h3",{className:"text-xl font-semibold text-white mb-3 text-center",children:t.title}),Te.jsx("p",{className:"text-gray-300 text-center",children:t.description})]}),Te.jsxs(Mi.div,{className:"absolute inset-0 flex flex-col items-center justify-center p-8 bg-gray-800/30 rounded-2xl",style:{backfaceVisibility:"hidden",transform:"rotateY(180deg)"},children:[Te.jsx("h3",{className:"text-xl font-semibold text-white mb-3 text-center",children:"More"}),Te.jsx("p",{className:"text-gray-300 text-center",children:"Click to explore my projects in this area."})]})]},i))})]})})};var Tre={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},Q7=ar.createContext&&ar.createContext(Tre),c5e=["attr","size","title"];function u5e(e,t){if(e==null)return{};var i=h5e(e,t),r,n;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)r=s[n],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}function h5e(e,t){if(e==null)return{};var i={};for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){if(t.indexOf(r)>=0)continue;i[r]=e[r]}return i}function lT(){return lT=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},lT.apply(this,arguments)}function Z7(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function cT(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?Z7(Object(i),!0).forEach(function(r){d5e(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Z7(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}function d5e(e,t,i){return t=f5e(t),t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function f5e(e){var t=p5e(e,"string");return typeof t=="symbol"?t:t+""}function p5e(e,t){if(typeof e!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var r=i.call(e,t||"default");if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Cre(e){return e&&e.map((t,i)=>ar.createElement(t.tag,cT({key:i},t.attr),Cre(t.child)))}function KC(e){return t=>ar.createElement(m5e,lT({attr:cT({},e.attr)},t),Cre(e.child))}function m5e(e){var t=i=>{var{attr:r,size:n,title:s}=e,a=u5e(e,c5e),o=n||i.size||"1em",l;return i.className&&(l=i.className),e.className&&(l=(l?l+" ":"")+e.className),ar.createElement("svg",lT({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},i.attr,r,a,{className:l,style:cT(cT({color:e.color||i.color},i.style),e.style),height:o,width:o,xmlns:"http://www.w3.org/2000/svg"}),s&&ar.createElement("title",null,s),e.children)};return Q7!==void 0?ar.createElement(Q7.Consumer,null,i=>t(i)):t(Tre)}function g5e(e){return KC({tag:"svg",attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M180.41 203.01c-.72 22.65 10.6 32.68 10.88 39.05a8.164 8.164 0 0 1-4.1 6.27l-12.8 8.96a10.66 10.66 0 0 1-5.63 1.92c-.43-.02-8.19 1.83-20.48-25.61a78.608 78.608 0 0 1-62.61 29.45c-16.28.89-60.4-9.24-58.13-56.21-1.59-38.28 34.06-62.06 70.93-60.05 7.1.02 21.6.37 46.99 6.27v-15.62c2.69-26.46-14.7-46.99-44.81-43.91-2.4.01-19.4-.5-45.84 10.11-7.36 3.38-8.3 2.82-10.75 2.82-7.41 0-4.36-21.48-2.94-24.2 5.21-6.4 35.86-18.35 65.94-18.18a76.857 76.857 0 0 1 55.69 17.28 70.285 70.285 0 0 1 17.67 52.36l-.01 69.29zM93.99 235.4c32.43-.47 46.16-19.97 49.29-30.47 2.46-10.05 2.05-16.41 2.05-27.4-9.67-2.32-23.59-4.85-39.56-4.87-15.15-1.14-42.82 5.63-41.74 32.26-1.24 16.79 11.12 31.4 29.96 30.48zm170.92 23.05c-7.86.72-11.52-4.86-12.68-10.37l-49.8-164.65c-.97-2.78-1.61-5.65-1.92-8.58a4.61 4.61 0 0 1 3.86-5.25c.24-.04-2.13 0 22.25 0 8.78-.88 11.64 6.03 12.55 10.37l35.72 140.83 33.16-140.83c.53-3.22 2.94-11.07 12.8-10.24h17.16c2.17-.18 11.11-.5 12.68 10.37l33.42 142.63L420.98 80.1c.48-2.18 2.72-11.37 12.68-10.37h19.72c.85-.13 6.15-.81 5.25 8.58-.43 1.85 3.41-10.66-52.75 169.9-1.15 5.51-4.82 11.09-12.68 10.37h-18.69c-10.94 1.15-12.51-9.66-12.68-10.75L328.67 110.7l-32.78 136.99c-.16 1.09-1.73 11.9-12.68 10.75h-18.3zm273.48 5.63c-5.88.01-33.92-.3-57.36-12.29a12.802 12.802 0 0 1-7.81-11.91v-10.75c0-8.45 6.2-6.9 8.83-5.89 10.04 4.06 16.48 7.14 28.81 9.6 36.65 7.53 52.77-2.3 56.72-4.48 13.15-7.81 14.19-25.68 5.25-34.95-10.48-8.79-15.48-9.12-53.13-21-4.64-1.29-43.7-13.61-43.79-52.36-.61-28.24 25.05-56.18 69.52-55.95 12.67-.01 46.43 4.13 55.57 15.62 1.35 2.09 2.02 4.55 1.92 7.04v10.11c0 4.44-1.62 6.66-4.87 6.66-7.71-.86-21.39-11.17-49.16-10.75-6.89-.36-39.89.91-38.41 24.97-.43 18.96 26.61 26.07 29.7 26.89 36.46 10.97 48.65 12.79 63.12 29.58 17.14 22.25 7.9 48.3 4.35 55.44-19.08 37.49-68.42 34.44-69.26 34.42zm40.2 104.86c-70.03 51.72-171.69 79.25-258.49 79.25A469.127 469.127 0 0 1 2.83 327.46c-6.53-5.89-.77-13.96 7.17-9.47a637.37 637.37 0 0 0 316.88 84.12 630.22 630.22 0 0 0 241.59-49.55c11.78-5 21.77 7.8 10.12 16.38zm29.19-33.29c-8.96-11.52-59.28-5.38-81.81-2.69-6.79.77-7.94-5.12-1.79-9.47 40.07-28.17 105.88-20.1 113.44-10.63 7.55 9.47-2.05 75.41-39.56 106.91-5.76 4.87-11.27 2.3-8.71-4.1 8.44-21.25 27.39-68.49 18.43-80.02z"},child:[]}]})(e)}function v5e(e){return KC({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M439.8 200.5c-7.7-30.9-22.3-54.2-53.4-54.2h-40.1v47.4c0 36.8-31.2 67.8-66.8 67.8H172.7c-29.2 0-53.4 25-53.4 54.3v101.8c0 29 25.2 46 53.4 54.3 33.8 9.9 66.3 11.7 106.8 0 26.9-7.8 53.4-23.5 53.4-54.3v-40.7H226.2v-13.6h160.2c31.1 0 42.6-21.7 53.4-54.2 11.2-33.5 10.7-65.7 0-108.6zM286.2 404c11.1 0 20.1 9.1 20.1 20.3 0 11.3-9 20.4-20.1 20.4-11 0-20.1-9.2-20.1-20.4.1-11.3 9.1-20.3 20.1-20.3zM167.8 248.1h106.8c29.7 0 53.4-24.5 53.4-54.3V91.9c0-29-24.4-50.7-53.4-55.6-35.8-5.9-74.7-5.6-106.8.1-45.2 8-53.4 24.7-53.4 55.6v40.7h106.9v13.6h-147c-31.1 0-58.3 18.7-66.8 54.2-9.8 40.7-10.2 66.1 0 108.6 7.6 31.6 25.7 54.2 56.8 54.2H101v-48.8c0-35.3 30.5-66.4 66.8-66.4zm-6.7-142.6c-11.1 0-20.1-9.1-20.1-20.3.1-11.3 9-20.4 20.1-20.4 11 0 20.1 9.2 20.1 20.4s-9 20.3-20.1 20.3z"},child:[]}]})(e)}function y5e(e){return KC({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M418.2 177.2c-5.4-1.8-10.8-3.5-16.2-5.1.9-3.7 1.7-7.4 2.5-11.1 12.3-59.6 4.2-107.5-23.1-123.3-26.3-15.1-69.2.6-112.6 38.4-4.3 3.7-8.5 7.6-12.5 11.5-2.7-2.6-5.5-5.2-8.3-7.7-45.5-40.4-91.1-57.4-118.4-41.5-26.2 15.2-34 60.3-23 116.7 1.1 5.6 2.3 11.1 3.7 16.7-6.4 1.8-12.7 3.8-18.6 5.9C38.3 196.2 0 225.4 0 255.6c0 31.2 40.8 62.5 96.3 81.5 4.5 1.5 9 3 13.6 4.3-1.5 6-2.8 11.9-4 18-10.5 55.5-2.3 99.5 23.9 114.6 27 15.6 72.4-.4 116.6-39.1 3.5-3.1 7-6.3 10.5-9.7 4.4 4.3 9 8.4 13.6 12.4 42.8 36.8 85.1 51.7 111.2 36.6 27-15.6 35.8-62.9 24.4-120.5-.9-4.4-1.9-8.9-3-13.5 3.2-.9 6.3-1.9 9.4-2.9 57.7-19.1 99.5-50 99.5-81.7 0-30.3-39.4-59.7-93.8-78.4zM282.9 92.3c37.2-32.4 71.9-45.1 87.7-36 16.9 9.7 23.4 48.9 12.8 100.4-.7 3.4-1.4 6.7-2.3 10-22.2-5-44.7-8.6-67.3-10.6-13-18.6-27.2-36.4-42.6-53.1 3.9-3.7 7.7-7.2 11.7-10.7zM167.2 307.5c5.1 8.7 10.3 17.4 15.8 25.9-15.6-1.7-31.1-4.2-46.4-7.5 4.4-14.4 9.9-29.3 16.3-44.5 4.6 8.8 9.3 17.5 14.3 26.1zm-30.3-120.3c14.4-3.2 29.7-5.8 45.6-7.8-5.3 8.3-10.5 16.8-15.4 25.4-4.9 8.5-9.7 17.2-14.2 26-6.3-14.9-11.6-29.5-16-43.6zm27.4 68.9c6.6-13.8 13.8-27.3 21.4-40.6s15.8-26.2 24.4-38.9c15-1.1 30.3-1.7 45.9-1.7s31 .6 45.9 1.7c8.5 12.6 16.6 25.5 24.3 38.7s14.9 26.7 21.7 40.4c-6.7 13.8-13.9 27.4-21.6 40.8-7.6 13.3-15.7 26.2-24.2 39-14.9 1.1-30.4 1.6-46.1 1.6s-30.9-.5-45.6-1.4c-8.7-12.7-16.9-25.7-24.6-39s-14.8-26.8-21.5-40.6zm180.6 51.2c5.1-8.8 9.9-17.7 14.6-26.7 6.4 14.5 12 29.2 16.9 44.3-15.5 3.5-31.2 6.2-47 8 5.4-8.4 10.5-17 15.5-25.6zm14.4-76.5c-4.7-8.8-9.5-17.6-14.5-26.2-4.9-8.5-10-16.9-15.3-25.2 16.1 2 31.5 4.7 45.9 8-4.6 14.8-10 29.2-16.1 43.4zM256.2 118.3c10.5 11.4 20.4 23.4 29.6 35.8-19.8-.9-39.7-.9-59.5 0 9.8-12.9 19.9-24.9 29.9-35.8zM140.2 57c16.8-9.8 54.1 4.2 93.4 39 2.5 2.2 5 4.6 7.6 7-15.5 16.7-29.8 34.5-42.9 53.1-22.6 2-45 5.5-67.2 10.4-1.3-5.1-2.4-10.3-3.5-15.5-9.4-48.4-3.2-84.9 12.6-94zm-24.5 263.6c-4.2-1.2-8.3-2.5-12.4-3.9-21.3-6.7-45.5-17.3-63-31.2-10.1-7-16.9-17.8-18.8-29.9 0-18.3 31.6-41.7 77.2-57.6 5.7-2 11.5-3.8 17.3-5.5 6.8 21.7 15 43 24.5 63.6-9.6 20.9-17.9 42.5-24.8 64.5zm116.6 98c-16.5 15.1-35.6 27.1-56.4 35.3-11.1 5.3-23.9 5.8-35.3 1.3-15.9-9.2-22.5-44.5-13.5-92 1.1-5.6 2.3-11.2 3.7-16.7 22.4 4.8 45 8.1 67.9 9.8 13.2 18.7 27.7 36.6 43.2 53.4-3.2 3.1-6.4 6.1-9.6 8.9zm24.5-24.3c-10.2-11-20.4-23.2-30.3-36.3 9.6.4 19.5.6 29.5.6 10.3 0 20.4-.2 30.4-.7-9.2 12.7-19.1 24.8-29.6 36.4zm130.7 30c-.9 12.2-6.9 23.6-16.5 31.3-15.9 9.2-49.8-2.8-86.4-34.2-4.2-3.6-8.4-7.5-12.7-11.5 15.3-16.9 29.4-34.8 42.2-53.6 22.9-1.9 45.7-5.4 68.2-10.5 1 4.1 1.9 8.2 2.7 12.2 4.9 21.6 5.7 44.1 2.5 66.3zm18.2-107.5c-2.8.9-5.6 1.8-8.5 2.6-7-21.8-15.6-43.1-25.5-63.8 9.6-20.4 17.7-41.4 24.5-62.9 5.2 1.5 10.2 3.1 15 4.7 46.6 16 79.3 39.8 79.3 58 0 19.6-34.9 44.9-84.8 61.4zm-149.7-15c25.3 0 45.8-20.5 45.8-45.8s-20.5-45.8-45.8-45.8c-25.3 0-45.8 20.5-45.8 45.8s20.5 45.8 45.8 45.8z"},child:[]}]})(e)}function x5e(e){return KC({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M448 73.143v45.714C448 159.143 347.667 192 224 192S0 159.143 0 118.857V73.143C0 32.857 100.333 0 224 0s224 32.857 224 73.143zM448 176v102.857C448 319.143 347.667 352 224 352S0 319.143 0 278.857V176c48.125 33.143 136.208 48.572 224 48.572S399.874 209.143 448 176zm0 160v102.857C448 479.143 347.667 512 224 512S0 479.143 0 438.857V336c48.125 33.143 136.208 48.572 224 48.572S399.874 369.143 448 336z"},child:[]}]})(e)}const w5e=[{title:" Frontend",tech:"React.js, JavaScript, HTML, CSS, Tailwind CSS",icon:Te.jsx(y5e,{className:"text-blue-400 text-5xl mb-3"})},{title:" Backend",tech:"Python, Django, REST APIs",icon:Te.jsx(v5e,{className:"text-yellow-400 text-5xl mb-3"})},{title:" Databases",tech:"PostgreSQL, MySQL, SQLite",icon:Te.jsx(x5e,{className:"text-green-400 text-5xl mb-3"})},{title:" DevOps",tech:"AWS, Git",icon:Te.jsx(g5e,{className:"text-orange-400 text-5xl mb-3"})}],K7=()=>Te.jsxs(Mi.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.8,ease:"easeOut"},className:"mt-40 mb-40 px-6",children:[Te.jsx("h2",{className:"text-3xl font-bold text-white mb-8 text-center tracking-wide",children:" Skills & Technologies"}),Te.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 max-w-5xl mx-auto",children:w5e.map((e,t)=>Te.jsxs(Mi.div,{initial:{opacity:0,scale:.8,y:20},animate:{opacity:1,scale:1,y:0},transition:{duration:.5,delay:t*.2,ease:"easeOut"},whileHover:{scale:1.1,rotateX:10,rotateY:10,boxShadow:"0px 15px 25px rgba(0, 0, 0, 0.5)"},whileTap:{scale:.95},className:"relative bg-gray-900/50 p-6 rounded-xl text-center shadow-lg backdrop-blur-md transition-transform duration-300 hover:shadow-indigo-500/50 hover:backdrop-blur-lg",children:[Te.jsx(Mi.div,{initial:{y:0},animate:{y:[-5,5,-5]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},className:"flex justify-center",children:e.icon}),Te.jsx("h3",{className:"text-indigo-400 font-semibold text-lg mb-2",children:e.title}),Te.jsx("p",{className:"text-gray-300",children:e.tech})]},t))})]});function J7(e){return e!==null&&typeof e=="object"&&"constructor"in e&&e.constructor===Object}function R4(e,t){e===void 0&&(e={}),t===void 0&&(t={});const i=["__proto__","constructor","prototype"];Object.keys(t).filter(r=>i.indexOf(r)<0).forEach(r=>{typeof e[r]>"u"?e[r]=t[r]:J7(t[r])&&J7(e[r])&&Object.keys(t[r]).length>0&&R4(e[r],t[r])})}const Pre={body:{},addEventListener(){},removeEventListener(){},activeElement:{blur(){},nodeName:""},querySelector(){return null},querySelectorAll(){return[]},getElementById(){return null},createEvent(){return{initEvent(){}}},createElement(){return{children:[],childNodes:[],style:{},setAttribute(){},getElementsByTagName(){return[]}}},createElementNS(){return{}},importNode(){return null},location:{hash:"",host:"",hostname:"",href:"",origin:"",pathname:"",protocol:"",search:""}};function iu(){const e=typeof document<"u"?document:{};return R4(e,Pre),e}const b5e={document:Pre,navigator:{userAgent:""},location:{hash:"",host:"",hostname:"",href:"",origin:"",pathname:"",protocol:"",search:""},history:{replaceState(){},pushState(){},go(){},back(){}},CustomEvent:function(){return this},addEventListener(){},removeEventListener(){},getComputedStyle(){return{getPropertyValue(){return""}}},Image(){},Date(){},screen:{},setTimeout(){},clearTimeout(){},matchMedia(){return{}},requestAnimationFrame(e){return typeof setTimeout>"u"?(e(),null):setTimeout(e,0)},cancelAnimationFrame(e){typeof setTimeout>"u"||clearTimeout(e)}};function Na(){const e=typeof window<"u"?window:{};return R4(e,b5e),e}function _5e(e){return e===void 0&&(e=""),e.trim().split(" ").filter(t=>!!t.trim())}function S5e(e){const t=e;Object.keys(t).forEach(i=>{try{t[i]=null}catch{}try{delete t[i]}catch{}})}function HB(e,t){return t===void 0&&(t=0),setTimeout(e,t)}function uT(){return Date.now()}function M5e(e){const t=Na();let i;return t.getComputedStyle&&(i=t.getComputedStyle(e,null)),!i&&e.currentStyle&&(i=e.currentStyle),i||(i=e.style),i}function E5e(e,t){t===void 0&&(t="x");const i=Na();let r,n,s;const a=M5e(e);return i.WebKitCSSMatrix?(n=a.transform||a.webkitTransform,n.split(",").length>6&&(n=n.split(", ").map(o=>o.replace(",",".")).join(", ")),s=new i.WebKitCSSMatrix(n==="none"?"":n)):(s=a.MozTransform||a.OTransform||a.MsTransform||a.msTransform||a.transform||a.getPropertyValue("transform").replace("translate(","matrix(1, 0, 0, 1,"),r=s.toString().split(",")),t==="x"&&(i.WebKitCSSMatrix?n=s.m41:r.length===16?n=parseFloat(r[12]):n=parseFloat(r[4])),t==="y"&&(i.WebKitCSSMatrix?n=s.m42:r.length===16?n=parseFloat(r[13]):n=parseFloat(r[5])),n||0}function FM(e){return typeof e=="object"&&e!==null&&e.constructor&&Object.prototype.toString.call(e).slice(8,-1)==="Object"}function A5e(e){return typeof window<"u"&&typeof window.HTMLElement<"u"?e instanceof HTMLElement:e&&(e.nodeType===1||e.nodeType===11)}function Co(){const e=Object(arguments.length<=0?void 0:arguments[0]),t=["__proto__","constructor","prototype"];for(let i=1;i<arguments.length;i+=1){const r=i<0||arguments.length<=i?void 0:arguments[i];if(r!=null&&!A5e(r)){const n=Object.keys(Object(r)).filter(s=>t.indexOf(s)<0);for(let s=0,a=n.length;s<a;s+=1){const o=n[s],l=Object.getOwnPropertyDescriptor(r,o);l!==void 0&&l.enumerable&&(FM(e[o])&&FM(r[o])?r[o].__swiper__?e[o]=r[o]:Co(e[o],r[o]):!FM(e[o])&&FM(r[o])?(e[o]={},r[o].__swiper__?e[o]=r[o]:Co(e[o],r[o])):e[o]=r[o])}}}return e}function UM(e,t,i){e.style.setProperty(t,i)}function Dre(e){let{swiper:t,targetPosition:i,side:r}=e;const n=Na(),s=-t.translate;let a=null,o;const l=t.params.speed;t.wrapperEl.style.scrollSnapType="none",n.cancelAnimationFrame(t.cssModeFrameID);const c=i>s?"next":"prev",u=(d,f)=>c==="next"&&d>=f||c==="prev"&&d<=f,h=()=>{o=new Date().getTime(),a===null&&(a=o);const d=Math.max(Math.min((o-a)/l,1),0),f=.5-Math.cos(d*Math.PI)/2;let p=s+f*(i-s);if(u(p,i)&&(p=i),t.wrapperEl.scrollTo({[r]:p}),u(p,i)){t.wrapperEl.style.overflow="hidden",t.wrapperEl.style.scrollSnapType="",setTimeout(()=>{t.wrapperEl.style.overflow="",t.wrapperEl.scrollTo({[r]:p})}),n.cancelAnimationFrame(t.cssModeFrameID);return}t.cssModeFrameID=n.requestAnimationFrame(h)};h()}function I4(e){return e.querySelector(".swiper-slide-transform")||e.shadowRoot&&e.shadowRoot.querySelector(".swiper-slide-transform")||e}function Xc(e,t){t===void 0&&(t="");const i=Na(),r=[...e.children];return i.HTMLSlotElement&&e instanceof HTMLSlotElement&&r.push(...e.assignedElements()),t?r.filter(n=>n.matches(t)):r}function T5e(e,t){const i=[t];for(;i.length>0;){const r=i.shift();if(e===r)return!0;i.push(...r.children,...r.shadowRoot?r.shadowRoot.children:[],...r.assignedElements?r.assignedElements():[])}}function C5e(e,t){const i=Na();let r=t.contains(e);return!r&&i.HTMLSlotElement&&t instanceof HTMLSlotElement&&(r=[...t.assignedElements()].includes(e),r||(r=T5e(e,t))),r}function hT(e){try{console.warn(e);return}catch{}}function Kw(e,t){t===void 0&&(t=[]);const i=document.createElement(e);return i.classList.add(...Array.isArray(t)?t:_5e(t)),i}function P5e(e,t){const i=[];for(;e.previousElementSibling;){const r=e.previousElementSibling;t?r.matches(t)&&i.push(r):i.push(r),e=r}return i}function D5e(e,t){const i=[];for(;e.nextElementSibling;){const r=e.nextElementSibling;t?r.matches(t)&&i.push(r):i.push(r),e=r}return i}function qd(e,t){return Na().getComputedStyle(e,null).getPropertyValue(t)}function dT(e){let t=e,i;if(t){for(i=0;(t=t.previousSibling)!==null;)t.nodeType===1&&(i+=1);return i}}function Rre(e,t){const i=[];let r=e.parentElement;for(;r;)t?r.matches(t)&&i.push(r):i.push(r),r=r.parentElement;return i}function jB(e,t,i){const r=Na();return e[t==="width"?"offsetWidth":"offsetHeight"]+parseFloat(r.getComputedStyle(e,null).getPropertyValue(t==="width"?"margin-right":"margin-top"))+parseFloat(r.getComputedStyle(e,null).getPropertyValue(t==="width"?"margin-left":"margin-bottom"))}function Ou(e){return(Array.isArray(e)?e:[e]).filter(t=>!!t)}function R5e(e){return t=>Math.abs(t)>0&&e.browser&&e.browser.need3dFix&&Math.abs(t)%90===0?t+.001:t}let wI;function I5e(){const e=Na(),t=iu();return{smoothScroll:t.documentElement&&t.documentElement.style&&"scrollBehavior"in t.documentElement.style,touch:!!("ontouchstart"in e||e.DocumentTouch&&t instanceof e.DocumentTouch)}}function Ire(){return wI||(wI=I5e()),wI}let bI;function L5e(e){let{userAgent:t}=e===void 0?{}:e;const i=Ire(),r=Na(),n=r.navigator.platform,s=t||r.navigator.userAgent,a={ios:!1,android:!1},o=r.screen.width,l=r.screen.height,c=s.match(/(Android);?[\s\/]+([\d.]+)?/);let u=s.match(/(iPad).*OS\s([\d_]+)/);const h=s.match(/(iPod)(.*OS\s([\d_]+))?/),d=!u&&s.match(/(iPhone\sOS|iOS)\s([\d_]+)/),f=n==="Win32";let p=n==="MacIntel";const v=["1024x1366","1366x1024","834x1194","1194x834","834x1112","1112x834","768x1024","1024x768","820x1180","1180x820","810x1080","1080x810"];return!u&&p&&i.touch&&v.indexOf(`${o}x${l}`)>=0&&(u=s.match(/(Version)\/([\d.]+)/),u||(u=[0,1,"13_0_0"]),p=!1),c&&!f&&(a.os="android",a.android=!0),(u||d||h)&&(a.os="ios",a.ios=!0),a}function Lre(e){return e===void 0&&(e={}),bI||(bI=L5e(e)),bI}let _I;function O5e(){const e=Na(),t=Lre();let i=!1;function r(){const o=e.navigator.userAgent.toLowerCase();return o.indexOf("safari")>=0&&o.indexOf("chrome")<0&&o.indexOf("android")<0}if(r()){const o=String(e.navigator.userAgent);if(o.includes("Version/")){const[l,c]=o.split("Version/")[1].split(" ")[0].split(".").map(u=>Number(u));i=l<16||l===16&&c<2}}const n=/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(e.navigator.userAgent),s=r(),a=s||n&&t.ios;return{isSafari:i||s,needPerspectiveFix:i,need3dFix:a,isWebView:n}}function Ore(){return _I||(_I=O5e()),_I}function z5e(e){let{swiper:t,on:i,emit:r}=e;const n=Na();let s=null,a=null;const o=()=>{!t||t.destroyed||!t.initialized||(r("beforeResize"),r("resize"))},l=()=>{!t||t.destroyed||!t.initialized||(s=new ResizeObserver(h=>{a=n.requestAnimationFrame(()=>{const{width:d,height:f}=t;let p=d,v=f;h.forEach(m=>{let{contentBoxSize:g,contentRect:y,target:x}=m;x&&x!==t.el||(p=y?y.width:(g[0]||g).inlineSize,v=y?y.height:(g[0]||g).blockSize)}),(p!==d||v!==f)&&o()})}),s.observe(t.el))},c=()=>{a&&n.cancelAnimationFrame(a),s&&s.unobserve&&t.el&&(s.unobserve(t.el),s=null)},u=()=>{!t||t.destroyed||!t.initialized||r("orientationchange")};i("init",()=>{if(t.params.resizeObserver&&typeof n.ResizeObserver<"u"){l();return}n.addEventListener("resize",o),n.addEventListener("orientationchange",u)}),i("destroy",()=>{c(),n.removeEventListener("resize",o),n.removeEventListener("orientationchange",u)})}function B5e(e){let{swiper:t,extendParams:i,on:r,emit:n}=e;const s=[],a=Na(),o=function(u,h){h===void 0&&(h={});const d=a.MutationObserver||a.WebkitMutationObserver,f=new d(p=>{if(t.__preventObserver__)return;if(p.length===1){n("observerUpdate",p[0]);return}const v=function(){n("observerUpdate",p[0])};a.requestAnimationFrame?a.requestAnimationFrame(v):a.setTimeout(v,0)});f.observe(u,{attributes:typeof h.attributes>"u"?!0:h.attributes,childList:t.isElement||(typeof h.childList>"u"?!0:h).childList,characterData:typeof h.characterData>"u"?!0:h.characterData}),s.push(f)},l=()=>{if(t.params.observer){if(t.params.observeParents){const u=Rre(t.hostEl);for(let h=0;h<u.length;h+=1)o(u[h])}o(t.hostEl,{childList:t.params.observeSlideChildren}),o(t.wrapperEl,{attributes:!1})}},c=()=>{s.forEach(u=>{u.disconnect()}),s.splice(0,s.length)};i({observer:!1,observeParents:!1,observeSlideChildren:!1}),r("init",l),r("destroy",c)}var F5e={on(e,t,i){const r=this;if(!r.eventsListeners||r.destroyed||typeof t!="function")return r;const n=i?"unshift":"push";return e.split(" ").forEach(s=>{r.eventsListeners[s]||(r.eventsListeners[s]=[]),r.eventsListeners[s][n](t)}),r},once(e,t,i){const r=this;if(!r.eventsListeners||r.destroyed||typeof t!="function")return r;function n(){r.off(e,n),n.__emitterProxy&&delete n.__emitterProxy;for(var s=arguments.length,a=new Array(s),o=0;o<s;o++)a[o]=arguments[o];t.apply(r,a)}return n.__emitterProxy=t,r.on(e,n,i)},onAny(e,t){const i=this;if(!i.eventsListeners||i.destroyed||typeof e!="function")return i;const r=t?"unshift":"push";return i.eventsAnyListeners.indexOf(e)<0&&i.eventsAnyListeners[r](e),i},offAny(e){const t=this;if(!t.eventsListeners||t.destroyed||!t.eventsAnyListeners)return t;const i=t.eventsAnyListeners.indexOf(e);return i>=0&&t.eventsAnyListeners.splice(i,1),t},off(e,t){const i=this;return!i.eventsListeners||i.destroyed||!i.eventsListeners||e.split(" ").forEach(r=>{typeof t>"u"?i.eventsListeners[r]=[]:i.eventsListeners[r]&&i.eventsListeners[r].forEach((n,s)=>{(n===t||n.__emitterProxy&&n.__emitterProxy===t)&&i.eventsListeners[r].splice(s,1)})}),i},emit(){const e=this;if(!e.eventsListeners||e.destroyed||!e.eventsListeners)return e;let t,i,r;for(var n=arguments.length,s=new Array(n),a=0;a<n;a++)s[a]=arguments[a];return typeof s[0]=="string"||Array.isArray(s[0])?(t=s[0],i=s.slice(1,s.length),r=e):(t=s[0].events,i=s[0].data,r=s[0].context||e),i.unshift(r),(Array.isArray(t)?t:t.split(" ")).forEach(l=>{e.eventsAnyListeners&&e.eventsAnyListeners.length&&e.eventsAnyListeners.forEach(c=>{c.apply(r,[l,...i])}),e.eventsListeners&&e.eventsListeners[l]&&e.eventsListeners[l].forEach(c=>{c.apply(r,i)})}),e}};function U5e(){const e=this;let t,i;const r=e.el;typeof e.params.width<"u"&&e.params.width!==null?t=e.params.width:t=r.clientWidth,typeof e.params.height<"u"&&e.params.height!==null?i=e.params.height:i=r.clientHeight,!(t===0&&e.isHorizontal()||i===0&&e.isVertical())&&(t=t-parseInt(qd(r,"padding-left")||0,10)-parseInt(qd(r,"padding-right")||0,10),i=i-parseInt(qd(r,"padding-top")||0,10)-parseInt(qd(r,"padding-bottom")||0,10),Number.isNaN(t)&&(t=0),Number.isNaN(i)&&(i=0),Object.assign(e,{width:t,height:i,size:e.isHorizontal()?t:i}))}function N5e(){const e=this;function t(A,D){return parseFloat(A.getPropertyValue(e.getDirectionLabel(D))||0)}const i=e.params,{wrapperEl:r,slidesEl:n,size:s,rtlTranslate:a,wrongRTL:o}=e,l=e.virtual&&i.virtual.enabled,c=l?e.virtual.slides.length:e.slides.length,u=Xc(n,`.${e.params.slideClass}, swiper-slide`),h=l?e.virtual.slides.length:u.length;let d=[];const f=[],p=[];let v=i.slidesOffsetBefore;typeof v=="function"&&(v=i.slidesOffsetBefore.call(e));let m=i.slidesOffsetAfter;typeof m=="function"&&(m=i.slidesOffsetAfter.call(e));const g=e.snapGrid.length,y=e.slidesGrid.length;let x=i.spaceBetween,_=-v,M=0,S=0;if(typeof s>"u")return;typeof x=="string"&&x.indexOf("%")>=0?x=parseFloat(x.replace("%",""))/100*s:typeof x=="string"&&(x=parseFloat(x)),e.virtualSize=-x,u.forEach(A=>{a?A.style.marginLeft="":A.style.marginRight="",A.style.marginBottom="",A.style.marginTop=""}),i.centeredSlides&&i.cssMode&&(UM(r,"--swiper-centered-offset-before",""),UM(r,"--swiper-centered-offset-after",""));const T=i.grid&&i.grid.rows>1&&e.grid;T?e.grid.initSlides(u):e.grid&&e.grid.unsetSlides();let E;const C=i.slidesPerView==="auto"&&i.breakpoints&&Object.keys(i.breakpoints).filter(A=>typeof i.breakpoints[A].slidesPerView<"u").length>0;for(let A=0;A<h;A+=1){E=0;let D;if(u[A]&&(D=u[A]),T&&e.grid.updateSlide(A,D,u),!(u[A]&&qd(D,"display")==="none")){if(i.slidesPerView==="auto"){C&&(u[A].style[e.getDirectionLabel("width")]="");const R=getComputedStyle(D),L=D.style.transform,O=D.style.webkitTransform;if(L&&(D.style.transform="none"),O&&(D.style.webkitTransform="none"),i.roundLengths)E=e.isHorizontal()?jB(D,"width"):jB(D,"height");else{const H=t(R,"width"),j=t(R,"padding-left"),Y=t(R,"padding-right"),z=t(R,"margin-left"),V=t(R,"margin-right"),U=R.getPropertyValue("box-sizing");if(U&&U==="border-box")E=H+z+V;else{const{clientWidth:k,offsetWidth:X}=D;E=H+j+Y+z+V+(X-k)}}L&&(D.style.transform=L),O&&(D.style.webkitTransform=O),i.roundLengths&&(E=Math.floor(E))}else E=(s-(i.slidesPerView-1)*x)/i.slidesPerView,i.roundLengths&&(E=Math.floor(E)),u[A]&&(u[A].style[e.getDirectionLabel("width")]=`${E}px`);u[A]&&(u[A].swiperSlideSize=E),p.push(E),i.centeredSlides?(_=_+E/2+M/2+x,M===0&&A!==0&&(_=_-s/2-x),A===0&&(_=_-s/2-x),Math.abs(_)<1/1e3&&(_=0),i.roundLengths&&(_=Math.floor(_)),S%i.slidesPerGroup===0&&d.push(_),f.push(_)):(i.roundLengths&&(_=Math.floor(_)),(S-Math.min(e.params.slidesPerGroupSkip,S))%e.params.slidesPerGroup===0&&d.push(_),f.push(_),_=_+E+x),e.virtualSize+=E+x,M=E,S+=1}}if(e.virtualSize=Math.max(e.virtualSize,s)+m,a&&o&&(i.effect==="slide"||i.effect==="coverflow")&&(r.style.width=`${e.virtualSize+x}px`),i.setWrapperSize&&(r.style[e.getDirectionLabel("width")]=`${e.virtualSize+x}px`),T&&e.grid.updateWrapperSize(E,d),!i.centeredSlides){const A=[];for(let D=0;D<d.length;D+=1){let R=d[D];i.roundLengths&&(R=Math.floor(R)),d[D]<=e.virtualSize-s&&A.push(R)}d=A,Math.floor(e.virtualSize-s)-Math.floor(d[d.length-1])>1&&d.push(e.virtualSize-s)}if(l&&i.loop){const A=p[0]+x;if(i.slidesPerGroup>1){const D=Math.ceil((e.virtual.slidesBefore+e.virtual.slidesAfter)/i.slidesPerGroup),R=A*i.slidesPerGroup;for(let L=0;L<D;L+=1)d.push(d[d.length-1]+R)}for(let D=0;D<e.virtual.slidesBefore+e.virtual.slidesAfter;D+=1)i.slidesPerGroup===1&&d.push(d[d.length-1]+A),f.push(f[f.length-1]+A),e.virtualSize+=A}if(d.length===0&&(d=[0]),x!==0){const A=e.isHorizontal()&&a?"marginLeft":e.getDirectionLabel("marginRight");u.filter((D,R)=>!i.cssMode||i.loop?!0:R!==u.length-1).forEach(D=>{D.style[A]=`${x}px`})}if(i.centeredSlides&&i.centeredSlidesBounds){let A=0;p.forEach(R=>{A+=R+(x||0)}),A-=x;const D=A>s?A-s:0;d=d.map(R=>R<=0?-v:R>D?D+m:R)}if(i.centerInsufficientSlides){let A=0;p.forEach(R=>{A+=R+(x||0)}),A-=x;const D=(i.slidesOffsetBefore||0)+(i.slidesOffsetAfter||0);if(A+D<s){const R=(s-A-D)/2;d.forEach((L,O)=>{d[O]=L-R}),f.forEach((L,O)=>{f[O]=L+R})}}if(Object.assign(e,{slides:u,snapGrid:d,slidesGrid:f,slidesSizesGrid:p}),i.centeredSlides&&i.cssMode&&!i.centeredSlidesBounds){UM(r,"--swiper-centered-offset-before",`${-d[0]}px`),UM(r,"--swiper-centered-offset-after",`${e.size/2-p[p.length-1]/2}px`);const A=-e.snapGrid[0],D=-e.slidesGrid[0];e.snapGrid=e.snapGrid.map(R=>R+A),e.slidesGrid=e.slidesGrid.map(R=>R+D)}if(h!==c&&e.emit("slidesLengthChange"),d.length!==g&&(e.params.watchOverflow&&e.checkOverflow(),e.emit("snapGridLengthChange")),f.length!==y&&e.emit("slidesGridLengthChange"),i.watchSlidesProgress&&e.updateSlidesOffset(),e.emit("slidesUpdated"),!l&&!i.cssMode&&(i.effect==="slide"||i.effect==="fade")){const A=`${i.containerModifierClass}backface-hidden`,D=e.el.classList.contains(A);h<=i.maxBackfaceHiddenSlides?D||e.el.classList.add(A):D&&e.el.classList.remove(A)}}function k5e(e){const t=this,i=[],r=t.virtual&&t.params.virtual.enabled;let n=0,s;typeof e=="number"?t.setTransition(e):e===!0&&t.setTransition(t.params.speed);const a=o=>r?t.slides[t.getSlideIndexByData(o)]:t.slides[o];if(t.params.slidesPerView!=="auto"&&t.params.slidesPerView>1)if(t.params.centeredSlides)(t.visibleSlides||[]).forEach(o=>{i.push(o)});else for(s=0;s<Math.ceil(t.params.slidesPerView);s+=1){const o=t.activeIndex+s;if(o>t.slides.length&&!r)break;i.push(a(o))}else i.push(a(t.activeIndex));for(s=0;s<i.length;s+=1)if(typeof i[s]<"u"){const o=i[s].offsetHeight;n=o>n?o:n}(n||n===0)&&(t.wrapperEl.style.height=`${n}px`)}function V5e(){const e=this,t=e.slides,i=e.isElement?e.isHorizontal()?e.wrapperEl.offsetLeft:e.wrapperEl.offsetTop:0;for(let r=0;r<t.length;r+=1)t[r].swiperSlideOffset=(e.isHorizontal()?t[r].offsetLeft:t[r].offsetTop)-i-e.cssOverflowAdjustment()}const $7=(e,t,i)=>{t&&!e.classList.contains(i)?e.classList.add(i):!t&&e.classList.contains(i)&&e.classList.remove(i)};function G5e(e){e===void 0&&(e=this&&this.translate||0);const t=this,i=t.params,{slides:r,rtlTranslate:n,snapGrid:s}=t;if(r.length===0)return;typeof r[0].swiperSlideOffset>"u"&&t.updateSlidesOffset();let a=-e;n&&(a=e),t.visibleSlidesIndexes=[],t.visibleSlides=[];let o=i.spaceBetween;typeof o=="string"&&o.indexOf("%")>=0?o=parseFloat(o.replace("%",""))/100*t.size:typeof o=="string"&&(o=parseFloat(o));for(let l=0;l<r.length;l+=1){const c=r[l];let u=c.swiperSlideOffset;i.cssMode&&i.centeredSlides&&(u-=r[0].swiperSlideOffset);const h=(a+(i.centeredSlides?t.minTranslate():0)-u)/(c.swiperSlideSize+o),d=(a-s[0]+(i.centeredSlides?t.minTranslate():0)-u)/(c.swiperSlideSize+o),f=-(a-u),p=f+t.slidesSizesGrid[l],v=f>=0&&f<=t.size-t.slidesSizesGrid[l],m=f>=0&&f<t.size-1||p>1&&p<=t.size||f<=0&&p>=t.size;m&&(t.visibleSlides.push(c),t.visibleSlidesIndexes.push(l)),$7(c,m,i.slideVisibleClass),$7(c,v,i.slideFullyVisibleClass),c.progress=n?-h:h,c.originalProgress=n?-d:d}}function H5e(e){const t=this;if(typeof e>"u"){const u=t.rtlTranslate?-1:1;e=t&&t.translate&&t.translate*u||0}const i=t.params,r=t.maxTranslate()-t.minTranslate();let{progress:n,isBeginning:s,isEnd:a,progressLoop:o}=t;const l=s,c=a;if(r===0)n=0,s=!0,a=!0;else{n=(e-t.minTranslate())/r;const u=Math.abs(e-t.minTranslate())<1,h=Math.abs(e-t.maxTranslate())<1;s=u||n<=0,a=h||n>=1,u&&(n=0),h&&(n=1)}if(i.loop){const u=t.getSlideIndexByData(0),h=t.getSlideIndexByData(t.slides.length-1),d=t.slidesGrid[u],f=t.slidesGrid[h],p=t.slidesGrid[t.slidesGrid.length-1],v=Math.abs(e);v>=d?o=(v-d)/p:o=(v+p-f)/p,o>1&&(o-=1)}Object.assign(t,{progress:n,progressLoop:o,isBeginning:s,isEnd:a}),(i.watchSlidesProgress||i.centeredSlides&&i.autoHeight)&&t.updateSlidesProgress(e),s&&!l&&t.emit("reachBeginning toEdge"),a&&!c&&t.emit("reachEnd toEdge"),(l&&!s||c&&!a)&&t.emit("fromEdge"),t.emit("progress",n)}const SI=(e,t,i)=>{t&&!e.classList.contains(i)?e.classList.add(i):!t&&e.classList.contains(i)&&e.classList.remove(i)};function j5e(){const e=this,{slides:t,params:i,slidesEl:r,activeIndex:n}=e,s=e.virtual&&i.virtual.enabled,a=e.grid&&i.grid&&i.grid.rows>1,o=h=>Xc(r,`.${i.slideClass}${h}, swiper-slide${h}`)[0];let l,c,u;if(s)if(i.loop){let h=n-e.virtual.slidesBefore;h<0&&(h=e.virtual.slides.length+h),h>=e.virtual.slides.length&&(h-=e.virtual.slides.length),l=o(`[data-swiper-slide-index="${h}"]`)}else l=o(`[data-swiper-slide-index="${n}"]`);else a?(l=t.find(h=>h.column===n),u=t.find(h=>h.column===n+1),c=t.find(h=>h.column===n-1)):l=t[n];l&&(a||(u=D5e(l,`.${i.slideClass}, swiper-slide`)[0],i.loop&&!u&&(u=t[0]),c=P5e(l,`.${i.slideClass}, swiper-slide`)[0],i.loop&&!c===0&&(c=t[t.length-1]))),t.forEach(h=>{SI(h,h===l,i.slideActiveClass),SI(h,h===u,i.slideNextClass),SI(h,h===c,i.slidePrevClass)}),e.emitSlidesClasses()}const m2=(e,t)=>{if(!e||e.destroyed||!e.params)return;const i=()=>e.isElement?"swiper-slide":`.${e.params.slideClass}`,r=t.closest(i());if(r){let n=r.querySelector(`.${e.params.lazyPreloaderClass}`);!n&&e.isElement&&(r.shadowRoot?n=r.shadowRoot.querySelector(`.${e.params.lazyPreloaderClass}`):requestAnimationFrame(()=>{r.shadowRoot&&(n=r.shadowRoot.querySelector(`.${e.params.lazyPreloaderClass}`),n&&n.remove())})),n&&n.remove()}},MI=(e,t)=>{if(!e.slides[t])return;const i=e.slides[t].querySelector('[loading="lazy"]');i&&i.removeAttribute("loading")},WB=e=>{if(!e||e.destroyed||!e.params)return;let t=e.params.lazyPreloadPrevNext;const i=e.slides.length;if(!i||!t||t<0)return;t=Math.min(t,i);const r=e.params.slidesPerView==="auto"?e.slidesPerViewDynamic():Math.ceil(e.params.slidesPerView),n=e.activeIndex;if(e.params.grid&&e.params.grid.rows>1){const a=n,o=[a-t];o.push(...Array.from({length:t}).map((l,c)=>a+r+c)),e.slides.forEach((l,c)=>{o.includes(l.column)&&MI(e,c)});return}const s=n+r-1;if(e.params.rewind||e.params.loop)for(let a=n-t;a<=s+t;a+=1){const o=(a%i+i)%i;(o<n||o>s)&&MI(e,o)}else for(let a=Math.max(n-t,0);a<=Math.min(s+t,i-1);a+=1)a!==n&&(a>s||a<n)&&MI(e,a)};function W5e(e){const{slidesGrid:t,params:i}=e,r=e.rtlTranslate?e.translate:-e.translate;let n;for(let s=0;s<t.length;s+=1)typeof t[s+1]<"u"?r>=t[s]&&r<t[s+1]-(t[s+1]-t[s])/2?n=s:r>=t[s]&&r<t[s+1]&&(n=s+1):r>=t[s]&&(n=s);return i.normalizeSlideIndex&&(n<0||typeof n>"u")&&(n=0),n}function X5e(e){const t=this,i=t.rtlTranslate?t.translate:-t.translate,{snapGrid:r,params:n,activeIndex:s,realIndex:a,snapIndex:o}=t;let l=e,c;const u=f=>{let p=f-t.virtual.slidesBefore;return p<0&&(p=t.virtual.slides.length+p),p>=t.virtual.slides.length&&(p-=t.virtual.slides.length),p};if(typeof l>"u"&&(l=W5e(t)),r.indexOf(i)>=0)c=r.indexOf(i);else{const f=Math.min(n.slidesPerGroupSkip,l);c=f+Math.floor((l-f)/n.slidesPerGroup)}if(c>=r.length&&(c=r.length-1),l===s&&!t.params.loop){c!==o&&(t.snapIndex=c,t.emit("snapIndexChange"));return}if(l===s&&t.params.loop&&t.virtual&&t.params.virtual.enabled){t.realIndex=u(l);return}const h=t.grid&&n.grid&&n.grid.rows>1;let d;if(t.virtual&&n.virtual.enabled&&n.loop)d=u(l);else if(h){const f=t.slides.find(v=>v.column===l);let p=parseInt(f.getAttribute("data-swiper-slide-index"),10);Number.isNaN(p)&&(p=Math.max(t.slides.indexOf(f),0)),d=Math.floor(p/n.grid.rows)}else if(t.slides[l]){const f=t.slides[l].getAttribute("data-swiper-slide-index");f?d=parseInt(f,10):d=l}else d=l;Object.assign(t,{previousSnapIndex:o,snapIndex:c,previousRealIndex:a,realIndex:d,previousIndex:s,activeIndex:l}),t.initialized&&WB(t),t.emit("activeIndexChange"),t.emit("snapIndexChange"),(t.initialized||t.params.runCallbacksOnInit)&&(a!==d&&t.emit("realIndexChange"),t.emit("slideChange"))}function q5e(e,t){const i=this,r=i.params;let n=e.closest(`.${r.slideClass}, swiper-slide`);!n&&i.isElement&&t&&t.length>1&&t.includes(e)&&[...t.slice(t.indexOf(e)+1,t.length)].forEach(o=>{!n&&o.matches&&o.matches(`.${r.slideClass}, swiper-slide`)&&(n=o)});let s=!1,a;if(n){for(let o=0;o<i.slides.length;o+=1)if(i.slides[o]===n){s=!0,a=o;break}}if(n&&s)i.clickedSlide=n,i.virtual&&i.params.virtual.enabled?i.clickedIndex=parseInt(n.getAttribute("data-swiper-slide-index"),10):i.clickedIndex=a;else{i.clickedSlide=void 0,i.clickedIndex=void 0;return}r.slideToClickedSlide&&i.clickedIndex!==void 0&&i.clickedIndex!==i.activeIndex&&i.slideToClickedSlide()}var Y5e={updateSize:U5e,updateSlides:N5e,updateAutoHeight:k5e,updateSlidesOffset:V5e,updateSlidesProgress:G5e,updateProgress:H5e,updateSlidesClasses:j5e,updateActiveIndex:X5e,updateClickedSlide:q5e};function Q5e(e){e===void 0&&(e=this.isHorizontal()?"x":"y");const t=this,{params:i,rtlTranslate:r,translate:n,wrapperEl:s}=t;if(i.virtualTranslate)return r?-n:n;if(i.cssMode)return n;let a=E5e(s,e);return a+=t.cssOverflowAdjustment(),r&&(a=-a),a||0}function Z5e(e,t){const i=this,{rtlTranslate:r,params:n,wrapperEl:s,progress:a}=i;let o=0,l=0;const c=0;i.isHorizontal()?o=r?-e:e:l=e,n.roundLengths&&(o=Math.floor(o),l=Math.floor(l)),i.previousTranslate=i.translate,i.translate=i.isHorizontal()?o:l,n.cssMode?s[i.isHorizontal()?"scrollLeft":"scrollTop"]=i.isHorizontal()?-o:-l:n.virtualTranslate||(i.isHorizontal()?o-=i.cssOverflowAdjustment():l-=i.cssOverflowAdjustment(),s.style.transform=`translate3d(${o}px, ${l}px, ${c}px)`);let u;const h=i.maxTranslate()-i.minTranslate();h===0?u=0:u=(e-i.minTranslate())/h,u!==a&&i.updateProgress(e),i.emit("setTranslate",i.translate,t)}function K5e(){return-this.snapGrid[0]}function J5e(){return-this.snapGrid[this.snapGrid.length-1]}function $5e(e,t,i,r,n){e===void 0&&(e=0),t===void 0&&(t=this.params.speed),i===void 0&&(i=!0),r===void 0&&(r=!0);const s=this,{params:a,wrapperEl:o}=s;if(s.animating&&a.preventInteractionOnTransition)return!1;const l=s.minTranslate(),c=s.maxTranslate();let u;if(r&&e>l?u=l:r&&e<c?u=c:u=e,s.updateProgress(u),a.cssMode){const h=s.isHorizontal();if(t===0)o[h?"scrollLeft":"scrollTop"]=-u;else{if(!s.support.smoothScroll)return Dre({swiper:s,targetPosition:-u,side:h?"left":"top"}),!0;o.scrollTo({[h?"left":"top"]:-u,behavior:"smooth"})}return!0}return t===0?(s.setTransition(0),s.setTranslate(u),i&&(s.emit("beforeTransitionStart",t,n),s.emit("transitionEnd"))):(s.setTransition(t),s.setTranslate(u),i&&(s.emit("beforeTransitionStart",t,n),s.emit("transitionStart")),s.animating||(s.animating=!0,s.onTranslateToWrapperTransitionEnd||(s.onTranslateToWrapperTransitionEnd=function(d){!s||s.destroyed||d.target===this&&(s.wrapperEl.removeEventListener("transitionend",s.onTranslateToWrapperTransitionEnd),s.onTranslateToWrapperTransitionEnd=null,delete s.onTranslateToWrapperTransitionEnd,s.animating=!1,i&&s.emit("transitionEnd"))}),s.wrapperEl.addEventListener("transitionend",s.onTranslateToWrapperTransitionEnd))),!0}var eVe={getTranslate:Q5e,setTranslate:Z5e,minTranslate:K5e,maxTranslate:J5e,translateTo:$5e};function tVe(e,t){const i=this;i.params.cssMode||(i.wrapperEl.style.transitionDuration=`${e}ms`,i.wrapperEl.style.transitionDelay=e===0?"0ms":""),i.emit("setTransition",e,t)}function zre(e){let{swiper:t,runCallbacks:i,direction:r,step:n}=e;const{activeIndex:s,previousIndex:a}=t;let o=r;if(o||(s>a?o="next":s<a?o="prev":o="reset"),t.emit(`transition${n}`),i&&s!==a){if(o==="reset"){t.emit(`slideResetTransition${n}`);return}t.emit(`slideChangeTransition${n}`),o==="next"?t.emit(`slideNextTransition${n}`):t.emit(`slidePrevTransition${n}`)}}function iVe(e,t){e===void 0&&(e=!0);const i=this,{params:r}=i;r.cssMode||(r.autoHeight&&i.updateAutoHeight(),zre({swiper:i,runCallbacks:e,direction:t,step:"Start"}))}function rVe(e,t){e===void 0&&(e=!0);const i=this,{params:r}=i;i.animating=!1,!r.cssMode&&(i.setTransition(0),zre({swiper:i,runCallbacks:e,direction:t,step:"End"}))}var nVe={setTransition:tVe,transitionStart:iVe,transitionEnd:rVe};function sVe(e,t,i,r,n){e===void 0&&(e=0),i===void 0&&(i=!0),typeof e=="string"&&(e=parseInt(e,10));const s=this;let a=e;a<0&&(a=0);const{params:o,snapGrid:l,slidesGrid:c,previousIndex:u,activeIndex:h,rtlTranslate:d,wrapperEl:f,enabled:p}=s;if(!p&&!r&&!n||s.destroyed||s.animating&&o.preventInteractionOnTransition)return!1;typeof t>"u"&&(t=s.params.speed);const v=Math.min(s.params.slidesPerGroupSkip,a);let m=v+Math.floor((a-v)/s.params.slidesPerGroup);m>=l.length&&(m=l.length-1);const g=-l[m];if(o.normalizeSlideIndex)for(let T=0;T<c.length;T+=1){const E=-Math.floor(g*100),C=Math.floor(c[T]*100),A=Math.floor(c[T+1]*100);typeof c[T+1]<"u"?E>=C&&E<A-(A-C)/2?a=T:E>=C&&E<A&&(a=T+1):E>=C&&(a=T)}if(s.initialized&&a!==h&&(!s.allowSlideNext&&(d?g>s.translate&&g>s.minTranslate():g<s.translate&&g<s.minTranslate())||!s.allowSlidePrev&&g>s.translate&&g>s.maxTranslate()&&(h||0)!==a))return!1;a!==(u||0)&&i&&s.emit("beforeSlideChangeStart"),s.updateProgress(g);let y;a>h?y="next":a<h?y="prev":y="reset";const x=s.virtual&&s.params.virtual.enabled;if(!(x&&n)&&(d&&-g===s.translate||!d&&g===s.translate))return s.updateActiveIndex(a),o.autoHeight&&s.updateAutoHeight(),s.updateSlidesClasses(),o.effect!=="slide"&&s.setTranslate(g),y!=="reset"&&(s.transitionStart(i,y),s.transitionEnd(i,y)),!1;if(o.cssMode){const T=s.isHorizontal(),E=d?g:-g;if(t===0)x&&(s.wrapperEl.style.scrollSnapType="none",s._immediateVirtual=!0),x&&!s._cssModeVirtualInitialSet&&s.params.initialSlide>0?(s._cssModeVirtualInitialSet=!0,requestAnimationFrame(()=>{f[T?"scrollLeft":"scrollTop"]=E})):f[T?"scrollLeft":"scrollTop"]=E,x&&requestAnimationFrame(()=>{s.wrapperEl.style.scrollSnapType="",s._immediateVirtual=!1});else{if(!s.support.smoothScroll)return Dre({swiper:s,targetPosition:E,side:T?"left":"top"}),!0;f.scrollTo({[T?"left":"top"]:E,behavior:"smooth"})}return!0}const S=Ore().isSafari;return x&&!n&&S&&s.isElement&&s.virtual.update(!1,!1,a),s.setTransition(t),s.setTranslate(g),s.updateActiveIndex(a),s.updateSlidesClasses(),s.emit("beforeTransitionStart",t,r),s.transitionStart(i,y),t===0?s.transitionEnd(i,y):s.animating||(s.animating=!0,s.onSlideToWrapperTransitionEnd||(s.onSlideToWrapperTransitionEnd=function(E){!s||s.destroyed||E.target===this&&(s.wrapperEl.removeEventListener("transitionend",s.onSlideToWrapperTransitionEnd),s.onSlideToWrapperTransitionEnd=null,delete s.onSlideToWrapperTransitionEnd,s.transitionEnd(i,y))}),s.wrapperEl.addEventListener("transitionend",s.onSlideToWrapperTransitionEnd)),!0}function aVe(e,t,i,r){e===void 0&&(e=0),i===void 0&&(i=!0),typeof e=="string"&&(e=parseInt(e,10));const n=this;if(n.destroyed)return;typeof t>"u"&&(t=n.params.speed);const s=n.grid&&n.params.grid&&n.params.grid.rows>1;let a=e;if(n.params.loop)if(n.virtual&&n.params.virtual.enabled)a=a+n.virtual.slidesBefore;else{let o;if(s){const d=a*n.params.grid.rows;o=n.slides.find(f=>f.getAttribute("data-swiper-slide-index")*1===d).column}else o=n.getSlideIndexByData(a);const l=s?Math.ceil(n.slides.length/n.params.grid.rows):n.slides.length,{centeredSlides:c}=n.params;let u=n.params.slidesPerView;u==="auto"?u=n.slidesPerViewDynamic():(u=Math.ceil(parseFloat(n.params.slidesPerView,10)),c&&u%2===0&&(u=u+1));let h=l-o<u;if(c&&(h=h||o<Math.ceil(u/2)),r&&c&&n.params.slidesPerView!=="auto"&&!s&&(h=!1),h){const d=c?o<n.activeIndex?"prev":"next":o-n.activeIndex-1<n.params.slidesPerView?"next":"prev";n.loopFix({direction:d,slideTo:!0,activeSlideIndex:d==="next"?o+1:o-l+1,slideRealIndex:d==="next"?n.realIndex:void 0})}if(s){const d=a*n.params.grid.rows;a=n.slides.find(f=>f.getAttribute("data-swiper-slide-index")*1===d).column}else a=n.getSlideIndexByData(a)}return requestAnimationFrame(()=>{n.slideTo(a,t,i,r)}),n}function oVe(e,t,i){t===void 0&&(t=!0);const r=this,{enabled:n,params:s,animating:a}=r;if(!n||r.destroyed)return r;typeof e>"u"&&(e=r.params.speed);let o=s.slidesPerGroup;s.slidesPerView==="auto"&&s.slidesPerGroup===1&&s.slidesPerGroupAuto&&(o=Math.max(r.slidesPerViewDynamic("current",!0),1));const l=r.activeIndex<s.slidesPerGroupSkip?1:o,c=r.virtual&&s.virtual.enabled;if(s.loop){if(a&&!c&&s.loopPreventsSliding)return!1;if(r.loopFix({direction:"next"}),r._clientLeft=r.wrapperEl.clientLeft,r.activeIndex===r.slides.length-1&&s.cssMode)return requestAnimationFrame(()=>{r.slideTo(r.activeIndex+l,e,t,i)}),!0}return s.rewind&&r.isEnd?r.slideTo(0,e,t,i):r.slideTo(r.activeIndex+l,e,t,i)}function lVe(e,t,i){t===void 0&&(t=!0);const r=this,{params:n,snapGrid:s,slidesGrid:a,rtlTranslate:o,enabled:l,animating:c}=r;if(!l||r.destroyed)return r;typeof e>"u"&&(e=r.params.speed);const u=r.virtual&&n.virtual.enabled;if(n.loop){if(c&&!u&&n.loopPreventsSliding)return!1;r.loopFix({direction:"prev"}),r._clientLeft=r.wrapperEl.clientLeft}const h=o?r.translate:-r.translate;function d(y){return y<0?-Math.floor(Math.abs(y)):Math.floor(y)}const f=d(h),p=s.map(y=>d(y)),v=n.freeMode&&n.freeMode.enabled;let m=s[p.indexOf(f)-1];if(typeof m>"u"&&(n.cssMode||v)){let y;s.forEach((x,_)=>{f>=x&&(y=_)}),typeof y<"u"&&(m=v?s[y]:s[y>0?y-1:y])}let g=0;if(typeof m<"u"&&(g=a.indexOf(m),g<0&&(g=r.activeIndex-1),n.slidesPerView==="auto"&&n.slidesPerGroup===1&&n.slidesPerGroupAuto&&(g=g-r.slidesPerViewDynamic("previous",!0)+1,g=Math.max(g,0))),n.rewind&&r.isBeginning){const y=r.params.virtual&&r.params.virtual.enabled&&r.virtual?r.virtual.slides.length-1:r.slides.length-1;return r.slideTo(y,e,t,i)}else if(n.loop&&r.activeIndex===0&&n.cssMode)return requestAnimationFrame(()=>{r.slideTo(g,e,t,i)}),!0;return r.slideTo(g,e,t,i)}function cVe(e,t,i){t===void 0&&(t=!0);const r=this;if(!r.destroyed)return typeof e>"u"&&(e=r.params.speed),r.slideTo(r.activeIndex,e,t,i)}function uVe(e,t,i,r){t===void 0&&(t=!0),r===void 0&&(r=.5);const n=this;if(n.destroyed)return;typeof e>"u"&&(e=n.params.speed);let s=n.activeIndex;const a=Math.min(n.params.slidesPerGroupSkip,s),o=a+Math.floor((s-a)/n.params.slidesPerGroup),l=n.rtlTranslate?n.translate:-n.translate;if(l>=n.snapGrid[o]){const c=n.snapGrid[o],u=n.snapGrid[o+1];l-c>(u-c)*r&&(s+=n.params.slidesPerGroup)}else{const c=n.snapGrid[o-1],u=n.snapGrid[o];l-c<=(u-c)*r&&(s-=n.params.slidesPerGroup)}return s=Math.max(s,0),s=Math.min(s,n.slidesGrid.length-1),n.slideTo(s,e,t,i)}function hVe(){const e=this;if(e.destroyed)return;const{params:t,slidesEl:i}=e,r=t.slidesPerView==="auto"?e.slidesPerViewDynamic():t.slidesPerView;let n=e.clickedIndex,s;const a=e.isElement?"swiper-slide":`.${t.slideClass}`;if(t.loop){if(e.animating)return;s=parseInt(e.clickedSlide.getAttribute("data-swiper-slide-index"),10),t.centeredSlides?n<e.loopedSlides-r/2||n>e.slides.length-e.loopedSlides+r/2?(e.loopFix(),n=e.getSlideIndex(Xc(i,`${a}[data-swiper-slide-index="${s}"]`)[0]),HB(()=>{e.slideTo(n)})):e.slideTo(n):n>e.slides.length-r?(e.loopFix(),n=e.getSlideIndex(Xc(i,`${a}[data-swiper-slide-index="${s}"]`)[0]),HB(()=>{e.slideTo(n)})):e.slideTo(n)}else e.slideTo(n)}var dVe={slideTo:sVe,slideToLoop:aVe,slideNext:oVe,slidePrev:lVe,slideReset:cVe,slideToClosest:uVe,slideToClickedSlide:hVe};function fVe(e){const t=this,{params:i,slidesEl:r}=t;if(!i.loop||t.virtual&&t.params.virtual.enabled)return;const n=()=>{Xc(r,`.${i.slideClass}, swiper-slide`).forEach((h,d)=>{h.setAttribute("data-swiper-slide-index",d)})},s=t.grid&&i.grid&&i.grid.rows>1,a=i.slidesPerGroup*(s?i.grid.rows:1),o=t.slides.length%a!==0,l=s&&t.slides.length%i.grid.rows!==0,c=u=>{for(let h=0;h<u;h+=1){const d=t.isElement?Kw("swiper-slide",[i.slideBlankClass]):Kw("div",[i.slideClass,i.slideBlankClass]);t.slidesEl.append(d)}};if(o){if(i.loopAddBlankSlides){const u=a-t.slides.length%a;c(u),t.recalcSlides(),t.updateSlides()}else hT("Swiper Loop Warning: The number of slides is not even to slidesPerGroup, loop mode may not function properly. You need to add more slides (or make duplicates, or empty slides)");n()}else if(l){if(i.loopAddBlankSlides){const u=i.grid.rows-t.slides.length%i.grid.rows;c(u),t.recalcSlides(),t.updateSlides()}else hT("Swiper Loop Warning: The number of slides is not even to grid.rows, loop mode may not function properly. You need to add more slides (or make duplicates, or empty slides)");n()}else n();t.loopFix({slideRealIndex:e,direction:i.centeredSlides?void 0:"next"})}function pVe(e){let{slideRealIndex:t,slideTo:i=!0,direction:r,setTranslate:n,activeSlideIndex:s,byController:a,byMousewheel:o}=e===void 0?{}:e;const l=this;if(!l.params.loop)return;l.emit("beforeLoopFix");const{slides:c,allowSlidePrev:u,allowSlideNext:h,slidesEl:d,params:f}=l,{centeredSlides:p}=f;if(l.allowSlidePrev=!0,l.allowSlideNext=!0,l.virtual&&f.virtual.enabled){i&&(!f.centeredSlides&&l.snapIndex===0?l.slideTo(l.virtual.slides.length,0,!1,!0):f.centeredSlides&&l.snapIndex<f.slidesPerView?l.slideTo(l.virtual.slides.length+l.snapIndex,0,!1,!0):l.snapIndex===l.snapGrid.length-1&&l.slideTo(l.virtual.slidesBefore,0,!1,!0)),l.allowSlidePrev=u,l.allowSlideNext=h,l.emit("loopFix");return}let v=f.slidesPerView;v==="auto"?v=l.slidesPerViewDynamic():(v=Math.ceil(parseFloat(f.slidesPerView,10)),p&&v%2===0&&(v=v+1));const m=f.slidesPerGroupAuto?v:f.slidesPerGroup;let g=m;g%m!==0&&(g+=m-g%m),g+=f.loopAdditionalSlides,l.loopedSlides=g;const y=l.grid&&f.grid&&f.grid.rows>1;c.length<v+g?hT("Swiper Loop Warning: The number of slides is not enough for loop mode, it will be disabled and not function properly. You need to add more slides (or make duplicates) or lower the values of slidesPerView and slidesPerGroup parameters"):y&&f.grid.fill==="row"&&hT("Swiper Loop Warning: Loop mode is not compatible with grid.fill = `row`");const x=[],_=[];let M=l.activeIndex;typeof s>"u"?s=l.getSlideIndex(c.find(L=>L.classList.contains(f.slideActiveClass))):M=s;const S=r==="next"||!r,T=r==="prev"||!r;let E=0,C=0;const A=y?Math.ceil(c.length/f.grid.rows):c.length,R=(y?c[s].column:s)+(p&&typeof n>"u"?-v/2+.5:0);if(R<g){E=Math.max(g-R,m);for(let L=0;L<g-R;L+=1){const O=L-Math.floor(L/A)*A;if(y){const H=A-O-1;for(let j=c.length-1;j>=0;j-=1)c[j].column===H&&x.push(j)}else x.push(A-O-1)}}else if(R+v>A-g){C=Math.max(R-(A-g*2),m);for(let L=0;L<C;L+=1){const O=L-Math.floor(L/A)*A;y?c.forEach((H,j)=>{H.column===O&&_.push(j)}):_.push(O)}}if(l.__preventObserver__=!0,requestAnimationFrame(()=>{l.__preventObserver__=!1}),T&&x.forEach(L=>{c[L].swiperLoopMoveDOM=!0,d.prepend(c[L]),c[L].swiperLoopMoveDOM=!1}),S&&_.forEach(L=>{c[L].swiperLoopMoveDOM=!0,d.append(c[L]),c[L].swiperLoopMoveDOM=!1}),l.recalcSlides(),f.slidesPerView==="auto"?l.updateSlides():y&&(x.length>0&&T||_.length>0&&S)&&l.slides.forEach((L,O)=>{l.grid.updateSlide(O,L,l.slides)}),f.watchSlidesProgress&&l.updateSlidesOffset(),i){if(x.length>0&&T){if(typeof t>"u"){const L=l.slidesGrid[M],H=l.slidesGrid[M+E]-L;o?l.setTranslate(l.translate-H):(l.slideTo(M+Math.ceil(E),0,!1,!0),n&&(l.touchEventsData.startTranslate=l.touchEventsData.startTranslate-H,l.touchEventsData.currentTranslate=l.touchEventsData.currentTranslate-H))}else if(n){const L=y?x.length/f.grid.rows:x.length;l.slideTo(l.activeIndex+L,0,!1,!0),l.touchEventsData.currentTranslate=l.translate}}else if(_.length>0&&S)if(typeof t>"u"){const L=l.slidesGrid[M],H=l.slidesGrid[M-C]-L;o?l.setTranslate(l.translate-H):(l.slideTo(M-C,0,!1,!0),n&&(l.touchEventsData.startTranslate=l.touchEventsData.startTranslate-H,l.touchEventsData.currentTranslate=l.touchEventsData.currentTranslate-H))}else{const L=y?_.length/f.grid.rows:_.length;l.slideTo(l.activeIndex-L,0,!1,!0)}}if(l.allowSlidePrev=u,l.allowSlideNext=h,l.controller&&l.controller.control&&!a){const L={slideRealIndex:t,direction:r,setTranslate:n,activeSlideIndex:s,byController:!0};Array.isArray(l.controller.control)?l.controller.control.forEach(O=>{!O.destroyed&&O.params.loop&&O.loopFix({...L,slideTo:O.params.slidesPerView===f.slidesPerView?i:!1})}):l.controller.control instanceof l.constructor&&l.controller.control.params.loop&&l.controller.control.loopFix({...L,slideTo:l.controller.control.params.slidesPerView===f.slidesPerView?i:!1})}l.emit("loopFix")}function mVe(){const e=this,{params:t,slidesEl:i}=e;if(!t.loop||!i||e.virtual&&e.params.virtual.enabled)return;e.recalcSlides();const r=[];e.slides.forEach(n=>{const s=typeof n.swiperSlideIndex>"u"?n.getAttribute("data-swiper-slide-index")*1:n.swiperSlideIndex;r[s]=n}),e.slides.forEach(n=>{n.removeAttribute("data-swiper-slide-index")}),r.forEach(n=>{i.append(n)}),e.recalcSlides(),e.slideTo(e.realIndex,0)}var gVe={loopCreate:fVe,loopFix:pVe,loopDestroy:mVe};function vVe(e){const t=this;if(!t.params.simulateTouch||t.params.watchOverflow&&t.isLocked||t.params.cssMode)return;const i=t.params.touchEventsTarget==="container"?t.el:t.wrapperEl;t.isElement&&(t.__preventObserver__=!0),i.style.cursor="move",i.style.cursor=e?"grabbing":"grab",t.isElement&&requestAnimationFrame(()=>{t.__preventObserver__=!1})}function yVe(){const e=this;e.params.watchOverflow&&e.isLocked||e.params.cssMode||(e.isElement&&(e.__preventObserver__=!0),e[e.params.touchEventsTarget==="container"?"el":"wrapperEl"].style.cursor="",e.isElement&&requestAnimationFrame(()=>{e.__preventObserver__=!1}))}var xVe={setGrabCursor:vVe,unsetGrabCursor:yVe};function wVe(e,t){t===void 0&&(t=this);function i(r){if(!r||r===iu()||r===Na())return null;r.assignedSlot&&(r=r.assignedSlot);const n=r.closest(e);return!n&&!r.getRootNode?null:n||i(r.getRootNode().host)}return i(t)}function eX(e,t,i){const r=Na(),{params:n}=e,s=n.edgeSwipeDetection,a=n.edgeSwipeThreshold;return s&&(i<=a||i>=r.innerWidth-a)?s==="prevent"?(t.preventDefault(),!0):!1:!0}function bVe(e){const t=this,i=iu();let r=e;r.originalEvent&&(r=r.originalEvent);const n=t.touchEventsData;if(r.type==="pointerdown"){if(n.pointerId!==null&&n.pointerId!==r.pointerId)return;n.pointerId=r.pointerId}else r.type==="touchstart"&&r.targetTouches.length===1&&(n.touchId=r.targetTouches[0].identifier);if(r.type==="touchstart"){eX(t,r,r.targetTouches[0].pageX);return}const{params:s,touches:a,enabled:o}=t;if(!o||!s.simulateTouch&&r.pointerType==="mouse"||t.animating&&s.preventInteractionOnTransition)return;!t.animating&&s.cssMode&&s.loop&&t.loopFix();let l=r.target;if(s.touchEventsTarget==="wrapper"&&!C5e(l,t.wrapperEl)||"which"in r&&r.which===3||"button"in r&&r.button>0||n.isTouched&&n.isMoved)return;const c=!!s.noSwipingClass&&s.noSwipingClass!=="",u=r.composedPath?r.composedPath():r.path;c&&r.target&&r.target.shadowRoot&&u&&(l=u[0]);const h=s.noSwipingSelector?s.noSwipingSelector:`.${s.noSwipingClass}`,d=!!(r.target&&r.target.shadowRoot);if(s.noSwiping&&(d?wVe(h,l):l.closest(h))){t.allowClick=!0;return}if(s.swipeHandler&&!l.closest(s.swipeHandler))return;a.currentX=r.pageX,a.currentY=r.pageY;const f=a.currentX,p=a.currentY;if(!eX(t,r,f))return;Object.assign(n,{isTouched:!0,isMoved:!1,allowTouchCallbacks:!0,isScrolling:void 0,startMoving:void 0}),a.startX=f,a.startY=p,n.touchStartTime=uT(),t.allowClick=!0,t.updateSize(),t.swipeDirection=void 0,s.threshold>0&&(n.allowThresholdMove=!1);let v=!0;l.matches(n.focusableElements)&&(v=!1,l.nodeName==="SELECT"&&(n.isTouched=!1)),i.activeElement&&i.activeElement.matches(n.focusableElements)&&i.activeElement!==l&&(r.pointerType==="mouse"||r.pointerType!=="mouse"&&!l.matches(n.focusableElements))&&i.activeElement.blur();const m=v&&t.allowTouchMove&&s.touchStartPreventDefault;(s.touchStartForcePreventDefault||m)&&!l.isContentEditable&&r.preventDefault(),s.freeMode&&s.freeMode.enabled&&t.freeMode&&t.animating&&!s.cssMode&&t.freeMode.onTouchStart(),t.emit("touchStart",r)}function _Ve(e){const t=iu(),i=this,r=i.touchEventsData,{params:n,touches:s,rtlTranslate:a,enabled:o}=i;if(!o||!n.simulateTouch&&e.pointerType==="mouse")return;let l=e;if(l.originalEvent&&(l=l.originalEvent),l.type==="pointermove"&&(r.touchId!==null||l.pointerId!==r.pointerId))return;let c;if(l.type==="touchmove"){if(c=[...l.changedTouches].find(S=>S.identifier===r.touchId),!c||c.identifier!==r.touchId)return}else c=l;if(!r.isTouched){r.startMoving&&r.isScrolling&&i.emit("touchMoveOpposite",l);return}const u=c.pageX,h=c.pageY;if(l.preventedByNestedSwiper){s.startX=u,s.startY=h;return}if(!i.allowTouchMove){l.target.matches(r.focusableElements)||(i.allowClick=!1),r.isTouched&&(Object.assign(s,{startX:u,startY:h,currentX:u,currentY:h}),r.touchStartTime=uT());return}if(n.touchReleaseOnEdges&&!n.loop){if(i.isVertical()){if(h<s.startY&&i.translate<=i.maxTranslate()||h>s.startY&&i.translate>=i.minTranslate()){r.isTouched=!1,r.isMoved=!1;return}}else if(u<s.startX&&i.translate<=i.maxTranslate()||u>s.startX&&i.translate>=i.minTranslate())return}if(t.activeElement&&t.activeElement.matches(r.focusableElements)&&t.activeElement!==l.target&&l.pointerType!=="mouse"&&t.activeElement.blur(),t.activeElement&&l.target===t.activeElement&&l.target.matches(r.focusableElements)){r.isMoved=!0,i.allowClick=!1;return}r.allowTouchCallbacks&&i.emit("touchMove",l),s.previousX=s.currentX,s.previousY=s.currentY,s.currentX=u,s.currentY=h;const d=s.currentX-s.startX,f=s.currentY-s.startY;if(i.params.threshold&&Math.sqrt(d**2+f**2)<i.params.threshold)return;if(typeof r.isScrolling>"u"){let S;i.isHorizontal()&&s.currentY===s.startY||i.isVertical()&&s.currentX===s.startX?r.isScrolling=!1:d*d+f*f>=25&&(S=Math.atan2(Math.abs(f),Math.abs(d))*180/Math.PI,r.isScrolling=i.isHorizontal()?S>n.touchAngle:90-S>n.touchAngle)}if(r.isScrolling&&i.emit("touchMoveOpposite",l),typeof r.startMoving>"u"&&(s.currentX!==s.startX||s.currentY!==s.startY)&&(r.startMoving=!0),r.isScrolling||l.type==="touchmove"&&r.preventTouchMoveFromPointerMove){r.isTouched=!1;return}if(!r.startMoving)return;i.allowClick=!1,!n.cssMode&&l.cancelable&&l.preventDefault(),n.touchMoveStopPropagation&&!n.nested&&l.stopPropagation();let p=i.isHorizontal()?d:f,v=i.isHorizontal()?s.currentX-s.previousX:s.currentY-s.previousY;n.oneWayMovement&&(p=Math.abs(p)*(a?1:-1),v=Math.abs(v)*(a?1:-1)),s.diff=p,p*=n.touchRatio,a&&(p=-p,v=-v);const m=i.touchesDirection;i.swipeDirection=p>0?"prev":"next",i.touchesDirection=v>0?"prev":"next";const g=i.params.loop&&!n.cssMode,y=i.touchesDirection==="next"&&i.allowSlideNext||i.touchesDirection==="prev"&&i.allowSlidePrev;if(!r.isMoved){if(g&&y&&i.loopFix({direction:i.swipeDirection}),r.startTranslate=i.getTranslate(),i.setTransition(0),i.animating){const S=new window.CustomEvent("transitionend",{bubbles:!0,cancelable:!0,detail:{bySwiperTouchMove:!0}});i.wrapperEl.dispatchEvent(S)}r.allowMomentumBounce=!1,n.grabCursor&&(i.allowSlideNext===!0||i.allowSlidePrev===!0)&&i.setGrabCursor(!0),i.emit("sliderFirstMove",l)}let x;if(new Date().getTime(),n._loopSwapReset!==!1&&r.isMoved&&r.allowThresholdMove&&m!==i.touchesDirection&&g&&y&&Math.abs(p)>=1){Object.assign(s,{startX:u,startY:h,currentX:u,currentY:h,startTranslate:r.currentTranslate}),r.loopSwapReset=!0,r.startTranslate=r.currentTranslate;return}i.emit("sliderMove",l),r.isMoved=!0,r.currentTranslate=p+r.startTranslate;let _=!0,M=n.resistanceRatio;if(n.touchReleaseOnEdges&&(M=0),p>0?(g&&y&&!x&&r.allowThresholdMove&&r.currentTranslate>(n.centeredSlides?i.minTranslate()-i.slidesSizesGrid[i.activeIndex+1]-(n.slidesPerView!=="auto"&&i.slides.length-n.slidesPerView>=2?i.slidesSizesGrid[i.activeIndex+1]+i.params.spaceBetween:0)-i.params.spaceBetween:i.minTranslate())&&i.loopFix({direction:"prev",setTranslate:!0,activeSlideIndex:0}),r.currentTranslate>i.minTranslate()&&(_=!1,n.resistance&&(r.currentTranslate=i.minTranslate()-1+(-i.minTranslate()+r.startTranslate+p)**M))):p<0&&(g&&y&&!x&&r.allowThresholdMove&&r.currentTranslate<(n.centeredSlides?i.maxTranslate()+i.slidesSizesGrid[i.slidesSizesGrid.length-1]+i.params.spaceBetween+(n.slidesPerView!=="auto"&&i.slides.length-n.slidesPerView>=2?i.slidesSizesGrid[i.slidesSizesGrid.length-1]+i.params.spaceBetween:0):i.maxTranslate())&&i.loopFix({direction:"next",setTranslate:!0,activeSlideIndex:i.slides.length-(n.slidesPerView==="auto"?i.slidesPerViewDynamic():Math.ceil(parseFloat(n.slidesPerView,10)))}),r.currentTranslate<i.maxTranslate()&&(_=!1,n.resistance&&(r.currentTranslate=i.maxTranslate()+1-(i.maxTranslate()-r.startTranslate-p)**M))),_&&(l.preventedByNestedSwiper=!0),!i.allowSlideNext&&i.swipeDirection==="next"&&r.currentTranslate<r.startTranslate&&(r.currentTranslate=r.startTranslate),!i.allowSlidePrev&&i.swipeDirection==="prev"&&r.currentTranslate>r.startTranslate&&(r.currentTranslate=r.startTranslate),!i.allowSlidePrev&&!i.allowSlideNext&&(r.currentTranslate=r.startTranslate),n.threshold>0)if(Math.abs(p)>n.threshold||r.allowThresholdMove){if(!r.allowThresholdMove){r.allowThresholdMove=!0,s.startX=s.currentX,s.startY=s.currentY,r.currentTranslate=r.startTranslate,s.diff=i.isHorizontal()?s.currentX-s.startX:s.currentY-s.startY;return}}else{r.currentTranslate=r.startTranslate;return}!n.followFinger||n.cssMode||((n.freeMode&&n.freeMode.enabled&&i.freeMode||n.watchSlidesProgress)&&(i.updateActiveIndex(),i.updateSlidesClasses()),n.freeMode&&n.freeMode.enabled&&i.freeMode&&i.freeMode.onTouchMove(),i.updateProgress(r.currentTranslate),i.setTranslate(r.currentTranslate))}function SVe(e){const t=this,i=t.touchEventsData;let r=e;r.originalEvent&&(r=r.originalEvent);let n;if(r.type==="touchend"||r.type==="touchcancel"){if(n=[...r.changedTouches].find(M=>M.identifier===i.touchId),!n||n.identifier!==i.touchId)return}else{if(i.touchId!==null||r.pointerId!==i.pointerId)return;n=r}if(["pointercancel","pointerout","pointerleave","contextmenu"].includes(r.type)&&!(["pointercancel","contextmenu"].includes(r.type)&&(t.browser.isSafari||t.browser.isWebView)))return;i.pointerId=null,i.touchId=null;const{params:a,touches:o,rtlTranslate:l,slidesGrid:c,enabled:u}=t;if(!u||!a.simulateTouch&&r.pointerType==="mouse")return;if(i.allowTouchCallbacks&&t.emit("touchEnd",r),i.allowTouchCallbacks=!1,!i.isTouched){i.isMoved&&a.grabCursor&&t.setGrabCursor(!1),i.isMoved=!1,i.startMoving=!1;return}a.grabCursor&&i.isMoved&&i.isTouched&&(t.allowSlideNext===!0||t.allowSlidePrev===!0)&&t.setGrabCursor(!1);const h=uT(),d=h-i.touchStartTime;if(t.allowClick){const M=r.path||r.composedPath&&r.composedPath();t.updateClickedSlide(M&&M[0]||r.target,M),t.emit("tap click",r),d<300&&h-i.lastClickTime<300&&t.emit("doubleTap doubleClick",r)}if(i.lastClickTime=uT(),HB(()=>{t.destroyed||(t.allowClick=!0)}),!i.isTouched||!i.isMoved||!t.swipeDirection||o.diff===0&&!i.loopSwapReset||i.currentTranslate===i.startTranslate&&!i.loopSwapReset){i.isTouched=!1,i.isMoved=!1,i.startMoving=!1;return}i.isTouched=!1,i.isMoved=!1,i.startMoving=!1;let f;if(a.followFinger?f=l?t.translate:-t.translate:f=-i.currentTranslate,a.cssMode)return;if(a.freeMode&&a.freeMode.enabled){t.freeMode.onTouchEnd({currentPos:f});return}const p=f>=-t.maxTranslate()&&!t.params.loop;let v=0,m=t.slidesSizesGrid[0];for(let M=0;M<c.length;M+=M<a.slidesPerGroupSkip?1:a.slidesPerGroup){const S=M<a.slidesPerGroupSkip-1?1:a.slidesPerGroup;typeof c[M+S]<"u"?(p||f>=c[M]&&f<c[M+S])&&(v=M,m=c[M+S]-c[M]):(p||f>=c[M])&&(v=M,m=c[c.length-1]-c[c.length-2])}let g=null,y=null;a.rewind&&(t.isBeginning?y=a.virtual&&a.virtual.enabled&&t.virtual?t.virtual.slides.length-1:t.slides.length-1:t.isEnd&&(g=0));const x=(f-c[v])/m,_=v<a.slidesPerGroupSkip-1?1:a.slidesPerGroup;if(d>a.longSwipesMs){if(!a.longSwipes){t.slideTo(t.activeIndex);return}t.swipeDirection==="next"&&(x>=a.longSwipesRatio?t.slideTo(a.rewind&&t.isEnd?g:v+_):t.slideTo(v)),t.swipeDirection==="prev"&&(x>1-a.longSwipesRatio?t.slideTo(v+_):y!==null&&x<0&&Math.abs(x)>a.longSwipesRatio?t.slideTo(y):t.slideTo(v))}else{if(!a.shortSwipes){t.slideTo(t.activeIndex);return}t.navigation&&(r.target===t.navigation.nextEl||r.target===t.navigation.prevEl)?r.target===t.navigation.nextEl?t.slideTo(v+_):t.slideTo(v):(t.swipeDirection==="next"&&t.slideTo(g!==null?g:v+_),t.swipeDirection==="prev"&&t.slideTo(y!==null?y:v))}}function tX(){const e=this,{params:t,el:i}=e;if(i&&i.offsetWidth===0)return;t.breakpoints&&e.setBreakpoint();const{allowSlideNext:r,allowSlidePrev:n,snapGrid:s}=e,a=e.virtual&&e.params.virtual.enabled;e.allowSlideNext=!0,e.allowSlidePrev=!0,e.updateSize(),e.updateSlides(),e.updateSlidesClasses();const o=a&&t.loop;(t.slidesPerView==="auto"||t.slidesPerView>1)&&e.isEnd&&!e.isBeginning&&!e.params.centeredSlides&&!o?e.slideTo(e.slides.length-1,0,!1,!0):e.params.loop&&!a?e.slideToLoop(e.realIndex,0,!1,!0):e.slideTo(e.activeIndex,0,!1,!0),e.autoplay&&e.autoplay.running&&e.autoplay.paused&&(clearTimeout(e.autoplay.resizeTimeout),e.autoplay.resizeTimeout=setTimeout(()=>{e.autoplay&&e.autoplay.running&&e.autoplay.paused&&e.autoplay.resume()},500)),e.allowSlidePrev=n,e.allowSlideNext=r,e.params.watchOverflow&&s!==e.snapGrid&&e.checkOverflow()}function MVe(e){const t=this;t.enabled&&(t.allowClick||(t.params.preventClicks&&e.preventDefault(),t.params.preventClicksPropagation&&t.animating&&(e.stopPropagation(),e.stopImmediatePropagation())))}function EVe(){const e=this,{wrapperEl:t,rtlTranslate:i,enabled:r}=e;if(!r)return;e.previousTranslate=e.translate,e.isHorizontal()?e.translate=-t.scrollLeft:e.translate=-t.scrollTop,e.translate===0&&(e.translate=0),e.updateActiveIndex(),e.updateSlidesClasses();let n;const s=e.maxTranslate()-e.minTranslate();s===0?n=0:n=(e.translate-e.minTranslate())/s,n!==e.progress&&e.updateProgress(i?-e.translate:e.translate),e.emit("setTranslate",e.translate,!1)}function AVe(e){const t=this;m2(t,e.target),!(t.params.cssMode||t.params.slidesPerView!=="auto"&&!t.params.autoHeight)&&t.update()}function TVe(){const e=this;e.documentTouchHandlerProceeded||(e.documentTouchHandlerProceeded=!0,e.params.touchReleaseOnEdges&&(e.el.style.touchAction="auto"))}const Bre=(e,t)=>{const i=iu(),{params:r,el:n,wrapperEl:s,device:a}=e,o=!!r.nested,l=t==="on"?"addEventListener":"removeEventListener",c=t;!n||typeof n=="string"||(i[l]("touchstart",e.onDocumentTouchStart,{passive:!1,capture:o}),n[l]("touchstart",e.onTouchStart,{passive:!1}),n[l]("pointerdown",e.onTouchStart,{passive:!1}),i[l]("touchmove",e.onTouchMove,{passive:!1,capture:o}),i[l]("pointermove",e.onTouchMove,{passive:!1,capture:o}),i[l]("touchend",e.onTouchEnd,{passive:!0}),i[l]("pointerup",e.onTouchEnd,{passive:!0}),i[l]("pointercancel",e.onTouchEnd,{passive:!0}),i[l]("touchcancel",e.onTouchEnd,{passive:!0}),i[l]("pointerout",e.onTouchEnd,{passive:!0}),i[l]("pointerleave",e.onTouchEnd,{passive:!0}),i[l]("contextmenu",e.onTouchEnd,{passive:!0}),(r.preventClicks||r.preventClicksPropagation)&&n[l]("click",e.onClick,!0),r.cssMode&&s[l]("scroll",e.onScroll),r.updateOnWindowResize?e[c](a.ios||a.android?"resize orientationchange observerUpdate":"resize observerUpdate",tX,!0):e[c]("observerUpdate",tX,!0),n[l]("load",e.onLoad,{capture:!0}))};function CVe(){const e=this,{params:t}=e;e.onTouchStart=bVe.bind(e),e.onTouchMove=_Ve.bind(e),e.onTouchEnd=SVe.bind(e),e.onDocumentTouchStart=TVe.bind(e),t.cssMode&&(e.onScroll=EVe.bind(e)),e.onClick=MVe.bind(e),e.onLoad=AVe.bind(e),Bre(e,"on")}function PVe(){Bre(this,"off")}var DVe={attachEvents:CVe,detachEvents:PVe};const iX=(e,t)=>e.grid&&t.grid&&t.grid.rows>1;function RVe(){const e=this,{realIndex:t,initialized:i,params:r,el:n}=e,s=r.breakpoints;if(!s||s&&Object.keys(s).length===0)return;const a=iu(),o=r.breakpointsBase==="window"||!r.breakpointsBase?r.breakpointsBase:"container",l=["window","container"].includes(r.breakpointsBase)||!r.breakpointsBase?e.el:a.querySelector(r.breakpointsBase),c=e.getBreakpoint(s,o,l);if(!c||e.currentBreakpoint===c)return;const h=(c in s?s[c]:void 0)||e.originalParams,d=iX(e,r),f=iX(e,h),p=e.params.grabCursor,v=h.grabCursor,m=r.enabled;d&&!f?(n.classList.remove(`${r.containerModifierClass}grid`,`${r.containerModifierClass}grid-column`),e.emitContainerClasses()):!d&&f&&(n.classList.add(`${r.containerModifierClass}grid`),(h.grid.fill&&h.grid.fill==="column"||!h.grid.fill&&r.grid.fill==="column")&&n.classList.add(`${r.containerModifierClass}grid-column`),e.emitContainerClasses()),p&&!v?e.unsetGrabCursor():!p&&v&&e.setGrabCursor(),["navigation","pagination","scrollbar"].forEach(S=>{if(typeof h[S]>"u")return;const T=r[S]&&r[S].enabled,E=h[S]&&h[S].enabled;T&&!E&&e[S].disable(),!T&&E&&e[S].enable()});const g=h.direction&&h.direction!==r.direction,y=r.loop&&(h.slidesPerView!==r.slidesPerView||g),x=r.loop;g&&i&&e.changeDirection(),Co(e.params,h);const _=e.params.enabled,M=e.params.loop;Object.assign(e,{allowTouchMove:e.params.allowTouchMove,allowSlideNext:e.params.allowSlideNext,allowSlidePrev:e.params.allowSlidePrev}),m&&!_?e.disable():!m&&_&&e.enable(),e.currentBreakpoint=c,e.emit("_beforeBreakpoint",h),i&&(y?(e.loopDestroy(),e.loopCreate(t),e.updateSlides()):!x&&M?(e.loopCreate(t),e.updateSlides()):x&&!M&&e.loopDestroy()),e.emit("breakpoint",h)}function IVe(e,t,i){if(t===void 0&&(t="window"),!e||t==="container"&&!i)return;let r=!1;const n=Na(),s=t==="window"?n.innerHeight:i.clientHeight,a=Object.keys(e).map(o=>{if(typeof o=="string"&&o.indexOf("@")===0){const l=parseFloat(o.substr(1));return{value:s*l,point:o}}return{value:o,point:o}});a.sort((o,l)=>parseInt(o.value,10)-parseInt(l.value,10));for(let o=0;o<a.length;o+=1){const{point:l,value:c}=a[o];t==="window"?n.matchMedia(`(min-width: ${c}px)`).matches&&(r=l):c<=i.clientWidth&&(r=l)}return r||"max"}var LVe={setBreakpoint:RVe,getBreakpoint:IVe};function OVe(e,t){const i=[];return e.forEach(r=>{typeof r=="object"?Object.keys(r).forEach(n=>{r[n]&&i.push(t+n)}):typeof r=="string"&&i.push(t+r)}),i}function zVe(){const e=this,{classNames:t,params:i,rtl:r,el:n,device:s}=e,a=OVe(["initialized",i.direction,{"free-mode":e.params.freeMode&&i.freeMode.enabled},{autoheight:i.autoHeight},{rtl:r},{grid:i.grid&&i.grid.rows>1},{"grid-column":i.grid&&i.grid.rows>1&&i.grid.fill==="column"},{android:s.android},{ios:s.ios},{"css-mode":i.cssMode},{centered:i.cssMode&&i.centeredSlides},{"watch-progress":i.watchSlidesProgress}],i.containerModifierClass);t.push(...a),n.classList.add(...t),e.emitContainerClasses()}function BVe(){const e=this,{el:t,classNames:i}=e;!t||typeof t=="string"||(t.classList.remove(...i),e.emitContainerClasses())}var FVe={addClasses:zVe,removeClasses:BVe};function UVe(){const e=this,{isLocked:t,params:i}=e,{slidesOffsetBefore:r}=i;if(r){const n=e.slides.length-1,s=e.slidesGrid[n]+e.slidesSizesGrid[n]+r*2;e.isLocked=e.size>s}else e.isLocked=e.snapGrid.length===1;i.allowSlideNext===!0&&(e.allowSlideNext=!e.isLocked),i.allowSlidePrev===!0&&(e.allowSlidePrev=!e.isLocked),t&&t!==e.isLocked&&(e.isEnd=!1),t!==e.isLocked&&e.emit(e.isLocked?"lock":"unlock")}var NVe={checkOverflow:UVe},XB={init:!0,direction:"horizontal",oneWayMovement:!1,swiperElementNodeName:"SWIPER-CONTAINER",touchEventsTarget:"wrapper",initialSlide:0,speed:300,cssMode:!1,updateOnWindowResize:!0,resizeObserver:!0,nested:!1,createElements:!1,eventsPrefix:"swiper",enabled:!0,focusableElements:"input, select, option, textarea, button, video, label",width:null,height:null,preventInteractionOnTransition:!1,userAgent:null,url:null,edgeSwipeDetection:!1,edgeSwipeThreshold:20,autoHeight:!1,setWrapperSize:!1,virtualTranslate:!1,effect:"slide",breakpoints:void 0,breakpointsBase:"window",spaceBetween:0,slidesPerView:1,slidesPerGroup:1,slidesPerGroupSkip:0,slidesPerGroupAuto:!1,centeredSlides:!1,centeredSlidesBounds:!1,slidesOffsetBefore:0,slidesOffsetAfter:0,normalizeSlideIndex:!0,centerInsufficientSlides:!1,watchOverflow:!0,roundLengths:!1,touchRatio:1,touchAngle:45,simulateTouch:!0,shortSwipes:!0,longSwipes:!0,longSwipesRatio:.5,longSwipesMs:300,followFinger:!0,allowTouchMove:!0,threshold:5,touchMoveStopPropagation:!1,touchStartPreventDefault:!0,touchStartForcePreventDefault:!1,touchReleaseOnEdges:!1,uniqueNavElements:!0,resistance:!0,resistanceRatio:.85,watchSlidesProgress:!1,grabCursor:!1,preventClicks:!0,preventClicksPropagation:!0,slideToClickedSlide:!1,loop:!1,loopAddBlankSlides:!0,loopAdditionalSlides:0,loopPreventsSliding:!0,rewind:!1,allowSlidePrev:!0,allowSlideNext:!0,swipeHandler:null,noSwiping:!0,noSwipingClass:"swiper-no-swiping",noSwipingSelector:null,passiveListeners:!0,maxBackfaceHiddenSlides:10,containerModifierClass:"swiper-",slideClass:"swiper-slide",slideBlankClass:"swiper-slide-blank",slideActiveClass:"swiper-slide-active",slideVisibleClass:"swiper-slide-visible",slideFullyVisibleClass:"swiper-slide-fully-visible",slideNextClass:"swiper-slide-next",slidePrevClass:"swiper-slide-prev",wrapperClass:"swiper-wrapper",lazyPreloaderClass:"swiper-lazy-preloader",lazyPreloadPrevNext:0,runCallbacksOnInit:!0,_emitClasses:!1};function kVe(e,t){return function(r){r===void 0&&(r={});const n=Object.keys(r)[0],s=r[n];if(typeof s!="object"||s===null){Co(t,r);return}if(e[n]===!0&&(e[n]={enabled:!0}),n==="navigation"&&e[n]&&e[n].enabled&&!e[n].prevEl&&!e[n].nextEl&&(e[n].auto=!0),["pagination","scrollbar"].indexOf(n)>=0&&e[n]&&e[n].enabled&&!e[n].el&&(e[n].auto=!0),!(n in e&&"enabled"in s)){Co(t,r);return}typeof e[n]=="object"&&!("enabled"in e[n])&&(e[n].enabled=!0),e[n]||(e[n]={enabled:!1}),Co(t,r)}}const EI={eventsEmitter:F5e,update:Y5e,translate:eVe,transition:nVe,slide:dVe,loop:gVe,grabCursor:xVe,events:DVe,breakpoints:LVe,checkOverflow:NVe,classes:FVe},AI={};let L4=class ju{constructor(){let t,i;for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];n.length===1&&n[0].constructor&&Object.prototype.toString.call(n[0]).slice(8,-1)==="Object"?i=n[0]:[t,i]=n,i||(i={}),i=Co({},i),t&&!i.el&&(i.el=t);const a=iu();if(i.el&&typeof i.el=="string"&&a.querySelectorAll(i.el).length>1){const u=[];return a.querySelectorAll(i.el).forEach(h=>{const d=Co({},i,{el:h});u.push(new ju(d))}),u}const o=this;o.__swiper__=!0,o.support=Ire(),o.device=Lre({userAgent:i.userAgent}),o.browser=Ore(),o.eventsListeners={},o.eventsAnyListeners=[],o.modules=[...o.__modules__],i.modules&&Array.isArray(i.modules)&&o.modules.push(...i.modules);const l={};o.modules.forEach(u=>{u({params:i,swiper:o,extendParams:kVe(i,l),on:o.on.bind(o),once:o.once.bind(o),off:o.off.bind(o),emit:o.emit.bind(o)})});const c=Co({},XB,l);return o.params=Co({},c,AI,i),o.originalParams=Co({},o.params),o.passedParams=Co({},i),o.params&&o.params.on&&Object.keys(o.params.on).forEach(u=>{o.on(u,o.params.on[u])}),o.params&&o.params.onAny&&o.onAny(o.params.onAny),Object.assign(o,{enabled:o.params.enabled,el:t,classNames:[],slides:[],slidesGrid:[],snapGrid:[],slidesSizesGrid:[],isHorizontal(){return o.params.direction==="horizontal"},isVertical(){return o.params.direction==="vertical"},activeIndex:0,realIndex:0,isBeginning:!0,isEnd:!1,translate:0,previousTranslate:0,progress:0,velocity:0,animating:!1,cssOverflowAdjustment(){return Math.trunc(this.translate/2**23)*2**23},allowSlideNext:o.params.allowSlideNext,allowSlidePrev:o.params.allowSlidePrev,touchEventsData:{isTouched:void 0,isMoved:void 0,allowTouchCallbacks:void 0,touchStartTime:void 0,isScrolling:void 0,currentTranslate:void 0,startTranslate:void 0,allowThresholdMove:void 0,focusableElements:o.params.focusableElements,lastClickTime:0,clickTimeout:void 0,velocities:[],allowMomentumBounce:void 0,startMoving:void 0,pointerId:null,touchId:null},allowClick:!0,allowTouchMove:o.params.allowTouchMove,touches:{startX:0,startY:0,currentX:0,currentY:0,diff:0},imagesToLoad:[],imagesLoaded:0}),o.emit("_swiper"),o.params.init&&o.init(),o}getDirectionLabel(t){return this.isHorizontal()?t:{width:"height","margin-top":"margin-left","margin-bottom ":"margin-right","margin-left":"margin-top","margin-right":"margin-bottom","padding-left":"padding-top","padding-right":"padding-bottom",marginRight:"marginBottom"}[t]}getSlideIndex(t){const{slidesEl:i,params:r}=this,n=Xc(i,`.${r.slideClass}, swiper-slide`),s=dT(n[0]);return dT(t)-s}getSlideIndexByData(t){return this.getSlideIndex(this.slides.find(i=>i.getAttribute("data-swiper-slide-index")*1===t))}recalcSlides(){const t=this,{slidesEl:i,params:r}=t;t.slides=Xc(i,`.${r.slideClass}, swiper-slide`)}enable(){const t=this;t.enabled||(t.enabled=!0,t.params.grabCursor&&t.setGrabCursor(),t.emit("enable"))}disable(){const t=this;t.enabled&&(t.enabled=!1,t.params.grabCursor&&t.unsetGrabCursor(),t.emit("disable"))}setProgress(t,i){const r=this;t=Math.min(Math.max(t,0),1);const n=r.minTranslate(),a=(r.maxTranslate()-n)*t+n;r.translateTo(a,typeof i>"u"?0:i),r.updateActiveIndex(),r.updateSlidesClasses()}emitContainerClasses(){const t=this;if(!t.params._emitClasses||!t.el)return;const i=t.el.className.split(" ").filter(r=>r.indexOf("swiper")===0||r.indexOf(t.params.containerModifierClass)===0);t.emit("_containerClasses",i.join(" "))}getSlideClasses(t){const i=this;return i.destroyed?"":t.className.split(" ").filter(r=>r.indexOf("swiper-slide")===0||r.indexOf(i.params.slideClass)===0).join(" ")}emitSlidesClasses(){const t=this;if(!t.params._emitClasses||!t.el)return;const i=[];t.slides.forEach(r=>{const n=t.getSlideClasses(r);i.push({slideEl:r,classNames:n}),t.emit("_slideClass",r,n)}),t.emit("_slideClasses",i)}slidesPerViewDynamic(t,i){t===void 0&&(t="current"),i===void 0&&(i=!1);const r=this,{params:n,slides:s,slidesGrid:a,slidesSizesGrid:o,size:l,activeIndex:c}=r;let u=1;if(typeof n.slidesPerView=="number")return n.slidesPerView;if(n.centeredSlides){let h=s[c]?Math.ceil(s[c].swiperSlideSize):0,d;for(let f=c+1;f<s.length;f+=1)s[f]&&!d&&(h+=Math.ceil(s[f].swiperSlideSize),u+=1,h>l&&(d=!0));for(let f=c-1;f>=0;f-=1)s[f]&&!d&&(h+=s[f].swiperSlideSize,u+=1,h>l&&(d=!0))}else if(t==="current")for(let h=c+1;h<s.length;h+=1)(i?a[h]+o[h]-a[c]<l:a[h]-a[c]<l)&&(u+=1);else for(let h=c-1;h>=0;h-=1)a[c]-a[h]<l&&(u+=1);return u}update(){const t=this;if(!t||t.destroyed)return;const{snapGrid:i,params:r}=t;r.breakpoints&&t.setBreakpoint(),[...t.el.querySelectorAll('[loading="lazy"]')].forEach(a=>{a.complete&&m2(t,a)}),t.updateSize(),t.updateSlides(),t.updateProgress(),t.updateSlidesClasses();function n(){const a=t.rtlTranslate?t.translate*-1:t.translate,o=Math.min(Math.max(a,t.maxTranslate()),t.minTranslate());t.setTranslate(o),t.updateActiveIndex(),t.updateSlidesClasses()}let s;if(r.freeMode&&r.freeMode.enabled&&!r.cssMode)n(),r.autoHeight&&t.updateAutoHeight();else{if((r.slidesPerView==="auto"||r.slidesPerView>1)&&t.isEnd&&!r.centeredSlides){const a=t.virtual&&r.virtual.enabled?t.virtual.slides:t.slides;s=t.slideTo(a.length-1,0,!1,!0)}else s=t.slideTo(t.activeIndex,0,!1,!0);s||n()}r.watchOverflow&&i!==t.snapGrid&&t.checkOverflow(),t.emit("update")}changeDirection(t,i){i===void 0&&(i=!0);const r=this,n=r.params.direction;return t||(t=n==="horizontal"?"vertical":"horizontal"),t===n||t!=="horizontal"&&t!=="vertical"||(r.el.classList.remove(`${r.params.containerModifierClass}${n}`),r.el.classList.add(`${r.params.containerModifierClass}${t}`),r.emitContainerClasses(),r.params.direction=t,r.slides.forEach(s=>{t==="vertical"?s.style.width="":s.style.height=""}),r.emit("changeDirection"),i&&r.update()),r}changeLanguageDirection(t){const i=this;i.rtl&&t==="rtl"||!i.rtl&&t==="ltr"||(i.rtl=t==="rtl",i.rtlTranslate=i.params.direction==="horizontal"&&i.rtl,i.rtl?(i.el.classList.add(`${i.params.containerModifierClass}rtl`),i.el.dir="rtl"):(i.el.classList.remove(`${i.params.containerModifierClass}rtl`),i.el.dir="ltr"),i.update())}mount(t){const i=this;if(i.mounted)return!0;let r=t||i.params.el;if(typeof r=="string"&&(r=document.querySelector(r)),!r)return!1;r.swiper=i,r.parentNode&&r.parentNode.host&&r.parentNode.host.nodeName===i.params.swiperElementNodeName.toUpperCase()&&(i.isElement=!0);const n=()=>`.${(i.params.wrapperClass||"").trim().split(" ").join(".")}`;let a=r&&r.shadowRoot&&r.shadowRoot.querySelector?r.shadowRoot.querySelector(n()):Xc(r,n())[0];return!a&&i.params.createElements&&(a=Kw("div",i.params.wrapperClass),r.append(a),Xc(r,`.${i.params.slideClass}`).forEach(o=>{a.append(o)})),Object.assign(i,{el:r,wrapperEl:a,slidesEl:i.isElement&&!r.parentNode.host.slideSlots?r.parentNode.host:a,hostEl:i.isElement?r.parentNode.host:r,mounted:!0,rtl:r.dir.toLowerCase()==="rtl"||qd(r,"direction")==="rtl",rtlTranslate:i.params.direction==="horizontal"&&(r.dir.toLowerCase()==="rtl"||qd(r,"direction")==="rtl"),wrongRTL:qd(a,"display")==="-webkit-box"}),!0}init(t){const i=this;if(i.initialized||i.mount(t)===!1)return i;i.emit("beforeInit"),i.params.breakpoints&&i.setBreakpoint(),i.addClasses(),i.updateSize(),i.updateSlides(),i.params.watchOverflow&&i.checkOverflow(),i.params.grabCursor&&i.enabled&&i.setGrabCursor(),i.params.loop&&i.virtual&&i.params.virtual.enabled?i.slideTo(i.params.initialSlide+i.virtual.slidesBefore,0,i.params.runCallbacksOnInit,!1,!0):i.slideTo(i.params.initialSlide,0,i.params.runCallbacksOnInit,!1,!0),i.params.loop&&i.loopCreate(),i.attachEvents();const n=[...i.el.querySelectorAll('[loading="lazy"]')];return i.isElement&&n.push(...i.hostEl.querySelectorAll('[loading="lazy"]')),n.forEach(s=>{s.complete?m2(i,s):s.addEventListener("load",a=>{m2(i,a.target)})}),WB(i),i.initialized=!0,WB(i),i.emit("init"),i.emit("afterInit"),i}destroy(t,i){t===void 0&&(t=!0),i===void 0&&(i=!0);const r=this,{params:n,el:s,wrapperEl:a,slides:o}=r;return typeof r.params>"u"||r.destroyed||(r.emit("beforeDestroy"),r.initialized=!1,r.detachEvents(),n.loop&&r.loopDestroy(),i&&(r.removeClasses(),s&&typeof s!="string"&&s.removeAttribute("style"),a&&a.removeAttribute("style"),o&&o.length&&o.forEach(l=>{l.classList.remove(n.slideVisibleClass,n.slideFullyVisibleClass,n.slideActiveClass,n.slideNextClass,n.slidePrevClass),l.removeAttribute("style"),l.removeAttribute("data-swiper-slide-index")})),r.emit("destroy"),Object.keys(r.eventsListeners).forEach(l=>{r.off(l)}),t!==!1&&(r.el&&typeof r.el!="string"&&(r.el.swiper=null),S5e(r)),r.destroyed=!0),null}static extendDefaults(t){Co(AI,t)}static get extendedDefaults(){return AI}static get defaults(){return XB}static installModule(t){ju.prototype.__modules__||(ju.prototype.__modules__=[]);const i=ju.prototype.__modules__;typeof t=="function"&&i.indexOf(t)<0&&i.push(t)}static use(t){return Array.isArray(t)?(t.forEach(i=>ju.installModule(i)),ju):(ju.installModule(t),ju)}};Object.keys(EI).forEach(e=>{Object.keys(EI[e]).forEach(t=>{L4.prototype[t]=EI[e][t]})});L4.use([z5e,B5e]);const Fre=["eventsPrefix","injectStyles","injectStylesUrls","modules","init","_direction","oneWayMovement","swiperElementNodeName","touchEventsTarget","initialSlide","_speed","cssMode","updateOnWindowResize","resizeObserver","nested","focusableElements","_enabled","_width","_height","preventInteractionOnTransition","userAgent","url","_edgeSwipeDetection","_edgeSwipeThreshold","_freeMode","_autoHeight","setWrapperSize","virtualTranslate","_effect","breakpoints","breakpointsBase","_spaceBetween","_slidesPerView","maxBackfaceHiddenSlides","_grid","_slidesPerGroup","_slidesPerGroupSkip","_slidesPerGroupAuto","_centeredSlides","_centeredSlidesBounds","_slidesOffsetBefore","_slidesOffsetAfter","normalizeSlideIndex","_centerInsufficientSlides","_watchOverflow","roundLengths","touchRatio","touchAngle","simulateTouch","_shortSwipes","_longSwipes","longSwipesRatio","longSwipesMs","_followFinger","allowTouchMove","_threshold","touchMoveStopPropagation","touchStartPreventDefault","touchStartForcePreventDefault","touchReleaseOnEdges","uniqueNavElements","_resistance","_resistanceRatio","_watchSlidesProgress","_grabCursor","preventClicks","preventClicksPropagation","_slideToClickedSlide","_loop","loopAdditionalSlides","loopAddBlankSlides","loopPreventsSliding","_rewind","_allowSlidePrev","_allowSlideNext","_swipeHandler","_noSwiping","noSwipingClass","noSwipingSelector","passiveListeners","containerModifierClass","slideClass","slideActiveClass","slideVisibleClass","slideFullyVisibleClass","slideNextClass","slidePrevClass","slideBlankClass","wrapperClass","lazyPreloaderClass","lazyPreloadPrevNext","runCallbacksOnInit","observer","observeParents","observeSlideChildren","a11y","_autoplay","_controller","coverflowEffect","cubeEffect","fadeEffect","flipEffect","creativeEffect","cardsEffect","hashNavigation","history","keyboard","mousewheel","_navigation","_pagination","parallax","_scrollbar","_thumbs","virtual","zoom","control"];function Rm(e){return typeof e=="object"&&e!==null&&e.constructor&&Object.prototype.toString.call(e).slice(8,-1)==="Object"&&!e.__swiper__}function w0(e,t){const i=["__proto__","constructor","prototype"];Object.keys(t).filter(r=>i.indexOf(r)<0).forEach(r=>{typeof e[r]>"u"?e[r]=t[r]:Rm(t[r])&&Rm(e[r])&&Object.keys(t[r]).length>0?t[r].__swiper__?e[r]=t[r]:w0(e[r],t[r]):e[r]=t[r]})}function Ure(e){return e===void 0&&(e={}),e.navigation&&typeof e.navigation.nextEl>"u"&&typeof e.navigation.prevEl>"u"}function Nre(e){return e===void 0&&(e={}),e.pagination&&typeof e.pagination.el>"u"}function kre(e){return e===void 0&&(e={}),e.scrollbar&&typeof e.scrollbar.el>"u"}function Vre(e){e===void 0&&(e="");const t=e.split(" ").map(r=>r.trim()).filter(r=>!!r),i=[];return t.forEach(r=>{i.indexOf(r)<0&&i.push(r)}),i.join(" ")}function VVe(e){return e===void 0&&(e=""),e?e.includes("swiper-wrapper")?e:`swiper-wrapper ${e}`:"swiper-wrapper"}function GVe(e){let{swiper:t,slides:i,passedParams:r,changedParams:n,nextEl:s,prevEl:a,scrollbarEl:o,paginationEl:l}=e;const c=n.filter(C=>C!=="children"&&C!=="direction"&&C!=="wrapperClass"),{params:u,pagination:h,navigation:d,scrollbar:f,virtual:p,thumbs:v}=t;let m,g,y,x,_,M,S,T;n.includes("thumbs")&&r.thumbs&&r.thumbs.swiper&&!r.thumbs.swiper.destroyed&&u.thumbs&&(!u.thumbs.swiper||u.thumbs.swiper.destroyed)&&(m=!0),n.includes("controller")&&r.controller&&r.controller.control&&u.controller&&!u.controller.control&&(g=!0),n.includes("pagination")&&r.pagination&&(r.pagination.el||l)&&(u.pagination||u.pagination===!1)&&h&&!h.el&&(y=!0),n.includes("scrollbar")&&r.scrollbar&&(r.scrollbar.el||o)&&(u.scrollbar||u.scrollbar===!1)&&f&&!f.el&&(x=!0),n.includes("navigation")&&r.navigation&&(r.navigation.prevEl||a)&&(r.navigation.nextEl||s)&&(u.navigation||u.navigation===!1)&&d&&!d.prevEl&&!d.nextEl&&(_=!0);const E=C=>{t[C]&&(t[C].destroy(),C==="navigation"?(t.isElement&&(t[C].prevEl.remove(),t[C].nextEl.remove()),u[C].prevEl=void 0,u[C].nextEl=void 0,t[C].prevEl=void 0,t[C].nextEl=void 0):(t.isElement&&t[C].el.remove(),u[C].el=void 0,t[C].el=void 0))};n.includes("loop")&&t.isElement&&(u.loop&&!r.loop?M=!0:!u.loop&&r.loop?S=!0:T=!0),c.forEach(C=>{if(Rm(u[C])&&Rm(r[C]))Object.assign(u[C],r[C]),(C==="navigation"||C==="pagination"||C==="scrollbar")&&"enabled"in r[C]&&!r[C].enabled&&E(C);else{const A=r[C];(A===!0||A===!1)&&(C==="navigation"||C==="pagination"||C==="scrollbar")?A===!1&&E(C):u[C]=r[C]}}),c.includes("controller")&&!g&&t.controller&&t.controller.control&&u.controller&&u.controller.control&&(t.controller.control=u.controller.control),n.includes("children")&&i&&p&&u.virtual.enabled?(p.slides=i,p.update(!0)):n.includes("virtual")&&p&&u.virtual.enabled&&(i&&(p.slides=i),p.update(!0)),n.includes("children")&&i&&u.loop&&(T=!0),m&&v.init()&&v.update(!0),g&&(t.controller.control=u.controller.control),y&&(t.isElement&&(!l||typeof l=="string")&&(l=document.createElement("div"),l.classList.add("swiper-pagination"),l.part.add("pagination"),t.el.appendChild(l)),l&&(u.pagination.el=l),h.init(),h.render(),h.update()),x&&(t.isElement&&(!o||typeof o=="string")&&(o=document.createElement("div"),o.classList.add("swiper-scrollbar"),o.part.add("scrollbar"),t.el.appendChild(o)),o&&(u.scrollbar.el=o),f.init(),f.updateSize(),f.setTranslate()),_&&(t.isElement&&((!s||typeof s=="string")&&(s=document.createElement("div"),s.classList.add("swiper-button-next"),s.innerHTML=t.hostEl.constructor.nextButtonSvg,s.part.add("button-next"),t.el.appendChild(s)),(!a||typeof a=="string")&&(a=document.createElement("div"),a.classList.add("swiper-button-prev"),a.innerHTML=t.hostEl.constructor.prevButtonSvg,a.part.add("button-prev"),t.el.appendChild(a))),s&&(u.navigation.nextEl=s),a&&(u.navigation.prevEl=a),d.init(),d.update()),n.includes("allowSlideNext")&&(t.allowSlideNext=r.allowSlideNext),n.includes("allowSlidePrev")&&(t.allowSlidePrev=r.allowSlidePrev),n.includes("direction")&&t.changeDirection(r.direction,!1),(M||T)&&t.loopDestroy(),(S||T)&&t.loopCreate(),t.update()}function HVe(e,t){e===void 0&&(e={}),t===void 0&&(t=!0);const i={on:{}},r={},n={};w0(i,XB),i._emitClasses=!0,i.init=!1;const s={},a=Fre.map(l=>l.replace(/_/,"")),o=Object.assign({},e);return Object.keys(o).forEach(l=>{typeof e[l]>"u"||(a.indexOf(l)>=0?Rm(e[l])?(i[l]={},n[l]={},w0(i[l],e[l]),w0(n[l],e[l])):(i[l]=e[l],n[l]=e[l]):l.search(/on[A-Z]/)===0&&typeof e[l]=="function"?t?r[`${l[2].toLowerCase()}${l.substr(3)}`]=e[l]:i.on[`${l[2].toLowerCase()}${l.substr(3)}`]=e[l]:s[l]=e[l])}),["navigation","pagination","scrollbar"].forEach(l=>{i[l]===!0&&(i[l]={}),i[l]===!1&&delete i[l]}),{params:i,passedParams:n,rest:s,events:r}}function jVe(e,t){let{el:i,nextEl:r,prevEl:n,paginationEl:s,scrollbarEl:a,swiper:o}=e;Ure(t)&&r&&n&&(o.params.navigation.nextEl=r,o.originalParams.navigation.nextEl=r,o.params.navigation.prevEl=n,o.originalParams.navigation.prevEl=n),Nre(t)&&s&&(o.params.pagination.el=s,o.originalParams.pagination.el=s),kre(t)&&a&&(o.params.scrollbar.el=a,o.originalParams.scrollbar.el=a),o.init(i)}function WVe(e,t,i,r,n){const s=[];if(!t)return s;const a=l=>{s.indexOf(l)<0&&s.push(l)};if(i&&r){const l=r.map(n),c=i.map(n);l.join("")!==c.join("")&&a("children"),r.length!==i.length&&a("children")}return Fre.filter(l=>l[0]==="_").map(l=>l.replace(/_/,"")).forEach(l=>{if(l in e&&l in t)if(Rm(e[l])&&Rm(t[l])){const c=Object.keys(e[l]),u=Object.keys(t[l]);c.length!==u.length?a(l):(c.forEach(h=>{e[l][h]!==t[l][h]&&a(l)}),u.forEach(h=>{e[l][h]!==t[l][h]&&a(l)}))}else e[l]!==t[l]&&a(l)}),s}const XVe=e=>{!e||e.destroyed||!e.params.virtual||e.params.virtual&&!e.params.virtual.enabled||(e.updateSlides(),e.updateProgress(),e.updateSlidesClasses(),e.parallax&&e.params.parallax&&e.params.parallax.enabled&&e.parallax.setTranslate())};function fT(){return fT=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},fT.apply(this,arguments)}function Gre(e){return e.type&&e.type.displayName&&e.type.displayName.includes("SwiperSlide")}function Hre(e){const t=[];return ar.Children.toArray(e).forEach(i=>{Gre(i)?t.push(i):i.props&&i.props.children&&Hre(i.props.children).forEach(r=>t.push(r))}),t}function qVe(e){const t=[],i={"container-start":[],"container-end":[],"wrapper-start":[],"wrapper-end":[]};return ar.Children.toArray(e).forEach(r=>{if(Gre(r))t.push(r);else if(r.props&&r.props.slot&&i[r.props.slot])i[r.props.slot].push(r);else if(r.props&&r.props.children){const n=Hre(r.props.children);n.length>0?n.forEach(s=>t.push(s)):i["container-end"].push(r)}else i["container-end"].push(r)}),{slides:t,slots:i}}function YVe(e,t,i){if(!i)return null;const r=u=>{let h=u;return u<0?h=t.length+u:h>=t.length&&(h=h-t.length),h},n=e.isHorizontal()?{[e.rtlTranslate?"right":"left"]:`${i.offset}px`}:{top:`${i.offset}px`},{from:s,to:a}=i,o=e.params.loop?-t.length:0,l=e.params.loop?t.length*2:t.length,c=[];for(let u=o;u<l;u+=1)u>=s&&u<=a&&c.push(t[r(u)]);return c.map((u,h)=>ar.cloneElement(u,{swiper:e,style:n,key:u.props.virtualIndex||u.key||`slide-${h}`}))}function Wx(e,t){return typeof window>"u"?_e.useEffect(e,t):_e.useLayoutEffect(e,t)}const rX=_e.createContext(null),QVe=_e.createContext(null),jre=_e.forwardRef(function(e,t){let{className:i,tag:r="div",wrapperTag:n="div",children:s,onSwiper:a,...o}=e===void 0?{}:e,l=!1;const[c,u]=_e.useState("swiper"),[h,d]=_e.useState(null),[f,p]=_e.useState(!1),v=_e.useRef(!1),m=_e.useRef(null),g=_e.useRef(null),y=_e.useRef(null),x=_e.useRef(null),_=_e.useRef(null),M=_e.useRef(null),S=_e.useRef(null),T=_e.useRef(null),{params:E,passedParams:C,rest:A,events:D}=HVe(o),{slides:R,slots:L}=qVe(s),O=()=>{p(!f)};Object.assign(E.on,{_containerClasses(V,U){u(U)}});const H=()=>{Object.assign(E.on,D),l=!0;const V={...E};if(delete V.wrapperClass,g.current=new L4(V),g.current.virtual&&g.current.params.virtual.enabled){g.current.virtual.slides=R;const U={cache:!1,slides:R,renderExternal:d,renderExternalUpdate:!1};w0(g.current.params.virtual,U),w0(g.current.originalParams.virtual,U)}};m.current||H(),g.current&&g.current.on("_beforeBreakpoint",O);const j=()=>{l||!D||!g.current||Object.keys(D).forEach(V=>{g.current.on(V,D[V])})},Y=()=>{!D||!g.current||Object.keys(D).forEach(V=>{g.current.off(V,D[V])})};_e.useEffect(()=>()=>{g.current&&g.current.off("_beforeBreakpoint",O)}),_e.useEffect(()=>{!v.current&&g.current&&(g.current.emitSlidesClasses(),v.current=!0)}),Wx(()=>{if(t&&(t.current=m.current),!!m.current)return g.current.destroyed&&H(),jVe({el:m.current,nextEl:_.current,prevEl:M.current,paginationEl:S.current,scrollbarEl:T.current,swiper:g.current},E),a&&!g.current.destroyed&&a(g.current),()=>{g.current&&!g.current.destroyed&&g.current.destroy(!0,!1)}},[]),Wx(()=>{j();const V=WVe(C,y.current,R,x.current,U=>U.key);return y.current=C,x.current=R,V.length&&g.current&&!g.current.destroyed&&GVe({swiper:g.current,slides:R,passedParams:C,changedParams:V,nextEl:_.current,prevEl:M.current,scrollbarEl:T.current,paginationEl:S.current}),()=>{Y()}}),Wx(()=>{XVe(g.current)},[h]);function z(){return E.virtual?YVe(g.current,R,h):R.map((V,U)=>ar.cloneElement(V,{swiper:g.current,swiperSlideIndex:U}))}return ar.createElement(r,fT({ref:m,className:Vre(`${c}${i?` ${i}`:""}`)},A),ar.createElement(QVe.Provider,{value:g.current},L["container-start"],ar.createElement(n,{className:VVe(E.wrapperClass)},L["wrapper-start"],z(),L["wrapper-end"]),Ure(E)&&ar.createElement(ar.Fragment,null,ar.createElement("div",{ref:M,className:"swiper-button-prev"}),ar.createElement("div",{ref:_,className:"swiper-button-next"})),kre(E)&&ar.createElement("div",{ref:T,className:"swiper-scrollbar"}),Nre(E)&&ar.createElement("div",{ref:S,className:"swiper-pagination"}),L["container-end"]))});jre.displayName="Swiper";const Wre=_e.forwardRef(function(e,t){let{tag:i="div",children:r,className:n="",swiper:s,zoom:a,lazy:o,virtualIndex:l,swiperSlideIndex:c,...u}=e===void 0?{}:e;const h=_e.useRef(null),[d,f]=_e.useState("swiper-slide"),[p,v]=_e.useState(!1);function m(_,M,S){M===h.current&&f(S)}Wx(()=>{if(typeof c<"u"&&(h.current.swiperSlideIndex=c),t&&(t.current=h.current),!(!h.current||!s)){if(s.destroyed){d!=="swiper-slide"&&f("swiper-slide");return}return s.on("_slideClass",m),()=>{s&&s.off("_slideClass",m)}}}),Wx(()=>{s&&h.current&&!s.destroyed&&f(s.getSlideClasses(h.current))},[s]);const g={isActive:d.indexOf("swiper-slide-active")>=0,isVisible:d.indexOf("swiper-slide-visible")>=0,isPrev:d.indexOf("swiper-slide-prev")>=0,isNext:d.indexOf("swiper-slide-next")>=0},y=()=>typeof r=="function"?r(g):r,x=()=>{v(!0)};return ar.createElement(i,fT({ref:h,className:Vre(`${d}${n?` ${n}`:""}`),"data-swiper-slide-index":l,onLoad:x},u),a&&ar.createElement(rX.Provider,{value:g},ar.createElement("div",{className:"swiper-zoom-container","data-swiper-zoom":typeof a=="number"?a:void 0},y(),o&&!p&&ar.createElement("div",{className:"swiper-lazy-preloader"}))),!a&&ar.createElement(rX.Provider,{value:g},y(),o&&!p&&ar.createElement("div",{className:"swiper-lazy-preloader"})))});Wre.displayName="SwiperSlide";function ZVe(e,t,i,r){return e.params.createElements&&Object.keys(r).forEach(n=>{if(!i[n]&&i.auto===!0){let s=Xc(e.el,`.${r[n]}`)[0];s||(s=Kw("div",r[n]),s.className=r[n],e.el.append(s)),i[n]=s,t[n]=s}}),i}function O1(e){return e===void 0&&(e=""),`.${e.trim().replace(/([\.:!+\/])/g,"\\$1").replace(/ /g,".")}`}function KVe(e){let{swiper:t,extendParams:i,on:r,emit:n}=e;const s="swiper-pagination";i({pagination:{el:null,bulletElement:"span",clickable:!1,hideOnClick:!1,renderBullet:null,renderProgressbar:null,renderFraction:null,renderCustom:null,progressbarOpposite:!1,type:"bullets",dynamicBullets:!1,dynamicMainBullets:1,formatFractionCurrent:y=>y,formatFractionTotal:y=>y,bulletClass:`${s}-bullet`,bulletActiveClass:`${s}-bullet-active`,modifierClass:`${s}-`,currentClass:`${s}-current`,totalClass:`${s}-total`,hiddenClass:`${s}-hidden`,progressbarFillClass:`${s}-progressbar-fill`,progressbarOppositeClass:`${s}-progressbar-opposite`,clickableClass:`${s}-clickable`,lockClass:`${s}-lock`,horizontalClass:`${s}-horizontal`,verticalClass:`${s}-vertical`,paginationDisabledClass:`${s}-disabled`}}),t.pagination={el:null,bullets:[]};let a,o=0;function l(){return!t.params.pagination.el||!t.pagination.el||Array.isArray(t.pagination.el)&&t.pagination.el.length===0}function c(y,x){const{bulletActiveClass:_}=t.params.pagination;y&&(y=y[`${x==="prev"?"previous":"next"}ElementSibling`],y&&(y.classList.add(`${_}-${x}`),y=y[`${x==="prev"?"previous":"next"}ElementSibling`],y&&y.classList.add(`${_}-${x}-${x}`)))}function u(y,x,_){if(y=y%_,x=x%_,x===y+1)return"next";if(x===y-1)return"previous"}function h(y){const x=y.target.closest(O1(t.params.pagination.bulletClass));if(!x)return;y.preventDefault();const _=dT(x)*t.params.slidesPerGroup;if(t.params.loop){if(t.realIndex===_)return;const M=u(t.realIndex,_,t.slides.length);M==="next"?t.slideNext():M==="previous"?t.slidePrev():t.slideToLoop(_)}else t.slideTo(_)}function d(){const y=t.rtl,x=t.params.pagination;if(l())return;let _=t.pagination.el;_=Ou(_);let M,S;const T=t.virtual&&t.params.virtual.enabled?t.virtual.slides.length:t.slides.length,E=t.params.loop?Math.ceil(T/t.params.slidesPerGroup):t.snapGrid.length;if(t.params.loop?(S=t.previousRealIndex||0,M=t.params.slidesPerGroup>1?Math.floor(t.realIndex/t.params.slidesPerGroup):t.realIndex):typeof t.snapIndex<"u"?(M=t.snapIndex,S=t.previousSnapIndex):(S=t.previousIndex||0,M=t.activeIndex||0),x.type==="bullets"&&t.pagination.bullets&&t.pagination.bullets.length>0){const C=t.pagination.bullets;let A,D,R;if(x.dynamicBullets&&(a=jB(C[0],t.isHorizontal()?"width":"height"),_.forEach(L=>{L.style[t.isHorizontal()?"width":"height"]=`${a*(x.dynamicMainBullets+4)}px`}),x.dynamicMainBullets>1&&S!==void 0&&(o+=M-(S||0),o>x.dynamicMainBullets-1?o=x.dynamicMainBullets-1:o<0&&(o=0)),A=Math.max(M-o,0),D=A+(Math.min(C.length,x.dynamicMainBullets)-1),R=(D+A)/2),C.forEach(L=>{const O=[...["","-next","-next-next","-prev","-prev-prev","-main"].map(H=>`${x.bulletActiveClass}${H}`)].map(H=>typeof H=="string"&&H.includes(" ")?H.split(" "):H).flat();L.classList.remove(...O)}),_.length>1)C.forEach(L=>{const O=dT(L);O===M?L.classList.add(...x.bulletActiveClass.split(" ")):t.isElement&&L.setAttribute("part","bullet"),x.dynamicBullets&&(O>=A&&O<=D&&L.classList.add(...`${x.bulletActiveClass}-main`.split(" ")),O===A&&c(L,"prev"),O===D&&c(L,"next"))});else{const L=C[M];if(L&&L.classList.add(...x.bulletActiveClass.split(" ")),t.isElement&&C.forEach((O,H)=>{O.setAttribute("part",H===M?"bullet-active":"bullet")}),x.dynamicBullets){const O=C[A],H=C[D];for(let j=A;j<=D;j+=1)C[j]&&C[j].classList.add(...`${x.bulletActiveClass}-main`.split(" "));c(O,"prev"),c(H,"next")}}if(x.dynamicBullets){const L=Math.min(C.length,x.dynamicMainBullets+4),O=(a*L-a)/2-R*a,H=y?"right":"left";C.forEach(j=>{j.style[t.isHorizontal()?H:"top"]=`${O}px`})}}_.forEach((C,A)=>{if(x.type==="fraction"&&(C.querySelectorAll(O1(x.currentClass)).forEach(D=>{D.textContent=x.formatFractionCurrent(M+1)}),C.querySelectorAll(O1(x.totalClass)).forEach(D=>{D.textContent=x.formatFractionTotal(E)})),x.type==="progressbar"){let D;x.progressbarOpposite?D=t.isHorizontal()?"vertical":"horizontal":D=t.isHorizontal()?"horizontal":"vertical";const R=(M+1)/E;let L=1,O=1;D==="horizontal"?L=R:O=R,C.querySelectorAll(O1(x.progressbarFillClass)).forEach(H=>{H.style.transform=`translate3d(0,0,0) scaleX(${L}) scaleY(${O})`,H.style.transitionDuration=`${t.params.speed}ms`})}x.type==="custom"&&x.renderCustom?(C.innerHTML=x.renderCustom(t,M+1,E),A===0&&n("paginationRender",C)):(A===0&&n("paginationRender",C),n("paginationUpdate",C)),t.params.watchOverflow&&t.enabled&&C.classList[t.isLocked?"add":"remove"](x.lockClass)})}function f(){const y=t.params.pagination;if(l())return;const x=t.virtual&&t.params.virtual.enabled?t.virtual.slides.length:t.grid&&t.params.grid.rows>1?t.slides.length/Math.ceil(t.params.grid.rows):t.slides.length;let _=t.pagination.el;_=Ou(_);let M="";if(y.type==="bullets"){let S=t.params.loop?Math.ceil(x/t.params.slidesPerGroup):t.snapGrid.length;t.params.freeMode&&t.params.freeMode.enabled&&S>x&&(S=x);for(let T=0;T<S;T+=1)y.renderBullet?M+=y.renderBullet.call(t,T,y.bulletClass):M+=`<${y.bulletElement} ${t.isElement?'part="bullet"':""} class="${y.bulletClass}"></${y.bulletElement}>`}y.type==="fraction"&&(y.renderFraction?M=y.renderFraction.call(t,y.currentClass,y.totalClass):M=`<span class="${y.currentClass}"></span> / <span class="${y.totalClass}"></span>`),y.type==="progressbar"&&(y.renderProgressbar?M=y.renderProgressbar.call(t,y.progressbarFillClass):M=`<span class="${y.progressbarFillClass}"></span>`),t.pagination.bullets=[],_.forEach(S=>{y.type!=="custom"&&(S.innerHTML=M||""),y.type==="bullets"&&t.pagination.bullets.push(...S.querySelectorAll(O1(y.bulletClass)))}),y.type!=="custom"&&n("paginationRender",_[0])}function p(){t.params.pagination=ZVe(t,t.originalParams.pagination,t.params.pagination,{el:"swiper-pagination"});const y=t.params.pagination;if(!y.el)return;let x;typeof y.el=="string"&&t.isElement&&(x=t.el.querySelector(y.el)),!x&&typeof y.el=="string"&&(x=[...document.querySelectorAll(y.el)]),x||(x=y.el),!(!x||x.length===0)&&(t.params.uniqueNavElements&&typeof y.el=="string"&&Array.isArray(x)&&x.length>1&&(x=[...t.el.querySelectorAll(y.el)],x.length>1&&(x=x.find(_=>Rre(_,".swiper")[0]===t.el))),Array.isArray(x)&&x.length===1&&(x=x[0]),Object.assign(t.pagination,{el:x}),x=Ou(x),x.forEach(_=>{y.type==="bullets"&&y.clickable&&_.classList.add(...(y.clickableClass||"").split(" ")),_.classList.add(y.modifierClass+y.type),_.classList.add(t.isHorizontal()?y.horizontalClass:y.verticalClass),y.type==="bullets"&&y.dynamicBullets&&(_.classList.add(`${y.modifierClass}${y.type}-dynamic`),o=0,y.dynamicMainBullets<1&&(y.dynamicMainBullets=1)),y.type==="progressbar"&&y.progressbarOpposite&&_.classList.add(y.progressbarOppositeClass),y.clickable&&_.addEventListener("click",h),t.enabled||_.classList.add(y.lockClass)}))}function v(){const y=t.params.pagination;if(l())return;let x=t.pagination.el;x&&(x=Ou(x),x.forEach(_=>{_.classList.remove(y.hiddenClass),_.classList.remove(y.modifierClass+y.type),_.classList.remove(t.isHorizontal()?y.horizontalClass:y.verticalClass),y.clickable&&(_.classList.remove(...(y.clickableClass||"").split(" ")),_.removeEventListener("click",h))})),t.pagination.bullets&&t.pagination.bullets.forEach(_=>_.classList.remove(...y.bulletActiveClass.split(" ")))}r("changeDirection",()=>{if(!t.pagination||!t.pagination.el)return;const y=t.params.pagination;let{el:x}=t.pagination;x=Ou(x),x.forEach(_=>{_.classList.remove(y.horizontalClass,y.verticalClass),_.classList.add(t.isHorizontal()?y.horizontalClass:y.verticalClass)})}),r("init",()=>{t.params.pagination.enabled===!1?g():(p(),f(),d())}),r("activeIndexChange",()=>{typeof t.snapIndex>"u"&&d()}),r("snapIndexChange",()=>{d()}),r("snapGridLengthChange",()=>{f(),d()}),r("destroy",()=>{v()}),r("enable disable",()=>{let{el:y}=t.pagination;y&&(y=Ou(y),y.forEach(x=>x.classList[t.enabled?"remove":"add"](t.params.pagination.lockClass)))}),r("lock unlock",()=>{d()}),r("click",(y,x)=>{const _=x.target,M=Ou(t.pagination.el);if(t.params.pagination.el&&t.params.pagination.hideOnClick&&M&&M.length>0&&!_.classList.contains(t.params.pagination.bulletClass)){if(t.navigation&&(t.navigation.nextEl&&_===t.navigation.nextEl||t.navigation.prevEl&&_===t.navigation.prevEl))return;const S=M[0].classList.contains(t.params.pagination.hiddenClass);n(S===!0?"paginationShow":"paginationHide"),M.forEach(T=>T.classList.toggle(t.params.pagination.hiddenClass))}});const m=()=>{t.el.classList.remove(t.params.pagination.paginationDisabledClass);let{el:y}=t.pagination;y&&(y=Ou(y),y.forEach(x=>x.classList.remove(t.params.pagination.paginationDisabledClass))),p(),f(),d()},g=()=>{t.el.classList.add(t.params.pagination.paginationDisabledClass);let{el:y}=t.pagination;y&&(y=Ou(y),y.forEach(x=>x.classList.add(t.params.pagination.paginationDisabledClass))),v()};Object.assign(t.pagination,{enable:m,disable:g,render:f,update:d,init:p,destroy:v})}function JVe(e){let{swiper:t,extendParams:i,on:r,emit:n,params:s}=e;t.autoplay={running:!1,paused:!1,timeLeft:0},i({autoplay:{enabled:!1,delay:3e3,waitForTransition:!0,disableOnInteraction:!1,stopOnLastSlide:!1,reverseDirection:!1,pauseOnMouseEnter:!1}});let a,o,l=s&&s.autoplay?s.autoplay.delay:3e3,c=s&&s.autoplay?s.autoplay.delay:3e3,u,h=new Date().getTime(),d,f,p,v,m,g,y;function x(z){!t||t.destroyed||!t.wrapperEl||z.target===t.wrapperEl&&(t.wrapperEl.removeEventListener("transitionend",x),!(y||z.detail&&z.detail.bySwiperTouchMove)&&A())}const _=()=>{if(t.destroyed||!t.autoplay.running)return;t.autoplay.paused?d=!0:d&&(c=u,d=!1);const z=t.autoplay.paused?u:h+c-new Date().getTime();t.autoplay.timeLeft=z,n("autoplayTimeLeft",z,z/l),o=requestAnimationFrame(()=>{_()})},M=()=>{let z;return t.virtual&&t.params.virtual.enabled?z=t.slides.find(U=>U.classList.contains("swiper-slide-active")):z=t.slides[t.activeIndex],z?parseInt(z.getAttribute("data-swiper-autoplay"),10):void 0},S=z=>{if(t.destroyed||!t.autoplay.running)return;cancelAnimationFrame(o),_();let V=typeof z>"u"?t.params.autoplay.delay:z;l=t.params.autoplay.delay,c=t.params.autoplay.delay;const U=M();!Number.isNaN(U)&&U>0&&typeof z>"u"&&(V=U,l=U,c=U),u=V;const k=t.params.speed,X=()=>{!t||t.destroyed||(t.params.autoplay.reverseDirection?!t.isBeginning||t.params.loop||t.params.rewind?(t.slidePrev(k,!0,!0),n("autoplay")):t.params.autoplay.stopOnLastSlide||(t.slideTo(t.slides.length-1,k,!0,!0),n("autoplay")):!t.isEnd||t.params.loop||t.params.rewind?(t.slideNext(k,!0,!0),n("autoplay")):t.params.autoplay.stopOnLastSlide||(t.slideTo(0,k,!0,!0),n("autoplay")),t.params.cssMode&&(h=new Date().getTime(),requestAnimationFrame(()=>{S()})))};return V>0?(clearTimeout(a),a=setTimeout(()=>{X()},V)):requestAnimationFrame(()=>{X()}),V},T=()=>{h=new Date().getTime(),t.autoplay.running=!0,S(),n("autoplayStart")},E=()=>{t.autoplay.running=!1,clearTimeout(a),cancelAnimationFrame(o),n("autoplayStop")},C=(z,V)=>{if(t.destroyed||!t.autoplay.running)return;clearTimeout(a),z||(g=!0);const U=()=>{n("autoplayPause"),t.params.autoplay.waitForTransition?t.wrapperEl.addEventListener("transitionend",x):A()};if(t.autoplay.paused=!0,V){m&&(u=t.params.autoplay.delay),m=!1,U();return}u=(u||t.params.autoplay.delay)-(new Date().getTime()-h),!(t.isEnd&&u<0&&!t.params.loop)&&(u<0&&(u=0),U())},A=()=>{t.isEnd&&u<0&&!t.params.loop||t.destroyed||!t.autoplay.running||(h=new Date().getTime(),g?(g=!1,S(u)):S(),t.autoplay.paused=!1,n("autoplayResume"))},D=()=>{if(t.destroyed||!t.autoplay.running)return;const z=iu();z.visibilityState==="hidden"&&(g=!0,C(!0)),z.visibilityState==="visible"&&A()},R=z=>{z.pointerType==="mouse"&&(g=!0,y=!0,!(t.animating||t.autoplay.paused)&&C(!0))},L=z=>{z.pointerType==="mouse"&&(y=!1,t.autoplay.paused&&A())},O=()=>{t.params.autoplay.pauseOnMouseEnter&&(t.el.addEventListener("pointerenter",R),t.el.addEventListener("pointerleave",L))},H=()=>{t.el&&typeof t.el!="string"&&(t.el.removeEventListener("pointerenter",R),t.el.removeEventListener("pointerleave",L))},j=()=>{iu().addEventListener("visibilitychange",D)},Y=()=>{iu().removeEventListener("visibilitychange",D)};r("init",()=>{t.params.autoplay.enabled&&(O(),j(),T())}),r("destroy",()=>{H(),Y(),t.autoplay.running&&E()}),r("_freeModeStaticRelease",()=>{(p||g)&&A()}),r("_freeModeNoMomentumRelease",()=>{t.params.autoplay.disableOnInteraction?E():C(!0,!0)}),r("beforeTransitionStart",(z,V,U)=>{t.destroyed||!t.autoplay.running||(U||!t.params.autoplay.disableOnInteraction?C(!0,!0):E())}),r("sliderFirstMove",()=>{if(!(t.destroyed||!t.autoplay.running)){if(t.params.autoplay.disableOnInteraction){E();return}f=!0,p=!1,g=!1,v=setTimeout(()=>{g=!0,p=!0,C(!0)},200)}}),r("touchEnd",()=>{if(!(t.destroyed||!t.autoplay.running||!f)){if(clearTimeout(v),clearTimeout(a),t.params.autoplay.disableOnInteraction){p=!1,f=!1;return}p&&t.params.cssMode&&A(),p=!1,f=!1}}),r("slideChange",()=>{t.destroyed||!t.autoplay.running||(m=!0)}),Object.assign(t.autoplay,{start:T,stop:E,pause:C,resume:A})}function $Ve(e){const{effect:t,swiper:i,on:r,setTranslate:n,setTransition:s,overwriteParams:a,perspective:o,recreateShadows:l,getEffectParams:c}=e;r("beforeInit",()=>{if(i.params.effect!==t)return;i.classNames.push(`${i.params.containerModifierClass}${t}`),o&&o()&&i.classNames.push(`${i.params.containerModifierClass}3d`);const h=a?a():{};Object.assign(i.params,h),Object.assign(i.originalParams,h)}),r("setTranslate",()=>{i.params.effect===t&&n()}),r("setTransition",(h,d)=>{i.params.effect===t&&s(d)}),r("transitionEnd",()=>{if(i.params.effect===t&&l){if(!c||!c().slideShadows)return;i.slides.forEach(h=>{h.querySelectorAll(".swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left").forEach(d=>d.remove())}),l()}});let u;r("virtualUpdate",()=>{i.params.effect===t&&(i.slides.length||(u=!0),requestAnimationFrame(()=>{u&&i.slides&&i.slides.length&&(n(),u=!1)}))})}function e6e(e,t){const i=I4(t);return i!==t&&(i.style.backfaceVisibility="hidden",i.style["-webkit-backface-visibility"]="hidden"),i}function nX(e,t,i){const r=`swiper-slide-shadow${i?`-${i}`:""}${` swiper-slide-shadow-${e}`}`,n=I4(t);let s=n.querySelector(`.${r.split(" ").join(".")}`);return s||(s=Kw("div",r.split(" ")),n.append(s)),s}function t6e(e){let{swiper:t,extendParams:i,on:r}=e;i({coverflowEffect:{rotate:50,stretch:0,depth:100,scale:1,modifier:1,slideShadows:!0}}),$Ve({effect:"coverflow",swiper:t,on:r,setTranslate:()=>{const{width:a,height:o,slides:l,slidesSizesGrid:c}=t,u=t.params.coverflowEffect,h=t.isHorizontal(),d=t.translate,f=h?-d+a/2:-d+o/2,p=h?u.rotate:-u.rotate,v=u.depth,m=R5e(t);for(let g=0,y=l.length;g<y;g+=1){const x=l[g],_=c[g],M=x.swiperSlideOffset,S=(f-M-_/2)/_,T=typeof u.modifier=="function"?u.modifier(S):S*u.modifier;let E=h?p*T:0,C=h?0:p*T,A=-v*Math.abs(T),D=u.stretch;typeof D=="string"&&D.indexOf("%")!==-1&&(D=parseFloat(u.stretch)/100*_);let R=h?0:D*T,L=h?D*T:0,O=1-(1-u.scale)*Math.abs(T);Math.abs(L)<.001&&(L=0),Math.abs(R)<.001&&(R=0),Math.abs(A)<.001&&(A=0),Math.abs(E)<.001&&(E=0),Math.abs(C)<.001&&(C=0),Math.abs(O)<.001&&(O=0);const H=`translate3d(${L}px,${R}px,${A}px)  rotateX(${m(C)}deg) rotateY(${m(E)}deg) scale(${O})`,j=e6e(u,x);if(j.style.transform=H,x.style.zIndex=-Math.abs(Math.round(T))+1,u.slideShadows){let Y=h?x.querySelector(".swiper-slide-shadow-left"):x.querySelector(".swiper-slide-shadow-top"),z=h?x.querySelector(".swiper-slide-shadow-right"):x.querySelector(".swiper-slide-shadow-bottom");Y||(Y=nX("coverflow",x,h?"left":"top")),z||(z=nX("coverflow",x,h?"right":"bottom")),Y&&(Y.style.opacity=T>0?T:0),z&&(z.style.opacity=-T>0?-T:0)}}},setTransition:a=>{t.slides.map(l=>I4(l)).forEach(l=>{l.style.transitionDuration=`${a}ms`,l.querySelectorAll(".swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left").forEach(c=>{c.style.transitionDuration=`${a}ms`})})},perspective:()=>!0,overwriteParams:()=>({watchSlidesProgress:!0})})}const i6e=[{title:"Food Delivery App",description:"A multi-restaurant food ordering platform with real-time order tracking.",tech:["Django","React.js","PostgreSQL"],features:["Multiple restaurant support","Real-time order tracking","Discount & coupon system","Secure payment integration"],live:"https://github.com/m0hammedsahal/restorant",code:"https://github.com/m0hammedsahal/restorant"},{title:"Blogging Platform",description:"A modern blogging site with rich text editing and engagement features.",tech:["Django","React.js","PostgreSQL"],features:["Rich text editor","Comment & Like system","SEO-optimized content","User authentication"],live:"https://github.com/m0hammedsahal/blogger",code:"https://github.com/m0hammedsahal/blogger"},{title:"Job Portal",description:"A job listing platform where users can find and post job opportunities.",tech:["Django","React.js","PostgreSQL"],features:["Job posting & application system","Resume upload & profile management","Search & filter job listings","Employer dashboard"],live:"https://github.com/m0hammedsahal/job-portal",code:"https://github.com/m0hammedsahal/job-portal"},{title:"Property Marketplace",description:"A real estate platform for buying, selling, and renting properties.",tech:["Django","React.js","PostgreSQL"],features:["Property listing & search","Renting & buying options","User reviews & ratings","Secure booking system"],live:"https://github.com/m0hammedsahal/renex-backent",code:"https://github.com/m0hammedsahal/renex-backent"},{title:"Mobile Sales E-commerce",description:"An online store for buying and selling smartphones with secure payment options.",tech:["Django","React.js","PostgreSQL"],features:["Product listing & filtering","Cart & checkout system","User authentication","Order history & tracking"],live:"",code:""},{title:"LuxuryBite",description:"An e-commerce platform for gourmet food products with a premium user experience.",tech:["Django","React.js","PostgreSQL"],features:["Gourmet product listings","Subscription-based purchases","Secure payment gateway","User reviews & ratings"],live:"https://github.com/m0hammedsahal/LuxuryBite",code:"https://github.com/m0hammedsahal/LuxuryBite"},{title:"Interior Design Website",description:"A showcase platform for an interior design company with project galleries and client testimonials.",tech:["Django","Tailwind CSS"],features:["Project portfolio showcase","Contact & inquiry forms","Client testimonials","Responsive design"],live:"https://m0hammedsahal.github.io/zain-interiour/",code:"https://github.com/m0hammedsahal/zain-interiour"},{title:"To-Do List App",description:"A simple task management app with an intuitive UI for managing daily tasks.",tech:["React.js"],features:["Add, edit & delete tasks","Task completion tracking","Local storage support","Minimalist UI"],live:"https://github.com/m0hammedsahal/To-Do-with-React",code:"https://github.com/m0hammedsahal/To-Do-with-React"},{title:"Amazon Clone",description:"A full-fledged e-commerce platform inspired by Amazon with user authentication and cart functionality.",tech:["Django","React.js","PostgreSQL"],features:["Product listings & categories","Shopping cart & checkout","Secure user authentication","Order history & tracking"],live:"https://github.com/m0hammedsahal/Amazone-clone-",code:""}],sX=()=>{const[e,t]=_e.useState(null),i=n=>{t(n)},r=()=>{t(null)};return Te.jsx(Mi.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},className:"text-center w-screen mt-24 bg-gray-600/10 pt-10 pb-5 relative overflow-hidden",children:Te.jsxs("div",{className:"relative z-10",children:[" ",Te.jsx("h2",{className:"text-3xl font-bold text-white mb-5",children:"Featured Projects"}),Te.jsx(jre,{effect:"coverflow",grabCursor:!0,centeredSlides:!0,slidesPerView:"auto",coverflowEffect:{rotate:15,stretch:0,depth:120,modifier:1,slideShadows:!0},pagination:{clickable:!0},autoplay:{delay:3e3,disableOnInteraction:!1},modules:[t6e,KVe,JVe],className:"w-full py-10",children:i6e.map((n,s)=>Te.jsx(Wre,{className:"w-64 md:w-80",children:Te.jsxs(Mi.div,{initial:{opacity:0,y:20,scale:.9},whileInView:{opacity:1,y:0,scale:1},whileHover:{scale:1.05,rotate:2,boxShadow:"0px 10px 30px rgba(255, 200, 0, 0.3)"},transition:{duration:.5,delay:s*.2,type:"spring",stiffness:150},viewport:{once:!0},className:"backdrop-blur-md p-4 rounded-lg shadow-lg hover:shadow-xl transition-all transform cursor-pointer",onClick:()=>i(n),children:[Te.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:n.title}),Te.jsx("p",{className:"text-gray-300 text-sm mb-3",children:n.description}),Te.jsxs("div",{className:"mb-3",children:[Te.jsx("h4",{className:"text-[#FF4500] font-semibold mb-1 text-sm",children:"Key Features:"}),Te.jsx("ul",{className:"list-disc list-inside text-gray-300 text-xs",children:n.features.map((a,o)=>Te.jsx("li",{className:"mb-1",children:a},o))})]}),Te.jsx("div",{className:"flex flex-wrap gap-2 justify-center",children:n.tech.map((a,o)=>Te.jsx("span",{className:"px-2 py-1 bg-yellow-900/50 text-[#DAA520] rounded-full text-xs",children:a},o))}),Te.jsxs("div",{className:"mt-3 flex space-x-4 justify-center",children:[Te.jsxs("a",{href:n.code,className:"text-[#FF4500] hover:text-[#DAA520] flex items-center text-sm",onClick:a=>a.stopPropagation(),children:[Te.jsx(iA,{className:"w-4 h-4 mr-1"})," Code"]}),Te.jsxs("a",{href:n.live,className:"text-[#FF4500] hover:text-[#DAA520] flex items-center text-sm",onClick:a=>a.stopPropagation(),children:[Te.jsx(LG,{className:"w-4 h-4 mr-1"})," Live Demo"]})]})]})},s))}),Te.jsx(vU,{children:e&&Te.jsx(Mi.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},transition:{type:"spring",stiffness:100},className:"fixed inset-0 flex items-center justify-center bg-black/90 backdrop-blur-md z-50 p-6",onClick:r,children:Te.jsxs(Mi.div,{initial:{y:-50,opacity:0,rotateX:45},animate:{y:0,opacity:1,rotateX:0},exit:{y:-50,opacity:0,rotateX:45},transition:{delay:.2,type:"spring",stiffness:100},className:"bg-gray-800 rounded-lg p-8 max-w-3xl w-full relative",onClick:n=>n.stopPropagation(),children:[Te.jsx("button",{onClick:r,className:"absolute top-4 right-4 text-gray-300 hover:text-[#FF4500]",children:""}),Te.jsx("h3",{className:"text-2xl font-bold text-white mb-4",children:e.title}),Te.jsx("p",{className:"text-gray-300 mb-6",children:e.description}),Te.jsxs("div",{className:"mb-6",children:[Te.jsx("h4",{className:"text-[#FF4500] font-semibold mb-2 text-lg",children:"Key Features:"}),Te.jsx("ul",{className:"list-disc list-inside text-gray-300",children:e.features.map((n,s)=>Te.jsx("li",{className:"mb-2",children:n},s))})]}),Te.jsx("div",{className:"flex flex-wrap gap-2 mb-6",children:e.tech.map((n,s)=>Te.jsx("span",{className:"px-3 py-1 bg-yellow-900/50 text-[#DAA520] rounded-full text-sm",children:n},s))}),Te.jsxs("div",{className:"flex space-x-4",children:[Te.jsxs("a",{href:e.code,className:"text-[#FF4500] hover:text-[#DAA520] flex items-center text-sm",children:[Te.jsx(iA,{className:"w-5 h-5 mr-1"})," View Code"]}),Te.jsxs("a",{href:e.live,className:"text-[#FF4500] hover:text-[#DAA520] flex items-center text-sm",children:[Te.jsx(LG,{className:"w-5 h-5 mr-1"})," Live Demo"]})]})]})})})]})})},aX=()=>{const[e,t]=_e.useState(!1),i=r=>{r.preventDefault(),t(!0)};return Te.jsxs(Mi.div,{initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},transition:{duration:.4,ease:"easeOut"},viewport:{once:!0},className:"relative py-20 mt-20 mx-5",children:[Te.jsxs(Mi.div,{initial:{opacity:0,y:30,scale:.98},whileInView:{opacity:1,y:0,scale:1},transition:{duration:.4,delay:.1,ease:"easeOut"},className:"bg-gray-900/20 backdrop-blur-lg p-8 rounded-2xl shadow-2xl text-gray-300 max-w-3xl mx-auto px-10 border border-gray-800/20 relative overflow-hidden",children:[Te.jsx(Mi.div,{initial:{opacity:0,scale:.95},whileInView:{opacity:1,scale:1},transition:{duration:.4,delay:.2,ease:"easeOut"},className:"absolute inset-0 bg-gradient-to-r from-yellow-600/10 to-orange-500/10 rounded-2xl -z-10"}),Te.jsx(Mi.h2,{initial:{opacity:0,y:10},whileInView:{opacity:1,y:0},transition:{duration:.4,delay:.2,ease:"easeOut"},className:"text-3xl font-bold text-white mb-4 text-center",children:" Get in Touch"}),Te.jsx(Mi.p,{initial:{opacity:0,y:10},whileInView:{opacity:1,y:0},transition:{duration:.4,delay:.3,ease:"easeOut"},className:"text-gray-400 text-lg text-center mb-6",children:"Have a question or want to collaborate? Drop me a message!"}),Te.jsxs("form",{onSubmit:i,className:"space-y-4",children:[Te.jsx(Mi.div,{initial:{opacity:0,y:10},whileInView:{opacity:1,y:0},transition:{duration:.4,delay:.4,ease:"easeOut"},whileHover:{scale:1.01},className:"relative",children:Te.jsx("input",{required:!0,type:"text",placeholder:"Your Name",className:"w-full p-3 rounded-lg bg-gray-800/50 text-gray-300 focus:ring-2 focus:ring-yellow-500 outline-none border border-gray-700/50 transition-all"})}),Te.jsx(Mi.div,{initial:{opacity:0,y:10},whileInView:{opacity:1,y:0},transition:{duration:.4,delay:.5,ease:"easeOut"},whileHover:{scale:1.01},className:"relative",children:Te.jsx("input",{required:!0,type:"email",placeholder:"Your Email",className:"w-full p-3 rounded-lg bg-gray-800/50 text-gray-300 focus:ring-2 focus:ring-yellow-500 outline-none border border-gray-700/50 transition-all"})}),Te.jsx(Mi.div,{initial:{opacity:0,y:10},whileInView:{opacity:1,y:0},transition:{duration:.4,delay:.6,ease:"easeOut"},whileHover:{scale:1.01},className:"relative",children:Te.jsx("textarea",{required:!0,placeholder:"Your Message",rows:"4",className:"w-full p-3 rounded-lg bg-gray-800/50 text-gray-300 focus:ring-2 focus:ring-yellow-500 outline-none border border-gray-700/50 transition-all"})}),Te.jsx(Mi.div,{initial:{opacity:0,y:10},whileInView:{opacity:1,y:0},transition:{duration:.4,delay:.7,ease:"easeOut"},whileHover:{scale:1.02},className:"relative",children:Te.jsx("button",{type:"submit",className:"w-full bg-gradient-to-r from-yellow-600 to-orange-500 hover:from-yellow-500 hover:to-orange-400 text-white font-bold py-3 rounded-lg transition-all",children:"Send Message"})})]})]}),Te.jsx(Mi.div,{initial:{opacity:0},whileInView:{opacity:1},transition:{duration:.4,delay:.2,ease:"easeOut"},className:"absolute inset-0 bg-gradient-to-r from-yellow-600/10 to-orange-500/10 blur-3xl -z-10"}),Te.jsx(vU,{children:e&&Te.jsx(Mi.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.3,ease:"easeOut"},className:"fixed inset-0 flex items-center justify-center bg-black/50 backdrop-blur-md z-50",children:Te.jsxs(Mi.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3,delay:.1,ease:"easeOut"},className:"bg-gray-900/80 backdrop-blur-lg p-8 rounded-2xl shadow-2xl text-center",children:[Te.jsx("h2",{className:"text-3xl font-bold text-white mb-4",children:" Thank You!"}),Te.jsx("p",{className:"text-gray-300 text-lg mb-6",children:"Your message has been sent successfully. I'll get back to you soon!"}),Te.jsx("button",{onClick:()=>t(!1),className:"bg-gradient-to-r from-yellow-600 to-orange-500 hover:from-yellow-500 hover:to-orange-400 text-white font-bold py-2 px-6 rounded-lg transition-all",children:"Close"})]})})})]})},r6e=()=>Te.jsx(Mi.footer,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:1},className:"bg-gray-900/50 backdrop-blur-md shadow-lg text-gray-300 mt-12 py-6",children:Te.jsxs("div",{className:"container mx-auto text-center",children:[Te.jsx("h2",{className:"text-lg font-semibold text-[#FF4500]",children:"Let's Connect"}),Te.jsx("p",{className:"mt-2 text-sm text-gray-400",children:"Feel free to reach out for collaborations or just a chat!"}),Te.jsxs("div",{className:"mt-4 flex justify-center space-x-6",children:[Te.jsx("a",{href:"https://github.com/m0hammedsahal",target:"_blank",rel:"noopener noreferrer",className:"text-[#FF4500] hover:text-[#DAA520] transition",children:Te.jsx(iA,{className:"w-5 h-5"})}),Te.jsx("a",{href:"https://www.linkedin.com/in/mhd-sahal-5a9b0128a/",target:"_blank",rel:"noopener noreferrer",className:"text-[#FF4500] hover:text-[#DAA520] transition",children:Te.jsx(yJ,{className:"w-5 h-5"})}),Te.jsx("a",{href:"mailto:sahald369@gmail.com",className:"text-[#FF4500] hover:text-[#DAA520] transition",children:Te.jsx(xJ,{className:"w-5 h-5"})})]}),Te.jsxs("nav",{className:"mt-4 flex justify-center space-x-6 text-sm",children:[Te.jsx(oh,{to:"/",className:"hover:text-[#FF4500] transition",children:"Home"}),Te.jsx(oh,{to:"/about",className:"hover:text-[#FF4500] transition",children:"About"}),Te.jsx(oh,{to:"/portfolio",className:"hover:text-[#FF4500] transition",children:"Portfolio"}),Te.jsx(oh,{to:"/contact",className:"hover:text-[#FF4500] transition",children:"Contact"})]}),Te.jsxs("p",{className:"mt-4 text-xs text-gray-500",children:[" ",new Date().getFullYear()," Sahal. All rights reserved."]})]})});/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const JC="174",Cp={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},Pp={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},Xre=0,qB=1,qre=2,n6e=3,Yre=0,$C=1,Xx=2,Gl=3,Lh=0,La=1,Ql=2,wh=0,hm=1,YB=2,QB=3,ZB=4,Qre=5,Od=100,Zre=101,Kre=102,Jre=103,$re=104,ene=200,tne=201,ine=202,rne=203,pT=204,mT=205,nne=206,sne=207,ane=208,one=209,lne=210,cne=211,une=212,hne=213,dne=214,gT=0,vT=1,yT=2,Im=3,xT=4,wT=5,bT=6,_T=7,jb=0,fne=1,pne=2,ru=0,mne=1,gne=2,vne=3,O4=4,yne=5,xne=6,wne=7,KB="attached",bne="detached",eP=300,Oh=301,wf=302,Jw=303,$w=304,by=306,eb=1e3,pl=1001,tb=1002,Fs=1003,z4=1004,s6e=1004,Qv=1005,a6e=1005,pn=1006,qx=1007,o6e=1007,qc=1008,l6e=1008,lc=1009,B4=1010,F4=1011,q0=1012,tP=1013,zh=1014,so=1015,_y=1016,iP=1017,rP=1018,Lm=1020,U4=35902,N4=1021,k4=1022,sa=1023,V4=1024,G4=1025,dm=1026,Om=1027,nP=1028,Wb=1029,H4=1030,sP=1031,c6e=1032,aP=1033,Yx=33776,Qx=33777,Zx=33778,Kx=33779,ST=35840,MT=35841,ET=35842,AT=35843,TT=36196,CT=37492,PT=37496,DT=37808,RT=37809,IT=37810,LT=37811,OT=37812,zT=37813,BT=37814,FT=37815,UT=37816,NT=37817,kT=37818,VT=37819,GT=37820,HT=37821,Jx=36492,jT=36494,WT=36495,j4=36283,XT=36284,qT=36285,YT=36286,_ne=2200,Sne=2201,Mne=2202,ib=2300,QT=2301,g2=2302,Jp=2400,$p=2401,rb=2402,oP=2500,W4=2501,u6e=0,h6e=1,d6e=2,Ene=3200,X4=3201,f6e=3202,p6e=3203,Rf=0,Ane=1,rh="",Qa="srgb",zm="srgb-linear",nb="linear",sr="srgb",m6e=0,Dp=7680,g6e=7681,v6e=7682,y6e=7683,x6e=34055,w6e=34056,b6e=5386,_6e=512,S6e=513,M6e=514,E6e=515,A6e=516,T6e=517,C6e=518,JB=519,Tne=512,Cne=513,Pne=514,q4=515,Dne=516,Rne=517,Ine=518,Lne=519,sb=35044,P6e=35048,D6e=35040,R6e=35045,I6e=35049,L6e=35041,O6e=35046,z6e=35050,B6e=35042,F6e="100",$B="300 es",$l=2e3,ab=2001,U6e={COMPUTE:"compute",RENDER:"render"};let pu=class{addEventListener(t,i){this._listeners===void 0&&(this._listeners={});const r=this._listeners;r[t]===void 0&&(r[t]=[]),r[t].indexOf(i)===-1&&r[t].push(i)}hasEventListener(t,i){const r=this._listeners;return r===void 0?!1:r[t]!==void 0&&r[t].indexOf(i)!==-1}removeEventListener(t,i){const r=this._listeners;if(r===void 0)return;const n=r[t];if(n!==void 0){const s=n.indexOf(i);s!==-1&&n.splice(s,1)}}dispatchEvent(t){const i=this._listeners;if(i===void 0)return;const r=i[t.type];if(r!==void 0){t.target=this;const n=r.slice(0);for(let s=0,a=n.length;s<a;s++)n[s].call(this,t);t.target=null}}};const Zs=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let oX=1234567;const fm=Math.PI/180,Y0=180/Math.PI;function Lo(){const e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,i=Math.random()*4294967295|0,r=Math.random()*4294967295|0;return(Zs[e&255]+Zs[e>>8&255]+Zs[e>>16&255]+Zs[e>>24&255]+"-"+Zs[t&255]+Zs[t>>8&255]+"-"+Zs[t>>16&15|64]+Zs[t>>24&255]+"-"+Zs[i&63|128]+Zs[i>>8&255]+"-"+Zs[i>>16&255]+Zs[i>>24&255]+Zs[r&255]+Zs[r>>8&255]+Zs[r>>16&255]+Zs[r>>24&255]).toLowerCase()}function wi(e,t,i){return Math.max(t,Math.min(i,e))}function Y4(e,t){return(e%t+t)%t}function N6e(e,t,i,r,n){return r+(e-t)*(n-r)/(i-t)}function k6e(e,t,i){return e!==t?(i-e)/(t-e):0}function $x(e,t,i){return(1-i)*e+i*t}function V6e(e,t,i,r){return $x(e,t,1-Math.exp(-i*r))}function G6e(e,t=1){return t-Math.abs(Y4(e,t*2)-t)}function H6e(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t),e*e*(3-2*e))}function j6e(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t),e*e*e*(e*(e*6-15)+10))}function W6e(e,t){return e+Math.floor(Math.random()*(t-e+1))}function X6e(e,t){return e+Math.random()*(t-e)}function q6e(e){return e*(.5-Math.random())}function Y6e(e){e!==void 0&&(oX=e);let t=oX+=1831565813;return t=Math.imul(t^t>>>15,t|1),t^=t+Math.imul(t^t>>>7,t|61),((t^t>>>14)>>>0)/4294967296}function Q6e(e){return e*fm}function Z6e(e){return e*Y0}function K6e(e){return(e&e-1)===0&&e!==0}function J6e(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function $6e(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}function eGe(e,t,i,r,n){const s=Math.cos,a=Math.sin,o=s(i/2),l=a(i/2),c=s((t+r)/2),u=a((t+r)/2),h=s((t-r)/2),d=a((t-r)/2),f=s((r-t)/2),p=a((r-t)/2);switch(n){case"XYX":e.set(o*u,l*h,l*d,o*c);break;case"YZY":e.set(l*d,o*u,l*h,o*c);break;case"ZXZ":e.set(l*h,l*d,o*u,o*c);break;case"XZX":e.set(o*u,l*p,l*f,o*c);break;case"YXY":e.set(l*f,o*u,l*p,o*c);break;case"ZYZ":e.set(l*p,l*f,o*u,o*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+n)}}function Pa(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return e/4294967295;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int32Array:return Math.max(e/2147483647,-1);case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}function Ti(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return Math.round(e*4294967295);case Uint16Array:return Math.round(e*65535);case Uint8Array:return Math.round(e*255);case Int32Array:return Math.round(e*2147483647);case Int16Array:return Math.round(e*32767);case Int8Array:return Math.round(e*127);default:throw new Error("Invalid component type.")}}const v2={DEG2RAD:fm,RAD2DEG:Y0,generateUUID:Lo,clamp:wi,euclideanModulo:Y4,mapLinear:N6e,inverseLerp:k6e,lerp:$x,damp:V6e,pingpong:G6e,smoothstep:H6e,smootherstep:j6e,randInt:W6e,randFloat:X6e,randFloatSpread:q6e,seededRandom:Y6e,degToRad:Q6e,radToDeg:Z6e,isPowerOfTwo:K6e,ceilPowerOfTwo:J6e,floorPowerOfTwo:$6e,setQuaternionFromProperEuler:eGe,normalize:Ti,denormalize:Pa};class ut{constructor(t=0,i=0){ut.prototype.isVector2=!0,this.x=t,this.y=i}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,i){return this.x=t,this.y=i,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,i){switch(t){case 0:this.x=i;break;case 1:this.y=i;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this}addScaledVector(t,i){return this.x+=t.x*i,this.y+=t.y*i,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const i=this.x,r=this.y,n=t.elements;return this.x=n[0]*i+n[3]*r+n[6],this.y=n[1]*i+n[4]*r+n[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,i){return this.x=wi(this.x,t.x,i.x),this.y=wi(this.y,t.y,i.y),this}clampScalar(t,i){return this.x=wi(this.x,t,i),this.y=wi(this.y,t,i),this}clampLength(t,i){const r=this.length();return this.divideScalar(r||1).multiplyScalar(wi(r,t,i))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const i=Math.sqrt(this.lengthSq()*t.lengthSq());if(i===0)return Math.PI/2;const r=this.dot(t)/i;return Math.acos(wi(r,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const i=this.x-t.x,r=this.y-t.y;return i*i+r*r}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this}lerpVectors(t,i,r){return this.x=t.x+(i.x-t.x)*r,this.y=t.y+(i.y-t.y)*r,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,i=0){return this.x=t[i],this.y=t[i+1],this}toArray(t=[],i=0){return t[i]=this.x,t[i+1]=this.y,t}fromBufferAttribute(t,i){return this.x=t.getX(i),this.y=t.getY(i),this}rotateAround(t,i){const r=Math.cos(i),n=Math.sin(i),s=this.x-t.x,a=this.y-t.y;return this.x=s*r-a*n+t.x,this.y=s*n+a*r+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class xi{constructor(t,i,r,n,s,a,o,l,c){xi.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],t!==void 0&&this.set(t,i,r,n,s,a,o,l,c)}set(t,i,r,n,s,a,o,l,c){const u=this.elements;return u[0]=t,u[1]=n,u[2]=o,u[3]=i,u[4]=s,u[5]=l,u[6]=r,u[7]=a,u[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const i=this.elements,r=t.elements;return i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[3],i[4]=r[4],i[5]=r[5],i[6]=r[6],i[7]=r[7],i[8]=r[8],this}extractBasis(t,i,r){return t.setFromMatrix3Column(this,0),i.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const i=t.elements;return this.set(i[0],i[4],i[8],i[1],i[5],i[9],i[2],i[6],i[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,i){const r=t.elements,n=i.elements,s=this.elements,a=r[0],o=r[3],l=r[6],c=r[1],u=r[4],h=r[7],d=r[2],f=r[5],p=r[8],v=n[0],m=n[3],g=n[6],y=n[1],x=n[4],_=n[7],M=n[2],S=n[5],T=n[8];return s[0]=a*v+o*y+l*M,s[3]=a*m+o*x+l*S,s[6]=a*g+o*_+l*T,s[1]=c*v+u*y+h*M,s[4]=c*m+u*x+h*S,s[7]=c*g+u*_+h*T,s[2]=d*v+f*y+p*M,s[5]=d*m+f*x+p*S,s[8]=d*g+f*_+p*T,this}multiplyScalar(t){const i=this.elements;return i[0]*=t,i[3]*=t,i[6]*=t,i[1]*=t,i[4]*=t,i[7]*=t,i[2]*=t,i[5]*=t,i[8]*=t,this}determinant(){const t=this.elements,i=t[0],r=t[1],n=t[2],s=t[3],a=t[4],o=t[5],l=t[6],c=t[7],u=t[8];return i*a*u-i*o*c-r*s*u+r*o*l+n*s*c-n*a*l}invert(){const t=this.elements,i=t[0],r=t[1],n=t[2],s=t[3],a=t[4],o=t[5],l=t[6],c=t[7],u=t[8],h=u*a-o*c,d=o*l-u*s,f=c*s-a*l,p=i*h+r*d+n*f;if(p===0)return this.set(0,0,0,0,0,0,0,0,0);const v=1/p;return t[0]=h*v,t[1]=(n*c-u*r)*v,t[2]=(o*r-n*a)*v,t[3]=d*v,t[4]=(u*i-n*l)*v,t[5]=(n*s-o*i)*v,t[6]=f*v,t[7]=(r*l-c*i)*v,t[8]=(a*i-r*s)*v,this}transpose(){let t;const i=this.elements;return t=i[1],i[1]=i[3],i[3]=t,t=i[2],i[2]=i[6],i[6]=t,t=i[5],i[5]=i[7],i[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const i=this.elements;return t[0]=i[0],t[1]=i[3],t[2]=i[6],t[3]=i[1],t[4]=i[4],t[5]=i[7],t[6]=i[2],t[7]=i[5],t[8]=i[8],this}setUvTransform(t,i,r,n,s,a,o){const l=Math.cos(s),c=Math.sin(s);return this.set(r*l,r*c,-r*(l*a+c*o)+a+t,-n*c,n*l,-n*(-c*a+l*o)+o+i,0,0,1),this}scale(t,i){return this.premultiply(TI.makeScale(t,i)),this}rotate(t){return this.premultiply(TI.makeRotation(-t)),this}translate(t,i){return this.premultiply(TI.makeTranslation(t,i)),this}makeTranslation(t,i){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,i,0,0,1),this}makeRotation(t){const i=Math.cos(t),r=Math.sin(t);return this.set(i,-r,0,r,i,0,0,0,1),this}makeScale(t,i){return this.set(t,0,0,0,i,0,0,0,1),this}equals(t){const i=this.elements,r=t.elements;for(let n=0;n<9;n++)if(i[n]!==r[n])return!1;return!0}fromArray(t,i=0){for(let r=0;r<9;r++)this.elements[r]=t[r+i];return this}toArray(t=[],i=0){const r=this.elements;return t[i]=r[0],t[i+1]=r[1],t[i+2]=r[2],t[i+3]=r[3],t[i+4]=r[4],t[i+5]=r[5],t[i+6]=r[6],t[i+7]=r[7],t[i+8]=r[8],t}clone(){return new this.constructor().fromArray(this.elements)}}const TI=new xi;function One(e){for(let t=e.length-1;t>=0;--t)if(e[t]>=65535)return!0;return!1}const tGe={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function Zv(e,t){return new tGe[e](t)}function ob(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function zne(){const e=ob("canvas");return e.style.display="block",e}const lX={};function Rp(e){e in lX||(lX[e]=!0,console.warn(e))}function iGe(e,t,i){return new Promise(function(r,n){function s(){switch(e.clientWaitSync(t,e.SYNC_FLUSH_COMMANDS_BIT,0)){case e.WAIT_FAILED:n();break;case e.TIMEOUT_EXPIRED:setTimeout(s,i);break;default:r()}}setTimeout(s,i)})}function rGe(e){const t=e.elements;t[2]=.5*t[2]+.5*t[3],t[6]=.5*t[6]+.5*t[7],t[10]=.5*t[10]+.5*t[11],t[14]=.5*t[14]+.5*t[15]}function nGe(e){const t=e.elements;t[11]===-1?(t[10]=-t[10]-1,t[14]=-t[14]):(t[10]=-t[10],t[14]=-t[14]+1)}const cX=new xi().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),uX=new xi().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function sGe(){const e={enabled:!0,workingColorSpace:zm,spaces:{},convert:function(n,s,a){return this.enabled===!1||s===a||!s||!a||(this.spaces[s].transfer===sr&&(n.r=bh(n.r),n.g=bh(n.g),n.b=bh(n.b)),this.spaces[s].primaries!==this.spaces[a].primaries&&(n.applyMatrix3(this.spaces[s].toXYZ),n.applyMatrix3(this.spaces[a].fromXYZ)),this.spaces[a].transfer===sr&&(n.r=b0(n.r),n.g=b0(n.g),n.b=b0(n.b))),n},fromWorkingColorSpace:function(n,s){return this.convert(n,this.workingColorSpace,s)},toWorkingColorSpace:function(n,s){return this.convert(n,s,this.workingColorSpace)},getPrimaries:function(n){return this.spaces[n].primaries},getTransfer:function(n){return n===rh?nb:this.spaces[n].transfer},getLuminanceCoefficients:function(n,s=this.workingColorSpace){return n.fromArray(this.spaces[s].luminanceCoefficients)},define:function(n){Object.assign(this.spaces,n)},_getMatrix:function(n,s,a){return n.copy(this.spaces[s].toXYZ).multiply(this.spaces[a].fromXYZ)},_getDrawingBufferColorSpace:function(n){return this.spaces[n].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(n=this.workingColorSpace){return this.spaces[n].workingColorSpaceConfig.unpackColorSpace}},t=[.64,.33,.3,.6,.15,.06],i=[.2126,.7152,.0722],r=[.3127,.329];return e.define({[zm]:{primaries:t,whitePoint:r,transfer:nb,toXYZ:cX,fromXYZ:uX,luminanceCoefficients:i,workingColorSpaceConfig:{unpackColorSpace:Qa},outputColorSpaceConfig:{drawingBufferColorSpace:Qa}},[Qa]:{primaries:t,whitePoint:r,transfer:sr,toXYZ:cX,fromXYZ:uX,luminanceCoefficients:i,outputColorSpaceConfig:{drawingBufferColorSpace:Qa}}}),e}const Xi=sGe();function bh(e){return e<.04045?e*.0773993808:Math.pow(e*.9478672986+.0521327014,2.4)}function b0(e){return e<.0031308?e*12.92:1.055*Math.pow(e,.41666)-.055}let Yg;class Bne{static getDataURL(t){if(/^data:/i.test(t.src)||typeof HTMLCanvasElement>"u")return t.src;let i;if(t instanceof HTMLCanvasElement)i=t;else{Yg===void 0&&(Yg=ob("canvas")),Yg.width=t.width,Yg.height=t.height;const r=Yg.getContext("2d");t instanceof ImageData?r.putImageData(t,0,0):r.drawImage(t,0,0,t.width,t.height),i=Yg}return i.toDataURL("image/png")}static sRGBToLinear(t){if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap){const i=ob("canvas");i.width=t.width,i.height=t.height;const r=i.getContext("2d");r.drawImage(t,0,0,t.width,t.height);const n=r.getImageData(0,0,t.width,t.height),s=n.data;for(let a=0;a<s.length;a++)s[a]=bh(s[a]/255)*255;return r.putImageData(n,0,0),i}else if(t.data){const i=t.data.slice(0);for(let r=0;r<i.length;r++)i instanceof Uint8Array||i instanceof Uint8ClampedArray?i[r]=Math.floor(bh(i[r]/255)*255):i[r]=bh(i[r]);return{data:i,width:t.width,height:t.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}}let aGe=0;class Yd{constructor(t=null){this.isSource=!0,Object.defineProperty(this,"id",{value:aGe++}),this.uuid=Lo(),this.data=t,this.dataReady=!0,this.version=0}set needsUpdate(t){t===!0&&this.version++}toJSON(t){const i=t===void 0||typeof t=="string";if(!i&&t.images[this.uuid]!==void 0)return t.images[this.uuid];const r={uuid:this.uuid,url:""},n=this.data;if(n!==null){let s;if(Array.isArray(n)){s=[];for(let a=0,o=n.length;a<o;a++)n[a].isDataTexture?s.push(CI(n[a].image)):s.push(CI(n[a]))}else s=CI(n);r.url=s}return i||(t.images[this.uuid]=r),r}}function CI(e){return typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap?Bne.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let oGe=0;class Wr extends pu{constructor(t=Wr.DEFAULT_IMAGE,i=Wr.DEFAULT_MAPPING,r=pl,n=pl,s=pn,a=qc,o=sa,l=lc,c=Wr.DEFAULT_ANISOTROPY,u=rh){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:oGe++}),this.uuid=Lo(),this.name="",this.source=new Yd(t),this.mipmaps=[],this.mapping=i,this.channel=0,this.wrapS=r,this.wrapT=n,this.magFilter=s,this.minFilter=a,this.anisotropy=c,this.format=o,this.internalFormat=null,this.type=l,this.offset=new ut(0,0),this.repeat=new ut(1,1),this.center=new ut(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new xi,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=u,this.userData={},this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(t=null){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.colorSpace=t.colorSpace,this.renderTarget=t.renderTarget,this.isRenderTargetTexture=t.isRenderTargetTexture,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){const i=t===void 0||typeof t=="string";if(!i&&t.textures[this.uuid]!==void 0)return t.textures[this.uuid];const r={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(r.userData=this.userData),i||(t.textures[this.uuid]=r),r}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==eP)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case eb:t.x=t.x-Math.floor(t.x);break;case pl:t.x=t.x<0?0:1;break;case tb:Math.abs(Math.floor(t.x)%2)===1?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x);break}if(t.y<0||t.y>1)switch(this.wrapT){case eb:t.y=t.y-Math.floor(t.y);break;case pl:t.y=t.y<0?0:1;break;case tb:Math.abs(Math.floor(t.y)%2)===1?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y);break}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){t===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(t){t===!0&&this.pmremVersion++}}Wr.DEFAULT_IMAGE=null;Wr.DEFAULT_MAPPING=eP;Wr.DEFAULT_ANISOTROPY=1;class Hi{constructor(t=0,i=0,r=0,n=1){Hi.prototype.isVector4=!0,this.x=t,this.y=i,this.z=r,this.w=n}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,i,r,n){return this.x=t,this.y=i,this.z=r,this.w=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,i){switch(t){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;case 3:this.w=i;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w!==void 0?t.w:1,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this.w=t.w+i.w,this}addScaledVector(t,i){return this.x+=t.x*i,this.y+=t.y*i,this.z+=t.z*i,this.w+=t.w*i,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this.w=t.w-i.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const i=this.x,r=this.y,n=this.z,s=this.w,a=t.elements;return this.x=a[0]*i+a[4]*r+a[8]*n+a[12]*s,this.y=a[1]*i+a[5]*r+a[9]*n+a[13]*s,this.z=a[2]*i+a[6]*r+a[10]*n+a[14]*s,this.w=a[3]*i+a[7]*r+a[11]*n+a[15]*s,this}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this.w/=t.w,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const i=Math.sqrt(1-t.w*t.w);return i<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/i,this.y=t.y/i,this.z=t.z/i),this}setAxisAngleFromRotationMatrix(t){let i,r,n,s;const l=t.elements,c=l[0],u=l[4],h=l[8],d=l[1],f=l[5],p=l[9],v=l[2],m=l[6],g=l[10];if(Math.abs(u-d)<.01&&Math.abs(h-v)<.01&&Math.abs(p-m)<.01){if(Math.abs(u+d)<.1&&Math.abs(h+v)<.1&&Math.abs(p+m)<.1&&Math.abs(c+f+g-3)<.1)return this.set(1,0,0,0),this;i=Math.PI;const x=(c+1)/2,_=(f+1)/2,M=(g+1)/2,S=(u+d)/4,T=(h+v)/4,E=(p+m)/4;return x>_&&x>M?x<.01?(r=0,n=.707106781,s=.707106781):(r=Math.sqrt(x),n=S/r,s=T/r):_>M?_<.01?(r=.707106781,n=0,s=.707106781):(n=Math.sqrt(_),r=S/n,s=E/n):M<.01?(r=.707106781,n=.707106781,s=0):(s=Math.sqrt(M),r=T/s,n=E/s),this.set(r,n,s,i),this}let y=Math.sqrt((m-p)*(m-p)+(h-v)*(h-v)+(d-u)*(d-u));return Math.abs(y)<.001&&(y=1),this.x=(m-p)/y,this.y=(h-v)/y,this.z=(d-u)/y,this.w=Math.acos((c+f+g-1)/2),this}setFromMatrixPosition(t){const i=t.elements;return this.x=i[12],this.y=i[13],this.z=i[14],this.w=i[15],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,i){return this.x=wi(this.x,t.x,i.x),this.y=wi(this.y,t.y,i.y),this.z=wi(this.z,t.z,i.z),this.w=wi(this.w,t.w,i.w),this}clampScalar(t,i){return this.x=wi(this.x,t,i),this.y=wi(this.y,t,i),this.z=wi(this.z,t,i),this.w=wi(this.w,t,i),this}clampLength(t,i){const r=this.length();return this.divideScalar(r||1).multiplyScalar(wi(r,t,i))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this.z+=(t.z-this.z)*i,this.w+=(t.w-this.w)*i,this}lerpVectors(t,i,r){return this.x=t.x+(i.x-t.x)*r,this.y=t.y+(i.y-t.y)*r,this.z=t.z+(i.z-t.z)*r,this.w=t.w+(i.w-t.w)*r,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,i=0){return this.x=t[i],this.y=t[i+1],this.z=t[i+2],this.w=t[i+3],this}toArray(t=[],i=0){return t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t[i+3]=this.w,t}fromBufferAttribute(t,i){return this.x=t.getX(i),this.y=t.getY(i),this.z=t.getZ(i),this.w=t.getW(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class lP extends pu{constructor(t=1,i=1,r={}){super(),this.isRenderTarget=!0,this.width=t,this.height=i,this.depth=1,this.scissor=new Hi(0,0,t,i),this.scissorTest=!1,this.viewport=new Hi(0,0,t,i);const n={width:t,height:i,depth:1};r=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:pn,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},r);const s=new Wr(n,r.mapping,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.colorSpace);s.flipY=!1,s.generateMipmaps=r.generateMipmaps,s.internalFormat=r.internalFormat,this.textures=[];const a=r.count;for(let o=0;o<a;o++)this.textures[o]=s.clone(),this.textures[o].isRenderTargetTexture=!0,this.textures[o].renderTarget=this;this.depthBuffer=r.depthBuffer,this.stencilBuffer=r.stencilBuffer,this.resolveDepthBuffer=r.resolveDepthBuffer,this.resolveStencilBuffer=r.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=r.depthTexture,this.samples=r.samples}get texture(){return this.textures[0]}set texture(t){this.textures[0]=t}set depthTexture(t){this._depthTexture!==null&&(this._depthTexture.renderTarget=null),t!==null&&(t.renderTarget=this),this._depthTexture=t}get depthTexture(){return this._depthTexture}setSize(t,i,r=1){if(this.width!==t||this.height!==i||this.depth!==r){this.width=t,this.height=i,this.depth=r;for(let n=0,s=this.textures.length;n<s;n++)this.textures[n].image.width=t,this.textures[n].image.height=i,this.textures[n].image.depth=r;this.dispose()}this.viewport.set(0,0,t,i),this.scissor.set(0,0,t,i)}clone(){return new this.constructor().copy(this)}copy(t){this.width=t.width,this.height=t.height,this.depth=t.depth,this.scissor.copy(t.scissor),this.scissorTest=t.scissorTest,this.viewport.copy(t.viewport),this.textures.length=0;for(let i=0,r=t.textures.length;i<r;i++){this.textures[i]=t.textures[i].clone(),this.textures[i].isRenderTargetTexture=!0,this.textures[i].renderTarget=this;const n=Object.assign({},t.textures[i].image);this.textures[i].source=new Yd(n)}return this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.resolveDepthBuffer=t.resolveDepthBuffer,this.resolveStencilBuffer=t.resolveStencilBuffer,t.depthTexture!==null&&(this.depthTexture=t.depthTexture.clone()),this.samples=t.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class uu extends lP{constructor(t=1,i=1,r={}){super(t,i,r),this.isWebGLRenderTarget=!0}}class Xb extends Wr{constructor(t=null,i=1,r=1,n=1){super(null),this.isDataArrayTexture=!0,this.image={data:t,width:i,height:r,depth:n},this.magFilter=Fs,this.minFilter=Fs,this.wrapR=pl,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(t){this.layerUpdates.add(t)}clearLayerUpdates(){this.layerUpdates.clear()}}class lGe extends uu{constructor(t=1,i=1,r=1,n={}){super(t,i,n),this.isWebGLArrayRenderTarget=!0,this.depth=r,this.texture=new Xb(null,t,i,r),this.texture.isRenderTargetTexture=!0}}class cP extends Wr{constructor(t=null,i=1,r=1,n=1){super(null),this.isData3DTexture=!0,this.image={data:t,width:i,height:r,depth:n},this.magFilter=Fs,this.minFilter=Fs,this.wrapR=pl,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class cGe extends uu{constructor(t=1,i=1,r=1,n={}){super(t,i,n),this.isWebGL3DRenderTarget=!0,this.depth=r,this.texture=new cP(null,t,i,r),this.texture.isRenderTargetTexture=!0}}class oa{constructor(t=0,i=0,r=0,n=1){this.isQuaternion=!0,this._x=t,this._y=i,this._z=r,this._w=n}static slerpFlat(t,i,r,n,s,a,o){let l=r[n+0],c=r[n+1],u=r[n+2],h=r[n+3];const d=s[a+0],f=s[a+1],p=s[a+2],v=s[a+3];if(o===0){t[i+0]=l,t[i+1]=c,t[i+2]=u,t[i+3]=h;return}if(o===1){t[i+0]=d,t[i+1]=f,t[i+2]=p,t[i+3]=v;return}if(h!==v||l!==d||c!==f||u!==p){let m=1-o;const g=l*d+c*f+u*p+h*v,y=g>=0?1:-1,x=1-g*g;if(x>Number.EPSILON){const M=Math.sqrt(x),S=Math.atan2(M,g*y);m=Math.sin(m*S)/M,o=Math.sin(o*S)/M}const _=o*y;if(l=l*m+d*_,c=c*m+f*_,u=u*m+p*_,h=h*m+v*_,m===1-o){const M=1/Math.sqrt(l*l+c*c+u*u+h*h);l*=M,c*=M,u*=M,h*=M}}t[i]=l,t[i+1]=c,t[i+2]=u,t[i+3]=h}static multiplyQuaternionsFlat(t,i,r,n,s,a){const o=r[n],l=r[n+1],c=r[n+2],u=r[n+3],h=s[a],d=s[a+1],f=s[a+2],p=s[a+3];return t[i]=o*p+u*h+l*f-c*d,t[i+1]=l*p+u*d+c*h-o*f,t[i+2]=c*p+u*f+o*d-l*h,t[i+3]=u*p-o*h-l*d-c*f,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,i,r,n){return this._x=t,this._y=i,this._z=r,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,i=!0){const r=t._x,n=t._y,s=t._z,a=t._order,o=Math.cos,l=Math.sin,c=o(r/2),u=o(n/2),h=o(s/2),d=l(r/2),f=l(n/2),p=l(s/2);switch(a){case"XYZ":this._x=d*u*h+c*f*p,this._y=c*f*h-d*u*p,this._z=c*u*p+d*f*h,this._w=c*u*h-d*f*p;break;case"YXZ":this._x=d*u*h+c*f*p,this._y=c*f*h-d*u*p,this._z=c*u*p-d*f*h,this._w=c*u*h+d*f*p;break;case"ZXY":this._x=d*u*h-c*f*p,this._y=c*f*h+d*u*p,this._z=c*u*p+d*f*h,this._w=c*u*h-d*f*p;break;case"ZYX":this._x=d*u*h-c*f*p,this._y=c*f*h+d*u*p,this._z=c*u*p-d*f*h,this._w=c*u*h+d*f*p;break;case"YZX":this._x=d*u*h+c*f*p,this._y=c*f*h+d*u*p,this._z=c*u*p-d*f*h,this._w=c*u*h-d*f*p;break;case"XZY":this._x=d*u*h-c*f*p,this._y=c*f*h-d*u*p,this._z=c*u*p+d*f*h,this._w=c*u*h+d*f*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return i===!0&&this._onChangeCallback(),this}setFromAxisAngle(t,i){const r=i/2,n=Math.sin(r);return this._x=t.x*n,this._y=t.y*n,this._z=t.z*n,this._w=Math.cos(r),this._onChangeCallback(),this}setFromRotationMatrix(t){const i=t.elements,r=i[0],n=i[4],s=i[8],a=i[1],o=i[5],l=i[9],c=i[2],u=i[6],h=i[10],d=r+o+h;if(d>0){const f=.5/Math.sqrt(d+1);this._w=.25/f,this._x=(u-l)*f,this._y=(s-c)*f,this._z=(a-n)*f}else if(r>o&&r>h){const f=2*Math.sqrt(1+r-o-h);this._w=(u-l)/f,this._x=.25*f,this._y=(n+a)/f,this._z=(s+c)/f}else if(o>h){const f=2*Math.sqrt(1+o-r-h);this._w=(s-c)/f,this._x=(n+a)/f,this._y=.25*f,this._z=(l+u)/f}else{const f=2*Math.sqrt(1+h-r-o);this._w=(a-n)/f,this._x=(s+c)/f,this._y=(l+u)/f,this._z=.25*f}return this._onChangeCallback(),this}setFromUnitVectors(t,i){let r=t.dot(i)+1;return r<Number.EPSILON?(r=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=r):(this._x=0,this._y=-t.z,this._z=t.y,this._w=r)):(this._x=t.y*i.z-t.z*i.y,this._y=t.z*i.x-t.x*i.z,this._z=t.x*i.y-t.y*i.x,this._w=r),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(wi(this.dot(t),-1,1)))}rotateTowards(t,i){const r=this.angleTo(t);if(r===0)return this;const n=Math.min(1,i/r);return this.slerp(t,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return t===0?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,i){const r=t._x,n=t._y,s=t._z,a=t._w,o=i._x,l=i._y,c=i._z,u=i._w;return this._x=r*u+a*o+n*c-s*l,this._y=n*u+a*l+s*o-r*c,this._z=s*u+a*c+r*l-n*o,this._w=a*u-r*o-n*l-s*c,this._onChangeCallback(),this}slerp(t,i){if(i===0)return this;if(i===1)return this.copy(t);const r=this._x,n=this._y,s=this._z,a=this._w;let o=a*t._w+r*t._x+n*t._y+s*t._z;if(o<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),o>=1)return this._w=a,this._x=r,this._y=n,this._z=s,this;const l=1-o*o;if(l<=Number.EPSILON){const f=1-i;return this._w=f*a+i*this._w,this._x=f*r+i*this._x,this._y=f*n+i*this._y,this._z=f*s+i*this._z,this.normalize(),this}const c=Math.sqrt(l),u=Math.atan2(c,o),h=Math.sin((1-i)*u)/c,d=Math.sin(i*u)/c;return this._w=a*h+this._w*d,this._x=r*h+this._x*d,this._y=n*h+this._y*d,this._z=s*h+this._z*d,this._onChangeCallback(),this}slerpQuaternions(t,i,r){return this.copy(t).slerp(i,r)}random(){const t=2*Math.PI*Math.random(),i=2*Math.PI*Math.random(),r=Math.random(),n=Math.sqrt(1-r),s=Math.sqrt(r);return this.set(n*Math.sin(t),n*Math.cos(t),s*Math.sin(i),s*Math.cos(i))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,i=0){return this._x=t[i],this._y=t[i+1],this._z=t[i+2],this._w=t[i+3],this._onChangeCallback(),this}toArray(t=[],i=0){return t[i]=this._x,t[i+1]=this._y,t[i+2]=this._z,t[i+3]=this._w,t}fromBufferAttribute(t,i){return this._x=t.getX(i),this._y=t.getY(i),this._z=t.getZ(i),this._w=t.getW(i),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class he{constructor(t=0,i=0,r=0){he.prototype.isVector3=!0,this.x=t,this.y=i,this.z=r}set(t,i,r){return r===void 0&&(r=this.z),this.x=t,this.y=i,this.z=r,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,i){switch(t){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this}addScaledVector(t,i){return this.x+=t.x*i,this.y+=t.y*i,this.z+=t.z*i,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,i){return this.x=t.x*i.x,this.y=t.y*i.y,this.z=t.z*i.z,this}applyEuler(t){return this.applyQuaternion(hX.setFromEuler(t))}applyAxisAngle(t,i){return this.applyQuaternion(hX.setFromAxisAngle(t,i))}applyMatrix3(t){const i=this.x,r=this.y,n=this.z,s=t.elements;return this.x=s[0]*i+s[3]*r+s[6]*n,this.y=s[1]*i+s[4]*r+s[7]*n,this.z=s[2]*i+s[5]*r+s[8]*n,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const i=this.x,r=this.y,n=this.z,s=t.elements,a=1/(s[3]*i+s[7]*r+s[11]*n+s[15]);return this.x=(s[0]*i+s[4]*r+s[8]*n+s[12])*a,this.y=(s[1]*i+s[5]*r+s[9]*n+s[13])*a,this.z=(s[2]*i+s[6]*r+s[10]*n+s[14])*a,this}applyQuaternion(t){const i=this.x,r=this.y,n=this.z,s=t.x,a=t.y,o=t.z,l=t.w,c=2*(a*n-o*r),u=2*(o*i-s*n),h=2*(s*r-a*i);return this.x=i+l*c+a*h-o*u,this.y=r+l*u+o*c-s*h,this.z=n+l*h+s*u-a*c,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const i=this.x,r=this.y,n=this.z,s=t.elements;return this.x=s[0]*i+s[4]*r+s[8]*n,this.y=s[1]*i+s[5]*r+s[9]*n,this.z=s[2]*i+s[6]*r+s[10]*n,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,i){return this.x=wi(this.x,t.x,i.x),this.y=wi(this.y,t.y,i.y),this.z=wi(this.z,t.z,i.z),this}clampScalar(t,i){return this.x=wi(this.x,t,i),this.y=wi(this.y,t,i),this.z=wi(this.z,t,i),this}clampLength(t,i){const r=this.length();return this.divideScalar(r||1).multiplyScalar(wi(r,t,i))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this.z+=(t.z-this.z)*i,this}lerpVectors(t,i,r){return this.x=t.x+(i.x-t.x)*r,this.y=t.y+(i.y-t.y)*r,this.z=t.z+(i.z-t.z)*r,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,i){const r=t.x,n=t.y,s=t.z,a=i.x,o=i.y,l=i.z;return this.x=n*l-s*o,this.y=s*a-r*l,this.z=r*o-n*a,this}projectOnVector(t){const i=t.lengthSq();if(i===0)return this.set(0,0,0);const r=t.dot(this)/i;return this.copy(t).multiplyScalar(r)}projectOnPlane(t){return PI.copy(this).projectOnVector(t),this.sub(PI)}reflect(t){return this.sub(PI.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const i=Math.sqrt(this.lengthSq()*t.lengthSq());if(i===0)return Math.PI/2;const r=this.dot(t)/i;return Math.acos(wi(r,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const i=this.x-t.x,r=this.y-t.y,n=this.z-t.z;return i*i+r*r+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,i,r){const n=Math.sin(i)*t;return this.x=n*Math.sin(r),this.y=Math.cos(i)*t,this.z=n*Math.cos(r),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,i,r){return this.x=t*Math.sin(i),this.y=r,this.z=t*Math.cos(i),this}setFromMatrixPosition(t){const i=t.elements;return this.x=i[12],this.y=i[13],this.z=i[14],this}setFromMatrixScale(t){const i=this.setFromMatrixColumn(t,0).length(),r=this.setFromMatrixColumn(t,1).length(),n=this.setFromMatrixColumn(t,2).length();return this.x=i,this.y=r,this.z=n,this}setFromMatrixColumn(t,i){return this.fromArray(t.elements,i*4)}setFromMatrix3Column(t,i){return this.fromArray(t.elements,i*3)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}setFromColor(t){return this.x=t.r,this.y=t.g,this.z=t.b,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,i=0){return this.x=t[i],this.y=t[i+1],this.z=t[i+2],this}toArray(t=[],i=0){return t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t}fromBufferAttribute(t,i){return this.x=t.getX(i),this.y=t.getY(i),this.z=t.getZ(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=Math.random()*Math.PI*2,i=Math.random()*2-1,r=Math.sqrt(1-i*i);return this.x=r*Math.cos(t),this.y=i,this.z=r*Math.sin(t),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const PI=new he,hX=new oa;class Us{constructor(t=new he(1/0,1/0,1/0),i=new he(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=i}set(t,i){return this.min.copy(t),this.max.copy(i),this}setFromArray(t){this.makeEmpty();for(let i=0,r=t.length;i<r;i+=3)this.expandByPoint(Fl.fromArray(t,i));return this}setFromBufferAttribute(t){this.makeEmpty();for(let i=0,r=t.count;i<r;i++)this.expandByPoint(Fl.fromBufferAttribute(t,i));return this}setFromPoints(t){this.makeEmpty();for(let i=0,r=t.length;i<r;i++)this.expandByPoint(t[i]);return this}setFromCenterAndSize(t,i){const r=Fl.copy(i).multiplyScalar(.5);return this.min.copy(t).sub(r),this.max.copy(t).add(r),this}setFromObject(t,i=!1){return this.makeEmpty(),this.expandByObject(t,i)}clone(){return new this.constructor().copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,i=!1){t.updateWorldMatrix(!1,!1);const r=t.geometry;if(r!==void 0){const s=r.getAttribute("position");if(i===!0&&s!==void 0&&t.isInstancedMesh!==!0)for(let a=0,o=s.count;a<o;a++)t.isMesh===!0?t.getVertexPosition(a,Fl):Fl.fromBufferAttribute(s,a),Fl.applyMatrix4(t.matrixWorld),this.expandByPoint(Fl);else t.boundingBox!==void 0?(t.boundingBox===null&&t.computeBoundingBox(),NM.copy(t.boundingBox)):(r.boundingBox===null&&r.computeBoundingBox(),NM.copy(r.boundingBox)),NM.applyMatrix4(t.matrixWorld),this.union(NM)}const n=t.children;for(let s=0,a=n.length;s<a;s++)this.expandByObject(n[s],i);return this}containsPoint(t){return t.x>=this.min.x&&t.x<=this.max.x&&t.y>=this.min.y&&t.y<=this.max.y&&t.z>=this.min.z&&t.z<=this.max.z}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,i){return i.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return t.max.x>=this.min.x&&t.min.x<=this.max.x&&t.max.y>=this.min.y&&t.min.y<=this.max.y&&t.max.z>=this.min.z&&t.min.z<=this.max.z}intersectsSphere(t){return this.clampPoint(t.center,Fl),Fl.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let i,r;return t.normal.x>0?(i=t.normal.x*this.min.x,r=t.normal.x*this.max.x):(i=t.normal.x*this.max.x,r=t.normal.x*this.min.x),t.normal.y>0?(i+=t.normal.y*this.min.y,r+=t.normal.y*this.max.y):(i+=t.normal.y*this.max.y,r+=t.normal.y*this.min.y),t.normal.z>0?(i+=t.normal.z*this.min.z,r+=t.normal.z*this.max.z):(i+=t.normal.z*this.max.z,r+=t.normal.z*this.min.z),i<=-t.constant&&r>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(z1),kM.subVectors(this.max,z1),Qg.subVectors(t.a,z1),Zg.subVectors(t.b,z1),Kg.subVectors(t.c,z1),pd.subVectors(Zg,Qg),md.subVectors(Kg,Zg),sp.subVectors(Qg,Kg);let i=[0,-pd.z,pd.y,0,-md.z,md.y,0,-sp.z,sp.y,pd.z,0,-pd.x,md.z,0,-md.x,sp.z,0,-sp.x,-pd.y,pd.x,0,-md.y,md.x,0,-sp.y,sp.x,0];return!DI(i,Qg,Zg,Kg,kM)||(i=[1,0,0,0,1,0,0,0,1],!DI(i,Qg,Zg,Kg,kM))?!1:(VM.crossVectors(pd,md),i=[VM.x,VM.y,VM.z],DI(i,Qg,Zg,Kg,kM))}clampPoint(t,i){return i.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,Fl).distanceTo(t)}getBoundingSphere(t){return this.isEmpty()?t.makeEmpty():(this.getCenter(t.center),t.radius=this.getSize(Fl).length()*.5),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()?this:(zu[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),zu[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),zu[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),zu[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),zu[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),zu[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),zu[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),zu[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(zu),this)}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const zu=[new he,new he,new he,new he,new he,new he,new he,new he],Fl=new he,NM=new Us,Qg=new he,Zg=new he,Kg=new he,pd=new he,md=new he,sp=new he,z1=new he,kM=new he,VM=new he,ap=new he;function DI(e,t,i,r,n){for(let s=0,a=e.length-3;s<=a;s+=3){ap.fromArray(e,s);const o=n.x*Math.abs(ap.x)+n.y*Math.abs(ap.y)+n.z*Math.abs(ap.z),l=t.dot(ap),c=i.dot(ap),u=r.dot(ap);if(Math.max(-Math.max(l,c,u),Math.min(l,c,u))>o)return!1}return!0}const uGe=new Us,B1=new he,RI=new he;let Ns=class{constructor(t=new he,i=-1){this.isSphere=!0,this.center=t,this.radius=i}set(t,i){return this.center.copy(t),this.radius=i,this}setFromPoints(t,i){const r=this.center;i!==void 0?r.copy(i):uGe.setFromPoints(t).getCenter(r);let n=0;for(let s=0,a=t.length;s<a;s++)n=Math.max(n,r.distanceToSquared(t[s]));return this.radius=Math.sqrt(n),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const i=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=i*i}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,i){const r=this.center.distanceToSquared(t);return i.copy(t),r>this.radius*this.radius&&(i.sub(this.center).normalize(),i.multiplyScalar(this.radius).add(this.center)),i}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){if(this.isEmpty())return this.center.copy(t),this.radius=0,this;B1.subVectors(t,this.center);const i=B1.lengthSq();if(i>this.radius*this.radius){const r=Math.sqrt(i),n=(r-this.radius)*.5;this.center.addScaledVector(B1,n/r),this.radius+=n}return this}union(t){return t.isEmpty()?this:this.isEmpty()?(this.copy(t),this):(this.center.equals(t.center)===!0?this.radius=Math.max(this.radius,t.radius):(RI.subVectors(t.center,this.center).setLength(t.radius),this.expandByPoint(B1.copy(t.center).add(RI)),this.expandByPoint(B1.copy(t.center).sub(RI))),this)}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return new this.constructor().copy(this)}};const Bu=new he,II=new he,GM=new he,gd=new he,LI=new he,HM=new he,OI=new he;class Zm{constructor(t=new he,i=new he(0,0,-1)){this.origin=t,this.direction=i}set(t,i){return this.origin.copy(t),this.direction.copy(i),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,i){return i.copy(this.origin).addScaledVector(this.direction,t)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,Bu)),this}closestPointToPoint(t,i){i.subVectors(t,this.origin);const r=i.dot(this.direction);return r<0?i.copy(this.origin):i.copy(this.origin).addScaledVector(this.direction,r)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const i=Bu.subVectors(t,this.origin).dot(this.direction);return i<0?this.origin.distanceToSquared(t):(Bu.copy(this.origin).addScaledVector(this.direction,i),Bu.distanceToSquared(t))}distanceSqToSegment(t,i,r,n){II.copy(t).add(i).multiplyScalar(.5),GM.copy(i).sub(t).normalize(),gd.copy(this.origin).sub(II);const s=t.distanceTo(i)*.5,a=-this.direction.dot(GM),o=gd.dot(this.direction),l=-gd.dot(GM),c=gd.lengthSq(),u=Math.abs(1-a*a);let h,d,f,p;if(u>0)if(h=a*l-o,d=a*o-l,p=s*u,h>=0)if(d>=-p)if(d<=p){const v=1/u;h*=v,d*=v,f=h*(h+a*d+2*o)+d*(a*h+d+2*l)+c}else d=s,h=Math.max(0,-(a*d+o)),f=-h*h+d*(d+2*l)+c;else d=-s,h=Math.max(0,-(a*d+o)),f=-h*h+d*(d+2*l)+c;else d<=-p?(h=Math.max(0,-(-a*s+o)),d=h>0?-s:Math.min(Math.max(-s,-l),s),f=-h*h+d*(d+2*l)+c):d<=p?(h=0,d=Math.min(Math.max(-s,-l),s),f=d*(d+2*l)+c):(h=Math.max(0,-(a*s+o)),d=h>0?s:Math.min(Math.max(-s,-l),s),f=-h*h+d*(d+2*l)+c);else d=a>0?-s:s,h=Math.max(0,-(a*d+o)),f=-h*h+d*(d+2*l)+c;return r&&r.copy(this.origin).addScaledVector(this.direction,h),n&&n.copy(II).addScaledVector(GM,d),f}intersectSphere(t,i){Bu.subVectors(t.center,this.origin);const r=Bu.dot(this.direction),n=Bu.dot(Bu)-r*r,s=t.radius*t.radius;if(n>s)return null;const a=Math.sqrt(s-n),o=r-a,l=r+a;return l<0?null:o<0?this.at(l,i):this.at(o,i)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const i=t.normal.dot(this.direction);if(i===0)return t.distanceToPoint(this.origin)===0?0:null;const r=-(this.origin.dot(t.normal)+t.constant)/i;return r>=0?r:null}intersectPlane(t,i){const r=this.distanceToPlane(t);return r===null?null:this.at(r,i)}intersectsPlane(t){const i=t.distanceToPoint(this.origin);return i===0||t.normal.dot(this.direction)*i<0}intersectBox(t,i){let r,n,s,a,o,l;const c=1/this.direction.x,u=1/this.direction.y,h=1/this.direction.z,d=this.origin;return c>=0?(r=(t.min.x-d.x)*c,n=(t.max.x-d.x)*c):(r=(t.max.x-d.x)*c,n=(t.min.x-d.x)*c),u>=0?(s=(t.min.y-d.y)*u,a=(t.max.y-d.y)*u):(s=(t.max.y-d.y)*u,a=(t.min.y-d.y)*u),r>a||s>n||((s>r||isNaN(r))&&(r=s),(a<n||isNaN(n))&&(n=a),h>=0?(o=(t.min.z-d.z)*h,l=(t.max.z-d.z)*h):(o=(t.max.z-d.z)*h,l=(t.min.z-d.z)*h),r>l||o>n)||((o>r||r!==r)&&(r=o),(l<n||n!==n)&&(n=l),n<0)?null:this.at(r>=0?r:n,i)}intersectsBox(t){return this.intersectBox(t,Bu)!==null}intersectTriangle(t,i,r,n,s){LI.subVectors(i,t),HM.subVectors(r,t),OI.crossVectors(LI,HM);let a=this.direction.dot(OI),o;if(a>0){if(n)return null;o=1}else if(a<0)o=-1,a=-a;else return null;gd.subVectors(this.origin,t);const l=o*this.direction.dot(HM.crossVectors(gd,HM));if(l<0)return null;const c=o*this.direction.dot(LI.cross(gd));if(c<0||l+c>a)return null;const u=-o*gd.dot(OI);return u<0?null:this.at(u/a,s)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class ci{constructor(t,i,r,n,s,a,o,l,c,u,h,d,f,p,v,m){ci.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],t!==void 0&&this.set(t,i,r,n,s,a,o,l,c,u,h,d,f,p,v,m)}set(t,i,r,n,s,a,o,l,c,u,h,d,f,p,v,m){const g=this.elements;return g[0]=t,g[4]=i,g[8]=r,g[12]=n,g[1]=s,g[5]=a,g[9]=o,g[13]=l,g[2]=c,g[6]=u,g[10]=h,g[14]=d,g[3]=f,g[7]=p,g[11]=v,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new ci().fromArray(this.elements)}copy(t){const i=this.elements,r=t.elements;return i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[3],i[4]=r[4],i[5]=r[5],i[6]=r[6],i[7]=r[7],i[8]=r[8],i[9]=r[9],i[10]=r[10],i[11]=r[11],i[12]=r[12],i[13]=r[13],i[14]=r[14],i[15]=r[15],this}copyPosition(t){const i=this.elements,r=t.elements;return i[12]=r[12],i[13]=r[13],i[14]=r[14],this}setFromMatrix3(t){const i=t.elements;return this.set(i[0],i[3],i[6],0,i[1],i[4],i[7],0,i[2],i[5],i[8],0,0,0,0,1),this}extractBasis(t,i,r){return t.setFromMatrixColumn(this,0),i.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this}makeBasis(t,i,r){return this.set(t.x,i.x,r.x,0,t.y,i.y,r.y,0,t.z,i.z,r.z,0,0,0,0,1),this}extractRotation(t){const i=this.elements,r=t.elements,n=1/Jg.setFromMatrixColumn(t,0).length(),s=1/Jg.setFromMatrixColumn(t,1).length(),a=1/Jg.setFromMatrixColumn(t,2).length();return i[0]=r[0]*n,i[1]=r[1]*n,i[2]=r[2]*n,i[3]=0,i[4]=r[4]*s,i[5]=r[5]*s,i[6]=r[6]*s,i[7]=0,i[8]=r[8]*a,i[9]=r[9]*a,i[10]=r[10]*a,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromEuler(t){const i=this.elements,r=t.x,n=t.y,s=t.z,a=Math.cos(r),o=Math.sin(r),l=Math.cos(n),c=Math.sin(n),u=Math.cos(s),h=Math.sin(s);if(t.order==="XYZ"){const d=a*u,f=a*h,p=o*u,v=o*h;i[0]=l*u,i[4]=-l*h,i[8]=c,i[1]=f+p*c,i[5]=d-v*c,i[9]=-o*l,i[2]=v-d*c,i[6]=p+f*c,i[10]=a*l}else if(t.order==="YXZ"){const d=l*u,f=l*h,p=c*u,v=c*h;i[0]=d+v*o,i[4]=p*o-f,i[8]=a*c,i[1]=a*h,i[5]=a*u,i[9]=-o,i[2]=f*o-p,i[6]=v+d*o,i[10]=a*l}else if(t.order==="ZXY"){const d=l*u,f=l*h,p=c*u,v=c*h;i[0]=d-v*o,i[4]=-a*h,i[8]=p+f*o,i[1]=f+p*o,i[5]=a*u,i[9]=v-d*o,i[2]=-a*c,i[6]=o,i[10]=a*l}else if(t.order==="ZYX"){const d=a*u,f=a*h,p=o*u,v=o*h;i[0]=l*u,i[4]=p*c-f,i[8]=d*c+v,i[1]=l*h,i[5]=v*c+d,i[9]=f*c-p,i[2]=-c,i[6]=o*l,i[10]=a*l}else if(t.order==="YZX"){const d=a*l,f=a*c,p=o*l,v=o*c;i[0]=l*u,i[4]=v-d*h,i[8]=p*h+f,i[1]=h,i[5]=a*u,i[9]=-o*u,i[2]=-c*u,i[6]=f*h+p,i[10]=d-v*h}else if(t.order==="XZY"){const d=a*l,f=a*c,p=o*l,v=o*c;i[0]=l*u,i[4]=-h,i[8]=c*u,i[1]=d*h+v,i[5]=a*u,i[9]=f*h-p,i[2]=p*h-f,i[6]=o*u,i[10]=v*h+d}return i[3]=0,i[7]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromQuaternion(t){return this.compose(hGe,t,dGe)}lookAt(t,i,r){const n=this.elements;return Mo.subVectors(t,i),Mo.lengthSq()===0&&(Mo.z=1),Mo.normalize(),vd.crossVectors(r,Mo),vd.lengthSq()===0&&(Math.abs(r.z)===1?Mo.x+=1e-4:Mo.z+=1e-4,Mo.normalize(),vd.crossVectors(r,Mo)),vd.normalize(),jM.crossVectors(Mo,vd),n[0]=vd.x,n[4]=jM.x,n[8]=Mo.x,n[1]=vd.y,n[5]=jM.y,n[9]=Mo.y,n[2]=vd.z,n[6]=jM.z,n[10]=Mo.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,i){const r=t.elements,n=i.elements,s=this.elements,a=r[0],o=r[4],l=r[8],c=r[12],u=r[1],h=r[5],d=r[9],f=r[13],p=r[2],v=r[6],m=r[10],g=r[14],y=r[3],x=r[7],_=r[11],M=r[15],S=n[0],T=n[4],E=n[8],C=n[12],A=n[1],D=n[5],R=n[9],L=n[13],O=n[2],H=n[6],j=n[10],Y=n[14],z=n[3],V=n[7],U=n[11],k=n[15];return s[0]=a*S+o*A+l*O+c*z,s[4]=a*T+o*D+l*H+c*V,s[8]=a*E+o*R+l*j+c*U,s[12]=a*C+o*L+l*Y+c*k,s[1]=u*S+h*A+d*O+f*z,s[5]=u*T+h*D+d*H+f*V,s[9]=u*E+h*R+d*j+f*U,s[13]=u*C+h*L+d*Y+f*k,s[2]=p*S+v*A+m*O+g*z,s[6]=p*T+v*D+m*H+g*V,s[10]=p*E+v*R+m*j+g*U,s[14]=p*C+v*L+m*Y+g*k,s[3]=y*S+x*A+_*O+M*z,s[7]=y*T+x*D+_*H+M*V,s[11]=y*E+x*R+_*j+M*U,s[15]=y*C+x*L+_*Y+M*k,this}multiplyScalar(t){const i=this.elements;return i[0]*=t,i[4]*=t,i[8]*=t,i[12]*=t,i[1]*=t,i[5]*=t,i[9]*=t,i[13]*=t,i[2]*=t,i[6]*=t,i[10]*=t,i[14]*=t,i[3]*=t,i[7]*=t,i[11]*=t,i[15]*=t,this}determinant(){const t=this.elements,i=t[0],r=t[4],n=t[8],s=t[12],a=t[1],o=t[5],l=t[9],c=t[13],u=t[2],h=t[6],d=t[10],f=t[14],p=t[3],v=t[7],m=t[11],g=t[15];return p*(+s*l*h-n*c*h-s*o*d+r*c*d+n*o*f-r*l*f)+v*(+i*l*f-i*c*d+s*a*d-n*a*f+n*c*u-s*l*u)+m*(+i*c*h-i*o*f-s*a*h+r*a*f+s*o*u-r*c*u)+g*(-n*o*u-i*l*h+i*o*d+n*a*h-r*a*d+r*l*u)}transpose(){const t=this.elements;let i;return i=t[1],t[1]=t[4],t[4]=i,i=t[2],t[2]=t[8],t[8]=i,i=t[6],t[6]=t[9],t[9]=i,i=t[3],t[3]=t[12],t[12]=i,i=t[7],t[7]=t[13],t[13]=i,i=t[11],t[11]=t[14],t[14]=i,this}setPosition(t,i,r){const n=this.elements;return t.isVector3?(n[12]=t.x,n[13]=t.y,n[14]=t.z):(n[12]=t,n[13]=i,n[14]=r),this}invert(){const t=this.elements,i=t[0],r=t[1],n=t[2],s=t[3],a=t[4],o=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],f=t[11],p=t[12],v=t[13],m=t[14],g=t[15],y=h*m*c-v*d*c+v*l*f-o*m*f-h*l*g+o*d*g,x=p*d*c-u*m*c-p*l*f+a*m*f+u*l*g-a*d*g,_=u*v*c-p*h*c+p*o*f-a*v*f-u*o*g+a*h*g,M=p*h*l-u*v*l-p*o*d+a*v*d+u*o*m-a*h*m,S=i*y+r*x+n*_+s*M;if(S===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const T=1/S;return t[0]=y*T,t[1]=(v*d*s-h*m*s-v*n*f+r*m*f+h*n*g-r*d*g)*T,t[2]=(o*m*s-v*l*s+v*n*c-r*m*c-o*n*g+r*l*g)*T,t[3]=(h*l*s-o*d*s-h*n*c+r*d*c+o*n*f-r*l*f)*T,t[4]=x*T,t[5]=(u*m*s-p*d*s+p*n*f-i*m*f-u*n*g+i*d*g)*T,t[6]=(p*l*s-a*m*s-p*n*c+i*m*c+a*n*g-i*l*g)*T,t[7]=(a*d*s-u*l*s+u*n*c-i*d*c-a*n*f+i*l*f)*T,t[8]=_*T,t[9]=(p*h*s-u*v*s-p*r*f+i*v*f+u*r*g-i*h*g)*T,t[10]=(a*v*s-p*o*s+p*r*c-i*v*c-a*r*g+i*o*g)*T,t[11]=(u*o*s-a*h*s-u*r*c+i*h*c+a*r*f-i*o*f)*T,t[12]=M*T,t[13]=(u*v*n-p*h*n+p*r*d-i*v*d-u*r*m+i*h*m)*T,t[14]=(p*o*n-a*v*n-p*r*l+i*v*l+a*r*m-i*o*m)*T,t[15]=(a*h*n-u*o*n+u*r*l-i*h*l-a*r*d+i*o*d)*T,this}scale(t){const i=this.elements,r=t.x,n=t.y,s=t.z;return i[0]*=r,i[4]*=n,i[8]*=s,i[1]*=r,i[5]*=n,i[9]*=s,i[2]*=r,i[6]*=n,i[10]*=s,i[3]*=r,i[7]*=n,i[11]*=s,this}getMaxScaleOnAxis(){const t=this.elements,i=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],r=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],n=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(i,r,n))}makeTranslation(t,i,r){return t.isVector3?this.set(1,0,0,t.x,0,1,0,t.y,0,0,1,t.z,0,0,0,1):this.set(1,0,0,t,0,1,0,i,0,0,1,r,0,0,0,1),this}makeRotationX(t){const i=Math.cos(t),r=Math.sin(t);return this.set(1,0,0,0,0,i,-r,0,0,r,i,0,0,0,0,1),this}makeRotationY(t){const i=Math.cos(t),r=Math.sin(t);return this.set(i,0,r,0,0,1,0,0,-r,0,i,0,0,0,0,1),this}makeRotationZ(t){const i=Math.cos(t),r=Math.sin(t);return this.set(i,-r,0,0,r,i,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,i){const r=Math.cos(i),n=Math.sin(i),s=1-r,a=t.x,o=t.y,l=t.z,c=s*a,u=s*o;return this.set(c*a+r,c*o-n*l,c*l+n*o,0,c*o+n*l,u*o+r,u*l-n*a,0,c*l-n*o,u*l+n*a,s*l*l+r,0,0,0,0,1),this}makeScale(t,i,r){return this.set(t,0,0,0,0,i,0,0,0,0,r,0,0,0,0,1),this}makeShear(t,i,r,n,s,a){return this.set(1,r,s,0,t,1,a,0,i,n,1,0,0,0,0,1),this}compose(t,i,r){const n=this.elements,s=i._x,a=i._y,o=i._z,l=i._w,c=s+s,u=a+a,h=o+o,d=s*c,f=s*u,p=s*h,v=a*u,m=a*h,g=o*h,y=l*c,x=l*u,_=l*h,M=r.x,S=r.y,T=r.z;return n[0]=(1-(v+g))*M,n[1]=(f+_)*M,n[2]=(p-x)*M,n[3]=0,n[4]=(f-_)*S,n[5]=(1-(d+g))*S,n[6]=(m+y)*S,n[7]=0,n[8]=(p+x)*T,n[9]=(m-y)*T,n[10]=(1-(d+v))*T,n[11]=0,n[12]=t.x,n[13]=t.y,n[14]=t.z,n[15]=1,this}decompose(t,i,r){const n=this.elements;let s=Jg.set(n[0],n[1],n[2]).length();const a=Jg.set(n[4],n[5],n[6]).length(),o=Jg.set(n[8],n[9],n[10]).length();this.determinant()<0&&(s=-s),t.x=n[12],t.y=n[13],t.z=n[14],Ul.copy(this);const c=1/s,u=1/a,h=1/o;return Ul.elements[0]*=c,Ul.elements[1]*=c,Ul.elements[2]*=c,Ul.elements[4]*=u,Ul.elements[5]*=u,Ul.elements[6]*=u,Ul.elements[8]*=h,Ul.elements[9]*=h,Ul.elements[10]*=h,i.setFromRotationMatrix(Ul),r.x=s,r.y=a,r.z=o,this}makePerspective(t,i,r,n,s,a,o=$l){const l=this.elements,c=2*s/(i-t),u=2*s/(r-n),h=(i+t)/(i-t),d=(r+n)/(r-n);let f,p;if(o===$l)f=-(a+s)/(a-s),p=-2*a*s/(a-s);else if(o===ab)f=-a/(a-s),p=-a*s/(a-s);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+o);return l[0]=c,l[4]=0,l[8]=h,l[12]=0,l[1]=0,l[5]=u,l[9]=d,l[13]=0,l[2]=0,l[6]=0,l[10]=f,l[14]=p,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(t,i,r,n,s,a,o=$l){const l=this.elements,c=1/(i-t),u=1/(r-n),h=1/(a-s),d=(i+t)*c,f=(r+n)*u;let p,v;if(o===$l)p=(a+s)*h,v=-2*h;else if(o===ab)p=s*h,v=-1*h;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+o);return l[0]=2*c,l[4]=0,l[8]=0,l[12]=-d,l[1]=0,l[5]=2*u,l[9]=0,l[13]=-f,l[2]=0,l[6]=0,l[10]=v,l[14]=-p,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(t){const i=this.elements,r=t.elements;for(let n=0;n<16;n++)if(i[n]!==r[n])return!1;return!0}fromArray(t,i=0){for(let r=0;r<16;r++)this.elements[r]=t[r+i];return this}toArray(t=[],i=0){const r=this.elements;return t[i]=r[0],t[i+1]=r[1],t[i+2]=r[2],t[i+3]=r[3],t[i+4]=r[4],t[i+5]=r[5],t[i+6]=r[6],t[i+7]=r[7],t[i+8]=r[8],t[i+9]=r[9],t[i+10]=r[10],t[i+11]=r[11],t[i+12]=r[12],t[i+13]=r[13],t[i+14]=r[14],t[i+15]=r[15],t}}const Jg=new he,Ul=new ci,hGe=new he(0,0,0),dGe=new he(1,1,1),vd=new he,jM=new he,Mo=new he,dX=new ci,fX=new oa;class Fo{constructor(t=0,i=0,r=0,n=Fo.DEFAULT_ORDER){this.isEuler=!0,this._x=t,this._y=i,this._z=r,this._order=n}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,i,r,n=this._order){return this._x=t,this._y=i,this._z=r,this._order=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,i=this._order,r=!0){const n=t.elements,s=n[0],a=n[4],o=n[8],l=n[1],c=n[5],u=n[9],h=n[2],d=n[6],f=n[10];switch(i){case"XYZ":this._y=Math.asin(wi(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-u,f),this._z=Math.atan2(-a,s)):(this._x=Math.atan2(d,c),this._z=0);break;case"YXZ":this._x=Math.asin(-wi(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(o,f),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-h,s),this._z=0);break;case"ZXY":this._x=Math.asin(wi(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-h,f),this._z=Math.atan2(-a,c)):(this._y=0,this._z=Math.atan2(l,s));break;case"ZYX":this._y=Math.asin(-wi(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(d,f),this._z=Math.atan2(l,s)):(this._x=0,this._z=Math.atan2(-a,c));break;case"YZX":this._z=Math.asin(wi(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-u,c),this._y=Math.atan2(-h,s)):(this._x=0,this._y=Math.atan2(o,f));break;case"XZY":this._z=Math.asin(-wi(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(d,c),this._y=Math.atan2(o,s)):(this._x=Math.atan2(-u,f),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+i)}return this._order=i,r===!0&&this._onChangeCallback(),this}setFromQuaternion(t,i,r){return dX.makeRotationFromQuaternion(t),this.setFromRotationMatrix(dX,i,r)}setFromVector3(t,i=this._order){return this.set(t.x,t.y,t.z,i)}reorder(t){return fX.setFromEuler(this),this.setFromQuaternion(fX,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],t[3]!==void 0&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],i=0){return t[i]=this._x,t[i+1]=this._y,t[i+2]=this._z,t[i+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Fo.DEFAULT_ORDER="XYZ";class pm{constructor(){this.mask=1}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return(this.mask&t.mask)!==0}isEnabled(t){return(this.mask&(1<<t|0))!==0}}let fGe=0;const pX=new he,$g=new oa,Fu=new ci,WM=new he,F1=new he,pGe=new he,mGe=new oa,mX=new he(1,0,0),gX=new he(0,1,0),vX=new he(0,0,1),yX={type:"added"},gGe={type:"removed"},ev={type:"childadded",child:null},zI={type:"childremoved",child:null};class Qi extends pu{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:fGe++}),this.uuid=Lo(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Qi.DEFAULT_UP.clone();const t=new he,i=new Fo,r=new oa,n=new he(1,1,1);function s(){r.setFromEuler(i,!1)}function a(){i.setFromQuaternion(r,void 0,!1)}i._onChange(s),r._onChange(a),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:i},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new ci},normalMatrix:{value:new xi}}),this.matrix=new ci,this.matrixWorld=new ci,this.matrixAutoUpdate=Qi.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Qi.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new pm,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,i){this.quaternion.setFromAxisAngle(t,i)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,i){return $g.setFromAxisAngle(t,i),this.quaternion.multiply($g),this}rotateOnWorldAxis(t,i){return $g.setFromAxisAngle(t,i),this.quaternion.premultiply($g),this}rotateX(t){return this.rotateOnAxis(mX,t)}rotateY(t){return this.rotateOnAxis(gX,t)}rotateZ(t){return this.rotateOnAxis(vX,t)}translateOnAxis(t,i){return pX.copy(t).applyQuaternion(this.quaternion),this.position.add(pX.multiplyScalar(i)),this}translateX(t){return this.translateOnAxis(mX,t)}translateY(t){return this.translateOnAxis(gX,t)}translateZ(t){return this.translateOnAxis(vX,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(Fu.copy(this.matrixWorld).invert())}lookAt(t,i,r){t.isVector3?WM.copy(t):WM.set(t,i,r);const n=this.parent;this.updateWorldMatrix(!0,!1),F1.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Fu.lookAt(F1,WM,this.up):Fu.lookAt(WM,F1,this.up),this.quaternion.setFromRotationMatrix(Fu),n&&(Fu.extractRotation(n.matrixWorld),$g.setFromRotationMatrix(Fu),this.quaternion.premultiply($g.invert()))}add(t){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.add(arguments[i]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.removeFromParent(),t.parent=this,this.children.push(t),t.dispatchEvent(yX),ev.child=t,this.dispatchEvent(ev),ev.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let r=0;r<arguments.length;r++)this.remove(arguments[r]);return this}const i=this.children.indexOf(t);return i!==-1&&(t.parent=null,this.children.splice(i,1),t.dispatchEvent(gGe),zI.child=t,this.dispatchEvent(zI),zI.child=null),this}removeFromParent(){const t=this.parent;return t!==null&&t.remove(this),this}clear(){return this.remove(...this.children)}attach(t){return this.updateWorldMatrix(!0,!1),Fu.copy(this.matrixWorld).invert(),t.parent!==null&&(t.parent.updateWorldMatrix(!0,!1),Fu.multiply(t.parent.matrixWorld)),t.applyMatrix4(Fu),t.removeFromParent(),t.parent=this,this.children.push(t),t.updateWorldMatrix(!1,!0),t.dispatchEvent(yX),ev.child=t,this.dispatchEvent(ev),ev.child=null,this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,i){if(this[t]===i)return this;for(let r=0,n=this.children.length;r<n;r++){const a=this.children[r].getObjectByProperty(t,i);if(a!==void 0)return a}}getObjectsByProperty(t,i,r=[]){this[t]===i&&r.push(this);const n=this.children;for(let s=0,a=n.length;s<a;s++)n[s].getObjectsByProperty(t,i,r);return r}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(F1,t,pGe),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(F1,mGe,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const i=this.matrixWorld.elements;return t.set(i[8],i[9],i[10]).normalize()}raycast(){}traverse(t){t(this);const i=this.children;for(let r=0,n=i.length;r<n;r++)i[r].traverse(t)}traverseVisible(t){if(this.visible===!1)return;t(this);const i=this.children;for(let r=0,n=i.length;r<n;r++)i[r].traverseVisible(t)}traverseAncestors(t){const i=this.parent;i!==null&&(t(i),i.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,t=!0);const i=this.children;for(let r=0,n=i.length;r<n;r++)i[r].updateMatrixWorld(t)}updateWorldMatrix(t,i){const r=this.parent;if(t===!0&&r!==null&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),i===!0){const n=this.children;for(let s=0,a=n.length;s<a;s++)n[s].updateWorldMatrix(!1,!0)}}toJSON(t){const i=t===void 0||typeof t=="string",r={};i&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},r.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const n={};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.castShadow===!0&&(n.castShadow=!0),this.receiveShadow===!0&&(n.receiveShadow=!0),this.visible===!1&&(n.visible=!1),this.frustumCulled===!1&&(n.frustumCulled=!1),this.renderOrder!==0&&(n.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),n.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(n.matrixAutoUpdate=!1),this.isInstancedMesh&&(n.type="InstancedMesh",n.count=this.count,n.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(n.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(n.type="BatchedMesh",n.perObjectFrustumCulled=this.perObjectFrustumCulled,n.sortObjects=this.sortObjects,n.drawRanges=this._drawRanges,n.reservedRanges=this._reservedRanges,n.visibility=this._visibility,n.active=this._active,n.bounds=this._bounds.map(o=>({boxInitialized:o.boxInitialized,boxMin:o.box.min.toArray(),boxMax:o.box.max.toArray(),sphereInitialized:o.sphereInitialized,sphereRadius:o.sphere.radius,sphereCenter:o.sphere.center.toArray()})),n.maxInstanceCount=this._maxInstanceCount,n.maxVertexCount=this._maxVertexCount,n.maxIndexCount=this._maxIndexCount,n.geometryInitialized=this._geometryInitialized,n.geometryCount=this._geometryCount,n.matricesTexture=this._matricesTexture.toJSON(t),this._colorsTexture!==null&&(n.colorsTexture=this._colorsTexture.toJSON(t)),this.boundingSphere!==null&&(n.boundingSphere={center:n.boundingSphere.center.toArray(),radius:n.boundingSphere.radius}),this.boundingBox!==null&&(n.boundingBox={min:n.boundingBox.min.toArray(),max:n.boundingBox.max.toArray()}));function s(o,l){return o[l.uuid]===void 0&&(o[l.uuid]=l.toJSON(t)),l.uuid}if(this.isScene)this.background&&(this.background.isColor?n.background=this.background.toJSON():this.background.isTexture&&(n.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(n.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){n.geometry=s(t.geometries,this.geometry);const o=this.geometry.parameters;if(o!==void 0&&o.shapes!==void 0){const l=o.shapes;if(Array.isArray(l))for(let c=0,u=l.length;c<u;c++){const h=l[c];s(t.shapes,h)}else s(t.shapes,l)}}if(this.isSkinnedMesh&&(n.bindMode=this.bindMode,n.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(t.skeletons,this.skeleton),n.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const o=[];for(let l=0,c=this.material.length;l<c;l++)o.push(s(t.materials,this.material[l]));n.material=o}else n.material=s(t.materials,this.material);if(this.children.length>0){n.children=[];for(let o=0;o<this.children.length;o++)n.children.push(this.children[o].toJSON(t).object)}if(this.animations.length>0){n.animations=[];for(let o=0;o<this.animations.length;o++){const l=this.animations[o];n.animations.push(s(t.animations,l))}}if(i){const o=a(t.geometries),l=a(t.materials),c=a(t.textures),u=a(t.images),h=a(t.shapes),d=a(t.skeletons),f=a(t.animations),p=a(t.nodes);o.length>0&&(r.geometries=o),l.length>0&&(r.materials=l),c.length>0&&(r.textures=c),u.length>0&&(r.images=u),h.length>0&&(r.shapes=h),d.length>0&&(r.skeletons=d),f.length>0&&(r.animations=f),p.length>0&&(r.nodes=p)}return r.object=n,r;function a(o){const l=[];for(const c in o){const u=o[c];delete u.metadata,l.push(u)}return l}}clone(t){return new this.constructor().copy(this,t)}copy(t,i=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.animations=t.animations.slice(),this.userData=JSON.parse(JSON.stringify(t.userData)),i===!0)for(let r=0;r<t.children.length;r++){const n=t.children[r];this.add(n.clone())}return this}}Qi.DEFAULT_UP=new he(0,1,0);Qi.DEFAULT_MATRIX_AUTO_UPDATE=!0;Qi.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Nl=new he,Uu=new he,BI=new he,Nu=new he,tv=new he,iv=new he,xX=new he,FI=new he,UI=new he,NI=new he,kI=new Hi,VI=new Hi,GI=new Hi;class to{constructor(t=new he,i=new he,r=new he){this.a=t,this.b=i,this.c=r}static getNormal(t,i,r,n){n.subVectors(r,i),Nl.subVectors(t,i),n.cross(Nl);const s=n.lengthSq();return s>0?n.multiplyScalar(1/Math.sqrt(s)):n.set(0,0,0)}static getBarycoord(t,i,r,n,s){Nl.subVectors(n,i),Uu.subVectors(r,i),BI.subVectors(t,i);const a=Nl.dot(Nl),o=Nl.dot(Uu),l=Nl.dot(BI),c=Uu.dot(Uu),u=Uu.dot(BI),h=a*c-o*o;if(h===0)return s.set(0,0,0),null;const d=1/h,f=(c*l-o*u)*d,p=(a*u-o*l)*d;return s.set(1-f-p,p,f)}static containsPoint(t,i,r,n){return this.getBarycoord(t,i,r,n,Nu)===null?!1:Nu.x>=0&&Nu.y>=0&&Nu.x+Nu.y<=1}static getInterpolation(t,i,r,n,s,a,o,l){return this.getBarycoord(t,i,r,n,Nu)===null?(l.x=0,l.y=0,"z"in l&&(l.z=0),"w"in l&&(l.w=0),null):(l.setScalar(0),l.addScaledVector(s,Nu.x),l.addScaledVector(a,Nu.y),l.addScaledVector(o,Nu.z),l)}static getInterpolatedAttribute(t,i,r,n,s,a){return kI.setScalar(0),VI.setScalar(0),GI.setScalar(0),kI.fromBufferAttribute(t,i),VI.fromBufferAttribute(t,r),GI.fromBufferAttribute(t,n),a.setScalar(0),a.addScaledVector(kI,s.x),a.addScaledVector(VI,s.y),a.addScaledVector(GI,s.z),a}static isFrontFacing(t,i,r,n){return Nl.subVectors(r,i),Uu.subVectors(t,i),Nl.cross(Uu).dot(n)<0}set(t,i,r){return this.a.copy(t),this.b.copy(i),this.c.copy(r),this}setFromPointsAndIndices(t,i,r,n){return this.a.copy(t[i]),this.b.copy(t[r]),this.c.copy(t[n]),this}setFromAttributeAndIndices(t,i,r,n){return this.a.fromBufferAttribute(t,i),this.b.fromBufferAttribute(t,r),this.c.fromBufferAttribute(t,n),this}clone(){return new this.constructor().copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return Nl.subVectors(this.c,this.b),Uu.subVectors(this.a,this.b),Nl.cross(Uu).length()*.5}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return to.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,i){return to.getBarycoord(t,this.a,this.b,this.c,i)}getInterpolation(t,i,r,n,s){return to.getInterpolation(t,this.a,this.b,this.c,i,r,n,s)}containsPoint(t){return to.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return to.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,i){const r=this.a,n=this.b,s=this.c;let a,o;tv.subVectors(n,r),iv.subVectors(s,r),FI.subVectors(t,r);const l=tv.dot(FI),c=iv.dot(FI);if(l<=0&&c<=0)return i.copy(r);UI.subVectors(t,n);const u=tv.dot(UI),h=iv.dot(UI);if(u>=0&&h<=u)return i.copy(n);const d=l*h-u*c;if(d<=0&&l>=0&&u<=0)return a=l/(l-u),i.copy(r).addScaledVector(tv,a);NI.subVectors(t,s);const f=tv.dot(NI),p=iv.dot(NI);if(p>=0&&f<=p)return i.copy(s);const v=f*c-l*p;if(v<=0&&c>=0&&p<=0)return o=c/(c-p),i.copy(r).addScaledVector(iv,o);const m=u*p-f*h;if(m<=0&&h-u>=0&&f-p>=0)return xX.subVectors(s,n),o=(h-u)/(h-u+(f-p)),i.copy(n).addScaledVector(xX,o);const g=1/(m+v+d);return a=v*g,o=d*g,i.copy(r).addScaledVector(tv,a).addScaledVector(iv,o)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}const Fne={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},yd={h:0,s:0,l:0},XM={h:0,s:0,l:0};function HI(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+(t-e)*6*i:i<1/2?t:i<2/3?e+(t-e)*6*(2/3-i):e}class Rt{constructor(t,i,r){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(t,i,r)}set(t,i,r){if(i===void 0&&r===void 0){const n=t;n&&n.isColor?this.copy(n):typeof n=="number"?this.setHex(n):typeof n=="string"&&this.setStyle(n)}else this.setRGB(t,i,r);return this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,i=Qa){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(t&255)/255,Xi.toWorkingColorSpace(this,i),this}setRGB(t,i,r,n=Xi.workingColorSpace){return this.r=t,this.g=i,this.b=r,Xi.toWorkingColorSpace(this,n),this}setHSL(t,i,r,n=Xi.workingColorSpace){if(t=Y4(t,1),i=wi(i,0,1),r=wi(r,0,1),i===0)this.r=this.g=this.b=r;else{const s=r<=.5?r*(1+i):r+i-r*i,a=2*r-s;this.r=HI(a,s,t+1/3),this.g=HI(a,s,t),this.b=HI(a,s,t-1/3)}return Xi.toWorkingColorSpace(this,n),this}setStyle(t,i=Qa){function r(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let n;if(n=/^(\w+)\(([^\)]*)\)/.exec(t)){let s;const a=n[1],o=n[2];switch(a){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return r(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,i);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return r(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,i);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return r(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,i);break;default:console.warn("THREE.Color: Unknown color model "+t)}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(t)){const s=n[1],a=s.length;if(a===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,i);if(a===6)return this.setHex(parseInt(s,16),i);console.warn("THREE.Color: Invalid hex color "+t)}else if(t&&t.length>0)return this.setColorName(t,i);return this}setColorName(t,i=Qa){const r=Fne[t.toLowerCase()];return r!==void 0?this.setHex(r,i):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=bh(t.r),this.g=bh(t.g),this.b=bh(t.b),this}copyLinearToSRGB(t){return this.r=b0(t.r),this.g=b0(t.g),this.b=b0(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=Qa){return Xi.fromWorkingColorSpace(Ks.copy(this),t),Math.round(wi(Ks.r*255,0,255))*65536+Math.round(wi(Ks.g*255,0,255))*256+Math.round(wi(Ks.b*255,0,255))}getHexString(t=Qa){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,i=Xi.workingColorSpace){Xi.fromWorkingColorSpace(Ks.copy(this),i);const r=Ks.r,n=Ks.g,s=Ks.b,a=Math.max(r,n,s),o=Math.min(r,n,s);let l,c;const u=(o+a)/2;if(o===a)l=0,c=0;else{const h=a-o;switch(c=u<=.5?h/(a+o):h/(2-a-o),a){case r:l=(n-s)/h+(n<s?6:0);break;case n:l=(s-r)/h+2;break;case s:l=(r-n)/h+4;break}l/=6}return t.h=l,t.s=c,t.l=u,t}getRGB(t,i=Xi.workingColorSpace){return Xi.fromWorkingColorSpace(Ks.copy(this),i),t.r=Ks.r,t.g=Ks.g,t.b=Ks.b,t}getStyle(t=Qa){Xi.fromWorkingColorSpace(Ks.copy(this),t);const i=Ks.r,r=Ks.g,n=Ks.b;return t!==Qa?`color(${t} ${i.toFixed(3)} ${r.toFixed(3)} ${n.toFixed(3)})`:`rgb(${Math.round(i*255)},${Math.round(r*255)},${Math.round(n*255)})`}offsetHSL(t,i,r){return this.getHSL(yd),this.setHSL(yd.h+t,yd.s+i,yd.l+r)}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,i){return this.r=t.r+i.r,this.g=t.g+i.g,this.b=t.b+i.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,i){return this.r+=(t.r-this.r)*i,this.g+=(t.g-this.g)*i,this.b+=(t.b-this.b)*i,this}lerpColors(t,i,r){return this.r=t.r+(i.r-t.r)*r,this.g=t.g+(i.g-t.g)*r,this.b=t.b+(i.b-t.b)*r,this}lerpHSL(t,i){this.getHSL(yd),t.getHSL(XM);const r=$x(yd.h,XM.h,i),n=$x(yd.s,XM.s,i),s=$x(yd.l,XM.l,i);return this.setHSL(r,n,s),this}setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}applyMatrix3(t){const i=this.r,r=this.g,n=this.b,s=t.elements;return this.r=s[0]*i+s[3]*r+s[6]*n,this.g=s[1]*i+s[4]*r+s[7]*n,this.b=s[2]*i+s[5]*r+s[8]*n,this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,i=0){return this.r=t[i],this.g=t[i+1],this.b=t[i+2],this}toArray(t=[],i=0){return t[i]=this.r,t[i+1]=this.g,t[i+2]=this.b,t}fromBufferAttribute(t,i){return this.r=t.getX(i),this.g=t.getY(i),this.b=t.getZ(i),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Ks=new Rt;Rt.NAMES=Fne;let vGe=0;class ha extends pu{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:vGe++}),this.uuid=Lo(),this.name="",this.type="Material",this.blending=hm,this.side=Lh,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=pT,this.blendDst=mT,this.blendEquation=Od,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Rt(0,0,0),this.blendAlpha=0,this.depthFunc=Im,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=JB,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Dp,this.stencilZFail=Dp,this.stencilZPass=Dp,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(t!==void 0)for(const i in t){const r=t[i];if(r===void 0){console.warn(`THREE.Material: parameter '${i}' has value of undefined.`);continue}const n=this[i];if(n===void 0){console.warn(`THREE.Material: '${i}' is not a property of THREE.${this.type}.`);continue}n&&n.isColor?n.set(r):n&&n.isVector3&&r&&r.isVector3?n.copy(r):this[i]=r}}toJSON(t){const i=t===void 0||typeof t=="string";i&&(t={textures:{},images:{}});const r={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),this.roughness!==void 0&&(r.roughness=this.roughness),this.metalness!==void 0&&(r.metalness=this.metalness),this.sheen!==void 0&&(r.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(r.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(r.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(r.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(r.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(r.shininess=this.shininess),this.clearcoat!==void 0&&(r.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(r.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(r.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(r.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(r.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,r.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(r.dispersion=this.dispersion),this.iridescence!==void 0&&(r.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(r.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(r.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(r.iridescenceMap=this.iridescenceMap.toJSON(t).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(r.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(t).uuid),this.anisotropy!==void 0&&(r.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(r.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(r.anisotropyMap=this.anisotropyMap.toJSON(t).uuid),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(r.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(t).uuid,r.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(r.aoMap=this.aoMap.toJSON(t).uuid,r.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(t).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(t).uuid,r.normalMapType=this.normalMapType,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(t).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(r.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(r.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(t).uuid,this.combine!==void 0&&(r.combine=this.combine)),this.envMapRotation!==void 0&&(r.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(r.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(r.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(r.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(t).uuid),this.transmission!==void 0&&(r.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(r.transmissionMap=this.transmissionMap.toJSON(t).uuid),this.thickness!==void 0&&(r.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(r.thicknessMap=this.thicknessMap.toJSON(t).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(r.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(r.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(r.size=this.size),this.shadowSide!==null&&(r.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(r.sizeAttenuation=this.sizeAttenuation),this.blending!==hm&&(r.blending=this.blending),this.side!==Lh&&(r.side=this.side),this.vertexColors===!0&&(r.vertexColors=!0),this.opacity<1&&(r.opacity=this.opacity),this.transparent===!0&&(r.transparent=!0),this.blendSrc!==pT&&(r.blendSrc=this.blendSrc),this.blendDst!==mT&&(r.blendDst=this.blendDst),this.blendEquation!==Od&&(r.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(r.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(r.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(r.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(r.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(r.blendAlpha=this.blendAlpha),this.depthFunc!==Im&&(r.depthFunc=this.depthFunc),this.depthTest===!1&&(r.depthTest=this.depthTest),this.depthWrite===!1&&(r.depthWrite=this.depthWrite),this.colorWrite===!1&&(r.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(r.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==JB&&(r.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(r.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(r.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==Dp&&(r.stencilFail=this.stencilFail),this.stencilZFail!==Dp&&(r.stencilZFail=this.stencilZFail),this.stencilZPass!==Dp&&(r.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(r.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(r.rotation=this.rotation),this.polygonOffset===!0&&(r.polygonOffset=!0),this.polygonOffsetFactor!==0&&(r.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(r.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(r.linewidth=this.linewidth),this.dashSize!==void 0&&(r.dashSize=this.dashSize),this.gapSize!==void 0&&(r.gapSize=this.gapSize),this.scale!==void 0&&(r.scale=this.scale),this.dithering===!0&&(r.dithering=!0),this.alphaTest>0&&(r.alphaTest=this.alphaTest),this.alphaHash===!0&&(r.alphaHash=!0),this.alphaToCoverage===!0&&(r.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(r.premultipliedAlpha=!0),this.forceSinglePass===!0&&(r.forceSinglePass=!0),this.wireframe===!0&&(r.wireframe=!0),this.wireframeLinewidth>1&&(r.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(r.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(r.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(r.flatShading=!0),this.visible===!1&&(r.visible=!1),this.toneMapped===!1&&(r.toneMapped=!1),this.fog===!1&&(r.fog=!1),Object.keys(this.userData).length>0&&(r.userData=this.userData);function n(s){const a=[];for(const o in s){const l=s[o];delete l.metadata,a.push(l)}return a}if(i){const s=n(t.textures),a=n(t.images);s.length>0&&(r.textures=s),a.length>0&&(r.images=a)}return r}clone(){return new this.constructor().copy(this)}copy(t){this.name=t.name,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.blendColor.copy(t.blendColor),this.blendAlpha=t.blendAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const i=t.clippingPlanes;let r=null;if(i!==null){const n=i.length;r=new Array(n);for(let s=0;s!==n;++s)r[s]=i[s].clone()}return this.clippingPlanes=r,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaHash=t.alphaHash,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.forceSinglePass=t.forceSinglePass,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){t===!0&&this.version++}onBuild(){console.warn("Material: onBuild() has been removed.")}}class kh extends ha{constructor(t){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Rt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Fo,this.combine=jb,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}const nh=yGe();function yGe(){const e=new ArrayBuffer(4),t=new Float32Array(e),i=new Uint32Array(e),r=new Uint32Array(512),n=new Uint32Array(512);for(let l=0;l<256;++l){const c=l-127;c<-27?(r[l]=0,r[l|256]=32768,n[l]=24,n[l|256]=24):c<-14?(r[l]=1024>>-c-14,r[l|256]=1024>>-c-14|32768,n[l]=-c-1,n[l|256]=-c-1):c<=15?(r[l]=c+15<<10,r[l|256]=c+15<<10|32768,n[l]=13,n[l|256]=13):c<128?(r[l]=31744,r[l|256]=64512,n[l]=24,n[l|256]=24):(r[l]=31744,r[l|256]=64512,n[l]=13,n[l|256]=13)}const s=new Uint32Array(2048),a=new Uint32Array(64),o=new Uint32Array(64);for(let l=1;l<1024;++l){let c=l<<13,u=0;for(;!(c&8388608);)c<<=1,u-=8388608;c&=-8388609,u+=947912704,s[l]=c|u}for(let l=1024;l<2048;++l)s[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)a[l]=l<<23;a[31]=1199570944,a[32]=2147483648;for(let l=33;l<63;++l)a[l]=2147483648+(l-32<<23);a[63]=3347054592;for(let l=1;l<64;++l)l!==32&&(o[l]=1024);return{floatView:t,uint32View:i,baseTable:r,shiftTable:n,mantissaTable:s,exponentTable:a,offsetTable:o}}function qa(e){Math.abs(e)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),e=wi(e,-65504,65504),nh.floatView[0]=e;const t=nh.uint32View[0],i=t>>23&511;return nh.baseTable[i]+((t&8388607)>>nh.shiftTable[i])}function px(e){const t=e>>10;return nh.uint32View[0]=nh.mantissaTable[nh.offsetTable[t]+(e&1023)]+nh.exponentTable[t],nh.floatView[0]}class xGe{static toHalfFloat(t){return qa(t)}static fromHalfFloat(t){return px(t)}}const An=new he,qM=new ut;let wGe=0;class mr{constructor(t,i,r=!1){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:wGe++}),this.name="",this.array=t,this.itemSize=i,this.count=t!==void 0?t.length/i:0,this.normalized=r,this.usage=sb,this.updateRanges=[],this.gpuType=so,this.version=0}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}setUsage(t){return this.usage=t,this}addUpdateRange(t,i){this.updateRanges.push({start:t,count:i})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this.gpuType=t.gpuType,this}copyAt(t,i,r){t*=this.itemSize,r*=i.itemSize;for(let n=0,s=this.itemSize;n<s;n++)this.array[t+n]=i.array[r+n];return this}copyArray(t){return this.array.set(t),this}applyMatrix3(t){if(this.itemSize===2)for(let i=0,r=this.count;i<r;i++)qM.fromBufferAttribute(this,i),qM.applyMatrix3(t),this.setXY(i,qM.x,qM.y);else if(this.itemSize===3)for(let i=0,r=this.count;i<r;i++)An.fromBufferAttribute(this,i),An.applyMatrix3(t),this.setXYZ(i,An.x,An.y,An.z);return this}applyMatrix4(t){for(let i=0,r=this.count;i<r;i++)An.fromBufferAttribute(this,i),An.applyMatrix4(t),this.setXYZ(i,An.x,An.y,An.z);return this}applyNormalMatrix(t){for(let i=0,r=this.count;i<r;i++)An.fromBufferAttribute(this,i),An.applyNormalMatrix(t),this.setXYZ(i,An.x,An.y,An.z);return this}transformDirection(t){for(let i=0,r=this.count;i<r;i++)An.fromBufferAttribute(this,i),An.transformDirection(t),this.setXYZ(i,An.x,An.y,An.z);return this}set(t,i=0){return this.array.set(t,i),this}getComponent(t,i){let r=this.array[t*this.itemSize+i];return this.normalized&&(r=Pa(r,this.array)),r}setComponent(t,i,r){return this.normalized&&(r=Ti(r,this.array)),this.array[t*this.itemSize+i]=r,this}getX(t){let i=this.array[t*this.itemSize];return this.normalized&&(i=Pa(i,this.array)),i}setX(t,i){return this.normalized&&(i=Ti(i,this.array)),this.array[t*this.itemSize]=i,this}getY(t){let i=this.array[t*this.itemSize+1];return this.normalized&&(i=Pa(i,this.array)),i}setY(t,i){return this.normalized&&(i=Ti(i,this.array)),this.array[t*this.itemSize+1]=i,this}getZ(t){let i=this.array[t*this.itemSize+2];return this.normalized&&(i=Pa(i,this.array)),i}setZ(t,i){return this.normalized&&(i=Ti(i,this.array)),this.array[t*this.itemSize+2]=i,this}getW(t){let i=this.array[t*this.itemSize+3];return this.normalized&&(i=Pa(i,this.array)),i}setW(t,i){return this.normalized&&(i=Ti(i,this.array)),this.array[t*this.itemSize+3]=i,this}setXY(t,i,r){return t*=this.itemSize,this.normalized&&(i=Ti(i,this.array),r=Ti(r,this.array)),this.array[t+0]=i,this.array[t+1]=r,this}setXYZ(t,i,r,n){return t*=this.itemSize,this.normalized&&(i=Ti(i,this.array),r=Ti(r,this.array),n=Ti(n,this.array)),this.array[t+0]=i,this.array[t+1]=r,this.array[t+2]=n,this}setXYZW(t,i,r,n,s){return t*=this.itemSize,this.normalized&&(i=Ti(i,this.array),r=Ti(r,this.array),n=Ti(n,this.array),s=Ti(s,this.array)),this.array[t+0]=i,this.array[t+1]=r,this.array[t+2]=n,this.array[t+3]=s,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(t.name=this.name),this.usage!==sb&&(t.usage=this.usage),t}}class bGe extends mr{constructor(t,i,r){super(new Int8Array(t),i,r)}}class _Ge extends mr{constructor(t,i,r){super(new Uint8Array(t),i,r)}}class SGe extends mr{constructor(t,i,r){super(new Uint8ClampedArray(t),i,r)}}class MGe extends mr{constructor(t,i,r){super(new Int16Array(t),i,r)}}class Q4 extends mr{constructor(t,i,r){super(new Uint16Array(t),i,r)}}class EGe extends mr{constructor(t,i,r){super(new Int32Array(t),i,r)}}class Z4 extends mr{constructor(t,i,r){super(new Uint32Array(t),i,r)}}class AGe extends mr{constructor(t,i,r){super(new Uint16Array(t),i,r),this.isFloat16BufferAttribute=!0}getX(t){let i=px(this.array[t*this.itemSize]);return this.normalized&&(i=Pa(i,this.array)),i}setX(t,i){return this.normalized&&(i=Ti(i,this.array)),this.array[t*this.itemSize]=qa(i),this}getY(t){let i=px(this.array[t*this.itemSize+1]);return this.normalized&&(i=Pa(i,this.array)),i}setY(t,i){return this.normalized&&(i=Ti(i,this.array)),this.array[t*this.itemSize+1]=qa(i),this}getZ(t){let i=px(this.array[t*this.itemSize+2]);return this.normalized&&(i=Pa(i,this.array)),i}setZ(t,i){return this.normalized&&(i=Ti(i,this.array)),this.array[t*this.itemSize+2]=qa(i),this}getW(t){let i=px(this.array[t*this.itemSize+3]);return this.normalized&&(i=Pa(i,this.array)),i}setW(t,i){return this.normalized&&(i=Ti(i,this.array)),this.array[t*this.itemSize+3]=qa(i),this}setXY(t,i,r){return t*=this.itemSize,this.normalized&&(i=Ti(i,this.array),r=Ti(r,this.array)),this.array[t+0]=qa(i),this.array[t+1]=qa(r),this}setXYZ(t,i,r,n){return t*=this.itemSize,this.normalized&&(i=Ti(i,this.array),r=Ti(r,this.array),n=Ti(n,this.array)),this.array[t+0]=qa(i),this.array[t+1]=qa(r),this.array[t+2]=qa(n),this}setXYZW(t,i,r,n,s){return t*=this.itemSize,this.normalized&&(i=Ti(i,this.array),r=Ti(r,this.array),n=Ti(n,this.array),s=Ti(s,this.array)),this.array[t+0]=qa(i),this.array[t+1]=qa(r),this.array[t+2]=qa(n),this.array[t+3]=qa(s),this}}class Gt extends mr{constructor(t,i,r){super(new Float32Array(t),i,r)}}let TGe=0;const il=new ci,jI=new Qi,rv=new he,Eo=new Us,U1=new Us,os=new he;class Pi extends pu{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:TGe++}),this.uuid=Lo(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(One(t)?Z4:Q4)(t,1):this.index=t,this}setIndirect(t){return this.indirect=t,this}getIndirect(){return this.indirect}getAttribute(t){return this.attributes[t]}setAttribute(t,i){return this.attributes[t]=i,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return this.attributes[t]!==void 0}addGroup(t,i,r=0){this.groups.push({start:t,count:i,materialIndex:r})}clearGroups(){this.groups=[]}setDrawRange(t,i){this.drawRange.start=t,this.drawRange.count=i}applyMatrix4(t){const i=this.attributes.position;i!==void 0&&(i.applyMatrix4(t),i.needsUpdate=!0);const r=this.attributes.normal;if(r!==void 0){const s=new xi().getNormalMatrix(t);r.applyNormalMatrix(s),r.needsUpdate=!0}const n=this.attributes.tangent;return n!==void 0&&(n.transformDirection(t),n.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(t){return il.makeRotationFromQuaternion(t),this.applyMatrix4(il),this}rotateX(t){return il.makeRotationX(t),this.applyMatrix4(il),this}rotateY(t){return il.makeRotationY(t),this.applyMatrix4(il),this}rotateZ(t){return il.makeRotationZ(t),this.applyMatrix4(il),this}translate(t,i,r){return il.makeTranslation(t,i,r),this.applyMatrix4(il),this}scale(t,i,r){return il.makeScale(t,i,r),this.applyMatrix4(il),this}lookAt(t){return jI.lookAt(t),jI.updateMatrix(),this.applyMatrix4(jI.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(rv).negate(),this.translate(rv.x,rv.y,rv.z),this}setFromPoints(t){const i=this.getAttribute("position");if(i===void 0){const r=[];for(let n=0,s=t.length;n<s;n++){const a=t[n];r.push(a.x,a.y,a.z||0)}this.setAttribute("position",new Gt(r,3))}else{const r=Math.min(t.length,i.count);for(let n=0;n<r;n++){const s=t[n];i.setXYZ(n,s.x,s.y,s.z||0)}t.length>i.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),i.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Us);const t=this.attributes.position,i=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new he(-1/0,-1/0,-1/0),new he(1/0,1/0,1/0));return}if(t!==void 0){if(this.boundingBox.setFromBufferAttribute(t),i)for(let r=0,n=i.length;r<n;r++){const s=i[r];Eo.setFromBufferAttribute(s),this.morphTargetsRelative?(os.addVectors(this.boundingBox.min,Eo.min),this.boundingBox.expandByPoint(os),os.addVectors(this.boundingBox.max,Eo.max),this.boundingBox.expandByPoint(os)):(this.boundingBox.expandByPoint(Eo.min),this.boundingBox.expandByPoint(Eo.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Ns);const t=this.attributes.position,i=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new he,1/0);return}if(t){const r=this.boundingSphere.center;if(Eo.setFromBufferAttribute(t),i)for(let s=0,a=i.length;s<a;s++){const o=i[s];U1.setFromBufferAttribute(o),this.morphTargetsRelative?(os.addVectors(Eo.min,U1.min),Eo.expandByPoint(os),os.addVectors(Eo.max,U1.max),Eo.expandByPoint(os)):(Eo.expandByPoint(U1.min),Eo.expandByPoint(U1.max))}Eo.getCenter(r);let n=0;for(let s=0,a=t.count;s<a;s++)os.fromBufferAttribute(t,s),n=Math.max(n,r.distanceToSquared(os));if(i)for(let s=0,a=i.length;s<a;s++){const o=i[s],l=this.morphTargetsRelative;for(let c=0,u=o.count;c<u;c++)os.fromBufferAttribute(o,c),l&&(rv.fromBufferAttribute(t,c),os.add(rv)),n=Math.max(n,r.distanceToSquared(os))}this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,i=this.attributes;if(t===null||i.position===void 0||i.normal===void 0||i.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const r=i.position,n=i.normal,s=i.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new mr(new Float32Array(4*r.count),4));const a=this.getAttribute("tangent"),o=[],l=[];for(let E=0;E<r.count;E++)o[E]=new he,l[E]=new he;const c=new he,u=new he,h=new he,d=new ut,f=new ut,p=new ut,v=new he,m=new he;function g(E,C,A){c.fromBufferAttribute(r,E),u.fromBufferAttribute(r,C),h.fromBufferAttribute(r,A),d.fromBufferAttribute(s,E),f.fromBufferAttribute(s,C),p.fromBufferAttribute(s,A),u.sub(c),h.sub(c),f.sub(d),p.sub(d);const D=1/(f.x*p.y-p.x*f.y);isFinite(D)&&(v.copy(u).multiplyScalar(p.y).addScaledVector(h,-f.y).multiplyScalar(D),m.copy(h).multiplyScalar(f.x).addScaledVector(u,-p.x).multiplyScalar(D),o[E].add(v),o[C].add(v),o[A].add(v),l[E].add(m),l[C].add(m),l[A].add(m))}let y=this.groups;y.length===0&&(y=[{start:0,count:t.count}]);for(let E=0,C=y.length;E<C;++E){const A=y[E],D=A.start,R=A.count;for(let L=D,O=D+R;L<O;L+=3)g(t.getX(L+0),t.getX(L+1),t.getX(L+2))}const x=new he,_=new he,M=new he,S=new he;function T(E){M.fromBufferAttribute(n,E),S.copy(M);const C=o[E];x.copy(C),x.sub(M.multiplyScalar(M.dot(C))).normalize(),_.crossVectors(S,C);const D=_.dot(l[E])<0?-1:1;a.setXYZW(E,x.x,x.y,x.z,D)}for(let E=0,C=y.length;E<C;++E){const A=y[E],D=A.start,R=A.count;for(let L=D,O=D+R;L<O;L+=3)T(t.getX(L+0)),T(t.getX(L+1)),T(t.getX(L+2))}}computeVertexNormals(){const t=this.index,i=this.getAttribute("position");if(i!==void 0){let r=this.getAttribute("normal");if(r===void 0)r=new mr(new Float32Array(i.count*3),3),this.setAttribute("normal",r);else for(let d=0,f=r.count;d<f;d++)r.setXYZ(d,0,0,0);const n=new he,s=new he,a=new he,o=new he,l=new he,c=new he,u=new he,h=new he;if(t)for(let d=0,f=t.count;d<f;d+=3){const p=t.getX(d+0),v=t.getX(d+1),m=t.getX(d+2);n.fromBufferAttribute(i,p),s.fromBufferAttribute(i,v),a.fromBufferAttribute(i,m),u.subVectors(a,s),h.subVectors(n,s),u.cross(h),o.fromBufferAttribute(r,p),l.fromBufferAttribute(r,v),c.fromBufferAttribute(r,m),o.add(u),l.add(u),c.add(u),r.setXYZ(p,o.x,o.y,o.z),r.setXYZ(v,l.x,l.y,l.z),r.setXYZ(m,c.x,c.y,c.z)}else for(let d=0,f=i.count;d<f;d+=3)n.fromBufferAttribute(i,d+0),s.fromBufferAttribute(i,d+1),a.fromBufferAttribute(i,d+2),u.subVectors(a,s),h.subVectors(n,s),u.cross(h),r.setXYZ(d+0,u.x,u.y,u.z),r.setXYZ(d+1,u.x,u.y,u.z),r.setXYZ(d+2,u.x,u.y,u.z);this.normalizeNormals(),r.needsUpdate=!0}}normalizeNormals(){const t=this.attributes.normal;for(let i=0,r=t.count;i<r;i++)os.fromBufferAttribute(t,i),os.normalize(),t.setXYZ(i,os.x,os.y,os.z)}toNonIndexed(){function t(o,l){const c=o.array,u=o.itemSize,h=o.normalized,d=new c.constructor(l.length*u);let f=0,p=0;for(let v=0,m=l.length;v<m;v++){o.isInterleavedBufferAttribute?f=l[v]*o.data.stride+o.offset:f=l[v]*u;for(let g=0;g<u;g++)d[p++]=c[f++]}return new mr(d,u,h)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const i=new Pi,r=this.index.array,n=this.attributes;for(const o in n){const l=n[o],c=t(l,r);i.setAttribute(o,c)}const s=this.morphAttributes;for(const o in s){const l=[],c=s[o];for(let u=0,h=c.length;u<h;u++){const d=c[u],f=t(d,r);l.push(f)}i.morphAttributes[o]=l}i.morphTargetsRelative=this.morphTargetsRelative;const a=this.groups;for(let o=0,l=a.length;o<l;o++){const c=a[o];i.addGroup(c.start,c.count,c.materialIndex)}return i}toJSON(){const t={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,this.name!==""&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),this.parameters!==void 0){const l=this.parameters;for(const c in l)l[c]!==void 0&&(t[c]=l[c]);return t}t.data={attributes:{}};const i=this.index;i!==null&&(t.data.index={type:i.array.constructor.name,array:Array.prototype.slice.call(i.array)});const r=this.attributes;for(const l in r){const c=r[l];t.data.attributes[l]=c.toJSON(t.data)}const n={};let s=!1;for(const l in this.morphAttributes){const c=this.morphAttributes[l],u=[];for(let h=0,d=c.length;h<d;h++){const f=c[h];u.push(f.toJSON(t.data))}u.length>0&&(n[l]=u,s=!0)}s&&(t.data.morphAttributes=n,t.data.morphTargetsRelative=this.morphTargetsRelative);const a=this.groups;a.length>0&&(t.data.groups=JSON.parse(JSON.stringify(a)));const o=this.boundingSphere;return o!==null&&(t.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),t}clone(){return new this.constructor().copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const i={};this.name=t.name;const r=t.index;r!==null&&this.setIndex(r.clone(i));const n=t.attributes;for(const c in n){const u=n[c];this.setAttribute(c,u.clone(i))}const s=t.morphAttributes;for(const c in s){const u=[],h=s[c];for(let d=0,f=h.length;d<f;d++)u.push(h[d].clone(i));this.morphAttributes[c]=u}this.morphTargetsRelative=t.morphTargetsRelative;const a=t.groups;for(let c=0,u=a.length;c<u;c++){const h=a[c];this.addGroup(h.start,h.count,h.materialIndex)}const o=t.boundingBox;o!==null&&(this.boundingBox=o.clone());const l=t.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const wX=new ci,op=new Zm,YM=new Ns,bX=new he,QM=new he,ZM=new he,KM=new he,WI=new he,JM=new he,_X=new he,$M=new he;class Gr extends Qi{constructor(t=new Pi,i=new kh){super(),this.isMesh=!0,this.type="Mesh",this.geometry=t,this.material=i,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(t,i){return super.copy(t,i),t.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),t.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}updateMorphTargets(){const i=this.geometry.morphAttributes,r=Object.keys(i);if(r.length>0){const n=i[r[0]];if(n!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,a=n.length;s<a;s++){const o=n[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=s}}}}getVertexPosition(t,i){const r=this.geometry,n=r.attributes.position,s=r.morphAttributes.position,a=r.morphTargetsRelative;i.fromBufferAttribute(n,t);const o=this.morphTargetInfluences;if(s&&o){JM.set(0,0,0);for(let l=0,c=s.length;l<c;l++){const u=o[l],h=s[l];u!==0&&(WI.fromBufferAttribute(h,t),a?JM.addScaledVector(WI,u):JM.addScaledVector(WI.sub(i),u))}i.add(JM)}return i}raycast(t,i){const r=this.geometry,n=this.material,s=this.matrixWorld;n!==void 0&&(r.boundingSphere===null&&r.computeBoundingSphere(),YM.copy(r.boundingSphere),YM.applyMatrix4(s),op.copy(t.ray).recast(t.near),!(YM.containsPoint(op.origin)===!1&&(op.intersectSphere(YM,bX)===null||op.origin.distanceToSquared(bX)>(t.far-t.near)**2))&&(wX.copy(s).invert(),op.copy(t.ray).applyMatrix4(wX),!(r.boundingBox!==null&&op.intersectsBox(r.boundingBox)===!1)&&this._computeIntersections(t,i,op)))}_computeIntersections(t,i,r){let n;const s=this.geometry,a=this.material,o=s.index,l=s.attributes.position,c=s.attributes.uv,u=s.attributes.uv1,h=s.attributes.normal,d=s.groups,f=s.drawRange;if(o!==null)if(Array.isArray(a))for(let p=0,v=d.length;p<v;p++){const m=d[p],g=a[m.materialIndex],y=Math.max(m.start,f.start),x=Math.min(o.count,Math.min(m.start+m.count,f.start+f.count));for(let _=y,M=x;_<M;_+=3){const S=o.getX(_),T=o.getX(_+1),E=o.getX(_+2);n=eE(this,g,t,r,c,u,h,S,T,E),n&&(n.faceIndex=Math.floor(_/3),n.face.materialIndex=m.materialIndex,i.push(n))}}else{const p=Math.max(0,f.start),v=Math.min(o.count,f.start+f.count);for(let m=p,g=v;m<g;m+=3){const y=o.getX(m),x=o.getX(m+1),_=o.getX(m+2);n=eE(this,a,t,r,c,u,h,y,x,_),n&&(n.faceIndex=Math.floor(m/3),i.push(n))}}else if(l!==void 0)if(Array.isArray(a))for(let p=0,v=d.length;p<v;p++){const m=d[p],g=a[m.materialIndex],y=Math.max(m.start,f.start),x=Math.min(l.count,Math.min(m.start+m.count,f.start+f.count));for(let _=y,M=x;_<M;_+=3){const S=_,T=_+1,E=_+2;n=eE(this,g,t,r,c,u,h,S,T,E),n&&(n.faceIndex=Math.floor(_/3),n.face.materialIndex=m.materialIndex,i.push(n))}}else{const p=Math.max(0,f.start),v=Math.min(l.count,f.start+f.count);for(let m=p,g=v;m<g;m+=3){const y=m,x=m+1,_=m+2;n=eE(this,a,t,r,c,u,h,y,x,_),n&&(n.faceIndex=Math.floor(m/3),i.push(n))}}}}function CGe(e,t,i,r,n,s,a,o){let l;if(t.side===La?l=r.intersectTriangle(a,s,n,!0,o):l=r.intersectTriangle(n,s,a,t.side===Lh,o),l===null)return null;$M.copy(o),$M.applyMatrix4(e.matrixWorld);const c=i.ray.origin.distanceTo($M);return c<i.near||c>i.far?null:{distance:c,point:$M.clone(),object:e}}function eE(e,t,i,r,n,s,a,o,l,c){e.getVertexPosition(o,QM),e.getVertexPosition(l,ZM),e.getVertexPosition(c,KM);const u=CGe(e,t,i,r,QM,ZM,KM,_X);if(u){const h=new he;to.getBarycoord(_X,QM,ZM,KM,h),n&&(u.uv=to.getInterpolatedAttribute(n,o,l,c,h,new ut)),s&&(u.uv1=to.getInterpolatedAttribute(s,o,l,c,h,new ut)),a&&(u.normal=to.getInterpolatedAttribute(a,o,l,c,h,new he),u.normal.dot(r.direction)>0&&u.normal.multiplyScalar(-1));const d={a:o,b:l,c,normal:new he,materialIndex:0};to.getNormal(QM,ZM,KM,d.normal),u.face=d,u.barycoord=h}return u}class Km extends Pi{constructor(t=1,i=1,r=1,n=1,s=1,a=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:i,depth:r,widthSegments:n,heightSegments:s,depthSegments:a};const o=this;n=Math.floor(n),s=Math.floor(s),a=Math.floor(a);const l=[],c=[],u=[],h=[];let d=0,f=0;p("z","y","x",-1,-1,r,i,t,a,s,0),p("z","y","x",1,-1,r,i,-t,a,s,1),p("x","z","y",1,1,t,r,i,n,a,2),p("x","z","y",1,-1,t,r,-i,n,a,3),p("x","y","z",1,-1,t,i,r,n,s,4),p("x","y","z",-1,-1,t,i,-r,n,s,5),this.setIndex(l),this.setAttribute("position",new Gt(c,3)),this.setAttribute("normal",new Gt(u,3)),this.setAttribute("uv",new Gt(h,2));function p(v,m,g,y,x,_,M,S,T,E,C){const A=_/T,D=M/E,R=_/2,L=M/2,O=S/2,H=T+1,j=E+1;let Y=0,z=0;const V=new he;for(let U=0;U<j;U++){const k=U*D-L;for(let X=0;X<H;X++){const re=X*A-R;V[v]=re*y,V[m]=k*x,V[g]=O,c.push(V.x,V.y,V.z),V[v]=0,V[m]=0,V[g]=S>0?1:-1,u.push(V.x,V.y,V.z),h.push(X/T),h.push(1-U/E),Y+=1}}for(let U=0;U<E;U++)for(let k=0;k<T;k++){const X=d+k+H*U,re=d+k+H*(U+1),q=d+(k+1)+H*(U+1),ee=d+(k+1)+H*U;l.push(X,re,ee),l.push(re,q,ee),z+=6}o.addGroup(f,z,C),f+=z,d+=Y}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Km(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}}function Q0(e){const t={};for(const i in e){t[i]={};for(const r in e[i]){const n=e[i][r];n&&(n.isColor||n.isMatrix3||n.isMatrix4||n.isVector2||n.isVector3||n.isVector4||n.isTexture||n.isQuaternion)?n.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),t[i][r]=null):t[i][r]=n.clone():Array.isArray(n)?t[i][r]=n.slice():t[i][r]=n}}return t}function Ma(e){const t={};for(let i=0;i<e.length;i++){const r=Q0(e[i]);for(const n in r)t[n]=r[n]}return t}function PGe(e){const t=[];for(let i=0;i<e.length;i++)t.push(e[i].clone());return t}function Une(e){const t=e.getRenderTarget();return t===null?e.outputColorSpace:t.isXRRenderTarget===!0?t.texture.colorSpace:Xi.workingColorSpace}const K4={clone:Q0,merge:Ma};var DGe=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,RGe=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class cc extends ha{constructor(t){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=DGe,this.fragmentShader=RGe,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,t!==void 0&&this.setValues(t)}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=Q0(t.uniforms),this.uniformsGroups=PGe(t.uniformsGroups),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.fog=t.fog,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){const i=super.toJSON(t);i.glslVersion=this.glslVersion,i.uniforms={};for(const n in this.uniforms){const a=this.uniforms[n].value;a&&a.isTexture?i.uniforms[n]={type:"t",value:a.toJSON(t).uuid}:a&&a.isColor?i.uniforms[n]={type:"c",value:a.getHex()}:a&&a.isVector2?i.uniforms[n]={type:"v2",value:a.toArray()}:a&&a.isVector3?i.uniforms[n]={type:"v3",value:a.toArray()}:a&&a.isVector4?i.uniforms[n]={type:"v4",value:a.toArray()}:a&&a.isMatrix3?i.uniforms[n]={type:"m3",value:a.toArray()}:a&&a.isMatrix4?i.uniforms[n]={type:"m4",value:a.toArray()}:i.uniforms[n]={value:a}}Object.keys(this.defines).length>0&&(i.defines=this.defines),i.vertexShader=this.vertexShader,i.fragmentShader=this.fragmentShader,i.lights=this.lights,i.clipping=this.clipping;const r={};for(const n in this.extensions)this.extensions[n]===!0&&(r[n]=!0);return Object.keys(r).length>0&&(i.extensions=r),i}}class qb extends Qi{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new ci,this.projectionMatrix=new ci,this.projectionMatrixInverse=new ci,this.coordinateSystem=$l}copy(t,i){return super.copy(t,i),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this.coordinateSystem=t.coordinateSystem,this}getWorldDirection(t){return super.getWorldDirection(t).negate()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,i){super.updateWorldMatrix(t,i),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const xd=new he,SX=new ut,MX=new ut;class fn extends qb{constructor(t=50,i=1,r=.1,n=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=r,this.far=n,this.focus=10,this.aspect=i,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,i){return super.copy(t,i),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=t.view===null?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){const i=.5*this.getFilmHeight()/t;this.fov=Y0*2*Math.atan(i),this.updateProjectionMatrix()}getFocalLength(){const t=Math.tan(fm*.5*this.fov);return .5*this.getFilmHeight()/t}getEffectiveFOV(){return Y0*2*Math.atan(Math.tan(fm*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(t,i,r){xd.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),i.set(xd.x,xd.y).multiplyScalar(-t/xd.z),xd.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),r.set(xd.x,xd.y).multiplyScalar(-t/xd.z)}getViewSize(t,i){return this.getViewBounds(t,SX,MX),i.subVectors(MX,SX)}setViewOffset(t,i,r,n,s,a){this.aspect=t/i,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=i,this.view.offsetX=r,this.view.offsetY=n,this.view.width=s,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=this.near;let i=t*Math.tan(fm*.5*this.fov)/this.zoom,r=2*i,n=this.aspect*r,s=-.5*n;const a=this.view;if(this.view!==null&&this.view.enabled){const l=a.fullWidth,c=a.fullHeight;s+=a.offsetX*n/l,i-=a.offsetY*r/c,n*=a.width/l,r*=a.height/c}const o=this.filmOffset;o!==0&&(s+=t*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+n,i,i-r,t,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const i=super.toJSON(t);return i.object.fov=this.fov,i.object.zoom=this.zoom,i.object.near=this.near,i.object.far=this.far,i.object.focus=this.focus,i.object.aspect=this.aspect,this.view!==null&&(i.object.view=Object.assign({},this.view)),i.object.filmGauge=this.filmGauge,i.object.filmOffset=this.filmOffset,i}}const nv=-90,sv=1;class Nne extends Qi{constructor(t,i,r){super(),this.type="CubeCamera",this.renderTarget=r,this.coordinateSystem=null,this.activeMipmapLevel=0;const n=new fn(nv,sv,t,i);n.layers=this.layers,this.add(n);const s=new fn(nv,sv,t,i);s.layers=this.layers,this.add(s);const a=new fn(nv,sv,t,i);a.layers=this.layers,this.add(a);const o=new fn(nv,sv,t,i);o.layers=this.layers,this.add(o);const l=new fn(nv,sv,t,i);l.layers=this.layers,this.add(l);const c=new fn(nv,sv,t,i);c.layers=this.layers,this.add(c)}updateCoordinateSystem(){const t=this.coordinateSystem,i=this.children.concat(),[r,n,s,a,o,l]=i;for(const c of i)this.remove(c);if(t===$l)r.up.set(0,1,0),r.lookAt(1,0,0),n.up.set(0,1,0),n.lookAt(-1,0,0),s.up.set(0,0,-1),s.lookAt(0,1,0),a.up.set(0,0,1),a.lookAt(0,-1,0),o.up.set(0,1,0),o.lookAt(0,0,1),l.up.set(0,1,0),l.lookAt(0,0,-1);else if(t===ab)r.up.set(0,-1,0),r.lookAt(-1,0,0),n.up.set(0,-1,0),n.lookAt(1,0,0),s.up.set(0,0,1),s.lookAt(0,1,0),a.up.set(0,0,-1),a.lookAt(0,-1,0),o.up.set(0,-1,0),o.lookAt(0,0,1),l.up.set(0,-1,0),l.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+t);for(const c of i)this.add(c),c.updateMatrixWorld()}update(t,i){this.parent===null&&this.updateMatrixWorld();const{renderTarget:r,activeMipmapLevel:n}=this;this.coordinateSystem!==t.coordinateSystem&&(this.coordinateSystem=t.coordinateSystem,this.updateCoordinateSystem());const[s,a,o,l,c,u]=this.children,h=t.getRenderTarget(),d=t.getActiveCubeFace(),f=t.getActiveMipmapLevel(),p=t.xr.enabled;t.xr.enabled=!1;const v=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,t.setRenderTarget(r,0,n),t.render(i,s),t.setRenderTarget(r,1,n),t.render(i,a),t.setRenderTarget(r,2,n),t.render(i,o),t.setRenderTarget(r,3,n),t.render(i,l),t.setRenderTarget(r,4,n),t.render(i,c),r.texture.generateMipmaps=v,t.setRenderTarget(r,5,n),t.render(i,u),t.setRenderTarget(h,d,f),t.xr.enabled=p,r.texture.needsPMREMUpdate=!0}}class Yb extends Wr{constructor(t,i,r,n,s,a,o,l,c,u){t=t!==void 0?t:[],i=i!==void 0?i:Oh,super(t,i,r,n,s,a,o,l,c,u),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(t){this.image=t}}class kne extends uu{constructor(t=1,i={}){super(t,t,i),this.isWebGLCubeRenderTarget=!0;const r={width:t,height:t,depth:1},n=[r,r,r,r,r,r];this.texture=new Yb(n,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=i.generateMipmaps!==void 0?i.generateMipmaps:!1,this.texture.minFilter=i.minFilter!==void 0?i.minFilter:pn}fromEquirectangularTexture(t,i){this.texture.type=i.type,this.texture.colorSpace=i.colorSpace,this.texture.generateMipmaps=i.generateMipmaps,this.texture.minFilter=i.minFilter,this.texture.magFilter=i.magFilter;const r={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},n=new Km(5,5,5),s=new cc({name:"CubemapFromEquirect",uniforms:Q0(r.uniforms),vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,side:La,blending:wh});s.uniforms.tEquirect.value=i;const a=new Gr(n,s),o=i.minFilter;return i.minFilter===qc&&(i.minFilter=pn),new Nne(1,10,this).update(t,a),i.minFilter=o,a.geometry.dispose(),a.material.dispose(),this}clear(t,i,r,n){const s=t.getRenderTarget();for(let a=0;a<6;a++)t.setRenderTarget(this,a),t.clear(i,r,n);t.setRenderTarget(s)}}class Kv extends Qi{constructor(){super(),this.isGroup=!0,this.type="Group"}}const IGe={type:"move"};class y2{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Kv,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Kv,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new he,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new he),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Kv,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new he,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new he),this._grip}dispatchEvent(t){return this._targetRay!==null&&this._targetRay.dispatchEvent(t),this._grip!==null&&this._grip.dispatchEvent(t),this._hand!==null&&this._hand.dispatchEvent(t),this}connect(t){if(t&&t.hand){const i=this._hand;if(i)for(const r of t.hand.values())this._getHandJoint(i,r)}return this.dispatchEvent({type:"connected",data:t}),this}disconnect(t){return this.dispatchEvent({type:"disconnected",data:t}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(t,i,r){let n=null,s=null,a=null;const o=this._targetRay,l=this._grip,c=this._hand;if(t&&i.session.visibilityState!=="visible-blurred"){if(c&&t.hand){a=!0;for(const v of t.hand.values()){const m=i.getJointPose(v,r),g=this._getHandJoint(c,v);m!==null&&(g.matrix.fromArray(m.transform.matrix),g.matrix.decompose(g.position,g.rotation,g.scale),g.matrixWorldNeedsUpdate=!0,g.jointRadius=m.radius),g.visible=m!==null}const u=c.joints["index-finger-tip"],h=c.joints["thumb-tip"],d=u.position.distanceTo(h.position),f=.02,p=.005;c.inputState.pinching&&d>f+p?(c.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!c.inputState.pinching&&d<=f-p&&(c.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else l!==null&&t.gripSpace&&(s=i.getPose(t.gripSpace,r),s!==null&&(l.matrix.fromArray(s.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),l.matrixWorldNeedsUpdate=!0,s.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(s.linearVelocity)):l.hasLinearVelocity=!1,s.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(s.angularVelocity)):l.hasAngularVelocity=!1));o!==null&&(n=i.getPose(t.targetRaySpace,r),n===null&&s!==null&&(n=s),n!==null&&(o.matrix.fromArray(n.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,n.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(n.linearVelocity)):o.hasLinearVelocity=!1,n.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(n.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(IGe)))}return o!==null&&(o.visible=n!==null),l!==null&&(l.visible=s!==null),c!==null&&(c.visible=a!==null),this}_getHandJoint(t,i){if(t.joints[i.jointName]===void 0){const r=new Kv;r.matrixAutoUpdate=!1,r.visible=!1,t.joints[i.jointName]=r,t.add(r)}return t.joints[i.jointName]}}class uP{constructor(t,i=25e-5){this.isFogExp2=!0,this.name="",this.color=new Rt(t),this.density=i}clone(){return new uP(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}class hP{constructor(t,i=1,r=1e3){this.isFog=!0,this.name="",this.color=new Rt(t),this.near=i,this.far=r}clone(){return new hP(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class J4 extends Qi{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new Fo,this.environmentIntensity=1,this.environmentRotation=new Fo,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,i){return super.copy(t,i),t.background!==null&&(this.background=t.background.clone()),t.environment!==null&&(this.environment=t.environment.clone()),t.fog!==null&&(this.fog=t.fog.clone()),this.backgroundBlurriness=t.backgroundBlurriness,this.backgroundIntensity=t.backgroundIntensity,this.backgroundRotation.copy(t.backgroundRotation),this.environmentIntensity=t.environmentIntensity,this.environmentRotation.copy(t.environmentRotation),t.overrideMaterial!==null&&(this.overrideMaterial=t.overrideMaterial.clone()),this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const i=super.toJSON(t);return this.fog!==null&&(i.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(i.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(i.object.backgroundIntensity=this.backgroundIntensity),i.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(i.object.environmentIntensity=this.environmentIntensity),i.object.environmentRotation=this.environmentRotation.toArray(),i}}class dP{constructor(t,i){this.isInterleavedBuffer=!0,this.array=t,this.stride=i,this.count=t!==void 0?t.length/i:0,this.usage=sb,this.updateRanges=[],this.version=0,this.uuid=Lo()}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}setUsage(t){return this.usage=t,this}addUpdateRange(t,i){this.updateRanges.push({start:t,count:i})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}copyAt(t,i,r){t*=this.stride,r*=i.stride;for(let n=0,s=this.stride;n<s;n++)this.array[t+n]=i.array[r+n];return this}set(t,i=0){return this.array.set(t,i),this}clone(t){t.arrayBuffers===void 0&&(t.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Lo()),t.arrayBuffers[this.array.buffer._uuid]===void 0&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const i=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),r=new this.constructor(i,this.stride);return r.setUsage(this.usage),r}onUpload(t){return this.onUploadCallback=t,this}toJSON(t){return t.arrayBuffers===void 0&&(t.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Lo()),t.arrayBuffers[this.array.buffer._uuid]===void 0&&(t.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const _a=new he;class Bm{constructor(t,i,r,n=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=t,this.itemSize=i,this.offset=r,this.normalized=n}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(t){this.data.needsUpdate=t}applyMatrix4(t){for(let i=0,r=this.data.count;i<r;i++)_a.fromBufferAttribute(this,i),_a.applyMatrix4(t),this.setXYZ(i,_a.x,_a.y,_a.z);return this}applyNormalMatrix(t){for(let i=0,r=this.count;i<r;i++)_a.fromBufferAttribute(this,i),_a.applyNormalMatrix(t),this.setXYZ(i,_a.x,_a.y,_a.z);return this}transformDirection(t){for(let i=0,r=this.count;i<r;i++)_a.fromBufferAttribute(this,i),_a.transformDirection(t),this.setXYZ(i,_a.x,_a.y,_a.z);return this}getComponent(t,i){let r=this.array[t*this.data.stride+this.offset+i];return this.normalized&&(r=Pa(r,this.array)),r}setComponent(t,i,r){return this.normalized&&(r=Ti(r,this.array)),this.data.array[t*this.data.stride+this.offset+i]=r,this}setX(t,i){return this.normalized&&(i=Ti(i,this.array)),this.data.array[t*this.data.stride+this.offset]=i,this}setY(t,i){return this.normalized&&(i=Ti(i,this.array)),this.data.array[t*this.data.stride+this.offset+1]=i,this}setZ(t,i){return this.normalized&&(i=Ti(i,this.array)),this.data.array[t*this.data.stride+this.offset+2]=i,this}setW(t,i){return this.normalized&&(i=Ti(i,this.array)),this.data.array[t*this.data.stride+this.offset+3]=i,this}getX(t){let i=this.data.array[t*this.data.stride+this.offset];return this.normalized&&(i=Pa(i,this.array)),i}getY(t){let i=this.data.array[t*this.data.stride+this.offset+1];return this.normalized&&(i=Pa(i,this.array)),i}getZ(t){let i=this.data.array[t*this.data.stride+this.offset+2];return this.normalized&&(i=Pa(i,this.array)),i}getW(t){let i=this.data.array[t*this.data.stride+this.offset+3];return this.normalized&&(i=Pa(i,this.array)),i}setXY(t,i,r){return t=t*this.data.stride+this.offset,this.normalized&&(i=Ti(i,this.array),r=Ti(r,this.array)),this.data.array[t+0]=i,this.data.array[t+1]=r,this}setXYZ(t,i,r,n){return t=t*this.data.stride+this.offset,this.normalized&&(i=Ti(i,this.array),r=Ti(r,this.array),n=Ti(n,this.array)),this.data.array[t+0]=i,this.data.array[t+1]=r,this.data.array[t+2]=n,this}setXYZW(t,i,r,n,s){return t=t*this.data.stride+this.offset,this.normalized&&(i=Ti(i,this.array),r=Ti(r,this.array),n=Ti(n,this.array),s=Ti(s,this.array)),this.data.array[t+0]=i,this.data.array[t+1]=r,this.data.array[t+2]=n,this.data.array[t+3]=s,this}clone(t){if(t===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const i=[];for(let r=0;r<this.count;r++){const n=r*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)i.push(this.data.array[n+s])}return new mr(new this.array.constructor(i),this.itemSize,this.normalized)}else return t.interleavedBuffers===void 0&&(t.interleavedBuffers={}),t.interleavedBuffers[this.data.uuid]===void 0&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new Bm(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(t){if(t===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const i=[];for(let r=0;r<this.count;r++){const n=r*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)i.push(this.data.array[n+s])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:i,normalized:this.normalized}}else return t.interleavedBuffers===void 0&&(t.interleavedBuffers={}),t.interleavedBuffers[this.data.uuid]===void 0&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class $4 extends ha{constructor(t){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new Rt(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}let av;const N1=new he,ov=new he,lv=new he,cv=new ut,k1=new ut,Vne=new ci,tE=new he,V1=new he,iE=new he,EX=new ut,XI=new ut,AX=new ut;class Gne extends Qi{constructor(t=new $4){if(super(),this.isSprite=!0,this.type="Sprite",av===void 0){av=new Pi;const i=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),r=new dP(i,5);av.setIndex([0,1,2,0,2,3]),av.setAttribute("position",new Bm(r,3,0,!1)),av.setAttribute("uv",new Bm(r,2,3,!1))}this.geometry=av,this.material=t,this.center=new ut(.5,.5)}raycast(t,i){t.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),ov.setFromMatrixScale(this.matrixWorld),Vne.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),lv.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&ov.multiplyScalar(-lv.z);const r=this.material.rotation;let n,s;r!==0&&(s=Math.cos(r),n=Math.sin(r));const a=this.center;rE(tE.set(-.5,-.5,0),lv,a,ov,n,s),rE(V1.set(.5,-.5,0),lv,a,ov,n,s),rE(iE.set(.5,.5,0),lv,a,ov,n,s),EX.set(0,0),XI.set(1,0),AX.set(1,1);let o=t.ray.intersectTriangle(tE,V1,iE,!1,N1);if(o===null&&(rE(V1.set(-.5,.5,0),lv,a,ov,n,s),XI.set(0,1),o=t.ray.intersectTriangle(tE,iE,V1,!1,N1),o===null))return;const l=t.ray.origin.distanceTo(N1);l<t.near||l>t.far||i.push({distance:l,point:N1.clone(),uv:to.getInterpolation(N1,tE,V1,iE,EX,XI,AX,new ut),face:null,object:this})}copy(t,i){return super.copy(t,i),t.center!==void 0&&this.center.copy(t.center),this.material=t.material,this}}function rE(e,t,i,r,n,s){cv.subVectors(e,i).addScalar(.5).multiply(r),n!==void 0?(k1.x=s*cv.x-n*cv.y,k1.y=n*cv.x+s*cv.y):k1.copy(cv),e.copy(t),e.x+=k1.x,e.y+=k1.y,e.applyMatrix4(Vne)}const nE=new he,TX=new he;class Hne extends Qi{constructor(){super(),this.isLOD=!0,this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}copy(t){super.copy(t,!1);const i=t.levels;for(let r=0,n=i.length;r<n;r++){const s=i[r];this.addLevel(s.object.clone(),s.distance,s.hysteresis)}return this.autoUpdate=t.autoUpdate,this}addLevel(t,i=0,r=0){i=Math.abs(i);const n=this.levels;let s;for(s=0;s<n.length&&!(i<n[s].distance);s++);return n.splice(s,0,{distance:i,hysteresis:r,object:t}),this.add(t),this}removeLevel(t){const i=this.levels;for(let r=0;r<i.length;r++)if(i[r].distance===t){const n=i.splice(r,1);return this.remove(n[0].object),!0}return!1}getCurrentLevel(){return this._currentLevel}getObjectForDistance(t){const i=this.levels;if(i.length>0){let r,n;for(r=1,n=i.length;r<n;r++){let s=i[r].distance;if(i[r].object.visible&&(s-=s*i[r].hysteresis),t<s)break}return i[r-1].object}return null}raycast(t,i){if(this.levels.length>0){nE.setFromMatrixPosition(this.matrixWorld);const n=t.ray.origin.distanceTo(nE);this.getObjectForDistance(n).raycast(t,i)}}update(t){const i=this.levels;if(i.length>1){nE.setFromMatrixPosition(t.matrixWorld),TX.setFromMatrixPosition(this.matrixWorld);const r=nE.distanceTo(TX)/t.zoom;i[0].object.visible=!0;let n,s;for(n=1,s=i.length;n<s;n++){let a=i[n].distance;if(i[n].object.visible&&(a-=a*i[n].hysteresis),r>=a)i[n-1].object.visible=!1,i[n].object.visible=!0;else break}for(this._currentLevel=n-1;n<s;n++)i[n].object.visible=!1}}toJSON(t){const i=super.toJSON(t);this.autoUpdate===!1&&(i.object.autoUpdate=!1),i.object.levels=[];const r=this.levels;for(let n=0,s=r.length;n<s;n++){const a=r[n];i.object.levels.push({object:a.object.uuid,distance:a.distance,hysteresis:a.hysteresis})}return i}}const CX=new he,PX=new Hi,DX=new Hi,LGe=new he,RX=new ci,sE=new he,qI=new Ns,IX=new ci,YI=new Zm;class jne extends Gr{constructor(t,i){super(t,i),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=KB,this.bindMatrix=new ci,this.bindMatrixInverse=new ci,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const t=this.geometry;this.boundingBox===null&&(this.boundingBox=new Us),this.boundingBox.makeEmpty();const i=t.getAttribute("position");for(let r=0;r<i.count;r++)this.getVertexPosition(r,sE),this.boundingBox.expandByPoint(sE)}computeBoundingSphere(){const t=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new Ns),this.boundingSphere.makeEmpty();const i=t.getAttribute("position");for(let r=0;r<i.count;r++)this.getVertexPosition(r,sE),this.boundingSphere.expandByPoint(sE)}copy(t,i){return super.copy(t,i),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,t.boundingBox!==null&&(this.boundingBox=t.boundingBox.clone()),t.boundingSphere!==null&&(this.boundingSphere=t.boundingSphere.clone()),this}raycast(t,i){const r=this.material,n=this.matrixWorld;r!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),qI.copy(this.boundingSphere),qI.applyMatrix4(n),t.ray.intersectsSphere(qI)!==!1&&(IX.copy(n).invert(),YI.copy(t.ray).applyMatrix4(IX),!(this.boundingBox!==null&&YI.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(t,i,YI)))}getVertexPosition(t,i){return super.getVertexPosition(t,i),this.applyBoneTransform(t,i),i}bind(t,i){this.skeleton=t,i===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),i=this.matrixWorld),this.bindMatrix.copy(i),this.bindMatrixInverse.copy(i).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const t=new Hi,i=this.geometry.attributes.skinWeight;for(let r=0,n=i.count;r<n;r++){t.fromBufferAttribute(i,r);const s=1/t.manhattanLength();s!==1/0?t.multiplyScalar(s):t.set(1,0,0,0),i.setXYZW(r,t.x,t.y,t.z,t.w)}}updateMatrixWorld(t){super.updateMatrixWorld(t),this.bindMode===KB?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===bne?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(t,i){const r=this.skeleton,n=this.geometry;PX.fromBufferAttribute(n.attributes.skinIndex,t),DX.fromBufferAttribute(n.attributes.skinWeight,t),CX.copy(i).applyMatrix4(this.bindMatrix),i.set(0,0,0);for(let s=0;s<4;s++){const a=DX.getComponent(s);if(a!==0){const o=PX.getComponent(s);RX.multiplyMatrices(r.bones[o].matrixWorld,r.boneInverses[o]),i.addScaledVector(LGe.copy(CX).applyMatrix4(RX),a)}}return i.applyMatrix4(this.bindMatrixInverse)}}class ek extends Qi{constructor(){super(),this.isBone=!0,this.type="Bone"}}class nu extends Wr{constructor(t=null,i=1,r=1,n,s,a,o,l,c=Fs,u=Fs,h,d){super(null,a,o,l,c,u,n,s,h,d),this.isDataTexture=!0,this.image={data:t,width:i,height:r},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const LX=new ci,OGe=new ci;class fP{constructor(t=[],i=[]){this.uuid=Lo(),this.bones=t.slice(0),this.boneInverses=i,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const t=this.bones,i=this.boneInverses;if(this.boneMatrices=new Float32Array(t.length*16),i.length===0)this.calculateInverses();else if(t.length!==i.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let r=0,n=this.bones.length;r<n;r++)this.boneInverses.push(new ci)}}calculateInverses(){this.boneInverses.length=0;for(let t=0,i=this.bones.length;t<i;t++){const r=new ci;this.bones[t]&&r.copy(this.bones[t].matrixWorld).invert(),this.boneInverses.push(r)}}pose(){for(let t=0,i=this.bones.length;t<i;t++){const r=this.bones[t];r&&r.matrixWorld.copy(this.boneInverses[t]).invert()}for(let t=0,i=this.bones.length;t<i;t++){const r=this.bones[t];r&&(r.parent&&r.parent.isBone?(r.matrix.copy(r.parent.matrixWorld).invert(),r.matrix.multiply(r.matrixWorld)):r.matrix.copy(r.matrixWorld),r.matrix.decompose(r.position,r.quaternion,r.scale))}}update(){const t=this.bones,i=this.boneInverses,r=this.boneMatrices,n=this.boneTexture;for(let s=0,a=t.length;s<a;s++){const o=t[s]?t[s].matrixWorld:OGe;LX.multiplyMatrices(o,i[s]),LX.toArray(r,s*16)}n!==null&&(n.needsUpdate=!0)}clone(){return new fP(this.bones,this.boneInverses)}computeBoneTexture(){let t=Math.sqrt(this.bones.length*4);t=Math.ceil(t/4)*4,t=Math.max(t,4);const i=new Float32Array(t*t*4);i.set(this.boneMatrices);const r=new nu(i,t,t,sa,so);return r.needsUpdate=!0,this.boneMatrices=i,this.boneTexture=r,this}getBoneByName(t){for(let i=0,r=this.bones.length;i<r;i++){const n=this.bones[i];if(n.name===t)return n}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(t,i){this.uuid=t.uuid;for(let r=0,n=t.bones.length;r<n;r++){const s=t.bones[r];let a=i[s];a===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",s),a=new ek),this.bones.push(a),this.boneInverses.push(new ci().fromArray(t.boneInverses[r]))}return this.init(),this}toJSON(){const t={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};t.uuid=this.uuid;const i=this.bones,r=this.boneInverses;for(let n=0,s=i.length;n<s;n++){const a=i[n];t.bones.push(a.uuid);const o=r[n];t.boneInverses.push(o.toArray())}return t}}class Fm extends mr{constructor(t,i,r,n=1){super(t,i,r),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=n}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){const t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}const uv=new ci,OX=new ci,aE=[],zX=new Us,zGe=new ci,G1=new Gr,H1=new Ns;class Wne extends Gr{constructor(t,i,r){super(t,i),this.isInstancedMesh=!0,this.instanceMatrix=new Fm(new Float32Array(r*16),16),this.instanceColor=null,this.morphTexture=null,this.count=r,this.boundingBox=null,this.boundingSphere=null;for(let n=0;n<r;n++)this.setMatrixAt(n,zGe)}computeBoundingBox(){const t=this.geometry,i=this.count;this.boundingBox===null&&(this.boundingBox=new Us),t.boundingBox===null&&t.computeBoundingBox(),this.boundingBox.makeEmpty();for(let r=0;r<i;r++)this.getMatrixAt(r,uv),zX.copy(t.boundingBox).applyMatrix4(uv),this.boundingBox.union(zX)}computeBoundingSphere(){const t=this.geometry,i=this.count;this.boundingSphere===null&&(this.boundingSphere=new Ns),t.boundingSphere===null&&t.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let r=0;r<i;r++)this.getMatrixAt(r,uv),H1.copy(t.boundingSphere).applyMatrix4(uv),this.boundingSphere.union(H1)}copy(t,i){return super.copy(t,i),this.instanceMatrix.copy(t.instanceMatrix),t.morphTexture!==null&&(this.morphTexture=t.morphTexture.clone()),t.instanceColor!==null&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,t.boundingBox!==null&&(this.boundingBox=t.boundingBox.clone()),t.boundingSphere!==null&&(this.boundingSphere=t.boundingSphere.clone()),this}getColorAt(t,i){i.fromArray(this.instanceColor.array,t*3)}getMatrixAt(t,i){i.fromArray(this.instanceMatrix.array,t*16)}getMorphAt(t,i){const r=i.morphTargetInfluences,n=this.morphTexture.source.data.data,s=r.length+1,a=t*s+1;for(let o=0;o<r.length;o++)r[o]=n[a+o]}raycast(t,i){const r=this.matrixWorld,n=this.count;if(G1.geometry=this.geometry,G1.material=this.material,G1.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),H1.copy(this.boundingSphere),H1.applyMatrix4(r),t.ray.intersectsSphere(H1)!==!1))for(let s=0;s<n;s++){this.getMatrixAt(s,uv),OX.multiplyMatrices(r,uv),G1.matrixWorld=OX,G1.raycast(t,aE);for(let a=0,o=aE.length;a<o;a++){const l=aE[a];l.instanceId=s,l.object=this,i.push(l)}aE.length=0}}setColorAt(t,i){this.instanceColor===null&&(this.instanceColor=new Fm(new Float32Array(this.instanceMatrix.count*3).fill(1),3)),i.toArray(this.instanceColor.array,t*3)}setMatrixAt(t,i){i.toArray(this.instanceMatrix.array,t*16)}setMorphAt(t,i){const r=i.morphTargetInfluences,n=r.length+1;this.morphTexture===null&&(this.morphTexture=new nu(new Float32Array(n*this.count),n,this.count,nP,so));const s=this.morphTexture.source.data.data;let a=0;for(let c=0;c<r.length;c++)a+=r[c];const o=this.geometry.morphTargetsRelative?1:1-a,l=n*t;s[l]=o,s.set(r,l+1)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"}),this.morphTexture!==null&&(this.morphTexture.dispose(),this.morphTexture=null)}}const QI=new he,BGe=new he,FGe=new xi;class eh{constructor(t=new he(1,0,0),i=0){this.isPlane=!0,this.normal=t,this.constant=i}set(t,i){return this.normal.copy(t),this.constant=i,this}setComponents(t,i,r,n){return this.normal.set(t,i,r),this.constant=n,this}setFromNormalAndCoplanarPoint(t,i){return this.normal.copy(t),this.constant=-i.dot(this.normal),this}setFromCoplanarPoints(t,i,r){const n=QI.subVectors(r,i).cross(BGe.subVectors(t,i)).normalize();return this.setFromNormalAndCoplanarPoint(n,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,i){return i.copy(t).addScaledVector(this.normal,-this.distanceToPoint(t))}intersectLine(t,i){const r=t.delta(QI),n=this.normal.dot(r);if(n===0)return this.distanceToPoint(t.start)===0?i.copy(t.start):null;const s=-(t.start.dot(this.normal)+this.constant)/n;return s<0||s>1?null:i.copy(t.start).addScaledVector(r,s)}intersectsLine(t){const i=this.distanceToPoint(t.start),r=this.distanceToPoint(t.end);return i<0&&r>0||r<0&&i>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,i){const r=i||FGe.getNormalMatrix(t),n=this.coplanarPoint(QI).applyMatrix4(t),s=this.normal.applyMatrix3(r).normalize();return this.constant=-n.dot(s),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return new this.constructor().copy(this)}}const lp=new Ns,oE=new he;class Qb{constructor(t=new eh,i=new eh,r=new eh,n=new eh,s=new eh,a=new eh){this.planes=[t,i,r,n,s,a]}set(t,i,r,n,s,a){const o=this.planes;return o[0].copy(t),o[1].copy(i),o[2].copy(r),o[3].copy(n),o[4].copy(s),o[5].copy(a),this}copy(t){const i=this.planes;for(let r=0;r<6;r++)i[r].copy(t.planes[r]);return this}setFromProjectionMatrix(t,i=$l){const r=this.planes,n=t.elements,s=n[0],a=n[1],o=n[2],l=n[3],c=n[4],u=n[5],h=n[6],d=n[7],f=n[8],p=n[9],v=n[10],m=n[11],g=n[12],y=n[13],x=n[14],_=n[15];if(r[0].setComponents(l-s,d-c,m-f,_-g).normalize(),r[1].setComponents(l+s,d+c,m+f,_+g).normalize(),r[2].setComponents(l+a,d+u,m+p,_+y).normalize(),r[3].setComponents(l-a,d-u,m-p,_-y).normalize(),r[4].setComponents(l-o,d-h,m-v,_-x).normalize(),i===$l)r[5].setComponents(l+o,d+h,m+v,_+x).normalize();else if(i===ab)r[5].setComponents(o,h,v,x).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+i);return this}intersectsObject(t){if(t.boundingSphere!==void 0)t.boundingSphere===null&&t.computeBoundingSphere(),lp.copy(t.boundingSphere).applyMatrix4(t.matrixWorld);else{const i=t.geometry;i.boundingSphere===null&&i.computeBoundingSphere(),lp.copy(i.boundingSphere).applyMatrix4(t.matrixWorld)}return this.intersectsSphere(lp)}intersectsSprite(t){return lp.center.set(0,0,0),lp.radius=.7071067811865476,lp.applyMatrix4(t.matrixWorld),this.intersectsSphere(lp)}intersectsSphere(t){const i=this.planes,r=t.center,n=-t.radius;for(let s=0;s<6;s++)if(i[s].distanceToPoint(r)<n)return!1;return!0}intersectsBox(t){const i=this.planes;for(let r=0;r<6;r++){const n=i[r];if(oE.x=n.normal.x>0?t.max.x:t.min.x,oE.y=n.normal.y>0?t.max.y:t.min.y,oE.z=n.normal.z>0?t.max.z:t.min.z,n.distanceToPoint(oE)<0)return!1}return!0}containsPoint(t){const i=this.planes;for(let r=0;r<6;r++)if(i[r].distanceToPoint(t)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function ZI(e,t){return e-t}function UGe(e,t){return e.z-t.z}function NGe(e,t){return t.z-e.z}class kGe{constructor(){this.index=0,this.pool=[],this.list=[]}push(t,i,r,n){const s=this.pool,a=this.list;this.index>=s.length&&s.push({start:-1,count:-1,z:-1,index:-1});const o=s[this.index];a.push(o),this.index++,o.start=t,o.count=i,o.z=r,o.index=n}reset(){this.list.length=0,this.index=0}}const Xa=new ci,VGe=new Rt(1,1,1),KI=new Qb,lE=new Us,cp=new Ns,j1=new he,BX=new he,GGe=new he,JI=new kGe,Js=new Gr,cE=[];function HGe(e,t,i=0){const r=t.itemSize;if(e.isInterleavedBufferAttribute||e.array.constructor!==t.array.constructor){const n=e.count;for(let s=0;s<n;s++)for(let a=0;a<r;a++)t.setComponent(s+i,a,e.getComponent(s,a))}else t.array.set(e.array,i*r);t.needsUpdate=!0}function up(e,t){if(e.constructor!==t.constructor){const i=Math.min(e.length,t.length);for(let r=0;r<i;r++)t[r]=e[r]}else{const i=Math.min(e.length,t.length);t.set(new e.constructor(e.buffer,0,i))}}class Xne extends Gr{constructor(t,i,r=i*2,n){super(new Pi,n),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._instanceInfo=[],this._geometryInfo=[],this._availableInstanceIds=[],this._availableGeometryIds=[],this._nextIndexStart=0,this._nextVertexStart=0,this._geometryCount=0,this._visibilityChanged=!0,this._geometryInitialized=!1,this._maxInstanceCount=t,this._maxVertexCount=i,this._maxIndexCount=r,this._multiDrawCounts=new Int32Array(t),this._multiDrawStarts=new Int32Array(t),this._multiDrawCount=0,this._multiDrawInstances=null,this._matricesTexture=null,this._indirectTexture=null,this._colorsTexture=null,this._initMatricesTexture(),this._initIndirectTexture()}get maxInstanceCount(){return this._maxInstanceCount}get instanceCount(){return this._instanceInfo.length-this._availableInstanceIds.length}get unusedVertexCount(){return this._maxVertexCount-this._nextVertexStart}get unusedIndexCount(){return this._maxIndexCount-this._nextIndexStart}_initMatricesTexture(){let t=Math.sqrt(this._maxInstanceCount*4);t=Math.ceil(t/4)*4,t=Math.max(t,4);const i=new Float32Array(t*t*4),r=new nu(i,t,t,sa,so);this._matricesTexture=r}_initIndirectTexture(){let t=Math.sqrt(this._maxInstanceCount);t=Math.ceil(t);const i=new Uint32Array(t*t),r=new nu(i,t,t,Wb,zh);this._indirectTexture=r}_initColorsTexture(){let t=Math.sqrt(this._maxInstanceCount);t=Math.ceil(t);const i=new Float32Array(t*t*4).fill(1),r=new nu(i,t,t,sa,so);r.colorSpace=Xi.workingColorSpace,this._colorsTexture=r}_initializeGeometry(t){const i=this.geometry,r=this._maxVertexCount,n=this._maxIndexCount;if(this._geometryInitialized===!1){for(const s in t.attributes){const a=t.getAttribute(s),{array:o,itemSize:l,normalized:c}=a,u=new o.constructor(r*l),h=new mr(u,l,c);i.setAttribute(s,h)}if(t.getIndex()!==null){const s=r>65535?new Uint32Array(n):new Uint16Array(n);i.setIndex(new mr(s,1))}this._geometryInitialized=!0}}_validateGeometry(t){const i=this.geometry;if(!!t.getIndex()!=!!i.getIndex())throw new Error('THREE.BatchedMesh: All geometries must consistently have "index".');for(const r in i.attributes){if(!t.hasAttribute(r))throw new Error(`THREE.BatchedMesh: Added geometry missing "${r}". All geometries must have consistent attributes.`);const n=t.getAttribute(r),s=i.getAttribute(r);if(n.itemSize!==s.itemSize||n.normalized!==s.normalized)throw new Error("THREE.BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}validateInstanceId(t){const i=this._instanceInfo;if(t<0||t>=i.length||i[t].active===!1)throw new Error(`THREE.BatchedMesh: Invalid instanceId ${t}. Instance is either out of range or has been deleted.`)}validateGeometryId(t){const i=this._geometryInfo;if(t<0||t>=i.length||i[t].active===!1)throw new Error(`THREE.BatchedMesh: Invalid geometryId ${t}. Geometry is either out of range or has been deleted.`)}setCustomSort(t){return this.customSort=t,this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Us);const t=this.boundingBox,i=this._instanceInfo;t.makeEmpty();for(let r=0,n=i.length;r<n;r++){if(i[r].active===!1)continue;const s=i[r].geometryIndex;this.getMatrixAt(r,Xa),this.getBoundingBoxAt(s,lE).applyMatrix4(Xa),t.union(lE)}}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Ns);const t=this.boundingSphere,i=this._instanceInfo;t.makeEmpty();for(let r=0,n=i.length;r<n;r++){if(i[r].active===!1)continue;const s=i[r].geometryIndex;this.getMatrixAt(r,Xa),this.getBoundingSphereAt(s,cp).applyMatrix4(Xa),t.union(cp)}}addInstance(t){if(this._instanceInfo.length>=this.maxInstanceCount&&this._availableInstanceIds.length===0)throw new Error("THREE.BatchedMesh: Maximum item count reached.");const r={visible:!0,active:!0,geometryIndex:t};let n=null;this._availableInstanceIds.length>0?(this._availableInstanceIds.sort(ZI),n=this._availableInstanceIds.shift(),this._instanceInfo[n]=r):(n=this._instanceInfo.length,this._instanceInfo.push(r));const s=this._matricesTexture;Xa.identity().toArray(s.image.data,n*16),s.needsUpdate=!0;const a=this._colorsTexture;return a&&(VGe.toArray(a.image.data,n*4),a.needsUpdate=!0),this._visibilityChanged=!0,n}addGeometry(t,i=-1,r=-1){this._initializeGeometry(t),this._validateGeometry(t);const n={vertexStart:-1,vertexCount:-1,reservedVertexCount:-1,indexStart:-1,indexCount:-1,reservedIndexCount:-1,start:-1,count:-1,boundingBox:null,boundingSphere:null,active:!0},s=this._geometryInfo;n.vertexStart=this._nextVertexStart,n.reservedVertexCount=i===-1?t.getAttribute("position").count:i;const a=t.getIndex();if(a!==null&&(n.indexStart=this._nextIndexStart,n.reservedIndexCount=r===-1?a.count:r),n.indexStart!==-1&&n.indexStart+n.reservedIndexCount>this._maxIndexCount||n.vertexStart+n.reservedVertexCount>this._maxVertexCount)throw new Error("THREE.BatchedMesh: Reserved space request exceeds the maximum buffer size.");let l;return this._availableGeometryIds.length>0?(this._availableGeometryIds.sort(ZI),l=this._availableGeometryIds.shift(),s[l]=n):(l=this._geometryCount,this._geometryCount++,s.push(n)),this.setGeometryAt(l,t),this._nextIndexStart=n.indexStart+n.reservedIndexCount,this._nextVertexStart=n.vertexStart+n.reservedVertexCount,l}setGeometryAt(t,i){if(t>=this._geometryCount)throw new Error("THREE.BatchedMesh: Maximum geometry count reached.");this._validateGeometry(i);const r=this.geometry,n=r.getIndex()!==null,s=r.getIndex(),a=i.getIndex(),o=this._geometryInfo[t];if(n&&a.count>o.reservedIndexCount||i.attributes.position.count>o.reservedVertexCount)throw new Error("THREE.BatchedMesh: Reserved space not large enough for provided geometry.");const l=o.vertexStart,c=o.reservedVertexCount;o.vertexCount=i.getAttribute("position").count;for(const u in r.attributes){const h=i.getAttribute(u),d=r.getAttribute(u);HGe(h,d,l);const f=h.itemSize;for(let p=h.count,v=c;p<v;p++){const m=l+p;for(let g=0;g<f;g++)d.setComponent(m,g,0)}d.needsUpdate=!0,d.addUpdateRange(l*f,c*f)}if(n){const u=o.indexStart,h=o.reservedIndexCount;o.indexCount=i.getIndex().count;for(let d=0;d<a.count;d++)s.setX(u+d,l+a.getX(d));for(let d=a.count,f=h;d<f;d++)s.setX(u+d,l);s.needsUpdate=!0,s.addUpdateRange(u,o.reservedIndexCount)}return o.start=n?o.indexStart:o.vertexStart,o.count=n?o.indexCount:o.vertexCount,o.boundingBox=null,i.boundingBox!==null&&(o.boundingBox=i.boundingBox.clone()),o.boundingSphere=null,i.boundingSphere!==null&&(o.boundingSphere=i.boundingSphere.clone()),this._visibilityChanged=!0,t}deleteGeometry(t){const i=this._geometryInfo;if(t>=i.length||i[t].active===!1)return this;const r=this._instanceInfo;for(let n=0,s=r.length;n<s;n++)r[n].active&&r[n].geometryIndex===t&&this.deleteInstance(n);return i[t].active=!1,this._availableGeometryIds.push(t),this._visibilityChanged=!0,this}deleteInstance(t){return this.validateInstanceId(t),this._instanceInfo[t].active=!1,this._availableInstanceIds.push(t),this._visibilityChanged=!0,this}optimize(){let t=0,i=0;const r=this._geometryInfo,n=r.map((a,o)=>o).sort((a,o)=>r[a].vertexStart-r[o].vertexStart),s=this.geometry;for(let a=0,o=r.length;a<o;a++){const l=n[a],c=r[l];if(c.active!==!1){if(s.index!==null){if(c.indexStart!==i){const{indexStart:u,vertexStart:h,reservedIndexCount:d}=c,f=s.index,p=f.array,v=t-h;for(let m=u;m<u+d;m++)p[m]=p[m]+v;f.array.copyWithin(i,u,u+d),f.addUpdateRange(i,d),c.indexStart=i}i+=c.reservedIndexCount}if(c.vertexStart!==t){const{vertexStart:u,reservedVertexCount:h}=c,d=s.attributes;for(const f in d){const p=d[f],{array:v,itemSize:m}=p;v.copyWithin(t*m,u*m,(u+h)*m),p.addUpdateRange(t*m,h*m)}c.vertexStart=t}t+=c.reservedVertexCount,c.start=s.index?c.indexStart:c.vertexStart,this._nextIndexStart=s.index?c.indexStart+c.reservedIndexCount:0,this._nextVertexStart=c.vertexStart+c.reservedVertexCount}}return this}getBoundingBoxAt(t,i){if(t>=this._geometryCount)return null;const r=this.geometry,n=this._geometryInfo[t];if(n.boundingBox===null){const s=new Us,a=r.index,o=r.attributes.position;for(let l=n.start,c=n.start+n.count;l<c;l++){let u=l;a&&(u=a.getX(u)),s.expandByPoint(j1.fromBufferAttribute(o,u))}n.boundingBox=s}return i.copy(n.boundingBox),i}getBoundingSphereAt(t,i){if(t>=this._geometryCount)return null;const r=this.geometry,n=this._geometryInfo[t];if(n.boundingSphere===null){const s=new Ns;this.getBoundingBoxAt(t,lE),lE.getCenter(s.center);const a=r.index,o=r.attributes.position;let l=0;for(let c=n.start,u=n.start+n.count;c<u;c++){let h=c;a&&(h=a.getX(h)),j1.fromBufferAttribute(o,h),l=Math.max(l,s.center.distanceToSquared(j1))}s.radius=Math.sqrt(l),n.boundingSphere=s}return i.copy(n.boundingSphere),i}setMatrixAt(t,i){this.validateInstanceId(t);const r=this._matricesTexture,n=this._matricesTexture.image.data;return i.toArray(n,t*16),r.needsUpdate=!0,this}getMatrixAt(t,i){return this.validateInstanceId(t),i.fromArray(this._matricesTexture.image.data,t*16)}setColorAt(t,i){return this.validateInstanceId(t),this._colorsTexture===null&&this._initColorsTexture(),i.toArray(this._colorsTexture.image.data,t*4),this._colorsTexture.needsUpdate=!0,this}getColorAt(t,i){return this.validateInstanceId(t),i.fromArray(this._colorsTexture.image.data,t*4)}setVisibleAt(t,i){return this.validateInstanceId(t),this._instanceInfo[t].visible===i?this:(this._instanceInfo[t].visible=i,this._visibilityChanged=!0,this)}getVisibleAt(t){return this.validateInstanceId(t),this._instanceInfo[t].visible}setGeometryIdAt(t,i){return this.validateInstanceId(t),this.validateGeometryId(i),this._instanceInfo[t].geometryIndex=i,this}getGeometryIdAt(t){return this.validateInstanceId(t),this._instanceInfo[t].geometryIndex}getGeometryRangeAt(t,i={}){this.validateGeometryId(t);const r=this._geometryInfo[t];return i.vertexStart=r.vertexStart,i.vertexCount=r.vertexCount,i.reservedVertexCount=r.reservedVertexCount,i.indexStart=r.indexStart,i.indexCount=r.indexCount,i.reservedIndexCount=r.reservedIndexCount,i.start=r.start,i.count=r.count,i}setInstanceCount(t){const i=this._availableInstanceIds,r=this._instanceInfo;for(i.sort(ZI);i[i.length-1]===r.length;)r.pop(),i.pop();if(t<r.length)throw new Error(`BatchedMesh: Instance ids outside the range ${t} are being used. Cannot shrink instance count.`);const n=new Int32Array(t),s=new Int32Array(t);up(this._multiDrawCounts,n),up(this._multiDrawStarts,s),this._multiDrawCounts=n,this._multiDrawStarts=s,this._maxInstanceCount=t;const a=this._indirectTexture,o=this._matricesTexture,l=this._colorsTexture;a.dispose(),this._initIndirectTexture(),up(a.image.data,this._indirectTexture.image.data),o.dispose(),this._initMatricesTexture(),up(o.image.data,this._matricesTexture.image.data),l&&(l.dispose(),this._initColorsTexture(),up(l.image.data,this._colorsTexture.image.data))}setGeometrySize(t,i){const r=[...this._geometryInfo].filter(o=>o.active);if(Math.max(...r.map(o=>o.vertexStart+o.reservedVertexCount))>t)throw new Error(`BatchedMesh: Geometry vertex values are being used outside the range ${i}. Cannot shrink further.`);if(this.geometry.index&&Math.max(...r.map(l=>l.indexStart+l.reservedIndexCount))>i)throw new Error(`BatchedMesh: Geometry index values are being used outside the range ${i}. Cannot shrink further.`);const s=this.geometry;s.dispose(),this._maxVertexCount=t,this._maxIndexCount=i,this._geometryInitialized&&(this._geometryInitialized=!1,this.geometry=new Pi,this._initializeGeometry(s));const a=this.geometry;s.index&&up(s.index.array,a.index.array);for(const o in s.attributes)up(s.attributes[o].array,a.attributes[o].array)}raycast(t,i){const r=this._instanceInfo,n=this._geometryInfo,s=this.matrixWorld,a=this.geometry;Js.material=this.material,Js.geometry.index=a.index,Js.geometry.attributes=a.attributes,Js.geometry.boundingBox===null&&(Js.geometry.boundingBox=new Us),Js.geometry.boundingSphere===null&&(Js.geometry.boundingSphere=new Ns);for(let o=0,l=r.length;o<l;o++){if(!r[o].visible||!r[o].active)continue;const c=r[o].geometryIndex,u=n[c];Js.geometry.setDrawRange(u.start,u.count),this.getMatrixAt(o,Js.matrixWorld).premultiply(s),this.getBoundingBoxAt(c,Js.geometry.boundingBox),this.getBoundingSphereAt(c,Js.geometry.boundingSphere),Js.raycast(t,cE);for(let h=0,d=cE.length;h<d;h++){const f=cE[h];f.object=this,f.batchId=o,i.push(f)}cE.length=0}Js.material=null,Js.geometry.index=null,Js.geometry.attributes={},Js.geometry.setDrawRange(0,1/0)}copy(t){return super.copy(t),this.geometry=t.geometry.clone(),this.perObjectFrustumCulled=t.perObjectFrustumCulled,this.sortObjects=t.sortObjects,this.boundingBox=t.boundingBox!==null?t.boundingBox.clone():null,this.boundingSphere=t.boundingSphere!==null?t.boundingSphere.clone():null,this._geometryInfo=t._geometryInfo.map(i=>({...i,boundingBox:i.boundingBox!==null?i.boundingBox.clone():null,boundingSphere:i.boundingSphere!==null?i.boundingSphere.clone():null})),this._instanceInfo=t._instanceInfo.map(i=>({...i})),this._maxInstanceCount=t._maxInstanceCount,this._maxVertexCount=t._maxVertexCount,this._maxIndexCount=t._maxIndexCount,this._geometryInitialized=t._geometryInitialized,this._geometryCount=t._geometryCount,this._multiDrawCounts=t._multiDrawCounts.slice(),this._multiDrawStarts=t._multiDrawStarts.slice(),this._matricesTexture=t._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.data.slice(),this._colorsTexture!==null&&(this._colorsTexture=t._colorsTexture.clone(),this._colorsTexture.image.data=this._colorsTexture.image.data.slice()),this}dispose(){this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this._indirectTexture.dispose(),this._indirectTexture=null,this._colorsTexture!==null&&(this._colorsTexture.dispose(),this._colorsTexture=null)}onBeforeRender(t,i,r,n,s){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;const a=n.getIndex(),o=a===null?1:a.array.BYTES_PER_ELEMENT,l=this._instanceInfo,c=this._multiDrawStarts,u=this._multiDrawCounts,h=this._geometryInfo,d=this.perObjectFrustumCulled,f=this._indirectTexture,p=f.image.data;d&&(Xa.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse).multiply(this.matrixWorld),KI.setFromProjectionMatrix(Xa,t.coordinateSystem));let v=0;if(this.sortObjects){Xa.copy(this.matrixWorld).invert(),j1.setFromMatrixPosition(r.matrixWorld).applyMatrix4(Xa),BX.set(0,0,-1).transformDirection(r.matrixWorld).transformDirection(Xa);for(let y=0,x=l.length;y<x;y++)if(l[y].visible&&l[y].active){const _=l[y].geometryIndex;this.getMatrixAt(y,Xa),this.getBoundingSphereAt(_,cp).applyMatrix4(Xa);let M=!1;if(d&&(M=!KI.intersectsSphere(cp)),!M){const S=h[_],T=GGe.subVectors(cp.center,j1).dot(BX);JI.push(S.start,S.count,T,y)}}const m=JI.list,g=this.customSort;g===null?m.sort(s.transparent?NGe:UGe):g.call(this,m,r);for(let y=0,x=m.length;y<x;y++){const _=m[y];c[v]=_.start*o,u[v]=_.count,p[v]=_.index,v++}JI.reset()}else for(let m=0,g=l.length;m<g;m++)if(l[m].visible&&l[m].active){const y=l[m].geometryIndex;let x=!1;if(d&&(this.getMatrixAt(m,Xa),this.getBoundingSphereAt(y,cp).applyMatrix4(Xa),x=!KI.intersectsSphere(cp)),!x){const _=h[y];c[v]=_.start*o,u[v]=_.count,p[v]=m,v++}}f.needsUpdate=!0,this._multiDrawCount=v,this._visibilityChanged=!1}onBeforeShadow(t,i,r,n,s,a){this.onBeforeRender(t,null,n,s,a)}}class ka extends ha{constructor(t){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Rt(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.fog=t.fog,this}}const ZT=new he,KT=new he,FX=new ci,W1=new Zm,uE=new Ns,$I=new he,UX=new he;class bf extends Qi{constructor(t=new Pi,i=new ka){super(),this.isLine=!0,this.type="Line",this.geometry=t,this.material=i,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(t,i){return super.copy(t,i),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}computeLineDistances(){const t=this.geometry;if(t.index===null){const i=t.attributes.position,r=[0];for(let n=1,s=i.count;n<s;n++)ZT.fromBufferAttribute(i,n-1),KT.fromBufferAttribute(i,n),r[n]=r[n-1],r[n]+=ZT.distanceTo(KT);t.setAttribute("lineDistance",new Gt(r,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(t,i){const r=this.geometry,n=this.matrixWorld,s=t.params.Line.threshold,a=r.drawRange;if(r.boundingSphere===null&&r.computeBoundingSphere(),uE.copy(r.boundingSphere),uE.applyMatrix4(n),uE.radius+=s,t.ray.intersectsSphere(uE)===!1)return;FX.copy(n).invert(),W1.copy(t.ray).applyMatrix4(FX);const o=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=o*o,c=this.isLineSegments?2:1,u=r.index,d=r.attributes.position;if(u!==null){const f=Math.max(0,a.start),p=Math.min(u.count,a.start+a.count);for(let v=f,m=p-1;v<m;v+=c){const g=u.getX(v),y=u.getX(v+1),x=hE(this,t,W1,l,g,y,v);x&&i.push(x)}if(this.isLineLoop){const v=u.getX(p-1),m=u.getX(f),g=hE(this,t,W1,l,v,m,p-1);g&&i.push(g)}}else{const f=Math.max(0,a.start),p=Math.min(d.count,a.start+a.count);for(let v=f,m=p-1;v<m;v+=c){const g=hE(this,t,W1,l,v,v+1,v);g&&i.push(g)}if(this.isLineLoop){const v=hE(this,t,W1,l,p-1,f,p-1);v&&i.push(v)}}}updateMorphTargets(){const i=this.geometry.morphAttributes,r=Object.keys(i);if(r.length>0){const n=i[r[0]];if(n!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,a=n.length;s<a;s++){const o=n[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=s}}}}}function hE(e,t,i,r,n,s,a){const o=e.geometry.attributes.position;if(ZT.fromBufferAttribute(o,n),KT.fromBufferAttribute(o,s),i.distanceSqToSegment(ZT,KT,$I,UX)>r)return;$I.applyMatrix4(e.matrixWorld);const c=t.ray.origin.distanceTo($I);if(!(c<t.near||c>t.far))return{distance:c,point:UX.clone().applyMatrix4(e.matrixWorld),index:a,face:null,faceIndex:null,barycoord:null,object:e}}const NX=new he,kX=new he;class mu extends bf{constructor(t,i){super(t,i),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const t=this.geometry;if(t.index===null){const i=t.attributes.position,r=[];for(let n=0,s=i.count;n<s;n+=2)NX.fromBufferAttribute(i,n),kX.fromBufferAttribute(i,n+1),r[n]=n===0?0:r[n-1],r[n+1]=r[n]+NX.distanceTo(kX);t.setAttribute("lineDistance",new Gt(r,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class qne extends bf{constructor(t,i){super(t,i),this.isLineLoop=!0,this.type="LineLoop"}}class tk extends ha{constructor(t){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Rt(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}const VX=new ci,eF=new Zm,dE=new Ns,fE=new he;class Yne extends Qi{constructor(t=new Pi,i=new tk){super(),this.isPoints=!0,this.type="Points",this.geometry=t,this.material=i,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(t,i){return super.copy(t,i),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}raycast(t,i){const r=this.geometry,n=this.matrixWorld,s=t.params.Points.threshold,a=r.drawRange;if(r.boundingSphere===null&&r.computeBoundingSphere(),dE.copy(r.boundingSphere),dE.applyMatrix4(n),dE.radius+=s,t.ray.intersectsSphere(dE)===!1)return;VX.copy(n).invert(),eF.copy(t.ray).applyMatrix4(VX);const o=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=o*o,c=r.index,h=r.attributes.position;if(c!==null){const d=Math.max(0,a.start),f=Math.min(c.count,a.start+a.count);for(let p=d,v=f;p<v;p++){const m=c.getX(p);fE.fromBufferAttribute(h,m),GX(fE,m,l,n,t,i,this)}}else{const d=Math.max(0,a.start),f=Math.min(h.count,a.start+a.count);for(let p=d,v=f;p<v;p++)fE.fromBufferAttribute(h,p),GX(fE,p,l,n,t,i,this)}}updateMorphTargets(){const i=this.geometry.morphAttributes,r=Object.keys(i);if(r.length>0){const n=i[r[0]];if(n!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,a=n.length;s<a;s++){const o=n[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=s}}}}}function GX(e,t,i,r,n,s,a){const o=eF.distanceSqToPoint(e);if(o<i){const l=new he;eF.closestPointToPoint(e,l),l.applyMatrix4(r);const c=n.ray.origin.distanceTo(l);if(c<n.near||c>n.far)return;s.push({distance:c,distanceToRay:Math.sqrt(o),point:l,index:t,face:null,faceIndex:null,barycoord:null,object:a})}}class Qne extends Wr{constructor(t,i,r,n,s,a,o,l,c){super(t,i,r,n,s,a,o,l,c),this.isVideoTexture=!0,this.minFilter=a!==void 0?a:pn,this.magFilter=s!==void 0?s:pn,this.generateMipmaps=!1;const u=this;function h(){u.needsUpdate=!0,t.requestVideoFrameCallback(h)}"requestVideoFrameCallback"in t&&t.requestVideoFrameCallback(h)}clone(){return new this.constructor(this.image).copy(this)}update(){const t=this.image;"requestVideoFrameCallback"in t===!1&&t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class jGe extends Qne{constructor(t,i,r,n,s,a,o,l){super({},t,i,r,n,s,a,o,l),this.isVideoFrameTexture=!0}update(){}clone(){return new this.constructor().copy(this)}setFrame(t){this.image=t,this.needsUpdate=!0}}class WGe extends Wr{constructor(t,i){super({width:t,height:i}),this.isFramebufferTexture=!0,this.magFilter=Fs,this.minFilter=Fs,this.generateMipmaps=!1,this.needsUpdate=!0}}class pP extends Wr{constructor(t,i,r,n,s,a,o,l,c,u,h,d){super(null,a,o,l,c,u,n,s,h,d),this.isCompressedTexture=!0,this.image={width:i,height:r},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}}class XGe extends pP{constructor(t,i,r,n,s,a){super(t,i,r,s,a),this.isCompressedArrayTexture=!0,this.image.depth=n,this.wrapR=pl,this.layerUpdates=new Set}addLayerUpdate(t){this.layerUpdates.add(t)}clearLayerUpdates(){this.layerUpdates.clear()}}class qGe extends pP{constructor(t,i,r){super(void 0,t[0].width,t[0].height,i,r,Oh),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=t}}class YGe extends Wr{constructor(t,i,r,n,s,a,o,l,c){super(t,i,r,n,s,a,o,l,c),this.isCanvasTexture=!0,this.needsUpdate=!0}}class ik extends Wr{constructor(t,i,r,n,s,a,o,l,c,u=dm){if(u!==dm&&u!==Om)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");r===void 0&&u===dm&&(r=zh),r===void 0&&u===Om&&(r=Lm),super(null,n,s,a,o,l,u,r,c),this.isDepthTexture=!0,this.image={width:t,height:i},this.magFilter=o!==void 0?o:Fs,this.minFilter=l!==void 0?l:Fs,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(t){return super.copy(t),this.source=new Yd(Object.assign({},t.image)),this.compareFunction=t.compareFunction,this}toJSON(t){const i=super.toJSON(t);return this.compareFunction!==null&&(i.compareFunction=this.compareFunction),i}}class dc{constructor(){this.type="Curve",this.arcLengthDivisions=200,this.needsUpdate=!1,this.cacheArcLengths=null}getPoint(){console.warn("THREE.Curve: .getPoint() not implemented.")}getPointAt(t,i){const r=this.getUtoTmapping(t);return this.getPoint(r,i)}getPoints(t=5){const i=[];for(let r=0;r<=t;r++)i.push(this.getPoint(r/t));return i}getSpacedPoints(t=5){const i=[];for(let r=0;r<=t;r++)i.push(this.getPointAt(r/t));return i}getLength(){const t=this.getLengths();return t[t.length-1]}getLengths(t=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const i=[];let r,n=this.getPoint(0),s=0;i.push(0);for(let a=1;a<=t;a++)r=this.getPoint(a/t),s+=r.distanceTo(n),i.push(s),n=r;return this.cacheArcLengths=i,i}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(t,i=null){const r=this.getLengths();let n=0;const s=r.length;let a;i?a=i:a=t*r[s-1];let o=0,l=s-1,c;for(;o<=l;)if(n=Math.floor(o+(l-o)/2),c=r[n]-a,c<0)o=n+1;else if(c>0)l=n-1;else{l=n;break}if(n=l,r[n]===a)return n/(s-1);const u=r[n],d=r[n+1]-u,f=(a-u)/d;return(n+f)/(s-1)}getTangent(t,i){let n=t-1e-4,s=t+1e-4;n<0&&(n=0),s>1&&(s=1);const a=this.getPoint(n),o=this.getPoint(s),l=i||(a.isVector2?new ut:new he);return l.copy(o).sub(a).normalize(),l}getTangentAt(t,i){const r=this.getUtoTmapping(t);return this.getTangent(r,i)}computeFrenetFrames(t,i=!1){const r=new he,n=[],s=[],a=[],o=new he,l=new ci;for(let f=0;f<=t;f++){const p=f/t;n[f]=this.getTangentAt(p,new he)}s[0]=new he,a[0]=new he;let c=Number.MAX_VALUE;const u=Math.abs(n[0].x),h=Math.abs(n[0].y),d=Math.abs(n[0].z);u<=c&&(c=u,r.set(1,0,0)),h<=c&&(c=h,r.set(0,1,0)),d<=c&&r.set(0,0,1),o.crossVectors(n[0],r).normalize(),s[0].crossVectors(n[0],o),a[0].crossVectors(n[0],s[0]);for(let f=1;f<=t;f++){if(s[f]=s[f-1].clone(),a[f]=a[f-1].clone(),o.crossVectors(n[f-1],n[f]),o.length()>Number.EPSILON){o.normalize();const p=Math.acos(wi(n[f-1].dot(n[f]),-1,1));s[f].applyMatrix4(l.makeRotationAxis(o,p))}a[f].crossVectors(n[f],s[f])}if(i===!0){let f=Math.acos(wi(s[0].dot(s[t]),-1,1));f/=t,n[0].dot(o.crossVectors(s[0],s[t]))>0&&(f=-f);for(let p=1;p<=t;p++)s[p].applyMatrix4(l.makeRotationAxis(n[p],f*p)),a[p].crossVectors(n[p],s[p])}return{tangents:n,normals:s,binormals:a}}clone(){return new this.constructor().copy(this)}copy(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}toJSON(){const t={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t}fromJSON(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}class mP extends dc{constructor(t=0,i=0,r=1,n=1,s=0,a=Math.PI*2,o=!1,l=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=t,this.aY=i,this.xRadius=r,this.yRadius=n,this.aStartAngle=s,this.aEndAngle=a,this.aClockwise=o,this.aRotation=l}getPoint(t,i=new ut){const r=i,n=Math.PI*2;let s=this.aEndAngle-this.aStartAngle;const a=Math.abs(s)<Number.EPSILON;for(;s<0;)s+=n;for(;s>n;)s-=n;s<Number.EPSILON&&(a?s=0:s=n),this.aClockwise===!0&&!a&&(s===n?s=-n:s=s-n);const o=this.aStartAngle+t*s;let l=this.aX+this.xRadius*Math.cos(o),c=this.aY+this.yRadius*Math.sin(o);if(this.aRotation!==0){const u=Math.cos(this.aRotation),h=Math.sin(this.aRotation),d=l-this.aX,f=c-this.aY;l=d*u-f*h+this.aX,c=d*h+f*u+this.aY}return r.set(l,c)}copy(t){return super.copy(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}toJSON(){const t=super.toJSON();return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t}fromJSON(t){return super.fromJSON(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}}class Zne extends mP{constructor(t,i,r,n,s,a){super(t,i,r,r,n,s,a),this.isArcCurve=!0,this.type="ArcCurve"}}function rk(){let e=0,t=0,i=0,r=0;function n(s,a,o,l){e=s,t=o,i=-3*s+3*a-2*o-l,r=2*s-2*a+o+l}return{initCatmullRom:function(s,a,o,l,c){n(a,o,c*(o-s),c*(l-a))},initNonuniformCatmullRom:function(s,a,o,l,c,u,h){let d=(a-s)/c-(o-s)/(c+u)+(o-a)/u,f=(o-a)/u-(l-a)/(u+h)+(l-o)/h;d*=u,f*=u,n(a,o,d,f)},calc:function(s){const a=s*s,o=a*s;return e+t*s+i*a+r*o}}}const pE=new he,eL=new rk,tL=new rk,iL=new rk;class Kne extends dc{constructor(t=[],i=!1,r="centripetal",n=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=t,this.closed=i,this.curveType=r,this.tension=n}getPoint(t,i=new he){const r=i,n=this.points,s=n.length,a=(s-(this.closed?0:1))*t;let o=Math.floor(a),l=a-o;this.closed?o+=o>0?0:(Math.floor(Math.abs(o)/s)+1)*s:l===0&&o===s-1&&(o=s-2,l=1);let c,u;this.closed||o>0?c=n[(o-1)%s]:(pE.subVectors(n[0],n[1]).add(n[0]),c=pE);const h=n[o%s],d=n[(o+1)%s];if(this.closed||o+2<s?u=n[(o+2)%s]:(pE.subVectors(n[s-1],n[s-2]).add(n[s-1]),u=pE),this.curveType==="centripetal"||this.curveType==="chordal"){const f=this.curveType==="chordal"?.5:.25;let p=Math.pow(c.distanceToSquared(h),f),v=Math.pow(h.distanceToSquared(d),f),m=Math.pow(d.distanceToSquared(u),f);v<1e-4&&(v=1),p<1e-4&&(p=v),m<1e-4&&(m=v),eL.initNonuniformCatmullRom(c.x,h.x,d.x,u.x,p,v,m),tL.initNonuniformCatmullRom(c.y,h.y,d.y,u.y,p,v,m),iL.initNonuniformCatmullRom(c.z,h.z,d.z,u.z,p,v,m)}else this.curveType==="catmullrom"&&(eL.initCatmullRom(c.x,h.x,d.x,u.x,this.tension),tL.initCatmullRom(c.y,h.y,d.y,u.y,this.tension),iL.initCatmullRom(c.z,h.z,d.z,u.z,this.tension));return r.set(eL.calc(l),tL.calc(l),iL.calc(l)),r}copy(t){super.copy(t),this.points=[];for(let i=0,r=t.points.length;i<r;i++){const n=t.points[i];this.points.push(n.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}toJSON(){const t=super.toJSON();t.points=[];for(let i=0,r=this.points.length;i<r;i++){const n=this.points[i];t.points.push(n.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t}fromJSON(t){super.fromJSON(t),this.points=[];for(let i=0,r=t.points.length;i<r;i++){const n=t.points[i];this.points.push(new he().fromArray(n))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}}function HX(e,t,i,r,n){const s=(r-t)*.5,a=(n-i)*.5,o=e*e,l=e*o;return(2*i-2*r+s+a)*l+(-3*i+3*r-2*s-a)*o+s*e+i}function QGe(e,t){const i=1-e;return i*i*t}function ZGe(e,t){return 2*(1-e)*e*t}function KGe(e,t){return e*e*t}function ew(e,t,i,r){return QGe(e,t)+ZGe(e,i)+KGe(e,r)}function JGe(e,t){const i=1-e;return i*i*i*t}function $Ge(e,t){const i=1-e;return 3*i*i*e*t}function eHe(e,t){return 3*(1-e)*e*e*t}function tHe(e,t){return e*e*e*t}function tw(e,t,i,r,n){return JGe(e,t)+$Ge(e,i)+eHe(e,r)+tHe(e,n)}class nk extends dc{constructor(t=new ut,i=new ut,r=new ut,n=new ut){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=t,this.v1=i,this.v2=r,this.v3=n}getPoint(t,i=new ut){const r=i,n=this.v0,s=this.v1,a=this.v2,o=this.v3;return r.set(tw(t,n.x,s.x,a.x,o.x),tw(t,n.y,s.y,a.y,o.y)),r}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}class Jne extends dc{constructor(t=new he,i=new he,r=new he,n=new he){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=t,this.v1=i,this.v2=r,this.v3=n}getPoint(t,i=new he){const r=i,n=this.v0,s=this.v1,a=this.v2,o=this.v3;return r.set(tw(t,n.x,s.x,a.x,o.x),tw(t,n.y,s.y,a.y,o.y),tw(t,n.z,s.z,a.z,o.z)),r}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}class sk extends dc{constructor(t=new ut,i=new ut){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=t,this.v2=i}getPoint(t,i=new ut){const r=i;return t===1?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(t).add(this.v1)),r}getPointAt(t,i){return this.getPoint(t,i)}getTangent(t,i=new ut){return i.subVectors(this.v2,this.v1).normalize()}getTangentAt(t,i){return this.getTangent(t,i)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class $ne extends dc{constructor(t=new he,i=new he){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=t,this.v2=i}getPoint(t,i=new he){const r=i;return t===1?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(t).add(this.v1)),r}getPointAt(t,i){return this.getPoint(t,i)}getTangent(t,i=new he){return i.subVectors(this.v2,this.v1).normalize()}getTangentAt(t,i){return this.getTangent(t,i)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class ak extends dc{constructor(t=new ut,i=new ut,r=new ut){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=t,this.v1=i,this.v2=r}getPoint(t,i=new ut){const r=i,n=this.v0,s=this.v1,a=this.v2;return r.set(ew(t,n.x,s.x,a.x),ew(t,n.y,s.y,a.y)),r}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class ok extends dc{constructor(t=new he,i=new he,r=new he){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=t,this.v1=i,this.v2=r}getPoint(t,i=new he){const r=i,n=this.v0,s=this.v1,a=this.v2;return r.set(ew(t,n.x,s.x,a.x),ew(t,n.y,s.y,a.y),ew(t,n.z,s.z,a.z)),r}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class lk extends dc{constructor(t=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=t}getPoint(t,i=new ut){const r=i,n=this.points,s=(n.length-1)*t,a=Math.floor(s),o=s-a,l=n[a===0?a:a-1],c=n[a],u=n[a>n.length-2?n.length-1:a+1],h=n[a>n.length-3?n.length-1:a+2];return r.set(HX(o,l.x,c.x,u.x,h.x),HX(o,l.y,c.y,u.y,h.y)),r}copy(t){super.copy(t),this.points=[];for(let i=0,r=t.points.length;i<r;i++){const n=t.points[i];this.points.push(n.clone())}return this}toJSON(){const t=super.toJSON();t.points=[];for(let i=0,r=this.points.length;i<r;i++){const n=this.points[i];t.points.push(n.toArray())}return t}fromJSON(t){super.fromJSON(t),this.points=[];for(let i=0,r=t.points.length;i<r;i++){const n=t.points[i];this.points.push(new ut().fromArray(n))}return this}}var JT=Object.freeze({__proto__:null,ArcCurve:Zne,CatmullRomCurve3:Kne,CubicBezierCurve:nk,CubicBezierCurve3:Jne,EllipseCurve:mP,LineCurve:sk,LineCurve3:$ne,QuadraticBezierCurve:ak,QuadraticBezierCurve3:ok,SplineCurve:lk});class ese extends dc{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(t){this.curves.push(t)}closePath(){const t=this.curves[0].getPoint(0),i=this.curves[this.curves.length-1].getPoint(1);if(!t.equals(i)){const r=t.isVector2===!0?"LineCurve":"LineCurve3";this.curves.push(new JT[r](i,t))}return this}getPoint(t,i){const r=t*this.getLength(),n=this.getCurveLengths();let s=0;for(;s<n.length;){if(n[s]>=r){const a=n[s]-r,o=this.curves[s],l=o.getLength(),c=l===0?0:1-a/l;return o.getPointAt(c,i)}s++}return null}getLength(){const t=this.getCurveLengths();return t[t.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const t=[];let i=0;for(let r=0,n=this.curves.length;r<n;r++)i+=this.curves[r].getLength(),t.push(i);return this.cacheLengths=t,t}getSpacedPoints(t=40){const i=[];for(let r=0;r<=t;r++)i.push(this.getPoint(r/t));return this.autoClose&&i.push(i[0]),i}getPoints(t=12){const i=[];let r;for(let n=0,s=this.curves;n<s.length;n++){const a=s[n],o=a.isEllipseCurve?t*2:a.isLineCurve||a.isLineCurve3?1:a.isSplineCurve?t*a.points.length:t,l=a.getPoints(o);for(let c=0;c<l.length;c++){const u=l[c];r&&r.equals(u)||(i.push(u),r=u)}}return this.autoClose&&i.length>1&&!i[i.length-1].equals(i[0])&&i.push(i[0]),i}copy(t){super.copy(t),this.curves=[];for(let i=0,r=t.curves.length;i<r;i++){const n=t.curves[i];this.curves.push(n.clone())}return this.autoClose=t.autoClose,this}toJSON(){const t=super.toJSON();t.autoClose=this.autoClose,t.curves=[];for(let i=0,r=this.curves.length;i<r;i++){const n=this.curves[i];t.curves.push(n.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.autoClose=t.autoClose,this.curves=[];for(let i=0,r=t.curves.length;i<r;i++){const n=t.curves[i];this.curves.push(new JT[n.type]().fromJSON(n))}return this}}class lb extends ese{constructor(t){super(),this.type="Path",this.currentPoint=new ut,t&&this.setFromPoints(t)}setFromPoints(t){this.moveTo(t[0].x,t[0].y);for(let i=1,r=t.length;i<r;i++)this.lineTo(t[i].x,t[i].y);return this}moveTo(t,i){return this.currentPoint.set(t,i),this}lineTo(t,i){const r=new sk(this.currentPoint.clone(),new ut(t,i));return this.curves.push(r),this.currentPoint.set(t,i),this}quadraticCurveTo(t,i,r,n){const s=new ak(this.currentPoint.clone(),new ut(t,i),new ut(r,n));return this.curves.push(s),this.currentPoint.set(r,n),this}bezierCurveTo(t,i,r,n,s,a){const o=new nk(this.currentPoint.clone(),new ut(t,i),new ut(r,n),new ut(s,a));return this.curves.push(o),this.currentPoint.set(s,a),this}splineThru(t){const i=[this.currentPoint.clone()].concat(t),r=new lk(i);return this.curves.push(r),this.currentPoint.copy(t[t.length-1]),this}arc(t,i,r,n,s,a){const o=this.currentPoint.x,l=this.currentPoint.y;return this.absarc(t+o,i+l,r,n,s,a),this}absarc(t,i,r,n,s,a){return this.absellipse(t,i,r,r,n,s,a),this}ellipse(t,i,r,n,s,a,o,l){const c=this.currentPoint.x,u=this.currentPoint.y;return this.absellipse(t+c,i+u,r,n,s,a,o,l),this}absellipse(t,i,r,n,s,a,o,l){const c=new mP(t,i,r,n,s,a,o,l);if(this.curves.length>0){const h=c.getPoint(0);h.equals(this.currentPoint)||this.lineTo(h.x,h.y)}this.curves.push(c);const u=c.getPoint(1);return this.currentPoint.copy(u),this}copy(t){return super.copy(t),this.currentPoint.copy(t.currentPoint),this}toJSON(){const t=super.toJSON();return t.currentPoint=this.currentPoint.toArray(),t}fromJSON(t){return super.fromJSON(t),this.currentPoint.fromArray(t.currentPoint),this}}class Zb extends Pi{constructor(t=[new ut(0,-.5),new ut(.5,0),new ut(0,.5)],i=12,r=0,n=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:t,segments:i,phiStart:r,phiLength:n},i=Math.floor(i),n=wi(n,0,Math.PI*2);const s=[],a=[],o=[],l=[],c=[],u=1/i,h=new he,d=new ut,f=new he,p=new he,v=new he;let m=0,g=0;for(let y=0;y<=t.length-1;y++)switch(y){case 0:m=t[y+1].x-t[y].x,g=t[y+1].y-t[y].y,f.x=g*1,f.y=-m,f.z=g*0,v.copy(f),f.normalize(),l.push(f.x,f.y,f.z);break;case t.length-1:l.push(v.x,v.y,v.z);break;default:m=t[y+1].x-t[y].x,g=t[y+1].y-t[y].y,f.x=g*1,f.y=-m,f.z=g*0,p.copy(f),f.x+=v.x,f.y+=v.y,f.z+=v.z,f.normalize(),l.push(f.x,f.y,f.z),v.copy(p)}for(let y=0;y<=i;y++){const x=r+y*u*n,_=Math.sin(x),M=Math.cos(x);for(let S=0;S<=t.length-1;S++){h.x=t[S].x*_,h.y=t[S].y,h.z=t[S].x*M,a.push(h.x,h.y,h.z),d.x=y/i,d.y=S/(t.length-1),o.push(d.x,d.y);const T=l[3*S+0]*_,E=l[3*S+1],C=l[3*S+0]*M;c.push(T,E,C)}}for(let y=0;y<i;y++)for(let x=0;x<t.length-1;x++){const _=x+y*t.length,M=_,S=_+t.length,T=_+t.length+1,E=_+1;s.push(M,S,E),s.push(T,E,S)}this.setIndex(s),this.setAttribute("position",new Gt(a,3)),this.setAttribute("uv",new Gt(o,2)),this.setAttribute("normal",new Gt(c,3))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Zb(t.points,t.segments,t.phiStart,t.phiLength)}}class gP extends Zb{constructor(t=1,i=1,r=4,n=8){const s=new lb;s.absarc(0,-i/2,t,Math.PI*1.5,0),s.absarc(0,i/2,t,0,Math.PI*.5),super(s.getPoints(r),n),this.type="CapsuleGeometry",this.parameters={radius:t,length:i,capSegments:r,radialSegments:n}}static fromJSON(t){return new gP(t.radius,t.length,t.capSegments,t.radialSegments)}}class vP extends Pi{constructor(t=1,i=32,r=0,n=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:t,segments:i,thetaStart:r,thetaLength:n},i=Math.max(3,i);const s=[],a=[],o=[],l=[],c=new he,u=new ut;a.push(0,0,0),o.push(0,0,1),l.push(.5,.5);for(let h=0,d=3;h<=i;h++,d+=3){const f=r+h/i*n;c.x=t*Math.cos(f),c.y=t*Math.sin(f),a.push(c.x,c.y,c.z),o.push(0,0,1),u.x=(a[d]/t+1)/2,u.y=(a[d+1]/t+1)/2,l.push(u.x,u.y)}for(let h=1;h<=i;h++)s.push(h,h+1,0);this.setIndex(s),this.setAttribute("position",new Gt(a,3)),this.setAttribute("normal",new Gt(o,3)),this.setAttribute("uv",new Gt(l,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new vP(t.radius,t.segments,t.thetaStart,t.thetaLength)}}class Sy extends Pi{constructor(t=1,i=1,r=1,n=32,s=1,a=!1,o=0,l=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:i,height:r,radialSegments:n,heightSegments:s,openEnded:a,thetaStart:o,thetaLength:l};const c=this;n=Math.floor(n),s=Math.floor(s);const u=[],h=[],d=[],f=[];let p=0;const v=[],m=r/2;let g=0;y(),a===!1&&(t>0&&x(!0),i>0&&x(!1)),this.setIndex(u),this.setAttribute("position",new Gt(h,3)),this.setAttribute("normal",new Gt(d,3)),this.setAttribute("uv",new Gt(f,2));function y(){const _=new he,M=new he;let S=0;const T=(i-t)/r;for(let E=0;E<=s;E++){const C=[],A=E/s,D=A*(i-t)+t;for(let R=0;R<=n;R++){const L=R/n,O=L*l+o,H=Math.sin(O),j=Math.cos(O);M.x=D*H,M.y=-A*r+m,M.z=D*j,h.push(M.x,M.y,M.z),_.set(H,T,j).normalize(),d.push(_.x,_.y,_.z),f.push(L,1-A),C.push(p++)}v.push(C)}for(let E=0;E<n;E++)for(let C=0;C<s;C++){const A=v[C][E],D=v[C+1][E],R=v[C+1][E+1],L=v[C][E+1];(t>0||C!==0)&&(u.push(A,D,L),S+=3),(i>0||C!==s-1)&&(u.push(D,R,L),S+=3)}c.addGroup(g,S,0),g+=S}function x(_){const M=p,S=new ut,T=new he;let E=0;const C=_===!0?t:i,A=_===!0?1:-1;for(let R=1;R<=n;R++)h.push(0,m*A,0),d.push(0,A,0),f.push(.5,.5),p++;const D=p;for(let R=0;R<=n;R++){const O=R/n*l+o,H=Math.cos(O),j=Math.sin(O);T.x=C*j,T.y=m*A,T.z=C*H,h.push(T.x,T.y,T.z),d.push(0,A,0),S.x=H*.5+.5,S.y=j*.5*A+.5,f.push(S.x,S.y),p++}for(let R=0;R<n;R++){const L=M+R,O=D+R;_===!0?u.push(O,O+1,L):u.push(O+1,O,L),E+=3}c.addGroup(g,E,_===!0?1:2),g+=E}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Sy(t.radiusTop,t.radiusBottom,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class yP extends Sy{constructor(t=1,i=1,r=32,n=1,s=!1,a=0,o=Math.PI*2){super(0,t,i,r,n,s,a,o),this.type="ConeGeometry",this.parameters={radius:t,height:i,radialSegments:r,heightSegments:n,openEnded:s,thetaStart:a,thetaLength:o}}static fromJSON(t){return new yP(t.radius,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class If extends Pi{constructor(t=[],i=[],r=1,n=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:i,radius:r,detail:n};const s=[],a=[];o(n),c(r),u(),this.setAttribute("position",new Gt(s,3)),this.setAttribute("normal",new Gt(s.slice(),3)),this.setAttribute("uv",new Gt(a,2)),n===0?this.computeVertexNormals():this.normalizeNormals();function o(y){const x=new he,_=new he,M=new he;for(let S=0;S<i.length;S+=3)f(i[S+0],x),f(i[S+1],_),f(i[S+2],M),l(x,_,M,y)}function l(y,x,_,M){const S=M+1,T=[];for(let E=0;E<=S;E++){T[E]=[];const C=y.clone().lerp(_,E/S),A=x.clone().lerp(_,E/S),D=S-E;for(let R=0;R<=D;R++)R===0&&E===S?T[E][R]=C:T[E][R]=C.clone().lerp(A,R/D)}for(let E=0;E<S;E++)for(let C=0;C<2*(S-E)-1;C++){const A=Math.floor(C/2);C%2===0?(d(T[E][A+1]),d(T[E+1][A]),d(T[E][A])):(d(T[E][A+1]),d(T[E+1][A+1]),d(T[E+1][A]))}}function c(y){const x=new he;for(let _=0;_<s.length;_+=3)x.x=s[_+0],x.y=s[_+1],x.z=s[_+2],x.normalize().multiplyScalar(y),s[_+0]=x.x,s[_+1]=x.y,s[_+2]=x.z}function u(){const y=new he;for(let x=0;x<s.length;x+=3){y.x=s[x+0],y.y=s[x+1],y.z=s[x+2];const _=m(y)/2/Math.PI+.5,M=g(y)/Math.PI+.5;a.push(_,1-M)}p(),h()}function h(){for(let y=0;y<a.length;y+=6){const x=a[y+0],_=a[y+2],M=a[y+4],S=Math.max(x,_,M),T=Math.min(x,_,M);S>.9&&T<.1&&(x<.2&&(a[y+0]+=1),_<.2&&(a[y+2]+=1),M<.2&&(a[y+4]+=1))}}function d(y){s.push(y.x,y.y,y.z)}function f(y,x){const _=y*3;x.x=t[_+0],x.y=t[_+1],x.z=t[_+2]}function p(){const y=new he,x=new he,_=new he,M=new he,S=new ut,T=new ut,E=new ut;for(let C=0,A=0;C<s.length;C+=9,A+=6){y.set(s[C+0],s[C+1],s[C+2]),x.set(s[C+3],s[C+4],s[C+5]),_.set(s[C+6],s[C+7],s[C+8]),S.set(a[A+0],a[A+1]),T.set(a[A+2],a[A+3]),E.set(a[A+4],a[A+5]),M.copy(y).add(x).add(_).divideScalar(3);const D=m(M);v(S,A+0,y,D),v(T,A+2,x,D),v(E,A+4,_,D)}}function v(y,x,_,M){M<0&&y.x===1&&(a[x]=y.x-1),_.x===0&&_.z===0&&(a[x]=M/2/Math.PI+.5)}function m(y){return Math.atan2(y.z,-y.x)}function g(y){return Math.atan2(-y.y,Math.sqrt(y.x*y.x+y.z*y.z))}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new If(t.vertices,t.indices,t.radius,t.details)}}class xP extends If{constructor(t=1,i=0){const r=(1+Math.sqrt(5))/2,n=1/r,s=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-r,0,-n,r,0,n,-r,0,n,r,-n,-r,0,-n,r,0,n,-r,0,n,r,0,-r,0,-n,r,0,-n,-r,0,n,r,0,n],a=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(s,a,t,i),this.type="DodecahedronGeometry",this.parameters={radius:t,detail:i}}static fromJSON(t){return new xP(t.radius,t.detail)}}const mE=new he,gE=new he,rL=new he,vE=new to;class tse extends Pi{constructor(t=null,i=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:t,thresholdAngle:i},t!==null){const n=Math.pow(10,4),s=Math.cos(fm*i),a=t.getIndex(),o=t.getAttribute("position"),l=a?a.count:o.count,c=[0,0,0],u=["a","b","c"],h=new Array(3),d={},f=[];for(let p=0;p<l;p+=3){a?(c[0]=a.getX(p),c[1]=a.getX(p+1),c[2]=a.getX(p+2)):(c[0]=p,c[1]=p+1,c[2]=p+2);const{a:v,b:m,c:g}=vE;if(v.fromBufferAttribute(o,c[0]),m.fromBufferAttribute(o,c[1]),g.fromBufferAttribute(o,c[2]),vE.getNormal(rL),h[0]=`${Math.round(v.x*n)},${Math.round(v.y*n)},${Math.round(v.z*n)}`,h[1]=`${Math.round(m.x*n)},${Math.round(m.y*n)},${Math.round(m.z*n)}`,h[2]=`${Math.round(g.x*n)},${Math.round(g.y*n)},${Math.round(g.z*n)}`,!(h[0]===h[1]||h[1]===h[2]||h[2]===h[0]))for(let y=0;y<3;y++){const x=(y+1)%3,_=h[y],M=h[x],S=vE[u[y]],T=vE[u[x]],E=`${_}_${M}`,C=`${M}_${_}`;C in d&&d[C]?(rL.dot(d[C].normal)<=s&&(f.push(S.x,S.y,S.z),f.push(T.x,T.y,T.z)),d[C]=null):E in d||(d[E]={index0:c[y],index1:c[x],normal:rL.clone()})}}for(const p in d)if(d[p]){const{index0:v,index1:m}=d[p];mE.fromBufferAttribute(o,v),gE.fromBufferAttribute(o,m),f.push(mE.x,mE.y,mE.z),f.push(gE.x,gE.y,gE.z)}this.setAttribute("position",new Gt(f,3))}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}}class mm extends lb{constructor(t){super(t),this.uuid=Lo(),this.type="Shape",this.holes=[]}getPointsHoles(t){const i=[];for(let r=0,n=this.holes.length;r<n;r++)i[r]=this.holes[r].getPoints(t);return i}extractPoints(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}}copy(t){super.copy(t),this.holes=[];for(let i=0,r=t.holes.length;i<r;i++){const n=t.holes[i];this.holes.push(n.clone())}return this}toJSON(){const t=super.toJSON();t.uuid=this.uuid,t.holes=[];for(let i=0,r=this.holes.length;i<r;i++){const n=this.holes[i];t.holes.push(n.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.uuid=t.uuid,this.holes=[];for(let i=0,r=t.holes.length;i<r;i++){const n=t.holes[i];this.holes.push(new lb().fromJSON(n))}return this}}class iHe{static triangulate(t,i,r=2){const n=i&&i.length,s=n?i[0]*r:t.length;let a=ise(t,0,s,r,!0);const o=[];if(!a||a.next===a.prev)return o;let l,c,u,h,d,f,p;if(n&&(a=oHe(t,i,a,r)),t.length>80*r){l=u=t[0],c=h=t[1];for(let v=r;v<s;v+=r)d=t[v],f=t[v+1],d<l&&(l=d),f<c&&(c=f),d>u&&(u=d),f>h&&(h=f);p=Math.max(u-l,h-c),p=p!==0?32767/p:0}return cb(a,o,r,l,c,p,0),o}}function ise(e,t,i,r,n){let s,a;if(n===yHe(e,t,i,r)>0)for(s=t;s<i;s+=r)a=jX(s,e[s],e[s+1],a);else for(s=i-r;s>=t;s-=r)a=jX(s,e[s],e[s+1],a);return a&&wP(a,a.next)&&(hb(a),a=a.next),a}function Um(e,t){if(!e)return e;t||(t=e);let i=e,r;do if(r=!1,!i.steiner&&(wP(i,i.next)||Vr(i.prev,i,i.next)===0)){if(hb(i),i=t=i.prev,i===i.next)break;r=!0}else i=i.next;while(r||i!==t);return t}function cb(e,t,i,r,n,s,a){if(!e)return;!a&&s&&dHe(e,r,n,s);let o=e,l,c;for(;e.prev!==e.next;){if(l=e.prev,c=e.next,s?nHe(e,r,n,s):rHe(e)){t.push(l.i/i|0),t.push(e.i/i|0),t.push(c.i/i|0),hb(e),e=c.next,o=c.next;continue}if(e=c,e===o){a?a===1?(e=sHe(Um(e),t,i),cb(e,t,i,r,n,s,2)):a===2&&aHe(e,t,i,r,n,s):cb(Um(e),t,i,r,n,s,1);break}}}function rHe(e){const t=e.prev,i=e,r=e.next;if(Vr(t,i,r)>=0)return!1;const n=t.x,s=i.x,a=r.x,o=t.y,l=i.y,c=r.y,u=n<s?n<a?n:a:s<a?s:a,h=o<l?o<c?o:c:l<c?l:c,d=n>s?n>a?n:a:s>a?s:a,f=o>l?o>c?o:c:l>c?l:c;let p=r.next;for(;p!==t;){if(p.x>=u&&p.x<=d&&p.y>=h&&p.y<=f&&Jv(n,o,s,l,a,c,p.x,p.y)&&Vr(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function nHe(e,t,i,r){const n=e.prev,s=e,a=e.next;if(Vr(n,s,a)>=0)return!1;const o=n.x,l=s.x,c=a.x,u=n.y,h=s.y,d=a.y,f=o<l?o<c?o:c:l<c?l:c,p=u<h?u<d?u:d:h<d?h:d,v=o>l?o>c?o:c:l>c?l:c,m=u>h?u>d?u:d:h>d?h:d,g=tF(f,p,t,i,r),y=tF(v,m,t,i,r);let x=e.prevZ,_=e.nextZ;for(;x&&x.z>=g&&_&&_.z<=y;){if(x.x>=f&&x.x<=v&&x.y>=p&&x.y<=m&&x!==n&&x!==a&&Jv(o,u,l,h,c,d,x.x,x.y)&&Vr(x.prev,x,x.next)>=0||(x=x.prevZ,_.x>=f&&_.x<=v&&_.y>=p&&_.y<=m&&_!==n&&_!==a&&Jv(o,u,l,h,c,d,_.x,_.y)&&Vr(_.prev,_,_.next)>=0))return!1;_=_.nextZ}for(;x&&x.z>=g;){if(x.x>=f&&x.x<=v&&x.y>=p&&x.y<=m&&x!==n&&x!==a&&Jv(o,u,l,h,c,d,x.x,x.y)&&Vr(x.prev,x,x.next)>=0)return!1;x=x.prevZ}for(;_&&_.z<=y;){if(_.x>=f&&_.x<=v&&_.y>=p&&_.y<=m&&_!==n&&_!==a&&Jv(o,u,l,h,c,d,_.x,_.y)&&Vr(_.prev,_,_.next)>=0)return!1;_=_.nextZ}return!0}function sHe(e,t,i){let r=e;do{const n=r.prev,s=r.next.next;!wP(n,s)&&rse(n,r,r.next,s)&&ub(n,s)&&ub(s,n)&&(t.push(n.i/i|0),t.push(r.i/i|0),t.push(s.i/i|0),hb(r),hb(r.next),r=e=s),r=r.next}while(r!==e);return Um(r)}function aHe(e,t,i,r,n,s){let a=e;do{let o=a.next.next;for(;o!==a.prev;){if(a.i!==o.i&&mHe(a,o)){let l=nse(a,o);a=Um(a,a.next),l=Um(l,l.next),cb(a,t,i,r,n,s,0),cb(l,t,i,r,n,s,0);return}o=o.next}a=a.next}while(a!==e)}function oHe(e,t,i,r){const n=[];let s,a,o,l,c;for(s=0,a=t.length;s<a;s++)o=t[s]*r,l=s<a-1?t[s+1]*r:e.length,c=ise(e,o,l,r,!1),c===c.next&&(c.steiner=!0),n.push(pHe(c));for(n.sort(lHe),s=0;s<n.length;s++)i=cHe(n[s],i);return i}function lHe(e,t){return e.x-t.x}function cHe(e,t){const i=uHe(e,t);if(!i)return t;const r=nse(i,e);return Um(r,r.next),Um(i,i.next)}function uHe(e,t){let i=t,r=-1/0,n;const s=e.x,a=e.y;do{if(a<=i.y&&a>=i.next.y&&i.next.y!==i.y){const d=i.x+(a-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(d<=s&&d>r&&(r=d,n=i.x<i.next.x?i:i.next,d===s))return n}i=i.next}while(i!==t);if(!n)return null;const o=n,l=n.x,c=n.y;let u=1/0,h;i=n;do s>=i.x&&i.x>=l&&s!==i.x&&Jv(a<c?s:r,a,l,c,a<c?r:s,a,i.x,i.y)&&(h=Math.abs(a-i.y)/(s-i.x),ub(i,e)&&(h<u||h===u&&(i.x>n.x||i.x===n.x&&hHe(n,i)))&&(n=i,u=h)),i=i.next;while(i!==o);return n}function hHe(e,t){return Vr(e.prev,e,t.prev)<0&&Vr(t.next,e,e.next)<0}function dHe(e,t,i,r){let n=e;do n.z===0&&(n.z=tF(n.x,n.y,t,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==e);n.prevZ.nextZ=null,n.prevZ=null,fHe(n)}function fHe(e){let t,i,r,n,s,a,o,l,c=1;do{for(i=e,e=null,s=null,a=0;i;){for(a++,r=i,o=0,t=0;t<c&&(o++,r=r.nextZ,!!r);t++);for(l=c;o>0||l>0&&r;)o!==0&&(l===0||!r||i.z<=r.z)?(n=i,i=i.nextZ,o--):(n=r,r=r.nextZ,l--),s?s.nextZ=n:e=n,n.prevZ=s,s=n;i=r}s.nextZ=null,c*=2}while(a>1);return e}function tF(e,t,i,r,n){return e=(e-i)*n|0,t=(t-r)*n|0,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e|t<<1}function pHe(e){let t=e,i=e;do(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next;while(t!==e);return i}function Jv(e,t,i,r,n,s,a,o){return(n-a)*(t-o)>=(e-a)*(s-o)&&(e-a)*(r-o)>=(i-a)*(t-o)&&(i-a)*(s-o)>=(n-a)*(r-o)}function mHe(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!gHe(e,t)&&(ub(e,t)&&ub(t,e)&&vHe(e,t)&&(Vr(e.prev,e,t.prev)||Vr(e,t.prev,t))||wP(e,t)&&Vr(e.prev,e,e.next)>0&&Vr(t.prev,t,t.next)>0)}function Vr(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function wP(e,t){return e.x===t.x&&e.y===t.y}function rse(e,t,i,r){const n=xE(Vr(e,t,i)),s=xE(Vr(e,t,r)),a=xE(Vr(i,r,e)),o=xE(Vr(i,r,t));return!!(n!==s&&a!==o||n===0&&yE(e,i,t)||s===0&&yE(e,r,t)||a===0&&yE(i,e,r)||o===0&&yE(i,t,r))}function yE(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function xE(e){return e>0?1:e<0?-1:0}function gHe(e,t){let i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&rse(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}function ub(e,t){return Vr(e.prev,e,e.next)<0?Vr(e,t,e.next)>=0&&Vr(e,e.prev,t)>=0:Vr(e,t,e.prev)<0||Vr(e,e.next,t)<0}function vHe(e,t){let i=e,r=!1;const n=(e.x+t.x)/2,s=(e.y+t.y)/2;do i.y>s!=i.next.y>s&&i.next.y!==i.y&&n<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next;while(i!==e);return r}function nse(e,t){const i=new iF(e.i,e.x,e.y),r=new iF(t.i,t.x,t.y),n=e.next,s=t.prev;return e.next=t,t.prev=e,i.next=n,n.prev=i,r.next=i,i.prev=r,s.next=r,r.prev=s,r}function jX(e,t,i,r){const n=new iF(e,t,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function hb(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function iF(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function yHe(e,t,i,r){let n=0;for(let s=t,a=i-r;s<i;s+=r)n+=(e[a]-e[s])*(e[s+1]+e[a+1]),a=s;return n}class su{static area(t){const i=t.length;let r=0;for(let n=i-1,s=0;s<i;n=s++)r+=t[n].x*t[s].y-t[s].x*t[n].y;return r*.5}static isClockWise(t){return su.area(t)<0}static triangulateShape(t,i){const r=[],n=[],s=[];WX(t),XX(r,t);let a=t.length;i.forEach(WX);for(let l=0;l<i.length;l++)n.push(a),a+=i[l].length,XX(r,i[l]);const o=iHe.triangulate(r,n);for(let l=0;l<o.length;l+=3)s.push(o.slice(l,l+3));return s}}function WX(e){const t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function XX(e,t){for(let i=0;i<t.length;i++)e.push(t[i].x),e.push(t[i].y)}class bP extends Pi{constructor(t=new mm([new ut(.5,.5),new ut(-.5,.5),new ut(-.5,-.5),new ut(.5,-.5)]),i={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:i},t=Array.isArray(t)?t:[t];const r=this,n=[],s=[];for(let o=0,l=t.length;o<l;o++){const c=t[o];a(c)}this.setAttribute("position",new Gt(n,3)),this.setAttribute("uv",new Gt(s,2)),this.computeVertexNormals();function a(o){const l=[],c=i.curveSegments!==void 0?i.curveSegments:12,u=i.steps!==void 0?i.steps:1,h=i.depth!==void 0?i.depth:1;let d=i.bevelEnabled!==void 0?i.bevelEnabled:!0,f=i.bevelThickness!==void 0?i.bevelThickness:.2,p=i.bevelSize!==void 0?i.bevelSize:f-.1,v=i.bevelOffset!==void 0?i.bevelOffset:0,m=i.bevelSegments!==void 0?i.bevelSegments:3;const g=i.extrudePath,y=i.UVGenerator!==void 0?i.UVGenerator:xHe;let x,_=!1,M,S,T,E;g&&(x=g.getSpacedPoints(u),_=!0,d=!1,M=g.computeFrenetFrames(u,!1),S=new he,T=new he,E=new he),d||(m=0,f=0,p=0,v=0);const C=o.extractPoints(c);let A=C.shape;const D=C.holes;if(!su.isClockWise(A)){A=A.reverse();for(let le=0,ve=D.length;le<ve;le++){const ie=D[le];su.isClockWise(ie)&&(D[le]=ie.reverse())}}const L=su.triangulateShape(A,D),O=A;for(let le=0,ve=D.length;le<ve;le++){const ie=D[le];A=A.concat(ie)}function H(le,ve,ie){return ve||console.error("THREE.ExtrudeGeometry: vec does not exist"),le.clone().addScaledVector(ve,ie)}const j=A.length,Y=L.length;function z(le,ve,ie){let Ce,Pe,Ne;const be=le.x-ve.x,Le=le.y-ve.y,Fe=ie.x-le.x,K=ie.y-le.y,B=be*be+Le*Le,G=be*K-Le*Fe;if(Math.abs(G)>Number.EPSILON){const oe=Math.sqrt(B),fe=Math.sqrt(Fe*Fe+K*K),W=ve.x-Le/oe,Ie=ve.y+be/oe,Oe=ie.x-K/fe,Be=ie.y+Fe/fe,Re=((Oe-W)*K-(Be-Ie)*Fe)/(be*K-Le*Fe);Ce=W+be*Re-le.x,Pe=Ie+Le*Re-le.y;const ke=Ce*Ce+Pe*Pe;if(ke<=2)return new ut(Ce,Pe);Ne=Math.sqrt(ke/2)}else{let oe=!1;be>Number.EPSILON?Fe>Number.EPSILON&&(oe=!0):be<-Number.EPSILON?Fe<-Number.EPSILON&&(oe=!0):Math.sign(Le)===Math.sign(K)&&(oe=!0),oe?(Ce=-Le,Pe=be,Ne=Math.sqrt(B)):(Ce=be,Pe=Le,Ne=Math.sqrt(B/2))}return new ut(Ce/Ne,Pe/Ne)}const V=[];for(let le=0,ve=O.length,ie=ve-1,Ce=le+1;le<ve;le++,ie++,Ce++)ie===ve&&(ie=0),Ce===ve&&(Ce=0),V[le]=z(O[le],O[ie],O[Ce]);const U=[];let k,X=V.concat();for(let le=0,ve=D.length;le<ve;le++){const ie=D[le];k=[];for(let Ce=0,Pe=ie.length,Ne=Pe-1,be=Ce+1;Ce<Pe;Ce++,Ne++,be++)Ne===Pe&&(Ne=0),be===Pe&&(be=0),k[Ce]=z(ie[Ce],ie[Ne],ie[be]);U.push(k),X=X.concat(k)}for(let le=0;le<m;le++){const ve=le/m,ie=f*Math.cos(ve*Math.PI/2),Ce=p*Math.sin(ve*Math.PI/2)+v;for(let Pe=0,Ne=O.length;Pe<Ne;Pe++){const be=H(O[Pe],V[Pe],Ce);ne(be.x,be.y,-ie)}for(let Pe=0,Ne=D.length;Pe<Ne;Pe++){const be=D[Pe];k=U[Pe];for(let Le=0,Fe=be.length;Le<Fe;Le++){const K=H(be[Le],k[Le],Ce);ne(K.x,K.y,-ie)}}}const re=p+v;for(let le=0;le<j;le++){const ve=d?H(A[le],X[le],re):A[le];_?(T.copy(M.normals[0]).multiplyScalar(ve.x),S.copy(M.binormals[0]).multiplyScalar(ve.y),E.copy(x[0]).add(T).add(S),ne(E.x,E.y,E.z)):ne(ve.x,ve.y,0)}for(let le=1;le<=u;le++)for(let ve=0;ve<j;ve++){const ie=d?H(A[ve],X[ve],re):A[ve];_?(T.copy(M.normals[le]).multiplyScalar(ie.x),S.copy(M.binormals[le]).multiplyScalar(ie.y),E.copy(x[le]).add(T).add(S),ne(E.x,E.y,E.z)):ne(ie.x,ie.y,h/u*le)}for(let le=m-1;le>=0;le--){const ve=le/m,ie=f*Math.cos(ve*Math.PI/2),Ce=p*Math.sin(ve*Math.PI/2)+v;for(let Pe=0,Ne=O.length;Pe<Ne;Pe++){const be=H(O[Pe],V[Pe],Ce);ne(be.x,be.y,h+ie)}for(let Pe=0,Ne=D.length;Pe<Ne;Pe++){const be=D[Pe];k=U[Pe];for(let Le=0,Fe=be.length;Le<Fe;Le++){const K=H(be[Le],k[Le],Ce);_?ne(K.x,K.y+x[u-1].y,x[u-1].x+ie):ne(K.x,K.y,h+ie)}}}q(),ee();function q(){const le=n.length/3;if(d){let ve=0,ie=j*ve;for(let Ce=0;Ce<Y;Ce++){const Pe=L[Ce];ce(Pe[2]+ie,Pe[1]+ie,Pe[0]+ie)}ve=u+m*2,ie=j*ve;for(let Ce=0;Ce<Y;Ce++){const Pe=L[Ce];ce(Pe[0]+ie,Pe[1]+ie,Pe[2]+ie)}}else{for(let ve=0;ve<Y;ve++){const ie=L[ve];ce(ie[2],ie[1],ie[0])}for(let ve=0;ve<Y;ve++){const ie=L[ve];ce(ie[0]+j*u,ie[1]+j*u,ie[2]+j*u)}}r.addGroup(le,n.length/3-le,0)}function ee(){const le=n.length/3;let ve=0;$(O,ve),ve+=O.length;for(let ie=0,Ce=D.length;ie<Ce;ie++){const Pe=D[ie];$(Pe,ve),ve+=Pe.length}r.addGroup(le,n.length/3-le,1)}function $(le,ve){let ie=le.length;for(;--ie>=0;){const Ce=ie;let Pe=ie-1;Pe<0&&(Pe=le.length-1);for(let Ne=0,be=u+m*2;Ne<be;Ne++){const Le=j*Ne,Fe=j*(Ne+1),K=ve+Ce+Le,B=ve+Pe+Le,G=ve+Pe+Fe,oe=ve+Ce+Fe;pe(K,B,G,oe)}}}function ne(le,ve,ie){l.push(le),l.push(ve),l.push(ie)}function ce(le,ve,ie){ge(le),ge(ve),ge(ie);const Ce=n.length/3,Pe=y.generateTopUV(r,n,Ce-3,Ce-2,Ce-1);we(Pe[0]),we(Pe[1]),we(Pe[2])}function pe(le,ve,ie,Ce){ge(le),ge(ve),ge(Ce),ge(ve),ge(ie),ge(Ce);const Pe=n.length/3,Ne=y.generateSideWallUV(r,n,Pe-6,Pe-3,Pe-2,Pe-1);we(Ne[0]),we(Ne[1]),we(Ne[3]),we(Ne[1]),we(Ne[2]),we(Ne[3])}function ge(le){n.push(l[le*3+0]),n.push(l[le*3+1]),n.push(l[le*3+2])}function we(le){s.push(le.x),s.push(le.y)}}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON(),i=this.parameters.shapes,r=this.parameters.options;return wHe(i,r,t)}static fromJSON(t,i){const r=[];for(let s=0,a=t.shapes.length;s<a;s++){const o=i[t.shapes[s]];r.push(o)}const n=t.options.extrudePath;return n!==void 0&&(t.options.extrudePath=new JT[n.type]().fromJSON(n)),new bP(r,t.options)}}const xHe={generateTopUV:function(e,t,i,r,n){const s=t[i*3],a=t[i*3+1],o=t[r*3],l=t[r*3+1],c=t[n*3],u=t[n*3+1];return[new ut(s,a),new ut(o,l),new ut(c,u)]},generateSideWallUV:function(e,t,i,r,n,s){const a=t[i*3],o=t[i*3+1],l=t[i*3+2],c=t[r*3],u=t[r*3+1],h=t[r*3+2],d=t[n*3],f=t[n*3+1],p=t[n*3+2],v=t[s*3],m=t[s*3+1],g=t[s*3+2];return Math.abs(o-u)<Math.abs(a-c)?[new ut(a,1-l),new ut(c,1-h),new ut(d,1-p),new ut(v,1-g)]:[new ut(o,1-l),new ut(u,1-h),new ut(f,1-p),new ut(m,1-g)]}};function wHe(e,t,i){if(i.shapes=[],Array.isArray(e))for(let r=0,n=e.length;r<n;r++){const s=e[r];i.shapes.push(s.uuid)}else i.shapes.push(e.uuid);return i.options=Object.assign({},t),t.extrudePath!==void 0&&(i.options.extrudePath=t.extrudePath.toJSON()),i}class _P extends If{constructor(t=1,i=0){const r=(1+Math.sqrt(5))/2,n=[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1],s=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(n,s,t,i),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:i}}static fromJSON(t){return new _P(t.radius,t.detail)}}class Kb extends If{constructor(t=1,i=0){const r=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],n=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(r,n,t,i),this.type="OctahedronGeometry",this.parameters={radius:t,detail:i}}static fromJSON(t){return new Kb(t.radius,t.detail)}}class Vh extends Pi{constructor(t=1,i=1,r=1,n=1){super(),this.type="PlaneGeometry",this.parameters={width:t,height:i,widthSegments:r,heightSegments:n};const s=t/2,a=i/2,o=Math.floor(r),l=Math.floor(n),c=o+1,u=l+1,h=t/o,d=i/l,f=[],p=[],v=[],m=[];for(let g=0;g<u;g++){const y=g*d-a;for(let x=0;x<c;x++){const _=x*h-s;p.push(_,-y,0),v.push(0,0,1),m.push(x/o),m.push(1-g/l)}}for(let g=0;g<l;g++)for(let y=0;y<o;y++){const x=y+c*g,_=y+c*(g+1),M=y+1+c*(g+1),S=y+1+c*g;f.push(x,_,S),f.push(_,M,S)}this.setIndex(f),this.setAttribute("position",new Gt(p,3)),this.setAttribute("normal",new Gt(v,3)),this.setAttribute("uv",new Gt(m,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Vh(t.width,t.height,t.widthSegments,t.heightSegments)}}class SP extends Pi{constructor(t=.5,i=1,r=32,n=1,s=0,a=Math.PI*2){super(),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:i,thetaSegments:r,phiSegments:n,thetaStart:s,thetaLength:a},r=Math.max(3,r),n=Math.max(1,n);const o=[],l=[],c=[],u=[];let h=t;const d=(i-t)/n,f=new he,p=new ut;for(let v=0;v<=n;v++){for(let m=0;m<=r;m++){const g=s+m/r*a;f.x=h*Math.cos(g),f.y=h*Math.sin(g),l.push(f.x,f.y,f.z),c.push(0,0,1),p.x=(f.x/i+1)/2,p.y=(f.y/i+1)/2,u.push(p.x,p.y)}h+=d}for(let v=0;v<n;v++){const m=v*(r+1);for(let g=0;g<r;g++){const y=g+m,x=y,_=y+r+1,M=y+r+2,S=y+1;o.push(x,_,S),o.push(_,M,S)}}this.setIndex(o),this.setAttribute("position",new Gt(l,3)),this.setAttribute("normal",new Gt(c,3)),this.setAttribute("uv",new Gt(u,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new SP(t.innerRadius,t.outerRadius,t.thetaSegments,t.phiSegments,t.thetaStart,t.thetaLength)}}class MP extends Pi{constructor(t=new mm([new ut(0,.5),new ut(-.5,-.5),new ut(.5,-.5)]),i=12){super(),this.type="ShapeGeometry",this.parameters={shapes:t,curveSegments:i};const r=[],n=[],s=[],a=[];let o=0,l=0;if(Array.isArray(t)===!1)c(t);else for(let u=0;u<t.length;u++)c(t[u]),this.addGroup(o,l,u),o+=l,l=0;this.setIndex(r),this.setAttribute("position",new Gt(n,3)),this.setAttribute("normal",new Gt(s,3)),this.setAttribute("uv",new Gt(a,2));function c(u){const h=n.length/3,d=u.extractPoints(i);let f=d.shape;const p=d.holes;su.isClockWise(f)===!1&&(f=f.reverse());for(let m=0,g=p.length;m<g;m++){const y=p[m];su.isClockWise(y)===!0&&(p[m]=y.reverse())}const v=su.triangulateShape(f,p);for(let m=0,g=p.length;m<g;m++){const y=p[m];f=f.concat(y)}for(let m=0,g=f.length;m<g;m++){const y=f[m];n.push(y.x,y.y,0),s.push(0,0,1),a.push(y.x,y.y)}for(let m=0,g=v.length;m<g;m++){const y=v[m],x=y[0]+h,_=y[1]+h,M=y[2]+h;r.push(x,_,M),l+=3}}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON(),i=this.parameters.shapes;return bHe(i,t)}static fromJSON(t,i){const r=[];for(let n=0,s=t.shapes.length;n<s;n++){const a=i[t.shapes[n]];r.push(a)}return new MP(r,t.curveSegments)}}function bHe(e,t){if(t.shapes=[],Array.isArray(e))for(let i=0,r=e.length;i<r;i++){const n=e[i];t.shapes.push(n.uuid)}else t.shapes.push(e.uuid);return t}class Jb extends Pi{constructor(t=1,i=32,r=16,n=0,s=Math.PI*2,a=0,o=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:i,heightSegments:r,phiStart:n,phiLength:s,thetaStart:a,thetaLength:o},i=Math.max(3,Math.floor(i)),r=Math.max(2,Math.floor(r));const l=Math.min(a+o,Math.PI);let c=0;const u=[],h=new he,d=new he,f=[],p=[],v=[],m=[];for(let g=0;g<=r;g++){const y=[],x=g/r;let _=0;g===0&&a===0?_=.5/i:g===r&&l===Math.PI&&(_=-.5/i);for(let M=0;M<=i;M++){const S=M/i;h.x=-t*Math.cos(n+S*s)*Math.sin(a+x*o),h.y=t*Math.cos(a+x*o),h.z=t*Math.sin(n+S*s)*Math.sin(a+x*o),p.push(h.x,h.y,h.z),d.copy(h).normalize(),v.push(d.x,d.y,d.z),m.push(S+_,1-x),y.push(c++)}u.push(y)}for(let g=0;g<r;g++)for(let y=0;y<i;y++){const x=u[g][y+1],_=u[g][y],M=u[g+1][y],S=u[g+1][y+1];(g!==0||a>0)&&f.push(x,_,S),(g!==r-1||l<Math.PI)&&f.push(_,M,S)}this.setIndex(f),this.setAttribute("position",new Gt(p,3)),this.setAttribute("normal",new Gt(v,3)),this.setAttribute("uv",new Gt(m,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Jb(t.radius,t.widthSegments,t.heightSegments,t.phiStart,t.phiLength,t.thetaStart,t.thetaLength)}}class EP extends If{constructor(t=1,i=0){const r=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],n=[2,1,0,0,3,2,1,3,0,2,3,1];super(r,n,t,i),this.type="TetrahedronGeometry",this.parameters={radius:t,detail:i}}static fromJSON(t){return new EP(t.radius,t.detail)}}class AP extends Pi{constructor(t=1,i=.4,r=12,n=48,s=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:t,tube:i,radialSegments:r,tubularSegments:n,arc:s},r=Math.floor(r),n=Math.floor(n);const a=[],o=[],l=[],c=[],u=new he,h=new he,d=new he;for(let f=0;f<=r;f++)for(let p=0;p<=n;p++){const v=p/n*s,m=f/r*Math.PI*2;h.x=(t+i*Math.cos(m))*Math.cos(v),h.y=(t+i*Math.cos(m))*Math.sin(v),h.z=i*Math.sin(m),o.push(h.x,h.y,h.z),u.x=t*Math.cos(v),u.y=t*Math.sin(v),d.subVectors(h,u).normalize(),l.push(d.x,d.y,d.z),c.push(p/n),c.push(f/r)}for(let f=1;f<=r;f++)for(let p=1;p<=n;p++){const v=(n+1)*f+p-1,m=(n+1)*(f-1)+p-1,g=(n+1)*(f-1)+p,y=(n+1)*f+p;a.push(v,m,y),a.push(m,g,y)}this.setIndex(a),this.setAttribute("position",new Gt(o,3)),this.setAttribute("normal",new Gt(l,3)),this.setAttribute("uv",new Gt(c,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new AP(t.radius,t.tube,t.radialSegments,t.tubularSegments,t.arc)}}class TP extends Pi{constructor(t=1,i=.4,r=64,n=8,s=2,a=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:i,tubularSegments:r,radialSegments:n,p:s,q:a},r=Math.floor(r),n=Math.floor(n);const o=[],l=[],c=[],u=[],h=new he,d=new he,f=new he,p=new he,v=new he,m=new he,g=new he;for(let x=0;x<=r;++x){const _=x/r*s*Math.PI*2;y(_,s,a,t,f),y(_+.01,s,a,t,p),m.subVectors(p,f),g.addVectors(p,f),v.crossVectors(m,g),g.crossVectors(v,m),v.normalize(),g.normalize();for(let M=0;M<=n;++M){const S=M/n*Math.PI*2,T=-i*Math.cos(S),E=i*Math.sin(S);h.x=f.x+(T*g.x+E*v.x),h.y=f.y+(T*g.y+E*v.y),h.z=f.z+(T*g.z+E*v.z),l.push(h.x,h.y,h.z),d.subVectors(h,f).normalize(),c.push(d.x,d.y,d.z),u.push(x/r),u.push(M/n)}}for(let x=1;x<=r;x++)for(let _=1;_<=n;_++){const M=(n+1)*(x-1)+(_-1),S=(n+1)*x+(_-1),T=(n+1)*x+_,E=(n+1)*(x-1)+_;o.push(M,S,E),o.push(S,T,E)}this.setIndex(o),this.setAttribute("position",new Gt(l,3)),this.setAttribute("normal",new Gt(c,3)),this.setAttribute("uv",new Gt(u,2));function y(x,_,M,S,T){const E=Math.cos(x),C=Math.sin(x),A=M/_*x,D=Math.cos(A);T.x=S*(2+D)*.5*E,T.y=S*(2+D)*C*.5,T.z=S*Math.sin(A)*.5}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new TP(t.radius,t.tube,t.tubularSegments,t.radialSegments,t.p,t.q)}}class CP extends Pi{constructor(t=new ok(new he(-1,-1,0),new he(-1,1,0),new he(1,1,0)),i=64,r=1,n=8,s=!1){super(),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:i,radius:r,radialSegments:n,closed:s};const a=t.computeFrenetFrames(i,s);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals;const o=new he,l=new he,c=new ut;let u=new he;const h=[],d=[],f=[],p=[];v(),this.setIndex(p),this.setAttribute("position",new Gt(h,3)),this.setAttribute("normal",new Gt(d,3)),this.setAttribute("uv",new Gt(f,2));function v(){for(let x=0;x<i;x++)m(x);m(s===!1?i:0),y(),g()}function m(x){u=t.getPointAt(x/i,u);const _=a.normals[x],M=a.binormals[x];for(let S=0;S<=n;S++){const T=S/n*Math.PI*2,E=Math.sin(T),C=-Math.cos(T);l.x=C*_.x+E*M.x,l.y=C*_.y+E*M.y,l.z=C*_.z+E*M.z,l.normalize(),d.push(l.x,l.y,l.z),o.x=u.x+r*l.x,o.y=u.y+r*l.y,o.z=u.z+r*l.z,h.push(o.x,o.y,o.z)}}function g(){for(let x=1;x<=i;x++)for(let _=1;_<=n;_++){const M=(n+1)*(x-1)+(_-1),S=(n+1)*x+(_-1),T=(n+1)*x+_,E=(n+1)*(x-1)+_;p.push(M,S,E),p.push(S,T,E)}}function y(){for(let x=0;x<=i;x++)for(let _=0;_<=n;_++)c.x=x/i,c.y=_/n,f.push(c.x,c.y)}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON();return t.path=this.parameters.path.toJSON(),t}static fromJSON(t){return new CP(new JT[t.path.type]().fromJSON(t.path),t.tubularSegments,t.radius,t.radialSegments,t.closed)}}class sse extends Pi{constructor(t=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:t},t!==null){const i=[],r=new Set,n=new he,s=new he;if(t.index!==null){const a=t.attributes.position,o=t.index;let l=t.groups;l.length===0&&(l=[{start:0,count:o.count,materialIndex:0}]);for(let c=0,u=l.length;c<u;++c){const h=l[c],d=h.start,f=h.count;for(let p=d,v=d+f;p<v;p+=3)for(let m=0;m<3;m++){const g=o.getX(p+m),y=o.getX(p+(m+1)%3);n.fromBufferAttribute(a,g),s.fromBufferAttribute(a,y),qX(n,s,r)===!0&&(i.push(n.x,n.y,n.z),i.push(s.x,s.y,s.z))}}}else{const a=t.attributes.position;for(let o=0,l=a.count/3;o<l;o++)for(let c=0;c<3;c++){const u=3*o+c,h=3*o+(c+1)%3;n.fromBufferAttribute(a,u),s.fromBufferAttribute(a,h),qX(n,s,r)===!0&&(i.push(n.x,n.y,n.z),i.push(s.x,s.y,s.z))}}this.setAttribute("position",new Gt(i,3))}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}}function qX(e,t,i){const r=`${e.x},${e.y},${e.z}-${t.x},${t.y},${t.z}`,n=`${t.x},${t.y},${t.z}-${e.x},${e.y},${e.z}`;return i.has(r)===!0||i.has(n)===!0?!1:(i.add(r),i.add(n),!0)}var YX=Object.freeze({__proto__:null,BoxGeometry:Km,CapsuleGeometry:gP,CircleGeometry:vP,ConeGeometry:yP,CylinderGeometry:Sy,DodecahedronGeometry:xP,EdgesGeometry:tse,ExtrudeGeometry:bP,IcosahedronGeometry:_P,LatheGeometry:Zb,OctahedronGeometry:Kb,PlaneGeometry:Vh,PolyhedronGeometry:If,RingGeometry:SP,ShapeGeometry:MP,SphereGeometry:Jb,TetrahedronGeometry:EP,TorusGeometry:AP,TorusKnotGeometry:TP,TubeGeometry:CP,WireframeGeometry:sse});class ase extends ha{constructor(t){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new Rt(0),this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.fog=t.fog,this}}class ose extends cc{constructor(t){super(t),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class ck extends ha{constructor(t){super(),this.isMeshStandardMaterial=!0,this.type="MeshStandardMaterial",this.defines={STANDARD:""},this.color=new Rt(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Rt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Rf,this.normalScale=new ut(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Fo,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.envMapIntensity=t.envMapIntensity,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class uk extends ck{constructor(t){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new ut(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return wi(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(i){this.ior=(1+.4*i)/(1-.4*i)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Rt(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new Rt(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Rt(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(t)}get anisotropy(){return this._anisotropy}set anisotropy(t){this._anisotropy>0!=t>0&&this.version++,this._anisotropy=t}get clearcoat(){return this._clearcoat}set clearcoat(t){this._clearcoat>0!=t>0&&this.version++,this._clearcoat=t}get iridescence(){return this._iridescence}set iridescence(t){this._iridescence>0!=t>0&&this.version++,this._iridescence=t}get dispersion(){return this._dispersion}set dispersion(t){this._dispersion>0!=t>0&&this.version++,this._dispersion=t}get sheen(){return this._sheen}set sheen(t){this._sheen>0!=t>0&&this.version++,this._sheen=t}get transmission(){return this._transmission}set transmission(t){this._transmission>0!=t>0&&this.version++,this._transmission=t}copy(t){return super.copy(t),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=t.anisotropy,this.anisotropyRotation=t.anisotropyRotation,this.anisotropyMap=t.anisotropyMap,this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.dispersion=t.dispersion,this.ior=t.ior,this.iridescence=t.iridescence,this.iridescenceMap=t.iridescenceMap,this.iridescenceIOR=t.iridescenceIOR,this.iridescenceThicknessRange=[...t.iridescenceThicknessRange],this.iridescenceThicknessMap=t.iridescenceThicknessMap,this.sheen=t.sheen,this.sheenColor.copy(t.sheenColor),this.sheenColorMap=t.sheenColorMap,this.sheenRoughness=t.sheenRoughness,this.sheenRoughnessMap=t.sheenRoughnessMap,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this.thickness=t.thickness,this.thicknessMap=t.thicknessMap,this.attenuationDistance=t.attenuationDistance,this.attenuationColor.copy(t.attenuationColor),this.specularIntensity=t.specularIntensity,this.specularIntensityMap=t.specularIntensityMap,this.specularColor.copy(t.specularColor),this.specularColorMap=t.specularColorMap,this}}class lse extends ha{constructor(t){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Rt(16777215),this.specular=new Rt(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Rt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Rf,this.normalScale=new ut(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Fo,this.combine=jb,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class cse extends ha{constructor(t){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Rt(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Rt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Rf,this.normalScale=new ut(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}class use extends ha{constructor(t){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Rf,this.normalScale=new ut(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.flatShading=t.flatShading,this}}class hse extends ha{constructor(t){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Rt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Rt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Rf,this.normalScale=new ut(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Fo,this.combine=jb,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class PP extends ha{constructor(t){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=Ene,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(t)}copy(t){return super.copy(t),this.depthPacking=t.depthPacking,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}}class DP extends ha{constructor(t){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(t)}copy(t){return super.copy(t),this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this}}class dse extends ha{constructor(t){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Rt(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Rf,this.normalScale=new ut(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.flatShading=t.flatShading,this.fog=t.fog,this}}class fse extends ka{constructor(t){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}copy(t){return super.copy(t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this}}function em(e,t,i){return!e||!i&&e.constructor===t?e:typeof t.BYTES_PER_ELEMENT=="number"?new t(e):Array.prototype.slice.call(e)}function pse(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function mse(e){function t(n,s){return e[n]-e[s]}const i=e.length,r=new Array(i);for(let n=0;n!==i;++n)r[n]=n;return r.sort(t),r}function rF(e,t,i){const r=e.length,n=new e.constructor(r);for(let s=0,a=0;a!==r;++s){const o=i[s]*t;for(let l=0;l!==t;++l)n[a++]=e[o+l]}return n}function hk(e,t,i,r){let n=1,s=e[0];for(;s!==void 0&&s[r]===void 0;)s=e[n++];if(s===void 0)return;let a=s[r];if(a!==void 0)if(Array.isArray(a))do a=s[r],a!==void 0&&(t.push(s.time),i.push(...a)),s=e[n++];while(s!==void 0);else if(a.toArray!==void 0)do a=s[r],a!==void 0&&(t.push(s.time),a.toArray(i,i.length)),s=e[n++];while(s!==void 0);else do a=s[r],a!==void 0&&(t.push(s.time),i.push(a)),s=e[n++];while(s!==void 0)}function _He(e,t,i,r,n=30){const s=e.clone();s.name=t;const a=[];for(let l=0;l<s.tracks.length;++l){const c=s.tracks[l],u=c.getValueSize(),h=[],d=[];for(let f=0;f<c.times.length;++f){const p=c.times[f]*n;if(!(p<i||p>=r)){h.push(c.times[f]);for(let v=0;v<u;++v)d.push(c.values[f*u+v])}}h.length!==0&&(c.times=em(h,c.times.constructor),c.values=em(d,c.values.constructor),a.push(c))}s.tracks=a;let o=1/0;for(let l=0;l<s.tracks.length;++l)o>s.tracks[l].times[0]&&(o=s.tracks[l].times[0]);for(let l=0;l<s.tracks.length;++l)s.tracks[l].shift(-1*o);return s.resetDuration(),s}function SHe(e,t=0,i=e,r=30){r<=0&&(r=30);const n=i.tracks.length,s=t/r;for(let a=0;a<n;++a){const o=i.tracks[a],l=o.ValueTypeName;if(l==="bool"||l==="string")continue;const c=e.tracks.find(function(g){return g.name===o.name&&g.ValueTypeName===l});if(c===void 0)continue;let u=0;const h=o.getValueSize();o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(u=h/3);let d=0;const f=c.getValueSize();c.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(d=f/3);const p=o.times.length-1;let v;if(s<=o.times[0]){const g=u,y=h-u;v=o.values.slice(g,y)}else if(s>=o.times[p]){const g=p*h+u,y=g+h-u;v=o.values.slice(g,y)}else{const g=o.createInterpolant(),y=u,x=h-u;g.evaluate(s),v=g.resultBuffer.slice(y,x)}l==="quaternion"&&new oa().fromArray(v).normalize().conjugate().toArray(v);const m=c.times.length;for(let g=0;g<m;++g){const y=g*f+d;if(l==="quaternion")oa.multiplyQuaternionsFlat(c.values,y,v,0,c.values,y);else{const x=f-d*2;for(let _=0;_<x;++_)c.values[y+_]-=v[_]}}}return e.blendMode=W4,e}const MHe={convertArray:em,isTypedArray:pse,getKeyframeOrder:mse,sortedArray:rF,flattenJSON:hk,subclip:_He,makeClipAdditive:SHe};class $b{constructor(t,i,r,n){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=n!==void 0?n:new i.constructor(r),this.sampleValues=i,this.valueSize=r,this.settings=null,this.DefaultSettings_={}}evaluate(t){const i=this.parameterPositions;let r=this._cachedIndex,n=i[r],s=i[r-1];e:{t:{let a;i:{r:if(!(t<n)){for(let o=r+2;;){if(n===void 0){if(t<s)break r;return r=i.length,this._cachedIndex=r,this.copySampleValue_(r-1)}if(r===o)break;if(s=n,n=i[++r],t<n)break t}a=i.length;break i}if(!(t>=s)){const o=i[1];t<o&&(r=2,s=o);for(let l=r-2;;){if(s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(r===l)break;if(n=s,s=i[--r-1],t>=s)break t}a=r,r=0;break i}break e}for(;r<a;){const o=r+a>>>1;t<i[o]?a=o:r=o+1}if(n=i[r],s=i[r-1],s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(n===void 0)return r=i.length,this._cachedIndex=r,this.copySampleValue_(r-1)}this._cachedIndex=r,this.intervalChanged_(r,s,n)}return this.interpolate_(r,s,t,n)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(t){const i=this.resultBuffer,r=this.sampleValues,n=this.valueSize,s=t*n;for(let a=0;a!==n;++a)i[a]=r[s+a];return i}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class gse extends $b{constructor(t,i,r,n){super(t,i,r,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Jp,endingEnd:Jp}}intervalChanged_(t,i,r){const n=this.parameterPositions;let s=t-2,a=t+1,o=n[s],l=n[a];if(o===void 0)switch(this.getSettings_().endingStart){case $p:s=t,o=2*i-r;break;case rb:s=n.length-2,o=i+n[s]-n[s+1];break;default:s=t,o=r}if(l===void 0)switch(this.getSettings_().endingEnd){case $p:a=t,l=2*r-i;break;case rb:a=1,l=r+n[1]-n[0];break;default:a=t-1,l=i}const c=(r-i)*.5,u=this.valueSize;this._weightPrev=c/(i-o),this._weightNext=c/(l-r),this._offsetPrev=s*u,this._offsetNext=a*u}interpolate_(t,i,r,n){const s=this.resultBuffer,a=this.sampleValues,o=this.valueSize,l=t*o,c=l-o,u=this._offsetPrev,h=this._offsetNext,d=this._weightPrev,f=this._weightNext,p=(r-i)/(n-i),v=p*p,m=v*p,g=-d*m+2*d*v-d*p,y=(1+d)*m+(-1.5-2*d)*v+(-.5+d)*p+1,x=(-1-f)*m+(1.5+f)*v+.5*p,_=f*m-f*v;for(let M=0;M!==o;++M)s[M]=g*a[u+M]+y*a[c+M]+x*a[l+M]+_*a[h+M];return s}}class dk extends $b{constructor(t,i,r,n){super(t,i,r,n)}interpolate_(t,i,r,n){const s=this.resultBuffer,a=this.sampleValues,o=this.valueSize,l=t*o,c=l-o,u=(r-i)/(n-i),h=1-u;for(let d=0;d!==o;++d)s[d]=a[c+d]*h+a[l+d]*u;return s}}class vse extends $b{constructor(t,i,r,n){super(t,i,r,n)}interpolate_(t){return this.copySampleValue_(t-1)}}class fc{constructor(t,i,r,n){if(t===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(i===void 0||i.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=em(i,this.TimeBufferType),this.values=em(r,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation)}static toJSON(t){const i=t.constructor;let r;if(i.toJSON!==this.toJSON)r=i.toJSON(t);else{r={name:t.name,times:em(t.times,Array),values:em(t.values,Array)};const n=t.getInterpolation();n!==t.DefaultInterpolation&&(r.interpolation=n)}return r.type=t.ValueTypeName,r}InterpolantFactoryMethodDiscrete(t){return new vse(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodLinear(t){return new dk(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodSmooth(t){return new gse(this.times,this.values,this.getValueSize(),t)}setInterpolation(t){let i;switch(t){case ib:i=this.InterpolantFactoryMethodDiscrete;break;case QT:i=this.InterpolantFactoryMethodLinear;break;case g2:i=this.InterpolantFactoryMethodSmooth;break}if(i===void 0){const r="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(t!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(r);return console.warn("THREE.KeyframeTrack:",r),this}return this.createInterpolant=i,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return ib;case this.InterpolantFactoryMethodLinear:return QT;case this.InterpolantFactoryMethodSmooth:return g2}}getValueSize(){return this.values.length/this.times.length}shift(t){if(t!==0){const i=this.times;for(let r=0,n=i.length;r!==n;++r)i[r]+=t}return this}scale(t){if(t!==1){const i=this.times;for(let r=0,n=i.length;r!==n;++r)i[r]*=t}return this}trim(t,i){const r=this.times,n=r.length;let s=0,a=n-1;for(;s!==n&&r[s]<t;)++s;for(;a!==-1&&r[a]>i;)--a;if(++a,s!==0||a!==n){s>=a&&(a=Math.max(a,1),s=a-1);const o=this.getValueSize();this.times=r.slice(s,a),this.values=this.values.slice(s*o,a*o)}return this}validate(){let t=!0;const i=this.getValueSize();i-Math.floor(i)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);const r=this.times,n=this.values,s=r.length;s===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let a=null;for(let o=0;o!==s;o++){const l=r[o];if(typeof l=="number"&&isNaN(l)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,o,l),t=!1;break}if(a!==null&&a>l){console.error("THREE.KeyframeTrack: Out of order keys.",this,o,l,a),t=!1;break}a=l}if(n!==void 0&&pse(n))for(let o=0,l=n.length;o!==l;++o){const c=n[o];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,o,c),t=!1;break}}return t}optimize(){const t=this.times.slice(),i=this.values.slice(),r=this.getValueSize(),n=this.getInterpolation()===g2,s=t.length-1;let a=1;for(let o=1;o<s;++o){let l=!1;const c=t[o],u=t[o+1];if(c!==u&&(o!==1||c!==t[0]))if(n)l=!0;else{const h=o*r,d=h-r,f=h+r;for(let p=0;p!==r;++p){const v=i[h+p];if(v!==i[d+p]||v!==i[f+p]){l=!0;break}}}if(l){if(o!==a){t[a]=t[o];const h=o*r,d=a*r;for(let f=0;f!==r;++f)i[d+f]=i[h+f]}++a}}if(s>0){t[a]=t[s];for(let o=s*r,l=a*r,c=0;c!==r;++c)i[l+c]=i[o+c];++a}return a!==t.length?(this.times=t.slice(0,a),this.values=i.slice(0,a*r)):(this.times=t,this.values=i),this}clone(){const t=this.times.slice(),i=this.values.slice(),r=this.constructor,n=new r(this.name,t,i);return n.createInterpolant=this.createInterpolant,n}}fc.prototype.TimeBufferType=Float32Array;fc.prototype.ValueBufferType=Float32Array;fc.prototype.DefaultInterpolation=QT;class Jm extends fc{constructor(t,i,r){super(t,i,r)}}Jm.prototype.ValueTypeName="bool";Jm.prototype.ValueBufferType=Array;Jm.prototype.DefaultInterpolation=ib;Jm.prototype.InterpolantFactoryMethodLinear=void 0;Jm.prototype.InterpolantFactoryMethodSmooth=void 0;class fk extends fc{}fk.prototype.ValueTypeName="color";class db extends fc{}db.prototype.ValueTypeName="number";class yse extends $b{constructor(t,i,r,n){super(t,i,r,n)}interpolate_(t,i,r,n){const s=this.resultBuffer,a=this.sampleValues,o=this.valueSize,l=(r-i)/(n-i);let c=t*o;for(let u=c+o;c!==u;c+=4)oa.slerpFlat(s,0,a,c-o,a,c,l);return s}}class e_ extends fc{InterpolantFactoryMethodLinear(t){return new yse(this.times,this.values,this.getValueSize(),t)}}e_.prototype.ValueTypeName="quaternion";e_.prototype.InterpolantFactoryMethodSmooth=void 0;class $m extends fc{constructor(t,i,r){super(t,i,r)}}$m.prototype.ValueTypeName="string";$m.prototype.ValueBufferType=Array;$m.prototype.DefaultInterpolation=ib;$m.prototype.InterpolantFactoryMethodLinear=void 0;$m.prototype.InterpolantFactoryMethodSmooth=void 0;class fb extends fc{}fb.prototype.ValueTypeName="vector";class pb{constructor(t="",i=-1,r=[],n=oP){this.name=t,this.tracks=r,this.duration=i,this.blendMode=n,this.uuid=Lo(),this.duration<0&&this.resetDuration()}static parse(t){const i=[],r=t.tracks,n=1/(t.fps||1);for(let a=0,o=r.length;a!==o;++a)i.push(AHe(r[a]).scale(n));const s=new this(t.name,t.duration,i,t.blendMode);return s.uuid=t.uuid,s}static toJSON(t){const i=[],r=t.tracks,n={name:t.name,duration:t.duration,tracks:i,uuid:t.uuid,blendMode:t.blendMode};for(let s=0,a=r.length;s!==a;++s)i.push(fc.toJSON(r[s]));return n}static CreateFromMorphTargetSequence(t,i,r,n){const s=i.length,a=[];for(let o=0;o<s;o++){let l=[],c=[];l.push((o+s-1)%s,o,(o+1)%s),c.push(0,1,0);const u=mse(l);l=rF(l,1,u),c=rF(c,1,u),!n&&l[0]===0&&(l.push(s),c.push(c[0])),a.push(new db(".morphTargetInfluences["+i[o].name+"]",l,c).scale(1/r))}return new this(t,-1,a)}static findByName(t,i){let r=t;if(!Array.isArray(t)){const n=t;r=n.geometry&&n.geometry.animations||n.animations}for(let n=0;n<r.length;n++)if(r[n].name===i)return r[n];return null}static CreateClipsFromMorphTargetSequences(t,i,r){const n={},s=/^([\w-]*?)([\d]+)$/;for(let o=0,l=t.length;o<l;o++){const c=t[o],u=c.name.match(s);if(u&&u.length>1){const h=u[1];let d=n[h];d||(n[h]=d=[]),d.push(c)}}const a=[];for(const o in n)a.push(this.CreateFromMorphTargetSequence(o,n[o],i,r));return a}static parseAnimation(t,i){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const r=function(h,d,f,p,v){if(f.length!==0){const m=[],g=[];hk(f,m,g,p),m.length!==0&&v.push(new h(d,m,g))}},n=[],s=t.name||"default",a=t.fps||30,o=t.blendMode;let l=t.length||-1;const c=t.hierarchy||[];for(let h=0;h<c.length;h++){const d=c[h].keys;if(!(!d||d.length===0))if(d[0].morphTargets){const f={};let p;for(p=0;p<d.length;p++)if(d[p].morphTargets)for(let v=0;v<d[p].morphTargets.length;v++)f[d[p].morphTargets[v]]=-1;for(const v in f){const m=[],g=[];for(let y=0;y!==d[p].morphTargets.length;++y){const x=d[p];m.push(x.time),g.push(x.morphTarget===v?1:0)}n.push(new db(".morphTargetInfluence["+v+"]",m,g))}l=f.length*a}else{const f=".bones["+i[h].name+"]";r(fb,f+".position",d,"pos",n),r(e_,f+".quaternion",d,"rot",n),r(fb,f+".scale",d,"scl",n)}}return n.length===0?null:new this(s,l,n,o)}resetDuration(){const t=this.tracks;let i=0;for(let r=0,n=t.length;r!==n;++r){const s=this.tracks[r];i=Math.max(i,s.times[s.times.length-1])}return this.duration=i,this}trim(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this}validate(){let t=!0;for(let i=0;i<this.tracks.length;i++)t=t&&this.tracks[i].validate();return t}optimize(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}clone(){const t=[];for(let i=0;i<this.tracks.length;i++)t.push(this.tracks[i].clone());return new this.constructor(this.name,this.duration,t,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function EHe(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return db;case"vector":case"vector2":case"vector3":case"vector4":return fb;case"color":return fk;case"quaternion":return e_;case"bool":case"boolean":return Jm;case"string":return $m}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}function AHe(e){if(e.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=EHe(e.type);if(e.times===void 0){const i=[],r=[];hk(e.keys,i,r,"value"),e.times=i,e.values=r}return t.parse!==void 0?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}const ph={enabled:!1,files:{},add:function(e,t){this.enabled!==!1&&(this.files[e]=t)},get:function(e){if(this.enabled!==!1)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};class pk{constructor(t,i,r){const n=this;let s=!1,a=0,o=0,l;const c=[];this.onStart=void 0,this.onLoad=t,this.onProgress=i,this.onError=r,this.itemStart=function(u){o++,s===!1&&n.onStart!==void 0&&n.onStart(u,a,o),s=!0},this.itemEnd=function(u){a++,n.onProgress!==void 0&&n.onProgress(u,a,o),a===o&&(s=!1,n.onLoad!==void 0&&n.onLoad())},this.itemError=function(u){n.onError!==void 0&&n.onError(u)},this.resolveURL=function(u){return l?l(u):u},this.setURLModifier=function(u){return l=u,this},this.addHandler=function(u,h){return c.push(u,h),this},this.removeHandler=function(u){const h=c.indexOf(u);return h!==-1&&c.splice(h,2),this},this.getHandler=function(u){for(let h=0,d=c.length;h<d;h+=2){const f=c[h],p=c[h+1];if(f.global&&(f.lastIndex=0),f.test(u))return p}return null}}}const xse=new pk;class fo{constructor(t){this.manager=t!==void 0?t:xse,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,i){const r=this;return new Promise(function(n,s){r.load(t,n,i,s)})}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}}fo.DEFAULT_MATERIAL_NAME="__DEFAULT";const ku={};class THe extends Error{constructor(t,i){super(t),this.response=i}}class Bh extends fo{constructor(t){super(t)}load(t,i,r,n){t===void 0&&(t=""),this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);const s=ph.get(t);if(s!==void 0)return this.manager.itemStart(t),setTimeout(()=>{i&&i(s),this.manager.itemEnd(t)},0),s;if(ku[t]!==void 0){ku[t].push({onLoad:i,onProgress:r,onError:n});return}ku[t]=[],ku[t].push({onLoad:i,onProgress:r,onError:n});const a=new Request(t,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),o=this.mimeType,l=this.responseType;fetch(a).then(c=>{if(c.status===200||c.status===0){if(c.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||c.body===void 0||c.body.getReader===void 0)return c;const u=ku[t],h=c.body.getReader(),d=c.headers.get("X-File-Size")||c.headers.get("Content-Length"),f=d?parseInt(d):0,p=f!==0;let v=0;const m=new ReadableStream({start(g){y();function y(){h.read().then(({done:x,value:_})=>{if(x)g.close();else{v+=_.byteLength;const M=new ProgressEvent("progress",{lengthComputable:p,loaded:v,total:f});for(let S=0,T=u.length;S<T;S++){const E=u[S];E.onProgress&&E.onProgress(M)}g.enqueue(_),y()}},x=>{g.error(x)})}}});return new Response(m)}else throw new THe(`fetch for "${c.url}" responded with ${c.status}: ${c.statusText}`,c)}).then(c=>{switch(l){case"arraybuffer":return c.arrayBuffer();case"blob":return c.blob();case"document":return c.text().then(u=>new DOMParser().parseFromString(u,o));case"json":return c.json();default:if(o===void 0)return c.text();{const h=/charset="?([^;"\s]*)"?/i.exec(o),d=h&&h[1]?h[1].toLowerCase():void 0,f=new TextDecoder(d);return c.arrayBuffer().then(p=>f.decode(p))}}}).then(c=>{ph.add(t,c);const u=ku[t];delete ku[t];for(let h=0,d=u.length;h<d;h++){const f=u[h];f.onLoad&&f.onLoad(c)}}).catch(c=>{const u=ku[t];if(u===void 0)throw this.manager.itemError(t),c;delete ku[t];for(let h=0,d=u.length;h<d;h++){const f=u[h];f.onError&&f.onError(c)}this.manager.itemError(t)}).finally(()=>{this.manager.itemEnd(t)}),this.manager.itemStart(t)}setResponseType(t){return this.responseType=t,this}setMimeType(t){return this.mimeType=t,this}}class CHe extends fo{constructor(t){super(t)}load(t,i,r,n){const s=this,a=new Bh(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(t,function(o){try{i(s.parse(JSON.parse(o)))}catch(l){n?n(l):console.error(l),s.manager.itemError(t)}},r,n)}parse(t){const i=[];for(let r=0;r<t.length;r++){const n=pb.parse(t[r]);i.push(n)}return i}}class PHe extends fo{constructor(t){super(t)}load(t,i,r,n){const s=this,a=[],o=new pP,l=new Bh(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(s.withCredentials);let c=0;function u(h){l.load(t[h],function(d){const f=s.parse(d,!0);a[h]={width:f.width,height:f.height,format:f.format,mipmaps:f.mipmaps},c+=1,c===6&&(f.mipmapCount===1&&(o.minFilter=pn),o.image=a,o.format=f.format,o.needsUpdate=!0,i&&i(o))},r,n)}if(Array.isArray(t))for(let h=0,d=t.length;h<d;++h)u(h);else l.load(t,function(h){const d=s.parse(h,!0);if(d.isCubemap){const f=d.mipmaps.length/d.mipmapCount;for(let p=0;p<f;p++){a[p]={mipmaps:[]};for(let v=0;v<d.mipmapCount;v++)a[p].mipmaps.push(d.mipmaps[p*d.mipmapCount+v]),a[p].format=d.format,a[p].width=d.width,a[p].height=d.height}o.image=a}else o.image.width=d.width,o.image.height=d.height,o.mipmaps=d.mipmaps;d.mipmapCount===1&&(o.minFilter=pn),o.format=d.format,o.needsUpdate=!0,i&&i(o)},r,n);return o}}class mb extends fo{constructor(t){super(t)}load(t,i,r,n){this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);const s=this,a=ph.get(t);if(a!==void 0)return s.manager.itemStart(t),setTimeout(function(){i&&i(a),s.manager.itemEnd(t)},0),a;const o=ob("img");function l(){u(),ph.add(t,this),i&&i(this),s.manager.itemEnd(t)}function c(h){u(),n&&n(h),s.manager.itemError(t),s.manager.itemEnd(t)}function u(){o.removeEventListener("load",l,!1),o.removeEventListener("error",c,!1)}return o.addEventListener("load",l,!1),o.addEventListener("error",c,!1),t.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(o.crossOrigin=this.crossOrigin),s.manager.itemStart(t),o.src=t,o}}class DHe extends fo{constructor(t){super(t)}load(t,i,r,n){const s=new Yb;s.colorSpace=Qa;const a=new mb(this.manager);a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);let o=0;function l(c){a.load(t[c],function(u){s.images[c]=u,o++,o===6&&(s.needsUpdate=!0,i&&i(s))},void 0,n)}for(let c=0;c<t.length;++c)l(c);return s}}class RHe extends fo{constructor(t){super(t)}load(t,i,r,n){const s=this,a=new nu,o=new Bh(this.manager);return o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setPath(this.path),o.setWithCredentials(s.withCredentials),o.load(t,function(l){let c;try{c=s.parse(l)}catch(u){if(n!==void 0)n(u);else{console.error(u);return}}c.image!==void 0?a.image=c.image:c.data!==void 0&&(a.image.width=c.width,a.image.height=c.height,a.image.data=c.data),a.wrapS=c.wrapS!==void 0?c.wrapS:pl,a.wrapT=c.wrapT!==void 0?c.wrapT:pl,a.magFilter=c.magFilter!==void 0?c.magFilter:pn,a.minFilter=c.minFilter!==void 0?c.minFilter:pn,a.anisotropy=c.anisotropy!==void 0?c.anisotropy:1,c.colorSpace!==void 0&&(a.colorSpace=c.colorSpace),c.flipY!==void 0&&(a.flipY=c.flipY),c.format!==void 0&&(a.format=c.format),c.type!==void 0&&(a.type=c.type),c.mipmaps!==void 0&&(a.mipmaps=c.mipmaps,a.minFilter=qc),c.mipmapCount===1&&(a.minFilter=pn),c.generateMipmaps!==void 0&&(a.generateMipmaps=c.generateMipmaps),a.needsUpdate=!0,i&&i(a,c)},r,n),a}}class IHe extends fo{constructor(t){super(t)}load(t,i,r,n){const s=new Wr,a=new mb(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(t,function(o){s.image=o,s.needsUpdate=!0,i!==void 0&&i(s)},r,n),s}}class Lf extends Qi{constructor(t,i=1){super(),this.isLight=!0,this.type="Light",this.color=new Rt(t),this.intensity=i}dispose(){}copy(t,i){return super.copy(t,i),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){const i=super.toJSON(t);return i.object.color=this.color.getHex(),i.object.intensity=this.intensity,this.groundColor!==void 0&&(i.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(i.object.distance=this.distance),this.angle!==void 0&&(i.object.angle=this.angle),this.decay!==void 0&&(i.object.decay=this.decay),this.penumbra!==void 0&&(i.object.penumbra=this.penumbra),this.shadow!==void 0&&(i.object.shadow=this.shadow.toJSON()),this.target!==void 0&&(i.object.target=this.target.uuid),i}}class wse extends Lf{constructor(t,i,r){super(t,r),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Qi.DEFAULT_UP),this.updateMatrix(),this.groundColor=new Rt(i)}copy(t,i){return super.copy(t,i),this.groundColor.copy(t.groundColor),this}}const nL=new ci,QX=new he,ZX=new he;class mk{constructor(t){this.camera=t,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new ut(512,512),this.map=null,this.mapPass=null,this.matrix=new ci,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Qb,this._frameExtents=new ut(1,1),this._viewportCount=1,this._viewports=[new Hi(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){const i=this.camera,r=this.matrix;QX.setFromMatrixPosition(t.matrixWorld),i.position.copy(QX),ZX.setFromMatrixPosition(t.target.matrixWorld),i.lookAt(ZX),i.updateMatrixWorld(),nL.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(nL),r.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),r.multiply(nL)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.intensity=t.intensity,this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const t={};return this.intensity!==1&&(t.intensity=this.intensity),this.bias!==0&&(t.bias=this.bias),this.normalBias!==0&&(t.normalBias=this.normalBias),this.radius!==1&&(t.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}class LHe extends mk{constructor(){super(new fn(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(t){const i=this.camera,r=Y0*2*t.angle*this.focus,n=this.mapSize.width/this.mapSize.height,s=t.distance||i.far;(r!==i.fov||n!==i.aspect||s!==i.far)&&(i.fov=r,i.aspect=n,i.far=s,i.updateProjectionMatrix()),super.updateMatrices(t)}copy(t){return super.copy(t),this.focus=t.focus,this}}class bse extends Lf{constructor(t,i,r=0,n=Math.PI/3,s=0,a=2){super(t,i),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Qi.DEFAULT_UP),this.updateMatrix(),this.target=new Qi,this.distance=r,this.angle=n,this.penumbra=s,this.decay=a,this.map=null,this.shadow=new LHe}get power(){return this.intensity*Math.PI}set power(t){this.intensity=t/Math.PI}dispose(){this.shadow.dispose()}copy(t,i){return super.copy(t,i),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}const KX=new ci,X1=new he,sL=new he;class OHe extends mk{constructor(){super(new fn(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new ut(4,2),this._viewportCount=6,this._viewports=[new Hi(2,1,1,1),new Hi(0,1,1,1),new Hi(3,1,1,1),new Hi(1,1,1,1),new Hi(3,0,1,1),new Hi(1,0,1,1)],this._cubeDirections=[new he(1,0,0),new he(-1,0,0),new he(0,0,1),new he(0,0,-1),new he(0,1,0),new he(0,-1,0)],this._cubeUps=[new he(0,1,0),new he(0,1,0),new he(0,1,0),new he(0,1,0),new he(0,0,1),new he(0,0,-1)]}updateMatrices(t,i=0){const r=this.camera,n=this.matrix,s=t.distance||r.far;s!==r.far&&(r.far=s,r.updateProjectionMatrix()),X1.setFromMatrixPosition(t.matrixWorld),r.position.copy(X1),sL.copy(r.position),sL.add(this._cubeDirections[i]),r.up.copy(this._cubeUps[i]),r.lookAt(sL),r.updateMatrixWorld(),n.makeTranslation(-X1.x,-X1.y,-X1.z),KX.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),this._frustum.setFromProjectionMatrix(KX)}}class _se extends Lf{constructor(t,i,r=0,n=2){super(t,i),this.isPointLight=!0,this.type="PointLight",this.distance=r,this.decay=n,this.shadow=new OHe}get power(){return this.intensity*4*Math.PI}set power(t){this.intensity=t/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(t,i){return super.copy(t,i),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}class hf extends qb{constructor(t=-1,i=1,r=1,n=-1,s=.1,a=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=i,this.top=r,this.bottom=n,this.near=s,this.far=a,this.updateProjectionMatrix()}copy(t,i){return super.copy(t,i),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=t.view===null?null:Object.assign({},t.view),this}setViewOffset(t,i,r,n,s,a){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=i,this.view.offsetX=r,this.view.offsetY=n,this.view.width=s,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=(this.right-this.left)/(2*this.zoom),i=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,n=(this.top+this.bottom)/2;let s=r-t,a=r+t,o=n+i,l=n-i;if(this.view!==null&&this.view.enabled){const c=(this.right-this.left)/this.view.fullWidth/this.zoom,u=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=c*this.view.offsetX,a=s+c*this.view.width,o-=u*this.view.offsetY,l=o-u*this.view.height}this.projectionMatrix.makeOrthographic(s,a,o,l,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const i=super.toJSON(t);return i.object.zoom=this.zoom,i.object.left=this.left,i.object.right=this.right,i.object.top=this.top,i.object.bottom=this.bottom,i.object.near=this.near,i.object.far=this.far,this.view!==null&&(i.object.view=Object.assign({},this.view)),i}}class zHe extends mk{constructor(){super(new hf(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class Sse extends Lf{constructor(t,i){super(t,i),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Qi.DEFAULT_UP),this.updateMatrix(),this.target=new Qi,this.shadow=new zHe}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}class Mse extends Lf{constructor(t,i){super(t,i),this.isAmbientLight=!0,this.type="AmbientLight"}}class Ese extends Lf{constructor(t,i,r=10,n=10){super(t,i),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=r,this.height=n}get power(){return this.intensity*this.width*this.height*Math.PI}set power(t){this.intensity=t/(this.width*this.height*Math.PI)}copy(t){return super.copy(t),this.width=t.width,this.height=t.height,this}toJSON(t){const i=super.toJSON(t);return i.object.width=this.width,i.object.height=this.height,i}}class Ase{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let t=0;t<9;t++)this.coefficients.push(new he)}set(t){for(let i=0;i<9;i++)this.coefficients[i].copy(t[i]);return this}zero(){for(let t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this}getAt(t,i){const r=t.x,n=t.y,s=t.z,a=this.coefficients;return i.copy(a[0]).multiplyScalar(.282095),i.addScaledVector(a[1],.488603*n),i.addScaledVector(a[2],.488603*s),i.addScaledVector(a[3],.488603*r),i.addScaledVector(a[4],1.092548*(r*n)),i.addScaledVector(a[5],1.092548*(n*s)),i.addScaledVector(a[6],.315392*(3*s*s-1)),i.addScaledVector(a[7],1.092548*(r*s)),i.addScaledVector(a[8],.546274*(r*r-n*n)),i}getIrradianceAt(t,i){const r=t.x,n=t.y,s=t.z,a=this.coefficients;return i.copy(a[0]).multiplyScalar(.886227),i.addScaledVector(a[1],2*.511664*n),i.addScaledVector(a[2],2*.511664*s),i.addScaledVector(a[3],2*.511664*r),i.addScaledVector(a[4],2*.429043*r*n),i.addScaledVector(a[5],2*.429043*n*s),i.addScaledVector(a[6],.743125*s*s-.247708),i.addScaledVector(a[7],2*.429043*r*s),i.addScaledVector(a[8],.429043*(r*r-n*n)),i}add(t){for(let i=0;i<9;i++)this.coefficients[i].add(t.coefficients[i]);return this}addScaledSH(t,i){for(let r=0;r<9;r++)this.coefficients[r].addScaledVector(t.coefficients[r],i);return this}scale(t){for(let i=0;i<9;i++)this.coefficients[i].multiplyScalar(t);return this}lerp(t,i){for(let r=0;r<9;r++)this.coefficients[r].lerp(t.coefficients[r],i);return this}equals(t){for(let i=0;i<9;i++)if(!this.coefficients[i].equals(t.coefficients[i]))return!1;return!0}copy(t){return this.set(t.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(t,i=0){const r=this.coefficients;for(let n=0;n<9;n++)r[n].fromArray(t,i+n*3);return this}toArray(t=[],i=0){const r=this.coefficients;for(let n=0;n<9;n++)r[n].toArray(t,i+n*3);return t}static getBasisAt(t,i){const r=t.x,n=t.y,s=t.z;i[0]=.282095,i[1]=.488603*n,i[2]=.488603*s,i[3]=.488603*r,i[4]=1.092548*r*n,i[5]=1.092548*n*s,i[6]=.315392*(3*s*s-1),i[7]=1.092548*r*s,i[8]=.546274*(r*r-n*n)}}class Tse extends Lf{constructor(t=new Ase,i=1){super(void 0,i),this.isLightProbe=!0,this.sh=t}copy(t){return super.copy(t),this.sh.copy(t.sh),this}fromJSON(t){return this.intensity=t.intensity,this.sh.fromArray(t.sh),this}toJSON(t){const i=super.toJSON(t);return i.object.sh=this.sh.toArray(),i}}class RP extends fo{constructor(t){super(t),this.textures={}}load(t,i,r,n){const s=this,a=new Bh(s.manager);a.setPath(s.path),a.setRequestHeader(s.requestHeader),a.setWithCredentials(s.withCredentials),a.load(t,function(o){try{i(s.parse(JSON.parse(o)))}catch(l){n?n(l):console.error(l),s.manager.itemError(t)}},r,n)}parse(t){const i=this.textures;function r(s){return i[s]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",s),i[s]}const n=this.createMaterialFromType(t.type);if(t.uuid!==void 0&&(n.uuid=t.uuid),t.name!==void 0&&(n.name=t.name),t.color!==void 0&&n.color!==void 0&&n.color.setHex(t.color),t.roughness!==void 0&&(n.roughness=t.roughness),t.metalness!==void 0&&(n.metalness=t.metalness),t.sheen!==void 0&&(n.sheen=t.sheen),t.sheenColor!==void 0&&(n.sheenColor=new Rt().setHex(t.sheenColor)),t.sheenRoughness!==void 0&&(n.sheenRoughness=t.sheenRoughness),t.emissive!==void 0&&n.emissive!==void 0&&n.emissive.setHex(t.emissive),t.specular!==void 0&&n.specular!==void 0&&n.specular.setHex(t.specular),t.specularIntensity!==void 0&&(n.specularIntensity=t.specularIntensity),t.specularColor!==void 0&&n.specularColor!==void 0&&n.specularColor.setHex(t.specularColor),t.shininess!==void 0&&(n.shininess=t.shininess),t.clearcoat!==void 0&&(n.clearcoat=t.clearcoat),t.clearcoatRoughness!==void 0&&(n.clearcoatRoughness=t.clearcoatRoughness),t.dispersion!==void 0&&(n.dispersion=t.dispersion),t.iridescence!==void 0&&(n.iridescence=t.iridescence),t.iridescenceIOR!==void 0&&(n.iridescenceIOR=t.iridescenceIOR),t.iridescenceThicknessRange!==void 0&&(n.iridescenceThicknessRange=t.iridescenceThicknessRange),t.transmission!==void 0&&(n.transmission=t.transmission),t.thickness!==void 0&&(n.thickness=t.thickness),t.attenuationDistance!==void 0&&(n.attenuationDistance=t.attenuationDistance),t.attenuationColor!==void 0&&n.attenuationColor!==void 0&&n.attenuationColor.setHex(t.attenuationColor),t.anisotropy!==void 0&&(n.anisotropy=t.anisotropy),t.anisotropyRotation!==void 0&&(n.anisotropyRotation=t.anisotropyRotation),t.fog!==void 0&&(n.fog=t.fog),t.flatShading!==void 0&&(n.flatShading=t.flatShading),t.blending!==void 0&&(n.blending=t.blending),t.combine!==void 0&&(n.combine=t.combine),t.side!==void 0&&(n.side=t.side),t.shadowSide!==void 0&&(n.shadowSide=t.shadowSide),t.opacity!==void 0&&(n.opacity=t.opacity),t.transparent!==void 0&&(n.transparent=t.transparent),t.alphaTest!==void 0&&(n.alphaTest=t.alphaTest),t.alphaHash!==void 0&&(n.alphaHash=t.alphaHash),t.depthFunc!==void 0&&(n.depthFunc=t.depthFunc),t.depthTest!==void 0&&(n.depthTest=t.depthTest),t.depthWrite!==void 0&&(n.depthWrite=t.depthWrite),t.colorWrite!==void 0&&(n.colorWrite=t.colorWrite),t.blendSrc!==void 0&&(n.blendSrc=t.blendSrc),t.blendDst!==void 0&&(n.blendDst=t.blendDst),t.blendEquation!==void 0&&(n.blendEquation=t.blendEquation),t.blendSrcAlpha!==void 0&&(n.blendSrcAlpha=t.blendSrcAlpha),t.blendDstAlpha!==void 0&&(n.blendDstAlpha=t.blendDstAlpha),t.blendEquationAlpha!==void 0&&(n.blendEquationAlpha=t.blendEquationAlpha),t.blendColor!==void 0&&n.blendColor!==void 0&&n.blendColor.setHex(t.blendColor),t.blendAlpha!==void 0&&(n.blendAlpha=t.blendAlpha),t.stencilWriteMask!==void 0&&(n.stencilWriteMask=t.stencilWriteMask),t.stencilFunc!==void 0&&(n.stencilFunc=t.stencilFunc),t.stencilRef!==void 0&&(n.stencilRef=t.stencilRef),t.stencilFuncMask!==void 0&&(n.stencilFuncMask=t.stencilFuncMask),t.stencilFail!==void 0&&(n.stencilFail=t.stencilFail),t.stencilZFail!==void 0&&(n.stencilZFail=t.stencilZFail),t.stencilZPass!==void 0&&(n.stencilZPass=t.stencilZPass),t.stencilWrite!==void 0&&(n.stencilWrite=t.stencilWrite),t.wireframe!==void 0&&(n.wireframe=t.wireframe),t.wireframeLinewidth!==void 0&&(n.wireframeLinewidth=t.wireframeLinewidth),t.wireframeLinecap!==void 0&&(n.wireframeLinecap=t.wireframeLinecap),t.wireframeLinejoin!==void 0&&(n.wireframeLinejoin=t.wireframeLinejoin),t.rotation!==void 0&&(n.rotation=t.rotation),t.linewidth!==void 0&&(n.linewidth=t.linewidth),t.dashSize!==void 0&&(n.dashSize=t.dashSize),t.gapSize!==void 0&&(n.gapSize=t.gapSize),t.scale!==void 0&&(n.scale=t.scale),t.polygonOffset!==void 0&&(n.polygonOffset=t.polygonOffset),t.polygonOffsetFactor!==void 0&&(n.polygonOffsetFactor=t.polygonOffsetFactor),t.polygonOffsetUnits!==void 0&&(n.polygonOffsetUnits=t.polygonOffsetUnits),t.dithering!==void 0&&(n.dithering=t.dithering),t.alphaToCoverage!==void 0&&(n.alphaToCoverage=t.alphaToCoverage),t.premultipliedAlpha!==void 0&&(n.premultipliedAlpha=t.premultipliedAlpha),t.forceSinglePass!==void 0&&(n.forceSinglePass=t.forceSinglePass),t.visible!==void 0&&(n.visible=t.visible),t.toneMapped!==void 0&&(n.toneMapped=t.toneMapped),t.userData!==void 0&&(n.userData=t.userData),t.vertexColors!==void 0&&(typeof t.vertexColors=="number"?n.vertexColors=t.vertexColors>0:n.vertexColors=t.vertexColors),t.uniforms!==void 0)for(const s in t.uniforms){const a=t.uniforms[s];switch(n.uniforms[s]={},a.type){case"t":n.uniforms[s].value=r(a.value);break;case"c":n.uniforms[s].value=new Rt().setHex(a.value);break;case"v2":n.uniforms[s].value=new ut().fromArray(a.value);break;case"v3":n.uniforms[s].value=new he().fromArray(a.value);break;case"v4":n.uniforms[s].value=new Hi().fromArray(a.value);break;case"m3":n.uniforms[s].value=new xi().fromArray(a.value);break;case"m4":n.uniforms[s].value=new ci().fromArray(a.value);break;default:n.uniforms[s].value=a.value}}if(t.defines!==void 0&&(n.defines=t.defines),t.vertexShader!==void 0&&(n.vertexShader=t.vertexShader),t.fragmentShader!==void 0&&(n.fragmentShader=t.fragmentShader),t.glslVersion!==void 0&&(n.glslVersion=t.glslVersion),t.extensions!==void 0)for(const s in t.extensions)n.extensions[s]=t.extensions[s];if(t.lights!==void 0&&(n.lights=t.lights),t.clipping!==void 0&&(n.clipping=t.clipping),t.size!==void 0&&(n.size=t.size),t.sizeAttenuation!==void 0&&(n.sizeAttenuation=t.sizeAttenuation),t.map!==void 0&&(n.map=r(t.map)),t.matcap!==void 0&&(n.matcap=r(t.matcap)),t.alphaMap!==void 0&&(n.alphaMap=r(t.alphaMap)),t.bumpMap!==void 0&&(n.bumpMap=r(t.bumpMap)),t.bumpScale!==void 0&&(n.bumpScale=t.bumpScale),t.normalMap!==void 0&&(n.normalMap=r(t.normalMap)),t.normalMapType!==void 0&&(n.normalMapType=t.normalMapType),t.normalScale!==void 0){let s=t.normalScale;Array.isArray(s)===!1&&(s=[s,s]),n.normalScale=new ut().fromArray(s)}return t.displacementMap!==void 0&&(n.displacementMap=r(t.displacementMap)),t.displacementScale!==void 0&&(n.displacementScale=t.displacementScale),t.displacementBias!==void 0&&(n.displacementBias=t.displacementBias),t.roughnessMap!==void 0&&(n.roughnessMap=r(t.roughnessMap)),t.metalnessMap!==void 0&&(n.metalnessMap=r(t.metalnessMap)),t.emissiveMap!==void 0&&(n.emissiveMap=r(t.emissiveMap)),t.emissiveIntensity!==void 0&&(n.emissiveIntensity=t.emissiveIntensity),t.specularMap!==void 0&&(n.specularMap=r(t.specularMap)),t.specularIntensityMap!==void 0&&(n.specularIntensityMap=r(t.specularIntensityMap)),t.specularColorMap!==void 0&&(n.specularColorMap=r(t.specularColorMap)),t.envMap!==void 0&&(n.envMap=r(t.envMap)),t.envMapRotation!==void 0&&n.envMapRotation.fromArray(t.envMapRotation),t.envMapIntensity!==void 0&&(n.envMapIntensity=t.envMapIntensity),t.reflectivity!==void 0&&(n.reflectivity=t.reflectivity),t.refractionRatio!==void 0&&(n.refractionRatio=t.refractionRatio),t.lightMap!==void 0&&(n.lightMap=r(t.lightMap)),t.lightMapIntensity!==void 0&&(n.lightMapIntensity=t.lightMapIntensity),t.aoMap!==void 0&&(n.aoMap=r(t.aoMap)),t.aoMapIntensity!==void 0&&(n.aoMapIntensity=t.aoMapIntensity),t.gradientMap!==void 0&&(n.gradientMap=r(t.gradientMap)),t.clearcoatMap!==void 0&&(n.clearcoatMap=r(t.clearcoatMap)),t.clearcoatRoughnessMap!==void 0&&(n.clearcoatRoughnessMap=r(t.clearcoatRoughnessMap)),t.clearcoatNormalMap!==void 0&&(n.clearcoatNormalMap=r(t.clearcoatNormalMap)),t.clearcoatNormalScale!==void 0&&(n.clearcoatNormalScale=new ut().fromArray(t.clearcoatNormalScale)),t.iridescenceMap!==void 0&&(n.iridescenceMap=r(t.iridescenceMap)),t.iridescenceThicknessMap!==void 0&&(n.iridescenceThicknessMap=r(t.iridescenceThicknessMap)),t.transmissionMap!==void 0&&(n.transmissionMap=r(t.transmissionMap)),t.thicknessMap!==void 0&&(n.thicknessMap=r(t.thicknessMap)),t.anisotropyMap!==void 0&&(n.anisotropyMap=r(t.anisotropyMap)),t.sheenColorMap!==void 0&&(n.sheenColorMap=r(t.sheenColorMap)),t.sheenRoughnessMap!==void 0&&(n.sheenRoughnessMap=r(t.sheenRoughnessMap)),n}setTextures(t){return this.textures=t,this}createMaterialFromType(t){return RP.createMaterialFromType(t)}static createMaterialFromType(t){const i={ShadowMaterial:ase,SpriteMaterial:$4,RawShaderMaterial:ose,ShaderMaterial:cc,PointsMaterial:tk,MeshPhysicalMaterial:uk,MeshStandardMaterial:ck,MeshPhongMaterial:lse,MeshToonMaterial:cse,MeshNormalMaterial:use,MeshLambertMaterial:hse,MeshDepthMaterial:PP,MeshDistanceMaterial:DP,MeshBasicMaterial:kh,MeshMatcapMaterial:dse,LineDashedMaterial:fse,LineBasicMaterial:ka,Material:ha};return new i[t]}}class nF{static decodeText(t){if(console.warn("THREE.LoaderUtils: decodeText() has been deprecated with r165 and will be removed with r175. Use TextDecoder instead."),typeof TextDecoder<"u")return new TextDecoder().decode(t);let i="";for(let r=0,n=t.length;r<n;r++)i+=String.fromCharCode(t[r]);try{return decodeURIComponent(escape(i))}catch{return i}}static extractUrlBase(t){const i=t.lastIndexOf("/");return i===-1?"./":t.slice(0,i+1)}static resolveURL(t,i){return typeof t!="string"||t===""?"":(/^https?:\/\//i.test(i)&&/^\//.test(t)&&(i=i.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(t)||/^data:.*,.*$/i.test(t)||/^blob:.*$/i.test(t)?t:i+t)}}class gk extends Pi{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(t){return super.copy(t),this.instanceCount=t.instanceCount,this}toJSON(){const t=super.toJSON();return t.instanceCount=this.instanceCount,t.isInstancedBufferGeometry=!0,t}}class Cse extends fo{constructor(t){super(t)}load(t,i,r,n){const s=this,a=new Bh(s.manager);a.setPath(s.path),a.setRequestHeader(s.requestHeader),a.setWithCredentials(s.withCredentials),a.load(t,function(o){try{i(s.parse(JSON.parse(o)))}catch(l){n?n(l):console.error(l),s.manager.itemError(t)}},r,n)}parse(t){const i={},r={};function n(f,p){if(i[p]!==void 0)return i[p];const m=f.interleavedBuffers[p],g=s(f,m.buffer),y=Zv(m.type,g),x=new dP(y,m.stride);return x.uuid=m.uuid,i[p]=x,x}function s(f,p){if(r[p]!==void 0)return r[p];const m=f.arrayBuffers[p],g=new Uint32Array(m).buffer;return r[p]=g,g}const a=t.isInstancedBufferGeometry?new gk:new Pi,o=t.data.index;if(o!==void 0){const f=Zv(o.type,o.array);a.setIndex(new mr(f,1))}const l=t.data.attributes;for(const f in l){const p=l[f];let v;if(p.isInterleavedBufferAttribute){const m=n(t.data,p.data);v=new Bm(m,p.itemSize,p.offset,p.normalized)}else{const m=Zv(p.type,p.array),g=p.isInstancedBufferAttribute?Fm:mr;v=new g(m,p.itemSize,p.normalized)}p.name!==void 0&&(v.name=p.name),p.usage!==void 0&&v.setUsage(p.usage),a.setAttribute(f,v)}const c=t.data.morphAttributes;if(c)for(const f in c){const p=c[f],v=[];for(let m=0,g=p.length;m<g;m++){const y=p[m];let x;if(y.isInterleavedBufferAttribute){const _=n(t.data,y.data);x=new Bm(_,y.itemSize,y.offset,y.normalized)}else{const _=Zv(y.type,y.array);x=new mr(_,y.itemSize,y.normalized)}y.name!==void 0&&(x.name=y.name),v.push(x)}a.morphAttributes[f]=v}t.data.morphTargetsRelative&&(a.morphTargetsRelative=!0);const h=t.data.groups||t.data.drawcalls||t.data.offsets;if(h!==void 0)for(let f=0,p=h.length;f!==p;++f){const v=h[f];a.addGroup(v.start,v.count,v.materialIndex)}const d=t.data.boundingSphere;if(d!==void 0){const f=new he;d.center!==void 0&&f.fromArray(d.center),a.boundingSphere=new Ns(f,d.radius)}return t.name&&(a.name=t.name),t.userData&&(a.userData=t.userData),a}}class BHe extends fo{constructor(t){super(t)}load(t,i,r,n){const s=this,a=this.path===""?nF.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||a;const o=new Bh(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(t,function(l){let c=null;try{c=JSON.parse(l)}catch(h){n!==void 0&&n(h),console.error("THREE:ObjectLoader: Can't parse "+t+".",h.message);return}const u=c.metadata;if(u===void 0||u.type===void 0||u.type.toLowerCase()==="geometry"){n!==void 0&&n(new Error("THREE.ObjectLoader: Can't load "+t)),console.error("THREE.ObjectLoader: Can't load "+t);return}s.parse(c,i)},r,n)}async loadAsync(t,i){const r=this,n=this.path===""?nF.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||n;const s=new Bh(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials);const a=await s.loadAsync(t,i),o=JSON.parse(a),l=o.metadata;if(l===void 0||l.type===void 0||l.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+t);return await r.parseAsync(o)}parse(t,i){const r=this.parseAnimations(t.animations),n=this.parseShapes(t.shapes),s=this.parseGeometries(t.geometries,n),a=this.parseImages(t.images,function(){i!==void 0&&i(c)}),o=this.parseTextures(t.textures,a),l=this.parseMaterials(t.materials,o),c=this.parseObject(t.object,s,l,o,r),u=this.parseSkeletons(t.skeletons,c);if(this.bindSkeletons(c,u),this.bindLightTargets(c),i!==void 0){let h=!1;for(const d in a)if(a[d].data instanceof HTMLImageElement){h=!0;break}h===!1&&i(c)}return c}async parseAsync(t){const i=this.parseAnimations(t.animations),r=this.parseShapes(t.shapes),n=this.parseGeometries(t.geometries,r),s=await this.parseImagesAsync(t.images),a=this.parseTextures(t.textures,s),o=this.parseMaterials(t.materials,a),l=this.parseObject(t.object,n,o,a,i),c=this.parseSkeletons(t.skeletons,l);return this.bindSkeletons(l,c),this.bindLightTargets(l),l}parseShapes(t){const i={};if(t!==void 0)for(let r=0,n=t.length;r<n;r++){const s=new mm().fromJSON(t[r]);i[s.uuid]=s}return i}parseSkeletons(t,i){const r={},n={};if(i.traverse(function(s){s.isBone&&(n[s.uuid]=s)}),t!==void 0)for(let s=0,a=t.length;s<a;s++){const o=new fP().fromJSON(t[s],n);r[o.uuid]=o}return r}parseGeometries(t,i){const r={};if(t!==void 0){const n=new Cse;for(let s=0,a=t.length;s<a;s++){let o;const l=t[s];switch(l.type){case"BufferGeometry":case"InstancedBufferGeometry":o=n.parse(l);break;default:l.type in YX?o=YX[l.type].fromJSON(l,i):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${l.type}"`)}o.uuid=l.uuid,l.name!==void 0&&(o.name=l.name),l.userData!==void 0&&(o.userData=l.userData),r[l.uuid]=o}}return r}parseMaterials(t,i){const r={},n={};if(t!==void 0){const s=new RP;s.setTextures(i);for(let a=0,o=t.length;a<o;a++){const l=t[a];r[l.uuid]===void 0&&(r[l.uuid]=s.parse(l)),n[l.uuid]=r[l.uuid]}}return n}parseAnimations(t){const i={};if(t!==void 0)for(let r=0;r<t.length;r++){const n=t[r],s=pb.parse(n);i[s.uuid]=s}return i}parseImages(t,i){const r=this,n={};let s;function a(l){return r.manager.itemStart(l),s.load(l,function(){r.manager.itemEnd(l)},void 0,function(){r.manager.itemError(l),r.manager.itemEnd(l)})}function o(l){if(typeof l=="string"){const c=l,u=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(c)?c:r.resourcePath+c;return a(u)}else return l.data?{data:Zv(l.type,l.data),width:l.width,height:l.height}:null}if(t!==void 0&&t.length>0){const l=new pk(i);s=new mb(l),s.setCrossOrigin(this.crossOrigin);for(let c=0,u=t.length;c<u;c++){const h=t[c],d=h.url;if(Array.isArray(d)){const f=[];for(let p=0,v=d.length;p<v;p++){const m=d[p],g=o(m);g!==null&&(g instanceof HTMLImageElement?f.push(g):f.push(new nu(g.data,g.width,g.height)))}n[h.uuid]=new Yd(f)}else{const f=o(h.url);n[h.uuid]=new Yd(f)}}}return n}async parseImagesAsync(t){const i=this,r={};let n;async function s(a){if(typeof a=="string"){const o=a,l=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(o)?o:i.resourcePath+o;return await n.loadAsync(l)}else return a.data?{data:Zv(a.type,a.data),width:a.width,height:a.height}:null}if(t!==void 0&&t.length>0){n=new mb(this.manager),n.setCrossOrigin(this.crossOrigin);for(let a=0,o=t.length;a<o;a++){const l=t[a],c=l.url;if(Array.isArray(c)){const u=[];for(let h=0,d=c.length;h<d;h++){const f=c[h],p=await s(f);p!==null&&(p instanceof HTMLImageElement?u.push(p):u.push(new nu(p.data,p.width,p.height)))}r[l.uuid]=new Yd(u)}else{const u=await s(l.url);r[l.uuid]=new Yd(u)}}}return r}parseTextures(t,i){function r(s,a){return typeof s=="number"?s:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",s),a[s])}const n={};if(t!==void 0)for(let s=0,a=t.length;s<a;s++){const o=t[s];o.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',o.uuid),i[o.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",o.image);const l=i[o.image],c=l.data;let u;Array.isArray(c)?(u=new Yb,c.length===6&&(u.needsUpdate=!0)):(c&&c.data?u=new nu:u=new Wr,c&&(u.needsUpdate=!0)),u.source=l,u.uuid=o.uuid,o.name!==void 0&&(u.name=o.name),o.mapping!==void 0&&(u.mapping=r(o.mapping,FHe)),o.channel!==void 0&&(u.channel=o.channel),o.offset!==void 0&&u.offset.fromArray(o.offset),o.repeat!==void 0&&u.repeat.fromArray(o.repeat),o.center!==void 0&&u.center.fromArray(o.center),o.rotation!==void 0&&(u.rotation=o.rotation),o.wrap!==void 0&&(u.wrapS=r(o.wrap[0],JX),u.wrapT=r(o.wrap[1],JX)),o.format!==void 0&&(u.format=o.format),o.internalFormat!==void 0&&(u.internalFormat=o.internalFormat),o.type!==void 0&&(u.type=o.type),o.colorSpace!==void 0&&(u.colorSpace=o.colorSpace),o.minFilter!==void 0&&(u.minFilter=r(o.minFilter,$X)),o.magFilter!==void 0&&(u.magFilter=r(o.magFilter,$X)),o.anisotropy!==void 0&&(u.anisotropy=o.anisotropy),o.flipY!==void 0&&(u.flipY=o.flipY),o.generateMipmaps!==void 0&&(u.generateMipmaps=o.generateMipmaps),o.premultiplyAlpha!==void 0&&(u.premultiplyAlpha=o.premultiplyAlpha),o.unpackAlignment!==void 0&&(u.unpackAlignment=o.unpackAlignment),o.compareFunction!==void 0&&(u.compareFunction=o.compareFunction),o.userData!==void 0&&(u.userData=o.userData),n[o.uuid]=u}return n}parseObject(t,i,r,n,s){let a;function o(d){return i[d]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",d),i[d]}function l(d){if(d!==void 0){if(Array.isArray(d)){const f=[];for(let p=0,v=d.length;p<v;p++){const m=d[p];r[m]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",m),f.push(r[m])}return f}return r[d]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",d),r[d]}}function c(d){return n[d]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",d),n[d]}let u,h;switch(t.type){case"Scene":a=new J4,t.background!==void 0&&(Number.isInteger(t.background)?a.background=new Rt(t.background):a.background=c(t.background)),t.environment!==void 0&&(a.environment=c(t.environment)),t.fog!==void 0&&(t.fog.type==="Fog"?a.fog=new hP(t.fog.color,t.fog.near,t.fog.far):t.fog.type==="FogExp2"&&(a.fog=new uP(t.fog.color,t.fog.density)),t.fog.name!==""&&(a.fog.name=t.fog.name)),t.backgroundBlurriness!==void 0&&(a.backgroundBlurriness=t.backgroundBlurriness),t.backgroundIntensity!==void 0&&(a.backgroundIntensity=t.backgroundIntensity),t.backgroundRotation!==void 0&&a.backgroundRotation.fromArray(t.backgroundRotation),t.environmentIntensity!==void 0&&(a.environmentIntensity=t.environmentIntensity),t.environmentRotation!==void 0&&a.environmentRotation.fromArray(t.environmentRotation);break;case"PerspectiveCamera":a=new fn(t.fov,t.aspect,t.near,t.far),t.focus!==void 0&&(a.focus=t.focus),t.zoom!==void 0&&(a.zoom=t.zoom),t.filmGauge!==void 0&&(a.filmGauge=t.filmGauge),t.filmOffset!==void 0&&(a.filmOffset=t.filmOffset),t.view!==void 0&&(a.view=Object.assign({},t.view));break;case"OrthographicCamera":a=new hf(t.left,t.right,t.top,t.bottom,t.near,t.far),t.zoom!==void 0&&(a.zoom=t.zoom),t.view!==void 0&&(a.view=Object.assign({},t.view));break;case"AmbientLight":a=new Mse(t.color,t.intensity);break;case"DirectionalLight":a=new Sse(t.color,t.intensity),a.target=t.target||"";break;case"PointLight":a=new _se(t.color,t.intensity,t.distance,t.decay);break;case"RectAreaLight":a=new Ese(t.color,t.intensity,t.width,t.height);break;case"SpotLight":a=new bse(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay),a.target=t.target||"";break;case"HemisphereLight":a=new wse(t.color,t.groundColor,t.intensity);break;case"LightProbe":a=new Tse().fromJSON(t);break;case"SkinnedMesh":u=o(t.geometry),h=l(t.material),a=new jne(u,h),t.bindMode!==void 0&&(a.bindMode=t.bindMode),t.bindMatrix!==void 0&&a.bindMatrix.fromArray(t.bindMatrix),t.skeleton!==void 0&&(a.skeleton=t.skeleton);break;case"Mesh":u=o(t.geometry),h=l(t.material),a=new Gr(u,h);break;case"InstancedMesh":u=o(t.geometry),h=l(t.material);const d=t.count,f=t.instanceMatrix,p=t.instanceColor;a=new Wne(u,h,d),a.instanceMatrix=new Fm(new Float32Array(f.array),16),p!==void 0&&(a.instanceColor=new Fm(new Float32Array(p.array),p.itemSize));break;case"BatchedMesh":u=o(t.geometry),h=l(t.material),a=new Xne(t.maxInstanceCount,t.maxVertexCount,t.maxIndexCount,h),a.geometry=u,a.perObjectFrustumCulled=t.perObjectFrustumCulled,a.sortObjects=t.sortObjects,a._drawRanges=t.drawRanges,a._reservedRanges=t.reservedRanges,a._visibility=t.visibility,a._active=t.active,a._bounds=t.bounds.map(v=>{const m=new Us;m.min.fromArray(v.boxMin),m.max.fromArray(v.boxMax);const g=new Ns;return g.radius=v.sphereRadius,g.center.fromArray(v.sphereCenter),{boxInitialized:v.boxInitialized,box:m,sphereInitialized:v.sphereInitialized,sphere:g}}),a._maxInstanceCount=t.maxInstanceCount,a._maxVertexCount=t.maxVertexCount,a._maxIndexCount=t.maxIndexCount,a._geometryInitialized=t.geometryInitialized,a._geometryCount=t.geometryCount,a._matricesTexture=c(t.matricesTexture.uuid),t.colorsTexture!==void 0&&(a._colorsTexture=c(t.colorsTexture.uuid));break;case"LOD":a=new Hne;break;case"Line":a=new bf(o(t.geometry),l(t.material));break;case"LineLoop":a=new qne(o(t.geometry),l(t.material));break;case"LineSegments":a=new mu(o(t.geometry),l(t.material));break;case"PointCloud":case"Points":a=new Yne(o(t.geometry),l(t.material));break;case"Sprite":a=new Gne(l(t.material));break;case"Group":a=new Kv;break;case"Bone":a=new ek;break;default:a=new Qi}if(a.uuid=t.uuid,t.name!==void 0&&(a.name=t.name),t.matrix!==void 0?(a.matrix.fromArray(t.matrix),t.matrixAutoUpdate!==void 0&&(a.matrixAutoUpdate=t.matrixAutoUpdate),a.matrixAutoUpdate&&a.matrix.decompose(a.position,a.quaternion,a.scale)):(t.position!==void 0&&a.position.fromArray(t.position),t.rotation!==void 0&&a.rotation.fromArray(t.rotation),t.quaternion!==void 0&&a.quaternion.fromArray(t.quaternion),t.scale!==void 0&&a.scale.fromArray(t.scale)),t.up!==void 0&&a.up.fromArray(t.up),t.castShadow!==void 0&&(a.castShadow=t.castShadow),t.receiveShadow!==void 0&&(a.receiveShadow=t.receiveShadow),t.shadow&&(t.shadow.intensity!==void 0&&(a.shadow.intensity=t.shadow.intensity),t.shadow.bias!==void 0&&(a.shadow.bias=t.shadow.bias),t.shadow.normalBias!==void 0&&(a.shadow.normalBias=t.shadow.normalBias),t.shadow.radius!==void 0&&(a.shadow.radius=t.shadow.radius),t.shadow.mapSize!==void 0&&a.shadow.mapSize.fromArray(t.shadow.mapSize),t.shadow.camera!==void 0&&(a.shadow.camera=this.parseObject(t.shadow.camera))),t.visible!==void 0&&(a.visible=t.visible),t.frustumCulled!==void 0&&(a.frustumCulled=t.frustumCulled),t.renderOrder!==void 0&&(a.renderOrder=t.renderOrder),t.userData!==void 0&&(a.userData=t.userData),t.layers!==void 0&&(a.layers.mask=t.layers),t.children!==void 0){const d=t.children;for(let f=0;f<d.length;f++)a.add(this.parseObject(d[f],i,r,n,s))}if(t.animations!==void 0){const d=t.animations;for(let f=0;f<d.length;f++){const p=d[f];a.animations.push(s[p])}}if(t.type==="LOD"){t.autoUpdate!==void 0&&(a.autoUpdate=t.autoUpdate);const d=t.levels;for(let f=0;f<d.length;f++){const p=d[f],v=a.getObjectByProperty("uuid",p.object);v!==void 0&&a.addLevel(v,p.distance,p.hysteresis)}}return a}bindSkeletons(t,i){Object.keys(i).length!==0&&t.traverse(function(r){if(r.isSkinnedMesh===!0&&r.skeleton!==void 0){const n=i[r.skeleton];n===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",r.skeleton):r.bind(n,r.bindMatrix)}})}bindLightTargets(t){t.traverse(function(i){if(i.isDirectionalLight||i.isSpotLight){const r=i.target,n=t.getObjectByProperty("uuid",r);n!==void 0?i.target=n:i.target=new Qi}})}}const FHe={UVMapping:eP,CubeReflectionMapping:Oh,CubeRefractionMapping:wf,EquirectangularReflectionMapping:Jw,EquirectangularRefractionMapping:$w,CubeUVReflectionMapping:by},JX={RepeatWrapping:eb,ClampToEdgeWrapping:pl,MirroredRepeatWrapping:tb},$X={NearestFilter:Fs,NearestMipmapNearestFilter:z4,NearestMipmapLinearFilter:Qv,LinearFilter:pn,LinearMipmapNearestFilter:qx,LinearMipmapLinearFilter:qc};class UHe extends fo{constructor(t){super(t),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(t){return this.options=t,this}load(t,i,r,n){t===void 0&&(t=""),this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);const s=this,a=ph.get(t);if(a!==void 0){if(s.manager.itemStart(t),a.then){a.then(c=>{i&&i(c),s.manager.itemEnd(t)}).catch(c=>{n&&n(c)});return}return setTimeout(function(){i&&i(a),s.manager.itemEnd(t)},0),a}const o={};o.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",o.headers=this.requestHeader;const l=fetch(t,o).then(function(c){return c.blob()}).then(function(c){return createImageBitmap(c,Object.assign(s.options,{colorSpaceConversion:"none"}))}).then(function(c){return ph.add(t,c),i&&i(c),s.manager.itemEnd(t),c}).catch(function(c){n&&n(c),ph.remove(t),s.manager.itemError(t),s.manager.itemEnd(t)});ph.add(t,l),s.manager.itemStart(t)}}let wE,vk=class{static getContext(){return wE===void 0&&(wE=new(window.AudioContext||window.webkitAudioContext)),wE}static setContext(t){wE=t}};class NHe extends fo{constructor(t){super(t)}load(t,i,r,n){const s=this,a=new Bh(this.manager);a.setResponseType("arraybuffer"),a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(t,function(l){try{const c=l.slice(0);vk.getContext().decodeAudioData(c,function(h){i(h)}).catch(o)}catch(c){o(c)}},r,n);function o(l){n?n(l):console.error(l),s.manager.itemError(t)}}}const eq=new ci,tq=new ci,hp=new ci;class kHe{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new fn,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new fn,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(t){const i=this._cache;if(i.focus!==t.focus||i.fov!==t.fov||i.aspect!==t.aspect*this.aspect||i.near!==t.near||i.far!==t.far||i.zoom!==t.zoom||i.eyeSep!==this.eyeSep){i.focus=t.focus,i.fov=t.fov,i.aspect=t.aspect*this.aspect,i.near=t.near,i.far=t.far,i.zoom=t.zoom,i.eyeSep=this.eyeSep,hp.copy(t.projectionMatrix);const n=i.eyeSep/2,s=n*i.near/i.focus,a=i.near*Math.tan(fm*i.fov*.5)/i.zoom;let o,l;tq.elements[12]=-n,eq.elements[12]=n,o=-a*i.aspect+s,l=a*i.aspect+s,hp.elements[0]=2*i.near/(l-o),hp.elements[8]=(l+o)/(l-o),this.cameraL.projectionMatrix.copy(hp),o=-a*i.aspect-s,l=a*i.aspect-s,hp.elements[0]=2*i.near/(l-o),hp.elements[8]=(l+o)/(l-o),this.cameraR.projectionMatrix.copy(hp)}this.cameraL.matrixWorld.copy(t.matrixWorld).multiply(tq),this.cameraR.matrixWorld.copy(t.matrixWorld).multiply(eq)}}class Pse extends fn{constructor(t=[]){super(),this.isArrayCamera=!0,this.cameras=t,this.index=0}}class yk{constructor(t=!0){this.autoStart=t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=iq(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const i=iq();t=(i-this.oldTime)/1e3,this.oldTime=i,this.elapsedTime+=t}return t}}function iq(){return performance.now()}const dp=new he,rq=new oa,VHe=new he,fp=new he;class GHe extends Qi{constructor(){super(),this.type="AudioListener",this.context=vk.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new yk}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(t){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=t,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}updateMatrixWorld(t){super.updateMatrixWorld(t);const i=this.context.listener,r=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(dp,rq,VHe),fp.set(0,0,-1).applyQuaternion(rq),i.positionX){const n=this.context.currentTime+this.timeDelta;i.positionX.linearRampToValueAtTime(dp.x,n),i.positionY.linearRampToValueAtTime(dp.y,n),i.positionZ.linearRampToValueAtTime(dp.z,n),i.forwardX.linearRampToValueAtTime(fp.x,n),i.forwardY.linearRampToValueAtTime(fp.y,n),i.forwardZ.linearRampToValueAtTime(fp.z,n),i.upX.linearRampToValueAtTime(r.x,n),i.upY.linearRampToValueAtTime(r.y,n),i.upZ.linearRampToValueAtTime(r.z,n)}else i.setPosition(dp.x,dp.y,dp.z),i.setOrientation(fp.x,fp.y,fp.z,r.x,r.y,r.z)}}class Dse extends Qi{constructor(t){super(),this.type="Audio",this.listener=t,this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this}setMediaElementSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(t),this.connect(),this}setMediaStreamSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(t),this.connect(),this}setBuffer(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this}play(t=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+t;const i=this.context.createBufferSource();return i.buffer=this.buffer,i.loop=this.loop,i.loopStart=this.loopStart,i.loopEnd=this.loopEnd,i.onended=this.onEnded.bind(this),i.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=i,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(t=0){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source!==null&&(this.source.stop(this.context.currentTime+t),this.source.onended=null),this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let t=1,i=this.filters.length;t<i;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this._connected!==!1){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let t=1,i=this.filters.length;t<i;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(t){return t||(t=[]),this._connected===!0?(this.disconnect(),this.filters=t.slice(),this.connect()):this.filters=t.slice(),this}setDetune(t){return this.detune=t,this.isPlaying===!0&&this.source.detune!==void 0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(t){return this.setFilters(t?[t]:[])}setPlaybackRate(t){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=t,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1,this._progress=0}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(t){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=t,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(t){return this.loopStart=t,this}setLoopEnd(t){return this.loopEnd=t,this}getVolume(){return this.gain.gain.value}setVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}copy(t,i){return super.copy(t,i),t.sourceType!=="buffer"?(console.warn("THREE.Audio: Audio source type cannot be copied."),this):(this.autoplay=t.autoplay,this.buffer=t.buffer,this.detune=t.detune,this.loop=t.loop,this.loopStart=t.loopStart,this.loopEnd=t.loopEnd,this.offset=t.offset,this.duration=t.duration,this.playbackRate=t.playbackRate,this.hasPlaybackControl=t.hasPlaybackControl,this.sourceType=t.sourceType,this.filters=t.filters.slice(),this)}clone(t){return new this.constructor(this.listener).copy(this,t)}}const pp=new he,nq=new oa,HHe=new he,mp=new he;class jHe extends Dse{constructor(t){super(t),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){return super.connect(),this.panner.connect(this.gain),this}disconnect(){return super.disconnect(),this.panner.disconnect(this.gain),this}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(t){return this.panner.refDistance=t,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(t){return this.panner.rolloffFactor=t,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(t){return this.panner.distanceModel=t,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(t){return this.panner.maxDistance=t,this}setDirectionalCone(t,i,r){return this.panner.coneInnerAngle=t,this.panner.coneOuterAngle=i,this.panner.coneOuterGain=r,this}updateMatrixWorld(t){if(super.updateMatrixWorld(t),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(pp,nq,HHe),mp.set(0,0,1).applyQuaternion(nq);const i=this.panner;if(i.positionX){const r=this.context.currentTime+this.listener.timeDelta;i.positionX.linearRampToValueAtTime(pp.x,r),i.positionY.linearRampToValueAtTime(pp.y,r),i.positionZ.linearRampToValueAtTime(pp.z,r),i.orientationX.linearRampToValueAtTime(mp.x,r),i.orientationY.linearRampToValueAtTime(mp.y,r),i.orientationZ.linearRampToValueAtTime(mp.z,r)}else i.setPosition(pp.x,pp.y,pp.z),i.setOrientation(mp.x,mp.y,mp.z)}}class WHe{constructor(t,i=2048){this.analyser=t.context.createAnalyser(),this.analyser.fftSize=i,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let t=0;const i=this.getFrequencyData();for(let r=0;r<i.length;r++)t+=i[r];return t/i.length}}class Rse{constructor(t,i,r){this.binding=t,this.valueSize=r;let n,s,a;switch(i){case"quaternion":n=this._slerp,s=this._slerpAdditive,a=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(r*6),this._workIndex=5;break;case"string":case"bool":n=this._select,s=this._select,a=this._setAdditiveIdentityOther,this.buffer=new Array(r*5);break;default:n=this._lerp,s=this._lerpAdditive,a=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(r*5)}this._mixBufferRegion=n,this._mixBufferRegionAdditive=s,this._setIdentity=a,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(t,i){const r=this.buffer,n=this.valueSize,s=t*n+n;let a=this.cumulativeWeight;if(a===0){for(let o=0;o!==n;++o)r[s+o]=r[o];a=i}else{a+=i;const o=i/a;this._mixBufferRegion(r,s,0,o,n)}this.cumulativeWeight=a}accumulateAdditive(t){const i=this.buffer,r=this.valueSize,n=r*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(i,n,0,t,r),this.cumulativeWeightAdditive+=t}apply(t){const i=this.valueSize,r=this.buffer,n=t*i+i,s=this.cumulativeWeight,a=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,s<1){const l=i*this._origIndex;this._mixBufferRegion(r,n,l,1-s,i)}a>0&&this._mixBufferRegionAdditive(r,n,this._addIndex*i,1,i);for(let l=i,c=i+i;l!==c;++l)if(r[l]!==r[l+i]){o.setValue(r,n);break}}saveOriginalState(){const t=this.binding,i=this.buffer,r=this.valueSize,n=r*this._origIndex;t.getValue(i,n);for(let s=r,a=n;s!==a;++s)i[s]=i[n+s%r];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const t=this.valueSize*3;this.binding.setValue(this.buffer,t)}_setAdditiveIdentityNumeric(){const t=this._addIndex*this.valueSize,i=t+this.valueSize;for(let r=t;r<i;r++)this.buffer[r]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const t=this._origIndex*this.valueSize,i=this._addIndex*this.valueSize;for(let r=0;r<this.valueSize;r++)this.buffer[i+r]=this.buffer[t+r]}_select(t,i,r,n,s){if(n>=.5)for(let a=0;a!==s;++a)t[i+a]=t[r+a]}_slerp(t,i,r,n){oa.slerpFlat(t,i,t,i,t,r,n)}_slerpAdditive(t,i,r,n,s){const a=this._workIndex*s;oa.multiplyQuaternionsFlat(t,a,t,i,t,r),oa.slerpFlat(t,i,t,i,t,a,n)}_lerp(t,i,r,n,s){const a=1-n;for(let o=0;o!==s;++o){const l=i+o;t[l]=t[l]*a+t[r+o]*n}}_lerpAdditive(t,i,r,n,s){for(let a=0;a!==s;++a){const o=i+a;t[o]=t[o]+t[r+a]*n}}}const xk="\\[\\]\\.:\\/",XHe=new RegExp("["+xk+"]","g"),wk="[^"+xk+"]",qHe="[^"+xk.replace("\\.","")+"]",YHe=/((?:WC+[\/:])*)/.source.replace("WC",wk),QHe=/(WCOD+)?/.source.replace("WCOD",qHe),ZHe=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",wk),KHe=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",wk),JHe=new RegExp("^"+YHe+QHe+ZHe+KHe+"$"),$He=["material","materials","bones","map"];class eje{constructor(t,i,r){const n=r||qi.parseTrackName(i);this._targetGroup=t,this._bindings=t.subscribe_(i,n)}getValue(t,i){this.bind();const r=this._targetGroup.nCachedObjects_,n=this._bindings[r];n!==void 0&&n.getValue(t,i)}setValue(t,i){const r=this._bindings;for(let n=this._targetGroup.nCachedObjects_,s=r.length;n!==s;++n)r[n].setValue(t,i)}bind(){const t=this._bindings;for(let i=this._targetGroup.nCachedObjects_,r=t.length;i!==r;++i)t[i].bind()}unbind(){const t=this._bindings;for(let i=this._targetGroup.nCachedObjects_,r=t.length;i!==r;++i)t[i].unbind()}}class qi{constructor(t,i,r){this.path=i,this.parsedPath=r||qi.parseTrackName(i),this.node=qi.findNode(t,this.parsedPath.nodeName),this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,i,r){return t&&t.isAnimationObjectGroup?new qi.Composite(t,i,r):new qi(t,i,r)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(XHe,"")}static parseTrackName(t){const i=JHe.exec(t);if(i===null)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const r={nodeName:i[2],objectName:i[3],objectIndex:i[4],propertyName:i[5],propertyIndex:i[6]},n=r.nodeName&&r.nodeName.lastIndexOf(".");if(n!==void 0&&n!==-1){const s=r.nodeName.substring(n+1);$He.indexOf(s)!==-1&&(r.nodeName=r.nodeName.substring(0,n),r.objectName=s)}if(r.propertyName===null||r.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return r}static findNode(t,i){if(i===void 0||i===""||i==="."||i===-1||i===t.name||i===t.uuid)return t;if(t.skeleton){const r=t.skeleton.getBoneByName(i);if(r!==void 0)return r}if(t.children){const r=function(s){for(let a=0;a<s.length;a++){const o=s[a];if(o.name===i||o.uuid===i)return o;const l=r(o.children);if(l)return l}return null},n=r(t.children);if(n)return n}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,i){t[i]=this.targetObject[this.propertyName]}_getValue_array(t,i){const r=this.resolvedProperty;for(let n=0,s=r.length;n!==s;++n)t[i++]=r[n]}_getValue_arrayElement(t,i){t[i]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,i){this.resolvedProperty.toArray(t,i)}_setValue_direct(t,i){this.targetObject[this.propertyName]=t[i]}_setValue_direct_setNeedsUpdate(t,i){this.targetObject[this.propertyName]=t[i],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,i){this.targetObject[this.propertyName]=t[i],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,i){const r=this.resolvedProperty;for(let n=0,s=r.length;n!==s;++n)r[n]=t[i++]}_setValue_array_setNeedsUpdate(t,i){const r=this.resolvedProperty;for(let n=0,s=r.length;n!==s;++n)r[n]=t[i++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,i){const r=this.resolvedProperty;for(let n=0,s=r.length;n!==s;++n)r[n]=t[i++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,i){this.resolvedProperty[this.propertyIndex]=t[i]}_setValue_arrayElement_setNeedsUpdate(t,i){this.resolvedProperty[this.propertyIndex]=t[i],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,i){this.resolvedProperty[this.propertyIndex]=t[i],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,i){this.resolvedProperty.fromArray(t,i)}_setValue_fromArray_setNeedsUpdate(t,i){this.resolvedProperty.fromArray(t,i),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,i){this.resolvedProperty.fromArray(t,i),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,i){this.bind(),this.getValue(t,i)}_setValue_unbound(t,i){this.bind(),this.setValue(t,i)}bind(){let t=this.node;const i=this.parsedPath,r=i.objectName,n=i.propertyName;let s=i.propertyIndex;if(t||(t=qi.findNode(this.rootNode,i.nodeName),this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(r){let c=i.objectIndex;switch(r){case"materials":if(!t.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!t.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}t=t.material.materials;break;case"bones":if(!t.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}t=t.skeleton.bones;for(let u=0;u<t.length;u++)if(t[u].name===c){c=u;break}break;case"map":if("map"in t){t=t.map;break}if(!t.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!t.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}t=t.material.map;break;default:if(t[r]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}t=t[r]}if(c!==void 0){if(t[c]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);return}t=t[c]}}const a=t[n];if(a===void 0){const c=i.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+c+"."+n+" but it wasn't found.",t);return}let o=this.Versioning.None;this.targetObject=t,t.isMaterial===!0?o=this.Versioning.NeedsUpdate:t.isObject3D===!0&&(o=this.Versioning.MatrixWorldNeedsUpdate);let l=this.BindingType.Direct;if(s!==void 0){if(n==="morphTargetInfluences"){if(!t.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!t.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}t.morphTargetDictionary[s]!==void 0&&(s=t.morphTargetDictionary[s])}l=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=s}else a.fromArray!==void 0&&a.toArray!==void 0?(l=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(l=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=n;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}qi.Composite=eje;qi.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};qi.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};qi.prototype.GetterByBindingType=[qi.prototype._getValue_direct,qi.prototype._getValue_array,qi.prototype._getValue_arrayElement,qi.prototype._getValue_toArray];qi.prototype.SetterByBindingTypeAndVersioning=[[qi.prototype._setValue_direct,qi.prototype._setValue_direct_setNeedsUpdate,qi.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[qi.prototype._setValue_array,qi.prototype._setValue_array_setNeedsUpdate,qi.prototype._setValue_array_setMatrixWorldNeedsUpdate],[qi.prototype._setValue_arrayElement,qi.prototype._setValue_arrayElement_setNeedsUpdate,qi.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[qi.prototype._setValue_fromArray,qi.prototype._setValue_fromArray_setNeedsUpdate,qi.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class tje{constructor(){this.isAnimationObjectGroup=!0,this.uuid=Lo(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const t={};this._indicesByUUID=t;for(let r=0,n=arguments.length;r!==n;++r)t[arguments[r].uuid]=r;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const i=this;this.stats={objects:{get total(){return i._objects.length},get inUse(){return this.total-i.nCachedObjects_}},get bindingsPerObject(){return i._bindings.length}}}add(){const t=this._objects,i=this._indicesByUUID,r=this._paths,n=this._parsedPaths,s=this._bindings,a=s.length;let o,l=t.length,c=this.nCachedObjects_;for(let u=0,h=arguments.length;u!==h;++u){const d=arguments[u],f=d.uuid;let p=i[f];if(p===void 0){p=l++,i[f]=p,t.push(d);for(let v=0,m=a;v!==m;++v)s[v].push(new qi(d,r[v],n[v]))}else if(p<c){o=t[p];const v=--c,m=t[v];i[m.uuid]=p,t[p]=m,i[f]=v,t[v]=d;for(let g=0,y=a;g!==y;++g){const x=s[g],_=x[v];let M=x[p];x[p]=_,M===void 0&&(M=new qi(d,r[g],n[g])),x[v]=M}}else t[p]!==o&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=c}remove(){const t=this._objects,i=this._indicesByUUID,r=this._bindings,n=r.length;let s=this.nCachedObjects_;for(let a=0,o=arguments.length;a!==o;++a){const l=arguments[a],c=l.uuid,u=i[c];if(u!==void 0&&u>=s){const h=s++,d=t[h];i[d.uuid]=u,t[u]=d,i[c]=h,t[h]=l;for(let f=0,p=n;f!==p;++f){const v=r[f],m=v[h],g=v[u];v[u]=m,v[h]=g}}}this.nCachedObjects_=s}uncache(){const t=this._objects,i=this._indicesByUUID,r=this._bindings,n=r.length;let s=this.nCachedObjects_,a=t.length;for(let o=0,l=arguments.length;o!==l;++o){const c=arguments[o],u=c.uuid,h=i[u];if(h!==void 0)if(delete i[u],h<s){const d=--s,f=t[d],p=--a,v=t[p];i[f.uuid]=h,t[h]=f,i[v.uuid]=d,t[d]=v,t.pop();for(let m=0,g=n;m!==g;++m){const y=r[m],x=y[d],_=y[p];y[h]=x,y[d]=_,y.pop()}}else{const d=--a,f=t[d];d>0&&(i[f.uuid]=h),t[h]=f,t.pop();for(let p=0,v=n;p!==v;++p){const m=r[p];m[h]=m[d],m.pop()}}}this.nCachedObjects_=s}subscribe_(t,i){const r=this._bindingsIndicesByPath;let n=r[t];const s=this._bindings;if(n!==void 0)return s[n];const a=this._paths,o=this._parsedPaths,l=this._objects,c=l.length,u=this.nCachedObjects_,h=new Array(c);n=s.length,r[t]=n,a.push(t),o.push(i),s.push(h);for(let d=u,f=l.length;d!==f;++d){const p=l[d];h[d]=new qi(p,t,i)}return h}unsubscribe_(t){const i=this._bindingsIndicesByPath,r=i[t];if(r!==void 0){const n=this._paths,s=this._parsedPaths,a=this._bindings,o=a.length-1,l=a[o],c=t[o];i[c]=r,a[r]=l,a.pop(),s[r]=s[o],s.pop(),n[r]=n[o],n.pop()}}}class Ise{constructor(t,i,r=null,n=i.blendMode){this._mixer=t,this._clip=i,this._localRoot=r,this.blendMode=n;const s=i.tracks,a=s.length,o=new Array(a),l={endingStart:Jp,endingEnd:Jp};for(let c=0;c!==a;++c){const u=s[c].createInterpolant(null);o[c]=u,u.settings=l}this._interpolantSettings=l,this._interpolants=o,this._propertyBindings=new Array(a),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=Sne,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(t){return this._startTime=t,this}setLoop(t,i){return this.loop=t,this.repetitions=i,this}setEffectiveWeight(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(t){return this._scheduleFading(t,0,1)}fadeOut(t){return this._scheduleFading(t,1,0)}crossFadeFrom(t,i,r){if(t.fadeOut(i),this.fadeIn(i),r){const n=this._clip.duration,s=t._clip.duration,a=s/n,o=n/s;t.warp(1,a,i),this.warp(o,1,i)}return this}crossFadeTo(t,i,r){return t.crossFadeFrom(this,i,r)}stopFading(){const t=this._weightInterpolant;return t!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}setEffectiveTimeScale(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(t){return this.timeScale=this._clip.duration/t,this.stopWarping()}syncWith(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()}halt(t){return this.warp(this._effectiveTimeScale,0,t)}warp(t,i,r){const n=this._mixer,s=n.time,a=this.timeScale;let o=this._timeScaleInterpolant;o===null&&(o=n._lendControlInterpolant(),this._timeScaleInterpolant=o);const l=o.parameterPositions,c=o.sampleValues;return l[0]=s,l[1]=s+r,c[0]=t/a,c[1]=i/a,this}stopWarping(){const t=this._timeScaleInterpolant;return t!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(t,i,r,n){if(!this.enabled){this._updateWeight(t);return}const s=this._startTime;if(s!==null){const l=(t-s)*r;l<0||r===0?i=0:(this._startTime=null,i=r*l)}i*=this._updateTimeScale(t);const a=this._updateTime(i),o=this._updateWeight(t);if(o>0){const l=this._interpolants,c=this._propertyBindings;switch(this.blendMode){case W4:for(let u=0,h=l.length;u!==h;++u)l[u].evaluate(a),c[u].accumulateAdditive(o);break;case oP:default:for(let u=0,h=l.length;u!==h;++u)l[u].evaluate(a),c[u].accumulate(n,o)}}}_updateWeight(t){let i=0;if(this.enabled){i=this.weight;const r=this._weightInterpolant;if(r!==null){const n=r.evaluate(t)[0];i*=n,t>r.parameterPositions[1]&&(this.stopFading(),n===0&&(this.enabled=!1))}}return this._effectiveWeight=i,i}_updateTimeScale(t){let i=0;if(!this.paused){i=this.timeScale;const r=this._timeScaleInterpolant;if(r!==null){const n=r.evaluate(t)[0];i*=n,t>r.parameterPositions[1]&&(this.stopWarping(),i===0?this.paused=!0:this.timeScale=i)}}return this._effectiveTimeScale=i,i}_updateTime(t){const i=this._clip.duration,r=this.loop;let n=this.time+t,s=this._loopCount;const a=r===Mne;if(t===0)return s===-1?n:a&&(s&1)===1?i-n:n;if(r===_ne){s===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(n>=i)n=i;else if(n<0)n=0;else{this.time=n;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(s===-1&&(t>=0?(s=0,this._setEndings(!0,this.repetitions===0,a)):this._setEndings(this.repetitions===0,!0,a)),n>=i||n<0){const o=Math.floor(n/i);n-=i*o,s+=Math.abs(o);const l=this.repetitions-s;if(l<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,n=t>0?i:0,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(l===1){const c=t<0;this._setEndings(c,!c,a)}else this._setEndings(!1,!1,a);this._loopCount=s,this.time=n,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}else this.time=n;if(a&&(s&1)===1)return i-n}return n}_setEndings(t,i,r){const n=this._interpolantSettings;r?(n.endingStart=$p,n.endingEnd=$p):(t?n.endingStart=this.zeroSlopeAtStart?$p:Jp:n.endingStart=rb,i?n.endingEnd=this.zeroSlopeAtEnd?$p:Jp:n.endingEnd=rb)}_scheduleFading(t,i,r){const n=this._mixer,s=n.time;let a=this._weightInterpolant;a===null&&(a=n._lendControlInterpolant(),this._weightInterpolant=a);const o=a.parameterPositions,l=a.sampleValues;return o[0]=s,l[0]=i,o[1]=s+t,l[1]=r,this}}const ije=new Float32Array(1);class rje extends pu{constructor(t){super(),this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(t,i){const r=t._localRoot||this._root,n=t._clip.tracks,s=n.length,a=t._propertyBindings,o=t._interpolants,l=r.uuid,c=this._bindingsByRootAndName;let u=c[l];u===void 0&&(u={},c[l]=u);for(let h=0;h!==s;++h){const d=n[h],f=d.name;let p=u[f];if(p!==void 0)++p.referenceCount,a[h]=p;else{if(p=a[h],p!==void 0){p._cacheIndex===null&&(++p.referenceCount,this._addInactiveBinding(p,l,f));continue}const v=i&&i._propertyBindings[h].binding.parsedPath;p=new Rse(qi.create(r,f,v),d.ValueTypeName,d.getValueSize()),++p.referenceCount,this._addInactiveBinding(p,l,f),a[h]=p}o[h].resultBuffer=p.buffer}}_activateAction(t){if(!this._isActiveAction(t)){if(t._cacheIndex===null){const r=(t._localRoot||this._root).uuid,n=t._clip.uuid,s=this._actionsByClip[n];this._bindAction(t,s&&s.knownActions[0]),this._addInactiveAction(t,n,r)}const i=t._propertyBindings;for(let r=0,n=i.length;r!==n;++r){const s=i[r];s.useCount++===0&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(t)}}_deactivateAction(t){if(this._isActiveAction(t)){const i=t._propertyBindings;for(let r=0,n=i.length;r!==n;++r){const s=i[r];--s.useCount===0&&(s.restoreOriginalState(),this._takeBackBinding(s))}this._takeBackAction(t)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}}_isActiveAction(t){const i=t._cacheIndex;return i!==null&&i<this._nActiveActions}_addInactiveAction(t,i,r){const n=this._actions,s=this._actionsByClip;let a=s[i];if(a===void 0)a={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,s[i]=a;else{const o=a.knownActions;t._byClipCacheIndex=o.length,o.push(t)}t._cacheIndex=n.length,n.push(t),a.actionByRoot[r]=t}_removeInactiveAction(t){const i=this._actions,r=i[i.length-1],n=t._cacheIndex;r._cacheIndex=n,i[n]=r,i.pop(),t._cacheIndex=null;const s=t._clip.uuid,a=this._actionsByClip,o=a[s],l=o.knownActions,c=l[l.length-1],u=t._byClipCacheIndex;c._byClipCacheIndex=u,l[u]=c,l.pop(),t._byClipCacheIndex=null;const h=o.actionByRoot,d=(t._localRoot||this._root).uuid;delete h[d],l.length===0&&delete a[s],this._removeInactiveBindingsForAction(t)}_removeInactiveBindingsForAction(t){const i=t._propertyBindings;for(let r=0,n=i.length;r!==n;++r){const s=i[r];--s.referenceCount===0&&this._removeInactiveBinding(s)}}_lendAction(t){const i=this._actions,r=t._cacheIndex,n=this._nActiveActions++,s=i[n];t._cacheIndex=n,i[n]=t,s._cacheIndex=r,i[r]=s}_takeBackAction(t){const i=this._actions,r=t._cacheIndex,n=--this._nActiveActions,s=i[n];t._cacheIndex=n,i[n]=t,s._cacheIndex=r,i[r]=s}_addInactiveBinding(t,i,r){const n=this._bindingsByRootAndName,s=this._bindings;let a=n[i];a===void 0&&(a={},n[i]=a),a[r]=t,t._cacheIndex=s.length,s.push(t)}_removeInactiveBinding(t){const i=this._bindings,r=t.binding,n=r.rootNode.uuid,s=r.path,a=this._bindingsByRootAndName,o=a[n],l=i[i.length-1],c=t._cacheIndex;l._cacheIndex=c,i[c]=l,i.pop(),delete o[s],Object.keys(o).length===0&&delete a[n]}_lendBinding(t){const i=this._bindings,r=t._cacheIndex,n=this._nActiveBindings++,s=i[n];t._cacheIndex=n,i[n]=t,s._cacheIndex=r,i[r]=s}_takeBackBinding(t){const i=this._bindings,r=t._cacheIndex,n=--this._nActiveBindings,s=i[n];t._cacheIndex=n,i[n]=t,s._cacheIndex=r,i[r]=s}_lendControlInterpolant(){const t=this._controlInterpolants,i=this._nActiveControlInterpolants++;let r=t[i];return r===void 0&&(r=new dk(new Float32Array(2),new Float32Array(2),1,ije),r.__cacheIndex=i,t[i]=r),r}_takeBackControlInterpolant(t){const i=this._controlInterpolants,r=t.__cacheIndex,n=--this._nActiveControlInterpolants,s=i[n];t.__cacheIndex=n,i[n]=t,s.__cacheIndex=r,i[r]=s}clipAction(t,i,r){const n=i||this._root,s=n.uuid;let a=typeof t=="string"?pb.findByName(n,t):t;const o=a!==null?a.uuid:t,l=this._actionsByClip[o];let c=null;if(r===void 0&&(a!==null?r=a.blendMode:r=oP),l!==void 0){const h=l.actionByRoot[s];if(h!==void 0&&h.blendMode===r)return h;c=l.knownActions[0],a===null&&(a=c._clip)}if(a===null)return null;const u=new Ise(this,a,i,r);return this._bindAction(u,c),this._addInactiveAction(u,o,s),u}existingAction(t,i){const r=i||this._root,n=r.uuid,s=typeof t=="string"?pb.findByName(r,t):t,a=s?s.uuid:t,o=this._actionsByClip[a];return o!==void 0&&o.actionByRoot[n]||null}stopAllAction(){const t=this._actions,i=this._nActiveActions;for(let r=i-1;r>=0;--r)t[r].stop();return this}update(t){t*=this.timeScale;const i=this._actions,r=this._nActiveActions,n=this.time+=t,s=Math.sign(t),a=this._accuIndex^=1;for(let c=0;c!==r;++c)i[c]._update(n,t,s,a);const o=this._bindings,l=this._nActiveBindings;for(let c=0;c!==l;++c)o[c].apply(a);return this}setTime(t){this.time=0;for(let i=0;i<this._actions.length;i++)this._actions[i].time=0;return this.update(t)}getRoot(){return this._root}uncacheClip(t){const i=this._actions,r=t.uuid,n=this._actionsByClip,s=n[r];if(s!==void 0){const a=s.knownActions;for(let o=0,l=a.length;o!==l;++o){const c=a[o];this._deactivateAction(c);const u=c._cacheIndex,h=i[i.length-1];c._cacheIndex=null,c._byClipCacheIndex=null,h._cacheIndex=u,i[u]=h,i.pop(),this._removeInactiveBindingsForAction(c)}delete n[r]}}uncacheRoot(t){const i=t.uuid,r=this._actionsByClip;for(const a in r){const o=r[a].actionByRoot,l=o[i];l!==void 0&&(this._deactivateAction(l),this._removeInactiveAction(l))}const n=this._bindingsByRootAndName,s=n[i];if(s!==void 0)for(const a in s){const o=s[a];o.restoreOriginalState(),this._removeInactiveBinding(o)}}uncacheAction(t,i){const r=this.existingAction(t,i);r!==null&&(this._deactivateAction(r),this._removeInactiveAction(r))}}class nje extends lP{constructor(t=1,i=1,r=1,n={}){super(t,i,n),this.isRenderTarget3D=!0,this.depth=r,this.texture=new cP(null,t,i,r),this.texture.isRenderTargetTexture=!0}}class sje extends lP{constructor(t=1,i=1,r=1,n={}){super(t,i,n),this.isRenderTargetArray=!0,this.depth=r,this.texture=new Xb(null,t,i,r),this.texture.isRenderTargetTexture=!0}}class bk{constructor(t){this.value=t}clone(){return new bk(this.value.clone===void 0?this.value:this.value.clone())}}let aje=0;class oje extends pu{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:aje++}),this.name="",this.usage=sb,this.uniforms=[]}add(t){return this.uniforms.push(t),this}remove(t){const i=this.uniforms.indexOf(t);return i!==-1&&this.uniforms.splice(i,1),this}setName(t){return this.name=t,this}setUsage(t){return this.usage=t,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(t){this.name=t.name,this.usage=t.usage;const i=t.uniforms;this.uniforms.length=0;for(let r=0,n=i.length;r<n;r++){const s=Array.isArray(i[r])?i[r]:[i[r]];for(let a=0;a<s.length;a++)this.uniforms.push(s[a].clone())}return this}clone(){return new this.constructor().copy(this)}}class lje extends dP{constructor(t,i,r=1){super(t,i),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=r}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}clone(t){const i=super.clone(t);return i.meshPerAttribute=this.meshPerAttribute,i}toJSON(t){const i=super.toJSON(t);return i.isInstancedInterleavedBuffer=!0,i.meshPerAttribute=this.meshPerAttribute,i}}class cje{constructor(t,i,r,n,s){this.isGLBufferAttribute=!0,this.name="",this.buffer=t,this.type=i,this.itemSize=r,this.elementSize=n,this.count=s,this.version=0}set needsUpdate(t){t===!0&&this.version++}setBuffer(t){return this.buffer=t,this}setType(t,i){return this.type=t,this.elementSize=i,this}setItemSize(t){return this.itemSize=t,this}setCount(t){return this.count=t,this}}const sq=new ci;class Lse{constructor(t,i,r=0,n=1/0){this.ray=new Zm(t,i),this.near=r,this.far=n,this.camera=null,this.layers=new pm,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(t,i){this.ray.set(t,i)}setFromCamera(t,i){i.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(i.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(i).sub(this.ray.origin).normalize(),this.camera=i):i.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(i.near+i.far)/(i.near-i.far)).unproject(i),this.ray.direction.set(0,0,-1).transformDirection(i.matrixWorld),this.camera=i):console.error("THREE.Raycaster: Unsupported camera type: "+i.type)}setFromXRController(t){return sq.identity().extractRotation(t.matrixWorld),this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(sq),this}intersectObject(t,i=!0,r=[]){return sF(t,this,r,i),r.sort(aq),r}intersectObjects(t,i=!0,r=[]){for(let n=0,s=t.length;n<s;n++)sF(t[n],this,r,i);return r.sort(aq),r}}function aq(e,t){return e.distance-t.distance}function sF(e,t,i,r){let n=!0;if(e.layers.test(t.layers)&&e.raycast(t,i)===!1&&(n=!1),n===!0&&r===!0){const s=e.children;for(let a=0,o=s.length;a<o;a++)sF(s[a],t,i,!0)}}class aF{constructor(t=1,i=0,r=0){this.radius=t,this.phi=i,this.theta=r}set(t,i,r){return this.radius=t,this.phi=i,this.theta=r,this}copy(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}makeSafe(){return this.phi=wi(this.phi,1e-6,Math.PI-1e-6),this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,i,r){return this.radius=Math.sqrt(t*t+i*i+r*r),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,r),this.phi=Math.acos(wi(i/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class uje{constructor(t=1,i=0,r=0){this.radius=t,this.theta=i,this.y=r}set(t,i,r){return this.radius=t,this.theta=i,this.y=r,this}copy(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,i,r){return this.radius=Math.sqrt(t*t+r*r),this.theta=Math.atan2(t,r),this.y=i,this}clone(){return new this.constructor().copy(this)}}class _k{constructor(t,i,r,n){_k.prototype.isMatrix2=!0,this.elements=[1,0,0,1],t!==void 0&&this.set(t,i,r,n)}identity(){return this.set(1,0,0,1),this}fromArray(t,i=0){for(let r=0;r<4;r++)this.elements[r]=t[r+i];return this}set(t,i,r,n){const s=this.elements;return s[0]=t,s[2]=i,s[1]=r,s[3]=n,this}}const oq=new ut;class hje{constructor(t=new ut(1/0,1/0),i=new ut(-1/0,-1/0)){this.isBox2=!0,this.min=t,this.max=i}set(t,i){return this.min.copy(t),this.max.copy(i),this}setFromPoints(t){this.makeEmpty();for(let i=0,r=t.length;i<r;i++)this.expandByPoint(t[i]);return this}setFromCenterAndSize(t,i){const r=oq.copy(i).multiplyScalar(.5);return this.min.copy(t).sub(r),this.max.copy(t).add(r),this}clone(){return new this.constructor().copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(t){return this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}containsPoint(t){return t.x>=this.min.x&&t.x<=this.max.x&&t.y>=this.min.y&&t.y<=this.max.y}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y}getParameter(t,i){return i.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(t){return t.max.x>=this.min.x&&t.min.x<=this.max.x&&t.max.y>=this.min.y&&t.min.y<=this.max.y}clampPoint(t,i){return i.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,oq).distanceTo(t)}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const lq=new he,bE=new he;class dje{constructor(t=new he,i=new he){this.start=t,this.end=i}set(t,i){return this.start.copy(t),this.end.copy(i),this}copy(t){return this.start.copy(t.start),this.end.copy(t.end),this}getCenter(t){return t.addVectors(this.start,this.end).multiplyScalar(.5)}delta(t){return t.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(t,i){return this.delta(i).multiplyScalar(t).add(this.start)}closestPointToPointParameter(t,i){lq.subVectors(t,this.start),bE.subVectors(this.end,this.start);const r=bE.dot(bE);let s=bE.dot(lq)/r;return i&&(s=wi(s,0,1)),s}closestPointToPoint(t,i,r){const n=this.closestPointToPointParameter(t,i);return this.delta(r).multiplyScalar(n).add(this.start)}applyMatrix4(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this}equals(t){return t.start.equals(this.start)&&t.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const cq=new he;class fje extends Qi{constructor(t,i){super(),this.light=t,this.matrixAutoUpdate=!1,this.color=i,this.type="SpotLightHelper";const r=new Pi,n=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let a=0,o=1,l=32;a<l;a++,o++){const c=a/l*Math.PI*2,u=o/l*Math.PI*2;n.push(Math.cos(c),Math.sin(c),1,Math.cos(u),Math.sin(u),1)}r.setAttribute("position",new Gt(n,3));const s=new ka({fog:!1,toneMapped:!1});this.cone=new mu(r,s),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),this.parent?(this.parent.updateWorldMatrix(!0),this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.light.matrixWorld)):this.matrix.copy(this.light.matrixWorld),this.matrixWorld.copy(this.light.matrixWorld);const t=this.light.distance?this.light.distance:1e3,i=t*Math.tan(this.light.angle);this.cone.scale.set(i,i,t),cq.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(cq),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const wd=new he,_E=new ci,aL=new ci;class pje extends mu{constructor(t){const i=Ose(t),r=new Pi,n=[],s=[],a=new Rt(0,0,1),o=new Rt(0,1,0);for(let c=0;c<i.length;c++){const u=i[c];u.parent&&u.parent.isBone&&(n.push(0,0,0),n.push(0,0,0),s.push(a.r,a.g,a.b),s.push(o.r,o.g,o.b))}r.setAttribute("position",new Gt(n,3)),r.setAttribute("color",new Gt(s,3));const l=new ka({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(r,l),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=t,this.bones=i,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(t){const i=this.bones,r=this.geometry,n=r.getAttribute("position");aL.copy(this.root.matrixWorld).invert();for(let s=0,a=0;s<i.length;s++){const o=i[s];o.parent&&o.parent.isBone&&(_E.multiplyMatrices(aL,o.matrixWorld),wd.setFromMatrixPosition(_E),n.setXYZ(a,wd.x,wd.y,wd.z),_E.multiplyMatrices(aL,o.parent.matrixWorld),wd.setFromMatrixPosition(_E),n.setXYZ(a+1,wd.x,wd.y,wd.z),a+=2)}r.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(t)}dispose(){this.geometry.dispose(),this.material.dispose()}}function Ose(e){const t=[];e.isBone===!0&&t.push(e);for(let i=0;i<e.children.length;i++)t.push(...Ose(e.children[i]));return t}class mje extends Gr{constructor(t,i,r){const n=new Jb(i,4,2),s=new kh({wireframe:!0,fog:!1,toneMapped:!1});super(n,s),this.light=t,this.color=r,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const gje=new he,uq=new Rt,hq=new Rt;class vje extends Qi{constructor(t,i,r){super(),this.light=t,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,this.type="HemisphereLightHelper";const n=new Kb(i);n.rotateY(Math.PI*.5),this.material=new kh({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const s=n.getAttribute("position"),a=new Float32Array(s.count*3);n.setAttribute("color",new mr(a,3)),this.add(new Gr(n,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const t=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const i=t.geometry.getAttribute("color");uq.copy(this.light.color),hq.copy(this.light.groundColor);for(let r=0,n=i.count;r<n;r++){const s=r<n/2?uq:hq;i.setXYZ(r,s.r,s.g,s.b)}i.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),t.lookAt(gje.setFromMatrixPosition(this.light.matrixWorld).negate())}}class yje extends mu{constructor(t=10,i=10,r=4473924,n=8947848){r=new Rt(r),n=new Rt(n);const s=i/2,a=t/i,o=t/2,l=[],c=[];for(let d=0,f=0,p=-o;d<=i;d++,p+=a){l.push(-o,0,p,o,0,p),l.push(p,0,-o,p,0,o);const v=d===s?r:n;v.toArray(c,f),f+=3,v.toArray(c,f),f+=3,v.toArray(c,f),f+=3,v.toArray(c,f),f+=3}const u=new Pi;u.setAttribute("position",new Gt(l,3)),u.setAttribute("color",new Gt(c,3));const h=new ka({vertexColors:!0,toneMapped:!1});super(u,h),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class xje extends mu{constructor(t=10,i=16,r=8,n=64,s=4473924,a=8947848){s=new Rt(s),a=new Rt(a);const o=[],l=[];if(i>1)for(let h=0;h<i;h++){const d=h/i*(Math.PI*2),f=Math.sin(d)*t,p=Math.cos(d)*t;o.push(0,0,0),o.push(f,0,p);const v=h&1?s:a;l.push(v.r,v.g,v.b),l.push(v.r,v.g,v.b)}for(let h=0;h<r;h++){const d=h&1?s:a,f=t-t/r*h;for(let p=0;p<n;p++){let v=p/n*(Math.PI*2),m=Math.sin(v)*f,g=Math.cos(v)*f;o.push(m,0,g),l.push(d.r,d.g,d.b),v=(p+1)/n*(Math.PI*2),m=Math.sin(v)*f,g=Math.cos(v)*f,o.push(m,0,g),l.push(d.r,d.g,d.b)}}const c=new Pi;c.setAttribute("position",new Gt(o,3)),c.setAttribute("color",new Gt(l,3));const u=new ka({vertexColors:!0,toneMapped:!1});super(c,u),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const dq=new he,SE=new he,fq=new he;class wje extends Qi{constructor(t,i,r){super(),this.light=t,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,this.type="DirectionalLightHelper",i===void 0&&(i=1);let n=new Pi;n.setAttribute("position",new Gt([-i,i,0,i,i,0,i,-i,0,-i,-i,0,-i,i,0],3));const s=new ka({fog:!1,toneMapped:!1});this.lightPlane=new bf(n,s),this.add(this.lightPlane),n=new Pi,n.setAttribute("position",new Gt([0,0,0,0,0,1],3)),this.targetLine=new bf(n,s),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),dq.setFromMatrixPosition(this.light.matrixWorld),SE.setFromMatrixPosition(this.light.target.matrixWorld),fq.subVectors(SE,dq),this.lightPlane.lookAt(SE),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(SE),this.targetLine.scale.z=fq.length()}}const ME=new he,Zr=new qb;class bje extends mu{constructor(t){const i=new Pi,r=new ka({color:16777215,vertexColors:!0,toneMapped:!1}),n=[],s=[],a={};o("n1","n2"),o("n2","n4"),o("n4","n3"),o("n3","n1"),o("f1","f2"),o("f2","f4"),o("f4","f3"),o("f3","f1"),o("n1","f1"),o("n2","f2"),o("n3","f3"),o("n4","f4"),o("p","n1"),o("p","n2"),o("p","n3"),o("p","n4"),o("u1","u2"),o("u2","u3"),o("u3","u1"),o("c","t"),o("p","c"),o("cn1","cn2"),o("cn3","cn4"),o("cf1","cf2"),o("cf3","cf4");function o(p,v){l(p),l(v)}function l(p){n.push(0,0,0),s.push(0,0,0),a[p]===void 0&&(a[p]=[]),a[p].push(n.length/3-1)}i.setAttribute("position",new Gt(n,3)),i.setAttribute("color",new Gt(s,3)),super(i,r),this.type="CameraHelper",this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update();const c=new Rt(16755200),u=new Rt(16711680),h=new Rt(43775),d=new Rt(16777215),f=new Rt(3355443);this.setColors(c,u,h,d,f)}setColors(t,i,r,n,s){const o=this.geometry.getAttribute("color");o.setXYZ(0,t.r,t.g,t.b),o.setXYZ(1,t.r,t.g,t.b),o.setXYZ(2,t.r,t.g,t.b),o.setXYZ(3,t.r,t.g,t.b),o.setXYZ(4,t.r,t.g,t.b),o.setXYZ(5,t.r,t.g,t.b),o.setXYZ(6,t.r,t.g,t.b),o.setXYZ(7,t.r,t.g,t.b),o.setXYZ(8,t.r,t.g,t.b),o.setXYZ(9,t.r,t.g,t.b),o.setXYZ(10,t.r,t.g,t.b),o.setXYZ(11,t.r,t.g,t.b),o.setXYZ(12,t.r,t.g,t.b),o.setXYZ(13,t.r,t.g,t.b),o.setXYZ(14,t.r,t.g,t.b),o.setXYZ(15,t.r,t.g,t.b),o.setXYZ(16,t.r,t.g,t.b),o.setXYZ(17,t.r,t.g,t.b),o.setXYZ(18,t.r,t.g,t.b),o.setXYZ(19,t.r,t.g,t.b),o.setXYZ(20,t.r,t.g,t.b),o.setXYZ(21,t.r,t.g,t.b),o.setXYZ(22,t.r,t.g,t.b),o.setXYZ(23,t.r,t.g,t.b),o.setXYZ(24,i.r,i.g,i.b),o.setXYZ(25,i.r,i.g,i.b),o.setXYZ(26,i.r,i.g,i.b),o.setXYZ(27,i.r,i.g,i.b),o.setXYZ(28,i.r,i.g,i.b),o.setXYZ(29,i.r,i.g,i.b),o.setXYZ(30,i.r,i.g,i.b),o.setXYZ(31,i.r,i.g,i.b),o.setXYZ(32,r.r,r.g,r.b),o.setXYZ(33,r.r,r.g,r.b),o.setXYZ(34,r.r,r.g,r.b),o.setXYZ(35,r.r,r.g,r.b),o.setXYZ(36,r.r,r.g,r.b),o.setXYZ(37,r.r,r.g,r.b),o.setXYZ(38,n.r,n.g,n.b),o.setXYZ(39,n.r,n.g,n.b),o.setXYZ(40,s.r,s.g,s.b),o.setXYZ(41,s.r,s.g,s.b),o.setXYZ(42,s.r,s.g,s.b),o.setXYZ(43,s.r,s.g,s.b),o.setXYZ(44,s.r,s.g,s.b),o.setXYZ(45,s.r,s.g,s.b),o.setXYZ(46,s.r,s.g,s.b),o.setXYZ(47,s.r,s.g,s.b),o.setXYZ(48,s.r,s.g,s.b),o.setXYZ(49,s.r,s.g,s.b),o.needsUpdate=!0}update(){const t=this.geometry,i=this.pointMap,r=1,n=1;Zr.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse);const s=this.camera.coordinateSystem===$l?-1:0;un("c",i,t,Zr,0,0,s),un("t",i,t,Zr,0,0,1),un("n1",i,t,Zr,-1,-1,s),un("n2",i,t,Zr,r,-1,s),un("n3",i,t,Zr,-1,n,s),un("n4",i,t,Zr,r,n,s),un("f1",i,t,Zr,-1,-1,1),un("f2",i,t,Zr,r,-1,1),un("f3",i,t,Zr,-1,n,1),un("f4",i,t,Zr,r,n,1),un("u1",i,t,Zr,r*.7,n*1.1,s),un("u2",i,t,Zr,-1*.7,n*1.1,s),un("u3",i,t,Zr,0,n*2,s),un("cf1",i,t,Zr,-1,0,1),un("cf2",i,t,Zr,r,0,1),un("cf3",i,t,Zr,0,-1,1),un("cf4",i,t,Zr,0,n,1),un("cn1",i,t,Zr,-1,0,s),un("cn2",i,t,Zr,r,0,s),un("cn3",i,t,Zr,0,-1,s),un("cn4",i,t,Zr,0,n,s),t.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function un(e,t,i,r,n,s,a){ME.set(n,s,a).unproject(r);const o=t[e];if(o!==void 0){const l=i.getAttribute("position");for(let c=0,u=o.length;c<u;c++)l.setXYZ(o[c],ME.x,ME.y,ME.z)}}const EE=new Us;class _je extends mu{constructor(t,i=16776960){const r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new Float32Array(8*3),s=new Pi;s.setIndex(new mr(r,1)),s.setAttribute("position",new mr(n,3)),super(s,new ka({color:i,toneMapped:!1})),this.object=t,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(){if(this.object!==void 0&&EE.setFromObject(this.object),EE.isEmpty())return;const t=EE.min,i=EE.max,r=this.geometry.attributes.position,n=r.array;n[0]=i.x,n[1]=i.y,n[2]=i.z,n[3]=t.x,n[4]=i.y,n[5]=i.z,n[6]=t.x,n[7]=t.y,n[8]=i.z,n[9]=i.x,n[10]=t.y,n[11]=i.z,n[12]=i.x,n[13]=i.y,n[14]=t.z,n[15]=t.x,n[16]=i.y,n[17]=t.z,n[18]=t.x,n[19]=t.y,n[20]=t.z,n[21]=i.x,n[22]=t.y,n[23]=t.z,r.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(t){return this.object=t,this.update(),this}copy(t,i){return super.copy(t,i),this.object=t.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class Sje extends mu{constructor(t,i=16776960){const r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],s=new Pi;s.setIndex(new mr(r,1)),s.setAttribute("position",new Gt(n,3)),super(s,new ka({color:i,toneMapped:!1})),this.box=t,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(t){const i=this.box;i.isEmpty()||(i.getCenter(this.position),i.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(t))}dispose(){this.geometry.dispose(),this.material.dispose()}}class Mje extends bf{constructor(t,i=1,r=16776960){const n=r,s=[1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],a=new Pi;a.setAttribute("position",new Gt(s,3)),a.computeBoundingSphere(),super(a,new ka({color:n,toneMapped:!1})),this.type="PlaneHelper",this.plane=t,this.size=i;const o=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],l=new Pi;l.setAttribute("position",new Gt(o,3)),l.computeBoundingSphere(),this.add(new Gr(l,new kh({color:n,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(t){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(t)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const pq=new he;let AE,oL;class Eje extends Qi{constructor(t=new he(0,0,1),i=new he(0,0,0),r=1,n=16776960,s=r*.2,a=s*.2){super(),this.type="ArrowHelper",AE===void 0&&(AE=new Pi,AE.setAttribute("position",new Gt([0,0,0,0,1,0],3)),oL=new Sy(0,.5,1,5,1),oL.translate(0,-.5,0)),this.position.copy(i),this.line=new bf(AE,new ka({color:n,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Gr(oL,new kh({color:n,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(t),this.setLength(r,s,a)}setDirection(t){if(t.y>.99999)this.quaternion.set(0,0,0,1);else if(t.y<-.99999)this.quaternion.set(1,0,0,0);else{pq.set(t.z,0,-t.x).normalize();const i=Math.acos(t.y);this.quaternion.setFromAxisAngle(pq,i)}}setLength(t,i=t*.2,r=i*.2){this.line.scale.set(1,Math.max(1e-4,t-i),1),this.line.updateMatrix(),this.cone.scale.set(r,i,r),this.cone.position.y=t,this.cone.updateMatrix()}setColor(t){this.line.material.color.set(t),this.cone.material.color.set(t)}copy(t){return super.copy(t,!1),this.line.copy(t.line),this.cone.copy(t.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class Aje extends mu{constructor(t=1){const i=[0,0,0,t,0,0,0,0,0,0,t,0,0,0,0,0,0,t],r=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],n=new Pi;n.setAttribute("position",new Gt(i,3)),n.setAttribute("color",new Gt(r,3));const s=new ka({vertexColors:!0,toneMapped:!1});super(n,s),this.type="AxesHelper"}setColors(t,i,r){const n=new Rt,s=this.geometry.attributes.color.array;return n.set(t),n.toArray(s,0),n.toArray(s,3),n.set(i),n.toArray(s,6),n.toArray(s,9),n.set(r),n.toArray(s,12),n.toArray(s,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class Tje{constructor(){this.type="ShapePath",this.color=new Rt,this.subPaths=[],this.currentPath=null}moveTo(t,i){return this.currentPath=new lb,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,i),this}lineTo(t,i){return this.currentPath.lineTo(t,i),this}quadraticCurveTo(t,i,r,n){return this.currentPath.quadraticCurveTo(t,i,r,n),this}bezierCurveTo(t,i,r,n,s,a){return this.currentPath.bezierCurveTo(t,i,r,n,s,a),this}splineThru(t){return this.currentPath.splineThru(t),this}toShapes(t){function i(g){const y=[];for(let x=0,_=g.length;x<_;x++){const M=g[x],S=new mm;S.curves=M.curves,y.push(S)}return y}function r(g,y){const x=y.length;let _=!1;for(let M=x-1,S=0;S<x;M=S++){let T=y[M],E=y[S],C=E.x-T.x,A=E.y-T.y;if(Math.abs(A)>Number.EPSILON){if(A<0&&(T=y[S],C=-C,E=y[M],A=-A),g.y<T.y||g.y>E.y)continue;if(g.y===T.y){if(g.x===T.x)return!0}else{const D=A*(g.x-T.x)-C*(g.y-T.y);if(D===0)return!0;if(D<0)continue;_=!_}}else{if(g.y!==T.y)continue;if(E.x<=g.x&&g.x<=T.x||T.x<=g.x&&g.x<=E.x)return!0}}return _}const n=su.isClockWise,s=this.subPaths;if(s.length===0)return[];let a,o,l;const c=[];if(s.length===1)return o=s[0],l=new mm,l.curves=o.curves,c.push(l),c;let u=!n(s[0].getPoints());u=t?!u:u;const h=[],d=[];let f=[],p=0,v;d[p]=void 0,f[p]=[];for(let g=0,y=s.length;g<y;g++)o=s[g],v=o.getPoints(),a=n(v),a=t?!a:a,a?(!u&&d[p]&&p++,d[p]={s:new mm,p:v},d[p].s.curves=o.curves,u&&p++,f[p]=[]):f[p].push({h:o,p:v[0]});if(!d[0])return i(s);if(d.length>1){let g=!1,y=0;for(let x=0,_=d.length;x<_;x++)h[x]=[];for(let x=0,_=d.length;x<_;x++){const M=f[x];for(let S=0;S<M.length;S++){const T=M[S];let E=!0;for(let C=0;C<d.length;C++)r(T.p,d[C].p)&&(x!==C&&y++,E?(E=!1,h[C].push(T)):g=!0);E&&h[x].push(T)}}y>0&&g===!1&&(f=h)}let m;for(let g=0,y=d.length;g<y;g++){l=d[g].s,c.push(l),m=f[g];for(let x=0,_=m.length;x<_;x++)l.holes.push(m[x].h)}return c}}class Cje extends pu{constructor(t,i=null){super(),this.object=t,this.domElement=i,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(){}disconnect(){}dispose(){}update(){}}function Pje(e,t){const i=e.image&&e.image.width?e.image.width/e.image.height:1;return i>t?(e.repeat.x=1,e.repeat.y=i/t,e.offset.x=0,e.offset.y=(1-e.repeat.y)/2):(e.repeat.x=t/i,e.repeat.y=1,e.offset.x=(1-e.repeat.x)/2,e.offset.y=0),e}function Dje(e,t){const i=e.image&&e.image.width?e.image.width/e.image.height:1;return i>t?(e.repeat.x=t/i,e.repeat.y=1,e.offset.x=(1-e.repeat.x)/2,e.offset.y=0):(e.repeat.x=1,e.repeat.y=i/t,e.offset.x=0,e.offset.y=(1-e.repeat.y)/2),e}function Rje(e){return e.repeat.x=1,e.repeat.y=1,e.offset.x=0,e.offset.y=0,e}function oF(e,t,i,r){const n=Ije(r);switch(i){case N4:return e*t;case V4:return e*t;case G4:return e*t*2;case nP:return e*t/n.components*n.byteLength;case Wb:return e*t/n.components*n.byteLength;case H4:return e*t*2/n.components*n.byteLength;case sP:return e*t*2/n.components*n.byteLength;case k4:return e*t*3/n.components*n.byteLength;case sa:return e*t*4/n.components*n.byteLength;case aP:return e*t*4/n.components*n.byteLength;case Yx:case Qx:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*8;case Zx:case Kx:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*16;case MT:case AT:return Math.max(e,16)*Math.max(t,8)/4;case ST:case ET:return Math.max(e,8)*Math.max(t,8)/2;case TT:case CT:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*8;case PT:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*16;case DT:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*16;case RT:return Math.floor((e+4)/5)*Math.floor((t+3)/4)*16;case IT:return Math.floor((e+4)/5)*Math.floor((t+4)/5)*16;case LT:return Math.floor((e+5)/6)*Math.floor((t+4)/5)*16;case OT:return Math.floor((e+5)/6)*Math.floor((t+5)/6)*16;case zT:return Math.floor((e+7)/8)*Math.floor((t+4)/5)*16;case BT:return Math.floor((e+7)/8)*Math.floor((t+5)/6)*16;case FT:return Math.floor((e+7)/8)*Math.floor((t+7)/8)*16;case UT:return Math.floor((e+9)/10)*Math.floor((t+4)/5)*16;case NT:return Math.floor((e+9)/10)*Math.floor((t+5)/6)*16;case kT:return Math.floor((e+9)/10)*Math.floor((t+7)/8)*16;case VT:return Math.floor((e+9)/10)*Math.floor((t+9)/10)*16;case GT:return Math.floor((e+11)/12)*Math.floor((t+9)/10)*16;case HT:return Math.floor((e+11)/12)*Math.floor((t+11)/12)*16;case Jx:case jT:case WT:return Math.ceil(e/4)*Math.ceil(t/4)*16;case j4:case XT:return Math.ceil(e/4)*Math.ceil(t/4)*8;case qT:case YT:return Math.ceil(e/4)*Math.ceil(t/4)*16}throw new Error(`Unable to determine texture byte length for ${i} format.`)}function Ije(e){switch(e){case lc:case B4:return{byteLength:1,components:1};case q0:case F4:case _y:return{byteLength:2,components:1};case iP:case rP:return{byteLength:2,components:4};case zh:case tP:case so:return{byteLength:4,components:1};case U4:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${e}.`)}class Lje{static contain(t,i){return Pje(t,i)}static cover(t,i){return Dje(t,i)}static fill(t){return Rje(t)}static getByteLength(t,i,r,n){return oF(t,i,r,n)}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:JC}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=JC);/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */function zse(){let e=null,t=!1,i=null,r=null;function n(s,a){i(s,a),r=e.requestAnimationFrame(n)}return{start:function(){t!==!0&&i!==null&&(r=e.requestAnimationFrame(n),t=!0)},stop:function(){e.cancelAnimationFrame(r),t=!1},setAnimationLoop:function(s){i=s},setContext:function(s){e=s}}}function Oje(e){const t=new WeakMap;function i(o,l){const c=o.array,u=o.usage,h=c.byteLength,d=e.createBuffer();e.bindBuffer(l,d),e.bufferData(l,c,u),o.onUploadCallback();let f;if(c instanceof Float32Array)f=e.FLOAT;else if(c instanceof Uint16Array)o.isFloat16BufferAttribute?f=e.HALF_FLOAT:f=e.UNSIGNED_SHORT;else if(c instanceof Int16Array)f=e.SHORT;else if(c instanceof Uint32Array)f=e.UNSIGNED_INT;else if(c instanceof Int32Array)f=e.INT;else if(c instanceof Int8Array)f=e.BYTE;else if(c instanceof Uint8Array)f=e.UNSIGNED_BYTE;else if(c instanceof Uint8ClampedArray)f=e.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+c);return{buffer:d,type:f,bytesPerElement:c.BYTES_PER_ELEMENT,version:o.version,size:h}}function r(o,l,c){const u=l.array,h=l.updateRanges;if(e.bindBuffer(c,o),h.length===0)e.bufferSubData(c,0,u);else{h.sort((f,p)=>f.start-p.start);let d=0;for(let f=1;f<h.length;f++){const p=h[d],v=h[f];v.start<=p.start+p.count+1?p.count=Math.max(p.count,v.start+v.count-p.start):(++d,h[d]=v)}h.length=d+1;for(let f=0,p=h.length;f<p;f++){const v=h[f];e.bufferSubData(c,v.start*u.BYTES_PER_ELEMENT,u,v.start,v.count)}l.clearUpdateRanges()}l.onUploadCallback()}function n(o){return o.isInterleavedBufferAttribute&&(o=o.data),t.get(o)}function s(o){o.isInterleavedBufferAttribute&&(o=o.data);const l=t.get(o);l&&(e.deleteBuffer(l.buffer),t.delete(o))}function a(o,l){if(o.isInterleavedBufferAttribute&&(o=o.data),o.isGLBufferAttribute){const u=t.get(o);(!u||u.version<o.version)&&t.set(o,{buffer:o.buffer,type:o.type,bytesPerElement:o.elementSize,version:o.version});return}const c=t.get(o);if(c===void 0)t.set(o,i(o,l));else if(c.version<o.version){if(c.size!==o.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");r(c.buffer,o,l),c.version=o.version}}return{get:n,remove:s,update:a}}var zje=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,Bje=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,Fje=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,Uje=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,Nje=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,kje=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,Vje=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,Gje=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,Hje=`#ifdef USE_BATCHING
	#if ! defined( GL_ANGLE_multi_draw )
	#define gl_DrawID _gl_DrawID
	uniform int _gl_DrawID;
	#endif
	uniform highp sampler2D batchingTexture;
	uniform highp usampler2D batchingIdTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
	float getIndirectIndex( const in int i ) {
		int size = textureSize( batchingIdTexture, 0 ).x;
		int x = i % size;
		int y = i / size;
		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,jje=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );
#endif`,Wje=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,Xje=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,qje=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,Yje=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,Qje=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,Zje=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,Kje=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,Jje=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,$je=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,e8e=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,t8e=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,i8e=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,r8e=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );
	vColor.xyz *= batchingColor.xyz;
#endif`,n8e=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,s8e=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,a8e=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,o8e=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,l8e=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,c8e=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE
		emissiveColor = sRGBTransferEOTF( emissiveColor );
	#endif
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,u8e=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,h8e="gl_FragColor = linearToOutputTexel( gl_FragColor );",d8e=`vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferEOTF( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,f8e=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,p8e=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,m8e=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,g8e=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,v8e=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,y8e=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,x8e=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,w8e=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,b8e=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,_8e=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,S8e=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,M8e=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,E8e=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,A8e=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,T8e=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,C8e=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,P8e=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,D8e=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,R8e=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,I8e=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,L8e=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,O8e=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,z8e=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,B8e=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,F8e=`#if defined( USE_LOGDEPTHBUF )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,U8e=`#if defined( USE_LOGDEPTHBUF )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,N8e=`#ifdef USE_LOGDEPTHBUF
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,k8e=`#ifdef USE_LOGDEPTHBUF
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,V8e=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,G8e=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,H8e=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,j8e=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,W8e=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,X8e=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,q8e=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,Y8e=`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,Q8e=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,Z8e=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,K8e=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,J8e=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,$8e=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,eWe=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,tWe=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,iWe=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,rWe=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,nWe=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,sWe=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,aWe=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,oWe=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,lWe=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,cWe=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;
const float Inv255 = 1. / 255.;
const vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );
const vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );
const vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );
const vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );
vec4 packDepthToRGBA( const in float v ) {
	if( v <= 0.0 )
		return vec4( 0., 0., 0., 0. );
	if( v >= 1.0 )
		return vec4( 1., 1., 1., 1. );
	float vuf;
	float af = modf( v * PackFactors.a, vuf );
	float bf = modf( vuf * ShiftRight8, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );
}
vec3 packDepthToRGB( const in float v ) {
	if( v <= 0.0 )
		return vec3( 0., 0., 0. );
	if( v >= 1.0 )
		return vec3( 1., 1., 1. );
	float vuf;
	float bf = modf( v * PackFactors.b, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec3( vuf * Inv255, gf * PackUpscale, bf );
}
vec2 packDepthToRG( const in float v ) {
	if( v <= 0.0 )
		return vec2( 0., 0. );
	if( v >= 1.0 )
		return vec2( 1., 1. );
	float vuf;
	float gf = modf( v * 256., vuf );
	return vec2( vuf * Inv255, gf );
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors4 );
}
float unpackRGBToDepth( const in vec3 v ) {
	return dot( v, UnpackFactors3 );
}
float unpackRGToDepth( const in vec2 v ) {
	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;
}
vec4 pack2HalfToRGBA( const in vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( const in vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,uWe=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,hWe=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,dWe=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,fWe=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,pWe=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,mWe=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,gWe=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
#endif`,vWe=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,yWe=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,xWe=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,wWe=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,bWe=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,_We=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,SWe=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,MWe=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,EWe=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,AWe=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,TWe=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 CineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,CWe=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,PWe=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		#else
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,DWe=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,RWe=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,IWe=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,LWe=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const OWe=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,zWe=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,BWe=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,FWe=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,UWe=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,NWe=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,kWe=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,VWe=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#elif DEPTH_PACKING == 3202
		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );
	#elif DEPTH_PACKING == 3203
		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );
	#endif
}`,GWe=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,HWe=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,jWe=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,WWe=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,XWe=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,qWe=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,YWe=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,QWe=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,ZWe=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,KWe=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,JWe=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,$We=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,e9e=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,t9e=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,i9e=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,r9e=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,n9e=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,s9e=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,a9e=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,o9e=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,l9e=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,c9e=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,u9e=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,h9e=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,d9e=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix[ 3 ];
	vec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,f9e=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,Ai={alphahash_fragment:zje,alphahash_pars_fragment:Bje,alphamap_fragment:Fje,alphamap_pars_fragment:Uje,alphatest_fragment:Nje,alphatest_pars_fragment:kje,aomap_fragment:Vje,aomap_pars_fragment:Gje,batching_pars_vertex:Hje,batching_vertex:jje,begin_vertex:Wje,beginnormal_vertex:Xje,bsdfs:qje,iridescence_fragment:Yje,bumpmap_pars_fragment:Qje,clipping_planes_fragment:Zje,clipping_planes_pars_fragment:Kje,clipping_planes_pars_vertex:Jje,clipping_planes_vertex:$je,color_fragment:e8e,color_pars_fragment:t8e,color_pars_vertex:i8e,color_vertex:r8e,common:n8e,cube_uv_reflection_fragment:s8e,defaultnormal_vertex:a8e,displacementmap_pars_vertex:o8e,displacementmap_vertex:l8e,emissivemap_fragment:c8e,emissivemap_pars_fragment:u8e,colorspace_fragment:h8e,colorspace_pars_fragment:d8e,envmap_fragment:f8e,envmap_common_pars_fragment:p8e,envmap_pars_fragment:m8e,envmap_pars_vertex:g8e,envmap_physical_pars_fragment:T8e,envmap_vertex:v8e,fog_vertex:y8e,fog_pars_vertex:x8e,fog_fragment:w8e,fog_pars_fragment:b8e,gradientmap_pars_fragment:_8e,lightmap_pars_fragment:S8e,lights_lambert_fragment:M8e,lights_lambert_pars_fragment:E8e,lights_pars_begin:A8e,lights_toon_fragment:C8e,lights_toon_pars_fragment:P8e,lights_phong_fragment:D8e,lights_phong_pars_fragment:R8e,lights_physical_fragment:I8e,lights_physical_pars_fragment:L8e,lights_fragment_begin:O8e,lights_fragment_maps:z8e,lights_fragment_end:B8e,logdepthbuf_fragment:F8e,logdepthbuf_pars_fragment:U8e,logdepthbuf_pars_vertex:N8e,logdepthbuf_vertex:k8e,map_fragment:V8e,map_pars_fragment:G8e,map_particle_fragment:H8e,map_particle_pars_fragment:j8e,metalnessmap_fragment:W8e,metalnessmap_pars_fragment:X8e,morphinstance_vertex:q8e,morphcolor_vertex:Y8e,morphnormal_vertex:Q8e,morphtarget_pars_vertex:Z8e,morphtarget_vertex:K8e,normal_fragment_begin:J8e,normal_fragment_maps:$8e,normal_pars_fragment:eWe,normal_pars_vertex:tWe,normal_vertex:iWe,normalmap_pars_fragment:rWe,clearcoat_normal_fragment_begin:nWe,clearcoat_normal_fragment_maps:sWe,clearcoat_pars_fragment:aWe,iridescence_pars_fragment:oWe,opaque_fragment:lWe,packing:cWe,premultiplied_alpha_fragment:uWe,project_vertex:hWe,dithering_fragment:dWe,dithering_pars_fragment:fWe,roughnessmap_fragment:pWe,roughnessmap_pars_fragment:mWe,shadowmap_pars_fragment:gWe,shadowmap_pars_vertex:vWe,shadowmap_vertex:yWe,shadowmask_pars_fragment:xWe,skinbase_vertex:wWe,skinning_pars_vertex:bWe,skinning_vertex:_We,skinnormal_vertex:SWe,specularmap_fragment:MWe,specularmap_pars_fragment:EWe,tonemapping_fragment:AWe,tonemapping_pars_fragment:TWe,transmission_fragment:CWe,transmission_pars_fragment:PWe,uv_pars_fragment:DWe,uv_pars_vertex:RWe,uv_vertex:IWe,worldpos_vertex:LWe,background_vert:OWe,background_frag:zWe,backgroundCube_vert:BWe,backgroundCube_frag:FWe,cube_vert:UWe,cube_frag:NWe,depth_vert:kWe,depth_frag:VWe,distanceRGBA_vert:GWe,distanceRGBA_frag:HWe,equirect_vert:jWe,equirect_frag:WWe,linedashed_vert:XWe,linedashed_frag:qWe,meshbasic_vert:YWe,meshbasic_frag:QWe,meshlambert_vert:ZWe,meshlambert_frag:KWe,meshmatcap_vert:JWe,meshmatcap_frag:$We,meshnormal_vert:e9e,meshnormal_frag:t9e,meshphong_vert:i9e,meshphong_frag:r9e,meshphysical_vert:n9e,meshphysical_frag:s9e,meshtoon_vert:a9e,meshtoon_frag:o9e,points_vert:l9e,points_frag:c9e,shadow_vert:u9e,shadow_frag:h9e,sprite_vert:d9e,sprite_frag:f9e},At={common:{diffuse:{value:new Rt(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new xi},alphaMap:{value:null},alphaMapTransform:{value:new xi},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new xi}},envmap:{envMap:{value:null},envMapRotation:{value:new xi},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new xi}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new xi}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new xi},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new xi},normalScale:{value:new ut(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new xi},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new xi}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new xi}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new xi}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Rt(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Rt(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new xi},alphaTest:{value:0},uvTransform:{value:new xi}},sprite:{diffuse:{value:new Rt(16777215)},opacity:{value:1},center:{value:new ut(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new xi},alphaMap:{value:null},alphaMapTransform:{value:new xi},alphaTest:{value:0}}},Wl={basic:{uniforms:Ma([At.common,At.specularmap,At.envmap,At.aomap,At.lightmap,At.fog]),vertexShader:Ai.meshbasic_vert,fragmentShader:Ai.meshbasic_frag},lambert:{uniforms:Ma([At.common,At.specularmap,At.envmap,At.aomap,At.lightmap,At.emissivemap,At.bumpmap,At.normalmap,At.displacementmap,At.fog,At.lights,{emissive:{value:new Rt(0)}}]),vertexShader:Ai.meshlambert_vert,fragmentShader:Ai.meshlambert_frag},phong:{uniforms:Ma([At.common,At.specularmap,At.envmap,At.aomap,At.lightmap,At.emissivemap,At.bumpmap,At.normalmap,At.displacementmap,At.fog,At.lights,{emissive:{value:new Rt(0)},specular:{value:new Rt(1118481)},shininess:{value:30}}]),vertexShader:Ai.meshphong_vert,fragmentShader:Ai.meshphong_frag},standard:{uniforms:Ma([At.common,At.envmap,At.aomap,At.lightmap,At.emissivemap,At.bumpmap,At.normalmap,At.displacementmap,At.roughnessmap,At.metalnessmap,At.fog,At.lights,{emissive:{value:new Rt(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Ai.meshphysical_vert,fragmentShader:Ai.meshphysical_frag},toon:{uniforms:Ma([At.common,At.aomap,At.lightmap,At.emissivemap,At.bumpmap,At.normalmap,At.displacementmap,At.gradientmap,At.fog,At.lights,{emissive:{value:new Rt(0)}}]),vertexShader:Ai.meshtoon_vert,fragmentShader:Ai.meshtoon_frag},matcap:{uniforms:Ma([At.common,At.bumpmap,At.normalmap,At.displacementmap,At.fog,{matcap:{value:null}}]),vertexShader:Ai.meshmatcap_vert,fragmentShader:Ai.meshmatcap_frag},points:{uniforms:Ma([At.points,At.fog]),vertexShader:Ai.points_vert,fragmentShader:Ai.points_frag},dashed:{uniforms:Ma([At.common,At.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Ai.linedashed_vert,fragmentShader:Ai.linedashed_frag},depth:{uniforms:Ma([At.common,At.displacementmap]),vertexShader:Ai.depth_vert,fragmentShader:Ai.depth_frag},normal:{uniforms:Ma([At.common,At.bumpmap,At.normalmap,At.displacementmap,{opacity:{value:1}}]),vertexShader:Ai.meshnormal_vert,fragmentShader:Ai.meshnormal_frag},sprite:{uniforms:Ma([At.sprite,At.fog]),vertexShader:Ai.sprite_vert,fragmentShader:Ai.sprite_frag},background:{uniforms:{uvTransform:{value:new xi},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Ai.background_vert,fragmentShader:Ai.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new xi}},vertexShader:Ai.backgroundCube_vert,fragmentShader:Ai.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Ai.cube_vert,fragmentShader:Ai.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Ai.equirect_vert,fragmentShader:Ai.equirect_frag},distanceRGBA:{uniforms:Ma([At.common,At.displacementmap,{referencePosition:{value:new he},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Ai.distanceRGBA_vert,fragmentShader:Ai.distanceRGBA_frag},shadow:{uniforms:Ma([At.lights,At.fog,{color:{value:new Rt(0)},opacity:{value:1}}]),vertexShader:Ai.shadow_vert,fragmentShader:Ai.shadow_frag}};Wl.physical={uniforms:Ma([Wl.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new xi},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new xi},clearcoatNormalScale:{value:new ut(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new xi},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new xi},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new xi},sheen:{value:0},sheenColor:{value:new Rt(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new xi},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new xi},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new xi},transmissionSamplerSize:{value:new ut},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new xi},attenuationDistance:{value:0},attenuationColor:{value:new Rt(0)},specularColor:{value:new Rt(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new xi},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new xi},anisotropyVector:{value:new ut},anisotropyMap:{value:null},anisotropyMapTransform:{value:new xi}}]),vertexShader:Ai.meshphysical_vert,fragmentShader:Ai.meshphysical_frag};const TE={r:0,b:0,g:0},gp=new Fo,p9e=new ci;function m9e(e,t,i,r,n,s,a){const o=new Rt(0);let l=s===!0?0:1,c,u,h=null,d=0,f=null;function p(x){let _=x.isScene===!0?x.background:null;return _&&_.isTexture&&(_=(x.backgroundBlurriness>0?i:t).get(_)),_}function v(x){let _=!1;const M=p(x);M===null?g(o,l):M&&M.isColor&&(g(M,1),_=!0);const S=e.xr.getEnvironmentBlendMode();S==="additive"?r.buffers.color.setClear(0,0,0,1,a):S==="alpha-blend"&&r.buffers.color.setClear(0,0,0,0,a),(e.autoClear||_)&&(r.buffers.depth.setTest(!0),r.buffers.depth.setMask(!0),r.buffers.color.setMask(!0),e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil))}function m(x,_){const M=p(_);M&&(M.isCubeTexture||M.mapping===by)?(u===void 0&&(u=new Gr(new Km(1,1,1),new cc({name:"BackgroundCubeMaterial",uniforms:Q0(Wl.backgroundCube.uniforms),vertexShader:Wl.backgroundCube.vertexShader,fragmentShader:Wl.backgroundCube.fragmentShader,side:La,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),u.geometry.deleteAttribute("uv"),u.onBeforeRender=function(S,T,E){this.matrixWorld.copyPosition(E.matrixWorld)},Object.defineProperty(u.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(u)),gp.copy(_.backgroundRotation),gp.x*=-1,gp.y*=-1,gp.z*=-1,M.isCubeTexture&&M.isRenderTargetTexture===!1&&(gp.y*=-1,gp.z*=-1),u.material.uniforms.envMap.value=M,u.material.uniforms.flipEnvMap.value=M.isCubeTexture&&M.isRenderTargetTexture===!1?-1:1,u.material.uniforms.backgroundBlurriness.value=_.backgroundBlurriness,u.material.uniforms.backgroundIntensity.value=_.backgroundIntensity,u.material.uniforms.backgroundRotation.value.setFromMatrix4(p9e.makeRotationFromEuler(gp)),u.material.toneMapped=Xi.getTransfer(M.colorSpace)!==sr,(h!==M||d!==M.version||f!==e.toneMapping)&&(u.material.needsUpdate=!0,h=M,d=M.version,f=e.toneMapping),u.layers.enableAll(),x.unshift(u,u.geometry,u.material,0,0,null)):M&&M.isTexture&&(c===void 0&&(c=new Gr(new Vh(2,2),new cc({name:"BackgroundMaterial",uniforms:Q0(Wl.background.uniforms),vertexShader:Wl.background.vertexShader,fragmentShader:Wl.background.fragmentShader,side:Lh,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),Object.defineProperty(c.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(c)),c.material.uniforms.t2D.value=M,c.material.uniforms.backgroundIntensity.value=_.backgroundIntensity,c.material.toneMapped=Xi.getTransfer(M.colorSpace)!==sr,M.matrixAutoUpdate===!0&&M.updateMatrix(),c.material.uniforms.uvTransform.value.copy(M.matrix),(h!==M||d!==M.version||f!==e.toneMapping)&&(c.material.needsUpdate=!0,h=M,d=M.version,f=e.toneMapping),c.layers.enableAll(),x.unshift(c,c.geometry,c.material,0,0,null))}function g(x,_){x.getRGB(TE,Une(e)),r.buffers.color.setClear(TE.r,TE.g,TE.b,_,a)}function y(){u!==void 0&&(u.geometry.dispose(),u.material.dispose(),u=void 0),c!==void 0&&(c.geometry.dispose(),c.material.dispose(),c=void 0)}return{getClearColor:function(){return o},setClearColor:function(x,_=1){o.set(x),l=_,g(o,l)},getClearAlpha:function(){return l},setClearAlpha:function(x){l=x,g(o,l)},render:v,addToRenderList:m,dispose:y}}function g9e(e,t){const i=e.getParameter(e.MAX_VERTEX_ATTRIBS),r={},n=d(null);let s=n,a=!1;function o(A,D,R,L,O){let H=!1;const j=h(L,R,D);s!==j&&(s=j,c(s.object)),H=f(A,L,R,O),H&&p(A,L,R,O),O!==null&&t.update(O,e.ELEMENT_ARRAY_BUFFER),(H||a)&&(a=!1,_(A,D,R,L),O!==null&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t.get(O).buffer))}function l(){return e.createVertexArray()}function c(A){return e.bindVertexArray(A)}function u(A){return e.deleteVertexArray(A)}function h(A,D,R){const L=R.wireframe===!0;let O=r[A.id];O===void 0&&(O={},r[A.id]=O);let H=O[D.id];H===void 0&&(H={},O[D.id]=H);let j=H[L];return j===void 0&&(j=d(l()),H[L]=j),j}function d(A){const D=[],R=[],L=[];for(let O=0;O<i;O++)D[O]=0,R[O]=0,L[O]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:D,enabledAttributes:R,attributeDivisors:L,object:A,attributes:{},index:null}}function f(A,D,R,L){const O=s.attributes,H=D.attributes;let j=0;const Y=R.getAttributes();for(const z in Y)if(Y[z].location>=0){const U=O[z];let k=H[z];if(k===void 0&&(z==="instanceMatrix"&&A.instanceMatrix&&(k=A.instanceMatrix),z==="instanceColor"&&A.instanceColor&&(k=A.instanceColor)),U===void 0||U.attribute!==k||k&&U.data!==k.data)return!0;j++}return s.attributesNum!==j||s.index!==L}function p(A,D,R,L){const O={},H=D.attributes;let j=0;const Y=R.getAttributes();for(const z in Y)if(Y[z].location>=0){let U=H[z];U===void 0&&(z==="instanceMatrix"&&A.instanceMatrix&&(U=A.instanceMatrix),z==="instanceColor"&&A.instanceColor&&(U=A.instanceColor));const k={};k.attribute=U,U&&U.data&&(k.data=U.data),O[z]=k,j++}s.attributes=O,s.attributesNum=j,s.index=L}function v(){const A=s.newAttributes;for(let D=0,R=A.length;D<R;D++)A[D]=0}function m(A){g(A,0)}function g(A,D){const R=s.newAttributes,L=s.enabledAttributes,O=s.attributeDivisors;R[A]=1,L[A]===0&&(e.enableVertexAttribArray(A),L[A]=1),O[A]!==D&&(e.vertexAttribDivisor(A,D),O[A]=D)}function y(){const A=s.newAttributes,D=s.enabledAttributes;for(let R=0,L=D.length;R<L;R++)D[R]!==A[R]&&(e.disableVertexAttribArray(R),D[R]=0)}function x(A,D,R,L,O,H,j){j===!0?e.vertexAttribIPointer(A,D,R,O,H):e.vertexAttribPointer(A,D,R,L,O,H)}function _(A,D,R,L){v();const O=L.attributes,H=R.getAttributes(),j=D.defaultAttributeValues;for(const Y in H){const z=H[Y];if(z.location>=0){let V=O[Y];if(V===void 0&&(Y==="instanceMatrix"&&A.instanceMatrix&&(V=A.instanceMatrix),Y==="instanceColor"&&A.instanceColor&&(V=A.instanceColor)),V!==void 0){const U=V.normalized,k=V.itemSize,X=t.get(V);if(X===void 0)continue;const re=X.buffer,q=X.type,ee=X.bytesPerElement,$=q===e.INT||q===e.UNSIGNED_INT||V.gpuType===tP;if(V.isInterleavedBufferAttribute){const ne=V.data,ce=ne.stride,pe=V.offset;if(ne.isInstancedInterleavedBuffer){for(let ge=0;ge<z.locationSize;ge++)g(z.location+ge,ne.meshPerAttribute);A.isInstancedMesh!==!0&&L._maxInstanceCount===void 0&&(L._maxInstanceCount=ne.meshPerAttribute*ne.count)}else for(let ge=0;ge<z.locationSize;ge++)m(z.location+ge);e.bindBuffer(e.ARRAY_BUFFER,re);for(let ge=0;ge<z.locationSize;ge++)x(z.location+ge,k/z.locationSize,q,U,ce*ee,(pe+k/z.locationSize*ge)*ee,$)}else{if(V.isInstancedBufferAttribute){for(let ne=0;ne<z.locationSize;ne++)g(z.location+ne,V.meshPerAttribute);A.isInstancedMesh!==!0&&L._maxInstanceCount===void 0&&(L._maxInstanceCount=V.meshPerAttribute*V.count)}else for(let ne=0;ne<z.locationSize;ne++)m(z.location+ne);e.bindBuffer(e.ARRAY_BUFFER,re);for(let ne=0;ne<z.locationSize;ne++)x(z.location+ne,k/z.locationSize,q,U,k*ee,k/z.locationSize*ne*ee,$)}}else if(j!==void 0){const U=j[Y];if(U!==void 0)switch(U.length){case 2:e.vertexAttrib2fv(z.location,U);break;case 3:e.vertexAttrib3fv(z.location,U);break;case 4:e.vertexAttrib4fv(z.location,U);break;default:e.vertexAttrib1fv(z.location,U)}}}}y()}function M(){E();for(const A in r){const D=r[A];for(const R in D){const L=D[R];for(const O in L)u(L[O].object),delete L[O];delete D[R]}delete r[A]}}function S(A){if(r[A.id]===void 0)return;const D=r[A.id];for(const R in D){const L=D[R];for(const O in L)u(L[O].object),delete L[O];delete D[R]}delete r[A.id]}function T(A){for(const D in r){const R=r[D];if(R[A.id]===void 0)continue;const L=R[A.id];for(const O in L)u(L[O].object),delete L[O];delete R[A.id]}}function E(){C(),a=!0,s!==n&&(s=n,c(s.object))}function C(){n.geometry=null,n.program=null,n.wireframe=!1}return{setup:o,reset:E,resetDefaultState:C,dispose:M,releaseStatesOfGeometry:S,releaseStatesOfProgram:T,initAttributes:v,enableAttribute:m,disableUnusedAttributes:y}}function v9e(e,t,i){let r;function n(c){r=c}function s(c,u){e.drawArrays(r,c,u),i.update(u,r,1)}function a(c,u,h){h!==0&&(e.drawArraysInstanced(r,c,u,h),i.update(u,r,h))}function o(c,u,h){if(h===0)return;t.get("WEBGL_multi_draw").multiDrawArraysWEBGL(r,c,0,u,0,h);let f=0;for(let p=0;p<h;p++)f+=u[p];i.update(f,r,1)}function l(c,u,h,d){if(h===0)return;const f=t.get("WEBGL_multi_draw");if(f===null)for(let p=0;p<c.length;p++)a(c[p],u[p],d[p]);else{f.multiDrawArraysInstancedWEBGL(r,c,0,u,0,d,0,h);let p=0;for(let v=0;v<h;v++)p+=u[v]*d[v];i.update(p,r,1)}}this.setMode=n,this.render=s,this.renderInstances=a,this.renderMultiDraw=o,this.renderMultiDrawInstances=l}function y9e(e,t,i,r){let n;function s(){if(n!==void 0)return n;if(t.has("EXT_texture_filter_anisotropic")===!0){const T=t.get("EXT_texture_filter_anisotropic");n=e.getParameter(T.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else n=0;return n}function a(T){return!(T!==sa&&r.convert(T)!==e.getParameter(e.IMPLEMENTATION_COLOR_READ_FORMAT))}function o(T){const E=T===_y&&(t.has("EXT_color_buffer_half_float")||t.has("EXT_color_buffer_float"));return!(T!==lc&&r.convert(T)!==e.getParameter(e.IMPLEMENTATION_COLOR_READ_TYPE)&&T!==so&&!E)}function l(T){if(T==="highp"){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0)return"highp";T="mediump"}return T==="mediump"&&e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let c=i.precision!==void 0?i.precision:"highp";const u=l(c);u!==c&&(console.warn("THREE.WebGLRenderer:",c,"not supported, using",u,"instead."),c=u);const h=i.logarithmicDepthBuffer===!0,d=i.reverseDepthBuffer===!0&&t.has("EXT_clip_control"),f=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),p=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),v=e.getParameter(e.MAX_TEXTURE_SIZE),m=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),g=e.getParameter(e.MAX_VERTEX_ATTRIBS),y=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),x=e.getParameter(e.MAX_VARYING_VECTORS),_=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),M=p>0,S=e.getParameter(e.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:s,getMaxPrecision:l,textureFormatReadable:a,textureTypeReadable:o,precision:c,logarithmicDepthBuffer:h,reverseDepthBuffer:d,maxTextures:f,maxVertexTextures:p,maxTextureSize:v,maxCubemapSize:m,maxAttributes:g,maxVertexUniforms:y,maxVaryings:x,maxFragmentUniforms:_,vertexTextures:M,maxSamples:S}}function x9e(e){const t=this;let i=null,r=0,n=!1,s=!1;const a=new eh,o=new xi,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(h,d){const f=h.length!==0||d||r!==0||n;return n=d,r=h.length,f},this.beginShadows=function(){s=!0,u(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(h,d){i=u(h,d,0)},this.setState=function(h,d,f){const p=h.clippingPlanes,v=h.clipIntersection,m=h.clipShadows,g=e.get(h);if(!n||p===null||p.length===0||s&&!m)s?u(null):c();else{const y=s?0:r,x=y*4;let _=g.clippingState||null;l.value=_,_=u(p,d,x,f);for(let M=0;M!==x;++M)_[M]=i[M];g.clippingState=_,this.numIntersection=v?this.numPlanes:0,this.numPlanes+=y}};function c(){l.value!==i&&(l.value=i,l.needsUpdate=r>0),t.numPlanes=r,t.numIntersection=0}function u(h,d,f,p){const v=h!==null?h.length:0;let m=null;if(v!==0){if(m=l.value,p!==!0||m===null){const g=f+v*4,y=d.matrixWorldInverse;o.getNormalMatrix(y),(m===null||m.length<g)&&(m=new Float32Array(g));for(let x=0,_=f;x!==v;++x,_+=4)a.copy(h[x]).applyMatrix4(y,o),a.normal.toArray(m,_),m[_+3]=a.constant}l.value=m,l.needsUpdate=!0}return t.numPlanes=v,t.numIntersection=0,m}}function w9e(e){let t=new WeakMap;function i(a,o){return o===Jw?a.mapping=Oh:o===$w&&(a.mapping=wf),a}function r(a){if(a&&a.isTexture){const o=a.mapping;if(o===Jw||o===$w)if(t.has(a)){const l=t.get(a).texture;return i(l,a.mapping)}else{const l=a.image;if(l&&l.height>0){const c=new kne(l.height);return c.fromEquirectangularTexture(e,a),t.set(a,c),a.addEventListener("dispose",n),i(c.texture,a.mapping)}else return null}}return a}function n(a){const o=a.target;o.removeEventListener("dispose",n);const l=t.get(o);l!==void 0&&(t.delete(o),l.dispose())}function s(){t=new WeakMap}return{get:r,dispose:s}}const $v=4,mq=[.125,.215,.35,.446,.526,.582],Np=20,lL=new hf,gq=new Rt;let cL=null,uL=0,hL=0,dL=!1;const Ip=(1+Math.sqrt(5))/2,hv=1/Ip,vq=[new he(-Ip,hv,0),new he(Ip,hv,0),new he(-hv,0,Ip),new he(hv,0,Ip),new he(0,Ip,-hv),new he(0,Ip,hv),new he(-1,1,-1),new he(1,1,-1),new he(-1,1,1),new he(1,1,1)],b9e=new he;class lF{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(t,i=0,r=.1,n=100,s={}){const{size:a=256,position:o=b9e}=s;cL=this._renderer.getRenderTarget(),uL=this._renderer.getActiveCubeFace(),hL=this._renderer.getActiveMipmapLevel(),dL=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(a);const l=this._allocateTargets();return l.depthBuffer=!0,this._sceneToCubeUV(t,r,n,l,o),i>0&&this._blur(l,0,0,i),this._applyPMREM(l),this._cleanup(l),l}fromEquirectangular(t,i=null){return this._fromTexture(t,i)}fromCubemap(t,i=null){return this._fromTexture(t,i)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=wq(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=xq(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(t){this._lodMax=Math.floor(Math.log2(t)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let t=0;t<this._lodPlanes.length;t++)this._lodPlanes[t].dispose()}_cleanup(t){this._renderer.setRenderTarget(cL,uL,hL),this._renderer.xr.enabled=dL,t.scissorTest=!1,CE(t,0,0,t.width,t.height)}_fromTexture(t,i){t.mapping===Oh||t.mapping===wf?this._setSize(t.image.length===0?16:t.image[0].width||t.image[0].image.width):this._setSize(t.image.width/4),cL=this._renderer.getRenderTarget(),uL=this._renderer.getActiveCubeFace(),hL=this._renderer.getActiveMipmapLevel(),dL=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const r=i||this._allocateTargets();return this._textureToCubeUV(t,r),this._applyPMREM(r),this._cleanup(r),r}_allocateTargets(){const t=3*Math.max(this._cubeSize,112),i=4*this._cubeSize,r={magFilter:pn,minFilter:pn,generateMipmaps:!1,type:_y,format:sa,colorSpace:zm,depthBuffer:!1},n=yq(t,i,r);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==t||this._pingPongRenderTarget.height!==i){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=yq(t,i,r);const{_lodMax:s}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=_9e(s)),this._blurMaterial=S9e(s,t,i)}return n}_compileMaterial(t){const i=new Gr(this._lodPlanes[0],t);this._renderer.compile(i,lL)}_sceneToCubeUV(t,i,r,n,s){const l=new fn(90,1,i,r),c=[1,-1,1,1,1,1],u=[1,1,1,-1,-1,-1],h=this._renderer,d=h.autoClear,f=h.toneMapping;h.getClearColor(gq),h.toneMapping=ru,h.autoClear=!1;const p=new kh({name:"PMREM.Background",side:La,depthWrite:!1,depthTest:!1}),v=new Gr(new Km,p);let m=!1;const g=t.background;g?g.isColor&&(p.color.copy(g),t.background=null,m=!0):(p.color.copy(gq),m=!0);for(let y=0;y<6;y++){const x=y%3;x===0?(l.up.set(0,c[y],0),l.position.set(s.x,s.y,s.z),l.lookAt(s.x+u[y],s.y,s.z)):x===1?(l.up.set(0,0,c[y]),l.position.set(s.x,s.y,s.z),l.lookAt(s.x,s.y+u[y],s.z)):(l.up.set(0,c[y],0),l.position.set(s.x,s.y,s.z),l.lookAt(s.x,s.y,s.z+u[y]));const _=this._cubeSize;CE(n,x*_,y>2?_:0,_,_),h.setRenderTarget(n),m&&h.render(v,l),h.render(t,l)}v.geometry.dispose(),v.material.dispose(),h.toneMapping=f,h.autoClear=d,t.background=g}_textureToCubeUV(t,i){const r=this._renderer,n=t.mapping===Oh||t.mapping===wf;n?(this._cubemapMaterial===null&&(this._cubemapMaterial=wq()),this._cubemapMaterial.uniforms.flipEnvMap.value=t.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=xq());const s=n?this._cubemapMaterial:this._equirectMaterial,a=new Gr(this._lodPlanes[0],s),o=s.uniforms;o.envMap.value=t;const l=this._cubeSize;CE(i,0,0,3*l,2*l),r.setRenderTarget(i),r.render(a,lL)}_applyPMREM(t){const i=this._renderer,r=i.autoClear;i.autoClear=!1;const n=this._lodPlanes.length;for(let s=1;s<n;s++){const a=Math.sqrt(this._sigmas[s]*this._sigmas[s]-this._sigmas[s-1]*this._sigmas[s-1]),o=vq[(n-s-1)%vq.length];this._blur(t,s-1,s,a,o)}i.autoClear=r}_blur(t,i,r,n,s){const a=this._pingPongRenderTarget;this._halfBlur(t,a,i,r,n,"latitudinal",s),this._halfBlur(a,t,r,r,n,"longitudinal",s)}_halfBlur(t,i,r,n,s,a,o){const l=this._renderer,c=this._blurMaterial;a!=="latitudinal"&&a!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const u=3,h=new Gr(this._lodPlanes[n],c),d=c.uniforms,f=this._sizeLods[r]-1,p=isFinite(s)?Math.PI/(2*f):2*Math.PI/(2*Np-1),v=s/p,m=isFinite(s)?1+Math.floor(u*v):Np;m>Np&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${m} samples when the maximum is set to ${Np}`);const g=[];let y=0;for(let T=0;T<Np;++T){const E=T/v,C=Math.exp(-E*E/2);g.push(C),T===0?y+=C:T<m&&(y+=2*C)}for(let T=0;T<g.length;T++)g[T]=g[T]/y;d.envMap.value=t.texture,d.samples.value=m,d.weights.value=g,d.latitudinal.value=a==="latitudinal",o&&(d.poleAxis.value=o);const{_lodMax:x}=this;d.dTheta.value=p,d.mipInt.value=x-r;const _=this._sizeLods[n],M=3*_*(n>x-$v?n-x+$v:0),S=4*(this._cubeSize-_);CE(i,M,S,3*_,2*_),l.setRenderTarget(i),l.render(h,lL)}}function _9e(e){const t=[],i=[],r=[];let n=e;const s=e-$v+1+mq.length;for(let a=0;a<s;a++){const o=Math.pow(2,n);i.push(o);let l=1/o;a>e-$v?l=mq[a-e+$v-1]:a===0&&(l=0),r.push(l);const c=1/(o-2),u=-c,h=1+c,d=[u,u,h,u,h,h,u,u,h,h,u,h],f=6,p=6,v=3,m=2,g=1,y=new Float32Array(v*p*f),x=new Float32Array(m*p*f),_=new Float32Array(g*p*f);for(let S=0;S<f;S++){const T=S%3*2/3-1,E=S>2?0:-1,C=[T,E,0,T+2/3,E,0,T+2/3,E+1,0,T,E,0,T+2/3,E+1,0,T,E+1,0];y.set(C,v*p*S),x.set(d,m*p*S);const A=[S,S,S,S,S,S];_.set(A,g*p*S)}const M=new Pi;M.setAttribute("position",new mr(y,v)),M.setAttribute("uv",new mr(x,m)),M.setAttribute("faceIndex",new mr(_,g)),t.push(M),n>$v&&n--}return{lodPlanes:t,sizeLods:i,sigmas:r}}function yq(e,t,i){const r=new uu(e,t,i);return r.texture.mapping=by,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function CE(e,t,i,r,n){e.viewport.set(t,i,r,n),e.scissor.set(t,i,r,n)}function S9e(e,t,i){const r=new Float32Array(Np),n=new he(0,1,0);return new cc({name:"SphericalGaussianBlur",defines:{n:Np,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/i,CUBEUV_MAX_MIP:`${e}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:n}},vertexShader:Sk(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:wh,depthTest:!1,depthWrite:!1})}function xq(){return new cc({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:Sk(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:wh,depthTest:!1,depthWrite:!1})}function wq(){return new cc({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:Sk(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:wh,depthTest:!1,depthWrite:!1})}function Sk(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function M9e(e){let t=new WeakMap,i=null;function r(o){if(o&&o.isTexture){const l=o.mapping,c=l===Jw||l===$w,u=l===Oh||l===wf;if(c||u){let h=t.get(o);const d=h!==void 0?h.texture.pmremVersion:0;if(o.isRenderTargetTexture&&o.pmremVersion!==d)return i===null&&(i=new lF(e)),h=c?i.fromEquirectangular(o,h):i.fromCubemap(o,h),h.texture.pmremVersion=o.pmremVersion,t.set(o,h),h.texture;if(h!==void 0)return h.texture;{const f=o.image;return c&&f&&f.height>0||u&&f&&n(f)?(i===null&&(i=new lF(e)),h=c?i.fromEquirectangular(o):i.fromCubemap(o),h.texture.pmremVersion=o.pmremVersion,t.set(o,h),o.addEventListener("dispose",s),h.texture):null}}}return o}function n(o){let l=0;const c=6;for(let u=0;u<c;u++)o[u]!==void 0&&l++;return l===c}function s(o){const l=o.target;l.removeEventListener("dispose",s);const c=t.get(l);c!==void 0&&(t.delete(l),c.dispose())}function a(){t=new WeakMap,i!==null&&(i.dispose(),i=null)}return{get:r,dispose:a}}function E9e(e){const t={};function i(r){if(t[r]!==void 0)return t[r];let n;switch(r){case"WEBGL_depth_texture":n=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=e.getExtension(r)}return t[r]=n,n}return{has:function(r){return i(r)!==null},init:function(){i("EXT_color_buffer_float"),i("WEBGL_clip_cull_distance"),i("OES_texture_float_linear"),i("EXT_color_buffer_half_float"),i("WEBGL_multisampled_render_to_texture"),i("WEBGL_render_shared_exponent")},get:function(r){const n=i(r);return n===null&&Rp("THREE.WebGLRenderer: "+r+" extension not supported."),n}}}function A9e(e,t,i,r){const n={},s=new WeakMap;function a(h){const d=h.target;d.index!==null&&t.remove(d.index);for(const p in d.attributes)t.remove(d.attributes[p]);d.removeEventListener("dispose",a),delete n[d.id];const f=s.get(d);f&&(t.remove(f),s.delete(d)),r.releaseStatesOfGeometry(d),d.isInstancedBufferGeometry===!0&&delete d._maxInstanceCount,i.memory.geometries--}function o(h,d){return n[d.id]===!0||(d.addEventListener("dispose",a),n[d.id]=!0,i.memory.geometries++),d}function l(h){const d=h.attributes;for(const f in d)t.update(d[f],e.ARRAY_BUFFER)}function c(h){const d=[],f=h.index,p=h.attributes.position;let v=0;if(f!==null){const y=f.array;v=f.version;for(let x=0,_=y.length;x<_;x+=3){const M=y[x+0],S=y[x+1],T=y[x+2];d.push(M,S,S,T,T,M)}}else if(p!==void 0){const y=p.array;v=p.version;for(let x=0,_=y.length/3-1;x<_;x+=3){const M=x+0,S=x+1,T=x+2;d.push(M,S,S,T,T,M)}}else return;const m=new(One(d)?Z4:Q4)(d,1);m.version=v;const g=s.get(h);g&&t.remove(g),s.set(h,m)}function u(h){const d=s.get(h);if(d){const f=h.index;f!==null&&d.version<f.version&&c(h)}else c(h);return s.get(h)}return{get:o,update:l,getWireframeAttribute:u}}function T9e(e,t,i){let r;function n(d){r=d}let s,a;function o(d){s=d.type,a=d.bytesPerElement}function l(d,f){e.drawElements(r,f,s,d*a),i.update(f,r,1)}function c(d,f,p){p!==0&&(e.drawElementsInstanced(r,f,s,d*a,p),i.update(f,r,p))}function u(d,f,p){if(p===0)return;t.get("WEBGL_multi_draw").multiDrawElementsWEBGL(r,f,0,s,d,0,p);let m=0;for(let g=0;g<p;g++)m+=f[g];i.update(m,r,1)}function h(d,f,p,v){if(p===0)return;const m=t.get("WEBGL_multi_draw");if(m===null)for(let g=0;g<d.length;g++)c(d[g]/a,f[g],v[g]);else{m.multiDrawElementsInstancedWEBGL(r,f,0,s,d,0,v,0,p);let g=0;for(let y=0;y<p;y++)g+=f[y]*v[y];i.update(g,r,1)}}this.setMode=n,this.setIndex=o,this.render=l,this.renderInstances=c,this.renderMultiDraw=u,this.renderMultiDrawInstances=h}function C9e(e){const t={geometries:0,textures:0},i={frame:0,calls:0,triangles:0,points:0,lines:0};function r(s,a,o){switch(i.calls++,a){case e.TRIANGLES:i.triangles+=o*(s/3);break;case e.LINES:i.lines+=o*(s/2);break;case e.LINE_STRIP:i.lines+=o*(s-1);break;case e.LINE_LOOP:i.lines+=o*s;break;case e.POINTS:i.points+=o*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",a);break}}function n(){i.calls=0,i.triangles=0,i.points=0,i.lines=0}return{memory:t,render:i,programs:null,autoReset:!0,reset:n,update:r}}function P9e(e,t,i){const r=new WeakMap,n=new Hi;function s(a,o,l){const c=a.morphTargetInfluences,u=o.morphAttributes.position||o.morphAttributes.normal||o.morphAttributes.color,h=u!==void 0?u.length:0;let d=r.get(o);if(d===void 0||d.count!==h){let C=function(){T.dispose(),r.delete(o),o.removeEventListener("dispose",C)};d!==void 0&&d.texture.dispose();const f=o.morphAttributes.position!==void 0,p=o.morphAttributes.normal!==void 0,v=o.morphAttributes.color!==void 0,m=o.morphAttributes.position||[],g=o.morphAttributes.normal||[],y=o.morphAttributes.color||[];let x=0;f===!0&&(x=1),p===!0&&(x=2),v===!0&&(x=3);let _=o.attributes.position.count*x,M=1;_>t.maxTextureSize&&(M=Math.ceil(_/t.maxTextureSize),_=t.maxTextureSize);const S=new Float32Array(_*M*4*h),T=new Xb(S,_,M,h);T.type=so,T.needsUpdate=!0;const E=x*4;for(let A=0;A<h;A++){const D=m[A],R=g[A],L=y[A],O=_*M*4*A;for(let H=0;H<D.count;H++){const j=H*E;f===!0&&(n.fromBufferAttribute(D,H),S[O+j+0]=n.x,S[O+j+1]=n.y,S[O+j+2]=n.z,S[O+j+3]=0),p===!0&&(n.fromBufferAttribute(R,H),S[O+j+4]=n.x,S[O+j+5]=n.y,S[O+j+6]=n.z,S[O+j+7]=0),v===!0&&(n.fromBufferAttribute(L,H),S[O+j+8]=n.x,S[O+j+9]=n.y,S[O+j+10]=n.z,S[O+j+11]=L.itemSize===4?n.w:1)}}d={count:h,texture:T,size:new ut(_,M)},r.set(o,d),o.addEventListener("dispose",C)}if(a.isInstancedMesh===!0&&a.morphTexture!==null)l.getUniforms().setValue(e,"morphTexture",a.morphTexture,i);else{let f=0;for(let v=0;v<c.length;v++)f+=c[v];const p=o.morphTargetsRelative?1:1-f;l.getUniforms().setValue(e,"morphTargetBaseInfluence",p),l.getUniforms().setValue(e,"morphTargetInfluences",c)}l.getUniforms().setValue(e,"morphTargetsTexture",d.texture,i),l.getUniforms().setValue(e,"morphTargetsTextureSize",d.size)}return{update:s}}function D9e(e,t,i,r){let n=new WeakMap;function s(l){const c=r.render.frame,u=l.geometry,h=t.get(l,u);if(n.get(h)!==c&&(t.update(h),n.set(h,c)),l.isInstancedMesh&&(l.hasEventListener("dispose",o)===!1&&l.addEventListener("dispose",o),n.get(l)!==c&&(i.update(l.instanceMatrix,e.ARRAY_BUFFER),l.instanceColor!==null&&i.update(l.instanceColor,e.ARRAY_BUFFER),n.set(l,c))),l.isSkinnedMesh){const d=l.skeleton;n.get(d)!==c&&(d.update(),n.set(d,c))}return h}function a(){n=new WeakMap}function o(l){const c=l.target;c.removeEventListener("dispose",o),i.remove(c.instanceMatrix),c.instanceColor!==null&&i.remove(c.instanceColor)}return{update:s,dispose:a}}const Bse=new Wr,bq=new ik(1,1),Fse=new Xb,Use=new cP,Nse=new Yb,_q=[],Sq=[],Mq=new Float32Array(16),Eq=new Float32Array(9),Aq=new Float32Array(4);function My(e,t,i){const r=e[0];if(r<=0||r>0)return e;const n=t*i;let s=_q[n];if(s===void 0&&(s=new Float32Array(n),_q[n]=s),t!==0){r.toArray(s,0);for(let a=1,o=0;a!==t;++a)o+=i,e[a].toArray(s,o)}return s}function Jn(e,t){if(e.length!==t.length)return!1;for(let i=0,r=e.length;i<r;i++)if(e[i]!==t[i])return!1;return!0}function $n(e,t){for(let i=0,r=t.length;i<r;i++)e[i]=t[i]}function IP(e,t){let i=Sq[t];i===void 0&&(i=new Int32Array(t),Sq[t]=i);for(let r=0;r!==t;++r)i[r]=e.allocateTextureUnit();return i}function R9e(e,t){const i=this.cache;i[0]!==t&&(e.uniform1f(this.addr,t),i[0]=t)}function I9e(e,t){const i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y)&&(e.uniform2f(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(Jn(i,t))return;e.uniform2fv(this.addr,t),$n(i,t)}}function L9e(e,t){const i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z)&&(e.uniform3f(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else if(t.r!==void 0)(i[0]!==t.r||i[1]!==t.g||i[2]!==t.b)&&(e.uniform3f(this.addr,t.r,t.g,t.b),i[0]=t.r,i[1]=t.g,i[2]=t.b);else{if(Jn(i,t))return;e.uniform3fv(this.addr,t),$n(i,t)}}function O9e(e,t){const i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z||i[3]!==t.w)&&(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(Jn(i,t))return;e.uniform4fv(this.addr,t),$n(i,t)}}function z9e(e,t){const i=this.cache,r=t.elements;if(r===void 0){if(Jn(i,t))return;e.uniformMatrix2fv(this.addr,!1,t),$n(i,t)}else{if(Jn(i,r))return;Aq.set(r),e.uniformMatrix2fv(this.addr,!1,Aq),$n(i,r)}}function B9e(e,t){const i=this.cache,r=t.elements;if(r===void 0){if(Jn(i,t))return;e.uniformMatrix3fv(this.addr,!1,t),$n(i,t)}else{if(Jn(i,r))return;Eq.set(r),e.uniformMatrix3fv(this.addr,!1,Eq),$n(i,r)}}function F9e(e,t){const i=this.cache,r=t.elements;if(r===void 0){if(Jn(i,t))return;e.uniformMatrix4fv(this.addr,!1,t),$n(i,t)}else{if(Jn(i,r))return;Mq.set(r),e.uniformMatrix4fv(this.addr,!1,Mq),$n(i,r)}}function U9e(e,t){const i=this.cache;i[0]!==t&&(e.uniform1i(this.addr,t),i[0]=t)}function N9e(e,t){const i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y)&&(e.uniform2i(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(Jn(i,t))return;e.uniform2iv(this.addr,t),$n(i,t)}}function k9e(e,t){const i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z)&&(e.uniform3i(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else{if(Jn(i,t))return;e.uniform3iv(this.addr,t),$n(i,t)}}function V9e(e,t){const i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z||i[3]!==t.w)&&(e.uniform4i(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(Jn(i,t))return;e.uniform4iv(this.addr,t),$n(i,t)}}function G9e(e,t){const i=this.cache;i[0]!==t&&(e.uniform1ui(this.addr,t),i[0]=t)}function H9e(e,t){const i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y)&&(e.uniform2ui(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(Jn(i,t))return;e.uniform2uiv(this.addr,t),$n(i,t)}}function j9e(e,t){const i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z)&&(e.uniform3ui(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else{if(Jn(i,t))return;e.uniform3uiv(this.addr,t),$n(i,t)}}function W9e(e,t){const i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z||i[3]!==t.w)&&(e.uniform4ui(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(Jn(i,t))return;e.uniform4uiv(this.addr,t),$n(i,t)}}function X9e(e,t,i){const r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n);let s;this.type===e.SAMPLER_2D_SHADOW?(bq.compareFunction=q4,s=bq):s=Bse,i.setTexture2D(t||s,n)}function q9e(e,t,i){const r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.setTexture3D(t||Use,n)}function Y9e(e,t,i){const r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.setTextureCube(t||Nse,n)}function Q9e(e,t,i){const r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.setTexture2DArray(t||Fse,n)}function Z9e(e){switch(e){case 5126:return R9e;case 35664:return I9e;case 35665:return L9e;case 35666:return O9e;case 35674:return z9e;case 35675:return B9e;case 35676:return F9e;case 5124:case 35670:return U9e;case 35667:case 35671:return N9e;case 35668:case 35672:return k9e;case 35669:case 35673:return V9e;case 5125:return G9e;case 36294:return H9e;case 36295:return j9e;case 36296:return W9e;case 35678:case 36198:case 36298:case 36306:case 35682:return X9e;case 35679:case 36299:case 36307:return q9e;case 35680:case 36300:case 36308:case 36293:return Y9e;case 36289:case 36303:case 36311:case 36292:return Q9e}}function K9e(e,t){e.uniform1fv(this.addr,t)}function J9e(e,t){const i=My(t,this.size,2);e.uniform2fv(this.addr,i)}function $9e(e,t){const i=My(t,this.size,3);e.uniform3fv(this.addr,i)}function e7e(e,t){const i=My(t,this.size,4);e.uniform4fv(this.addr,i)}function t7e(e,t){const i=My(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,i)}function i7e(e,t){const i=My(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,i)}function r7e(e,t){const i=My(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,i)}function n7e(e,t){e.uniform1iv(this.addr,t)}function s7e(e,t){e.uniform2iv(this.addr,t)}function a7e(e,t){e.uniform3iv(this.addr,t)}function o7e(e,t){e.uniform4iv(this.addr,t)}function l7e(e,t){e.uniform1uiv(this.addr,t)}function c7e(e,t){e.uniform2uiv(this.addr,t)}function u7e(e,t){e.uniform3uiv(this.addr,t)}function h7e(e,t){e.uniform4uiv(this.addr,t)}function d7e(e,t,i){const r=this.cache,n=t.length,s=IP(i,n);Jn(r,s)||(e.uniform1iv(this.addr,s),$n(r,s));for(let a=0;a!==n;++a)i.setTexture2D(t[a]||Bse,s[a])}function f7e(e,t,i){const r=this.cache,n=t.length,s=IP(i,n);Jn(r,s)||(e.uniform1iv(this.addr,s),$n(r,s));for(let a=0;a!==n;++a)i.setTexture3D(t[a]||Use,s[a])}function p7e(e,t,i){const r=this.cache,n=t.length,s=IP(i,n);Jn(r,s)||(e.uniform1iv(this.addr,s),$n(r,s));for(let a=0;a!==n;++a)i.setTextureCube(t[a]||Nse,s[a])}function m7e(e,t,i){const r=this.cache,n=t.length,s=IP(i,n);Jn(r,s)||(e.uniform1iv(this.addr,s),$n(r,s));for(let a=0;a!==n;++a)i.setTexture2DArray(t[a]||Fse,s[a])}function g7e(e){switch(e){case 5126:return K9e;case 35664:return J9e;case 35665:return $9e;case 35666:return e7e;case 35674:return t7e;case 35675:return i7e;case 35676:return r7e;case 5124:case 35670:return n7e;case 35667:case 35671:return s7e;case 35668:case 35672:return a7e;case 35669:case 35673:return o7e;case 5125:return l7e;case 36294:return c7e;case 36295:return u7e;case 36296:return h7e;case 35678:case 36198:case 36298:case 36306:case 35682:return d7e;case 35679:case 36299:case 36307:return f7e;case 35680:case 36300:case 36308:case 36293:return p7e;case 36289:case 36303:case 36311:case 36292:return m7e}}class v7e{constructor(t,i,r){this.id=t,this.addr=r,this.cache=[],this.type=i.type,this.setValue=Z9e(i.type)}}class y7e{constructor(t,i,r){this.id=t,this.addr=r,this.cache=[],this.type=i.type,this.size=i.size,this.setValue=g7e(i.type)}}class x7e{constructor(t){this.id=t,this.seq=[],this.map={}}setValue(t,i,r){const n=this.seq;for(let s=0,a=n.length;s!==a;++s){const o=n[s];o.setValue(t,i[o.id],r)}}}const fL=/(\w+)(\])?(\[|\.)?/g;function Tq(e,t){e.seq.push(t),e.map[t.id]=t}function w7e(e,t,i){const r=e.name,n=r.length;for(fL.lastIndex=0;;){const s=fL.exec(r),a=fL.lastIndex;let o=s[1];const l=s[2]==="]",c=s[3];if(l&&(o=o|0),c===void 0||c==="["&&a+2===n){Tq(i,c===void 0?new v7e(o,e,t):new y7e(o,e,t));break}else{let h=i.map[o];h===void 0&&(h=new x7e(o),Tq(i,h)),i=h}}}class x2{constructor(t,i){this.seq=[],this.map={};const r=t.getProgramParameter(i,t.ACTIVE_UNIFORMS);for(let n=0;n<r;++n){const s=t.getActiveUniform(i,n),a=t.getUniformLocation(i,s.name);w7e(s,a,this)}}setValue(t,i,r,n){const s=this.map[i];s!==void 0&&s.setValue(t,r,n)}setOptional(t,i,r){const n=i[r];n!==void 0&&this.setValue(t,r,n)}static upload(t,i,r,n){for(let s=0,a=i.length;s!==a;++s){const o=i[s],l=r[o.id];l.needsUpdate!==!1&&o.setValue(t,l.value,n)}}static seqWithValue(t,i){const r=[];for(let n=0,s=t.length;n!==s;++n){const a=t[n];a.id in i&&r.push(a)}return r}}function Cq(e,t,i){const r=e.createShader(t);return e.shaderSource(r,i),e.compileShader(r),r}const b7e=37297;let _7e=0;function S7e(e,t){const i=e.split(`
`),r=[],n=Math.max(t-6,0),s=Math.min(t+6,i.length);for(let a=n;a<s;a++){const o=a+1;r.push(`${o===t?">":" "} ${o}: ${i[a]}`)}return r.join(`
`)}const Pq=new xi;function M7e(e){Xi._getMatrix(Pq,Xi.workingColorSpace,e);const t=`mat3( ${Pq.elements.map(i=>i.toFixed(4))} )`;switch(Xi.getTransfer(e)){case nb:return[t,"LinearTransferOETF"];case sr:return[t,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space: ",e),[t,"LinearTransferOETF"]}}function Dq(e,t,i){const r=e.getShaderParameter(t,e.COMPILE_STATUS),n=e.getShaderInfoLog(t).trim();if(r&&n==="")return"";const s=/ERROR: 0:(\d+)/.exec(n);if(s){const a=parseInt(s[1]);return i.toUpperCase()+`

`+n+`

`+S7e(e.getShaderSource(t),a)}else return n}function E7e(e,t){const i=M7e(t);return[`vec4 ${e}( vec4 value ) {`,`	return ${i[1]}( vec4( value.rgb * ${i[0]}, value.a ) );`,"}"].join(`
`)}function A7e(e,t){let i;switch(t){case mne:i="Linear";break;case gne:i="Reinhard";break;case vne:i="Cineon";break;case O4:i="ACESFilmic";break;case xne:i="AgX";break;case wne:i="Neutral";break;case yne:i="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),i="Linear"}return"vec3 "+e+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}const PE=new he;function T7e(){Xi.getLuminanceCoefficients(PE);const e=PE.x.toFixed(4),t=PE.y.toFixed(4),i=PE.z.toFixed(4);return["float luminance( const in vec3 rgb ) {",`	const vec3 weights = vec3( ${e}, ${t}, ${i} );`,"	return dot( weights, rgb );","}"].join(`
`)}function C7e(e){return[e.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",e.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(mx).join(`
`)}function P7e(e){const t=[];for(const i in e){const r=e[i];r!==!1&&t.push("#define "+i+" "+r)}return t.join(`
`)}function D7e(e,t){const i={},r=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let n=0;n<r;n++){const s=e.getActiveAttrib(t,n),a=s.name;let o=1;s.type===e.FLOAT_MAT2&&(o=2),s.type===e.FLOAT_MAT3&&(o=3),s.type===e.FLOAT_MAT4&&(o=4),i[a]={type:s.type,location:e.getAttribLocation(t,a),locationSize:o}}return i}function mx(e){return e!==""}function Rq(e,t){const i=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,i).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function Iq(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const R7e=/^[ \t]*#include +<([\w\d./]+)>/gm;function cF(e){return e.replace(R7e,L7e)}const I7e=new Map;function L7e(e,t){let i=Ai[t];if(i===void 0){const r=I7e.get(t);if(r!==void 0)i=Ai[r],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',t,r);else throw new Error("Can not resolve #include <"+t+">")}return cF(i)}const O7e=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Lq(e){return e.replace(O7e,z7e)}function z7e(e,t,i,r){let n="";for(let s=parseInt(t);s<parseInt(i);s++)n+=r.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return n}function Oq(e){let t=`precision ${e.precision} float;
	precision ${e.precision} int;
	precision ${e.precision} sampler2D;
	precision ${e.precision} samplerCube;
	precision ${e.precision} sampler3D;
	precision ${e.precision} sampler2DArray;
	precision ${e.precision} sampler2DShadow;
	precision ${e.precision} samplerCubeShadow;
	precision ${e.precision} sampler2DArrayShadow;
	precision ${e.precision} isampler2D;
	precision ${e.precision} isampler3D;
	precision ${e.precision} isamplerCube;
	precision ${e.precision} isampler2DArray;
	precision ${e.precision} usampler2D;
	precision ${e.precision} usampler3D;
	precision ${e.precision} usamplerCube;
	precision ${e.precision} usampler2DArray;
	`;return e.precision==="highp"?t+=`
#define HIGH_PRECISION`:e.precision==="mediump"?t+=`
#define MEDIUM_PRECISION`:e.precision==="lowp"&&(t+=`
#define LOW_PRECISION`),t}function B7e(e){let t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===$C?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===Xx?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===Gl&&(t="SHADOWMAP_TYPE_VSM"),t}function F7e(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case Oh:case wf:t="ENVMAP_TYPE_CUBE";break;case by:t="ENVMAP_TYPE_CUBE_UV";break}return t}function U7e(e){let t="ENVMAP_MODE_REFLECTION";if(e.envMap)switch(e.envMapMode){case wf:t="ENVMAP_MODE_REFRACTION";break}return t}function N7e(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case jb:t="ENVMAP_BLENDING_MULTIPLY";break;case fne:t="ENVMAP_BLENDING_MIX";break;case pne:t="ENVMAP_BLENDING_ADD";break}return t}function k7e(e){const t=e.envMapCubeUVHeight;if(t===null)return null;const i=Math.log2(t)-2,r=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,i),7*16)),texelHeight:r,maxMip:i}}function V7e(e,t,i,r){const n=e.getContext(),s=i.defines;let a=i.vertexShader,o=i.fragmentShader;const l=B7e(i),c=F7e(i),u=U7e(i),h=N7e(i),d=k7e(i),f=C7e(i),p=P7e(s),v=n.createProgram();let m,g,y=i.glslVersion?"#version "+i.glslVersion+`
`:"";i.isRawShaderMaterial?(m=["#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,p].filter(mx).join(`
`),m.length>0&&(m+=`
`),g=["#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,p].filter(mx).join(`
`),g.length>0&&(g+=`
`)):(m=[Oq(i),"#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,p,i.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",i.batching?"#define USE_BATCHING":"",i.batchingColor?"#define USE_BATCHING_COLOR":"",i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.instancingMorph?"#define USE_INSTANCING_MORPH":"",i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+u:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",i.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",i.displacementMap?"#define USE_DISPLACEMENTMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.anisotropy?"#define USE_ANISOTROPY":"",i.anisotropyMap?"#define USE_ANISOTROPYMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",i.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaHash?"#define USE_ALPHAHASH":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",i.mapUv?"#define MAP_UV "+i.mapUv:"",i.alphaMapUv?"#define ALPHAMAP_UV "+i.alphaMapUv:"",i.lightMapUv?"#define LIGHTMAP_UV "+i.lightMapUv:"",i.aoMapUv?"#define AOMAP_UV "+i.aoMapUv:"",i.emissiveMapUv?"#define EMISSIVEMAP_UV "+i.emissiveMapUv:"",i.bumpMapUv?"#define BUMPMAP_UV "+i.bumpMapUv:"",i.normalMapUv?"#define NORMALMAP_UV "+i.normalMapUv:"",i.displacementMapUv?"#define DISPLACEMENTMAP_UV "+i.displacementMapUv:"",i.metalnessMapUv?"#define METALNESSMAP_UV "+i.metalnessMapUv:"",i.roughnessMapUv?"#define ROUGHNESSMAP_UV "+i.roughnessMapUv:"",i.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+i.anisotropyMapUv:"",i.clearcoatMapUv?"#define CLEARCOATMAP_UV "+i.clearcoatMapUv:"",i.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+i.clearcoatNormalMapUv:"",i.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+i.clearcoatRoughnessMapUv:"",i.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+i.iridescenceMapUv:"",i.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+i.iridescenceThicknessMapUv:"",i.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+i.sheenColorMapUv:"",i.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+i.sheenRoughnessMapUv:"",i.specularMapUv?"#define SPECULARMAP_UV "+i.specularMapUv:"",i.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+i.specularColorMapUv:"",i.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+i.specularIntensityMapUv:"",i.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+i.transmissionMapUv:"",i.thicknessMapUv?"#define THICKNESSMAP_UV "+i.thicknessMapUv:"",i.vertexTangents&&i.flatShading===!1?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUv1s?"#define USE_UV1":"",i.vertexUv2s?"#define USE_UV2":"",i.vertexUv3s?"#define USE_UV3":"",i.pointsUvs?"#define USE_POINTS_UV":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&i.flatShading===!1?"#define USE_MORPHNORMALS":"",i.morphColors?"#define USE_MORPHCOLORS":"",i.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+i.morphTextureStride:"",i.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+i.morphTargetsCount:"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.numLightProbes>0?"#define USE_LIGHT_PROBES":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(mx).join(`
`),g=[Oq(i),"#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,p,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+c:"",i.envMap?"#define "+u:"",i.envMap?"#define "+h:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",i.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.anisotropy?"#define USE_ANISOTROPY":"",i.anisotropyMap?"#define USE_ANISOTROPYMAP":"",i.clearcoat?"#define USE_CLEARCOAT":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.dispersion?"#define USE_DISPERSION":"",i.iridescence?"#define USE_IRIDESCENCE":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",i.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaTest?"#define USE_ALPHATEST":"",i.alphaHash?"#define USE_ALPHAHASH":"",i.sheen?"#define USE_SHEEN":"",i.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.vertexTangents&&i.flatShading===!1?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor||i.batchingColor?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUv1s?"#define USE_UV1":"",i.vertexUv2s?"#define USE_UV2":"",i.vertexUv3s?"#define USE_UV3":"",i.pointsUvs?"#define USE_POINTS_UV":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.numLightProbes>0?"#define USE_LIGHT_PROBES":"",i.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",i.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",i.toneMapping!==ru?"#define TONE_MAPPING":"",i.toneMapping!==ru?Ai.tonemapping_pars_fragment:"",i.toneMapping!==ru?A7e("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",i.opaque?"#define OPAQUE":"",Ai.colorspace_pars_fragment,E7e("linearToOutputTexel",i.outputColorSpace),T7e(),i.useDepthPacking?"#define DEPTH_PACKING "+i.depthPacking:"",`
`].filter(mx).join(`
`)),a=cF(a),a=Rq(a,i),a=Iq(a,i),o=cF(o),o=Rq(o,i),o=Iq(o,i),a=Lq(a),o=Lq(o),i.isRawShaderMaterial!==!0&&(y=`#version 300 es
`,m=[f,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+m,g=["#define varying in",i.glslVersion===$B?"":"layout(location = 0) out highp vec4 pc_fragColor;",i.glslVersion===$B?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+g);const x=y+m+a,_=y+g+o,M=Cq(n,n.VERTEX_SHADER,x),S=Cq(n,n.FRAGMENT_SHADER,_);n.attachShader(v,M),n.attachShader(v,S),i.index0AttributeName!==void 0?n.bindAttribLocation(v,0,i.index0AttributeName):i.morphTargets===!0&&n.bindAttribLocation(v,0,"position"),n.linkProgram(v);function T(D){if(e.debug.checkShaderErrors){const R=n.getProgramInfoLog(v).trim(),L=n.getShaderInfoLog(M).trim(),O=n.getShaderInfoLog(S).trim();let H=!0,j=!0;if(n.getProgramParameter(v,n.LINK_STATUS)===!1)if(H=!1,typeof e.debug.onShaderError=="function")e.debug.onShaderError(n,v,M,S);else{const Y=Dq(n,M,"vertex"),z=Dq(n,S,"fragment");console.error("THREE.WebGLProgram: Shader Error "+n.getError()+" - VALIDATE_STATUS "+n.getProgramParameter(v,n.VALIDATE_STATUS)+`

Material Name: `+D.name+`
Material Type: `+D.type+`

Program Info Log: `+R+`
`+Y+`
`+z)}else R!==""?console.warn("THREE.WebGLProgram: Program Info Log:",R):(L===""||O==="")&&(j=!1);j&&(D.diagnostics={runnable:H,programLog:R,vertexShader:{log:L,prefix:m},fragmentShader:{log:O,prefix:g}})}n.deleteShader(M),n.deleteShader(S),E=new x2(n,v),C=D7e(n,v)}let E;this.getUniforms=function(){return E===void 0&&T(this),E};let C;this.getAttributes=function(){return C===void 0&&T(this),C};let A=i.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return A===!1&&(A=n.getProgramParameter(v,b7e)),A},this.destroy=function(){r.releaseStatesOfProgram(this),n.deleteProgram(v),this.program=void 0},this.type=i.shaderType,this.name=i.shaderName,this.id=_7e++,this.cacheKey=t,this.usedTimes=1,this.program=v,this.vertexShader=M,this.fragmentShader=S,this}let G7e=0;class H7e{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(t){const i=t.vertexShader,r=t.fragmentShader,n=this._getShaderStage(i),s=this._getShaderStage(r),a=this._getShaderCacheForMaterial(t);return a.has(n)===!1&&(a.add(n),n.usedTimes++),a.has(s)===!1&&(a.add(s),s.usedTimes++),this}remove(t){const i=this.materialCache.get(t);for(const r of i)r.usedTimes--,r.usedTimes===0&&this.shaderCache.delete(r.code);return this.materialCache.delete(t),this}getVertexShaderID(t){return this._getShaderStage(t.vertexShader).id}getFragmentShaderID(t){return this._getShaderStage(t.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(t){const i=this.materialCache;let r=i.get(t);return r===void 0&&(r=new Set,i.set(t,r)),r}_getShaderStage(t){const i=this.shaderCache;let r=i.get(t);return r===void 0&&(r=new j7e(t),i.set(t,r)),r}}class j7e{constructor(t){this.id=G7e++,this.code=t,this.usedTimes=0}}function W7e(e,t,i,r,n,s,a){const o=new pm,l=new H7e,c=new Set,u=[],h=n.logarithmicDepthBuffer,d=n.vertexTextures;let f=n.precision;const p={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function v(C){return c.add(C),C===0?"uv":`uv${C}`}function m(C,A,D,R,L){const O=R.fog,H=L.geometry,j=C.isMeshStandardMaterial?R.environment:null,Y=(C.isMeshStandardMaterial?i:t).get(C.envMap||j),z=Y&&Y.mapping===by?Y.image.height:null,V=p[C.type];C.precision!==null&&(f=n.getMaxPrecision(C.precision),f!==C.precision&&console.warn("THREE.WebGLProgram.getParameters:",C.precision,"not supported, using",f,"instead."));const U=H.morphAttributes.position||H.morphAttributes.normal||H.morphAttributes.color,k=U!==void 0?U.length:0;let X=0;H.morphAttributes.position!==void 0&&(X=1),H.morphAttributes.normal!==void 0&&(X=2),H.morphAttributes.color!==void 0&&(X=3);let re,q,ee,$;if(V){const vt=Wl[V];re=vt.vertexShader,q=vt.fragmentShader}else re=C.vertexShader,q=C.fragmentShader,l.update(C),ee=l.getVertexShaderID(C),$=l.getFragmentShaderID(C);const ne=e.getRenderTarget(),ce=e.state.buffers.depth.getReversed(),pe=L.isInstancedMesh===!0,ge=L.isBatchedMesh===!0,we=!!C.map,le=!!C.matcap,ve=!!Y,ie=!!C.aoMap,Ce=!!C.lightMap,Pe=!!C.bumpMap,Ne=!!C.normalMap,be=!!C.displacementMap,Le=!!C.emissiveMap,Fe=!!C.metalnessMap,K=!!C.roughnessMap,B=C.anisotropy>0,G=C.clearcoat>0,oe=C.dispersion>0,fe=C.iridescence>0,W=C.sheen>0,Ie=C.transmission>0,Oe=B&&!!C.anisotropyMap,Be=G&&!!C.clearcoatMap,Re=G&&!!C.clearcoatNormalMap,ke=G&&!!C.clearcoatRoughnessMap,qe=fe&&!!C.iridescenceMap,Ke=fe&&!!C.iridescenceThicknessMap,it=W&&!!C.sheenColorMap,He=W&&!!C.sheenRoughnessMap,de=!!C.specularMap,We=!!C.specularColorMap,dt=!!C.specularIntensityMap,J=Ie&&!!C.transmissionMap,xe=Ie&&!!C.thicknessMap,me=!!C.gradientMap,ze=!!C.alphaMap,Ze=C.alphaTest>0,Je=!!C.alphaHash,mt=!!C.extensions;let St=ru;C.toneMapped&&(ne===null||ne.isXRRenderTarget===!0)&&(St=e.toneMapping);const Mt={shaderID:V,shaderType:C.type,shaderName:C.name,vertexShader:re,fragmentShader:q,defines:C.defines,customVertexShaderID:ee,customFragmentShaderID:$,isRawShaderMaterial:C.isRawShaderMaterial===!0,glslVersion:C.glslVersion,precision:f,batching:ge,batchingColor:ge&&L._colorsTexture!==null,instancing:pe,instancingColor:pe&&L.instanceColor!==null,instancingMorph:pe&&L.morphTexture!==null,supportsVertexTextures:d,outputColorSpace:ne===null?e.outputColorSpace:ne.isXRRenderTarget===!0?ne.texture.colorSpace:zm,alphaToCoverage:!!C.alphaToCoverage,map:we,matcap:le,envMap:ve,envMapMode:ve&&Y.mapping,envMapCubeUVHeight:z,aoMap:ie,lightMap:Ce,bumpMap:Pe,normalMap:Ne,displacementMap:d&&be,emissiveMap:Le,normalMapObjectSpace:Ne&&C.normalMapType===Ane,normalMapTangentSpace:Ne&&C.normalMapType===Rf,metalnessMap:Fe,roughnessMap:K,anisotropy:B,anisotropyMap:Oe,clearcoat:G,clearcoatMap:Be,clearcoatNormalMap:Re,clearcoatRoughnessMap:ke,dispersion:oe,iridescence:fe,iridescenceMap:qe,iridescenceThicknessMap:Ke,sheen:W,sheenColorMap:it,sheenRoughnessMap:He,specularMap:de,specularColorMap:We,specularIntensityMap:dt,transmission:Ie,transmissionMap:J,thicknessMap:xe,gradientMap:me,opaque:C.transparent===!1&&C.blending===hm&&C.alphaToCoverage===!1,alphaMap:ze,alphaTest:Ze,alphaHash:Je,combine:C.combine,mapUv:we&&v(C.map.channel),aoMapUv:ie&&v(C.aoMap.channel),lightMapUv:Ce&&v(C.lightMap.channel),bumpMapUv:Pe&&v(C.bumpMap.channel),normalMapUv:Ne&&v(C.normalMap.channel),displacementMapUv:be&&v(C.displacementMap.channel),emissiveMapUv:Le&&v(C.emissiveMap.channel),metalnessMapUv:Fe&&v(C.metalnessMap.channel),roughnessMapUv:K&&v(C.roughnessMap.channel),anisotropyMapUv:Oe&&v(C.anisotropyMap.channel),clearcoatMapUv:Be&&v(C.clearcoatMap.channel),clearcoatNormalMapUv:Re&&v(C.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:ke&&v(C.clearcoatRoughnessMap.channel),iridescenceMapUv:qe&&v(C.iridescenceMap.channel),iridescenceThicknessMapUv:Ke&&v(C.iridescenceThicknessMap.channel),sheenColorMapUv:it&&v(C.sheenColorMap.channel),sheenRoughnessMapUv:He&&v(C.sheenRoughnessMap.channel),specularMapUv:de&&v(C.specularMap.channel),specularColorMapUv:We&&v(C.specularColorMap.channel),specularIntensityMapUv:dt&&v(C.specularIntensityMap.channel),transmissionMapUv:J&&v(C.transmissionMap.channel),thicknessMapUv:xe&&v(C.thicknessMap.channel),alphaMapUv:ze&&v(C.alphaMap.channel),vertexTangents:!!H.attributes.tangent&&(Ne||B),vertexColors:C.vertexColors,vertexAlphas:C.vertexColors===!0&&!!H.attributes.color&&H.attributes.color.itemSize===4,pointsUvs:L.isPoints===!0&&!!H.attributes.uv&&(we||ze),fog:!!O,useFog:C.fog===!0,fogExp2:!!O&&O.isFogExp2,flatShading:C.flatShading===!0,sizeAttenuation:C.sizeAttenuation===!0,logarithmicDepthBuffer:h,reverseDepthBuffer:ce,skinning:L.isSkinnedMesh===!0,morphTargets:H.morphAttributes.position!==void 0,morphNormals:H.morphAttributes.normal!==void 0,morphColors:H.morphAttributes.color!==void 0,morphTargetsCount:k,morphTextureStride:X,numDirLights:A.directional.length,numPointLights:A.point.length,numSpotLights:A.spot.length,numSpotLightMaps:A.spotLightMap.length,numRectAreaLights:A.rectArea.length,numHemiLights:A.hemi.length,numDirLightShadows:A.directionalShadowMap.length,numPointLightShadows:A.pointShadowMap.length,numSpotLightShadows:A.spotShadowMap.length,numSpotLightShadowsWithMaps:A.numSpotLightShadowsWithMaps,numLightProbes:A.numLightProbes,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:C.dithering,shadowMapEnabled:e.shadowMap.enabled&&D.length>0,shadowMapType:e.shadowMap.type,toneMapping:St,decodeVideoTexture:we&&C.map.isVideoTexture===!0&&Xi.getTransfer(C.map.colorSpace)===sr,decodeVideoTextureEmissive:Le&&C.emissiveMap.isVideoTexture===!0&&Xi.getTransfer(C.emissiveMap.colorSpace)===sr,premultipliedAlpha:C.premultipliedAlpha,doubleSided:C.side===Ql,flipSided:C.side===La,useDepthPacking:C.depthPacking>=0,depthPacking:C.depthPacking||0,index0AttributeName:C.index0AttributeName,extensionClipCullDistance:mt&&C.extensions.clipCullDistance===!0&&r.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(mt&&C.extensions.multiDraw===!0||ge)&&r.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:r.has("KHR_parallel_shader_compile"),customProgramCacheKey:C.customProgramCacheKey()};return Mt.vertexUv1s=c.has(1),Mt.vertexUv2s=c.has(2),Mt.vertexUv3s=c.has(3),c.clear(),Mt}function g(C){const A=[];if(C.shaderID?A.push(C.shaderID):(A.push(C.customVertexShaderID),A.push(C.customFragmentShaderID)),C.defines!==void 0)for(const D in C.defines)A.push(D),A.push(C.defines[D]);return C.isRawShaderMaterial===!1&&(y(A,C),x(A,C),A.push(e.outputColorSpace)),A.push(C.customProgramCacheKey),A.join()}function y(C,A){C.push(A.precision),C.push(A.outputColorSpace),C.push(A.envMapMode),C.push(A.envMapCubeUVHeight),C.push(A.mapUv),C.push(A.alphaMapUv),C.push(A.lightMapUv),C.push(A.aoMapUv),C.push(A.bumpMapUv),C.push(A.normalMapUv),C.push(A.displacementMapUv),C.push(A.emissiveMapUv),C.push(A.metalnessMapUv),C.push(A.roughnessMapUv),C.push(A.anisotropyMapUv),C.push(A.clearcoatMapUv),C.push(A.clearcoatNormalMapUv),C.push(A.clearcoatRoughnessMapUv),C.push(A.iridescenceMapUv),C.push(A.iridescenceThicknessMapUv),C.push(A.sheenColorMapUv),C.push(A.sheenRoughnessMapUv),C.push(A.specularMapUv),C.push(A.specularColorMapUv),C.push(A.specularIntensityMapUv),C.push(A.transmissionMapUv),C.push(A.thicknessMapUv),C.push(A.combine),C.push(A.fogExp2),C.push(A.sizeAttenuation),C.push(A.morphTargetsCount),C.push(A.morphAttributeCount),C.push(A.numDirLights),C.push(A.numPointLights),C.push(A.numSpotLights),C.push(A.numSpotLightMaps),C.push(A.numHemiLights),C.push(A.numRectAreaLights),C.push(A.numDirLightShadows),C.push(A.numPointLightShadows),C.push(A.numSpotLightShadows),C.push(A.numSpotLightShadowsWithMaps),C.push(A.numLightProbes),C.push(A.shadowMapType),C.push(A.toneMapping),C.push(A.numClippingPlanes),C.push(A.numClipIntersection),C.push(A.depthPacking)}function x(C,A){o.disableAll(),A.supportsVertexTextures&&o.enable(0),A.instancing&&o.enable(1),A.instancingColor&&o.enable(2),A.instancingMorph&&o.enable(3),A.matcap&&o.enable(4),A.envMap&&o.enable(5),A.normalMapObjectSpace&&o.enable(6),A.normalMapTangentSpace&&o.enable(7),A.clearcoat&&o.enable(8),A.iridescence&&o.enable(9),A.alphaTest&&o.enable(10),A.vertexColors&&o.enable(11),A.vertexAlphas&&o.enable(12),A.vertexUv1s&&o.enable(13),A.vertexUv2s&&o.enable(14),A.vertexUv3s&&o.enable(15),A.vertexTangents&&o.enable(16),A.anisotropy&&o.enable(17),A.alphaHash&&o.enable(18),A.batching&&o.enable(19),A.dispersion&&o.enable(20),A.batchingColor&&o.enable(21),C.push(o.mask),o.disableAll(),A.fog&&o.enable(0),A.useFog&&o.enable(1),A.flatShading&&o.enable(2),A.logarithmicDepthBuffer&&o.enable(3),A.reverseDepthBuffer&&o.enable(4),A.skinning&&o.enable(5),A.morphTargets&&o.enable(6),A.morphNormals&&o.enable(7),A.morphColors&&o.enable(8),A.premultipliedAlpha&&o.enable(9),A.shadowMapEnabled&&o.enable(10),A.doubleSided&&o.enable(11),A.flipSided&&o.enable(12),A.useDepthPacking&&o.enable(13),A.dithering&&o.enable(14),A.transmission&&o.enable(15),A.sheen&&o.enable(16),A.opaque&&o.enable(17),A.pointsUvs&&o.enable(18),A.decodeVideoTexture&&o.enable(19),A.decodeVideoTextureEmissive&&o.enable(20),A.alphaToCoverage&&o.enable(21),C.push(o.mask)}function _(C){const A=p[C.type];let D;if(A){const R=Wl[A];D=K4.clone(R.uniforms)}else D=C.uniforms;return D}function M(C,A){let D;for(let R=0,L=u.length;R<L;R++){const O=u[R];if(O.cacheKey===A){D=O,++D.usedTimes;break}}return D===void 0&&(D=new V7e(e,A,C,s),u.push(D)),D}function S(C){if(--C.usedTimes===0){const A=u.indexOf(C);u[A]=u[u.length-1],u.pop(),C.destroy()}}function T(C){l.remove(C)}function E(){l.dispose()}return{getParameters:m,getProgramCacheKey:g,getUniforms:_,acquireProgram:M,releaseProgram:S,releaseShaderCache:T,programs:u,dispose:E}}function X7e(){let e=new WeakMap;function t(a){return e.has(a)}function i(a){let o=e.get(a);return o===void 0&&(o={},e.set(a,o)),o}function r(a){e.delete(a)}function n(a,o,l){e.get(a)[o]=l}function s(){e=new WeakMap}return{has:t,get:i,remove:r,update:n,dispose:s}}function q7e(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function zq(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function Bq(){const e=[];let t=0;const i=[],r=[],n=[];function s(){t=0,i.length=0,r.length=0,n.length=0}function a(h,d,f,p,v,m){let g=e[t];return g===void 0?(g={id:h.id,object:h,geometry:d,material:f,groupOrder:p,renderOrder:h.renderOrder,z:v,group:m},e[t]=g):(g.id=h.id,g.object=h,g.geometry=d,g.material=f,g.groupOrder=p,g.renderOrder=h.renderOrder,g.z=v,g.group=m),t++,g}function o(h,d,f,p,v,m){const g=a(h,d,f,p,v,m);f.transmission>0?r.push(g):f.transparent===!0?n.push(g):i.push(g)}function l(h,d,f,p,v,m){const g=a(h,d,f,p,v,m);f.transmission>0?r.unshift(g):f.transparent===!0?n.unshift(g):i.unshift(g)}function c(h,d){i.length>1&&i.sort(h||q7e),r.length>1&&r.sort(d||zq),n.length>1&&n.sort(d||zq)}function u(){for(let h=t,d=e.length;h<d;h++){const f=e[h];if(f.id===null)break;f.id=null,f.object=null,f.geometry=null,f.material=null,f.group=null}}return{opaque:i,transmissive:r,transparent:n,init:s,push:o,unshift:l,finish:u,sort:c}}function Y7e(){let e=new WeakMap;function t(r,n){const s=e.get(r);let a;return s===void 0?(a=new Bq,e.set(r,[a])):n>=s.length?(a=new Bq,s.push(a)):a=s[n],a}function i(){e=new WeakMap}return{get:t,dispose:i}}function Q7e(){const e={};return{get:function(t){if(e[t.id]!==void 0)return e[t.id];let i;switch(t.type){case"DirectionalLight":i={direction:new he,color:new Rt};break;case"SpotLight":i={position:new he,direction:new he,color:new Rt,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new he,color:new Rt,distance:0,decay:0};break;case"HemisphereLight":i={direction:new he,skyColor:new Rt,groundColor:new Rt};break;case"RectAreaLight":i={color:new Rt,position:new he,halfWidth:new he,halfHeight:new he};break}return e[t.id]=i,i}}}function Z7e(){const e={};return{get:function(t){if(e[t.id]!==void 0)return e[t.id];let i;switch(t.type){case"DirectionalLight":i={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ut};break;case"SpotLight":i={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ut};break;case"PointLight":i={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ut,shadowCameraNear:1,shadowCameraFar:1e3};break}return e[t.id]=i,i}}}let K7e=0;function J7e(e,t){return(t.castShadow?2:0)-(e.castShadow?2:0)+(t.map?1:0)-(e.map?1:0)}function $7e(e){const t=new Q7e,i=Z7e(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let c=0;c<9;c++)r.probe.push(new he);const n=new he,s=new ci,a=new ci;function o(c){let u=0,h=0,d=0;for(let C=0;C<9;C++)r.probe[C].set(0,0,0);let f=0,p=0,v=0,m=0,g=0,y=0,x=0,_=0,M=0,S=0,T=0;c.sort(J7e);for(let C=0,A=c.length;C<A;C++){const D=c[C],R=D.color,L=D.intensity,O=D.distance,H=D.shadow&&D.shadow.map?D.shadow.map.texture:null;if(D.isAmbientLight)u+=R.r*L,h+=R.g*L,d+=R.b*L;else if(D.isLightProbe){for(let j=0;j<9;j++)r.probe[j].addScaledVector(D.sh.coefficients[j],L);T++}else if(D.isDirectionalLight){const j=t.get(D);if(j.color.copy(D.color).multiplyScalar(D.intensity),D.castShadow){const Y=D.shadow,z=i.get(D);z.shadowIntensity=Y.intensity,z.shadowBias=Y.bias,z.shadowNormalBias=Y.normalBias,z.shadowRadius=Y.radius,z.shadowMapSize=Y.mapSize,r.directionalShadow[f]=z,r.directionalShadowMap[f]=H,r.directionalShadowMatrix[f]=D.shadow.matrix,y++}r.directional[f]=j,f++}else if(D.isSpotLight){const j=t.get(D);j.position.setFromMatrixPosition(D.matrixWorld),j.color.copy(R).multiplyScalar(L),j.distance=O,j.coneCos=Math.cos(D.angle),j.penumbraCos=Math.cos(D.angle*(1-D.penumbra)),j.decay=D.decay,r.spot[v]=j;const Y=D.shadow;if(D.map&&(r.spotLightMap[M]=D.map,M++,Y.updateMatrices(D),D.castShadow&&S++),r.spotLightMatrix[v]=Y.matrix,D.castShadow){const z=i.get(D);z.shadowIntensity=Y.intensity,z.shadowBias=Y.bias,z.shadowNormalBias=Y.normalBias,z.shadowRadius=Y.radius,z.shadowMapSize=Y.mapSize,r.spotShadow[v]=z,r.spotShadowMap[v]=H,_++}v++}else if(D.isRectAreaLight){const j=t.get(D);j.color.copy(R).multiplyScalar(L),j.halfWidth.set(D.width*.5,0,0),j.halfHeight.set(0,D.height*.5,0),r.rectArea[m]=j,m++}else if(D.isPointLight){const j=t.get(D);if(j.color.copy(D.color).multiplyScalar(D.intensity),j.distance=D.distance,j.decay=D.decay,D.castShadow){const Y=D.shadow,z=i.get(D);z.shadowIntensity=Y.intensity,z.shadowBias=Y.bias,z.shadowNormalBias=Y.normalBias,z.shadowRadius=Y.radius,z.shadowMapSize=Y.mapSize,z.shadowCameraNear=Y.camera.near,z.shadowCameraFar=Y.camera.far,r.pointShadow[p]=z,r.pointShadowMap[p]=H,r.pointShadowMatrix[p]=D.shadow.matrix,x++}r.point[p]=j,p++}else if(D.isHemisphereLight){const j=t.get(D);j.skyColor.copy(D.color).multiplyScalar(L),j.groundColor.copy(D.groundColor).multiplyScalar(L),r.hemi[g]=j,g++}}m>0&&(e.has("OES_texture_float_linear")===!0?(r.rectAreaLTC1=At.LTC_FLOAT_1,r.rectAreaLTC2=At.LTC_FLOAT_2):(r.rectAreaLTC1=At.LTC_HALF_1,r.rectAreaLTC2=At.LTC_HALF_2)),r.ambient[0]=u,r.ambient[1]=h,r.ambient[2]=d;const E=r.hash;(E.directionalLength!==f||E.pointLength!==p||E.spotLength!==v||E.rectAreaLength!==m||E.hemiLength!==g||E.numDirectionalShadows!==y||E.numPointShadows!==x||E.numSpotShadows!==_||E.numSpotMaps!==M||E.numLightProbes!==T)&&(r.directional.length=f,r.spot.length=v,r.rectArea.length=m,r.point.length=p,r.hemi.length=g,r.directionalShadow.length=y,r.directionalShadowMap.length=y,r.pointShadow.length=x,r.pointShadowMap.length=x,r.spotShadow.length=_,r.spotShadowMap.length=_,r.directionalShadowMatrix.length=y,r.pointShadowMatrix.length=x,r.spotLightMatrix.length=_+M-S,r.spotLightMap.length=M,r.numSpotLightShadowsWithMaps=S,r.numLightProbes=T,E.directionalLength=f,E.pointLength=p,E.spotLength=v,E.rectAreaLength=m,E.hemiLength=g,E.numDirectionalShadows=y,E.numPointShadows=x,E.numSpotShadows=_,E.numSpotMaps=M,E.numLightProbes=T,r.version=K7e++)}function l(c,u){let h=0,d=0,f=0,p=0,v=0;const m=u.matrixWorldInverse;for(let g=0,y=c.length;g<y;g++){const x=c[g];if(x.isDirectionalLight){const _=r.directional[h];_.direction.setFromMatrixPosition(x.matrixWorld),n.setFromMatrixPosition(x.target.matrixWorld),_.direction.sub(n),_.direction.transformDirection(m),h++}else if(x.isSpotLight){const _=r.spot[f];_.position.setFromMatrixPosition(x.matrixWorld),_.position.applyMatrix4(m),_.direction.setFromMatrixPosition(x.matrixWorld),n.setFromMatrixPosition(x.target.matrixWorld),_.direction.sub(n),_.direction.transformDirection(m),f++}else if(x.isRectAreaLight){const _=r.rectArea[p];_.position.setFromMatrixPosition(x.matrixWorld),_.position.applyMatrix4(m),a.identity(),s.copy(x.matrixWorld),s.premultiply(m),a.extractRotation(s),_.halfWidth.set(x.width*.5,0,0),_.halfHeight.set(0,x.height*.5,0),_.halfWidth.applyMatrix4(a),_.halfHeight.applyMatrix4(a),p++}else if(x.isPointLight){const _=r.point[d];_.position.setFromMatrixPosition(x.matrixWorld),_.position.applyMatrix4(m),d++}else if(x.isHemisphereLight){const _=r.hemi[v];_.direction.setFromMatrixPosition(x.matrixWorld),_.direction.transformDirection(m),v++}}}return{setup:o,setupView:l,state:r}}function Fq(e){const t=new $7e(e),i=[],r=[];function n(u){c.camera=u,i.length=0,r.length=0}function s(u){i.push(u)}function a(u){r.push(u)}function o(){t.setup(i)}function l(u){t.setupView(i,u)}const c={lightsArray:i,shadowsArray:r,camera:null,lights:t,transmissionRenderTarget:{}};return{init:n,state:c,setupLights:o,setupLightsView:l,pushLight:s,pushShadow:a}}function eXe(e){let t=new WeakMap;function i(n,s=0){const a=t.get(n);let o;return a===void 0?(o=new Fq(e),t.set(n,[o])):s>=a.length?(o=new Fq(e),a.push(o)):o=a[s],o}function r(){t=new WeakMap}return{get:i,dispose:r}}const tXe=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,iXe=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function rXe(e,t,i){let r=new Qb;const n=new ut,s=new ut,a=new Hi,o=new PP({depthPacking:X4}),l=new DP,c={},u=i.maxTextureSize,h={[Lh]:La,[La]:Lh,[Ql]:Ql},d=new cc({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new ut},radius:{value:4}},vertexShader:tXe,fragmentShader:iXe}),f=d.clone();f.defines.HORIZONTAL_PASS=1;const p=new Pi;p.setAttribute("position",new mr(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const v=new Gr(p,d),m=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=$C;let g=this.type;this.render=function(S,T,E){if(m.enabled===!1||m.autoUpdate===!1&&m.needsUpdate===!1||S.length===0)return;const C=e.getRenderTarget(),A=e.getActiveCubeFace(),D=e.getActiveMipmapLevel(),R=e.state;R.setBlending(wh),R.buffers.color.setClear(1,1,1,1),R.buffers.depth.setTest(!0),R.setScissorTest(!1);const L=g!==Gl&&this.type===Gl,O=g===Gl&&this.type!==Gl;for(let H=0,j=S.length;H<j;H++){const Y=S[H],z=Y.shadow;if(z===void 0){console.warn("THREE.WebGLShadowMap:",Y,"has no shadow.");continue}if(z.autoUpdate===!1&&z.needsUpdate===!1)continue;n.copy(z.mapSize);const V=z.getFrameExtents();if(n.multiply(V),s.copy(z.mapSize),(n.x>u||n.y>u)&&(n.x>u&&(s.x=Math.floor(u/V.x),n.x=s.x*V.x,z.mapSize.x=s.x),n.y>u&&(s.y=Math.floor(u/V.y),n.y=s.y*V.y,z.mapSize.y=s.y)),z.map===null||L===!0||O===!0){const k=this.type!==Gl?{minFilter:Fs,magFilter:Fs}:{};z.map!==null&&z.map.dispose(),z.map=new uu(n.x,n.y,k),z.map.texture.name=Y.name+".shadowMap",z.camera.updateProjectionMatrix()}e.setRenderTarget(z.map),e.clear();const U=z.getViewportCount();for(let k=0;k<U;k++){const X=z.getViewport(k);a.set(s.x*X.x,s.y*X.y,s.x*X.z,s.y*X.w),R.viewport(a),z.updateMatrices(Y,k),r=z.getFrustum(),_(T,E,z.camera,Y,this.type)}z.isPointLightShadow!==!0&&this.type===Gl&&y(z,E),z.needsUpdate=!1}g=this.type,m.needsUpdate=!1,e.setRenderTarget(C,A,D)};function y(S,T){const E=t.update(v);d.defines.VSM_SAMPLES!==S.blurSamples&&(d.defines.VSM_SAMPLES=S.blurSamples,f.defines.VSM_SAMPLES=S.blurSamples,d.needsUpdate=!0,f.needsUpdate=!0),S.mapPass===null&&(S.mapPass=new uu(n.x,n.y)),d.uniforms.shadow_pass.value=S.map.texture,d.uniforms.resolution.value=S.mapSize,d.uniforms.radius.value=S.radius,e.setRenderTarget(S.mapPass),e.clear(),e.renderBufferDirect(T,null,E,d,v,null),f.uniforms.shadow_pass.value=S.mapPass.texture,f.uniforms.resolution.value=S.mapSize,f.uniforms.radius.value=S.radius,e.setRenderTarget(S.map),e.clear(),e.renderBufferDirect(T,null,E,f,v,null)}function x(S,T,E,C){let A=null;const D=E.isPointLight===!0?S.customDistanceMaterial:S.customDepthMaterial;if(D!==void 0)A=D;else if(A=E.isPointLight===!0?l:o,e.localClippingEnabled&&T.clipShadows===!0&&Array.isArray(T.clippingPlanes)&&T.clippingPlanes.length!==0||T.displacementMap&&T.displacementScale!==0||T.alphaMap&&T.alphaTest>0||T.map&&T.alphaTest>0){const R=A.uuid,L=T.uuid;let O=c[R];O===void 0&&(O={},c[R]=O);let H=O[L];H===void 0&&(H=A.clone(),O[L]=H,T.addEventListener("dispose",M)),A=H}if(A.visible=T.visible,A.wireframe=T.wireframe,C===Gl?A.side=T.shadowSide!==null?T.shadowSide:T.side:A.side=T.shadowSide!==null?T.shadowSide:h[T.side],A.alphaMap=T.alphaMap,A.alphaTest=T.alphaTest,A.map=T.map,A.clipShadows=T.clipShadows,A.clippingPlanes=T.clippingPlanes,A.clipIntersection=T.clipIntersection,A.displacementMap=T.displacementMap,A.displacementScale=T.displacementScale,A.displacementBias=T.displacementBias,A.wireframeLinewidth=T.wireframeLinewidth,A.linewidth=T.linewidth,E.isPointLight===!0&&A.isMeshDistanceMaterial===!0){const R=e.properties.get(A);R.light=E}return A}function _(S,T,E,C,A){if(S.visible===!1)return;if(S.layers.test(T.layers)&&(S.isMesh||S.isLine||S.isPoints)&&(S.castShadow||S.receiveShadow&&A===Gl)&&(!S.frustumCulled||r.intersectsObject(S))){S.modelViewMatrix.multiplyMatrices(E.matrixWorldInverse,S.matrixWorld);const L=t.update(S),O=S.material;if(Array.isArray(O)){const H=L.groups;for(let j=0,Y=H.length;j<Y;j++){const z=H[j],V=O[z.materialIndex];if(V&&V.visible){const U=x(S,V,C,A);S.onBeforeShadow(e,S,T,E,L,U,z),e.renderBufferDirect(E,null,L,U,S,z),S.onAfterShadow(e,S,T,E,L,U,z)}}}else if(O.visible){const H=x(S,O,C,A);S.onBeforeShadow(e,S,T,E,L,H,null),e.renderBufferDirect(E,null,L,H,S,null),S.onAfterShadow(e,S,T,E,L,H,null)}}const R=S.children;for(let L=0,O=R.length;L<O;L++)_(R[L],T,E,C,A)}function M(S){S.target.removeEventListener("dispose",M);for(const E in c){const C=c[E],A=S.target.uuid;A in C&&(C[A].dispose(),delete C[A])}}}const nXe={[gT]:vT,[yT]:bT,[xT]:_T,[Im]:wT,[vT]:gT,[bT]:yT,[_T]:xT,[wT]:Im};function sXe(e,t){function i(){let J=!1;const xe=new Hi;let me=null;const ze=new Hi(0,0,0,0);return{setMask:function(Ze){me!==Ze&&!J&&(e.colorMask(Ze,Ze,Ze,Ze),me=Ze)},setLocked:function(Ze){J=Ze},setClear:function(Ze,Je,mt,St,Mt){Mt===!0&&(Ze*=St,Je*=St,mt*=St),xe.set(Ze,Je,mt,St),ze.equals(xe)===!1&&(e.clearColor(Ze,Je,mt,St),ze.copy(xe))},reset:function(){J=!1,me=null,ze.set(-1,0,0,0)}}}function r(){let J=!1,xe=!1,me=null,ze=null,Ze=null;return{setReversed:function(Je){if(xe!==Je){const mt=t.get("EXT_clip_control");xe?mt.clipControlEXT(mt.LOWER_LEFT_EXT,mt.ZERO_TO_ONE_EXT):mt.clipControlEXT(mt.LOWER_LEFT_EXT,mt.NEGATIVE_ONE_TO_ONE_EXT);const St=Ze;Ze=null,this.setClear(St)}xe=Je},getReversed:function(){return xe},setTest:function(Je){Je?ne(e.DEPTH_TEST):ce(e.DEPTH_TEST)},setMask:function(Je){me!==Je&&!J&&(e.depthMask(Je),me=Je)},setFunc:function(Je){if(xe&&(Je=nXe[Je]),ze!==Je){switch(Je){case gT:e.depthFunc(e.NEVER);break;case vT:e.depthFunc(e.ALWAYS);break;case yT:e.depthFunc(e.LESS);break;case Im:e.depthFunc(e.LEQUAL);break;case xT:e.depthFunc(e.EQUAL);break;case wT:e.depthFunc(e.GEQUAL);break;case bT:e.depthFunc(e.GREATER);break;case _T:e.depthFunc(e.NOTEQUAL);break;default:e.depthFunc(e.LEQUAL)}ze=Je}},setLocked:function(Je){J=Je},setClear:function(Je){Ze!==Je&&(xe&&(Je=1-Je),e.clearDepth(Je),Ze=Je)},reset:function(){J=!1,me=null,ze=null,Ze=null,xe=!1}}}function n(){let J=!1,xe=null,me=null,ze=null,Ze=null,Je=null,mt=null,St=null,Mt=null;return{setTest:function(vt){J||(vt?ne(e.STENCIL_TEST):ce(e.STENCIL_TEST))},setMask:function(vt){xe!==vt&&!J&&(e.stencilMask(vt),xe=vt)},setFunc:function(vt,ui,hi){(me!==vt||ze!==ui||Ze!==hi)&&(e.stencilFunc(vt,ui,hi),me=vt,ze=ui,Ze=hi)},setOp:function(vt,ui,hi){(Je!==vt||mt!==ui||St!==hi)&&(e.stencilOp(vt,ui,hi),Je=vt,mt=ui,St=hi)},setLocked:function(vt){J=vt},setClear:function(vt){Mt!==vt&&(e.clearStencil(vt),Mt=vt)},reset:function(){J=!1,xe=null,me=null,ze=null,Ze=null,Je=null,mt=null,St=null,Mt=null}}}const s=new i,a=new r,o=new n,l=new WeakMap,c=new WeakMap;let u={},h={},d=new WeakMap,f=[],p=null,v=!1,m=null,g=null,y=null,x=null,_=null,M=null,S=null,T=new Rt(0,0,0),E=0,C=!1,A=null,D=null,R=null,L=null,O=null;const H=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let j=!1,Y=0;const z=e.getParameter(e.VERSION);z.indexOf("WebGL")!==-1?(Y=parseFloat(/^WebGL (\d)/.exec(z)[1]),j=Y>=1):z.indexOf("OpenGL ES")!==-1&&(Y=parseFloat(/^OpenGL ES (\d)/.exec(z)[1]),j=Y>=2);let V=null,U={};const k=e.getParameter(e.SCISSOR_BOX),X=e.getParameter(e.VIEWPORT),re=new Hi().fromArray(k),q=new Hi().fromArray(X);function ee(J,xe,me,ze){const Ze=new Uint8Array(4),Je=e.createTexture();e.bindTexture(J,Je),e.texParameteri(J,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(J,e.TEXTURE_MAG_FILTER,e.NEAREST);for(let mt=0;mt<me;mt++)J===e.TEXTURE_3D||J===e.TEXTURE_2D_ARRAY?e.texImage3D(xe,0,e.RGBA,1,1,ze,0,e.RGBA,e.UNSIGNED_BYTE,Ze):e.texImage2D(xe+mt,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,Ze);return Je}const $={};$[e.TEXTURE_2D]=ee(e.TEXTURE_2D,e.TEXTURE_2D,1),$[e.TEXTURE_CUBE_MAP]=ee(e.TEXTURE_CUBE_MAP,e.TEXTURE_CUBE_MAP_POSITIVE_X,6),$[e.TEXTURE_2D_ARRAY]=ee(e.TEXTURE_2D_ARRAY,e.TEXTURE_2D_ARRAY,1,1),$[e.TEXTURE_3D]=ee(e.TEXTURE_3D,e.TEXTURE_3D,1,1),s.setClear(0,0,0,1),a.setClear(1),o.setClear(0),ne(e.DEPTH_TEST),a.setFunc(Im),Pe(!1),Ne(qB),ne(e.CULL_FACE),ie(wh);function ne(J){u[J]!==!0&&(e.enable(J),u[J]=!0)}function ce(J){u[J]!==!1&&(e.disable(J),u[J]=!1)}function pe(J,xe){return h[J]!==xe?(e.bindFramebuffer(J,xe),h[J]=xe,J===e.DRAW_FRAMEBUFFER&&(h[e.FRAMEBUFFER]=xe),J===e.FRAMEBUFFER&&(h[e.DRAW_FRAMEBUFFER]=xe),!0):!1}function ge(J,xe){let me=f,ze=!1;if(J){me=d.get(xe),me===void 0&&(me=[],d.set(xe,me));const Ze=J.textures;if(me.length!==Ze.length||me[0]!==e.COLOR_ATTACHMENT0){for(let Je=0,mt=Ze.length;Je<mt;Je++)me[Je]=e.COLOR_ATTACHMENT0+Je;me.length=Ze.length,ze=!0}}else me[0]!==e.BACK&&(me[0]=e.BACK,ze=!0);ze&&e.drawBuffers(me)}function we(J){return p!==J?(e.useProgram(J),p=J,!0):!1}const le={[Od]:e.FUNC_ADD,[Zre]:e.FUNC_SUBTRACT,[Kre]:e.FUNC_REVERSE_SUBTRACT};le[Jre]=e.MIN,le[$re]=e.MAX;const ve={[ene]:e.ZERO,[tne]:e.ONE,[ine]:e.SRC_COLOR,[pT]:e.SRC_ALPHA,[lne]:e.SRC_ALPHA_SATURATE,[ane]:e.DST_COLOR,[nne]:e.DST_ALPHA,[rne]:e.ONE_MINUS_SRC_COLOR,[mT]:e.ONE_MINUS_SRC_ALPHA,[one]:e.ONE_MINUS_DST_COLOR,[sne]:e.ONE_MINUS_DST_ALPHA,[cne]:e.CONSTANT_COLOR,[une]:e.ONE_MINUS_CONSTANT_COLOR,[hne]:e.CONSTANT_ALPHA,[dne]:e.ONE_MINUS_CONSTANT_ALPHA};function ie(J,xe,me,ze,Ze,Je,mt,St,Mt,vt){if(J===wh){v===!0&&(ce(e.BLEND),v=!1);return}if(v===!1&&(ne(e.BLEND),v=!0),J!==Qre){if(J!==m||vt!==C){if((g!==Od||_!==Od)&&(e.blendEquation(e.FUNC_ADD),g=Od,_=Od),vt)switch(J){case hm:e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case YB:e.blendFunc(e.ONE,e.ONE);break;case QB:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case ZB:e.blendFuncSeparate(e.ZERO,e.SRC_COLOR,e.ZERO,e.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",J);break}else switch(J){case hm:e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case YB:e.blendFunc(e.SRC_ALPHA,e.ONE);break;case QB:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case ZB:e.blendFunc(e.ZERO,e.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",J);break}y=null,x=null,M=null,S=null,T.set(0,0,0),E=0,m=J,C=vt}return}Ze=Ze||xe,Je=Je||me,mt=mt||ze,(xe!==g||Ze!==_)&&(e.blendEquationSeparate(le[xe],le[Ze]),g=xe,_=Ze),(me!==y||ze!==x||Je!==M||mt!==S)&&(e.blendFuncSeparate(ve[me],ve[ze],ve[Je],ve[mt]),y=me,x=ze,M=Je,S=mt),(St.equals(T)===!1||Mt!==E)&&(e.blendColor(St.r,St.g,St.b,Mt),T.copy(St),E=Mt),m=J,C=!1}function Ce(J,xe){J.side===Ql?ce(e.CULL_FACE):ne(e.CULL_FACE);let me=J.side===La;xe&&(me=!me),Pe(me),J.blending===hm&&J.transparent===!1?ie(wh):ie(J.blending,J.blendEquation,J.blendSrc,J.blendDst,J.blendEquationAlpha,J.blendSrcAlpha,J.blendDstAlpha,J.blendColor,J.blendAlpha,J.premultipliedAlpha),a.setFunc(J.depthFunc),a.setTest(J.depthTest),a.setMask(J.depthWrite),s.setMask(J.colorWrite);const ze=J.stencilWrite;o.setTest(ze),ze&&(o.setMask(J.stencilWriteMask),o.setFunc(J.stencilFunc,J.stencilRef,J.stencilFuncMask),o.setOp(J.stencilFail,J.stencilZFail,J.stencilZPass)),Le(J.polygonOffset,J.polygonOffsetFactor,J.polygonOffsetUnits),J.alphaToCoverage===!0?ne(e.SAMPLE_ALPHA_TO_COVERAGE):ce(e.SAMPLE_ALPHA_TO_COVERAGE)}function Pe(J){A!==J&&(J?e.frontFace(e.CW):e.frontFace(e.CCW),A=J)}function Ne(J){J!==Xre?(ne(e.CULL_FACE),J!==D&&(J===qB?e.cullFace(e.BACK):J===qre?e.cullFace(e.FRONT):e.cullFace(e.FRONT_AND_BACK))):ce(e.CULL_FACE),D=J}function be(J){J!==R&&(j&&e.lineWidth(J),R=J)}function Le(J,xe,me){J?(ne(e.POLYGON_OFFSET_FILL),(L!==xe||O!==me)&&(e.polygonOffset(xe,me),L=xe,O=me)):ce(e.POLYGON_OFFSET_FILL)}function Fe(J){J?ne(e.SCISSOR_TEST):ce(e.SCISSOR_TEST)}function K(J){J===void 0&&(J=e.TEXTURE0+H-1),V!==J&&(e.activeTexture(J),V=J)}function B(J,xe,me){me===void 0&&(V===null?me=e.TEXTURE0+H-1:me=V);let ze=U[me];ze===void 0&&(ze={type:void 0,texture:void 0},U[me]=ze),(ze.type!==J||ze.texture!==xe)&&(V!==me&&(e.activeTexture(me),V=me),e.bindTexture(J,xe||$[J]),ze.type=J,ze.texture=xe)}function G(){const J=U[V];J!==void 0&&J.type!==void 0&&(e.bindTexture(J.type,null),J.type=void 0,J.texture=void 0)}function oe(){try{e.compressedTexImage2D(...arguments)}catch(J){console.error("THREE.WebGLState:",J)}}function fe(){try{e.compressedTexImage3D(...arguments)}catch(J){console.error("THREE.WebGLState:",J)}}function W(){try{e.texSubImage2D(...arguments)}catch(J){console.error("THREE.WebGLState:",J)}}function Ie(){try{e.texSubImage3D(...arguments)}catch(J){console.error("THREE.WebGLState:",J)}}function Oe(){try{e.compressedTexSubImage2D(...arguments)}catch(J){console.error("THREE.WebGLState:",J)}}function Be(){try{e.compressedTexSubImage3D(...arguments)}catch(J){console.error("THREE.WebGLState:",J)}}function Re(){try{e.texStorage2D(...arguments)}catch(J){console.error("THREE.WebGLState:",J)}}function ke(){try{e.texStorage3D(...arguments)}catch(J){console.error("THREE.WebGLState:",J)}}function qe(){try{e.texImage2D(...arguments)}catch(J){console.error("THREE.WebGLState:",J)}}function Ke(){try{e.texImage3D(...arguments)}catch(J){console.error("THREE.WebGLState:",J)}}function it(J){re.equals(J)===!1&&(e.scissor(J.x,J.y,J.z,J.w),re.copy(J))}function He(J){q.equals(J)===!1&&(e.viewport(J.x,J.y,J.z,J.w),q.copy(J))}function de(J,xe){let me=c.get(xe);me===void 0&&(me=new WeakMap,c.set(xe,me));let ze=me.get(J);ze===void 0&&(ze=e.getUniformBlockIndex(xe,J.name),me.set(J,ze))}function We(J,xe){const ze=c.get(xe).get(J);l.get(xe)!==ze&&(e.uniformBlockBinding(xe,ze,J.__bindingPointIndex),l.set(xe,ze))}function dt(){e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SCISSOR_TEST),e.disable(e.STENCIL_TEST),e.disable(e.SAMPLE_ALPHA_TO_COVERAGE),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.blendFuncSeparate(e.ONE,e.ZERO,e.ONE,e.ZERO),e.blendColor(0,0,0,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(e.LESS),a.setReversed(!1),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(e.ALWAYS,0,4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.clearStencil(0),e.cullFace(e.BACK),e.frontFace(e.CCW),e.polygonOffset(0,0),e.activeTexture(e.TEXTURE0),e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),e.bindFramebuffer(e.READ_FRAMEBUFFER,null),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),u={},V=null,U={},h={},d=new WeakMap,f=[],p=null,v=!1,m=null,g=null,y=null,x=null,_=null,M=null,S=null,T=new Rt(0,0,0),E=0,C=!1,A=null,D=null,R=null,L=null,O=null,re.set(0,0,e.canvas.width,e.canvas.height),q.set(0,0,e.canvas.width,e.canvas.height),s.reset(),a.reset(),o.reset()}return{buffers:{color:s,depth:a,stencil:o},enable:ne,disable:ce,bindFramebuffer:pe,drawBuffers:ge,useProgram:we,setBlending:ie,setMaterial:Ce,setFlipSided:Pe,setCullFace:Ne,setLineWidth:be,setPolygonOffset:Le,setScissorTest:Fe,activeTexture:K,bindTexture:B,unbindTexture:G,compressedTexImage2D:oe,compressedTexImage3D:fe,texImage2D:qe,texImage3D:Ke,updateUBOMapping:de,uniformBlockBinding:We,texStorage2D:Re,texStorage3D:ke,texSubImage2D:W,texSubImage3D:Ie,compressedTexSubImage2D:Oe,compressedTexSubImage3D:Be,scissor:it,viewport:He,reset:dt}}function aXe(e,t,i,r,n,s,a){const o=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,l=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),c=new ut,u=new WeakMap;let h;const d=new WeakMap;let f=!1;try{f=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function p(K,B){return f?new OffscreenCanvas(K,B):ob("canvas")}function v(K,B,G){let oe=1;const fe=Fe(K);if((fe.width>G||fe.height>G)&&(oe=G/Math.max(fe.width,fe.height)),oe<1)if(typeof HTMLImageElement<"u"&&K instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&K instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&K instanceof ImageBitmap||typeof VideoFrame<"u"&&K instanceof VideoFrame){const W=Math.floor(oe*fe.width),Ie=Math.floor(oe*fe.height);h===void 0&&(h=p(W,Ie));const Oe=B?p(W,Ie):h;return Oe.width=W,Oe.height=Ie,Oe.getContext("2d").drawImage(K,0,0,W,Ie),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+fe.width+"x"+fe.height+") to ("+W+"x"+Ie+")."),Oe}else return"data"in K&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+fe.width+"x"+fe.height+")."),K;return K}function m(K){return K.generateMipmaps}function g(K){e.generateMipmap(K)}function y(K){return K.isWebGLCubeRenderTarget?e.TEXTURE_CUBE_MAP:K.isWebGL3DRenderTarget?e.TEXTURE_3D:K.isWebGLArrayRenderTarget||K.isCompressedArrayTexture?e.TEXTURE_2D_ARRAY:e.TEXTURE_2D}function x(K,B,G,oe,fe=!1){if(K!==null){if(e[K]!==void 0)return e[K];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+K+"'")}let W=B;if(B===e.RED&&(G===e.FLOAT&&(W=e.R32F),G===e.HALF_FLOAT&&(W=e.R16F),G===e.UNSIGNED_BYTE&&(W=e.R8)),B===e.RED_INTEGER&&(G===e.UNSIGNED_BYTE&&(W=e.R8UI),G===e.UNSIGNED_SHORT&&(W=e.R16UI),G===e.UNSIGNED_INT&&(W=e.R32UI),G===e.BYTE&&(W=e.R8I),G===e.SHORT&&(W=e.R16I),G===e.INT&&(W=e.R32I)),B===e.RG&&(G===e.FLOAT&&(W=e.RG32F),G===e.HALF_FLOAT&&(W=e.RG16F),G===e.UNSIGNED_BYTE&&(W=e.RG8)),B===e.RG_INTEGER&&(G===e.UNSIGNED_BYTE&&(W=e.RG8UI),G===e.UNSIGNED_SHORT&&(W=e.RG16UI),G===e.UNSIGNED_INT&&(W=e.RG32UI),G===e.BYTE&&(W=e.RG8I),G===e.SHORT&&(W=e.RG16I),G===e.INT&&(W=e.RG32I)),B===e.RGB_INTEGER&&(G===e.UNSIGNED_BYTE&&(W=e.RGB8UI),G===e.UNSIGNED_SHORT&&(W=e.RGB16UI),G===e.UNSIGNED_INT&&(W=e.RGB32UI),G===e.BYTE&&(W=e.RGB8I),G===e.SHORT&&(W=e.RGB16I),G===e.INT&&(W=e.RGB32I)),B===e.RGBA_INTEGER&&(G===e.UNSIGNED_BYTE&&(W=e.RGBA8UI),G===e.UNSIGNED_SHORT&&(W=e.RGBA16UI),G===e.UNSIGNED_INT&&(W=e.RGBA32UI),G===e.BYTE&&(W=e.RGBA8I),G===e.SHORT&&(W=e.RGBA16I),G===e.INT&&(W=e.RGBA32I)),B===e.RGB&&G===e.UNSIGNED_INT_5_9_9_9_REV&&(W=e.RGB9_E5),B===e.RGBA){const Ie=fe?nb:Xi.getTransfer(oe);G===e.FLOAT&&(W=e.RGBA32F),G===e.HALF_FLOAT&&(W=e.RGBA16F),G===e.UNSIGNED_BYTE&&(W=Ie===sr?e.SRGB8_ALPHA8:e.RGBA8),G===e.UNSIGNED_SHORT_4_4_4_4&&(W=e.RGBA4),G===e.UNSIGNED_SHORT_5_5_5_1&&(W=e.RGB5_A1)}return(W===e.R16F||W===e.R32F||W===e.RG16F||W===e.RG32F||W===e.RGBA16F||W===e.RGBA32F)&&t.get("EXT_color_buffer_float"),W}function _(K,B){let G;return K?B===null||B===zh||B===Lm?G=e.DEPTH24_STENCIL8:B===so?G=e.DEPTH32F_STENCIL8:B===q0&&(G=e.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):B===null||B===zh||B===Lm?G=e.DEPTH_COMPONENT24:B===so?G=e.DEPTH_COMPONENT32F:B===q0&&(G=e.DEPTH_COMPONENT16),G}function M(K,B){return m(K)===!0||K.isFramebufferTexture&&K.minFilter!==Fs&&K.minFilter!==pn?Math.log2(Math.max(B.width,B.height))+1:K.mipmaps!==void 0&&K.mipmaps.length>0?K.mipmaps.length:K.isCompressedTexture&&Array.isArray(K.image)?B.mipmaps.length:1}function S(K){const B=K.target;B.removeEventListener("dispose",S),E(B),B.isVideoTexture&&u.delete(B)}function T(K){const B=K.target;B.removeEventListener("dispose",T),A(B)}function E(K){const B=r.get(K);if(B.__webglInit===void 0)return;const G=K.source,oe=d.get(G);if(oe){const fe=oe[B.__cacheKey];fe.usedTimes--,fe.usedTimes===0&&C(K),Object.keys(oe).length===0&&d.delete(G)}r.remove(K)}function C(K){const B=r.get(K);e.deleteTexture(B.__webglTexture);const G=K.source,oe=d.get(G);delete oe[B.__cacheKey],a.memory.textures--}function A(K){const B=r.get(K);if(K.depthTexture&&(K.depthTexture.dispose(),r.remove(K.depthTexture)),K.isWebGLCubeRenderTarget)for(let oe=0;oe<6;oe++){if(Array.isArray(B.__webglFramebuffer[oe]))for(let fe=0;fe<B.__webglFramebuffer[oe].length;fe++)e.deleteFramebuffer(B.__webglFramebuffer[oe][fe]);else e.deleteFramebuffer(B.__webglFramebuffer[oe]);B.__webglDepthbuffer&&e.deleteRenderbuffer(B.__webglDepthbuffer[oe])}else{if(Array.isArray(B.__webglFramebuffer))for(let oe=0;oe<B.__webglFramebuffer.length;oe++)e.deleteFramebuffer(B.__webglFramebuffer[oe]);else e.deleteFramebuffer(B.__webglFramebuffer);if(B.__webglDepthbuffer&&e.deleteRenderbuffer(B.__webglDepthbuffer),B.__webglMultisampledFramebuffer&&e.deleteFramebuffer(B.__webglMultisampledFramebuffer),B.__webglColorRenderbuffer)for(let oe=0;oe<B.__webglColorRenderbuffer.length;oe++)B.__webglColorRenderbuffer[oe]&&e.deleteRenderbuffer(B.__webglColorRenderbuffer[oe]);B.__webglDepthRenderbuffer&&e.deleteRenderbuffer(B.__webglDepthRenderbuffer)}const G=K.textures;for(let oe=0,fe=G.length;oe<fe;oe++){const W=r.get(G[oe]);W.__webglTexture&&(e.deleteTexture(W.__webglTexture),a.memory.textures--),r.remove(G[oe])}r.remove(K)}let D=0;function R(){D=0}function L(){const K=D;return K>=n.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+K+" texture units while this GPU supports only "+n.maxTextures),D+=1,K}function O(K){const B=[];return B.push(K.wrapS),B.push(K.wrapT),B.push(K.wrapR||0),B.push(K.magFilter),B.push(K.minFilter),B.push(K.anisotropy),B.push(K.internalFormat),B.push(K.format),B.push(K.type),B.push(K.generateMipmaps),B.push(K.premultiplyAlpha),B.push(K.flipY),B.push(K.unpackAlignment),B.push(K.colorSpace),B.join()}function H(K,B){const G=r.get(K);if(K.isVideoTexture&&be(K),K.isRenderTargetTexture===!1&&K.version>0&&G.__version!==K.version){const oe=K.image;if(oe===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(oe.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{q(G,K,B);return}}i.bindTexture(e.TEXTURE_2D,G.__webglTexture,e.TEXTURE0+B)}function j(K,B){const G=r.get(K);if(K.version>0&&G.__version!==K.version){q(G,K,B);return}i.bindTexture(e.TEXTURE_2D_ARRAY,G.__webglTexture,e.TEXTURE0+B)}function Y(K,B){const G=r.get(K);if(K.version>0&&G.__version!==K.version){q(G,K,B);return}i.bindTexture(e.TEXTURE_3D,G.__webglTexture,e.TEXTURE0+B)}function z(K,B){const G=r.get(K);if(K.version>0&&G.__version!==K.version){ee(G,K,B);return}i.bindTexture(e.TEXTURE_CUBE_MAP,G.__webglTexture,e.TEXTURE0+B)}const V={[eb]:e.REPEAT,[pl]:e.CLAMP_TO_EDGE,[tb]:e.MIRRORED_REPEAT},U={[Fs]:e.NEAREST,[z4]:e.NEAREST_MIPMAP_NEAREST,[Qv]:e.NEAREST_MIPMAP_LINEAR,[pn]:e.LINEAR,[qx]:e.LINEAR_MIPMAP_NEAREST,[qc]:e.LINEAR_MIPMAP_LINEAR},k={[Tne]:e.NEVER,[Lne]:e.ALWAYS,[Cne]:e.LESS,[q4]:e.LEQUAL,[Pne]:e.EQUAL,[Ine]:e.GEQUAL,[Dne]:e.GREATER,[Rne]:e.NOTEQUAL};function X(K,B){if(B.type===so&&t.has("OES_texture_float_linear")===!1&&(B.magFilter===pn||B.magFilter===qx||B.magFilter===Qv||B.magFilter===qc||B.minFilter===pn||B.minFilter===qx||B.minFilter===Qv||B.minFilter===qc)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),e.texParameteri(K,e.TEXTURE_WRAP_S,V[B.wrapS]),e.texParameteri(K,e.TEXTURE_WRAP_T,V[B.wrapT]),(K===e.TEXTURE_3D||K===e.TEXTURE_2D_ARRAY)&&e.texParameteri(K,e.TEXTURE_WRAP_R,V[B.wrapR]),e.texParameteri(K,e.TEXTURE_MAG_FILTER,U[B.magFilter]),e.texParameteri(K,e.TEXTURE_MIN_FILTER,U[B.minFilter]),B.compareFunction&&(e.texParameteri(K,e.TEXTURE_COMPARE_MODE,e.COMPARE_REF_TO_TEXTURE),e.texParameteri(K,e.TEXTURE_COMPARE_FUNC,k[B.compareFunction])),t.has("EXT_texture_filter_anisotropic")===!0){if(B.magFilter===Fs||B.minFilter!==Qv&&B.minFilter!==qc||B.type===so&&t.has("OES_texture_float_linear")===!1)return;if(B.anisotropy>1||r.get(B).__currentAnisotropy){const G=t.get("EXT_texture_filter_anisotropic");e.texParameterf(K,G.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(B.anisotropy,n.getMaxAnisotropy())),r.get(B).__currentAnisotropy=B.anisotropy}}}function re(K,B){let G=!1;K.__webglInit===void 0&&(K.__webglInit=!0,B.addEventListener("dispose",S));const oe=B.source;let fe=d.get(oe);fe===void 0&&(fe={},d.set(oe,fe));const W=O(B);if(W!==K.__cacheKey){fe[W]===void 0&&(fe[W]={texture:e.createTexture(),usedTimes:0},a.memory.textures++,G=!0),fe[W].usedTimes++;const Ie=fe[K.__cacheKey];Ie!==void 0&&(fe[K.__cacheKey].usedTimes--,Ie.usedTimes===0&&C(B)),K.__cacheKey=W,K.__webglTexture=fe[W].texture}return G}function q(K,B,G){let oe=e.TEXTURE_2D;(B.isDataArrayTexture||B.isCompressedArrayTexture)&&(oe=e.TEXTURE_2D_ARRAY),B.isData3DTexture&&(oe=e.TEXTURE_3D);const fe=re(K,B),W=B.source;i.bindTexture(oe,K.__webglTexture,e.TEXTURE0+G);const Ie=r.get(W);if(W.version!==Ie.__version||fe===!0){i.activeTexture(e.TEXTURE0+G);const Oe=Xi.getPrimaries(Xi.workingColorSpace),Be=B.colorSpace===rh?null:Xi.getPrimaries(B.colorSpace),Re=B.colorSpace===rh||Oe===Be?e.NONE:e.BROWSER_DEFAULT_WEBGL;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,B.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,B.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,B.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,Re);let ke=v(B.image,!1,n.maxTextureSize);ke=Le(B,ke);const qe=s.convert(B.format,B.colorSpace),Ke=s.convert(B.type);let it=x(B.internalFormat,qe,Ke,B.colorSpace,B.isVideoTexture);X(oe,B);let He;const de=B.mipmaps,We=B.isVideoTexture!==!0,dt=Ie.__version===void 0||fe===!0,J=W.dataReady,xe=M(B,ke);if(B.isDepthTexture)it=_(B.format===Om,B.type),dt&&(We?i.texStorage2D(e.TEXTURE_2D,1,it,ke.width,ke.height):i.texImage2D(e.TEXTURE_2D,0,it,ke.width,ke.height,0,qe,Ke,null));else if(B.isDataTexture)if(de.length>0){We&&dt&&i.texStorage2D(e.TEXTURE_2D,xe,it,de[0].width,de[0].height);for(let me=0,ze=de.length;me<ze;me++)He=de[me],We?J&&i.texSubImage2D(e.TEXTURE_2D,me,0,0,He.width,He.height,qe,Ke,He.data):i.texImage2D(e.TEXTURE_2D,me,it,He.width,He.height,0,qe,Ke,He.data);B.generateMipmaps=!1}else We?(dt&&i.texStorage2D(e.TEXTURE_2D,xe,it,ke.width,ke.height),J&&i.texSubImage2D(e.TEXTURE_2D,0,0,0,ke.width,ke.height,qe,Ke,ke.data)):i.texImage2D(e.TEXTURE_2D,0,it,ke.width,ke.height,0,qe,Ke,ke.data);else if(B.isCompressedTexture)if(B.isCompressedArrayTexture){We&&dt&&i.texStorage3D(e.TEXTURE_2D_ARRAY,xe,it,de[0].width,de[0].height,ke.depth);for(let me=0,ze=de.length;me<ze;me++)if(He=de[me],B.format!==sa)if(qe!==null)if(We){if(J)if(B.layerUpdates.size>0){const Ze=oF(He.width,He.height,B.format,B.type);for(const Je of B.layerUpdates){const mt=He.data.subarray(Je*Ze/He.data.BYTES_PER_ELEMENT,(Je+1)*Ze/He.data.BYTES_PER_ELEMENT);i.compressedTexSubImage3D(e.TEXTURE_2D_ARRAY,me,0,0,Je,He.width,He.height,1,qe,mt)}B.clearLayerUpdates()}else i.compressedTexSubImage3D(e.TEXTURE_2D_ARRAY,me,0,0,0,He.width,He.height,ke.depth,qe,He.data)}else i.compressedTexImage3D(e.TEXTURE_2D_ARRAY,me,it,He.width,He.height,ke.depth,0,He.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else We?J&&i.texSubImage3D(e.TEXTURE_2D_ARRAY,me,0,0,0,He.width,He.height,ke.depth,qe,Ke,He.data):i.texImage3D(e.TEXTURE_2D_ARRAY,me,it,He.width,He.height,ke.depth,0,qe,Ke,He.data)}else{We&&dt&&i.texStorage2D(e.TEXTURE_2D,xe,it,de[0].width,de[0].height);for(let me=0,ze=de.length;me<ze;me++)He=de[me],B.format!==sa?qe!==null?We?J&&i.compressedTexSubImage2D(e.TEXTURE_2D,me,0,0,He.width,He.height,qe,He.data):i.compressedTexImage2D(e.TEXTURE_2D,me,it,He.width,He.height,0,He.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):We?J&&i.texSubImage2D(e.TEXTURE_2D,me,0,0,He.width,He.height,qe,Ke,He.data):i.texImage2D(e.TEXTURE_2D,me,it,He.width,He.height,0,qe,Ke,He.data)}else if(B.isDataArrayTexture)if(We){if(dt&&i.texStorage3D(e.TEXTURE_2D_ARRAY,xe,it,ke.width,ke.height,ke.depth),J)if(B.layerUpdates.size>0){const me=oF(ke.width,ke.height,B.format,B.type);for(const ze of B.layerUpdates){const Ze=ke.data.subarray(ze*me/ke.data.BYTES_PER_ELEMENT,(ze+1)*me/ke.data.BYTES_PER_ELEMENT);i.texSubImage3D(e.TEXTURE_2D_ARRAY,0,0,0,ze,ke.width,ke.height,1,qe,Ke,Ze)}B.clearLayerUpdates()}else i.texSubImage3D(e.TEXTURE_2D_ARRAY,0,0,0,0,ke.width,ke.height,ke.depth,qe,Ke,ke.data)}else i.texImage3D(e.TEXTURE_2D_ARRAY,0,it,ke.width,ke.height,ke.depth,0,qe,Ke,ke.data);else if(B.isData3DTexture)We?(dt&&i.texStorage3D(e.TEXTURE_3D,xe,it,ke.width,ke.height,ke.depth),J&&i.texSubImage3D(e.TEXTURE_3D,0,0,0,0,ke.width,ke.height,ke.depth,qe,Ke,ke.data)):i.texImage3D(e.TEXTURE_3D,0,it,ke.width,ke.height,ke.depth,0,qe,Ke,ke.data);else if(B.isFramebufferTexture){if(dt)if(We)i.texStorage2D(e.TEXTURE_2D,xe,it,ke.width,ke.height);else{let me=ke.width,ze=ke.height;for(let Ze=0;Ze<xe;Ze++)i.texImage2D(e.TEXTURE_2D,Ze,it,me,ze,0,qe,Ke,null),me>>=1,ze>>=1}}else if(de.length>0){if(We&&dt){const me=Fe(de[0]);i.texStorage2D(e.TEXTURE_2D,xe,it,me.width,me.height)}for(let me=0,ze=de.length;me<ze;me++)He=de[me],We?J&&i.texSubImage2D(e.TEXTURE_2D,me,0,0,qe,Ke,He):i.texImage2D(e.TEXTURE_2D,me,it,qe,Ke,He);B.generateMipmaps=!1}else if(We){if(dt){const me=Fe(ke);i.texStorage2D(e.TEXTURE_2D,xe,it,me.width,me.height)}J&&i.texSubImage2D(e.TEXTURE_2D,0,0,0,qe,Ke,ke)}else i.texImage2D(e.TEXTURE_2D,0,it,qe,Ke,ke);m(B)&&g(oe),Ie.__version=W.version,B.onUpdate&&B.onUpdate(B)}K.__version=B.version}function ee(K,B,G){if(B.image.length!==6)return;const oe=re(K,B),fe=B.source;i.bindTexture(e.TEXTURE_CUBE_MAP,K.__webglTexture,e.TEXTURE0+G);const W=r.get(fe);if(fe.version!==W.__version||oe===!0){i.activeTexture(e.TEXTURE0+G);const Ie=Xi.getPrimaries(Xi.workingColorSpace),Oe=B.colorSpace===rh?null:Xi.getPrimaries(B.colorSpace),Be=B.colorSpace===rh||Ie===Oe?e.NONE:e.BROWSER_DEFAULT_WEBGL;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,B.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,B.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,B.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,Be);const Re=B.isCompressedTexture||B.image[0].isCompressedTexture,ke=B.image[0]&&B.image[0].isDataTexture,qe=[];for(let ze=0;ze<6;ze++)!Re&&!ke?qe[ze]=v(B.image[ze],!0,n.maxCubemapSize):qe[ze]=ke?B.image[ze].image:B.image[ze],qe[ze]=Le(B,qe[ze]);const Ke=qe[0],it=s.convert(B.format,B.colorSpace),He=s.convert(B.type),de=x(B.internalFormat,it,He,B.colorSpace),We=B.isVideoTexture!==!0,dt=W.__version===void 0||oe===!0,J=fe.dataReady;let xe=M(B,Ke);X(e.TEXTURE_CUBE_MAP,B);let me;if(Re){We&&dt&&i.texStorage2D(e.TEXTURE_CUBE_MAP,xe,de,Ke.width,Ke.height);for(let ze=0;ze<6;ze++){me=qe[ze].mipmaps;for(let Ze=0;Ze<me.length;Ze++){const Je=me[Ze];B.format!==sa?it!==null?We?J&&i.compressedTexSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+ze,Ze,0,0,Je.width,Je.height,it,Je.data):i.compressedTexImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+ze,Ze,de,Je.width,Je.height,0,Je.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):We?J&&i.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+ze,Ze,0,0,Je.width,Je.height,it,He,Je.data):i.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+ze,Ze,de,Je.width,Je.height,0,it,He,Je.data)}}}else{if(me=B.mipmaps,We&&dt){me.length>0&&xe++;const ze=Fe(qe[0]);i.texStorage2D(e.TEXTURE_CUBE_MAP,xe,de,ze.width,ze.height)}for(let ze=0;ze<6;ze++)if(ke){We?J&&i.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+ze,0,0,0,qe[ze].width,qe[ze].height,it,He,qe[ze].data):i.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+ze,0,de,qe[ze].width,qe[ze].height,0,it,He,qe[ze].data);for(let Ze=0;Ze<me.length;Ze++){const mt=me[Ze].image[ze].image;We?J&&i.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+ze,Ze+1,0,0,mt.width,mt.height,it,He,mt.data):i.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+ze,Ze+1,de,mt.width,mt.height,0,it,He,mt.data)}}else{We?J&&i.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+ze,0,0,0,it,He,qe[ze]):i.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+ze,0,de,it,He,qe[ze]);for(let Ze=0;Ze<me.length;Ze++){const Je=me[Ze];We?J&&i.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+ze,Ze+1,0,0,it,He,Je.image[ze]):i.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+ze,Ze+1,de,it,He,Je.image[ze])}}}m(B)&&g(e.TEXTURE_CUBE_MAP),W.__version=fe.version,B.onUpdate&&B.onUpdate(B)}K.__version=B.version}function $(K,B,G,oe,fe,W){const Ie=s.convert(G.format,G.colorSpace),Oe=s.convert(G.type),Be=x(G.internalFormat,Ie,Oe,G.colorSpace),Re=r.get(B),ke=r.get(G);if(ke.__renderTarget=B,!Re.__hasExternalTextures){const qe=Math.max(1,B.width>>W),Ke=Math.max(1,B.height>>W);fe===e.TEXTURE_3D||fe===e.TEXTURE_2D_ARRAY?i.texImage3D(fe,W,Be,qe,Ke,B.depth,0,Ie,Oe,null):i.texImage2D(fe,W,Be,qe,Ke,0,Ie,Oe,null)}i.bindFramebuffer(e.FRAMEBUFFER,K),Ne(B)?o.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,oe,fe,ke.__webglTexture,0,Pe(B)):(fe===e.TEXTURE_2D||fe>=e.TEXTURE_CUBE_MAP_POSITIVE_X&&fe<=e.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&e.framebufferTexture2D(e.FRAMEBUFFER,oe,fe,ke.__webglTexture,W),i.bindFramebuffer(e.FRAMEBUFFER,null)}function ne(K,B,G){if(e.bindRenderbuffer(e.RENDERBUFFER,K),B.depthBuffer){const oe=B.depthTexture,fe=oe&&oe.isDepthTexture?oe.type:null,W=_(B.stencilBuffer,fe),Ie=B.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,Oe=Pe(B);Ne(B)?o.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,Oe,W,B.width,B.height):G?e.renderbufferStorageMultisample(e.RENDERBUFFER,Oe,W,B.width,B.height):e.renderbufferStorage(e.RENDERBUFFER,W,B.width,B.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,Ie,e.RENDERBUFFER,K)}else{const oe=B.textures;for(let fe=0;fe<oe.length;fe++){const W=oe[fe],Ie=s.convert(W.format,W.colorSpace),Oe=s.convert(W.type),Be=x(W.internalFormat,Ie,Oe,W.colorSpace),Re=Pe(B);G&&Ne(B)===!1?e.renderbufferStorageMultisample(e.RENDERBUFFER,Re,Be,B.width,B.height):Ne(B)?o.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,Re,Be,B.width,B.height):e.renderbufferStorage(e.RENDERBUFFER,Be,B.width,B.height)}}e.bindRenderbuffer(e.RENDERBUFFER,null)}function ce(K,B){if(B&&B.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(i.bindFramebuffer(e.FRAMEBUFFER,K),!(B.depthTexture&&B.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const oe=r.get(B.depthTexture);oe.__renderTarget=B,(!oe.__webglTexture||B.depthTexture.image.width!==B.width||B.depthTexture.image.height!==B.height)&&(B.depthTexture.image.width=B.width,B.depthTexture.image.height=B.height,B.depthTexture.needsUpdate=!0),H(B.depthTexture,0);const fe=oe.__webglTexture,W=Pe(B);if(B.depthTexture.format===dm)Ne(B)?o.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,fe,0,W):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,fe,0);else if(B.depthTexture.format===Om)Ne(B)?o.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,fe,0,W):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,fe,0);else throw new Error("Unknown depthTexture format")}function pe(K){const B=r.get(K),G=K.isWebGLCubeRenderTarget===!0;if(B.__boundDepthTexture!==K.depthTexture){const oe=K.depthTexture;if(B.__depthDisposeCallback&&B.__depthDisposeCallback(),oe){const fe=()=>{delete B.__boundDepthTexture,delete B.__depthDisposeCallback,oe.removeEventListener("dispose",fe)};oe.addEventListener("dispose",fe),B.__depthDisposeCallback=fe}B.__boundDepthTexture=oe}if(K.depthTexture&&!B.__autoAllocateDepthBuffer){if(G)throw new Error("target.depthTexture not supported in Cube render targets");ce(B.__webglFramebuffer,K)}else if(G){B.__webglDepthbuffer=[];for(let oe=0;oe<6;oe++)if(i.bindFramebuffer(e.FRAMEBUFFER,B.__webglFramebuffer[oe]),B.__webglDepthbuffer[oe]===void 0)B.__webglDepthbuffer[oe]=e.createRenderbuffer(),ne(B.__webglDepthbuffer[oe],K,!1);else{const fe=K.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,W=B.__webglDepthbuffer[oe];e.bindRenderbuffer(e.RENDERBUFFER,W),e.framebufferRenderbuffer(e.FRAMEBUFFER,fe,e.RENDERBUFFER,W)}}else if(i.bindFramebuffer(e.FRAMEBUFFER,B.__webglFramebuffer),B.__webglDepthbuffer===void 0)B.__webglDepthbuffer=e.createRenderbuffer(),ne(B.__webglDepthbuffer,K,!1);else{const oe=K.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,fe=B.__webglDepthbuffer;e.bindRenderbuffer(e.RENDERBUFFER,fe),e.framebufferRenderbuffer(e.FRAMEBUFFER,oe,e.RENDERBUFFER,fe)}i.bindFramebuffer(e.FRAMEBUFFER,null)}function ge(K,B,G){const oe=r.get(K);B!==void 0&&$(oe.__webglFramebuffer,K,K.texture,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,0),G!==void 0&&pe(K)}function we(K){const B=K.texture,G=r.get(K),oe=r.get(B);K.addEventListener("dispose",T);const fe=K.textures,W=K.isWebGLCubeRenderTarget===!0,Ie=fe.length>1;if(Ie||(oe.__webglTexture===void 0&&(oe.__webglTexture=e.createTexture()),oe.__version=B.version,a.memory.textures++),W){G.__webglFramebuffer=[];for(let Oe=0;Oe<6;Oe++)if(B.mipmaps&&B.mipmaps.length>0){G.__webglFramebuffer[Oe]=[];for(let Be=0;Be<B.mipmaps.length;Be++)G.__webglFramebuffer[Oe][Be]=e.createFramebuffer()}else G.__webglFramebuffer[Oe]=e.createFramebuffer()}else{if(B.mipmaps&&B.mipmaps.length>0){G.__webglFramebuffer=[];for(let Oe=0;Oe<B.mipmaps.length;Oe++)G.__webglFramebuffer[Oe]=e.createFramebuffer()}else G.__webglFramebuffer=e.createFramebuffer();if(Ie)for(let Oe=0,Be=fe.length;Oe<Be;Oe++){const Re=r.get(fe[Oe]);Re.__webglTexture===void 0&&(Re.__webglTexture=e.createTexture(),a.memory.textures++)}if(K.samples>0&&Ne(K)===!1){G.__webglMultisampledFramebuffer=e.createFramebuffer(),G.__webglColorRenderbuffer=[],i.bindFramebuffer(e.FRAMEBUFFER,G.__webglMultisampledFramebuffer);for(let Oe=0;Oe<fe.length;Oe++){const Be=fe[Oe];G.__webglColorRenderbuffer[Oe]=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,G.__webglColorRenderbuffer[Oe]);const Re=s.convert(Be.format,Be.colorSpace),ke=s.convert(Be.type),qe=x(Be.internalFormat,Re,ke,Be.colorSpace,K.isXRRenderTarget===!0),Ke=Pe(K);e.renderbufferStorageMultisample(e.RENDERBUFFER,Ke,qe,K.width,K.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+Oe,e.RENDERBUFFER,G.__webglColorRenderbuffer[Oe])}e.bindRenderbuffer(e.RENDERBUFFER,null),K.depthBuffer&&(G.__webglDepthRenderbuffer=e.createRenderbuffer(),ne(G.__webglDepthRenderbuffer,K,!0)),i.bindFramebuffer(e.FRAMEBUFFER,null)}}if(W){i.bindTexture(e.TEXTURE_CUBE_MAP,oe.__webglTexture),X(e.TEXTURE_CUBE_MAP,B);for(let Oe=0;Oe<6;Oe++)if(B.mipmaps&&B.mipmaps.length>0)for(let Be=0;Be<B.mipmaps.length;Be++)$(G.__webglFramebuffer[Oe][Be],K,B,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+Oe,Be);else $(G.__webglFramebuffer[Oe],K,B,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+Oe,0);m(B)&&g(e.TEXTURE_CUBE_MAP),i.unbindTexture()}else if(Ie){for(let Oe=0,Be=fe.length;Oe<Be;Oe++){const Re=fe[Oe],ke=r.get(Re);i.bindTexture(e.TEXTURE_2D,ke.__webglTexture),X(e.TEXTURE_2D,Re),$(G.__webglFramebuffer,K,Re,e.COLOR_ATTACHMENT0+Oe,e.TEXTURE_2D,0),m(Re)&&g(e.TEXTURE_2D)}i.unbindTexture()}else{let Oe=e.TEXTURE_2D;if((K.isWebGL3DRenderTarget||K.isWebGLArrayRenderTarget)&&(Oe=K.isWebGL3DRenderTarget?e.TEXTURE_3D:e.TEXTURE_2D_ARRAY),i.bindTexture(Oe,oe.__webglTexture),X(Oe,B),B.mipmaps&&B.mipmaps.length>0)for(let Be=0;Be<B.mipmaps.length;Be++)$(G.__webglFramebuffer[Be],K,B,e.COLOR_ATTACHMENT0,Oe,Be);else $(G.__webglFramebuffer,K,B,e.COLOR_ATTACHMENT0,Oe,0);m(B)&&g(Oe),i.unbindTexture()}K.depthBuffer&&pe(K)}function le(K){const B=K.textures;for(let G=0,oe=B.length;G<oe;G++){const fe=B[G];if(m(fe)){const W=y(K),Ie=r.get(fe).__webglTexture;i.bindTexture(W,Ie),g(W),i.unbindTexture()}}}const ve=[],ie=[];function Ce(K){if(K.samples>0){if(Ne(K)===!1){const B=K.textures,G=K.width,oe=K.height;let fe=e.COLOR_BUFFER_BIT;const W=K.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,Ie=r.get(K),Oe=B.length>1;if(Oe)for(let Be=0;Be<B.length;Be++)i.bindFramebuffer(e.FRAMEBUFFER,Ie.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+Be,e.RENDERBUFFER,null),i.bindFramebuffer(e.FRAMEBUFFER,Ie.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+Be,e.TEXTURE_2D,null,0);i.bindFramebuffer(e.READ_FRAMEBUFFER,Ie.__webglMultisampledFramebuffer),i.bindFramebuffer(e.DRAW_FRAMEBUFFER,Ie.__webglFramebuffer);for(let Be=0;Be<B.length;Be++){if(K.resolveDepthBuffer&&(K.depthBuffer&&(fe|=e.DEPTH_BUFFER_BIT),K.stencilBuffer&&K.resolveStencilBuffer&&(fe|=e.STENCIL_BUFFER_BIT)),Oe){e.framebufferRenderbuffer(e.READ_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,Ie.__webglColorRenderbuffer[Be]);const Re=r.get(B[Be]).__webglTexture;e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,Re,0)}e.blitFramebuffer(0,0,G,oe,0,0,G,oe,fe,e.NEAREST),l===!0&&(ve.length=0,ie.length=0,ve.push(e.COLOR_ATTACHMENT0+Be),K.depthBuffer&&K.resolveDepthBuffer===!1&&(ve.push(W),ie.push(W),e.invalidateFramebuffer(e.DRAW_FRAMEBUFFER,ie)),e.invalidateFramebuffer(e.READ_FRAMEBUFFER,ve))}if(i.bindFramebuffer(e.READ_FRAMEBUFFER,null),i.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),Oe)for(let Be=0;Be<B.length;Be++){i.bindFramebuffer(e.FRAMEBUFFER,Ie.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+Be,e.RENDERBUFFER,Ie.__webglColorRenderbuffer[Be]);const Re=r.get(B[Be]).__webglTexture;i.bindFramebuffer(e.FRAMEBUFFER,Ie.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+Be,e.TEXTURE_2D,Re,0)}i.bindFramebuffer(e.DRAW_FRAMEBUFFER,Ie.__webglMultisampledFramebuffer)}else if(K.depthBuffer&&K.resolveDepthBuffer===!1&&l){const B=K.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT;e.invalidateFramebuffer(e.DRAW_FRAMEBUFFER,[B])}}}function Pe(K){return Math.min(n.maxSamples,K.samples)}function Ne(K){const B=r.get(K);return K.samples>0&&t.has("WEBGL_multisampled_render_to_texture")===!0&&B.__useRenderToTexture!==!1}function be(K){const B=a.render.frame;u.get(K)!==B&&(u.set(K,B),K.update())}function Le(K,B){const G=K.colorSpace,oe=K.format,fe=K.type;return K.isCompressedTexture===!0||K.isVideoTexture===!0||G!==zm&&G!==rh&&(Xi.getTransfer(G)===sr?(oe!==sa||fe!==lc)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",G)),B}function Fe(K){return typeof HTMLImageElement<"u"&&K instanceof HTMLImageElement?(c.width=K.naturalWidth||K.width,c.height=K.naturalHeight||K.height):typeof VideoFrame<"u"&&K instanceof VideoFrame?(c.width=K.displayWidth,c.height=K.displayHeight):(c.width=K.width,c.height=K.height),c}this.allocateTextureUnit=L,this.resetTextureUnits=R,this.setTexture2D=H,this.setTexture2DArray=j,this.setTexture3D=Y,this.setTextureCube=z,this.rebindTextures=ge,this.setupRenderTarget=we,this.updateRenderTargetMipmap=le,this.updateMultisampleRenderTarget=Ce,this.setupDepthRenderbuffer=pe,this.setupFrameBufferTexture=$,this.useMultisampledRTT=Ne}function kse(e,t){function i(r,n=rh){let s;const a=Xi.getTransfer(n);if(r===lc)return e.UNSIGNED_BYTE;if(r===iP)return e.UNSIGNED_SHORT_4_4_4_4;if(r===rP)return e.UNSIGNED_SHORT_5_5_5_1;if(r===U4)return e.UNSIGNED_INT_5_9_9_9_REV;if(r===B4)return e.BYTE;if(r===F4)return e.SHORT;if(r===q0)return e.UNSIGNED_SHORT;if(r===tP)return e.INT;if(r===zh)return e.UNSIGNED_INT;if(r===so)return e.FLOAT;if(r===_y)return e.HALF_FLOAT;if(r===N4)return e.ALPHA;if(r===k4)return e.RGB;if(r===sa)return e.RGBA;if(r===V4)return e.LUMINANCE;if(r===G4)return e.LUMINANCE_ALPHA;if(r===dm)return e.DEPTH_COMPONENT;if(r===Om)return e.DEPTH_STENCIL;if(r===nP)return e.RED;if(r===Wb)return e.RED_INTEGER;if(r===H4)return e.RG;if(r===sP)return e.RG_INTEGER;if(r===aP)return e.RGBA_INTEGER;if(r===Yx||r===Qx||r===Zx||r===Kx)if(a===sr)if(s=t.get("WEBGL_compressed_texture_s3tc_srgb"),s!==null){if(r===Yx)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(r===Qx)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(r===Zx)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(r===Kx)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(s=t.get("WEBGL_compressed_texture_s3tc"),s!==null){if(r===Yx)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(r===Qx)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(r===Zx)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(r===Kx)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(r===ST||r===MT||r===ET||r===AT)if(s=t.get("WEBGL_compressed_texture_pvrtc"),s!==null){if(r===ST)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(r===MT)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(r===ET)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(r===AT)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(r===TT||r===CT||r===PT)if(s=t.get("WEBGL_compressed_texture_etc"),s!==null){if(r===TT||r===CT)return a===sr?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(r===PT)return a===sr?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(r===DT||r===RT||r===IT||r===LT||r===OT||r===zT||r===BT||r===FT||r===UT||r===NT||r===kT||r===VT||r===GT||r===HT)if(s=t.get("WEBGL_compressed_texture_astc"),s!==null){if(r===DT)return a===sr?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(r===RT)return a===sr?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(r===IT)return a===sr?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(r===LT)return a===sr?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(r===OT)return a===sr?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(r===zT)return a===sr?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(r===BT)return a===sr?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(r===FT)return a===sr?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(r===UT)return a===sr?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(r===NT)return a===sr?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(r===kT)return a===sr?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(r===VT)return a===sr?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(r===GT)return a===sr?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(r===HT)return a===sr?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(r===Jx||r===jT||r===WT)if(s=t.get("EXT_texture_compression_bptc"),s!==null){if(r===Jx)return a===sr?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(r===jT)return s.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(r===WT)return s.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(r===j4||r===XT||r===qT||r===YT)if(s=t.get("EXT_texture_compression_rgtc"),s!==null){if(r===Jx)return s.COMPRESSED_RED_RGTC1_EXT;if(r===XT)return s.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(r===qT)return s.COMPRESSED_RED_GREEN_RGTC2_EXT;if(r===YT)return s.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return r===Lm?e.UNSIGNED_INT_24_8:e[r]!==void 0?e[r]:null}return{convert:i}}const oXe=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,lXe=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class cXe{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(t,i,r){if(this.texture===null){const n=new Wr,s=t.properties.get(n);s.__webglTexture=i.texture,(i.depthNear!==r.depthNear||i.depthFar!==r.depthFar)&&(this.depthNear=i.depthNear,this.depthFar=i.depthFar),this.texture=n}}getMesh(t){if(this.texture!==null&&this.mesh===null){const i=t.cameras[0].viewport,r=new cc({vertexShader:oXe,fragmentShader:lXe,uniforms:{depthColor:{value:this.texture},depthWidth:{value:i.z},depthHeight:{value:i.w}}});this.mesh=new Gr(new Vh(20,20),r)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class uXe extends pu{constructor(t,i){super();const r=this;let n=null,s=1,a=null,o="local-floor",l=1,c=null,u=null,h=null,d=null,f=null,p=null;const v=new cXe,m=i.getContextAttributes();let g=null,y=null;const x=[],_=[],M=new ut;let S=null;const T=new fn;T.viewport=new Hi;const E=new fn;E.viewport=new Hi;const C=[T,E],A=new Pse;let D=null,R=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(q){let ee=x[q];return ee===void 0&&(ee=new y2,x[q]=ee),ee.getTargetRaySpace()},this.getControllerGrip=function(q){let ee=x[q];return ee===void 0&&(ee=new y2,x[q]=ee),ee.getGripSpace()},this.getHand=function(q){let ee=x[q];return ee===void 0&&(ee=new y2,x[q]=ee),ee.getHandSpace()};function L(q){const ee=_.indexOf(q.inputSource);if(ee===-1)return;const $=x[ee];$!==void 0&&($.update(q.inputSource,q.frame,c||a),$.dispatchEvent({type:q.type,data:q.inputSource}))}function O(){n.removeEventListener("select",L),n.removeEventListener("selectstart",L),n.removeEventListener("selectend",L),n.removeEventListener("squeeze",L),n.removeEventListener("squeezestart",L),n.removeEventListener("squeezeend",L),n.removeEventListener("end",O),n.removeEventListener("inputsourceschange",H);for(let q=0;q<x.length;q++){const ee=_[q];ee!==null&&(_[q]=null,x[q].disconnect(ee))}D=null,R=null,v.reset(),t.setRenderTarget(g),f=null,d=null,h=null,n=null,y=null,re.stop(),r.isPresenting=!1,t.setPixelRatio(S),t.setSize(M.width,M.height,!1),r.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(q){s=q,r.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(q){o=q,r.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return c||a},this.setReferenceSpace=function(q){c=q},this.getBaseLayer=function(){return d!==null?d:f},this.getBinding=function(){return h},this.getFrame=function(){return p},this.getSession=function(){return n},this.setSession=async function(q){if(n=q,n!==null){if(g=t.getRenderTarget(),n.addEventListener("select",L),n.addEventListener("selectstart",L),n.addEventListener("selectend",L),n.addEventListener("squeeze",L),n.addEventListener("squeezestart",L),n.addEventListener("squeezeend",L),n.addEventListener("end",O),n.addEventListener("inputsourceschange",H),m.xrCompatible!==!0&&await i.makeXRCompatible(),S=t.getPixelRatio(),t.getSize(M),typeof XRWebGLBinding<"u"&&"createProjectionLayer"in XRWebGLBinding.prototype){let $=null,ne=null,ce=null;m.depth&&(ce=m.stencil?i.DEPTH24_STENCIL8:i.DEPTH_COMPONENT24,$=m.stencil?Om:dm,ne=m.stencil?Lm:zh);const pe={colorFormat:i.RGBA8,depthFormat:ce,scaleFactor:s};h=new XRWebGLBinding(n,i),d=h.createProjectionLayer(pe),n.updateRenderState({layers:[d]}),t.setPixelRatio(1),t.setSize(d.textureWidth,d.textureHeight,!1),y=new uu(d.textureWidth,d.textureHeight,{format:sa,type:lc,depthTexture:new ik(d.textureWidth,d.textureHeight,ne,void 0,void 0,void 0,void 0,void 0,void 0,$),stencilBuffer:m.stencil,colorSpace:t.outputColorSpace,samples:m.antialias?4:0,resolveDepthBuffer:d.ignoreDepthValues===!1,resolveStencilBuffer:d.ignoreDepthValues===!1})}else{const $={antialias:m.antialias,alpha:!0,depth:m.depth,stencil:m.stencil,framebufferScaleFactor:s};f=new XRWebGLLayer(n,i,$),n.updateRenderState({baseLayer:f}),t.setPixelRatio(1),t.setSize(f.framebufferWidth,f.framebufferHeight,!1),y=new uu(f.framebufferWidth,f.framebufferHeight,{format:sa,type:lc,colorSpace:t.outputColorSpace,stencilBuffer:m.stencil,resolveDepthBuffer:f.ignoreDepthValues===!1,resolveStencilBuffer:f.ignoreDepthValues===!1})}y.isXRRenderTarget=!0,this.setFoveation(l),c=null,a=await n.requestReferenceSpace(o),re.setContext(n),re.start(),r.isPresenting=!0,r.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(n!==null)return n.environmentBlendMode},this.getDepthTexture=function(){return v.getDepthTexture()};function H(q){for(let ee=0;ee<q.removed.length;ee++){const $=q.removed[ee],ne=_.indexOf($);ne>=0&&(_[ne]=null,x[ne].disconnect($))}for(let ee=0;ee<q.added.length;ee++){const $=q.added[ee];let ne=_.indexOf($);if(ne===-1){for(let pe=0;pe<x.length;pe++)if(pe>=_.length){_.push($),ne=pe;break}else if(_[pe]===null){_[pe]=$,ne=pe;break}if(ne===-1)break}const ce=x[ne];ce&&ce.connect($)}}const j=new he,Y=new he;function z(q,ee,$){j.setFromMatrixPosition(ee.matrixWorld),Y.setFromMatrixPosition($.matrixWorld);const ne=j.distanceTo(Y),ce=ee.projectionMatrix.elements,pe=$.projectionMatrix.elements,ge=ce[14]/(ce[10]-1),we=ce[14]/(ce[10]+1),le=(ce[9]+1)/ce[5],ve=(ce[9]-1)/ce[5],ie=(ce[8]-1)/ce[0],Ce=(pe[8]+1)/pe[0],Pe=ge*ie,Ne=ge*Ce,be=ne/(-ie+Ce),Le=be*-ie;if(ee.matrixWorld.decompose(q.position,q.quaternion,q.scale),q.translateX(Le),q.translateZ(be),q.matrixWorld.compose(q.position,q.quaternion,q.scale),q.matrixWorldInverse.copy(q.matrixWorld).invert(),ce[10]===-1)q.projectionMatrix.copy(ee.projectionMatrix),q.projectionMatrixInverse.copy(ee.projectionMatrixInverse);else{const Fe=ge+be,K=we+be,B=Pe-Le,G=Ne+(ne-Le),oe=le*we/K*Fe,fe=ve*we/K*Fe;q.projectionMatrix.makePerspective(B,G,oe,fe,Fe,K),q.projectionMatrixInverse.copy(q.projectionMatrix).invert()}}function V(q,ee){ee===null?q.matrixWorld.copy(q.matrix):q.matrixWorld.multiplyMatrices(ee.matrixWorld,q.matrix),q.matrixWorldInverse.copy(q.matrixWorld).invert()}this.updateCamera=function(q){if(n===null)return;let ee=q.near,$=q.far;v.texture!==null&&(v.depthNear>0&&(ee=v.depthNear),v.depthFar>0&&($=v.depthFar)),A.near=E.near=T.near=ee,A.far=E.far=T.far=$,(D!==A.near||R!==A.far)&&(n.updateRenderState({depthNear:A.near,depthFar:A.far}),D=A.near,R=A.far),T.layers.mask=q.layers.mask|2,E.layers.mask=q.layers.mask|4,A.layers.mask=T.layers.mask|E.layers.mask;const ne=q.parent,ce=A.cameras;V(A,ne);for(let pe=0;pe<ce.length;pe++)V(ce[pe],ne);ce.length===2?z(A,T,E):A.projectionMatrix.copy(T.projectionMatrix),U(q,A,ne)};function U(q,ee,$){$===null?q.matrix.copy(ee.matrixWorld):(q.matrix.copy($.matrixWorld),q.matrix.invert(),q.matrix.multiply(ee.matrixWorld)),q.matrix.decompose(q.position,q.quaternion,q.scale),q.updateMatrixWorld(!0),q.projectionMatrix.copy(ee.projectionMatrix),q.projectionMatrixInverse.copy(ee.projectionMatrixInverse),q.isPerspectiveCamera&&(q.fov=Y0*2*Math.atan(1/q.projectionMatrix.elements[5]),q.zoom=1)}this.getCamera=function(){return A},this.getFoveation=function(){if(!(d===null&&f===null))return l},this.setFoveation=function(q){l=q,d!==null&&(d.fixedFoveation=q),f!==null&&f.fixedFoveation!==void 0&&(f.fixedFoveation=q)},this.hasDepthSensing=function(){return v.texture!==null},this.getDepthSensingMesh=function(){return v.getMesh(A)};let k=null;function X(q,ee){if(u=ee.getViewerPose(c||a),p=ee,u!==null){const $=u.views;f!==null&&(t.setRenderTargetFramebuffer(y,f.framebuffer),t.setRenderTarget(y));let ne=!1;$.length!==A.cameras.length&&(A.cameras.length=0,ne=!0);for(let ge=0;ge<$.length;ge++){const we=$[ge];let le=null;if(f!==null)le=f.getViewport(we);else{const ie=h.getViewSubImage(d,we);le=ie.viewport,ge===0&&(t.setRenderTargetTextures(y,ie.colorTexture,d.ignoreDepthValues?void 0:ie.depthStencilTexture),t.setRenderTarget(y))}let ve=C[ge];ve===void 0&&(ve=new fn,ve.layers.enable(ge),ve.viewport=new Hi,C[ge]=ve),ve.matrix.fromArray(we.transform.matrix),ve.matrix.decompose(ve.position,ve.quaternion,ve.scale),ve.projectionMatrix.fromArray(we.projectionMatrix),ve.projectionMatrixInverse.copy(ve.projectionMatrix).invert(),ve.viewport.set(le.x,le.y,le.width,le.height),ge===0&&(A.matrix.copy(ve.matrix),A.matrix.decompose(A.position,A.quaternion,A.scale)),ne===!0&&A.cameras.push(ve)}const ce=n.enabledFeatures;if(ce&&ce.includes("depth-sensing")&&n.depthUsage=="gpu-optimized"&&h){const ge=h.getDepthInformation($[0]);ge&&ge.isValid&&ge.texture&&v.init(t,ge,n.renderState)}}for(let $=0;$<x.length;$++){const ne=_[$],ce=x[$];ne!==null&&ce!==void 0&&ce.update(ne,ee,c||a)}k&&k(q,ee),ee.detectedPlanes&&r.dispatchEvent({type:"planesdetected",data:ee}),p=null}const re=new zse;re.setAnimationLoop(X),this.setAnimationLoop=function(q){k=q},this.dispose=function(){}}}const vp=new Fo,hXe=new ci;function dXe(e,t){function i(m,g){m.matrixAutoUpdate===!0&&m.updateMatrix(),g.value.copy(m.matrix)}function r(m,g){g.color.getRGB(m.fogColor.value,Une(e)),g.isFog?(m.fogNear.value=g.near,m.fogFar.value=g.far):g.isFogExp2&&(m.fogDensity.value=g.density)}function n(m,g,y,x,_){g.isMeshBasicMaterial||g.isMeshLambertMaterial?s(m,g):g.isMeshToonMaterial?(s(m,g),h(m,g)):g.isMeshPhongMaterial?(s(m,g),u(m,g)):g.isMeshStandardMaterial?(s(m,g),d(m,g),g.isMeshPhysicalMaterial&&f(m,g,_)):g.isMeshMatcapMaterial?(s(m,g),p(m,g)):g.isMeshDepthMaterial?s(m,g):g.isMeshDistanceMaterial?(s(m,g),v(m,g)):g.isMeshNormalMaterial?s(m,g):g.isLineBasicMaterial?(a(m,g),g.isLineDashedMaterial&&o(m,g)):g.isPointsMaterial?l(m,g,y,x):g.isSpriteMaterial?c(m,g):g.isShadowMaterial?(m.color.value.copy(g.color),m.opacity.value=g.opacity):g.isShaderMaterial&&(g.uniformsNeedUpdate=!1)}function s(m,g){m.opacity.value=g.opacity,g.color&&m.diffuse.value.copy(g.color),g.emissive&&m.emissive.value.copy(g.emissive).multiplyScalar(g.emissiveIntensity),g.map&&(m.map.value=g.map,i(g.map,m.mapTransform)),g.alphaMap&&(m.alphaMap.value=g.alphaMap,i(g.alphaMap,m.alphaMapTransform)),g.bumpMap&&(m.bumpMap.value=g.bumpMap,i(g.bumpMap,m.bumpMapTransform),m.bumpScale.value=g.bumpScale,g.side===La&&(m.bumpScale.value*=-1)),g.normalMap&&(m.normalMap.value=g.normalMap,i(g.normalMap,m.normalMapTransform),m.normalScale.value.copy(g.normalScale),g.side===La&&m.normalScale.value.negate()),g.displacementMap&&(m.displacementMap.value=g.displacementMap,i(g.displacementMap,m.displacementMapTransform),m.displacementScale.value=g.displacementScale,m.displacementBias.value=g.displacementBias),g.emissiveMap&&(m.emissiveMap.value=g.emissiveMap,i(g.emissiveMap,m.emissiveMapTransform)),g.specularMap&&(m.specularMap.value=g.specularMap,i(g.specularMap,m.specularMapTransform)),g.alphaTest>0&&(m.alphaTest.value=g.alphaTest);const y=t.get(g),x=y.envMap,_=y.envMapRotation;x&&(m.envMap.value=x,vp.copy(_),vp.x*=-1,vp.y*=-1,vp.z*=-1,x.isCubeTexture&&x.isRenderTargetTexture===!1&&(vp.y*=-1,vp.z*=-1),m.envMapRotation.value.setFromMatrix4(hXe.makeRotationFromEuler(vp)),m.flipEnvMap.value=x.isCubeTexture&&x.isRenderTargetTexture===!1?-1:1,m.reflectivity.value=g.reflectivity,m.ior.value=g.ior,m.refractionRatio.value=g.refractionRatio),g.lightMap&&(m.lightMap.value=g.lightMap,m.lightMapIntensity.value=g.lightMapIntensity,i(g.lightMap,m.lightMapTransform)),g.aoMap&&(m.aoMap.value=g.aoMap,m.aoMapIntensity.value=g.aoMapIntensity,i(g.aoMap,m.aoMapTransform))}function a(m,g){m.diffuse.value.copy(g.color),m.opacity.value=g.opacity,g.map&&(m.map.value=g.map,i(g.map,m.mapTransform))}function o(m,g){m.dashSize.value=g.dashSize,m.totalSize.value=g.dashSize+g.gapSize,m.scale.value=g.scale}function l(m,g,y,x){m.diffuse.value.copy(g.color),m.opacity.value=g.opacity,m.size.value=g.size*y,m.scale.value=x*.5,g.map&&(m.map.value=g.map,i(g.map,m.uvTransform)),g.alphaMap&&(m.alphaMap.value=g.alphaMap,i(g.alphaMap,m.alphaMapTransform)),g.alphaTest>0&&(m.alphaTest.value=g.alphaTest)}function c(m,g){m.diffuse.value.copy(g.color),m.opacity.value=g.opacity,m.rotation.value=g.rotation,g.map&&(m.map.value=g.map,i(g.map,m.mapTransform)),g.alphaMap&&(m.alphaMap.value=g.alphaMap,i(g.alphaMap,m.alphaMapTransform)),g.alphaTest>0&&(m.alphaTest.value=g.alphaTest)}function u(m,g){m.specular.value.copy(g.specular),m.shininess.value=Math.max(g.shininess,1e-4)}function h(m,g){g.gradientMap&&(m.gradientMap.value=g.gradientMap)}function d(m,g){m.metalness.value=g.metalness,g.metalnessMap&&(m.metalnessMap.value=g.metalnessMap,i(g.metalnessMap,m.metalnessMapTransform)),m.roughness.value=g.roughness,g.roughnessMap&&(m.roughnessMap.value=g.roughnessMap,i(g.roughnessMap,m.roughnessMapTransform)),g.envMap&&(m.envMapIntensity.value=g.envMapIntensity)}function f(m,g,y){m.ior.value=g.ior,g.sheen>0&&(m.sheenColor.value.copy(g.sheenColor).multiplyScalar(g.sheen),m.sheenRoughness.value=g.sheenRoughness,g.sheenColorMap&&(m.sheenColorMap.value=g.sheenColorMap,i(g.sheenColorMap,m.sheenColorMapTransform)),g.sheenRoughnessMap&&(m.sheenRoughnessMap.value=g.sheenRoughnessMap,i(g.sheenRoughnessMap,m.sheenRoughnessMapTransform))),g.clearcoat>0&&(m.clearcoat.value=g.clearcoat,m.clearcoatRoughness.value=g.clearcoatRoughness,g.clearcoatMap&&(m.clearcoatMap.value=g.clearcoatMap,i(g.clearcoatMap,m.clearcoatMapTransform)),g.clearcoatRoughnessMap&&(m.clearcoatRoughnessMap.value=g.clearcoatRoughnessMap,i(g.clearcoatRoughnessMap,m.clearcoatRoughnessMapTransform)),g.clearcoatNormalMap&&(m.clearcoatNormalMap.value=g.clearcoatNormalMap,i(g.clearcoatNormalMap,m.clearcoatNormalMapTransform),m.clearcoatNormalScale.value.copy(g.clearcoatNormalScale),g.side===La&&m.clearcoatNormalScale.value.negate())),g.dispersion>0&&(m.dispersion.value=g.dispersion),g.iridescence>0&&(m.iridescence.value=g.iridescence,m.iridescenceIOR.value=g.iridescenceIOR,m.iridescenceThicknessMinimum.value=g.iridescenceThicknessRange[0],m.iridescenceThicknessMaximum.value=g.iridescenceThicknessRange[1],g.iridescenceMap&&(m.iridescenceMap.value=g.iridescenceMap,i(g.iridescenceMap,m.iridescenceMapTransform)),g.iridescenceThicknessMap&&(m.iridescenceThicknessMap.value=g.iridescenceThicknessMap,i(g.iridescenceThicknessMap,m.iridescenceThicknessMapTransform))),g.transmission>0&&(m.transmission.value=g.transmission,m.transmissionSamplerMap.value=y.texture,m.transmissionSamplerSize.value.set(y.width,y.height),g.transmissionMap&&(m.transmissionMap.value=g.transmissionMap,i(g.transmissionMap,m.transmissionMapTransform)),m.thickness.value=g.thickness,g.thicknessMap&&(m.thicknessMap.value=g.thicknessMap,i(g.thicknessMap,m.thicknessMapTransform)),m.attenuationDistance.value=g.attenuationDistance,m.attenuationColor.value.copy(g.attenuationColor)),g.anisotropy>0&&(m.anisotropyVector.value.set(g.anisotropy*Math.cos(g.anisotropyRotation),g.anisotropy*Math.sin(g.anisotropyRotation)),g.anisotropyMap&&(m.anisotropyMap.value=g.anisotropyMap,i(g.anisotropyMap,m.anisotropyMapTransform))),m.specularIntensity.value=g.specularIntensity,m.specularColor.value.copy(g.specularColor),g.specularColorMap&&(m.specularColorMap.value=g.specularColorMap,i(g.specularColorMap,m.specularColorMapTransform)),g.specularIntensityMap&&(m.specularIntensityMap.value=g.specularIntensityMap,i(g.specularIntensityMap,m.specularIntensityMapTransform))}function p(m,g){g.matcap&&(m.matcap.value=g.matcap)}function v(m,g){const y=t.get(g).light;m.referencePosition.value.setFromMatrixPosition(y.matrixWorld),m.nearDistance.value=y.shadow.camera.near,m.farDistance.value=y.shadow.camera.far}return{refreshFogUniforms:r,refreshMaterialUniforms:n}}function fXe(e,t,i,r){let n={},s={},a=[];const o=e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS);function l(y,x){const _=x.program;r.uniformBlockBinding(y,_)}function c(y,x){let _=n[y.id];_===void 0&&(p(y),_=u(y),n[y.id]=_,y.addEventListener("dispose",m));const M=x.program;r.updateUBOMapping(y,M);const S=t.render.frame;s[y.id]!==S&&(d(y),s[y.id]=S)}function u(y){const x=h();y.__bindingPointIndex=x;const _=e.createBuffer(),M=y.__size,S=y.usage;return e.bindBuffer(e.UNIFORM_BUFFER,_),e.bufferData(e.UNIFORM_BUFFER,M,S),e.bindBuffer(e.UNIFORM_BUFFER,null),e.bindBufferBase(e.UNIFORM_BUFFER,x,_),_}function h(){for(let y=0;y<o;y++)if(a.indexOf(y)===-1)return a.push(y),y;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function d(y){const x=n[y.id],_=y.uniforms,M=y.__cache;e.bindBuffer(e.UNIFORM_BUFFER,x);for(let S=0,T=_.length;S<T;S++){const E=Array.isArray(_[S])?_[S]:[_[S]];for(let C=0,A=E.length;C<A;C++){const D=E[C];if(f(D,S,C,M)===!0){const R=D.__offset,L=Array.isArray(D.value)?D.value:[D.value];let O=0;for(let H=0;H<L.length;H++){const j=L[H],Y=v(j);typeof j=="number"||typeof j=="boolean"?(D.__data[0]=j,e.bufferSubData(e.UNIFORM_BUFFER,R+O,D.__data)):j.isMatrix3?(D.__data[0]=j.elements[0],D.__data[1]=j.elements[1],D.__data[2]=j.elements[2],D.__data[3]=0,D.__data[4]=j.elements[3],D.__data[5]=j.elements[4],D.__data[6]=j.elements[5],D.__data[7]=0,D.__data[8]=j.elements[6],D.__data[9]=j.elements[7],D.__data[10]=j.elements[8],D.__data[11]=0):(j.toArray(D.__data,O),O+=Y.storage/Float32Array.BYTES_PER_ELEMENT)}e.bufferSubData(e.UNIFORM_BUFFER,R,D.__data)}}}e.bindBuffer(e.UNIFORM_BUFFER,null)}function f(y,x,_,M){const S=y.value,T=x+"_"+_;if(M[T]===void 0)return typeof S=="number"||typeof S=="boolean"?M[T]=S:M[T]=S.clone(),!0;{const E=M[T];if(typeof S=="number"||typeof S=="boolean"){if(E!==S)return M[T]=S,!0}else if(E.equals(S)===!1)return E.copy(S),!0}return!1}function p(y){const x=y.uniforms;let _=0;const M=16;for(let T=0,E=x.length;T<E;T++){const C=Array.isArray(x[T])?x[T]:[x[T]];for(let A=0,D=C.length;A<D;A++){const R=C[A],L=Array.isArray(R.value)?R.value:[R.value];for(let O=0,H=L.length;O<H;O++){const j=L[O],Y=v(j),z=_%M,V=z%Y.boundary,U=z+V;_+=V,U!==0&&M-U<Y.storage&&(_+=M-U),R.__data=new Float32Array(Y.storage/Float32Array.BYTES_PER_ELEMENT),R.__offset=_,_+=Y.storage}}}const S=_%M;return S>0&&(_+=M-S),y.__size=_,y.__cache={},this}function v(y){const x={boundary:0,storage:0};return typeof y=="number"||typeof y=="boolean"?(x.boundary=4,x.storage=4):y.isVector2?(x.boundary=8,x.storage=8):y.isVector3||y.isColor?(x.boundary=16,x.storage=12):y.isVector4?(x.boundary=16,x.storage=16):y.isMatrix3?(x.boundary=48,x.storage=48):y.isMatrix4?(x.boundary=64,x.storage=64):y.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",y),x}function m(y){const x=y.target;x.removeEventListener("dispose",m);const _=a.indexOf(x.__bindingPointIndex);a.splice(_,1),e.deleteBuffer(n[x.id]),delete n[x.id],delete s[x.id]}function g(){for(const y in n)e.deleteBuffer(n[y]);a=[],n={},s={}}return{bind:l,update:c,dispose:g}}class Vse{constructor(t={}){const{canvas:i=zne(),context:r=null,depth:n=!0,stencil:s=!1,alpha:a=!1,antialias:o=!1,premultipliedAlpha:l=!0,preserveDrawingBuffer:c=!1,powerPreference:u="default",failIfMajorPerformanceCaveat:h=!1,reverseDepthBuffer:d=!1}=t;this.isWebGLRenderer=!0;let f;if(r!==null){if(typeof WebGLRenderingContext<"u"&&r instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");f=r.getContextAttributes().alpha}else f=a;const p=new Uint32Array(4),v=new Int32Array(4);let m=null,g=null;const y=[],x=[];this.domElement=i,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=Qa,this.toneMapping=ru,this.toneMappingExposure=1;const _=this;let M=!1,S=0,T=0,E=null,C=-1,A=null;const D=new Hi,R=new Hi;let L=null;const O=new Rt(0);let H=0,j=i.width,Y=i.height,z=1,V=null,U=null;const k=new Hi(0,0,j,Y),X=new Hi(0,0,j,Y);let re=!1;const q=new Qb;let ee=!1,$=!1;this.transmissionResolutionScale=1;const ne=new ci,ce=new ci,pe=new he,ge=new Hi,we={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let le=!1;function ve(){return E===null?z:1}let ie=r;function Ce(se,Ue){return i.getContext(se,Ue)}try{const se={alpha:!0,depth:n,stencil:s,antialias:o,premultipliedAlpha:l,preserveDrawingBuffer:c,powerPreference:u,failIfMajorPerformanceCaveat:h};if("setAttribute"in i&&i.setAttribute("data-engine",`three.js r${JC}`),i.addEventListener("webglcontextlost",ze,!1),i.addEventListener("webglcontextrestored",Ze,!1),i.addEventListener("webglcontextcreationerror",Je,!1),ie===null){const Ue="webgl2";if(ie=Ce(Ue,se),ie===null)throw Ce(Ue)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(se){throw console.error("THREE.WebGLRenderer: "+se.message),se}let Pe,Ne,be,Le,Fe,K,B,G,oe,fe,W,Ie,Oe,Be,Re,ke,qe,Ke,it,He,de,We,dt,J;function xe(){Pe=new E9e(ie),Pe.init(),We=new kse(ie,Pe),Ne=new y9e(ie,Pe,t,We),be=new sXe(ie,Pe),Ne.reverseDepthBuffer&&d&&be.buffers.depth.setReversed(!0),Le=new C9e(ie),Fe=new X7e,K=new aXe(ie,Pe,be,Fe,Ne,We,Le),B=new w9e(_),G=new M9e(_),oe=new Oje(ie),dt=new g9e(ie,oe),fe=new A9e(ie,oe,Le,dt),W=new D9e(ie,fe,oe,Le),it=new P9e(ie,Ne,K),ke=new x9e(Fe),Ie=new W7e(_,B,G,Pe,Ne,dt,ke),Oe=new dXe(_,Fe),Be=new Y7e,Re=new eXe(Pe),Ke=new m9e(_,B,G,be,W,f,l),qe=new rXe(_,W,Ne),J=new fXe(ie,Le,Ne,be),He=new v9e(ie,Pe,Le),de=new T9e(ie,Pe,Le),Le.programs=Ie.programs,_.capabilities=Ne,_.extensions=Pe,_.properties=Fe,_.renderLists=Be,_.shadowMap=qe,_.state=be,_.info=Le}xe();const me=new uXe(_,ie);this.xr=me,this.getContext=function(){return ie},this.getContextAttributes=function(){return ie.getContextAttributes()},this.forceContextLoss=function(){const se=Pe.get("WEBGL_lose_context");se&&se.loseContext()},this.forceContextRestore=function(){const se=Pe.get("WEBGL_lose_context");se&&se.restoreContext()},this.getPixelRatio=function(){return z},this.setPixelRatio=function(se){se!==void 0&&(z=se,this.setSize(j,Y,!1))},this.getSize=function(se){return se.set(j,Y)},this.setSize=function(se,Ue,Qe=!0){if(me.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}j=se,Y=Ue,i.width=Math.floor(se*z),i.height=Math.floor(Ue*z),Qe===!0&&(i.style.width=se+"px",i.style.height=Ue+"px"),this.setViewport(0,0,se,Ue)},this.getDrawingBufferSize=function(se){return se.set(j*z,Y*z).floor()},this.setDrawingBufferSize=function(se,Ue,Qe){j=se,Y=Ue,z=Qe,i.width=Math.floor(se*Qe),i.height=Math.floor(Ue*Qe),this.setViewport(0,0,se,Ue)},this.getCurrentViewport=function(se){return se.copy(D)},this.getViewport=function(se){return se.copy(k)},this.setViewport=function(se,Ue,Qe,Ae){se.isVector4?k.set(se.x,se.y,se.z,se.w):k.set(se,Ue,Qe,Ae),be.viewport(D.copy(k).multiplyScalar(z).round())},this.getScissor=function(se){return se.copy(X)},this.setScissor=function(se,Ue,Qe,Ae){se.isVector4?X.set(se.x,se.y,se.z,se.w):X.set(se,Ue,Qe,Ae),be.scissor(R.copy(X).multiplyScalar(z).round())},this.getScissorTest=function(){return re},this.setScissorTest=function(se){be.setScissorTest(re=se)},this.setOpaqueSort=function(se){V=se},this.setTransparentSort=function(se){U=se},this.getClearColor=function(se){return se.copy(Ke.getClearColor())},this.setClearColor=function(){Ke.setClearColor(...arguments)},this.getClearAlpha=function(){return Ke.getClearAlpha()},this.setClearAlpha=function(){Ke.setClearAlpha(...arguments)},this.clear=function(se=!0,Ue=!0,Qe=!0){let Ae=0;if(se){let De=!1;if(E!==null){const pt=E.texture.format;De=pt===aP||pt===sP||pt===Wb}if(De){const pt=E.texture.type,lt=pt===lc||pt===zh||pt===q0||pt===Lm||pt===iP||pt===rP,bt=Ke.getClearColor(),Et=Ke.getClearAlpha(),Ft=bt.r,zt=bt.g,Q=bt.b;lt?(p[0]=Ft,p[1]=zt,p[2]=Q,p[3]=Et,ie.clearBufferuiv(ie.COLOR,0,p)):(v[0]=Ft,v[1]=zt,v[2]=Q,v[3]=Et,ie.clearBufferiv(ie.COLOR,0,v))}else Ae|=ie.COLOR_BUFFER_BIT}Ue&&(Ae|=ie.DEPTH_BUFFER_BIT),Qe&&(Ae|=ie.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),ie.clear(Ae)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){i.removeEventListener("webglcontextlost",ze,!1),i.removeEventListener("webglcontextrestored",Ze,!1),i.removeEventListener("webglcontextcreationerror",Je,!1),Ke.dispose(),Be.dispose(),Re.dispose(),Fe.dispose(),B.dispose(),G.dispose(),W.dispose(),dt.dispose(),J.dispose(),Ie.dispose(),me.dispose(),me.removeEventListener("sessionstart",$i),me.removeEventListener("sessionend",xn),Or.stop()};function ze(se){se.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),M=!0}function Ze(){console.log("THREE.WebGLRenderer: Context Restored."),M=!1;const se=Le.autoReset,Ue=qe.enabled,Qe=qe.autoUpdate,Ae=qe.needsUpdate,De=qe.type;xe(),Le.autoReset=se,qe.enabled=Ue,qe.autoUpdate=Qe,qe.needsUpdate=Ae,qe.type=De}function Je(se){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",se.statusMessage)}function mt(se){const Ue=se.target;Ue.removeEventListener("dispose",mt),St(Ue)}function St(se){Mt(se),Fe.remove(se)}function Mt(se){const Ue=Fe.get(se).programs;Ue!==void 0&&(Ue.forEach(function(Qe){Ie.releaseProgram(Qe)}),se.isShaderMaterial&&Ie.releaseShaderCache(se))}this.renderBufferDirect=function(se,Ue,Qe,Ae,De,pt){Ue===null&&(Ue=we);const lt=De.isMesh&&De.matrixWorld.determinant()<0,bt=Jt(se,Ue,Qe,Ae,De);be.setMaterial(Ae,lt);let Et=Qe.index,Ft=1;if(Ae.wireframe===!0){if(Et=fe.getWireframeAttribute(Qe),Et===void 0)return;Ft=2}const zt=Qe.drawRange,Q=Qe.attributes.position;let te=zt.start*Ft,ye=(zt.start+zt.count)*Ft;pt!==null&&(te=Math.max(te,pt.start*Ft),ye=Math.min(ye,(pt.start+pt.count)*Ft)),Et!==null?(te=Math.max(te,0),ye=Math.min(ye,Et.count)):Q!=null&&(te=Math.max(te,0),ye=Math.min(ye,Q.count));const ae=ye-te;if(ae<0||ae===1/0)return;dt.setup(De,Ae,bt,Qe,Et);let Ee,rt=He;if(Et!==null&&(Ee=oe.get(Et),rt=de,rt.setIndex(Ee)),De.isMesh)Ae.wireframe===!0?(be.setLineWidth(Ae.wireframeLinewidth*ve()),rt.setMode(ie.LINES)):rt.setMode(ie.TRIANGLES);else if(De.isLine){let Ct=Ae.linewidth;Ct===void 0&&(Ct=1),be.setLineWidth(Ct*ve()),De.isLineSegments?rt.setMode(ie.LINES):De.isLineLoop?rt.setMode(ie.LINE_LOOP):rt.setMode(ie.LINE_STRIP)}else De.isPoints?rt.setMode(ie.POINTS):De.isSprite&&rt.setMode(ie.TRIANGLES);if(De.isBatchedMesh)if(De._multiDrawInstances!==null)Rp("THREE.WebGLRenderer: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),rt.renderMultiDrawInstances(De._multiDrawStarts,De._multiDrawCounts,De._multiDrawCount,De._multiDrawInstances);else if(Pe.get("WEBGL_multi_draw"))rt.renderMultiDraw(De._multiDrawStarts,De._multiDrawCounts,De._multiDrawCount);else{const Ct=De._multiDrawStarts,Di=De._multiDrawCounts,pi=De._multiDrawCount,qr=Et?oe.get(Et).bytesPerElement:1,es=Fe.get(Ae).currentProgram.getUniforms();for(let xr=0;xr<pi;xr++)es.setValue(ie,"_gl_DrawID",xr),rt.render(Ct[xr]/qr,Di[xr])}else if(De.isInstancedMesh)rt.renderInstances(te,ae,De.count);else if(Qe.isInstancedBufferGeometry){const Ct=Qe._maxInstanceCount!==void 0?Qe._maxInstanceCount:1/0,Di=Math.min(Qe.instanceCount,Ct);rt.renderInstances(te,ae,Di)}else rt.render(te,ae)};function vt(se,Ue,Qe){se.transparent===!0&&se.side===Ql&&se.forceSinglePass===!1?(se.side=La,se.needsUpdate=!0,nt(se,Ue,Qe),se.side=Lh,se.needsUpdate=!0,nt(se,Ue,Qe),se.side=Ql):nt(se,Ue,Qe)}this.compile=function(se,Ue,Qe=null){Qe===null&&(Qe=se),g=Re.get(Qe),g.init(Ue),x.push(g),Qe.traverseVisible(function(De){De.isLight&&De.layers.test(Ue.layers)&&(g.pushLight(De),De.castShadow&&g.pushShadow(De))}),se!==Qe&&se.traverseVisible(function(De){De.isLight&&De.layers.test(Ue.layers)&&(g.pushLight(De),De.castShadow&&g.pushShadow(De))}),g.setupLights();const Ae=new Set;return se.traverse(function(De){if(!(De.isMesh||De.isPoints||De.isLine||De.isSprite))return;const pt=De.material;if(pt)if(Array.isArray(pt))for(let lt=0;lt<pt.length;lt++){const bt=pt[lt];vt(bt,Qe,De),Ae.add(bt)}else vt(pt,Qe,De),Ae.add(pt)}),g=x.pop(),Ae},this.compileAsync=function(se,Ue,Qe=null){const Ae=this.compile(se,Ue,Qe);return new Promise(De=>{function pt(){if(Ae.forEach(function(lt){Fe.get(lt).currentProgram.isReady()&&Ae.delete(lt)}),Ae.size===0){De(se);return}setTimeout(pt,10)}Pe.get("KHR_parallel_shader_compile")!==null?pt():setTimeout(pt,10)})};let ui=null;function hi(se){ui&&ui(se)}function $i(){Or.stop()}function xn(){Or.start()}const Or=new zse;Or.setAnimationLoop(hi),typeof self<"u"&&Or.setContext(self),this.setAnimationLoop=function(se){ui=se,me.setAnimationLoop(se),se===null?Or.stop():Or.start()},me.addEventListener("sessionstart",$i),me.addEventListener("sessionend",xn),this.render=function(se,Ue){if(Ue!==void 0&&Ue.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(M===!0)return;if(se.matrixWorldAutoUpdate===!0&&se.updateMatrixWorld(),Ue.parent===null&&Ue.matrixWorldAutoUpdate===!0&&Ue.updateMatrixWorld(),me.enabled===!0&&me.isPresenting===!0&&(me.cameraAutoUpdate===!0&&me.updateCamera(Ue),Ue=me.getCamera()),se.isScene===!0&&se.onBeforeRender(_,se,Ue,E),g=Re.get(se,x.length),g.init(Ue),x.push(g),ce.multiplyMatrices(Ue.projectionMatrix,Ue.matrixWorldInverse),q.setFromProjectionMatrix(ce),$=this.localClippingEnabled,ee=ke.init(this.clippingPlanes,$),m=Be.get(se,y.length),m.init(),y.push(m),me.enabled===!0&&me.isPresenting===!0){const pt=_.xr.getDepthSensingMesh();pt!==null&&zr(pt,Ue,-1/0,_.sortObjects)}zr(se,Ue,0,_.sortObjects),m.finish(),_.sortObjects===!0&&m.sort(V,U),le=me.enabled===!1||me.isPresenting===!1||me.hasDepthSensing()===!1,le&&Ke.addToRenderList(m,se),this.info.render.frame++,ee===!0&&ke.beginShadows();const Qe=g.state.shadowsArray;qe.render(Qe,se,Ue),ee===!0&&ke.endShadows(),this.info.autoReset===!0&&this.info.reset();const Ae=m.opaque,De=m.transmissive;if(g.setupLights(),Ue.isArrayCamera){const pt=Ue.cameras;if(De.length>0)for(let lt=0,bt=pt.length;lt<bt;lt++){const Et=pt[lt];Xe(Ae,De,se,Et)}le&&Ke.render(se);for(let lt=0,bt=pt.length;lt<bt;lt++){const Et=pt[lt];ue(m,se,Et,Et.viewport)}}else De.length>0&&Xe(Ae,De,se,Ue),le&&Ke.render(se),ue(m,se,Ue);E!==null&&T===0&&(K.updateMultisampleRenderTarget(E),K.updateRenderTargetMipmap(E)),se.isScene===!0&&se.onAfterRender(_,se,Ue),dt.resetDefaultState(),C=-1,A=null,x.pop(),x.length>0?(g=x[x.length-1],ee===!0&&ke.setGlobalState(_.clippingPlanes,g.state.camera)):g=null,y.pop(),y.length>0?m=y[y.length-1]:m=null};function zr(se,Ue,Qe,Ae){if(se.visible===!1)return;if(se.layers.test(Ue.layers)){if(se.isGroup)Qe=se.renderOrder;else if(se.isLOD)se.autoUpdate===!0&&se.update(Ue);else if(se.isLight)g.pushLight(se),se.castShadow&&g.pushShadow(se);else if(se.isSprite){if(!se.frustumCulled||q.intersectsSprite(se)){Ae&&ge.setFromMatrixPosition(se.matrixWorld).applyMatrix4(ce);const lt=W.update(se),bt=se.material;bt.visible&&m.push(se,lt,bt,Qe,ge.z,null)}}else if((se.isMesh||se.isLine||se.isPoints)&&(!se.frustumCulled||q.intersectsObject(se))){const lt=W.update(se),bt=se.material;if(Ae&&(se.boundingSphere!==void 0?(se.boundingSphere===null&&se.computeBoundingSphere(),ge.copy(se.boundingSphere.center)):(lt.boundingSphere===null&&lt.computeBoundingSphere(),ge.copy(lt.boundingSphere.center)),ge.applyMatrix4(se.matrixWorld).applyMatrix4(ce)),Array.isArray(bt)){const Et=lt.groups;for(let Ft=0,zt=Et.length;Ft<zt;Ft++){const Q=Et[Ft],te=bt[Q.materialIndex];te&&te.visible&&m.push(se,lt,te,Qe,ge.z,Q)}}else bt.visible&&m.push(se,lt,bt,Qe,ge.z,null)}}const pt=se.children;for(let lt=0,bt=pt.length;lt<bt;lt++)zr(pt[lt],Ue,Qe,Ae)}function ue(se,Ue,Qe,Ae){const De=se.opaque,pt=se.transmissive,lt=se.transparent;g.setupLightsView(Qe),ee===!0&&ke.setGlobalState(_.clippingPlanes,Qe),Ae&&be.viewport(D.copy(Ae)),De.length>0&&et(De,Ue,Qe),pt.length>0&&et(pt,Ue,Qe),lt.length>0&&et(lt,Ue,Qe),be.buffers.depth.setTest(!0),be.buffers.depth.setMask(!0),be.buffers.color.setMask(!0),be.setPolygonOffset(!1)}function Xe(se,Ue,Qe,Ae){if((Qe.isScene===!0?Qe.overrideMaterial:null)!==null)return;g.state.transmissionRenderTarget[Ae.id]===void 0&&(g.state.transmissionRenderTarget[Ae.id]=new uu(1,1,{generateMipmaps:!0,type:Pe.has("EXT_color_buffer_half_float")||Pe.has("EXT_color_buffer_float")?_y:lc,minFilter:qc,samples:4,stencilBuffer:s,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:Xi.workingColorSpace}));const pt=g.state.transmissionRenderTarget[Ae.id],lt=Ae.viewport||D;pt.setSize(lt.z*_.transmissionResolutionScale,lt.w*_.transmissionResolutionScale);const bt=_.getRenderTarget();_.setRenderTarget(pt),_.getClearColor(O),H=_.getClearAlpha(),H<1&&_.setClearColor(16777215,.5),_.clear(),le&&Ke.render(Qe);const Et=_.toneMapping;_.toneMapping=ru;const Ft=Ae.viewport;if(Ae.viewport!==void 0&&(Ae.viewport=void 0),g.setupLightsView(Ae),ee===!0&&ke.setGlobalState(_.clippingPlanes,Ae),et(se,Qe,Ae),K.updateMultisampleRenderTarget(pt),K.updateRenderTargetMipmap(pt),Pe.has("WEBGL_multisampled_render_to_texture")===!1){let zt=!1;for(let Q=0,te=Ue.length;Q<te;Q++){const ye=Ue[Q],ae=ye.object,Ee=ye.geometry,rt=ye.material,Ct=ye.group;if(rt.side===Ql&&ae.layers.test(Ae.layers)){const Di=rt.side;rt.side=La,rt.needsUpdate=!0,Ge(ae,Qe,Ae,Ee,rt,Ct),rt.side=Di,rt.needsUpdate=!0,zt=!0}}zt===!0&&(K.updateMultisampleRenderTarget(pt),K.updateRenderTargetMipmap(pt))}_.setRenderTarget(bt),_.setClearColor(O,H),Ft!==void 0&&(Ae.viewport=Ft),_.toneMapping=Et}function et(se,Ue,Qe){const Ae=Ue.isScene===!0?Ue.overrideMaterial:null;for(let De=0,pt=se.length;De<pt;De++){const lt=se[De],bt=lt.object,Et=lt.geometry,Ft=Ae===null?lt.material:Ae,zt=lt.group;bt.layers.test(Qe.layers)&&Ge(bt,Ue,Qe,Et,Ft,zt)}}function Ge(se,Ue,Qe,Ae,De,pt){se.onBeforeRender(_,Ue,Qe,Ae,De,pt),se.modelViewMatrix.multiplyMatrices(Qe.matrixWorldInverse,se.matrixWorld),se.normalMatrix.getNormalMatrix(se.modelViewMatrix),De.onBeforeRender(_,Ue,Qe,Ae,se,pt),De.transparent===!0&&De.side===Ql&&De.forceSinglePass===!1?(De.side=La,De.needsUpdate=!0,_.renderBufferDirect(Qe,Ue,Ae,De,se,pt),De.side=Lh,De.needsUpdate=!0,_.renderBufferDirect(Qe,Ue,Ae,De,se,pt),De.side=Ql):_.renderBufferDirect(Qe,Ue,Ae,De,se,pt),se.onAfterRender(_,Ue,Qe,Ae,De,pt)}function nt(se,Ue,Qe){Ue.isScene!==!0&&(Ue=we);const Ae=Fe.get(se),De=g.state.lights,pt=g.state.shadowsArray,lt=De.state.version,bt=Ie.getParameters(se,De.state,pt,Ue,Qe),Et=Ie.getProgramCacheKey(bt);let Ft=Ae.programs;Ae.environment=se.isMeshStandardMaterial?Ue.environment:null,Ae.fog=Ue.fog,Ae.envMap=(se.isMeshStandardMaterial?G:B).get(se.envMap||Ae.environment),Ae.envMapRotation=Ae.environment!==null&&se.envMap===null?Ue.environmentRotation:se.envMapRotation,Ft===void 0&&(se.addEventListener("dispose",mt),Ft=new Map,Ae.programs=Ft);let zt=Ft.get(Et);if(zt!==void 0){if(Ae.currentProgram===zt&&Ae.lightsStateVersion===lt)return jt(se,bt),zt}else bt.uniforms=Ie.getUniforms(se),se.onBeforeCompile(bt,_),zt=Ie.acquireProgram(bt,Et),Ft.set(Et,zt),Ae.uniforms=bt.uniforms;const Q=Ae.uniforms;return(!se.isShaderMaterial&&!se.isRawShaderMaterial||se.clipping===!0)&&(Q.clippingPlanes=ke.uniform),jt(se,bt),Ae.needsLights=Ei(se),Ae.lightsStateVersion=lt,Ae.needsLights&&(Q.ambientLightColor.value=De.state.ambient,Q.lightProbe.value=De.state.probe,Q.directionalLights.value=De.state.directional,Q.directionalLightShadows.value=De.state.directionalShadow,Q.spotLights.value=De.state.spot,Q.spotLightShadows.value=De.state.spotShadow,Q.rectAreaLights.value=De.state.rectArea,Q.ltc_1.value=De.state.rectAreaLTC1,Q.ltc_2.value=De.state.rectAreaLTC2,Q.pointLights.value=De.state.point,Q.pointLightShadows.value=De.state.pointShadow,Q.hemisphereLights.value=De.state.hemi,Q.directionalShadowMap.value=De.state.directionalShadowMap,Q.directionalShadowMatrix.value=De.state.directionalShadowMatrix,Q.spotShadowMap.value=De.state.spotShadowMap,Q.spotLightMatrix.value=De.state.spotLightMatrix,Q.spotLightMap.value=De.state.spotLightMap,Q.pointShadowMap.value=De.state.pointShadowMap,Q.pointShadowMatrix.value=De.state.pointShadowMatrix),Ae.currentProgram=zt,Ae.uniformsList=null,zt}function It(se){if(se.uniformsList===null){const Ue=se.currentProgram.getUniforms();se.uniformsList=x2.seqWithValue(Ue.seq,se.uniforms)}return se.uniformsList}function jt(se,Ue){const Qe=Fe.get(se);Qe.outputColorSpace=Ue.outputColorSpace,Qe.batching=Ue.batching,Qe.batchingColor=Ue.batchingColor,Qe.instancing=Ue.instancing,Qe.instancingColor=Ue.instancingColor,Qe.instancingMorph=Ue.instancingMorph,Qe.skinning=Ue.skinning,Qe.morphTargets=Ue.morphTargets,Qe.morphNormals=Ue.morphNormals,Qe.morphColors=Ue.morphColors,Qe.morphTargetsCount=Ue.morphTargetsCount,Qe.numClippingPlanes=Ue.numClippingPlanes,Qe.numIntersection=Ue.numClipIntersection,Qe.vertexAlphas=Ue.vertexAlphas,Qe.vertexTangents=Ue.vertexTangents,Qe.toneMapping=Ue.toneMapping}function Jt(se,Ue,Qe,Ae,De){Ue.isScene!==!0&&(Ue=we),K.resetTextureUnits();const pt=Ue.fog,lt=Ae.isMeshStandardMaterial?Ue.environment:null,bt=E===null?_.outputColorSpace:E.isXRRenderTarget===!0?E.texture.colorSpace:zm,Et=(Ae.isMeshStandardMaterial?G:B).get(Ae.envMap||lt),Ft=Ae.vertexColors===!0&&!!Qe.attributes.color&&Qe.attributes.color.itemSize===4,zt=!!Qe.attributes.tangent&&(!!Ae.normalMap||Ae.anisotropy>0),Q=!!Qe.morphAttributes.position,te=!!Qe.morphAttributes.normal,ye=!!Qe.morphAttributes.color;let ae=ru;Ae.toneMapped&&(E===null||E.isXRRenderTarget===!0)&&(ae=_.toneMapping);const Ee=Qe.morphAttributes.position||Qe.morphAttributes.normal||Qe.morphAttributes.color,rt=Ee!==void 0?Ee.length:0,Ct=Fe.get(Ae),Di=g.state.lights;if(ee===!0&&($===!0||se!==A)){const bn=se===A&&Ae.id===C;ke.setState(Ae,se,bn)}let pi=!1;Ae.version===Ct.__version?(Ct.needsLights&&Ct.lightsStateVersion!==Di.state.version||Ct.outputColorSpace!==bt||De.isBatchedMesh&&Ct.batching===!1||!De.isBatchedMesh&&Ct.batching===!0||De.isBatchedMesh&&Ct.batchingColor===!0&&De.colorTexture===null||De.isBatchedMesh&&Ct.batchingColor===!1&&De.colorTexture!==null||De.isInstancedMesh&&Ct.instancing===!1||!De.isInstancedMesh&&Ct.instancing===!0||De.isSkinnedMesh&&Ct.skinning===!1||!De.isSkinnedMesh&&Ct.skinning===!0||De.isInstancedMesh&&Ct.instancingColor===!0&&De.instanceColor===null||De.isInstancedMesh&&Ct.instancingColor===!1&&De.instanceColor!==null||De.isInstancedMesh&&Ct.instancingMorph===!0&&De.morphTexture===null||De.isInstancedMesh&&Ct.instancingMorph===!1&&De.morphTexture!==null||Ct.envMap!==Et||Ae.fog===!0&&Ct.fog!==pt||Ct.numClippingPlanes!==void 0&&(Ct.numClippingPlanes!==ke.numPlanes||Ct.numIntersection!==ke.numIntersection)||Ct.vertexAlphas!==Ft||Ct.vertexTangents!==zt||Ct.morphTargets!==Q||Ct.morphNormals!==te||Ct.morphColors!==ye||Ct.toneMapping!==ae||Ct.morphTargetsCount!==rt)&&(pi=!0):(pi=!0,Ct.__version=Ae.version);let qr=Ct.currentProgram;pi===!0&&(qr=nt(Ae,Ue,De));let es=!1,xr=!1,Bn=!1;const Li=qr.getUniforms(),Fn=Ct.uniforms;if(be.useProgram(qr.program)&&(es=!0,xr=!0,Bn=!0),Ae.id!==C&&(C=Ae.id,xr=!0),es||A!==se){be.buffers.depth.getReversed()?(ne.copy(se.projectionMatrix),rGe(ne),nGe(ne),Li.setValue(ie,"projectionMatrix",ne)):Li.setValue(ie,"projectionMatrix",se.projectionMatrix),Li.setValue(ie,"viewMatrix",se.matrixWorldInverse);const Dr=Li.map.cameraPosition;Dr!==void 0&&Dr.setValue(ie,pe.setFromMatrixPosition(se.matrixWorld)),Ne.logarithmicDepthBuffer&&Li.setValue(ie,"logDepthBufFC",2/(Math.log(se.far+1)/Math.LN2)),(Ae.isMeshPhongMaterial||Ae.isMeshToonMaterial||Ae.isMeshLambertMaterial||Ae.isMeshBasicMaterial||Ae.isMeshStandardMaterial||Ae.isShaderMaterial)&&Li.setValue(ie,"isOrthographic",se.isOrthographicCamera===!0),A!==se&&(A=se,xr=!0,Bn=!0)}if(De.isSkinnedMesh){Li.setOptional(ie,De,"bindMatrix"),Li.setOptional(ie,De,"bindMatrixInverse");const bn=De.skeleton;bn&&(bn.boneTexture===null&&bn.computeBoneTexture(),Li.setValue(ie,"boneTexture",bn.boneTexture,K))}De.isBatchedMesh&&(Li.setOptional(ie,De,"batchingTexture"),Li.setValue(ie,"batchingTexture",De._matricesTexture,K),Li.setOptional(ie,De,"batchingIdTexture"),Li.setValue(ie,"batchingIdTexture",De._indirectTexture,K),Li.setOptional(ie,De,"batchingColorTexture"),De._colorsTexture!==null&&Li.setValue(ie,"batchingColorTexture",De._colorsTexture,K));const wn=Qe.morphAttributes;if((wn.position!==void 0||wn.normal!==void 0||wn.color!==void 0)&&it.update(De,Qe,qr),(xr||Ct.receiveShadow!==De.receiveShadow)&&(Ct.receiveShadow=De.receiveShadow,Li.setValue(ie,"receiveShadow",De.receiveShadow)),Ae.isMeshGouraudMaterial&&Ae.envMap!==null&&(Fn.envMap.value=Et,Fn.flipEnvMap.value=Et.isCubeTexture&&Et.isRenderTargetTexture===!1?-1:1),Ae.isMeshStandardMaterial&&Ae.envMap===null&&Ue.environment!==null&&(Fn.envMapIntensity.value=Ue.environmentIntensity),xr&&(Li.setValue(ie,"toneMappingExposure",_.toneMappingExposure),Ct.needsLights&&Vt(Fn,Bn),pt&&Ae.fog===!0&&Oe.refreshFogUniforms(Fn,pt),Oe.refreshMaterialUniforms(Fn,Ae,z,Y,g.state.transmissionRenderTarget[se.id]),x2.upload(ie,It(Ct),Fn,K)),Ae.isShaderMaterial&&Ae.uniformsNeedUpdate===!0&&(x2.upload(ie,It(Ct),Fn,K),Ae.uniformsNeedUpdate=!1),Ae.isSpriteMaterial&&Li.setValue(ie,"center",De.center),Li.setValue(ie,"modelViewMatrix",De.modelViewMatrix),Li.setValue(ie,"normalMatrix",De.normalMatrix),Li.setValue(ie,"modelMatrix",De.matrixWorld),Ae.isShaderMaterial||Ae.isRawShaderMaterial){const bn=Ae.uniformsGroups;for(let Dr=0,po=bn.length;Dr<po;Dr++){const ws=bn[Dr];J.update(ws,qr),J.bind(ws,qr)}}return qr}function Vt(se,Ue){se.ambientLightColor.needsUpdate=Ue,se.lightProbe.needsUpdate=Ue,se.directionalLights.needsUpdate=Ue,se.directionalLightShadows.needsUpdate=Ue,se.pointLights.needsUpdate=Ue,se.pointLightShadows.needsUpdate=Ue,se.spotLights.needsUpdate=Ue,se.spotLightShadows.needsUpdate=Ue,se.rectAreaLights.needsUpdate=Ue,se.hemisphereLights.needsUpdate=Ue}function Ei(se){return se.isMeshLambertMaterial||se.isMeshToonMaterial||se.isMeshPhongMaterial||se.isMeshStandardMaterial||se.isShadowMaterial||se.isShaderMaterial&&se.lights===!0}this.getActiveCubeFace=function(){return S},this.getActiveMipmapLevel=function(){return T},this.getRenderTarget=function(){return E},this.setRenderTargetTextures=function(se,Ue,Qe){Fe.get(se.texture).__webglTexture=Ue,Fe.get(se.depthTexture).__webglTexture=Qe;const Ae=Fe.get(se);Ae.__hasExternalTextures=!0,Ae.__autoAllocateDepthBuffer=Qe===void 0,Ae.__autoAllocateDepthBuffer||Pe.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),Ae.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(se,Ue){const Qe=Fe.get(se);Qe.__webglFramebuffer=Ue,Qe.__useDefaultFramebuffer=Ue===void 0};const li=ie.createFramebuffer();this.setRenderTarget=function(se,Ue=0,Qe=0){E=se,S=Ue,T=Qe;let Ae=!0,De=null,pt=!1,lt=!1;if(se){const Et=Fe.get(se);if(Et.__useDefaultFramebuffer!==void 0)be.bindFramebuffer(ie.FRAMEBUFFER,null),Ae=!1;else if(Et.__webglFramebuffer===void 0)K.setupRenderTarget(se);else if(Et.__hasExternalTextures)K.rebindTextures(se,Fe.get(se.texture).__webglTexture,Fe.get(se.depthTexture).__webglTexture);else if(se.depthBuffer){const Q=se.depthTexture;if(Et.__boundDepthTexture!==Q){if(Q!==null&&Fe.has(Q)&&(se.width!==Q.image.width||se.height!==Q.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");K.setupDepthRenderbuffer(se)}}const Ft=se.texture;(Ft.isData3DTexture||Ft.isDataArrayTexture||Ft.isCompressedArrayTexture)&&(lt=!0);const zt=Fe.get(se).__webglFramebuffer;se.isWebGLCubeRenderTarget?(Array.isArray(zt[Ue])?De=zt[Ue][Qe]:De=zt[Ue],pt=!0):se.samples>0&&K.useMultisampledRTT(se)===!1?De=Fe.get(se).__webglMultisampledFramebuffer:Array.isArray(zt)?De=zt[Qe]:De=zt,D.copy(se.viewport),R.copy(se.scissor),L=se.scissorTest}else D.copy(k).multiplyScalar(z).floor(),R.copy(X).multiplyScalar(z).floor(),L=re;if(Qe!==0&&(De=li),be.bindFramebuffer(ie.FRAMEBUFFER,De)&&Ae&&be.drawBuffers(se,De),be.viewport(D),be.scissor(R),be.setScissorTest(L),pt){const Et=Fe.get(se.texture);ie.framebufferTexture2D(ie.FRAMEBUFFER,ie.COLOR_ATTACHMENT0,ie.TEXTURE_CUBE_MAP_POSITIVE_X+Ue,Et.__webglTexture,Qe)}else if(lt){const Et=Fe.get(se.texture),Ft=Ue;ie.framebufferTextureLayer(ie.FRAMEBUFFER,ie.COLOR_ATTACHMENT0,Et.__webglTexture,Qe,Ft)}else if(se!==null&&Qe!==0){const Et=Fe.get(se.texture);ie.framebufferTexture2D(ie.FRAMEBUFFER,ie.COLOR_ATTACHMENT0,ie.TEXTURE_2D,Et.__webglTexture,Qe)}C=-1},this.readRenderTargetPixels=function(se,Ue,Qe,Ae,De,pt,lt){if(!(se&&se.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let bt=Fe.get(se).__webglFramebuffer;if(se.isWebGLCubeRenderTarget&&lt!==void 0&&(bt=bt[lt]),bt){be.bindFramebuffer(ie.FRAMEBUFFER,bt);try{const Et=se.texture,Ft=Et.format,zt=Et.type;if(!Ne.textureFormatReadable(Ft)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!Ne.textureTypeReadable(zt)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}Ue>=0&&Ue<=se.width-Ae&&Qe>=0&&Qe<=se.height-De&&ie.readPixels(Ue,Qe,Ae,De,We.convert(Ft),We.convert(zt),pt)}finally{const Et=E!==null?Fe.get(E).__webglFramebuffer:null;be.bindFramebuffer(ie.FRAMEBUFFER,Et)}}},this.readRenderTargetPixelsAsync=async function(se,Ue,Qe,Ae,De,pt,lt){if(!(se&&se.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let bt=Fe.get(se).__webglFramebuffer;if(se.isWebGLCubeRenderTarget&&lt!==void 0&&(bt=bt[lt]),bt){const Et=se.texture,Ft=Et.format,zt=Et.type;if(!Ne.textureFormatReadable(Ft))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!Ne.textureTypeReadable(zt))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");if(Ue>=0&&Ue<=se.width-Ae&&Qe>=0&&Qe<=se.height-De){be.bindFramebuffer(ie.FRAMEBUFFER,bt);const Q=ie.createBuffer();ie.bindBuffer(ie.PIXEL_PACK_BUFFER,Q),ie.bufferData(ie.PIXEL_PACK_BUFFER,pt.byteLength,ie.STREAM_READ),ie.readPixels(Ue,Qe,Ae,De,We.convert(Ft),We.convert(zt),0);const te=E!==null?Fe.get(E).__webglFramebuffer:null;be.bindFramebuffer(ie.FRAMEBUFFER,te);const ye=ie.fenceSync(ie.SYNC_GPU_COMMANDS_COMPLETE,0);return ie.flush(),await iGe(ie,ye,4),ie.bindBuffer(ie.PIXEL_PACK_BUFFER,Q),ie.getBufferSubData(ie.PIXEL_PACK_BUFFER,0,pt),ie.deleteBuffer(Q),ie.deleteSync(ye),pt}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")}},this.copyFramebufferToTexture=function(se,Ue=null,Qe=0){se.isTexture!==!0&&(Rp("WebGLRenderer: copyFramebufferToTexture function signature has changed."),Ue=arguments[0]||null,se=arguments[1]);const Ae=Math.pow(2,-Qe),De=Math.floor(se.image.width*Ae),pt=Math.floor(se.image.height*Ae),lt=Ue!==null?Ue.x:0,bt=Ue!==null?Ue.y:0;K.setTexture2D(se,0),ie.copyTexSubImage2D(ie.TEXTURE_2D,Qe,0,0,lt,bt,De,pt),be.unbindTexture()};const fi=ie.createFramebuffer(),si=ie.createFramebuffer();this.copyTextureToTexture=function(se,Ue,Qe=null,Ae=null,De=0,pt=null){se.isTexture!==!0&&(Rp("WebGLRenderer: copyTextureToTexture function signature has changed."),Ae=arguments[0]||null,se=arguments[1],Ue=arguments[2],pt=arguments[3]||0,Qe=null),pt===null&&(De!==0?(Rp("WebGLRenderer: copyTextureToTexture function signature has changed to support src and dst mipmap levels."),pt=De,De=0):pt=0);let lt,bt,Et,Ft,zt,Q,te,ye,ae;const Ee=se.isCompressedTexture?se.mipmaps[pt]:se.image;if(Qe!==null)lt=Qe.max.x-Qe.min.x,bt=Qe.max.y-Qe.min.y,Et=Qe.isBox3?Qe.max.z-Qe.min.z:1,Ft=Qe.min.x,zt=Qe.min.y,Q=Qe.isBox3?Qe.min.z:0;else{const wn=Math.pow(2,-De);lt=Math.floor(Ee.width*wn),bt=Math.floor(Ee.height*wn),se.isDataArrayTexture?Et=Ee.depth:se.isData3DTexture?Et=Math.floor(Ee.depth*wn):Et=1,Ft=0,zt=0,Q=0}Ae!==null?(te=Ae.x,ye=Ae.y,ae=Ae.z):(te=0,ye=0,ae=0);const rt=We.convert(Ue.format),Ct=We.convert(Ue.type);let Di;Ue.isData3DTexture?(K.setTexture3D(Ue,0),Di=ie.TEXTURE_3D):Ue.isDataArrayTexture||Ue.isCompressedArrayTexture?(K.setTexture2DArray(Ue,0),Di=ie.TEXTURE_2D_ARRAY):(K.setTexture2D(Ue,0),Di=ie.TEXTURE_2D),ie.pixelStorei(ie.UNPACK_FLIP_Y_WEBGL,Ue.flipY),ie.pixelStorei(ie.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Ue.premultiplyAlpha),ie.pixelStorei(ie.UNPACK_ALIGNMENT,Ue.unpackAlignment);const pi=ie.getParameter(ie.UNPACK_ROW_LENGTH),qr=ie.getParameter(ie.UNPACK_IMAGE_HEIGHT),es=ie.getParameter(ie.UNPACK_SKIP_PIXELS),xr=ie.getParameter(ie.UNPACK_SKIP_ROWS),Bn=ie.getParameter(ie.UNPACK_SKIP_IMAGES);ie.pixelStorei(ie.UNPACK_ROW_LENGTH,Ee.width),ie.pixelStorei(ie.UNPACK_IMAGE_HEIGHT,Ee.height),ie.pixelStorei(ie.UNPACK_SKIP_PIXELS,Ft),ie.pixelStorei(ie.UNPACK_SKIP_ROWS,zt),ie.pixelStorei(ie.UNPACK_SKIP_IMAGES,Q);const Li=se.isDataArrayTexture||se.isData3DTexture,Fn=Ue.isDataArrayTexture||Ue.isData3DTexture;if(se.isDepthTexture){const wn=Fe.get(se),bn=Fe.get(Ue),Dr=Fe.get(wn.__renderTarget),po=Fe.get(bn.__renderTarget);be.bindFramebuffer(ie.READ_FRAMEBUFFER,Dr.__webglFramebuffer),be.bindFramebuffer(ie.DRAW_FRAMEBUFFER,po.__webglFramebuffer);for(let ws=0;ws<Et;ws++)Li&&(ie.framebufferTextureLayer(ie.READ_FRAMEBUFFER,ie.COLOR_ATTACHMENT0,Fe.get(se).__webglTexture,De,Q+ws),ie.framebufferTextureLayer(ie.DRAW_FRAMEBUFFER,ie.COLOR_ATTACHMENT0,Fe.get(Ue).__webglTexture,pt,ae+ws)),ie.blitFramebuffer(Ft,zt,lt,bt,te,ye,lt,bt,ie.DEPTH_BUFFER_BIT,ie.NEAREST);be.bindFramebuffer(ie.READ_FRAMEBUFFER,null),be.bindFramebuffer(ie.DRAW_FRAMEBUFFER,null)}else if(De!==0||se.isRenderTargetTexture||Fe.has(se)){const wn=Fe.get(se),bn=Fe.get(Ue);be.bindFramebuffer(ie.READ_FRAMEBUFFER,fi),be.bindFramebuffer(ie.DRAW_FRAMEBUFFER,si);for(let Dr=0;Dr<Et;Dr++)Li?ie.framebufferTextureLayer(ie.READ_FRAMEBUFFER,ie.COLOR_ATTACHMENT0,wn.__webglTexture,De,Q+Dr):ie.framebufferTexture2D(ie.READ_FRAMEBUFFER,ie.COLOR_ATTACHMENT0,ie.TEXTURE_2D,wn.__webglTexture,De),Fn?ie.framebufferTextureLayer(ie.DRAW_FRAMEBUFFER,ie.COLOR_ATTACHMENT0,bn.__webglTexture,pt,ae+Dr):ie.framebufferTexture2D(ie.DRAW_FRAMEBUFFER,ie.COLOR_ATTACHMENT0,ie.TEXTURE_2D,bn.__webglTexture,pt),De!==0?ie.blitFramebuffer(Ft,zt,lt,bt,te,ye,lt,bt,ie.COLOR_BUFFER_BIT,ie.NEAREST):Fn?ie.copyTexSubImage3D(Di,pt,te,ye,ae+Dr,Ft,zt,lt,bt):ie.copyTexSubImage2D(Di,pt,te,ye,Ft,zt,lt,bt);be.bindFramebuffer(ie.READ_FRAMEBUFFER,null),be.bindFramebuffer(ie.DRAW_FRAMEBUFFER,null)}else Fn?se.isDataTexture||se.isData3DTexture?ie.texSubImage3D(Di,pt,te,ye,ae,lt,bt,Et,rt,Ct,Ee.data):Ue.isCompressedArrayTexture?ie.compressedTexSubImage3D(Di,pt,te,ye,ae,lt,bt,Et,rt,Ee.data):ie.texSubImage3D(Di,pt,te,ye,ae,lt,bt,Et,rt,Ct,Ee):se.isDataTexture?ie.texSubImage2D(ie.TEXTURE_2D,pt,te,ye,lt,bt,rt,Ct,Ee.data):se.isCompressedTexture?ie.compressedTexSubImage2D(ie.TEXTURE_2D,pt,te,ye,Ee.width,Ee.height,rt,Ee.data):ie.texSubImage2D(ie.TEXTURE_2D,pt,te,ye,lt,bt,rt,Ct,Ee);ie.pixelStorei(ie.UNPACK_ROW_LENGTH,pi),ie.pixelStorei(ie.UNPACK_IMAGE_HEIGHT,qr),ie.pixelStorei(ie.UNPACK_SKIP_PIXELS,es),ie.pixelStorei(ie.UNPACK_SKIP_ROWS,xr),ie.pixelStorei(ie.UNPACK_SKIP_IMAGES,Bn),pt===0&&Ue.generateMipmaps&&ie.generateMipmap(Di),be.unbindTexture()},this.copyTextureToTexture3D=function(se,Ue,Qe=null,Ae=null,De=0){return se.isTexture!==!0&&(Rp("WebGLRenderer: copyTextureToTexture3D function signature has changed."),Qe=arguments[0]||null,Ae=arguments[1]||null,se=arguments[2],Ue=arguments[3],De=arguments[4]||0),Rp('WebGLRenderer: copyTextureToTexture3D function has been deprecated. Use "copyTextureToTexture" instead.'),this.copyTextureToTexture(se,Ue,Qe,Ae,De)},this.initRenderTarget=function(se){Fe.get(se).__webglFramebuffer===void 0&&K.setupRenderTarget(se)},this.initTexture=function(se){se.isCubeTexture?K.setTextureCube(se,0):se.isData3DTexture?K.setTexture3D(se,0):se.isDataArrayTexture||se.isCompressedArrayTexture?K.setTexture2DArray(se,0):K.setTexture2D(se,0),be.unbindTexture()},this.resetState=function(){S=0,T=0,E=null,be.reset(),dt.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return $l}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(t){this._outputColorSpace=t;const i=this.getContext();i.drawingBufferColorspace=Xi._getDrawingBufferColorSpace(t),i.unpackColorSpace=Xi._getUnpackColorSpace()}}const pXe=Object.freeze(Object.defineProperty({__proto__:null,ACESFilmicToneMapping:O4,AddEquation:Od,AddOperation:pne,AdditiveAnimationBlendMode:W4,AdditiveBlending:YB,AgXToneMapping:xne,AlphaFormat:N4,AlwaysCompare:Lne,AlwaysDepth:vT,AlwaysStencilFunc:JB,AmbientLight:Mse,AnimationAction:Ise,AnimationClip:pb,AnimationLoader:CHe,AnimationMixer:rje,AnimationObjectGroup:tje,AnimationUtils:MHe,ArcCurve:Zne,ArrayCamera:Pse,ArrowHelper:Eje,AttachedBindMode:KB,Audio:Dse,AudioAnalyser:WHe,AudioContext:vk,AudioListener:GHe,AudioLoader:NHe,AxesHelper:Aje,BackSide:La,BasicDepthPacking:Ene,BasicShadowMap:Yre,BatchedMesh:Xne,Bone:ek,BooleanKeyframeTrack:Jm,Box2:hje,Box3:Us,Box3Helper:Sje,BoxGeometry:Km,BoxHelper:_je,BufferAttribute:mr,BufferGeometry:Pi,BufferGeometryLoader:Cse,ByteType:B4,Cache:ph,Camera:qb,CameraHelper:bje,CanvasTexture:YGe,CapsuleGeometry:gP,CatmullRomCurve3:Kne,CineonToneMapping:vne,CircleGeometry:vP,ClampToEdgeWrapping:pl,Clock:yk,Color:Rt,ColorKeyframeTrack:fk,ColorManagement:Xi,CompressedArrayTexture:XGe,CompressedCubeTexture:qGe,CompressedTexture:pP,CompressedTextureLoader:PHe,ConeGeometry:yP,ConstantAlphaFactor:hne,ConstantColorFactor:cne,Controls:Cje,CubeCamera:Nne,CubeReflectionMapping:Oh,CubeRefractionMapping:wf,CubeTexture:Yb,CubeTextureLoader:DHe,CubeUVReflectionMapping:by,CubicBezierCurve:nk,CubicBezierCurve3:Jne,CubicInterpolant:gse,CullFaceBack:qB,CullFaceFront:qre,CullFaceFrontBack:n6e,CullFaceNone:Xre,Curve:dc,CurvePath:ese,CustomBlending:Qre,CustomToneMapping:yne,CylinderGeometry:Sy,Cylindrical:uje,Data3DTexture:cP,DataArrayTexture:Xb,DataTexture:nu,DataTextureLoader:RHe,DataUtils:xGe,DecrementStencilOp:y6e,DecrementWrapStencilOp:w6e,DefaultLoadingManager:xse,DepthFormat:dm,DepthStencilFormat:Om,DepthTexture:ik,DetachedBindMode:bne,DirectionalLight:Sse,DirectionalLightHelper:wje,DiscreteInterpolant:vse,DodecahedronGeometry:xP,DoubleSide:Ql,DstAlphaFactor:nne,DstColorFactor:ane,DynamicCopyUsage:z6e,DynamicDrawUsage:P6e,DynamicReadUsage:I6e,EdgesGeometry:tse,EllipseCurve:mP,EqualCompare:Pne,EqualDepth:xT,EqualStencilFunc:M6e,EquirectangularReflectionMapping:Jw,EquirectangularRefractionMapping:$w,Euler:Fo,EventDispatcher:pu,ExtrudeGeometry:bP,FileLoader:Bh,Float16BufferAttribute:AGe,Float32BufferAttribute:Gt,FloatType:so,Fog:hP,FogExp2:uP,FramebufferTexture:WGe,FrontSide:Lh,Frustum:Qb,GLBufferAttribute:cje,GLSL1:F6e,GLSL3:$B,GreaterCompare:Dne,GreaterDepth:bT,GreaterEqualCompare:Ine,GreaterEqualDepth:wT,GreaterEqualStencilFunc:C6e,GreaterStencilFunc:A6e,GridHelper:yje,Group:Kv,HalfFloatType:_y,HemisphereLight:wse,HemisphereLightHelper:vje,IcosahedronGeometry:_P,ImageBitmapLoader:UHe,ImageLoader:mb,ImageUtils:Bne,IncrementStencilOp:v6e,IncrementWrapStencilOp:x6e,InstancedBufferAttribute:Fm,InstancedBufferGeometry:gk,InstancedInterleavedBuffer:lje,InstancedMesh:Wne,Int16BufferAttribute:MGe,Int32BufferAttribute:EGe,Int8BufferAttribute:bGe,IntType:tP,InterleavedBuffer:dP,InterleavedBufferAttribute:Bm,Interpolant:$b,InterpolateDiscrete:ib,InterpolateLinear:QT,InterpolateSmooth:g2,InvertStencilOp:b6e,KeepStencilOp:Dp,KeyframeTrack:fc,LOD:Hne,LatheGeometry:Zb,Layers:pm,LessCompare:Cne,LessDepth:yT,LessEqualCompare:q4,LessEqualDepth:Im,LessEqualStencilFunc:E6e,LessStencilFunc:S6e,Light:Lf,LightProbe:Tse,Line:bf,Line3:dje,LineBasicMaterial:ka,LineCurve:sk,LineCurve3:$ne,LineDashedMaterial:fse,LineLoop:qne,LineSegments:mu,LinearFilter:pn,LinearInterpolant:dk,LinearMipMapLinearFilter:l6e,LinearMipMapNearestFilter:o6e,LinearMipmapLinearFilter:qc,LinearMipmapNearestFilter:qx,LinearSRGBColorSpace:zm,LinearToneMapping:mne,LinearTransfer:nb,Loader:fo,LoaderUtils:nF,LoadingManager:pk,LoopOnce:_ne,LoopPingPong:Mne,LoopRepeat:Sne,LuminanceAlphaFormat:G4,LuminanceFormat:V4,MOUSE:Cp,Material:ha,MaterialLoader:RP,MathUtils:v2,Matrix2:_k,Matrix3:xi,Matrix4:ci,MaxEquation:$re,Mesh:Gr,MeshBasicMaterial:kh,MeshDepthMaterial:PP,MeshDistanceMaterial:DP,MeshLambertMaterial:hse,MeshMatcapMaterial:dse,MeshNormalMaterial:use,MeshPhongMaterial:lse,MeshPhysicalMaterial:uk,MeshStandardMaterial:ck,MeshToonMaterial:cse,MinEquation:Jre,MirroredRepeatWrapping:tb,MixOperation:fne,MultiplyBlending:ZB,MultiplyOperation:jb,NearestFilter:Fs,NearestMipMapLinearFilter:a6e,NearestMipMapNearestFilter:s6e,NearestMipmapLinearFilter:Qv,NearestMipmapNearestFilter:z4,NeutralToneMapping:wne,NeverCompare:Tne,NeverDepth:gT,NeverStencilFunc:_6e,NoBlending:wh,NoColorSpace:rh,NoToneMapping:ru,NormalAnimationBlendMode:oP,NormalBlending:hm,NotEqualCompare:Rne,NotEqualDepth:_T,NotEqualStencilFunc:T6e,NumberKeyframeTrack:db,Object3D:Qi,ObjectLoader:BHe,ObjectSpaceNormalMap:Ane,OctahedronGeometry:Kb,OneFactor:tne,OneMinusConstantAlphaFactor:dne,OneMinusConstantColorFactor:une,OneMinusDstAlphaFactor:sne,OneMinusDstColorFactor:one,OneMinusSrcAlphaFactor:mT,OneMinusSrcColorFactor:rne,OrthographicCamera:hf,PCFShadowMap:$C,PCFSoftShadowMap:Xx,PMREMGenerator:lF,Path:lb,PerspectiveCamera:fn,Plane:eh,PlaneGeometry:Vh,PlaneHelper:Mje,PointLight:_se,PointLightHelper:mje,Points:Yne,PointsMaterial:tk,PolarGridHelper:xje,PolyhedronGeometry:If,PositionalAudio:jHe,PropertyBinding:qi,PropertyMixer:Rse,QuadraticBezierCurve:ak,QuadraticBezierCurve3:ok,Quaternion:oa,QuaternionKeyframeTrack:e_,QuaternionLinearInterpolant:yse,RED_GREEN_RGTC2_Format:qT,RED_RGTC1_Format:j4,REVISION:JC,RGBADepthPacking:X4,RGBAFormat:sa,RGBAIntegerFormat:aP,RGBA_ASTC_10x10_Format:VT,RGBA_ASTC_10x5_Format:UT,RGBA_ASTC_10x6_Format:NT,RGBA_ASTC_10x8_Format:kT,RGBA_ASTC_12x10_Format:GT,RGBA_ASTC_12x12_Format:HT,RGBA_ASTC_4x4_Format:DT,RGBA_ASTC_5x4_Format:RT,RGBA_ASTC_5x5_Format:IT,RGBA_ASTC_6x5_Format:LT,RGBA_ASTC_6x6_Format:OT,RGBA_ASTC_8x5_Format:zT,RGBA_ASTC_8x6_Format:BT,RGBA_ASTC_8x8_Format:FT,RGBA_BPTC_Format:Jx,RGBA_ETC2_EAC_Format:PT,RGBA_PVRTC_2BPPV1_Format:AT,RGBA_PVRTC_4BPPV1_Format:ET,RGBA_S3TC_DXT1_Format:Qx,RGBA_S3TC_DXT3_Format:Zx,RGBA_S3TC_DXT5_Format:Kx,RGBDepthPacking:f6e,RGBFormat:k4,RGBIntegerFormat:c6e,RGB_BPTC_SIGNED_Format:jT,RGB_BPTC_UNSIGNED_Format:WT,RGB_ETC1_Format:TT,RGB_ETC2_Format:CT,RGB_PVRTC_2BPPV1_Format:MT,RGB_PVRTC_4BPPV1_Format:ST,RGB_S3TC_DXT1_Format:Yx,RGDepthPacking:p6e,RGFormat:H4,RGIntegerFormat:sP,RawShaderMaterial:ose,Ray:Zm,Raycaster:Lse,RectAreaLight:Ese,RedFormat:nP,RedIntegerFormat:Wb,ReinhardToneMapping:gne,RenderTarget:lP,RenderTarget3D:nje,RenderTargetArray:sje,RepeatWrapping:eb,ReplaceStencilOp:g6e,ReverseSubtractEquation:Kre,RingGeometry:SP,SIGNED_RED_GREEN_RGTC2_Format:YT,SIGNED_RED_RGTC1_Format:XT,SRGBColorSpace:Qa,SRGBTransfer:sr,Scene:J4,ShaderChunk:Ai,ShaderLib:Wl,ShaderMaterial:cc,ShadowMaterial:ase,Shape:mm,ShapeGeometry:MP,ShapePath:Tje,ShapeUtils:su,ShortType:F4,Skeleton:fP,SkeletonHelper:pje,SkinnedMesh:jne,Source:Yd,Sphere:Ns,SphereGeometry:Jb,Spherical:aF,SphericalHarmonics3:Ase,SplineCurve:lk,SpotLight:bse,SpotLightHelper:fje,Sprite:Gne,SpriteMaterial:$4,SrcAlphaFactor:pT,SrcAlphaSaturateFactor:lne,SrcColorFactor:ine,StaticCopyUsage:O6e,StaticDrawUsage:sb,StaticReadUsage:R6e,StereoCamera:kHe,StreamCopyUsage:B6e,StreamDrawUsage:D6e,StreamReadUsage:L6e,StringKeyframeTrack:$m,SubtractEquation:Zre,SubtractiveBlending:QB,TOUCH:Pp,TangentSpaceNormalMap:Rf,TetrahedronGeometry:EP,Texture:Wr,TextureLoader:IHe,TextureUtils:Lje,TimestampQuery:U6e,TorusGeometry:AP,TorusKnotGeometry:TP,Triangle:to,TriangleFanDrawMode:d6e,TriangleStripDrawMode:h6e,TrianglesDrawMode:u6e,TubeGeometry:CP,UVMapping:eP,Uint16BufferAttribute:Q4,Uint32BufferAttribute:Z4,Uint8BufferAttribute:_Ge,Uint8ClampedBufferAttribute:SGe,Uniform:bk,UniformsGroup:oje,UniformsLib:At,UniformsUtils:K4,UnsignedByteType:lc,UnsignedInt248Type:Lm,UnsignedInt5999Type:U4,UnsignedIntType:zh,UnsignedShort4444Type:iP,UnsignedShort5551Type:rP,UnsignedShortType:q0,VSMShadowMap:Gl,Vector2:ut,Vector3:he,Vector4:Hi,VectorKeyframeTrack:fb,VideoFrameTexture:jGe,VideoTexture:Qne,WebGL3DRenderTarget:cGe,WebGLArrayRenderTarget:lGe,WebGLCoordinateSystem:$l,WebGLCubeRenderTarget:kne,WebGLRenderTarget:uu,WebGLRenderer:Vse,WebGLUtils:kse,WebGPUCoordinateSystem:ab,WebXRController:y2,WireframeGeometry:sse,WrapAroundEnding:rb,ZeroCurvatureEnding:Jp,ZeroFactor:ene,ZeroSlopeEnding:$p,ZeroStencilOp:m6e,createCanvasElement:zne},Symbol.toStringTag,{value:"Module"}));var Gse={exports:{}},eg={};/**
 * @license React
 * react-reconciler-constants.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */eg.ConcurrentRoot=1;eg.ContinuousEventPriority=4;eg.DefaultEventPriority=16;eg.DiscreteEventPriority=1;eg.IdleEventPriority=536870912;eg.LegacyRoot=0;Gse.exports=eg;var e0=Gse.exports;function mXe(e){let t;const i=new Set,r=(c,u)=>{const h=typeof c=="function"?c(t):c;if(h!==t){const d=t;t=u?h:Object.assign({},t,h),i.forEach(f=>f(t,d))}},n=()=>t,s=(c,u=n,h=Object.is)=>{console.warn("[DEPRECATED] Please use `subscribeWithSelector` middleware");let d=u(t);function f(){const p=u(t);if(!h(d,p)){const v=d;c(d=p,v)}}return i.add(f),()=>i.delete(f)},l={setState:r,getState:n,subscribe:(c,u,h)=>u||h?s(c,u,h):(i.add(c),()=>i.delete(c)),destroy:()=>i.clear()};return t=e(r,n,l),l}const gXe=typeof window>"u"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent),Uq=gXe?_e.useEffect:_e.useLayoutEffect;function vXe(e){const t=typeof e=="function"?mXe(e):e,i=(r=t.getState,n=Object.is)=>{const[,s]=_e.useReducer(m=>m+1,0),a=t.getState(),o=_e.useRef(a),l=_e.useRef(r),c=_e.useRef(n),u=_e.useRef(!1),h=_e.useRef();h.current===void 0&&(h.current=r(a));let d,f=!1;(o.current!==a||l.current!==r||c.current!==n||u.current)&&(d=r(a),f=!n(h.current,d)),Uq(()=>{f&&(h.current=d),o.current=a,l.current=r,c.current=n,u.current=!1});const p=_e.useRef(a);Uq(()=>{const m=()=>{try{const y=t.getState(),x=l.current(y);c.current(h.current,x)||(o.current=y,h.current=x,s())}catch{u.current=!0,s()}},g=t.subscribe(m);return t.getState()!==p.current&&m(),g},[]);const v=f?d:h.current;return _e.useDebugValue(v),v};return Object.assign(i,t),i[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");const r=[i,t];return{next(){const n=r.length<=0;return{value:r.shift(),done:n}}}},i}const yXe=e=>typeof e=="object"&&typeof e.then=="function",DE=[];function xXe(e,t,i=(r,n)=>r===n){if(e===t)return!0;if(!e||!t)return!1;const r=e.length;if(t.length!==r)return!1;for(let n=0;n<r;n++)if(!i(e[n],t[n]))return!1;return!0}function wXe(e,t=null,i=!1,r={}){t===null&&(t=[e]);for(const s of DE)if(xXe(t,s.keys,s.equal)){if(i)return;if(Object.prototype.hasOwnProperty.call(s,"error"))throw s.error;if(Object.prototype.hasOwnProperty.call(s,"response"))return r.lifespan&&r.lifespan>0&&(s.timeout&&clearTimeout(s.timeout),s.timeout=setTimeout(s.remove,r.lifespan)),s.response;if(!i)throw s.promise}const n={keys:t,equal:r.equal,remove:()=>{const s=DE.indexOf(n);s!==-1&&DE.splice(s,1)},promise:(yXe(e)?e:e(...t)).then(s=>{n.response=s,r.lifespan&&r.lifespan>0&&(n.timeout=setTimeout(n.remove,r.lifespan))}).catch(s=>n.error=s)};if(DE.push(n),!i)throw n.promise}const bXe=(e,t,i)=>wXe(e,t,!1,i);var Hse={exports:{}},pL={exports:{}},mL={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Nq;function _Xe(){return Nq||(Nq=1,function(e){function t(z,V){var U=z.length;z.push(V);e:for(;0<U;){var k=U-1>>>1,X=z[k];if(0<n(X,V))z[k]=V,z[U]=X,U=k;else break e}}function i(z){return z.length===0?null:z[0]}function r(z){if(z.length===0)return null;var V=z[0],U=z.pop();if(U!==V){z[0]=U;e:for(var k=0,X=z.length,re=X>>>1;k<re;){var q=2*(k+1)-1,ee=z[q],$=q+1,ne=z[$];if(0>n(ee,U))$<X&&0>n(ne,ee)?(z[k]=ne,z[$]=U,k=$):(z[k]=ee,z[q]=U,k=q);else if($<X&&0>n(ne,U))z[k]=ne,z[$]=U,k=$;else break e}}return V}function n(z,V){var U=z.sortIndex-V.sortIndex;return U!==0?U:z.id-V.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;e.unstable_now=function(){return s.now()}}else{var a=Date,o=a.now();e.unstable_now=function(){return a.now()-o}}var l=[],c=[],u=1,h=null,d=3,f=!1,p=!1,v=!1,m=typeof setTimeout=="function"?setTimeout:null,g=typeof clearTimeout=="function"?clearTimeout:null,y=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function x(z){for(var V=i(c);V!==null;){if(V.callback===null)r(c);else if(V.startTime<=z)r(c),V.sortIndex=V.expirationTime,t(l,V);else break;V=i(c)}}function _(z){if(v=!1,x(z),!p)if(i(l)!==null)p=!0,j(M);else{var V=i(c);V!==null&&Y(_,V.startTime-z)}}function M(z,V){p=!1,v&&(v=!1,g(E),E=-1),f=!0;var U=d;try{for(x(V),h=i(l);h!==null&&(!(h.expirationTime>V)||z&&!D());){var k=h.callback;if(typeof k=="function"){h.callback=null,d=h.priorityLevel;var X=k(h.expirationTime<=V);V=e.unstable_now(),typeof X=="function"?h.callback=X:h===i(l)&&r(l),x(V)}else r(l);h=i(l)}if(h!==null)var re=!0;else{var q=i(c);q!==null&&Y(_,q.startTime-V),re=!1}return re}finally{h=null,d=U,f=!1}}var S=!1,T=null,E=-1,C=5,A=-1;function D(){return!(e.unstable_now()-A<C)}function R(){if(T!==null){var z=e.unstable_now();A=z;var V=!0;try{V=T(!0,z)}finally{V?L():(S=!1,T=null)}}else S=!1}var L;if(typeof y=="function")L=function(){y(R)};else if(typeof MessageChannel<"u"){var O=new MessageChannel,H=O.port2;O.port1.onmessage=R,L=function(){H.postMessage(null)}}else L=function(){m(R,0)};function j(z){T=z,S||(S=!0,L())}function Y(z,V){E=m(function(){z(e.unstable_now())},V)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(z){z.callback=null},e.unstable_continueExecution=function(){p||f||(p=!0,j(M))},e.unstable_forceFrameRate=function(z){0>z||125<z?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):C=0<z?Math.floor(1e3/z):5},e.unstable_getCurrentPriorityLevel=function(){return d},e.unstable_getFirstCallbackNode=function(){return i(l)},e.unstable_next=function(z){switch(d){case 1:case 2:case 3:var V=3;break;default:V=d}var U=d;d=V;try{return z()}finally{d=U}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(z,V){switch(z){case 1:case 2:case 3:case 4:case 5:break;default:z=3}var U=d;d=z;try{return V()}finally{d=U}},e.unstable_scheduleCallback=function(z,V,U){var k=e.unstable_now();switch(typeof U=="object"&&U!==null?(U=U.delay,U=typeof U=="number"&&0<U?k+U:k):U=k,z){case 1:var X=-1;break;case 2:X=250;break;case 5:X=1073741823;break;case 4:X=1e4;break;default:X=5e3}return X=U+X,z={id:u++,callback:V,priorityLevel:z,startTime:U,expirationTime:X,sortIndex:-1},U>k?(z.sortIndex=U,t(c,z),i(l)===null&&z===i(c)&&(v?(g(E),E=-1):v=!0,Y(_,U-k))):(z.sortIndex=X,t(l,z),p||f||(p=!0,j(M))),z},e.unstable_shouldYield=D,e.unstable_wrapCallback=function(z){var V=d;return function(){var U=d;d=V;try{return z.apply(this,arguments)}finally{d=U}}}}(mL)),mL}var kq;function SXe(){return kq||(kq=1,pL.exports=_Xe()),pL.exports}/**
 * @license React
 * react-reconciler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var MXe=function(t){var i={},r=_e,n=SXe(),s=Object.assign;function a(w){for(var b="https://reactjs.org/docs/error-decoder.html?invariant="+w,P=1;P<arguments.length;P++)b+="&args[]="+encodeURIComponent(arguments[P]);return"Minified React error #"+w+"; visit "+b+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,l=Symbol.for("react.element"),c=Symbol.for("react.portal"),u=Symbol.for("react.fragment"),h=Symbol.for("react.strict_mode"),d=Symbol.for("react.profiler"),f=Symbol.for("react.provider"),p=Symbol.for("react.context"),v=Symbol.for("react.forward_ref"),m=Symbol.for("react.suspense"),g=Symbol.for("react.suspense_list"),y=Symbol.for("react.memo"),x=Symbol.for("react.lazy"),_=Symbol.for("react.offscreen"),M=Symbol.iterator;function S(w){return w===null||typeof w!="object"?null:(w=M&&w[M]||w["@@iterator"],typeof w=="function"?w:null)}function T(w){if(w==null)return null;if(typeof w=="function")return w.displayName||w.name||null;if(typeof w=="string")return w;switch(w){case u:return"Fragment";case c:return"Portal";case d:return"Profiler";case h:return"StrictMode";case m:return"Suspense";case g:return"SuspenseList"}if(typeof w=="object")switch(w.$$typeof){case p:return(w.displayName||"Context")+".Consumer";case f:return(w._context.displayName||"Context")+".Provider";case v:var b=w.render;return w=w.displayName,w||(w=b.displayName||b.name||"",w=w!==""?"ForwardRef("+w+")":"ForwardRef"),w;case y:return b=w.displayName||null,b!==null?b:T(w.type)||"Memo";case x:b=w._payload,w=w._init;try{return T(w(b))}catch{}}return null}function E(w){var b=w.type;switch(w.tag){case 24:return"Cache";case 9:return(b.displayName||"Context")+".Consumer";case 10:return(b._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return w=b.render,w=w.displayName||w.name||"",b.displayName||(w!==""?"ForwardRef("+w+")":"ForwardRef");case 7:return"Fragment";case 5:return b;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return T(b);case 8:return b===h?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof b=="function")return b.displayName||b.name||null;if(typeof b=="string")return b}return null}function C(w){var b=w,P=w;if(w.alternate)for(;b.return;)b=b.return;else{w=b;do b=w,b.flags&4098&&(P=b.return),w=b.return;while(w)}return b.tag===3?P:null}function A(w){if(C(w)!==w)throw Error(a(188))}function D(w){var b=w.alternate;if(!b){if(b=C(w),b===null)throw Error(a(188));return b!==w?null:w}for(var P=w,I=b;;){var F=P.return;if(F===null)break;var Z=F.alternate;if(Z===null){if(I=F.return,I!==null){P=I;continue}break}if(F.child===Z.child){for(Z=F.child;Z;){if(Z===P)return A(F),w;if(Z===I)return A(F),b;Z=Z.sibling}throw Error(a(188))}if(P.return!==I.return)P=F,I=Z;else{for(var Se=!1,Ve=F.child;Ve;){if(Ve===P){Se=!0,P=F,I=Z;break}if(Ve===I){Se=!0,I=F,P=Z;break}Ve=Ve.sibling}if(!Se){for(Ve=Z.child;Ve;){if(Ve===P){Se=!0,P=Z,I=F;break}if(Ve===I){Se=!0,I=Z,P=F;break}Ve=Ve.sibling}if(!Se)throw Error(a(189))}}if(P.alternate!==I)throw Error(a(190))}if(P.tag!==3)throw Error(a(188));return P.stateNode.current===P?w:b}function R(w){return w=D(w),w!==null?L(w):null}function L(w){if(w.tag===5||w.tag===6)return w;for(w=w.child;w!==null;){var b=L(w);if(b!==null)return b;w=w.sibling}return null}function O(w){if(w.tag===5||w.tag===6)return w;for(w=w.child;w!==null;){if(w.tag!==4){var b=O(w);if(b!==null)return b}w=w.sibling}return null}var H=Array.isArray,j=t.getPublicInstance,Y=t.getRootHostContext,z=t.getChildHostContext,V=t.prepareForCommit,U=t.resetAfterCommit,k=t.createInstance,X=t.appendInitialChild,re=t.finalizeInitialChildren,q=t.prepareUpdate,ee=t.shouldSetTextContent,$=t.createTextInstance,ne=t.scheduleTimeout,ce=t.cancelTimeout,pe=t.noTimeout,ge=t.isPrimaryRenderer,we=t.supportsMutation,le=t.supportsPersistence,ve=t.supportsHydration,ie=t.getInstanceFromNode,Ce=t.preparePortalMount,Pe=t.getCurrentEventPriority,Ne=t.detachDeletedInstance,be=t.supportsMicrotasks,Le=t.scheduleMicrotask,Fe=t.supportsTestSelectors,K=t.findFiberRoot,B=t.getBoundingRect,G=t.getTextContent,oe=t.isHiddenSubtree,fe=t.matchAccessibilityRole,W=t.setFocusIfFocusable,Ie=t.setupIntersectionObserver,Oe=t.appendChild,Be=t.appendChildToContainer,Re=t.commitTextUpdate,ke=t.commitMount,qe=t.commitUpdate,Ke=t.insertBefore,it=t.insertInContainerBefore,He=t.removeChild,de=t.removeChildFromContainer,We=t.resetTextContent,dt=t.hideInstance,J=t.hideTextInstance,xe=t.unhideInstance,me=t.unhideTextInstance,ze=t.clearContainer,Ze=t.cloneInstance,Je=t.createContainerChildSet,mt=t.appendChildToContainerChildSet,St=t.finalizeContainerChildren,Mt=t.replaceContainerChildren,vt=t.cloneHiddenInstance,ui=t.cloneHiddenTextInstance,hi=t.canHydrateInstance,$i=t.canHydrateTextInstance,xn=t.canHydrateSuspenseInstance,Or=t.isSuspenseInstancePending,zr=t.isSuspenseInstanceFallback,ue=t.registerSuspenseInstanceRetry,Xe=t.getNextHydratableSibling,et=t.getFirstHydratableChild,Ge=t.getFirstHydratableChildWithinContainer,nt=t.getFirstHydratableChildWithinSuspenseInstance,It=t.hydrateInstance,jt=t.hydrateTextInstance,Jt=t.hydrateSuspenseInstance,Vt=t.getNextHydratableInstanceAfterSuspenseInstance,Ei=t.commitHydratedContainer,li=t.commitHydratedSuspenseInstance,fi=t.clearSuspenseBoundary,si=t.clearSuspenseBoundaryFromContainer,se=t.shouldDeleteUnhydratedTailInstances,Ue=t.didNotMatchHydratedContainerTextInstance,Qe=t.didNotMatchHydratedTextInstance,Ae;function De(w){if(Ae===void 0)try{throw Error()}catch(P){var b=P.stack.trim().match(/\n( *(at )?)/);Ae=b&&b[1]||""}return`
`+Ae+w}var pt=!1;function lt(w,b){if(!w||pt)return"";pt=!0;var P=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(b)if(b=function(){throw Error()},Object.defineProperty(b.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(b,[])}catch(yt){var I=yt}Reflect.construct(w,[],b)}else{try{b.call()}catch(yt){I=yt}w.call(b.prototype)}else{try{throw Error()}catch(yt){I=yt}w()}}catch(yt){if(yt&&I&&typeof yt.stack=="string"){for(var F=yt.stack.split(`
`),Z=I.stack.split(`
`),Se=F.length-1,Ve=Z.length-1;1<=Se&&0<=Ve&&F[Se]!==Z[Ve];)Ve--;for(;1<=Se&&0<=Ve;Se--,Ve--)if(F[Se]!==Z[Ve]){if(Se!==1||Ve!==1)do if(Se--,Ve--,0>Ve||F[Se]!==Z[Ve]){var ot=`
`+F[Se].replace(" at new "," at ");return w.displayName&&ot.includes("<anonymous>")&&(ot=ot.replace("<anonymous>",w.displayName)),ot}while(1<=Se&&0<=Ve);break}}}finally{pt=!1,Error.prepareStackTrace=P}return(w=w?w.displayName||w.name:"")?De(w):""}var bt=Object.prototype.hasOwnProperty,Et=[],Ft=-1;function zt(w){return{current:w}}function Q(w){0>Ft||(w.current=Et[Ft],Et[Ft]=null,Ft--)}function te(w,b){Ft++,Et[Ft]=w.current,w.current=b}var ye={},ae=zt(ye),Ee=zt(!1),rt=ye;function Ct(w,b){var P=w.type.contextTypes;if(!P)return ye;var I=w.stateNode;if(I&&I.__reactInternalMemoizedUnmaskedChildContext===b)return I.__reactInternalMemoizedMaskedChildContext;var F={},Z;for(Z in P)F[Z]=b[Z];return I&&(w=w.stateNode,w.__reactInternalMemoizedUnmaskedChildContext=b,w.__reactInternalMemoizedMaskedChildContext=F),F}function Di(w){return w=w.childContextTypes,w!=null}function pi(){Q(Ee),Q(ae)}function qr(w,b,P){if(ae.current!==ye)throw Error(a(168));te(ae,b),te(Ee,P)}function es(w,b,P){var I=w.stateNode;if(b=b.childContextTypes,typeof I.getChildContext!="function")return P;I=I.getChildContext();for(var F in I)if(!(F in b))throw Error(a(108,E(w)||"Unknown",F));return s({},P,I)}function xr(w){return w=(w=w.stateNode)&&w.__reactInternalMemoizedMergedChildContext||ye,rt=ae.current,te(ae,w),te(Ee,Ee.current),!0}function Bn(w,b,P){var I=w.stateNode;if(!I)throw Error(a(169));P?(w=es(w,b,rt),I.__reactInternalMemoizedMergedChildContext=w,Q(Ee),Q(ae),te(ae,w)):Q(Ee),te(Ee,P)}var Li=Math.clz32?Math.clz32:bn,Fn=Math.log,wn=Math.LN2;function bn(w){return w>>>=0,w===0?32:31-(Fn(w)/wn|0)|0}var Dr=64,po=4194304;function ws(w){switch(w&-w){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return w&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return w&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return w}}function Of(w,b){var P=w.pendingLanes;if(P===0)return 0;var I=0,F=w.suspendedLanes,Z=w.pingedLanes,Se=P&268435455;if(Se!==0){var Ve=Se&~F;Ve!==0?I=ws(Ve):(Z&=Se,Z!==0&&(I=ws(Z)))}else Se=P&~F,Se!==0?I=ws(Se):Z!==0&&(I=ws(Z));if(I===0)return 0;if(b!==0&&b!==I&&!(b&F)&&(F=I&-I,Z=b&-b,F>=Z||F===16&&(Z&4194240)!==0))return b;if(I&4&&(I|=P&16),b=w.entangledLanes,b!==0)for(w=w.entanglements,b&=I;0<b;)P=31-Li(b),F=1<<P,I|=w[P],b&=~F;return I}function i_(w,b){switch(w){case 1:case 2:case 4:return b+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return b+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Ay(w,b){for(var P=w.suspendedLanes,I=w.pingedLanes,F=w.expirationTimes,Z=w.pendingLanes;0<Z;){var Se=31-Li(Z),Ve=1<<Se,ot=F[Se];ot===-1?(!(Ve&P)||Ve&I)&&(F[Se]=i_(Ve,b)):ot<=b&&(w.expiredLanes|=Ve),Z&=~Ve}}function gu(w){return w=w.pendingLanes&-1073741825,w!==0?w:w&1073741824?1073741824:0}function tg(w){for(var b=[],P=0;31>P;P++)b.push(w);return b}function pc(w,b,P){w.pendingLanes|=b,b!==536870912&&(w.suspendedLanes=0,w.pingedLanes=0),w=w.eventTimes,b=31-Li(b),w[b]=P}function Gh(w,b){var P=w.pendingLanes&~b;w.pendingLanes=b,w.suspendedLanes=0,w.pingedLanes=0,w.expiredLanes&=b,w.mutableReadLanes&=b,w.entangledLanes&=b,b=w.entanglements;var I=w.eventTimes;for(w=w.expirationTimes;0<P;){var F=31-Li(P),Z=1<<F;b[F]=0,I[F]=-1,w[F]=-1,P&=~Z}}function mc(w,b){var P=w.entangledLanes|=b;for(w=w.entanglements;P;){var I=31-Li(P),F=1<<I;F&b|w[I]&b&&(w[I]|=b),P&=~F}}var Oi=0;function Ty(w){return w&=-w,1<w?4<w?w&268435455?16:536870912:4:1}var vu=n.unstable_scheduleCallback,ig=n.unstable_cancelCallback,Cy=n.unstable_shouldYield,r_=n.unstable_requestPaint,Br=n.unstable_now,zf=n.unstable_ImmediatePriority,n_=n.unstable_UserBlockingPriority,da=n.unstable_NormalPriority,Py=n.unstable_IdlePriority,Bf=null,mo=null;function Dy(w){if(mo&&typeof mo.onCommitFiberRoot=="function")try{mo.onCommitFiberRoot(Bf,w,void 0,(w.current.flags&128)===128)}catch{}}function s_(w,b){return w===b&&(w!==0||1/w===1/b)||w!==w&&b!==b}var go=typeof Object.is=="function"?Object.is:s_,fa=null,gc=!1,Vo=!1;function Ry(w){fa===null?fa=[w]:fa.push(w)}function Iy(w){gc=!0,Ry(w)}function Va(){if(!Vo&&fa!==null){Vo=!0;var w=0,b=Oi;try{var P=fa;for(Oi=1;w<P.length;w++){var I=P[w];do I=I(!0);while(I!==null)}fa=null,gc=!1}catch(F){throw fa!==null&&(fa=fa.slice(w+1)),vu(zf,Va),F}finally{Oi=b,Vo=!1}}return null}var Ff=o.ReactCurrentBatchConfig;function Uf(w,b){if(go(w,b))return!0;if(typeof w!="object"||w===null||typeof b!="object"||b===null)return!1;var P=Object.keys(w),I=Object.keys(b);if(P.length!==I.length)return!1;for(I=0;I<P.length;I++){var F=P[I];if(!bt.call(b,F)||!go(w[F],b[F]))return!1}return!0}function Nf(w){switch(w.tag){case 5:return De(w.type);case 16:return De("Lazy");case 13:return De("Suspense");case 19:return De("SuspenseList");case 0:case 2:case 15:return w=lt(w.type,!1),w;case 11:return w=lt(w.type.render,!1),w;case 1:return w=lt(w.type,!0),w;default:return""}}function pa(w,b){if(w&&w.defaultProps){b=s({},b),w=w.defaultProps;for(var P in w)b[P]===void 0&&(b[P]=w[P]);return b}return b}var ts=zt(null),rg=null,Sl=null,Hh=null;function ng(){Hh=Sl=rg=null}function a_(w,b,P){ge?(te(ts,b._currentValue),b._currentValue=P):(te(ts,b._currentValue2),b._currentValue2=P)}function is(w){var b=ts.current;Q(ts),ge?w._currentValue=b:w._currentValue2=b}function ma(w,b,P){for(;w!==null;){var I=w.alternate;if((w.childLanes&b)!==b?(w.childLanes|=b,I!==null&&(I.childLanes|=b)):I!==null&&(I.childLanes&b)!==b&&(I.childLanes|=b),w===P)break;w=w.return}}function nn(w,b){rg=w,Hh=Sl=null,w=w.dependencies,w!==null&&w.firstContext!==null&&(w.lanes&b&&(wo=!0),w.firstContext=null)}function sn(w){var b=ge?w._currentValue:w._currentValue2;if(Hh!==w)if(w={context:w,memoizedValue:b,next:null},Sl===null){if(rg===null)throw Error(a(308));Sl=w,rg.dependencies={lanes:0,firstContext:w}}else Sl=Sl.next=w;return b}var vo=null,jh=!1;function zP(w){w.updateQueue={baseState:w.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Tk(w,b){w=w.updateQueue,b.updateQueue===w&&(b.updateQueue={baseState:w.baseState,firstBaseUpdate:w.firstBaseUpdate,lastBaseUpdate:w.lastBaseUpdate,shared:w.shared,effects:w.effects})}function yu(w,b){return{eventTime:w,lane:b,tag:0,payload:null,callback:null,next:null}}function Wh(w,b){var P=w.updateQueue;P!==null&&(P=P.shared,_n!==null&&w.mode&1&&!(Ii&2)?(w=P.interleaved,w===null?(b.next=b,vo===null?vo=[P]:vo.push(P)):(b.next=w.next,w.next=b),P.interleaved=b):(w=P.pending,w===null?b.next=b:(b.next=w.next,w.next=b),P.pending=b))}function o_(w,b,P){if(b=b.updateQueue,b!==null&&(b=b.shared,(P&4194240)!==0)){var I=b.lanes;I&=w.pendingLanes,P|=I,b.lanes=P,mc(w,P)}}function Ck(w,b){var P=w.updateQueue,I=w.alternate;if(I!==null&&(I=I.updateQueue,P===I)){var F=null,Z=null;if(P=P.firstBaseUpdate,P!==null){do{var Se={eventTime:P.eventTime,lane:P.lane,tag:P.tag,payload:P.payload,callback:P.callback,next:null};Z===null?F=Z=Se:Z=Z.next=Se,P=P.next}while(P!==null);Z===null?F=Z=b:Z=Z.next=b}else F=Z=b;P={baseState:I.baseState,firstBaseUpdate:F,lastBaseUpdate:Z,shared:I.shared,effects:I.effects},w.updateQueue=P;return}w=P.lastBaseUpdate,w===null?P.firstBaseUpdate=b:w.next=b,P.lastBaseUpdate=b}function l_(w,b,P,I){var F=w.updateQueue;jh=!1;var Z=F.firstBaseUpdate,Se=F.lastBaseUpdate,Ve=F.shared.pending;if(Ve!==null){F.shared.pending=null;var ot=Ve,yt=ot.next;ot.next=null,Se===null?Z=yt:Se.next=yt,Se=ot;var Ut=w.alternate;Ut!==null&&(Ut=Ut.updateQueue,Ve=Ut.lastBaseUpdate,Ve!==Se&&(Ve===null?Ut.firstBaseUpdate=yt:Ve.next=yt,Ut.lastBaseUpdate=ot))}if(Z!==null){var _i=F.baseState;Se=0,Ut=yt=ot=null,Ve=Z;do{var ei=Ve.lane,gr=Ve.eventTime;if((I&ei)===ei){Ut!==null&&(Ut=Ut.next={eventTime:gr,lane:0,tag:Ve.tag,payload:Ve.payload,callback:Ve.callback,next:null});e:{var Wt=w,Ws=Ve;switch(ei=b,gr=P,Ws.tag){case 1:if(Wt=Ws.payload,typeof Wt=="function"){_i=Wt.call(gr,_i,ei);break e}_i=Wt;break e;case 3:Wt.flags=Wt.flags&-65537|128;case 0:if(Wt=Ws.payload,ei=typeof Wt=="function"?Wt.call(gr,_i,ei):Wt,ei==null)break e;_i=s({},_i,ei);break e;case 2:jh=!0}}Ve.callback!==null&&Ve.lane!==0&&(w.flags|=64,ei=F.effects,ei===null?F.effects=[Ve]:ei.push(Ve))}else gr={eventTime:gr,lane:ei,tag:Ve.tag,payload:Ve.payload,callback:Ve.callback,next:null},Ut===null?(yt=Ut=gr,ot=_i):Ut=Ut.next=gr,Se|=ei;if(Ve=Ve.next,Ve===null){if(Ve=F.shared.pending,Ve===null)break;ei=Ve,Ve=ei.next,ei.next=null,F.lastBaseUpdate=ei,F.shared.pending=null}}while(!0);if(Ut===null&&(ot=_i),F.baseState=ot,F.firstBaseUpdate=yt,F.lastBaseUpdate=Ut,b=F.shared.interleaved,b!==null){F=b;do Se|=F.lane,F=F.next;while(F!==b)}else Z===null&&(F.shared.lanes=0);fg|=Se,w.lanes=Se,w.memoizedState=_i}}function Pk(w,b,P){if(w=b.effects,b.effects=null,w!==null)for(b=0;b<w.length;b++){var I=w[b],F=I.callback;if(F!==null){if(I.callback=null,I=P,typeof F!="function")throw Error(a(191,F));F.call(I)}}}var Dk=new r.Component().refs;function BP(w,b,P,I){b=w.memoizedState,P=P(I,b),P=P==null?b:s({},b,P),w.memoizedState=P,w.lanes===0&&(w.updateQueue.baseState=P)}var c_={isMounted:function(w){return(w=w._reactInternals)?C(w)===w:!1},enqueueSetState:function(w,b,P){w=w._reactInternals;var I=va(),F=Yh(w),Z=yu(I,F);Z.payload=b,P!=null&&(Z.callback=P),Wh(w,Z),b=Xo(w,F,I),b!==null&&o_(b,w,F)},enqueueReplaceState:function(w,b,P){w=w._reactInternals;var I=va(),F=Yh(w),Z=yu(I,F);Z.tag=1,Z.payload=b,P!=null&&(Z.callback=P),Wh(w,Z),b=Xo(w,F,I),b!==null&&o_(b,w,F)},enqueueForceUpdate:function(w,b){w=w._reactInternals;var P=va(),I=Yh(w),F=yu(P,I);F.tag=2,b!=null&&(F.callback=b),Wh(w,F),b=Xo(w,I,P),b!==null&&o_(b,w,I)}};function Rk(w,b,P,I,F,Z,Se){return w=w.stateNode,typeof w.shouldComponentUpdate=="function"?w.shouldComponentUpdate(I,Z,Se):b.prototype&&b.prototype.isPureReactComponent?!Uf(P,I)||!Uf(F,Z):!0}function Ik(w,b,P){var I=!1,F=ye,Z=b.contextType;return typeof Z=="object"&&Z!==null?Z=sn(Z):(F=Di(b)?rt:ae.current,I=b.contextTypes,Z=(I=I!=null)?Ct(w,F):ye),b=new b(P,Z),w.memoizedState=b.state!==null&&b.state!==void 0?b.state:null,b.updater=c_,w.stateNode=b,b._reactInternals=w,I&&(w=w.stateNode,w.__reactInternalMemoizedUnmaskedChildContext=F,w.__reactInternalMemoizedMaskedChildContext=Z),b}function Lk(w,b,P,I){w=b.state,typeof b.componentWillReceiveProps=="function"&&b.componentWillReceiveProps(P,I),typeof b.UNSAFE_componentWillReceiveProps=="function"&&b.UNSAFE_componentWillReceiveProps(P,I),b.state!==w&&c_.enqueueReplaceState(b,b.state,null)}function FP(w,b,P,I){var F=w.stateNode;F.props=P,F.state=w.memoizedState,F.refs=Dk,zP(w);var Z=b.contextType;typeof Z=="object"&&Z!==null?F.context=sn(Z):(Z=Di(b)?rt:ae.current,F.context=Ct(w,Z)),F.state=w.memoizedState,Z=b.getDerivedStateFromProps,typeof Z=="function"&&(BP(w,b,Z,P),F.state=w.memoizedState),typeof b.getDerivedStateFromProps=="function"||typeof F.getSnapshotBeforeUpdate=="function"||typeof F.UNSAFE_componentWillMount!="function"&&typeof F.componentWillMount!="function"||(b=F.state,typeof F.componentWillMount=="function"&&F.componentWillMount(),typeof F.UNSAFE_componentWillMount=="function"&&F.UNSAFE_componentWillMount(),b!==F.state&&c_.enqueueReplaceState(F,F.state,null),l_(w,P,F,I),F.state=w.memoizedState),typeof F.componentDidMount=="function"&&(w.flags|=4194308)}var sg=[],ag=0,u_=null,h_=0,Go=[],Ho=0,kf=null,xu=1,wu="";function Vf(w,b){sg[ag++]=h_,sg[ag++]=u_,u_=w,h_=b}function Ok(w,b,P){Go[Ho++]=xu,Go[Ho++]=wu,Go[Ho++]=kf,kf=w;var I=xu;w=wu;var F=32-Li(I)-1;I&=~(1<<F),P+=1;var Z=32-Li(b)+F;if(30<Z){var Se=F-F%5;Z=(I&(1<<Se)-1).toString(32),I>>=Se,F-=Se,xu=1<<32-Li(b)+F|P<<F|I,wu=Z+w}else xu=1<<Z|P<<F|I,wu=w}function UP(w){w.return!==null&&(Vf(w,1),Ok(w,1,0))}function NP(w){for(;w===u_;)u_=sg[--ag],sg[ag]=null,h_=sg[--ag],sg[ag]=null;for(;w===kf;)kf=Go[--Ho],Go[Ho]=null,wu=Go[--Ho],Go[Ho]=null,xu=Go[--Ho],Go[Ho]=null}var yo=null,xo=null,Rr=!1,Ly=!1,Ml=null;function zk(w,b){var P=qo(5,null,null,0);P.elementType="DELETED",P.stateNode=b,P.return=w,b=w.deletions,b===null?(w.deletions=[P],w.flags|=16):b.push(P)}function Bk(w,b){switch(w.tag){case 5:return b=hi(b,w.type,w.pendingProps),b!==null?(w.stateNode=b,yo=w,xo=et(b),!0):!1;case 6:return b=$i(b,w.pendingProps),b!==null?(w.stateNode=b,yo=w,xo=null,!0):!1;case 13:if(b=xn(b),b!==null){var P=kf!==null?{id:xu,overflow:wu}:null;return w.memoizedState={dehydrated:b,treeContext:P,retryLane:1073741824},P=qo(18,null,null,0),P.stateNode=b,P.return=w,w.child=P,yo=w,xo=null,!0}return!1;default:return!1}}function kP(w){return(w.mode&1)!==0&&(w.flags&128)===0}function VP(w){if(Rr){var b=xo;if(b){var P=b;if(!Bk(w,b)){if(kP(w))throw Error(a(418));b=Xe(P);var I=yo;b&&Bk(w,b)?zk(I,P):(w.flags=w.flags&-4097|2,Rr=!1,yo=w)}}else{if(kP(w))throw Error(a(418));w.flags=w.flags&-4097|2,Rr=!1,yo=w}}}function Fk(w){for(w=w.return;w!==null&&w.tag!==5&&w.tag!==3&&w.tag!==13;)w=w.return;yo=w}function Oy(w){if(!ve||w!==yo)return!1;if(!Rr)return Fk(w),Rr=!0,!1;if(w.tag!==3&&(w.tag!==5||se(w.type)&&!ee(w.type,w.memoizedProps))){var b=xo;if(b){if(kP(w)){for(w=xo;w;)w=Xe(w);throw Error(a(418))}for(;b;)zk(w,b),b=Xe(b)}}if(Fk(w),w.tag===13){if(!ve)throw Error(a(316));if(w=w.memoizedState,w=w!==null?w.dehydrated:null,!w)throw Error(a(317));xo=Vt(w)}else xo=yo?Xe(w.stateNode):null;return!0}function og(){ve&&(xo=yo=null,Ly=Rr=!1)}function GP(w){Ml===null?Ml=[w]:Ml.push(w)}function zy(w,b,P){if(w=P.ref,w!==null&&typeof w!="function"&&typeof w!="object"){if(P._owner){if(P=P._owner,P){if(P.tag!==1)throw Error(a(309));var I=P.stateNode}if(!I)throw Error(a(147,w));var F=I,Z=""+w;return b!==null&&b.ref!==null&&typeof b.ref=="function"&&b.ref._stringRef===Z?b.ref:(b=function(Se){var Ve=F.refs;Ve===Dk&&(Ve=F.refs={}),Se===null?delete Ve[Z]:Ve[Z]=Se},b._stringRef=Z,b)}if(typeof w!="string")throw Error(a(284));if(!P._owner)throw Error(a(290,w))}return w}function d_(w,b){throw w=Object.prototype.toString.call(b),Error(a(31,w==="[object Object]"?"object with keys {"+Object.keys(b).join(", ")+"}":w))}function Uk(w){var b=w._init;return b(w._payload)}function Nk(w){function b($e,je){if(w){var st=$e.deletions;st===null?($e.deletions=[je],$e.flags|=16):st.push(je)}}function P($e,je){if(!w)return null;for(;je!==null;)b($e,je),je=je.sibling;return null}function I($e,je){for($e=new Map;je!==null;)je.key!==null?$e.set(je.key,je):$e.set(je.index,je),je=je.sibling;return $e}function F($e,je){return $e=Zh($e,je),$e.index=0,$e.sibling=null,$e}function Z($e,je,st){return $e.index=st,w?(st=$e.alternate,st!==null?(st=st.index,st<je?($e.flags|=2,je):st):($e.flags|=2,je)):($e.flags|=1048576,je)}function Se($e){return w&&$e.alternate===null&&($e.flags|=2),$e}function Ve($e,je,st,Lt){return je===null||je.tag!==6?(je=E3(st,$e.mode,Lt),je.return=$e,je):(je=F(je,st),je.return=$e,je)}function ot($e,je,st,Lt){var Ht=st.type;return Ht===u?Ut($e,je,st.props.children,Lt,st.key):je!==null&&(je.elementType===Ht||typeof Ht=="object"&&Ht!==null&&Ht.$$typeof===x&&Uk(Ht)===je.type)?(Lt=F(je,st.props),Lt.ref=zy($e,je,st),Lt.return=$e,Lt):(Lt=H_(st.type,st.key,st.props,null,$e.mode,Lt),Lt.ref=zy($e,je,st),Lt.return=$e,Lt)}function yt($e,je,st,Lt){return je===null||je.tag!==4||je.stateNode.containerInfo!==st.containerInfo||je.stateNode.implementation!==st.implementation?(je=A3(st,$e.mode,Lt),je.return=$e,je):(je=F(je,st.children||[]),je.return=$e,je)}function Ut($e,je,st,Lt,Ht){return je===null||je.tag!==7?(je=Yf(st,$e.mode,Lt,Ht),je.return=$e,je):(je=F(je,st),je.return=$e,je)}function _i($e,je,st){if(typeof je=="string"&&je!==""||typeof je=="number")return je=E3(""+je,$e.mode,st),je.return=$e,je;if(typeof je=="object"&&je!==null){switch(je.$$typeof){case l:return st=H_(je.type,je.key,je.props,null,$e.mode,st),st.ref=zy($e,null,je),st.return=$e,st;case c:return je=A3(je,$e.mode,st),je.return=$e,je;case x:var Lt=je._init;return _i($e,Lt(je._payload),st)}if(H(je)||S(je))return je=Yf(je,$e.mode,st,null),je.return=$e,je;d_($e,je)}return null}function ei($e,je,st,Lt){var Ht=je!==null?je.key:null;if(typeof st=="string"&&st!==""||typeof st=="number")return Ht!==null?null:Ve($e,je,""+st,Lt);if(typeof st=="object"&&st!==null){switch(st.$$typeof){case l:return st.key===Ht?ot($e,je,st,Lt):null;case c:return st.key===Ht?yt($e,je,st,Lt):null;case x:return Ht=st._init,ei($e,je,Ht(st._payload),Lt)}if(H(st)||S(st))return Ht!==null?null:Ut($e,je,st,Lt,null);d_($e,st)}return null}function gr($e,je,st,Lt,Ht){if(typeof Lt=="string"&&Lt!==""||typeof Lt=="number")return $e=$e.get(st)||null,Ve(je,$e,""+Lt,Ht);if(typeof Lt=="object"&&Lt!==null){switch(Lt.$$typeof){case l:return $e=$e.get(Lt.key===null?st:Lt.key)||null,ot(je,$e,Lt,Ht);case c:return $e=$e.get(Lt.key===null?st:Lt.key)||null,yt(je,$e,Lt,Ht);case x:var Ri=Lt._init;return gr($e,je,st,Ri(Lt._payload),Ht)}if(H(Lt)||S(Lt))return $e=$e.get(st)||null,Ut(je,$e,Lt,Ht,null);d_(je,Lt)}return null}function Wt($e,je,st,Lt){for(var Ht=null,Ri=null,Si=je,Zi=je=0,ns=null;Si!==null&&Zi<st.length;Zi++){Si.index>Zi?(ns=Si,Si=null):ns=Si.sibling;var Ki=ei($e,Si,st[Zi],Lt);if(Ki===null){Si===null&&(Si=ns);break}w&&Si&&Ki.alternate===null&&b($e,Si),je=Z(Ki,je,Zi),Ri===null?Ht=Ki:Ri.sibling=Ki,Ri=Ki,Si=ns}if(Zi===st.length)return P($e,Si),Rr&&Vf($e,Zi),Ht;if(Si===null){for(;Zi<st.length;Zi++)Si=_i($e,st[Zi],Lt),Si!==null&&(je=Z(Si,je,Zi),Ri===null?Ht=Si:Ri.sibling=Si,Ri=Si);return Rr&&Vf($e,Zi),Ht}for(Si=I($e,Si);Zi<st.length;Zi++)ns=gr(Si,$e,Zi,st[Zi],Lt),ns!==null&&(w&&ns.alternate!==null&&Si.delete(ns.key===null?Zi:ns.key),je=Z(ns,je,Zi),Ri===null?Ht=ns:Ri.sibling=ns,Ri=ns);return w&&Si.forEach(function(Kh){return b($e,Kh)}),Rr&&Vf($e,Zi),Ht}function Ws($e,je,st,Lt){var Ht=S(st);if(typeof Ht!="function")throw Error(a(150));if(st=Ht.call(st),st==null)throw Error(a(151));for(var Ri=Ht=null,Si=je,Zi=je=0,ns=null,Ki=st.next();Si!==null&&!Ki.done;Zi++,Ki=st.next()){Si.index>Zi?(ns=Si,Si=null):ns=Si.sibling;var Kh=ei($e,Si,Ki.value,Lt);if(Kh===null){Si===null&&(Si=ns);break}w&&Si&&Kh.alternate===null&&b($e,Si),je=Z(Kh,je,Zi),Ri===null?Ht=Kh:Ri.sibling=Kh,Ri=Kh,Si=ns}if(Ki.done)return P($e,Si),Rr&&Vf($e,Zi),Ht;if(Si===null){for(;!Ki.done;Zi++,Ki=st.next())Ki=_i($e,Ki.value,Lt),Ki!==null&&(je=Z(Ki,je,Zi),Ri===null?Ht=Ki:Ri.sibling=Ki,Ri=Ki);return Rr&&Vf($e,Zi),Ht}for(Si=I($e,Si);!Ki.done;Zi++,Ki=st.next())Ki=gr(Si,$e,Zi,Ki.value,Lt),Ki!==null&&(w&&Ki.alternate!==null&&Si.delete(Ki.key===null?Zi:Ki.key),je=Z(Ki,je,Zi),Ri===null?Ht=Ki:Ri.sibling=Ki,Ri=Ki);return w&&Si.forEach(function(Jae){return b($e,Jae)}),Rr&&Vf($e,Zi),Ht}function Yo($e,je,st,Lt){if(typeof st=="object"&&st!==null&&st.type===u&&st.key===null&&(st=st.props.children),typeof st=="object"&&st!==null){switch(st.$$typeof){case l:e:{for(var Ht=st.key,Ri=je;Ri!==null;){if(Ri.key===Ht){if(Ht=st.type,Ht===u){if(Ri.tag===7){P($e,Ri.sibling),je=F(Ri,st.props.children),je.return=$e,$e=je;break e}}else if(Ri.elementType===Ht||typeof Ht=="object"&&Ht!==null&&Ht.$$typeof===x&&Uk(Ht)===Ri.type){P($e,Ri.sibling),je=F(Ri,st.props),je.ref=zy($e,Ri,st),je.return=$e,$e=je;break e}P($e,Ri);break}else b($e,Ri);Ri=Ri.sibling}st.type===u?(je=Yf(st.props.children,$e.mode,Lt,st.key),je.return=$e,$e=je):(Lt=H_(st.type,st.key,st.props,null,$e.mode,Lt),Lt.ref=zy($e,je,st),Lt.return=$e,$e=Lt)}return Se($e);case c:e:{for(Ri=st.key;je!==null;){if(je.key===Ri)if(je.tag===4&&je.stateNode.containerInfo===st.containerInfo&&je.stateNode.implementation===st.implementation){P($e,je.sibling),je=F(je,st.children||[]),je.return=$e,$e=je;break e}else{P($e,je);break}else b($e,je);je=je.sibling}je=A3(st,$e.mode,Lt),je.return=$e,$e=je}return Se($e);case x:return Ri=st._init,Yo($e,je,Ri(st._payload),Lt)}if(H(st))return Wt($e,je,st,Lt);if(S(st))return Ws($e,je,st,Lt);d_($e,st)}return typeof st=="string"&&st!==""||typeof st=="number"?(st=""+st,je!==null&&je.tag===6?(P($e,je.sibling),je=F(je,st),je.return=$e,$e=je):(P($e,je),je=E3(st,$e.mode,Lt),je.return=$e,$e=je),Se($e)):P($e,je)}return Yo}var lg=Nk(!0),kk=Nk(!1),By={},jo=zt(By),Fy=zt(By),cg=zt(By);function vc(w){if(w===By)throw Error(a(174));return w}function HP(w,b){te(cg,b),te(Fy,w),te(jo,By),w=Y(b),Q(jo),te(jo,w)}function ug(){Q(jo),Q(Fy),Q(cg)}function Vk(w){var b=vc(cg.current),P=vc(jo.current);b=z(P,w.type,b),P!==b&&(te(Fy,w),te(jo,b))}function jP(w){Fy.current===w&&(Q(jo),Q(Fy))}var Fr=zt(0);function f_(w){for(var b=w;b!==null;){if(b.tag===13){var P=b.memoizedState;if(P!==null&&(P=P.dehydrated,P===null||Or(P)||zr(P)))return b}else if(b.tag===19&&b.memoizedProps.revealOrder!==void 0){if(b.flags&128)return b}else if(b.child!==null){b.child.return=b,b=b.child;continue}if(b===w)break;for(;b.sibling===null;){if(b.return===null||b.return===w)return null;b=b.return}b.sibling.return=b.return,b=b.sibling}return null}var WP=[];function XP(){for(var w=0;w<WP.length;w++){var b=WP[w];ge?b._workInProgressVersionPrimary=null:b._workInProgressVersionSecondary=null}WP.length=0}var p_=o.ReactCurrentDispatcher,Wo=o.ReactCurrentBatchConfig,hg=0,Yr=null,Gs=null,rs=null,m_=!1,Uy=!1,Ny=0,Sae=0;function Hs(){throw Error(a(321))}function qP(w,b){if(b===null)return!1;for(var P=0;P<b.length&&P<w.length;P++)if(!go(w[P],b[P]))return!1;return!0}function YP(w,b,P,I,F,Z){if(hg=Z,Yr=b,b.memoizedState=null,b.updateQueue=null,b.lanes=0,p_.current=w===null||w.memoizedState===null?Tae:Cae,w=P(I,F),Uy){Z=0;do{if(Uy=!1,Ny=0,25<=Z)throw Error(a(301));Z+=1,rs=Gs=null,b.updateQueue=null,p_.current=Pae,w=P(I,F)}while(Uy)}if(p_.current=w_,b=Gs!==null&&Gs.next!==null,hg=0,rs=Gs=Yr=null,m_=!1,b)throw Error(a(300));return w}function QP(){var w=Ny!==0;return Ny=0,w}function bu(){var w={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return rs===null?Yr.memoizedState=rs=w:rs=rs.next=w,rs}function yc(){if(Gs===null){var w=Yr.alternate;w=w!==null?w.memoizedState:null}else w=Gs.next;var b=rs===null?Yr.memoizedState:rs.next;if(b!==null)rs=b,Gs=w;else{if(w===null)throw Error(a(310));Gs=w,w={memoizedState:Gs.memoizedState,baseState:Gs.baseState,baseQueue:Gs.baseQueue,queue:Gs.queue,next:null},rs===null?Yr.memoizedState=rs=w:rs=rs.next=w}return rs}function Gf(w,b){return typeof b=="function"?b(w):b}function g_(w){var b=yc(),P=b.queue;if(P===null)throw Error(a(311));P.lastRenderedReducer=w;var I=Gs,F=I.baseQueue,Z=P.pending;if(Z!==null){if(F!==null){var Se=F.next;F.next=Z.next,Z.next=Se}I.baseQueue=F=Z,P.pending=null}if(F!==null){Z=F.next,I=I.baseState;var Ve=Se=null,ot=null,yt=Z;do{var Ut=yt.lane;if((hg&Ut)===Ut)ot!==null&&(ot=ot.next={lane:0,action:yt.action,hasEagerState:yt.hasEagerState,eagerState:yt.eagerState,next:null}),I=yt.hasEagerState?yt.eagerState:w(I,yt.action);else{var _i={lane:Ut,action:yt.action,hasEagerState:yt.hasEagerState,eagerState:yt.eagerState,next:null};ot===null?(Ve=ot=_i,Se=I):ot=ot.next=_i,Yr.lanes|=Ut,fg|=Ut}yt=yt.next}while(yt!==null&&yt!==Z);ot===null?Se=I:ot.next=Ve,go(I,b.memoizedState)||(wo=!0),b.memoizedState=I,b.baseState=Se,b.baseQueue=ot,P.lastRenderedState=I}if(w=P.interleaved,w!==null){F=w;do Z=F.lane,Yr.lanes|=Z,fg|=Z,F=F.next;while(F!==w)}else F===null&&(P.lanes=0);return[b.memoizedState,P.dispatch]}function v_(w){var b=yc(),P=b.queue;if(P===null)throw Error(a(311));P.lastRenderedReducer=w;var I=P.dispatch,F=P.pending,Z=b.memoizedState;if(F!==null){P.pending=null;var Se=F=F.next;do Z=w(Z,Se.action),Se=Se.next;while(Se!==F);go(Z,b.memoizedState)||(wo=!0),b.memoizedState=Z,b.baseQueue===null&&(b.baseState=Z),P.lastRenderedState=Z}return[Z,I]}function Gk(){}function Hk(w,b){var P=Yr,I=yc(),F=b(),Z=!go(I.memoizedState,F);if(Z&&(I.memoizedState=F,wo=!0),I=I.queue,Vy(Xk.bind(null,P,I,w),[w]),I.getSnapshot!==b||Z||rs!==null&&rs.memoizedState.tag&1){if(P.flags|=2048,ky(9,Wk.bind(null,P,I,F,b),void 0,null),_n===null)throw Error(a(349));hg&30||jk(P,b,F)}return F}function jk(w,b,P){w.flags|=16384,w={getSnapshot:b,value:P},b=Yr.updateQueue,b===null?(b={lastEffect:null,stores:null},Yr.updateQueue=b,b.stores=[w]):(P=b.stores,P===null?b.stores=[w]:P.push(w))}function Wk(w,b,P,I){b.value=P,b.getSnapshot=I,qk(b)&&Xo(w,1,-1)}function Xk(w,b,P){return P(function(){qk(b)&&Xo(w,1,-1)})}function qk(w){var b=w.getSnapshot;w=w.value;try{var P=b();return!go(w,P)}catch{return!0}}function ZP(w){var b=bu();return typeof w=="function"&&(w=w()),b.memoizedState=b.baseState=w,w={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Gf,lastRenderedState:w},b.queue=w,w=w.dispatch=Aae.bind(null,Yr,w),[b.memoizedState,w]}function ky(w,b,P,I){return w={tag:w,create:b,destroy:P,deps:I,next:null},b=Yr.updateQueue,b===null?(b={lastEffect:null,stores:null},Yr.updateQueue=b,b.lastEffect=w.next=w):(P=b.lastEffect,P===null?b.lastEffect=w.next=w:(I=P.next,P.next=w,w.next=I,b.lastEffect=w)),w}function Yk(){return yc().memoizedState}function y_(w,b,P,I){var F=bu();Yr.flags|=w,F.memoizedState=ky(1|b,P,void 0,I===void 0?null:I)}function x_(w,b,P,I){var F=yc();I=I===void 0?null:I;var Z=void 0;if(Gs!==null){var Se=Gs.memoizedState;if(Z=Se.destroy,I!==null&&qP(I,Se.deps)){F.memoizedState=ky(b,P,Z,I);return}}Yr.flags|=w,F.memoizedState=ky(1|b,P,Z,I)}function KP(w,b){return y_(8390656,8,w,b)}function Vy(w,b){return x_(2048,8,w,b)}function Qk(w,b){return x_(4,2,w,b)}function Zk(w,b){return x_(4,4,w,b)}function Kk(w,b){if(typeof b=="function")return w=w(),b(w),function(){b(null)};if(b!=null)return w=w(),b.current=w,function(){b.current=null}}function Jk(w,b,P){return P=P!=null?P.concat([w]):null,x_(4,4,Kk.bind(null,b,w),P)}function JP(){}function $k(w,b){var P=yc();b=b===void 0?null:b;var I=P.memoizedState;return I!==null&&b!==null&&qP(b,I[1])?I[0]:(P.memoizedState=[w,b],w)}function e5(w,b){var P=yc();b=b===void 0?null:b;var I=P.memoizedState;return I!==null&&b!==null&&qP(b,I[1])?I[0]:(w=w(),P.memoizedState=[w,b],w)}function Mae(w,b){var P=Oi;Oi=P!==0&&4>P?P:4,w(!0);var I=Wo.transition;Wo.transition={};try{w(!1),b()}finally{Oi=P,Wo.transition=I}}function t5(){return yc().memoizedState}function Eae(w,b,P){var I=Yh(w);P={lane:I,action:P,hasEagerState:!1,eagerState:null,next:null},i5(w)?r5(b,P):(n5(w,b,P),P=va(),w=Xo(w,I,P),w!==null&&s5(w,b,I))}function Aae(w,b,P){var I=Yh(w),F={lane:I,action:P,hasEagerState:!1,eagerState:null,next:null};if(i5(w))r5(b,F);else{n5(w,b,F);var Z=w.alternate;if(w.lanes===0&&(Z===null||Z.lanes===0)&&(Z=b.lastRenderedReducer,Z!==null))try{var Se=b.lastRenderedState,Ve=Z(Se,P);if(F.hasEagerState=!0,F.eagerState=Ve,go(Ve,Se))return}catch{}finally{}P=va(),w=Xo(w,I,P),w!==null&&s5(w,b,I)}}function i5(w){var b=w.alternate;return w===Yr||b!==null&&b===Yr}function r5(w,b){Uy=m_=!0;var P=w.pending;P===null?b.next=b:(b.next=P.next,P.next=b),w.pending=b}function n5(w,b,P){_n!==null&&w.mode&1&&!(Ii&2)?(w=b.interleaved,w===null?(P.next=P,vo===null?vo=[b]:vo.push(b)):(P.next=w.next,w.next=P),b.interleaved=P):(w=b.pending,w===null?P.next=P:(P.next=w.next,w.next=P),b.pending=P)}function s5(w,b,P){if(P&4194240){var I=b.lanes;I&=w.pendingLanes,P|=I,b.lanes=P,mc(w,P)}}var w_={readContext:sn,useCallback:Hs,useContext:Hs,useEffect:Hs,useImperativeHandle:Hs,useInsertionEffect:Hs,useLayoutEffect:Hs,useMemo:Hs,useReducer:Hs,useRef:Hs,useState:Hs,useDebugValue:Hs,useDeferredValue:Hs,useTransition:Hs,useMutableSource:Hs,useSyncExternalStore:Hs,useId:Hs,unstable_isNewReconciler:!1},Tae={readContext:sn,useCallback:function(w,b){return bu().memoizedState=[w,b===void 0?null:b],w},useContext:sn,useEffect:KP,useImperativeHandle:function(w,b,P){return P=P!=null?P.concat([w]):null,y_(4194308,4,Kk.bind(null,b,w),P)},useLayoutEffect:function(w,b){return y_(4194308,4,w,b)},useInsertionEffect:function(w,b){return y_(4,2,w,b)},useMemo:function(w,b){var P=bu();return b=b===void 0?null:b,w=w(),P.memoizedState=[w,b],w},useReducer:function(w,b,P){var I=bu();return b=P!==void 0?P(b):b,I.memoizedState=I.baseState=b,w={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:w,lastRenderedState:b},I.queue=w,w=w.dispatch=Eae.bind(null,Yr,w),[I.memoizedState,w]},useRef:function(w){var b=bu();return w={current:w},b.memoizedState=w},useState:ZP,useDebugValue:JP,useDeferredValue:function(w){var b=ZP(w),P=b[0],I=b[1];return KP(function(){var F=Wo.transition;Wo.transition={};try{I(w)}finally{Wo.transition=F}},[w]),P},useTransition:function(){var w=ZP(!1),b=w[0];return w=Mae.bind(null,w[1]),bu().memoizedState=w,[b,w]},useMutableSource:function(){},useSyncExternalStore:function(w,b,P){var I=Yr,F=bu();if(Rr){if(P===void 0)throw Error(a(407));P=P()}else{if(P=b(),_n===null)throw Error(a(349));hg&30||jk(I,b,P)}F.memoizedState=P;var Z={value:P,getSnapshot:b};return F.queue=Z,KP(Xk.bind(null,I,Z,w),[w]),I.flags|=2048,ky(9,Wk.bind(null,I,Z,P,b),void 0,null),P},useId:function(){var w=bu(),b=_n.identifierPrefix;if(Rr){var P=wu,I=xu;P=(I&~(1<<32-Li(I)-1)).toString(32)+P,b=":"+b+"R"+P,P=Ny++,0<P&&(b+="H"+P.toString(32)),b+=":"}else P=Sae++,b=":"+b+"r"+P.toString(32)+":";return w.memoizedState=b},unstable_isNewReconciler:!1},Cae={readContext:sn,useCallback:$k,useContext:sn,useEffect:Vy,useImperativeHandle:Jk,useInsertionEffect:Qk,useLayoutEffect:Zk,useMemo:e5,useReducer:g_,useRef:Yk,useState:function(){return g_(Gf)},useDebugValue:JP,useDeferredValue:function(w){var b=g_(Gf),P=b[0],I=b[1];return Vy(function(){var F=Wo.transition;Wo.transition={};try{I(w)}finally{Wo.transition=F}},[w]),P},useTransition:function(){var w=g_(Gf)[0],b=yc().memoizedState;return[w,b]},useMutableSource:Gk,useSyncExternalStore:Hk,useId:t5,unstable_isNewReconciler:!1},Pae={readContext:sn,useCallback:$k,useContext:sn,useEffect:Vy,useImperativeHandle:Jk,useInsertionEffect:Qk,useLayoutEffect:Zk,useMemo:e5,useReducer:v_,useRef:Yk,useState:function(){return v_(Gf)},useDebugValue:JP,useDeferredValue:function(w){var b=v_(Gf),P=b[0],I=b[1];return Vy(function(){var F=Wo.transition;Wo.transition={};try{I(w)}finally{Wo.transition=F}},[w]),P},useTransition:function(){var w=v_(Gf)[0],b=yc().memoizedState;return[w,b]},useMutableSource:Gk,useSyncExternalStore:Hk,useId:t5,unstable_isNewReconciler:!1};function $P(w,b){try{var P="",I=b;do P+=Nf(I),I=I.return;while(I);var F=P}catch(Z){F=`
Error generating stack: `+Z.message+`
`+Z.stack}return{value:w,source:b,stack:F}}function e3(w,b){try{console.error(b.value)}catch(P){setTimeout(function(){throw P})}}var Dae=typeof WeakMap=="function"?WeakMap:Map;function a5(w,b,P){P=yu(-1,P),P.tag=3,P.payload={element:null};var I=b.value;return P.callback=function(){B_||(B_=!0,y3=I),e3(w,b)},P}function o5(w,b,P){P=yu(-1,P),P.tag=3;var I=w.type.getDerivedStateFromError;if(typeof I=="function"){var F=b.value;P.payload=function(){return I(F)},P.callback=function(){e3(w,b)}}var Z=w.stateNode;return Z!==null&&typeof Z.componentDidCatch=="function"&&(P.callback=function(){e3(w,b),typeof I!="function"&&(Xh===null?Xh=new Set([this]):Xh.add(this));var Se=b.stack;this.componentDidCatch(b.value,{componentStack:Se!==null?Se:""})}),P}function l5(w,b,P){var I=w.pingCache;if(I===null){I=w.pingCache=new Dae;var F=new Set;I.set(b,F)}else F=I.get(b),F===void 0&&(F=new Set,I.set(b,F));F.has(P)||(F.add(P),w=jae.bind(null,w,b,P),b.then(w,w))}function c5(w){do{var b;if((b=w.tag===13)&&(b=w.memoizedState,b=b!==null?b.dehydrated!==null:!0),b)return w;w=w.return}while(w!==null);return null}function u5(w,b,P,I,F){return w.mode&1?(w.flags|=65536,w.lanes=F,w):(w===b?w.flags|=65536:(w.flags|=128,P.flags|=131072,P.flags&=-52805,P.tag===1&&(P.alternate===null?P.tag=17:(b=yu(-1,1),b.tag=2,Wh(P,b))),P.lanes|=1),w)}function xc(w){w.flags|=4}function h5(w,b){if(w!==null&&w.child===b.child)return!0;if(b.flags&16)return!1;for(w=b.child;w!==null;){if(w.flags&12854||w.subtreeFlags&12854)return!1;w=w.sibling}return!0}var Gy,Hy,b_,__;if(we)Gy=function(w,b){for(var P=b.child;P!==null;){if(P.tag===5||P.tag===6)X(w,P.stateNode);else if(P.tag!==4&&P.child!==null){P.child.return=P,P=P.child;continue}if(P===b)break;for(;P.sibling===null;){if(P.return===null||P.return===b)return;P=P.return}P.sibling.return=P.return,P=P.sibling}},Hy=function(){},b_=function(w,b,P,I,F){if(w=w.memoizedProps,w!==I){var Z=b.stateNode,Se=vc(jo.current);P=q(Z,P,w,I,F,Se),(b.updateQueue=P)&&xc(b)}},__=function(w,b,P,I){P!==I&&xc(b)};else if(le){Gy=function(w,b,P,I){for(var F=b.child;F!==null;){if(F.tag===5){var Z=F.stateNode;P&&I&&(Z=vt(Z,F.type,F.memoizedProps,F)),X(w,Z)}else if(F.tag===6)Z=F.stateNode,P&&I&&(Z=ui(Z,F.memoizedProps,F)),X(w,Z);else if(F.tag!==4){if(F.tag===22&&F.memoizedState!==null)Z=F.child,Z!==null&&(Z.return=F),Gy(w,F,!0,!0);else if(F.child!==null){F.child.return=F,F=F.child;continue}}if(F===b)break;for(;F.sibling===null;){if(F.return===null||F.return===b)return;F=F.return}F.sibling.return=F.return,F=F.sibling}};var d5=function(w,b,P,I){for(var F=b.child;F!==null;){if(F.tag===5){var Z=F.stateNode;P&&I&&(Z=vt(Z,F.type,F.memoizedProps,F)),mt(w,Z)}else if(F.tag===6)Z=F.stateNode,P&&I&&(Z=ui(Z,F.memoizedProps,F)),mt(w,Z);else if(F.tag!==4){if(F.tag===22&&F.memoizedState!==null)Z=F.child,Z!==null&&(Z.return=F),d5(w,F,!0,!0);else if(F.child!==null){F.child.return=F,F=F.child;continue}}if(F===b)break;for(;F.sibling===null;){if(F.return===null||F.return===b)return;F=F.return}F.sibling.return=F.return,F=F.sibling}};Hy=function(w,b){var P=b.stateNode;if(!h5(w,b)){w=P.containerInfo;var I=Je(w);d5(I,b,!1,!1),P.pendingChildren=I,xc(b),St(w,I)}},b_=function(w,b,P,I,F){var Z=w.stateNode,Se=w.memoizedProps;if((w=h5(w,b))&&Se===I)b.stateNode=Z;else{var Ve=b.stateNode,ot=vc(jo.current),yt=null;Se!==I&&(yt=q(Ve,P,Se,I,F,ot)),w&&yt===null?b.stateNode=Z:(Z=Ze(Z,yt,P,Se,I,b,w,Ve),re(Z,P,I,F,ot)&&xc(b),b.stateNode=Z,w?xc(b):Gy(Z,b,!1,!1))}},__=function(w,b,P,I){P!==I?(w=vc(cg.current),P=vc(jo.current),b.stateNode=$(I,w,P,b),xc(b)):b.stateNode=w.stateNode}}else Hy=function(){},b_=function(){},__=function(){};function jy(w,b){if(!Rr)switch(w.tailMode){case"hidden":b=w.tail;for(var P=null;b!==null;)b.alternate!==null&&(P=b),b=b.sibling;P===null?w.tail=null:P.sibling=null;break;case"collapsed":P=w.tail;for(var I=null;P!==null;)P.alternate!==null&&(I=P),P=P.sibling;I===null?b||w.tail===null?w.tail=null:w.tail.sibling=null:I.sibling=null}}function js(w){var b=w.alternate!==null&&w.alternate.child===w.child,P=0,I=0;if(b)for(var F=w.child;F!==null;)P|=F.lanes|F.childLanes,I|=F.subtreeFlags&14680064,I|=F.flags&14680064,F.return=w,F=F.sibling;else for(F=w.child;F!==null;)P|=F.lanes|F.childLanes,I|=F.subtreeFlags,I|=F.flags,F.return=w,F=F.sibling;return w.subtreeFlags|=I,w.childLanes=P,b}function Rae(w,b,P){var I=b.pendingProps;switch(NP(b),b.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return js(b),null;case 1:return Di(b.type)&&pi(),js(b),null;case 3:return I=b.stateNode,ug(),Q(Ee),Q(ae),XP(),I.pendingContext&&(I.context=I.pendingContext,I.pendingContext=null),(w===null||w.child===null)&&(Oy(b)?xc(b):w===null||w.memoizedState.isDehydrated&&!(b.flags&256)||(b.flags|=1024,Ml!==null&&(b3(Ml),Ml=null))),Hy(w,b),js(b),null;case 5:jP(b),P=vc(cg.current);var F=b.type;if(w!==null&&b.stateNode!=null)b_(w,b,F,I,P),w.ref!==b.ref&&(b.flags|=512,b.flags|=2097152);else{if(!I){if(b.stateNode===null)throw Error(a(166));return js(b),null}if(w=vc(jo.current),Oy(b)){if(!ve)throw Error(a(175));w=It(b.stateNode,b.type,b.memoizedProps,P,w,b,!Ly),b.updateQueue=w,w!==null&&xc(b)}else{var Z=k(F,I,P,w,b);Gy(Z,b,!1,!1),b.stateNode=Z,re(Z,F,I,P,w)&&xc(b)}b.ref!==null&&(b.flags|=512,b.flags|=2097152)}return js(b),null;case 6:if(w&&b.stateNode!=null)__(w,b,w.memoizedProps,I);else{if(typeof I!="string"&&b.stateNode===null)throw Error(a(166));if(w=vc(cg.current),P=vc(jo.current),Oy(b)){if(!ve)throw Error(a(176));if(w=b.stateNode,I=b.memoizedProps,(P=jt(w,I,b,!Ly))&&(F=yo,F!==null))switch(Z=(F.mode&1)!==0,F.tag){case 3:Ue(F.stateNode.containerInfo,w,I,Z);break;case 5:Qe(F.type,F.memoizedProps,F.stateNode,w,I,Z)}P&&xc(b)}else b.stateNode=$(I,w,P,b)}return js(b),null;case 13:if(Q(Fr),I=b.memoizedState,Rr&&xo!==null&&b.mode&1&&!(b.flags&128)){for(w=xo;w;)w=Xe(w);return og(),b.flags|=98560,b}if(I!==null&&I.dehydrated!==null){if(I=Oy(b),w===null){if(!I)throw Error(a(318));if(!ve)throw Error(a(344));if(w=b.memoizedState,w=w!==null?w.dehydrated:null,!w)throw Error(a(317));Jt(w,b)}else og(),!(b.flags&128)&&(b.memoizedState=null),b.flags|=4;return js(b),null}return Ml!==null&&(b3(Ml),Ml=null),b.flags&128?(b.lanes=P,b):(I=I!==null,P=!1,w===null?Oy(b):P=w.memoizedState!==null,I&&!P&&(b.child.flags|=8192,b.mode&1&&(w===null||Fr.current&1?Un===0&&(Un=3):S3())),b.updateQueue!==null&&(b.flags|=4),js(b),null);case 4:return ug(),Hy(w,b),w===null&&Ce(b.stateNode.containerInfo),js(b),null;case 10:return is(b.type._context),js(b),null;case 17:return Di(b.type)&&pi(),js(b),null;case 19:if(Q(Fr),F=b.memoizedState,F===null)return js(b),null;if(I=(b.flags&128)!==0,Z=F.rendering,Z===null)if(I)jy(F,!1);else{if(Un!==0||w!==null&&w.flags&128)for(w=b.child;w!==null;){if(Z=f_(w),Z!==null){for(b.flags|=128,jy(F,!1),w=Z.updateQueue,w!==null&&(b.updateQueue=w,b.flags|=4),b.subtreeFlags=0,w=P,I=b.child;I!==null;)P=I,F=w,P.flags&=14680066,Z=P.alternate,Z===null?(P.childLanes=0,P.lanes=F,P.child=null,P.subtreeFlags=0,P.memoizedProps=null,P.memoizedState=null,P.updateQueue=null,P.dependencies=null,P.stateNode=null):(P.childLanes=Z.childLanes,P.lanes=Z.lanes,P.child=Z.child,P.subtreeFlags=0,P.deletions=null,P.memoizedProps=Z.memoizedProps,P.memoizedState=Z.memoizedState,P.updateQueue=Z.updateQueue,P.type=Z.type,F=Z.dependencies,P.dependencies=F===null?null:{lanes:F.lanes,firstContext:F.firstContext}),I=I.sibling;return te(Fr,Fr.current&1|2),b.child}w=w.sibling}F.tail!==null&&Br()>v3&&(b.flags|=128,I=!0,jy(F,!1),b.lanes=4194304)}else{if(!I)if(w=f_(Z),w!==null){if(b.flags|=128,I=!0,w=w.updateQueue,w!==null&&(b.updateQueue=w,b.flags|=4),jy(F,!0),F.tail===null&&F.tailMode==="hidden"&&!Z.alternate&&!Rr)return js(b),null}else 2*Br()-F.renderingStartTime>v3&&P!==1073741824&&(b.flags|=128,I=!0,jy(F,!1),b.lanes=4194304);F.isBackwards?(Z.sibling=b.child,b.child=Z):(w=F.last,w!==null?w.sibling=Z:b.child=Z,F.last=Z)}return F.tail!==null?(b=F.tail,F.rendering=b,F.tail=b.sibling,F.renderingStartTime=Br(),b.sibling=null,w=Fr.current,te(Fr,I?w&1|2:w&1),b):(js(b),null);case 22:case 23:return _3(),I=b.memoizedState!==null,w!==null&&w.memoizedState!==null!==I&&(b.flags|=8192),I&&b.mode&1?bo&1073741824&&(js(b),we&&b.subtreeFlags&6&&(b.flags|=8192)):js(b),null;case 24:return null;case 25:return null}throw Error(a(156,b.tag))}var Iae=o.ReactCurrentOwner,wo=!1;function ga(w,b,P,I){b.child=w===null?kk(b,null,P,I):lg(b,w.child,P,I)}function f5(w,b,P,I,F){P=P.render;var Z=b.ref;return nn(b,F),I=YP(w,b,P,I,Z,F),P=QP(),w!==null&&!wo?(b.updateQueue=w.updateQueue,b.flags&=-2053,w.lanes&=~F,_u(w,b,F)):(Rr&&P&&UP(b),b.flags|=1,ga(w,b,I,F),b.child)}function p5(w,b,P,I,F){if(w===null){var Z=P.type;return typeof Z=="function"&&!M3(Z)&&Z.defaultProps===void 0&&P.compare===null&&P.defaultProps===void 0?(b.tag=15,b.type=Z,m5(w,b,Z,I,F)):(w=H_(P.type,null,I,b,b.mode,F),w.ref=b.ref,w.return=b,b.child=w)}if(Z=w.child,!(w.lanes&F)){var Se=Z.memoizedProps;if(P=P.compare,P=P!==null?P:Uf,P(Se,I)&&w.ref===b.ref)return _u(w,b,F)}return b.flags|=1,w=Zh(Z,I),w.ref=b.ref,w.return=b,b.child=w}function m5(w,b,P,I,F){if(w!==null&&Uf(w.memoizedProps,I)&&w.ref===b.ref)if(wo=!1,(w.lanes&F)!==0)w.flags&131072&&(wo=!0);else return b.lanes=w.lanes,_u(w,b,F);return t3(w,b,P,I,F)}function g5(w,b,P){var I=b.pendingProps,F=I.children,Z=w!==null?w.memoizedState:null;if(I.mode==="hidden")if(!(b.mode&1))b.memoizedState={baseLanes:0,cachePool:null},te(dg,bo),bo|=P;else if(P&1073741824)b.memoizedState={baseLanes:0,cachePool:null},I=Z!==null?Z.baseLanes:P,te(dg,bo),bo|=I;else return w=Z!==null?Z.baseLanes|P:P,b.lanes=b.childLanes=1073741824,b.memoizedState={baseLanes:w,cachePool:null},b.updateQueue=null,te(dg,bo),bo|=w,null;else Z!==null?(I=Z.baseLanes|P,b.memoizedState=null):I=P,te(dg,bo),bo|=I;return ga(w,b,F,P),b.child}function v5(w,b){var P=b.ref;(w===null&&P!==null||w!==null&&w.ref!==P)&&(b.flags|=512,b.flags|=2097152)}function t3(w,b,P,I,F){var Z=Di(P)?rt:ae.current;return Z=Ct(b,Z),nn(b,F),P=YP(w,b,P,I,Z,F),I=QP(),w!==null&&!wo?(b.updateQueue=w.updateQueue,b.flags&=-2053,w.lanes&=~F,_u(w,b,F)):(Rr&&I&&UP(b),b.flags|=1,ga(w,b,P,F),b.child)}function y5(w,b,P,I,F){if(Di(P)){var Z=!0;xr(b)}else Z=!1;if(nn(b,F),b.stateNode===null)w!==null&&(w.alternate=null,b.alternate=null,b.flags|=2),Ik(b,P,I),FP(b,P,I,F),I=!0;else if(w===null){var Se=b.stateNode,Ve=b.memoizedProps;Se.props=Ve;var ot=Se.context,yt=P.contextType;typeof yt=="object"&&yt!==null?yt=sn(yt):(yt=Di(P)?rt:ae.current,yt=Ct(b,yt));var Ut=P.getDerivedStateFromProps,_i=typeof Ut=="function"||typeof Se.getSnapshotBeforeUpdate=="function";_i||typeof Se.UNSAFE_componentWillReceiveProps!="function"&&typeof Se.componentWillReceiveProps!="function"||(Ve!==I||ot!==yt)&&Lk(b,Se,I,yt),jh=!1;var ei=b.memoizedState;Se.state=ei,l_(b,I,Se,F),ot=b.memoizedState,Ve!==I||ei!==ot||Ee.current||jh?(typeof Ut=="function"&&(BP(b,P,Ut,I),ot=b.memoizedState),(Ve=jh||Rk(b,P,Ve,I,ei,ot,yt))?(_i||typeof Se.UNSAFE_componentWillMount!="function"&&typeof Se.componentWillMount!="function"||(typeof Se.componentWillMount=="function"&&Se.componentWillMount(),typeof Se.UNSAFE_componentWillMount=="function"&&Se.UNSAFE_componentWillMount()),typeof Se.componentDidMount=="function"&&(b.flags|=4194308)):(typeof Se.componentDidMount=="function"&&(b.flags|=4194308),b.memoizedProps=I,b.memoizedState=ot),Se.props=I,Se.state=ot,Se.context=yt,I=Ve):(typeof Se.componentDidMount=="function"&&(b.flags|=4194308),I=!1)}else{Se=b.stateNode,Tk(w,b),Ve=b.memoizedProps,yt=b.type===b.elementType?Ve:pa(b.type,Ve),Se.props=yt,_i=b.pendingProps,ei=Se.context,ot=P.contextType,typeof ot=="object"&&ot!==null?ot=sn(ot):(ot=Di(P)?rt:ae.current,ot=Ct(b,ot));var gr=P.getDerivedStateFromProps;(Ut=typeof gr=="function"||typeof Se.getSnapshotBeforeUpdate=="function")||typeof Se.UNSAFE_componentWillReceiveProps!="function"&&typeof Se.componentWillReceiveProps!="function"||(Ve!==_i||ei!==ot)&&Lk(b,Se,I,ot),jh=!1,ei=b.memoizedState,Se.state=ei,l_(b,I,Se,F);var Wt=b.memoizedState;Ve!==_i||ei!==Wt||Ee.current||jh?(typeof gr=="function"&&(BP(b,P,gr,I),Wt=b.memoizedState),(yt=jh||Rk(b,P,yt,I,ei,Wt,ot)||!1)?(Ut||typeof Se.UNSAFE_componentWillUpdate!="function"&&typeof Se.componentWillUpdate!="function"||(typeof Se.componentWillUpdate=="function"&&Se.componentWillUpdate(I,Wt,ot),typeof Se.UNSAFE_componentWillUpdate=="function"&&Se.UNSAFE_componentWillUpdate(I,Wt,ot)),typeof Se.componentDidUpdate=="function"&&(b.flags|=4),typeof Se.getSnapshotBeforeUpdate=="function"&&(b.flags|=1024)):(typeof Se.componentDidUpdate!="function"||Ve===w.memoizedProps&&ei===w.memoizedState||(b.flags|=4),typeof Se.getSnapshotBeforeUpdate!="function"||Ve===w.memoizedProps&&ei===w.memoizedState||(b.flags|=1024),b.memoizedProps=I,b.memoizedState=Wt),Se.props=I,Se.state=Wt,Se.context=ot,I=yt):(typeof Se.componentDidUpdate!="function"||Ve===w.memoizedProps&&ei===w.memoizedState||(b.flags|=4),typeof Se.getSnapshotBeforeUpdate!="function"||Ve===w.memoizedProps&&ei===w.memoizedState||(b.flags|=1024),I=!1)}return i3(w,b,P,I,Z,F)}function i3(w,b,P,I,F,Z){v5(w,b);var Se=(b.flags&128)!==0;if(!I&&!Se)return F&&Bn(b,P,!1),_u(w,b,Z);I=b.stateNode,Iae.current=b;var Ve=Se&&typeof P.getDerivedStateFromError!="function"?null:I.render();return b.flags|=1,w!==null&&Se?(b.child=lg(b,w.child,null,Z),b.child=lg(b,null,Ve,Z)):ga(w,b,Ve,Z),b.memoizedState=I.state,F&&Bn(b,P,!0),b.child}function x5(w){var b=w.stateNode;b.pendingContext?qr(w,b.pendingContext,b.pendingContext!==b.context):b.context&&qr(w,b.context,!1),HP(w,b.containerInfo)}function w5(w,b,P,I,F){return og(),GP(F),b.flags|=256,ga(w,b,P,I),b.child}var S_={dehydrated:null,treeContext:null,retryLane:0};function M_(w){return{baseLanes:w,cachePool:null}}function b5(w,b,P){var I=b.pendingProps,F=Fr.current,Z=!1,Se=(b.flags&128)!==0,Ve;if((Ve=Se)||(Ve=w!==null&&w.memoizedState===null?!1:(F&2)!==0),Ve?(Z=!0,b.flags&=-129):(w===null||w.memoizedState!==null)&&(F|=1),te(Fr,F&1),w===null)return VP(b),w=b.memoizedState,w!==null&&(w=w.dehydrated,w!==null)?(b.mode&1?zr(w)?b.lanes=8:b.lanes=1073741824:b.lanes=1,null):(F=I.children,w=I.fallback,Z?(I=b.mode,Z=b.child,F={mode:"hidden",children:F},!(I&1)&&Z!==null?(Z.childLanes=0,Z.pendingProps=F):Z=j_(F,I,0,null),w=Yf(w,I,P,null),Z.return=b,w.return=b,Z.sibling=w,b.child=Z,b.child.memoizedState=M_(P),b.memoizedState=S_,w):r3(b,F));if(F=w.memoizedState,F!==null){if(Ve=F.dehydrated,Ve!==null){if(Se)return b.flags&256?(b.flags&=-257,E_(w,b,P,Error(a(422)))):b.memoizedState!==null?(b.child=w.child,b.flags|=128,null):(Z=I.fallback,F=b.mode,I=j_({mode:"visible",children:I.children},F,0,null),Z=Yf(Z,F,P,null),Z.flags|=2,I.return=b,Z.return=b,I.sibling=Z,b.child=I,b.mode&1&&lg(b,w.child,null,P),b.child.memoizedState=M_(P),b.memoizedState=S_,Z);if(!(b.mode&1))b=E_(w,b,P,null);else if(zr(Ve))b=E_(w,b,P,Error(a(419)));else if(I=(P&w.childLanes)!==0,wo||I){if(I=_n,I!==null){switch(P&-P){case 4:Z=2;break;case 16:Z=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:Z=32;break;case 536870912:Z=268435456;break;default:Z=0}I=Z&(I.suspendedLanes|P)?0:Z,I!==0&&I!==F.retryLane&&(F.retryLane=I,Xo(w,I,-1))}S3(),b=E_(w,b,P,Error(a(421)))}else Or(Ve)?(b.flags|=128,b.child=w.child,b=Wae.bind(null,w),ue(Ve,b),b=null):(P=F.treeContext,ve&&(xo=nt(Ve),yo=b,Rr=!0,Ml=null,Ly=!1,P!==null&&(Go[Ho++]=xu,Go[Ho++]=wu,Go[Ho++]=kf,xu=P.id,wu=P.overflow,kf=b)),b=r3(b,b.pendingProps.children),b.flags|=4096);return b}return Z?(I=S5(w,b,I.children,I.fallback,P),Z=b.child,F=w.child.memoizedState,Z.memoizedState=F===null?M_(P):{baseLanes:F.baseLanes|P,cachePool:null},Z.childLanes=w.childLanes&~P,b.memoizedState=S_,I):(P=_5(w,b,I.children,P),b.memoizedState=null,P)}return Z?(I=S5(w,b,I.children,I.fallback,P),Z=b.child,F=w.child.memoizedState,Z.memoizedState=F===null?M_(P):{baseLanes:F.baseLanes|P,cachePool:null},Z.childLanes=w.childLanes&~P,b.memoizedState=S_,I):(P=_5(w,b,I.children,P),b.memoizedState=null,P)}function r3(w,b){return b=j_({mode:"visible",children:b},w.mode,0,null),b.return=w,w.child=b}function _5(w,b,P,I){var F=w.child;return w=F.sibling,P=Zh(F,{mode:"visible",children:P}),!(b.mode&1)&&(P.lanes=I),P.return=b,P.sibling=null,w!==null&&(I=b.deletions,I===null?(b.deletions=[w],b.flags|=16):I.push(w)),b.child=P}function S5(w,b,P,I,F){var Z=b.mode;w=w.child;var Se=w.sibling,Ve={mode:"hidden",children:P};return!(Z&1)&&b.child!==w?(P=b.child,P.childLanes=0,P.pendingProps=Ve,b.deletions=null):(P=Zh(w,Ve),P.subtreeFlags=w.subtreeFlags&14680064),Se!==null?I=Zh(Se,I):(I=Yf(I,Z,F,null),I.flags|=2),I.return=b,P.return=b,P.sibling=I,b.child=P,I}function E_(w,b,P,I){return I!==null&&GP(I),lg(b,w.child,null,P),w=r3(b,b.pendingProps.children),w.flags|=2,b.memoizedState=null,w}function M5(w,b,P){w.lanes|=b;var I=w.alternate;I!==null&&(I.lanes|=b),ma(w.return,b,P)}function n3(w,b,P,I,F){var Z=w.memoizedState;Z===null?w.memoizedState={isBackwards:b,rendering:null,renderingStartTime:0,last:I,tail:P,tailMode:F}:(Z.isBackwards=b,Z.rendering=null,Z.renderingStartTime=0,Z.last=I,Z.tail=P,Z.tailMode=F)}function E5(w,b,P){var I=b.pendingProps,F=I.revealOrder,Z=I.tail;if(ga(w,b,I.children,P),I=Fr.current,I&2)I=I&1|2,b.flags|=128;else{if(w!==null&&w.flags&128)e:for(w=b.child;w!==null;){if(w.tag===13)w.memoizedState!==null&&M5(w,P,b);else if(w.tag===19)M5(w,P,b);else if(w.child!==null){w.child.return=w,w=w.child;continue}if(w===b)break e;for(;w.sibling===null;){if(w.return===null||w.return===b)break e;w=w.return}w.sibling.return=w.return,w=w.sibling}I&=1}if(te(Fr,I),!(b.mode&1))b.memoizedState=null;else switch(F){case"forwards":for(P=b.child,F=null;P!==null;)w=P.alternate,w!==null&&f_(w)===null&&(F=P),P=P.sibling;P=F,P===null?(F=b.child,b.child=null):(F=P.sibling,P.sibling=null),n3(b,!1,F,P,Z);break;case"backwards":for(P=null,F=b.child,b.child=null;F!==null;){if(w=F.alternate,w!==null&&f_(w)===null){b.child=F;break}w=F.sibling,F.sibling=P,P=F,F=w}n3(b,!0,P,null,Z);break;case"together":n3(b,!1,null,null,void 0);break;default:b.memoizedState=null}return b.child}function _u(w,b,P){if(w!==null&&(b.dependencies=w.dependencies),fg|=b.lanes,!(P&b.childLanes))return null;if(w!==null&&b.child!==w.child)throw Error(a(153));if(b.child!==null){for(w=b.child,P=Zh(w,w.pendingProps),b.child=P,P.return=b;w.sibling!==null;)w=w.sibling,P=P.sibling=Zh(w,w.pendingProps),P.return=b;P.sibling=null}return b.child}function Lae(w,b,P){switch(b.tag){case 3:x5(b),og();break;case 5:Vk(b);break;case 1:Di(b.type)&&xr(b);break;case 4:HP(b,b.stateNode.containerInfo);break;case 10:a_(b,b.type._context,b.memoizedProps.value);break;case 13:var I=b.memoizedState;if(I!==null)return I.dehydrated!==null?(te(Fr,Fr.current&1),b.flags|=128,null):P&b.child.childLanes?b5(w,b,P):(te(Fr,Fr.current&1),w=_u(w,b,P),w!==null?w.sibling:null);te(Fr,Fr.current&1);break;case 19:if(I=(P&b.childLanes)!==0,w.flags&128){if(I)return E5(w,b,P);b.flags|=128}var F=b.memoizedState;if(F!==null&&(F.rendering=null,F.tail=null,F.lastEffect=null),te(Fr,Fr.current),I)break;return null;case 22:case 23:return b.lanes=0,g5(w,b,P)}return _u(w,b,P)}function Oae(w,b){switch(NP(b),b.tag){case 1:return Di(b.type)&&pi(),w=b.flags,w&65536?(b.flags=w&-65537|128,b):null;case 3:return ug(),Q(Ee),Q(ae),XP(),w=b.flags,w&65536&&!(w&128)?(b.flags=w&-65537|128,b):null;case 5:return jP(b),null;case 13:if(Q(Fr),w=b.memoizedState,w!==null&&w.dehydrated!==null){if(b.alternate===null)throw Error(a(340));og()}return w=b.flags,w&65536?(b.flags=w&-65537|128,b):null;case 19:return Q(Fr),null;case 4:return ug(),null;case 10:return is(b.type._context),null;case 22:case 23:return _3(),null;case 24:return null;default:return null}}var A_=!1,Hf=!1,zae=typeof WeakSet=="function"?WeakSet:Set,Pt=null;function T_(w,b){var P=w.ref;if(P!==null)if(typeof P=="function")try{P(null)}catch(I){ja(w,b,I)}else P.current=null}function s3(w,b,P){try{P()}catch(I){ja(w,b,I)}}var A5=!1;function Bae(w,b){for(V(w.containerInfo),Pt=b;Pt!==null;)if(w=Pt,b=w.child,(w.subtreeFlags&1028)!==0&&b!==null)b.return=w,Pt=b;else for(;Pt!==null;){w=Pt;try{var P=w.alternate;if(w.flags&1024)switch(w.tag){case 0:case 11:case 15:break;case 1:if(P!==null){var I=P.memoizedProps,F=P.memoizedState,Z=w.stateNode,Se=Z.getSnapshotBeforeUpdate(w.elementType===w.type?I:pa(w.type,I),F);Z.__reactInternalSnapshotBeforeUpdate=Se}break;case 3:we&&ze(w.stateNode.containerInfo);break;case 5:case 6:case 4:case 17:break;default:throw Error(a(163))}}catch(Ve){ja(w,w.return,Ve)}if(b=w.sibling,b!==null){b.return=w.return,Pt=b;break}Pt=w.return}return P=A5,A5=!1,P}function jf(w,b,P){var I=b.updateQueue;if(I=I!==null?I.lastEffect:null,I!==null){var F=I=I.next;do{if((F.tag&w)===w){var Z=F.destroy;F.destroy=void 0,Z!==void 0&&s3(b,P,Z)}F=F.next}while(F!==I)}}function Wy(w,b){if(b=b.updateQueue,b=b!==null?b.lastEffect:null,b!==null){var P=b=b.next;do{if((P.tag&w)===w){var I=P.create;P.destroy=I()}P=P.next}while(P!==b)}}function a3(w){var b=w.ref;if(b!==null){var P=w.stateNode;switch(w.tag){case 5:w=j(P);break;default:w=P}typeof b=="function"?b(w):b.current=w}}function T5(w,b,P){if(mo&&typeof mo.onCommitFiberUnmount=="function")try{mo.onCommitFiberUnmount(Bf,b)}catch{}switch(b.tag){case 0:case 11:case 14:case 15:if(w=b.updateQueue,w!==null&&(w=w.lastEffect,w!==null)){var I=w=w.next;do{var F=I,Z=F.destroy;F=F.tag,Z!==void 0&&(F&2||F&4)&&s3(b,P,Z),I=I.next}while(I!==w)}break;case 1:if(T_(b,P),w=b.stateNode,typeof w.componentWillUnmount=="function")try{w.props=b.memoizedProps,w.state=b.memoizedState,w.componentWillUnmount()}catch(Se){ja(b,P,Se)}break;case 5:T_(b,P);break;case 4:we?L5(w,b,P):le&&le&&(b=b.stateNode.containerInfo,P=Je(b),Mt(b,P))}}function C5(w,b,P){for(var I=b;;)if(T5(w,I,P),I.child===null||we&&I.tag===4){if(I===b)break;for(;I.sibling===null;){if(I.return===null||I.return===b)return;I=I.return}I.sibling.return=I.return,I=I.sibling}else I.child.return=I,I=I.child}function P5(w){var b=w.alternate;b!==null&&(w.alternate=null,P5(b)),w.child=null,w.deletions=null,w.sibling=null,w.tag===5&&(b=w.stateNode,b!==null&&Ne(b)),w.stateNode=null,w.return=null,w.dependencies=null,w.memoizedProps=null,w.memoizedState=null,w.pendingProps=null,w.stateNode=null,w.updateQueue=null}function D5(w){return w.tag===5||w.tag===3||w.tag===4}function R5(w){e:for(;;){for(;w.sibling===null;){if(w.return===null||D5(w.return))return null;w=w.return}for(w.sibling.return=w.return,w=w.sibling;w.tag!==5&&w.tag!==6&&w.tag!==18;){if(w.flags&2||w.child===null||w.tag===4)continue e;w.child.return=w,w=w.child}if(!(w.flags&2))return w.stateNode}}function I5(w){if(we){e:{for(var b=w.return;b!==null;){if(D5(b))break e;b=b.return}throw Error(a(160))}var P=b;switch(P.tag){case 5:b=P.stateNode,P.flags&32&&(We(b),P.flags&=-33),P=R5(w),l3(w,P,b);break;case 3:case 4:b=P.stateNode.containerInfo,P=R5(w),o3(w,P,b);break;default:throw Error(a(161))}}}function o3(w,b,P){var I=w.tag;if(I===5||I===6)w=w.stateNode,b?it(P,w,b):Be(P,w);else if(I!==4&&(w=w.child,w!==null))for(o3(w,b,P),w=w.sibling;w!==null;)o3(w,b,P),w=w.sibling}function l3(w,b,P){var I=w.tag;if(I===5||I===6)w=w.stateNode,b?Ke(P,w,b):Oe(P,w);else if(I!==4&&(w=w.child,w!==null))for(l3(w,b,P),w=w.sibling;w!==null;)l3(w,b,P),w=w.sibling}function L5(w,b,P){for(var I=b,F=!1,Z,Se;;){if(!F){F=I.return;e:for(;;){if(F===null)throw Error(a(160));switch(Z=F.stateNode,F.tag){case 5:Se=!1;break e;case 3:Z=Z.containerInfo,Se=!0;break e;case 4:Z=Z.containerInfo,Se=!0;break e}F=F.return}F=!0}if(I.tag===5||I.tag===6)C5(w,I,P),Se?de(Z,I.stateNode):He(Z,I.stateNode);else if(I.tag===18)Se?si(Z,I.stateNode):fi(Z,I.stateNode);else if(I.tag===4){if(I.child!==null){Z=I.stateNode.containerInfo,Se=!0,I.child.return=I,I=I.child;continue}}else if(T5(w,I,P),I.child!==null){I.child.return=I,I=I.child;continue}if(I===b)break;for(;I.sibling===null;){if(I.return===null||I.return===b)return;I=I.return,I.tag===4&&(F=!1)}I.sibling.return=I.return,I=I.sibling}}function c3(w,b){if(we){switch(b.tag){case 0:case 11:case 14:case 15:jf(3,b,b.return),Wy(3,b),jf(5,b,b.return);return;case 1:return;case 5:var P=b.stateNode;if(P!=null){var I=b.memoizedProps;w=w!==null?w.memoizedProps:I;var F=b.type,Z=b.updateQueue;b.updateQueue=null,Z!==null&&qe(P,Z,F,w,I,b)}return;case 6:if(b.stateNode===null)throw Error(a(162));P=b.memoizedProps,Re(b.stateNode,w!==null?w.memoizedProps:P,P);return;case 3:ve&&w!==null&&w.memoizedState.isDehydrated&&Ei(b.stateNode.containerInfo);return;case 12:return;case 13:C_(b);return;case 19:C_(b);return;case 17:return}throw Error(a(163))}switch(b.tag){case 0:case 11:case 14:case 15:jf(3,b,b.return),Wy(3,b),jf(5,b,b.return);return;case 12:return;case 13:C_(b);return;case 19:C_(b);return;case 3:ve&&w!==null&&w.memoizedState.isDehydrated&&Ei(b.stateNode.containerInfo);break;case 22:case 23:return}e:if(le){switch(b.tag){case 1:case 5:case 6:break e;case 3:case 4:b=b.stateNode,Mt(b.containerInfo,b.pendingChildren);break e}throw Error(a(163))}}function C_(w){var b=w.updateQueue;if(b!==null){w.updateQueue=null;var P=w.stateNode;P===null&&(P=w.stateNode=new zae),b.forEach(function(I){var F=Xae.bind(null,w,I);P.has(I)||(P.add(I),I.then(F,F))})}}function Fae(w,b){for(Pt=b;Pt!==null;){b=Pt;var P=b.deletions;if(P!==null)for(var I=0;I<P.length;I++){var F=P[I];try{var Z=w;we?L5(Z,F,b):C5(Z,F,b);var Se=F.alternate;Se!==null&&(Se.return=null),F.return=null}catch(Ht){ja(F,b,Ht)}}if(P=b.child,b.subtreeFlags&12854&&P!==null)P.return=b,Pt=P;else for(;Pt!==null;){b=Pt;try{var Ve=b.flags;if(Ve&32&&we&&We(b.stateNode),Ve&512){var ot=b.alternate;if(ot!==null){var yt=ot.ref;yt!==null&&(typeof yt=="function"?yt(null):yt.current=null)}}if(Ve&8192)switch(b.tag){case 13:if(b.memoizedState!==null){var Ut=b.alternate;(Ut===null||Ut.memoizedState===null)&&(g3=Br())}break;case 22:var _i=b.memoizedState!==null,ei=b.alternate,gr=ei!==null&&ei.memoizedState!==null;if(P=b,we){e:if(I=P,F=_i,Z=null,we)for(var Wt=I;;){if(Wt.tag===5){if(Z===null){Z=Wt;var Ws=Wt.stateNode;F?dt(Ws):xe(Wt.stateNode,Wt.memoizedProps)}}else if(Wt.tag===6){if(Z===null){var Yo=Wt.stateNode;F?J(Yo):me(Yo,Wt.memoizedProps)}}else if((Wt.tag!==22&&Wt.tag!==23||Wt.memoizedState===null||Wt===I)&&Wt.child!==null){Wt.child.return=Wt,Wt=Wt.child;continue}if(Wt===I)break;for(;Wt.sibling===null;){if(Wt.return===null||Wt.return===I)break e;Z===Wt&&(Z=null),Wt=Wt.return}Z===Wt&&(Z=null),Wt.sibling.return=Wt.return,Wt=Wt.sibling}}if(_i&&!gr&&P.mode&1){Pt=P;for(var $e=P.child;$e!==null;){for(P=Pt=$e;Pt!==null;){I=Pt;var je=I.child;switch(I.tag){case 0:case 11:case 14:case 15:jf(4,I,I.return);break;case 1:T_(I,I.return);var st=I.stateNode;if(typeof st.componentWillUnmount=="function"){var Lt=I.return;try{st.props=I.memoizedProps,st.state=I.memoizedState,st.componentWillUnmount()}catch(Ht){ja(I,Lt,Ht)}}break;case 5:T_(I,I.return);break;case 22:if(I.memoizedState!==null){B5(P);continue}}je!==null?(je.return=I,Pt=je):B5(P)}$e=$e.sibling}}}switch(Ve&4102){case 2:I5(b),b.flags&=-3;break;case 6:I5(b),b.flags&=-3,c3(b.alternate,b);break;case 4096:b.flags&=-4097;break;case 4100:b.flags&=-4097,c3(b.alternate,b);break;case 4:c3(b.alternate,b)}}catch(Ht){ja(b,b.return,Ht)}if(P=b.sibling,P!==null){P.return=b.return,Pt=P;break}Pt=b.return}}}function Uae(w,b,P){Pt=w,O5(w)}function O5(w,b,P){for(var I=(w.mode&1)!==0;Pt!==null;){var F=Pt,Z=F.child;if(F.tag===22&&I){var Se=F.memoizedState!==null||A_;if(!Se){var Ve=F.alternate,ot=Ve!==null&&Ve.memoizedState!==null||Hf;Ve=A_;var yt=Hf;if(A_=Se,(Hf=ot)&&!yt)for(Pt=F;Pt!==null;)Se=Pt,ot=Se.child,Se.tag===22&&Se.memoizedState!==null?F5(F):ot!==null?(ot.return=Se,Pt=ot):F5(F);for(;Z!==null;)Pt=Z,O5(Z),Z=Z.sibling;Pt=F,A_=Ve,Hf=yt}z5(w)}else F.subtreeFlags&8772&&Z!==null?(Z.return=F,Pt=Z):z5(w)}}function z5(w){for(;Pt!==null;){var b=Pt;if(b.flags&8772){var P=b.alternate;try{if(b.flags&8772)switch(b.tag){case 0:case 11:case 15:Hf||Wy(5,b);break;case 1:var I=b.stateNode;if(b.flags&4&&!Hf)if(P===null)I.componentDidMount();else{var F=b.elementType===b.type?P.memoizedProps:pa(b.type,P.memoizedProps);I.componentDidUpdate(F,P.memoizedState,I.__reactInternalSnapshotBeforeUpdate)}var Z=b.updateQueue;Z!==null&&Pk(b,Z,I);break;case 3:var Se=b.updateQueue;if(Se!==null){if(P=null,b.child!==null)switch(b.child.tag){case 5:P=j(b.child.stateNode);break;case 1:P=b.child.stateNode}Pk(b,Se,P)}break;case 5:var Ve=b.stateNode;P===null&&b.flags&4&&ke(Ve,b.type,b.memoizedProps,b);break;case 6:break;case 4:break;case 12:break;case 13:if(ve&&b.memoizedState===null){var ot=b.alternate;if(ot!==null){var yt=ot.memoizedState;if(yt!==null){var Ut=yt.dehydrated;Ut!==null&&li(Ut)}}}break;case 19:case 17:case 21:case 22:case 23:break;default:throw Error(a(163))}Hf||b.flags&512&&a3(b)}catch(_i){ja(b,b.return,_i)}}if(b===w){Pt=null;break}if(P=b.sibling,P!==null){P.return=b.return,Pt=P;break}Pt=b.return}}function B5(w){for(;Pt!==null;){var b=Pt;if(b===w){Pt=null;break}var P=b.sibling;if(P!==null){P.return=b.return,Pt=P;break}Pt=b.return}}function F5(w){for(;Pt!==null;){var b=Pt;try{switch(b.tag){case 0:case 11:case 15:var P=b.return;try{Wy(4,b)}catch(ot){ja(b,P,ot)}break;case 1:var I=b.stateNode;if(typeof I.componentDidMount=="function"){var F=b.return;try{I.componentDidMount()}catch(ot){ja(b,F,ot)}}var Z=b.return;try{a3(b)}catch(ot){ja(b,Z,ot)}break;case 5:var Se=b.return;try{a3(b)}catch(ot){ja(b,Se,ot)}}}catch(ot){ja(b,b.return,ot)}if(b===w){Pt=null;break}var Ve=b.sibling;if(Ve!==null){Ve.return=b.return,Pt=Ve;break}Pt=b.return}}var P_=0,D_=1,R_=2,I_=3,L_=4;if(typeof Symbol=="function"&&Symbol.for){var Xy=Symbol.for;P_=Xy("selector.component"),D_=Xy("selector.has_pseudo_class"),R_=Xy("selector.role"),I_=Xy("selector.test_id"),L_=Xy("selector.text")}function u3(w){var b=ie(w);if(b!=null){if(typeof b.memoizedProps["data-testname"]!="string")throw Error(a(364));return b}if(w=K(w),w===null)throw Error(a(362));return w.stateNode.current}function h3(w,b){switch(b.$$typeof){case P_:if(w.type===b.value)return!0;break;case D_:e:{b=b.value,w=[w,0];for(var P=0;P<w.length;){var I=w[P++],F=w[P++],Z=b[F];if(I.tag!==5||!oe(I)){for(;Z!=null&&h3(I,Z);)F++,Z=b[F];if(F===b.length){b=!0;break e}else for(I=I.child;I!==null;)w.push(I,F),I=I.sibling}}b=!1}return b;case R_:if(w.tag===5&&fe(w.stateNode,b.value))return!0;break;case L_:if((w.tag===5||w.tag===6)&&(w=G(w),w!==null&&0<=w.indexOf(b.value)))return!0;break;case I_:if(w.tag===5&&(w=w.memoizedProps["data-testname"],typeof w=="string"&&w.toLowerCase()===b.value.toLowerCase()))return!0;break;default:throw Error(a(365))}return!1}function d3(w){switch(w.$$typeof){case P_:return"<"+(T(w.value)||"Unknown")+">";case D_:return":has("+(d3(w)||"")+")";case R_:return'[role="'+w.value+'"]';case L_:return'"'+w.value+'"';case I_:return'[data-testname="'+w.value+'"]';default:throw Error(a(365))}}function U5(w,b){var P=[];w=[w,0];for(var I=0;I<w.length;){var F=w[I++],Z=w[I++],Se=b[Z];if(F.tag!==5||!oe(F)){for(;Se!=null&&h3(F,Se);)Z++,Se=b[Z];if(Z===b.length)P.push(F);else for(F=F.child;F!==null;)w.push(F,Z),F=F.sibling}}return P}function f3(w,b){if(!Fe)throw Error(a(363));w=u3(w),w=U5(w,b),b=[],w=Array.from(w);for(var P=0;P<w.length;){var I=w[P++];if(I.tag===5)oe(I)||b.push(I.stateNode);else for(I=I.child;I!==null;)w.push(I),I=I.sibling}return b}var Nae=Math.ceil,O_=o.ReactCurrentDispatcher,p3=o.ReactCurrentOwner,an=o.ReactCurrentBatchConfig,Ii=0,_n=null,Sn=null,bs=0,bo=0,dg=zt(0),Un=0,qy=null,fg=0,z_=0,m3=0,Yy=null,Ga=null,g3=0,v3=1/0;function pg(){v3=Br()+500}var B_=!1,y3=null,Xh=null,F_=!1,qh=null,U_=0,Qy=0,x3=null,N_=-1,k_=0;function va(){return Ii&6?Br():N_!==-1?N_:N_=Br()}function Yh(w){return w.mode&1?Ii&2&&bs!==0?bs&-bs:Ff.transition!==null?(k_===0&&(w=Dr,Dr<<=1,!(Dr&4194240)&&(Dr=64),k_=w),k_):(w=Oi,w!==0?w:Pe()):1}function Xo(w,b,P){if(50<Qy)throw Qy=0,x3=null,Error(a(185));var I=V_(w,b);return I===null?null:(pc(I,b,P),(!(Ii&2)||I!==_n)&&(I===_n&&(!(Ii&2)&&(z_|=b),Un===4&&Qh(I,bs)),Ha(I,P),b===1&&Ii===0&&!(w.mode&1)&&(pg(),gc&&Va())),I)}function V_(w,b){w.lanes|=b;var P=w.alternate;for(P!==null&&(P.lanes|=b),P=w,w=w.return;w!==null;)w.childLanes|=b,P=w.alternate,P!==null&&(P.childLanes|=b),P=w,w=w.return;return P.tag===3?P.stateNode:null}function Ha(w,b){var P=w.callbackNode;Ay(w,b);var I=Of(w,w===_n?bs:0);if(I===0)P!==null&&ig(P),w.callbackNode=null,w.callbackPriority=0;else if(b=I&-I,w.callbackPriority!==b){if(P!=null&&ig(P),b===1)w.tag===0?Iy(k5.bind(null,w)):Ry(k5.bind(null,w)),be?Le(function(){Ii===0&&Va()}):vu(zf,Va),P=null;else{switch(Ty(I)){case 1:P=zf;break;case 4:P=n_;break;case 16:P=da;break;case 536870912:P=Py;break;default:P=da}P=Q5(P,N5.bind(null,w))}w.callbackPriority=b,w.callbackNode=P}}function N5(w,b){if(N_=-1,k_=0,Ii&6)throw Error(a(327));var P=w.callbackNode;if(qf()&&w.callbackNode!==P)return null;var I=Of(w,w===_n?bs:0);if(I===0)return null;if(I&30||I&w.expiredLanes||b)b=G_(w,I);else{b=I;var F=Ii;Ii|=2;var Z=H5();(_n!==w||bs!==b)&&(pg(),Wf(w,b));do try{Gae();break}catch(Ve){G5(w,Ve)}while(!0);ng(),O_.current=Z,Ii=F,Sn!==null?b=0:(_n=null,bs=0,b=Un)}if(b!==0){if(b===2&&(F=gu(w),F!==0&&(I=F,b=w3(w,F))),b===1)throw P=qy,Wf(w,0),Qh(w,I),Ha(w,Br()),P;if(b===6)Qh(w,I);else{if(F=w.current.alternate,!(I&30)&&!kae(F)&&(b=G_(w,I),b===2&&(Z=gu(w),Z!==0&&(I=Z,b=w3(w,Z))),b===1))throw P=qy,Wf(w,0),Qh(w,I),Ha(w,Br()),P;switch(w.finishedWork=F,w.finishedLanes=I,b){case 0:case 1:throw Error(a(345));case 2:Xf(w,Ga);break;case 3:if(Qh(w,I),(I&130023424)===I&&(b=g3+500-Br(),10<b)){if(Of(w,0)!==0)break;if(F=w.suspendedLanes,(F&I)!==I){va(),w.pingedLanes|=w.suspendedLanes&F;break}w.timeoutHandle=ne(Xf.bind(null,w,Ga),b);break}Xf(w,Ga);break;case 4:if(Qh(w,I),(I&4194240)===I)break;for(b=w.eventTimes,F=-1;0<I;){var Se=31-Li(I);Z=1<<Se,Se=b[Se],Se>F&&(F=Se),I&=~Z}if(I=F,I=Br()-I,I=(120>I?120:480>I?480:1080>I?1080:1920>I?1920:3e3>I?3e3:4320>I?4320:1960*Nae(I/1960))-I,10<I){w.timeoutHandle=ne(Xf.bind(null,w,Ga),I);break}Xf(w,Ga);break;case 5:Xf(w,Ga);break;default:throw Error(a(329))}}}return Ha(w,Br()),w.callbackNode===P?N5.bind(null,w):null}function w3(w,b){var P=Yy;return w.current.memoizedState.isDehydrated&&(Wf(w,b).flags|=256),w=G_(w,b),w!==2&&(b=Ga,Ga=P,b!==null&&b3(b)),w}function b3(w){Ga===null?Ga=w:Ga.push.apply(Ga,w)}function kae(w){for(var b=w;;){if(b.flags&16384){var P=b.updateQueue;if(P!==null&&(P=P.stores,P!==null))for(var I=0;I<P.length;I++){var F=P[I],Z=F.getSnapshot;F=F.value;try{if(!go(Z(),F))return!1}catch{return!1}}}if(P=b.child,b.subtreeFlags&16384&&P!==null)P.return=b,b=P;else{if(b===w)break;for(;b.sibling===null;){if(b.return===null||b.return===w)return!0;b=b.return}b.sibling.return=b.return,b=b.sibling}}return!0}function Qh(w,b){for(b&=~m3,b&=~z_,w.suspendedLanes|=b,w.pingedLanes&=~b,w=w.expirationTimes;0<b;){var P=31-Li(b),I=1<<P;w[P]=-1,b&=~I}}function k5(w){if(Ii&6)throw Error(a(327));qf();var b=Of(w,0);if(!(b&1))return Ha(w,Br()),null;var P=G_(w,b);if(w.tag!==0&&P===2){var I=gu(w);I!==0&&(b=I,P=w3(w,I))}if(P===1)throw P=qy,Wf(w,0),Qh(w,b),Ha(w,Br()),P;if(P===6)throw Error(a(345));return w.finishedWork=w.current.alternate,w.finishedLanes=b,Xf(w,Ga),Ha(w,Br()),null}function V5(w){qh!==null&&qh.tag===0&&!(Ii&6)&&qf();var b=Ii;Ii|=1;var P=an.transition,I=Oi;try{if(an.transition=null,Oi=1,w)return w()}finally{Oi=I,an.transition=P,Ii=b,!(Ii&6)&&Va()}}function _3(){bo=dg.current,Q(dg)}function Wf(w,b){w.finishedWork=null,w.finishedLanes=0;var P=w.timeoutHandle;if(P!==pe&&(w.timeoutHandle=pe,ce(P)),Sn!==null)for(P=Sn.return;P!==null;){var I=P;switch(NP(I),I.tag){case 1:I=I.type.childContextTypes,I!=null&&pi();break;case 3:ug(),Q(Ee),Q(ae),XP();break;case 5:jP(I);break;case 4:ug();break;case 13:Q(Fr);break;case 19:Q(Fr);break;case 10:is(I.type._context);break;case 22:case 23:_3()}P=P.return}if(_n=w,Sn=w=Zh(w.current,null),bs=bo=b,Un=0,qy=null,m3=z_=fg=0,Ga=Yy=null,vo!==null){for(b=0;b<vo.length;b++)if(P=vo[b],I=P.interleaved,I!==null){P.interleaved=null;var F=I.next,Z=P.pending;if(Z!==null){var Se=Z.next;Z.next=F,I.next=Se}P.pending=I}vo=null}return w}function G5(w,b){do{var P=Sn;try{if(ng(),p_.current=w_,m_){for(var I=Yr.memoizedState;I!==null;){var F=I.queue;F!==null&&(F.pending=null),I=I.next}m_=!1}if(hg=0,rs=Gs=Yr=null,Uy=!1,Ny=0,p3.current=null,P===null||P.return===null){Un=1,qy=b,Sn=null;break}e:{var Z=w,Se=P.return,Ve=P,ot=b;if(b=bs,Ve.flags|=32768,ot!==null&&typeof ot=="object"&&typeof ot.then=="function"){var yt=ot,Ut=Ve,_i=Ut.tag;if(!(Ut.mode&1)&&(_i===0||_i===11||_i===15)){var ei=Ut.alternate;ei?(Ut.updateQueue=ei.updateQueue,Ut.memoizedState=ei.memoizedState,Ut.lanes=ei.lanes):(Ut.updateQueue=null,Ut.memoizedState=null)}var gr=c5(Se);if(gr!==null){gr.flags&=-257,u5(gr,Se,Ve,Z,b),gr.mode&1&&l5(Z,yt,b),b=gr,ot=yt;var Wt=b.updateQueue;if(Wt===null){var Ws=new Set;Ws.add(ot),b.updateQueue=Ws}else Wt.add(ot);break e}else{if(!(b&1)){l5(Z,yt,b),S3();break e}ot=Error(a(426))}}else if(Rr&&Ve.mode&1){var Yo=c5(Se);if(Yo!==null){!(Yo.flags&65536)&&(Yo.flags|=256),u5(Yo,Se,Ve,Z,b),GP(ot);break e}}Z=ot,Un!==4&&(Un=2),Yy===null?Yy=[Z]:Yy.push(Z),ot=$P(ot,Ve),Ve=Se;do{switch(Ve.tag){case 3:Ve.flags|=65536,b&=-b,Ve.lanes|=b;var $e=a5(Ve,ot,b);Ck(Ve,$e);break e;case 1:Z=ot;var je=Ve.type,st=Ve.stateNode;if(!(Ve.flags&128)&&(typeof je.getDerivedStateFromError=="function"||st!==null&&typeof st.componentDidCatch=="function"&&(Xh===null||!Xh.has(st)))){Ve.flags|=65536,b&=-b,Ve.lanes|=b;var Lt=o5(Ve,Z,b);Ck(Ve,Lt);break e}}Ve=Ve.return}while(Ve!==null)}W5(P)}catch(Ht){b=Ht,Sn===P&&P!==null&&(Sn=P=P.return);continue}break}while(!0)}function H5(){var w=O_.current;return O_.current=w_,w===null?w_:w}function S3(){(Un===0||Un===3||Un===2)&&(Un=4),_n===null||!(fg&268435455)&&!(z_&268435455)||Qh(_n,bs)}function G_(w,b){var P=Ii;Ii|=2;var I=H5();_n===w&&bs===b||Wf(w,b);do try{Vae();break}catch(F){G5(w,F)}while(!0);if(ng(),Ii=P,O_.current=I,Sn!==null)throw Error(a(261));return _n=null,bs=0,Un}function Vae(){for(;Sn!==null;)j5(Sn)}function Gae(){for(;Sn!==null&&!Cy();)j5(Sn)}function j5(w){var b=Y5(w.alternate,w,bo);w.memoizedProps=w.pendingProps,b===null?W5(w):Sn=b,p3.current=null}function W5(w){var b=w;do{var P=b.alternate;if(w=b.return,b.flags&32768){if(P=Oae(P,b),P!==null){P.flags&=32767,Sn=P;return}if(w!==null)w.flags|=32768,w.subtreeFlags=0,w.deletions=null;else{Un=6,Sn=null;return}}else if(P=Rae(P,b,bo),P!==null){Sn=P;return}if(b=b.sibling,b!==null){Sn=b;return}Sn=b=w}while(b!==null);Un===0&&(Un=5)}function Xf(w,b){var P=Oi,I=an.transition;try{an.transition=null,Oi=1,Hae(w,b,P)}finally{an.transition=I,Oi=P}return null}function Hae(w,b,P){do qf();while(qh!==null);if(Ii&6)throw Error(a(327));var I=w.finishedWork,F=w.finishedLanes;if(I===null)return null;if(w.finishedWork=null,w.finishedLanes=0,I===w.current)throw Error(a(177));w.callbackNode=null,w.callbackPriority=0;var Z=I.lanes|I.childLanes;if(Gh(w,Z),w===_n&&(Sn=_n=null,bs=0),!(I.subtreeFlags&2064)&&!(I.flags&2064)||F_||(F_=!0,Q5(da,function(){return qf(),null})),Z=(I.flags&15990)!==0,I.subtreeFlags&15990||Z){Z=an.transition,an.transition=null;var Se=Oi;Oi=1;var Ve=Ii;Ii|=4,p3.current=null,Bae(w,I),Fae(w,I),U(w.containerInfo),w.current=I,Uae(I),r_(),Ii=Ve,Oi=Se,an.transition=Z}else w.current=I;if(F_&&(F_=!1,qh=w,U_=F),Z=w.pendingLanes,Z===0&&(Xh=null),Dy(I.stateNode),Ha(w,Br()),b!==null)for(P=w.onRecoverableError,I=0;I<b.length;I++)P(b[I]);if(B_)throw B_=!1,w=y3,y3=null,w;return U_&1&&w.tag!==0&&qf(),Z=w.pendingLanes,Z&1?w===x3?Qy++:(Qy=0,x3=w):Qy=0,Va(),null}function qf(){if(qh!==null){var w=Ty(U_),b=an.transition,P=Oi;try{if(an.transition=null,Oi=16>w?16:w,qh===null)var I=!1;else{if(w=qh,qh=null,U_=0,Ii&6)throw Error(a(331));var F=Ii;for(Ii|=4,Pt=w.current;Pt!==null;){var Z=Pt,Se=Z.child;if(Pt.flags&16){var Ve=Z.deletions;if(Ve!==null){for(var ot=0;ot<Ve.length;ot++){var yt=Ve[ot];for(Pt=yt;Pt!==null;){var Ut=Pt;switch(Ut.tag){case 0:case 11:case 15:jf(8,Ut,Z)}var _i=Ut.child;if(_i!==null)_i.return=Ut,Pt=_i;else for(;Pt!==null;){Ut=Pt;var ei=Ut.sibling,gr=Ut.return;if(P5(Ut),Ut===yt){Pt=null;break}if(ei!==null){ei.return=gr,Pt=ei;break}Pt=gr}}}var Wt=Z.alternate;if(Wt!==null){var Ws=Wt.child;if(Ws!==null){Wt.child=null;do{var Yo=Ws.sibling;Ws.sibling=null,Ws=Yo}while(Ws!==null)}}Pt=Z}}if(Z.subtreeFlags&2064&&Se!==null)Se.return=Z,Pt=Se;else e:for(;Pt!==null;){if(Z=Pt,Z.flags&2048)switch(Z.tag){case 0:case 11:case 15:jf(9,Z,Z.return)}var $e=Z.sibling;if($e!==null){$e.return=Z.return,Pt=$e;break e}Pt=Z.return}}var je=w.current;for(Pt=je;Pt!==null;){Se=Pt;var st=Se.child;if(Se.subtreeFlags&2064&&st!==null)st.return=Se,Pt=st;else e:for(Se=je;Pt!==null;){if(Ve=Pt,Ve.flags&2048)try{switch(Ve.tag){case 0:case 11:case 15:Wy(9,Ve)}}catch(Ht){ja(Ve,Ve.return,Ht)}if(Ve===Se){Pt=null;break e}var Lt=Ve.sibling;if(Lt!==null){Lt.return=Ve.return,Pt=Lt;break e}Pt=Ve.return}}if(Ii=F,Va(),mo&&typeof mo.onPostCommitFiberRoot=="function")try{mo.onPostCommitFiberRoot(Bf,w)}catch{}I=!0}return I}finally{Oi=P,an.transition=b}}return!1}function X5(w,b,P){b=$P(P,b),b=a5(w,b,1),Wh(w,b),b=va(),w=V_(w,1),w!==null&&(pc(w,1,b),Ha(w,b))}function ja(w,b,P){if(w.tag===3)X5(w,w,P);else for(;b!==null;){if(b.tag===3){X5(b,w,P);break}else if(b.tag===1){var I=b.stateNode;if(typeof b.type.getDerivedStateFromError=="function"||typeof I.componentDidCatch=="function"&&(Xh===null||!Xh.has(I))){w=$P(P,w),w=o5(b,w,1),Wh(b,w),w=va(),b=V_(b,1),b!==null&&(pc(b,1,w),Ha(b,w));break}}b=b.return}}function jae(w,b,P){var I=w.pingCache;I!==null&&I.delete(b),b=va(),w.pingedLanes|=w.suspendedLanes&P,_n===w&&(bs&P)===P&&(Un===4||Un===3&&(bs&130023424)===bs&&500>Br()-g3?Wf(w,0):m3|=P),Ha(w,b)}function q5(w,b){b===0&&(w.mode&1?(b=po,po<<=1,!(po&130023424)&&(po=4194304)):b=1);var P=va();w=V_(w,b),w!==null&&(pc(w,b,P),Ha(w,P))}function Wae(w){var b=w.memoizedState,P=0;b!==null&&(P=b.retryLane),q5(w,P)}function Xae(w,b){var P=0;switch(w.tag){case 13:var I=w.stateNode,F=w.memoizedState;F!==null&&(P=F.retryLane);break;case 19:I=w.stateNode;break;default:throw Error(a(314))}I!==null&&I.delete(b),q5(w,P)}var Y5;Y5=function(w,b,P){if(w!==null)if(w.memoizedProps!==b.pendingProps||Ee.current)wo=!0;else{if(!(w.lanes&P)&&!(b.flags&128))return wo=!1,Lae(w,b,P);wo=!!(w.flags&131072)}else wo=!1,Rr&&b.flags&1048576&&Ok(b,h_,b.index);switch(b.lanes=0,b.tag){case 2:var I=b.type;w!==null&&(w.alternate=null,b.alternate=null,b.flags|=2),w=b.pendingProps;var F=Ct(b,ae.current);nn(b,P),F=YP(null,b,I,w,F,P);var Z=QP();return b.flags|=1,typeof F=="object"&&F!==null&&typeof F.render=="function"&&F.$$typeof===void 0?(b.tag=1,b.memoizedState=null,b.updateQueue=null,Di(I)?(Z=!0,xr(b)):Z=!1,b.memoizedState=F.state!==null&&F.state!==void 0?F.state:null,zP(b),F.updater=c_,b.stateNode=F,F._reactInternals=b,FP(b,I,w,P),b=i3(null,b,I,!0,Z,P)):(b.tag=0,Rr&&Z&&UP(b),ga(null,b,F,P),b=b.child),b;case 16:I=b.elementType;e:{switch(w!==null&&(w.alternate=null,b.alternate=null,b.flags|=2),w=b.pendingProps,F=I._init,I=F(I._payload),b.type=I,F=b.tag=Yae(I),w=pa(I,w),F){case 0:b=t3(null,b,I,w,P);break e;case 1:b=y5(null,b,I,w,P);break e;case 11:b=f5(null,b,I,w,P);break e;case 14:b=p5(null,b,I,pa(I.type,w),P);break e}throw Error(a(306,I,""))}return b;case 0:return I=b.type,F=b.pendingProps,F=b.elementType===I?F:pa(I,F),t3(w,b,I,F,P);case 1:return I=b.type,F=b.pendingProps,F=b.elementType===I?F:pa(I,F),y5(w,b,I,F,P);case 3:e:{if(x5(b),w===null)throw Error(a(387));I=b.pendingProps,Z=b.memoizedState,F=Z.element,Tk(w,b),l_(b,I,null,P);var Se=b.memoizedState;if(I=Se.element,ve&&Z.isDehydrated)if(Z={element:I,isDehydrated:!1,cache:Se.cache,transitions:Se.transitions},b.updateQueue.baseState=Z,b.memoizedState=Z,b.flags&256){F=Error(a(423)),b=w5(w,b,I,P,F);break e}else if(I!==F){F=Error(a(424)),b=w5(w,b,I,P,F);break e}else for(ve&&(xo=Ge(b.stateNode.containerInfo),yo=b,Rr=!0,Ml=null,Ly=!1),P=kk(b,null,I,P),b.child=P;P;)P.flags=P.flags&-3|4096,P=P.sibling;else{if(og(),I===F){b=_u(w,b,P);break e}ga(w,b,I,P)}b=b.child}return b;case 5:return Vk(b),w===null&&VP(b),I=b.type,F=b.pendingProps,Z=w!==null?w.memoizedProps:null,Se=F.children,ee(I,F)?Se=null:Z!==null&&ee(I,Z)&&(b.flags|=32),v5(w,b),ga(w,b,Se,P),b.child;case 6:return w===null&&VP(b),null;case 13:return b5(w,b,P);case 4:return HP(b,b.stateNode.containerInfo),I=b.pendingProps,w===null?b.child=lg(b,null,I,P):ga(w,b,I,P),b.child;case 11:return I=b.type,F=b.pendingProps,F=b.elementType===I?F:pa(I,F),f5(w,b,I,F,P);case 7:return ga(w,b,b.pendingProps,P),b.child;case 8:return ga(w,b,b.pendingProps.children,P),b.child;case 12:return ga(w,b,b.pendingProps.children,P),b.child;case 10:e:{if(I=b.type._context,F=b.pendingProps,Z=b.memoizedProps,Se=F.value,a_(b,I,Se),Z!==null)if(go(Z.value,Se)){if(Z.children===F.children&&!Ee.current){b=_u(w,b,P);break e}}else for(Z=b.child,Z!==null&&(Z.return=b);Z!==null;){var Ve=Z.dependencies;if(Ve!==null){Se=Z.child;for(var ot=Ve.firstContext;ot!==null;){if(ot.context===I){if(Z.tag===1){ot=yu(-1,P&-P),ot.tag=2;var yt=Z.updateQueue;if(yt!==null){yt=yt.shared;var Ut=yt.pending;Ut===null?ot.next=ot:(ot.next=Ut.next,Ut.next=ot),yt.pending=ot}}Z.lanes|=P,ot=Z.alternate,ot!==null&&(ot.lanes|=P),ma(Z.return,P,b),Ve.lanes|=P;break}ot=ot.next}}else if(Z.tag===10)Se=Z.type===b.type?null:Z.child;else if(Z.tag===18){if(Se=Z.return,Se===null)throw Error(a(341));Se.lanes|=P,Ve=Se.alternate,Ve!==null&&(Ve.lanes|=P),ma(Se,P,b),Se=Z.sibling}else Se=Z.child;if(Se!==null)Se.return=Z;else for(Se=Z;Se!==null;){if(Se===b){Se=null;break}if(Z=Se.sibling,Z!==null){Z.return=Se.return,Se=Z;break}Se=Se.return}Z=Se}ga(w,b,F.children,P),b=b.child}return b;case 9:return F=b.type,I=b.pendingProps.children,nn(b,P),F=sn(F),I=I(F),b.flags|=1,ga(w,b,I,P),b.child;case 14:return I=b.type,F=pa(I,b.pendingProps),F=pa(I.type,F),p5(w,b,I,F,P);case 15:return m5(w,b,b.type,b.pendingProps,P);case 17:return I=b.type,F=b.pendingProps,F=b.elementType===I?F:pa(I,F),w!==null&&(w.alternate=null,b.alternate=null,b.flags|=2),b.tag=1,Di(I)?(w=!0,xr(b)):w=!1,nn(b,P),Ik(b,I,F),FP(b,I,F,P),i3(null,b,I,!0,w,P);case 19:return E5(w,b,P);case 22:return g5(w,b,P)}throw Error(a(156,b.tag))};function Q5(w,b){return vu(w,b)}function qae(w,b,P,I){this.tag=w,this.key=P,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=b,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=I,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function qo(w,b,P,I){return new qae(w,b,P,I)}function M3(w){return w=w.prototype,!(!w||!w.isReactComponent)}function Yae(w){if(typeof w=="function")return M3(w)?1:0;if(w!=null){if(w=w.$$typeof,w===v)return 11;if(w===y)return 14}return 2}function Zh(w,b){var P=w.alternate;return P===null?(P=qo(w.tag,b,w.key,w.mode),P.elementType=w.elementType,P.type=w.type,P.stateNode=w.stateNode,P.alternate=w,w.alternate=P):(P.pendingProps=b,P.type=w.type,P.flags=0,P.subtreeFlags=0,P.deletions=null),P.flags=w.flags&14680064,P.childLanes=w.childLanes,P.lanes=w.lanes,P.child=w.child,P.memoizedProps=w.memoizedProps,P.memoizedState=w.memoizedState,P.updateQueue=w.updateQueue,b=w.dependencies,P.dependencies=b===null?null:{lanes:b.lanes,firstContext:b.firstContext},P.sibling=w.sibling,P.index=w.index,P.ref=w.ref,P}function H_(w,b,P,I,F,Z){var Se=2;if(I=w,typeof w=="function")M3(w)&&(Se=1);else if(typeof w=="string")Se=5;else e:switch(w){case u:return Yf(P.children,F,Z,b);case h:Se=8,F|=8;break;case d:return w=qo(12,P,b,F|2),w.elementType=d,w.lanes=Z,w;case m:return w=qo(13,P,b,F),w.elementType=m,w.lanes=Z,w;case g:return w=qo(19,P,b,F),w.elementType=g,w.lanes=Z,w;case _:return j_(P,F,Z,b);default:if(typeof w=="object"&&w!==null)switch(w.$$typeof){case f:Se=10;break e;case p:Se=9;break e;case v:Se=11;break e;case y:Se=14;break e;case x:Se=16,I=null;break e}throw Error(a(130,w==null?w:typeof w,""))}return b=qo(Se,P,b,F),b.elementType=w,b.type=I,b.lanes=Z,b}function Yf(w,b,P,I){return w=qo(7,w,I,b),w.lanes=P,w}function j_(w,b,P,I){return w=qo(22,w,I,b),w.elementType=_,w.lanes=P,w.stateNode={},w}function E3(w,b,P){return w=qo(6,w,null,b),w.lanes=P,w}function A3(w,b,P){return b=qo(4,w.children!==null?w.children:[],w.key,b),b.lanes=P,b.stateNode={containerInfo:w.containerInfo,pendingChildren:null,implementation:w.implementation},b}function Qae(w,b,P,I,F){this.tag=b,this.containerInfo=w,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=pe,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=tg(0),this.expirationTimes=tg(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=tg(0),this.identifierPrefix=I,this.onRecoverableError=F,ve&&(this.mutableSourceEagerHydrationData=null)}function Z5(w,b,P,I,F,Z,Se,Ve,ot){return w=new Qae(w,b,P,Ve,ot),b===1?(b=1,Z===!0&&(b|=8)):b=0,Z=qo(3,null,null,b),w.current=Z,Z.stateNode=w,Z.memoizedState={element:I,isDehydrated:P,cache:null,transitions:null},zP(Z),w}function K5(w){if(!w)return ye;w=w._reactInternals;e:{if(C(w)!==w||w.tag!==1)throw Error(a(170));var b=w;do{switch(b.tag){case 3:b=b.stateNode.context;break e;case 1:if(Di(b.type)){b=b.stateNode.__reactInternalMemoizedMergedChildContext;break e}}b=b.return}while(b!==null);throw Error(a(171))}if(w.tag===1){var P=w.type;if(Di(P))return es(w,P,b)}return b}function J5(w){var b=w._reactInternals;if(b===void 0)throw typeof w.render=="function"?Error(a(188)):(w=Object.keys(w).join(","),Error(a(268,w)));return w=R(b),w===null?null:w.stateNode}function $5(w,b){if(w=w.memoizedState,w!==null&&w.dehydrated!==null){var P=w.retryLane;w.retryLane=P!==0&&P<b?P:b}}function T3(w,b){$5(w,b),(w=w.alternate)&&$5(w,b)}function Zae(w){return w=R(w),w===null?null:w.stateNode}function Kae(){return null}return i.attemptContinuousHydration=function(w){if(w.tag===13){var b=va();Xo(w,134217728,b),T3(w,134217728)}},i.attemptHydrationAtCurrentPriority=function(w){if(w.tag===13){var b=va(),P=Yh(w);Xo(w,P,b),T3(w,P)}},i.attemptSynchronousHydration=function(w){switch(w.tag){case 3:var b=w.stateNode;if(b.current.memoizedState.isDehydrated){var P=ws(b.pendingLanes);P!==0&&(mc(b,P|1),Ha(b,Br()),!(Ii&6)&&(pg(),Va()))}break;case 13:var I=va();V5(function(){return Xo(w,1,I)}),T3(w,1)}},i.batchedUpdates=function(w,b){var P=Ii;Ii|=1;try{return w(b)}finally{Ii=P,Ii===0&&(pg(),gc&&Va())}},i.createComponentSelector=function(w){return{$$typeof:P_,value:w}},i.createContainer=function(w,b,P,I,F,Z,Se){return Z5(w,b,!1,null,P,I,F,Z,Se)},i.createHasPseudoClassSelector=function(w){return{$$typeof:D_,value:w}},i.createHydrationContainer=function(w,b,P,I,F,Z,Se,Ve,ot){return w=Z5(P,I,!0,w,F,Z,Se,Ve,ot),w.context=K5(null),P=w.current,I=va(),F=Yh(P),Z=yu(I,F),Z.callback=b??null,Wh(P,Z),w.current.lanes=F,pc(w,F,I),Ha(w,I),w},i.createPortal=function(w,b,P){var I=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:c,key:I==null?null:""+I,children:w,containerInfo:b,implementation:P}},i.createRoleSelector=function(w){return{$$typeof:R_,value:w}},i.createTestNameSelector=function(w){return{$$typeof:I_,value:w}},i.createTextSelector=function(w){return{$$typeof:L_,value:w}},i.deferredUpdates=function(w){var b=Oi,P=an.transition;try{return an.transition=null,Oi=16,w()}finally{Oi=b,an.transition=P}},i.discreteUpdates=function(w,b,P,I,F){var Z=Oi,Se=an.transition;try{return an.transition=null,Oi=1,w(b,P,I,F)}finally{Oi=Z,an.transition=Se,Ii===0&&pg()}},i.findAllNodes=f3,i.findBoundingRects=function(w,b){if(!Fe)throw Error(a(363));b=f3(w,b),w=[];for(var P=0;P<b.length;P++)w.push(B(b[P]));for(b=w.length-1;0<b;b--){P=w[b];for(var I=P.x,F=I+P.width,Z=P.y,Se=Z+P.height,Ve=b-1;0<=Ve;Ve--)if(b!==Ve){var ot=w[Ve],yt=ot.x,Ut=yt+ot.width,_i=ot.y,ei=_i+ot.height;if(I>=yt&&Z>=_i&&F<=Ut&&Se<=ei){w.splice(b,1);break}else if(I!==yt||P.width!==ot.width||ei<Z||_i>Se){if(!(Z!==_i||P.height!==ot.height||Ut<I||yt>F)){yt>I&&(ot.width+=yt-I,ot.x=I),Ut<F&&(ot.width=F-yt),w.splice(b,1);break}}else{_i>Z&&(ot.height+=_i-Z,ot.y=Z),ei<Se&&(ot.height=Se-_i),w.splice(b,1);break}}}return w},i.findHostInstance=J5,i.findHostInstanceWithNoPortals=function(w){return w=D(w),w=w!==null?O(w):null,w===null?null:w.stateNode},i.findHostInstanceWithWarning=function(w){return J5(w)},i.flushControlled=function(w){var b=Ii;Ii|=1;var P=an.transition,I=Oi;try{an.transition=null,Oi=1,w()}finally{Oi=I,an.transition=P,Ii=b,Ii===0&&(pg(),Va())}},i.flushPassiveEffects=qf,i.flushSync=V5,i.focusWithin=function(w,b){if(!Fe)throw Error(a(363));for(w=u3(w),b=U5(w,b),b=Array.from(b),w=0;w<b.length;){var P=b[w++];if(!oe(P)){if(P.tag===5&&W(P.stateNode))return!0;for(P=P.child;P!==null;)b.push(P),P=P.sibling}}return!1},i.getCurrentUpdatePriority=function(){return Oi},i.getFindAllNodesFailureDescription=function(w,b){if(!Fe)throw Error(a(363));var P=0,I=[];w=[u3(w),0];for(var F=0;F<w.length;){var Z=w[F++],Se=w[F++],Ve=b[Se];if((Z.tag!==5||!oe(Z))&&(h3(Z,Ve)&&(I.push(d3(Ve)),Se++,Se>P&&(P=Se)),Se<b.length))for(Z=Z.child;Z!==null;)w.push(Z,Se),Z=Z.sibling}if(P<b.length){for(w=[];P<b.length;P++)w.push(d3(b[P]));return`findAllNodes was able to match part of the selector:
  `+(I.join(" > ")+`

No matching component was found for:
  `)+w.join(" > ")}return null},i.getPublicRootInstance=function(w){if(w=w.current,!w.child)return null;switch(w.child.tag){case 5:return j(w.child.stateNode);default:return w.child.stateNode}},i.injectIntoDevTools=function(w){if(w={bundleType:w.bundleType,version:w.version,rendererPackageName:w.rendererPackageName,rendererConfig:w.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:o.ReactCurrentDispatcher,findHostInstanceByFiber:Zae,findFiberByHostInstance:w.findFiberByHostInstance||Kae,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.0.0-fc46dba67-20220329"},typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u")w=!1;else{var b=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(b.isDisabled||!b.supportsFiber)w=!0;else{try{Bf=b.inject(w),mo=b}catch{}w=!!b.checkDCE}}return w},i.isAlreadyRendering=function(){return!1},i.observeVisibleRects=function(w,b,P,I){if(!Fe)throw Error(a(363));w=f3(w,b);var F=Ie(w,P,I).disconnect;return{disconnect:function(){F()}}},i.registerMutableSourceForHydration=function(w,b){var P=b._getVersion;P=P(b._source),w.mutableSourceEagerHydrationData==null?w.mutableSourceEagerHydrationData=[b,P]:w.mutableSourceEagerHydrationData.push(b,P)},i.runWithPriority=function(w,b){var P=Oi;try{return Oi=w,b()}finally{Oi=P}},i.shouldError=function(){return null},i.shouldSuspend=function(){return!1},i.updateContainer=function(w,b,P,I){var F=b.current,Z=va(),Se=Yh(F);return P=K5(P),b.context===null?b.context=P:b.pendingContext=P,b=yu(Z,Se),b.payload={element:w},I=I===void 0?null:I,I!==null&&(b.callback=I),Wh(F,b),w=Xo(F,Se,Z),w!==null&&o_(w,F,Se),Se},i};Hse.exports=MXe;var EXe=Hse.exports;const AXe=gF(EXe);var jse={exports:{}},Wse={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(z,V){var U=z.length;z.push(V);e:for(;0<U;){var k=U-1>>>1,X=z[k];if(0<n(X,V))z[k]=V,z[U]=X,U=k;else break e}}function i(z){return z.length===0?null:z[0]}function r(z){if(z.length===0)return null;var V=z[0],U=z.pop();if(U!==V){z[0]=U;e:for(var k=0,X=z.length,re=X>>>1;k<re;){var q=2*(k+1)-1,ee=z[q],$=q+1,ne=z[$];if(0>n(ee,U))$<X&&0>n(ne,ee)?(z[k]=ne,z[$]=U,k=$):(z[k]=ee,z[q]=U,k=q);else if($<X&&0>n(ne,U))z[k]=ne,z[$]=U,k=$;else break e}}return V}function n(z,V){var U=z.sortIndex-V.sortIndex;return U!==0?U:z.id-V.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;e.unstable_now=function(){return s.now()}}else{var a=Date,o=a.now();e.unstable_now=function(){return a.now()-o}}var l=[],c=[],u=1,h=null,d=3,f=!1,p=!1,v=!1,m=typeof setTimeout=="function"?setTimeout:null,g=typeof clearTimeout=="function"?clearTimeout:null,y=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function x(z){for(var V=i(c);V!==null;){if(V.callback===null)r(c);else if(V.startTime<=z)r(c),V.sortIndex=V.expirationTime,t(l,V);else break;V=i(c)}}function _(z){if(v=!1,x(z),!p)if(i(l)!==null)p=!0,j(M);else{var V=i(c);V!==null&&Y(_,V.startTime-z)}}function M(z,V){p=!1,v&&(v=!1,g(E),E=-1),f=!0;var U=d;try{for(x(V),h=i(l);h!==null&&(!(h.expirationTime>V)||z&&!D());){var k=h.callback;if(typeof k=="function"){h.callback=null,d=h.priorityLevel;var X=k(h.expirationTime<=V);V=e.unstable_now(),typeof X=="function"?h.callback=X:h===i(l)&&r(l),x(V)}else r(l);h=i(l)}if(h!==null)var re=!0;else{var q=i(c);q!==null&&Y(_,q.startTime-V),re=!1}return re}finally{h=null,d=U,f=!1}}var S=!1,T=null,E=-1,C=5,A=-1;function D(){return!(e.unstable_now()-A<C)}function R(){if(T!==null){var z=e.unstable_now();A=z;var V=!0;try{V=T(!0,z)}finally{V?L():(S=!1,T=null)}}else S=!1}var L;if(typeof y=="function")L=function(){y(R)};else if(typeof MessageChannel<"u"){var O=new MessageChannel,H=O.port2;O.port1.onmessage=R,L=function(){H.postMessage(null)}}else L=function(){m(R,0)};function j(z){T=z,S||(S=!0,L())}function Y(z,V){E=m(function(){z(e.unstable_now())},V)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(z){z.callback=null},e.unstable_continueExecution=function(){p||f||(p=!0,j(M))},e.unstable_forceFrameRate=function(z){0>z||125<z?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):C=0<z?Math.floor(1e3/z):5},e.unstable_getCurrentPriorityLevel=function(){return d},e.unstable_getFirstCallbackNode=function(){return i(l)},e.unstable_next=function(z){switch(d){case 1:case 2:case 3:var V=3;break;default:V=d}var U=d;d=V;try{return z()}finally{d=U}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(z,V){switch(z){case 1:case 2:case 3:case 4:case 5:break;default:z=3}var U=d;d=z;try{return V()}finally{d=U}},e.unstable_scheduleCallback=function(z,V,U){var k=e.unstable_now();switch(typeof U=="object"&&U!==null?(U=U.delay,U=typeof U=="number"&&0<U?k+U:k):U=k,z){case 1:var X=-1;break;case 2:X=250;break;case 5:X=1073741823;break;case 4:X=1e4;break;default:X=5e3}return X=U+X,z={id:u++,callback:V,priorityLevel:z,startTime:U,expirationTime:X,sortIndex:-1},U>k?(z.sortIndex=U,t(c,z),i(l)===null&&z===i(c)&&(v?(g(E),E=-1):v=!0,Y(_,U-k))):(z.sortIndex=X,t(l,z),p||f||(p=!0,j(M))),z},e.unstable_shouldYield=D,e.unstable_wrapCallback=function(z){var V=d;return function(){var U=d;d=V;try{return z.apply(this,arguments)}finally{d=U}}}})(Wse);jse.exports=Wse;var Vq=jse.exports;const Mk={},TXe=e=>void Object.assign(Mk,e);function CXe(e,t){function i(u,{args:h=[],attach:d,...f},p){let v=`${u[0].toUpperCase()}${u.slice(1)}`,m;if(u==="primitive"){if(f.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const g=f.object;m=_v(g,{type:u,root:p,attach:d,primitive:!0})}else{const g=Mk[v];if(!g)throw new Error(`R3F: ${v} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(h))throw new Error("R3F: The args prop must be an array!");m=_v(new g(...h),{type:u,root:p,attach:d,memoizedProps:{args:h}})}return m.__r3f.attach===void 0&&(m.isBufferGeometry?m.__r3f.attach="geometry":m.isMaterial&&(m.__r3f.attach="material")),v!=="inject"&&yL(m,f),m}function r(u,h){let d=!1;if(h){var f,p;(f=h.__r3f)!=null&&f.attach?vL(u,h,h.__r3f.attach):h.isObject3D&&u.isObject3D&&(u.add(h),d=!0),d||(p=u.__r3f)==null||p.objects.push(h),h.__r3f||_v(h,{}),h.__r3f.parent=u,hF(h),Sv(h)}}function n(u,h,d){let f=!1;if(h){var p,v;if((p=h.__r3f)!=null&&p.attach)vL(u,h,h.__r3f.attach);else if(h.isObject3D&&u.isObject3D){h.parent=u,h.dispatchEvent({type:"added"}),u.dispatchEvent({type:"childadded",child:h});const m=u.children.filter(y=>y!==h),g=m.indexOf(d);u.children=[...m.slice(0,g),h,...m.slice(g)],f=!0}f||(v=u.__r3f)==null||v.objects.push(h),h.__r3f||_v(h,{}),h.__r3f.parent=u,hF(h),Sv(h)}}function s(u,h,d=!1){u&&[...u].forEach(f=>a(h,f,d))}function a(u,h,d){if(h){var f,p,v;if(h.__r3f&&(h.__r3f.parent=null),(f=u.__r3f)!=null&&f.objects&&(u.__r3f.objects=u.__r3f.objects.filter(_=>_!==h)),(p=h.__r3f)!=null&&p.attach)Xq(u,h,h.__r3f.attach);else if(h.isObject3D&&u.isObject3D){var m;u.remove(h),(m=h.__r3f)!=null&&m.root&&BXe(w2(h),h)}const y=(v=h.__r3f)==null?void 0:v.primitive,x=!y&&(d===void 0?h.dispose!==null:d);if(!y){var g;s((g=h.__r3f)==null?void 0:g.objects,h,x),s(h.children,h,x)}if(delete h.__r3f,x&&h.dispose&&h.type!=="Scene"){const _=()=>{try{h.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT>"u"?Vq.unstable_scheduleCallback(Vq.unstable_IdlePriority,_):_()}Sv(u)}}function o(u,h,d,f){var p;const v=(p=u.__r3f)==null?void 0:p.parent;if(!v)return;const m=i(h,d,u.__r3f.root);if(u.children){for(const g of u.children)g.__r3f&&r(m,g);u.children=u.children.filter(g=>!g.__r3f)}u.__r3f.objects.forEach(g=>r(m,g)),u.__r3f.objects=[],u.__r3f.autoRemovedBeforeAppend||a(v,u),m.parent&&(m.__r3f.autoRemovedBeforeAppend=!0),r(v,m),m.raycast&&m.__r3f.eventCount&&w2(m).getState().internal.interaction.push(m),[f,f.alternate].forEach(g=>{g!==null&&(g.stateNode=m,g.ref&&(typeof g.ref=="function"?g.ref(m):g.ref.current=m))})}const l=()=>{};return{reconciler:AXe({createInstance:i,removeChild:a,appendChild:r,appendInitialChild:r,insertBefore:n,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(u,h)=>{if(!h)return;const d=u.getState().scene;d.__r3f&&(d.__r3f.root=u,r(d,h))},removeChildFromContainer:(u,h)=>{h&&a(u.getState().scene,h)},insertInContainerBefore:(u,h,d)=>{if(!h||!d)return;const f=u.getState().scene;f.__r3f&&n(f,h,d)},getRootHostContext:()=>null,getChildHostContext:u=>u,finalizeInitialChildren(u){var h;return!!((h=u==null?void 0:u.__r3f)!=null?h:{}).handlers},prepareUpdate(u,h,d,f){var p;if(((p=u==null?void 0:u.__r3f)!=null?p:{}).primitive&&f.object&&f.object!==u)return[!0];{const{args:m=[],children:g,...y}=f,{args:x=[],children:_,...M}=d;if(!Array.isArray(m))throw new Error("R3F: the args prop must be an array!");if(m.some((T,E)=>T!==x[E]))return[!0];const S=Jse(u,y,M,!0);return S.changes.length?[!1,S]:null}},commitUpdate(u,[h,d],f,p,v,m){h?o(u,f,v,m):yL(u,d)},commitMount(u,h,d,f){var p;const v=(p=u.__r3f)!=null?p:{};u.raycast&&v.handlers&&v.eventCount&&w2(u).getState().internal.interaction.push(u)},getPublicInstance:u=>u,prepareForCommit:()=>null,preparePortalMount:u=>_v(u.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(u){var h;const{attach:d,parent:f}=(h=u.__r3f)!=null?h:{};d&&f&&Xq(f,u,d),u.isObject3D&&(u.visible=!1),Sv(u)},unhideInstance(u,h){var d;const{attach:f,parent:p}=(d=u.__r3f)!=null?d:{};f&&p&&vL(p,u,f),(u.isObject3D&&h.visible==null||h.visible)&&(u.visible=!0),Sv(u)},createTextInstance:l,hideTextInstance:l,unhideTextInstance:l,getCurrentEventPriority:()=>t?t():e0.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&Ar.fun(performance.now)?performance.now:Ar.fun(Date.now)?Date.now:()=>0,scheduleTimeout:Ar.fun(setTimeout)?setTimeout:void 0,cancelTimeout:Ar.fun(clearTimeout)?clearTimeout:void 0}),applyProps:yL}}var Gq,Hq;const gL=e=>"colorSpace"in e||"outputColorSpace"in e,Xse=()=>{var e;return(e=Mk.ColorManagement)!=null?e:null},qse=e=>e&&e.isOrthographicCamera,PXe=e=>e&&e.hasOwnProperty("current"),t_=typeof window<"u"&&((Gq=window.document)!=null&&Gq.createElement||((Hq=window.navigator)==null?void 0:Hq.product)==="ReactNative")?_e.useLayoutEffect:_e.useEffect;function Yse(e){const t=_e.useRef(e);return t_(()=>void(t.current=e),[e]),t}function DXe({set:e}){return t_(()=>(e(new Promise(()=>null)),()=>e(!1)),[e]),null}class Qse extends _e.Component{constructor(...t){super(...t),this.state={error:!1}}componentDidCatch(t){this.props.set(t)}render(){return this.state.error?null:this.props.children}}Qse.getDerivedStateFromError=()=>({error:!0});const Zse="__default",jq=new Map,RXe=e=>e&&!!e.memoized&&!!e.changes;function Kse(e){var t;const i=typeof window<"u"?(t=window.devicePixelRatio)!=null?t:2:1;return Array.isArray(e)?Math.min(Math.max(e[0],i),e[1]):e}const q1=e=>{var t;return(t=e.__r3f)==null?void 0:t.root.getState()};function w2(e){let t=e.__r3f.root;for(;t.getState().previousRoot;)t=t.getState().previousRoot;return t}const Ar={obj:e=>e===Object(e)&&!Ar.arr(e)&&typeof e!="function",fun:e=>typeof e=="function",str:e=>typeof e=="string",num:e=>typeof e=="number",boo:e=>typeof e=="boolean",und:e=>e===void 0,arr:e=>Array.isArray(e),equ(e,t,{arrays:i="shallow",objects:r="reference",strict:n=!0}={}){if(typeof e!=typeof t||!!e!=!!t)return!1;if(Ar.str(e)||Ar.num(e)||Ar.boo(e))return e===t;const s=Ar.obj(e);if(s&&r==="reference")return e===t;const a=Ar.arr(e);if(a&&i==="reference")return e===t;if((a||s)&&e===t)return!0;let o;for(o in e)if(!(o in t))return!1;if(s&&i==="shallow"&&r==="shallow"){for(o in n?t:e)if(!Ar.equ(e[o],t[o],{strict:n,objects:"reference"}))return!1}else for(o in n?t:e)if(e[o]!==t[o])return!1;if(Ar.und(o)){if(a&&e.length===0&&t.length===0||s&&Object.keys(e).length===0&&Object.keys(t).length===0)return!0;if(e!==t)return!1}return!0}};function IXe(e){e.dispose&&e.type!=="Scene"&&e.dispose();for(const t in e)t.dispose==null||t.dispose(),delete e[t]}function _v(e,t){const i=e;return i.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...t},e}function uF(e,t){let i=e;if(t.includes("-")){const r=t.split("-"),n=r.pop();return i=r.reduce((s,a)=>s[a],e),{target:i,key:n}}else return{target:i,key:t}}const Wq=/-\d+$/;function vL(e,t,i){if(Ar.str(i)){if(Wq.test(i)){const s=i.replace(Wq,""),{target:a,key:o}=uF(e,s);Array.isArray(a[o])||(a[o]=[])}const{target:r,key:n}=uF(e,i);t.__r3f.previousAttach=r[n],r[n]=t}else t.__r3f.previousAttach=i(e,t)}function Xq(e,t,i){var r,n;if(Ar.str(i)){const{target:s,key:a}=uF(e,i),o=t.__r3f.previousAttach;o===void 0?delete s[a]:s[a]=o}else(r=t.__r3f)==null||r.previousAttach==null||r.previousAttach(e,t);(n=t.__r3f)==null||delete n.previousAttach}function Jse(e,{children:t,key:i,ref:r,...n},{children:s,key:a,ref:o,...l}={},c=!1){const u=e.__r3f,h=Object.entries(n),d=[];if(c){const p=Object.keys(l);for(let v=0;v<p.length;v++)n.hasOwnProperty(p[v])||h.unshift([p[v],Zse+"remove"])}h.forEach(([p,v])=>{var m;if((m=e.__r3f)!=null&&m.primitive&&p==="object"||Ar.equ(v,l[p]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(p))return d.push([p,v,!0,[]]);let g=[];p.includes("-")&&(g=p.split("-")),d.push([p,v,!1,g]);for(const y in n){const x=n[y];y.startsWith(`${p}-`)&&d.push([y,x,!1,y.split("-")])}});const f={...n};return u!=null&&u.memoizedProps&&u!=null&&u.memoizedProps.args&&(f.args=u.memoizedProps.args),u!=null&&u.memoizedProps&&u!=null&&u.memoizedProps.attach&&(f.attach=u.memoizedProps.attach),{memoized:f,changes:d}}const LXe=typeof process<"u"&&!1;function yL(e,t){var i;const r=e.__r3f,n=r==null?void 0:r.root,s=n==null||n.getState==null?void 0:n.getState(),{memoized:a,changes:o}=RXe(t)?t:Jse(e,t),l=r==null?void 0:r.eventCount;e.__r3f&&(e.__r3f.memoizedProps=a);for(let d=0;d<o.length;d++){let[f,p,v,m]=o[d];if(gL(e)){const _="srgb",M="srgb-linear";f==="encoding"?(f="colorSpace",p=p===3001?_:M):f==="outputEncoding"&&(f="outputColorSpace",p=p===3001?_:M)}let g=e,y=g[f];if(m.length&&(y=m.reduce((x,_)=>x[_],e),!(y&&y.set))){const[x,..._]=m.reverse();g=_.reverse().reduce((M,S)=>M[S],e),f=x}if(p===Zse+"remove")if(g.constructor){let x=jq.get(g.constructor);x||(x=new g.constructor,jq.set(g.constructor,x)),p=x[f]}else p=0;if(v&&r)p?r.handlers[f]=p:delete r.handlers[f],r.eventCount=Object.keys(r.handlers).length;else if(y&&y.set&&(y.copy||y instanceof pm)){if(Array.isArray(p))y.fromArray?y.fromArray(p):y.set(...p);else if(y.copy&&p&&p.constructor&&(LXe?y.constructor.name===p.constructor.name:y.constructor===p.constructor))y.copy(p);else if(p!==void 0){var c;const x=(c=y)==null?void 0:c.isColor;!x&&y.setScalar?y.setScalar(p):y instanceof pm&&p instanceof pm?y.mask=p.mask:y.set(p),!Xse()&&s&&!s.linear&&x&&y.convertSRGBToLinear()}}else{var u;if(g[f]=p,(u=g[f])!=null&&u.isTexture&&g[f].format===sa&&g[f].type===lc&&s){const x=g[f];gL(x)&&gL(s.gl)?x.colorSpace=s.gl.outputColorSpace:x.encoding=s.gl.outputEncoding}}Sv(e)}if(r&&r.parent&&e.raycast&&l!==r.eventCount){const d=w2(e).getState().internal,f=d.interaction.indexOf(e);f>-1&&d.interaction.splice(f,1),r.eventCount&&d.interaction.push(e)}return!(o.length===1&&o[0][0]==="onUpdate")&&o.length&&(i=e.__r3f)!=null&&i.parent&&hF(e),e}function Sv(e){var t,i;const r=(t=e.__r3f)==null||(i=t.root)==null||i.getState==null?void 0:i.getState();r&&r.internal.frames===0&&r.invalidate()}function hF(e){e.onUpdate==null||e.onUpdate(e)}function OXe(e,t){e.manual||(qse(e)?(e.left=t.width/-2,e.right=t.width/2,e.top=t.height/2,e.bottom=t.height/-2):e.aspect=t.width/t.height,e.updateProjectionMatrix(),e.updateMatrixWorld())}function RE(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function zXe(){var e;const t=typeof self<"u"&&self||typeof window<"u"&&window;if(!t)return e0.DefaultEventPriority;switch((e=t.event)==null?void 0:e.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return e0.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return e0.ContinuousEventPriority;default:return e0.DefaultEventPriority}}function $se(e,t,i,r){const n=i.get(t);n&&(i.delete(t),i.size===0&&(e.delete(r),n.target.releasePointerCapture(r)))}function BXe(e,t){const{internal:i}=e.getState();i.interaction=i.interaction.filter(r=>r!==t),i.initialHits=i.initialHits.filter(r=>r!==t),i.hovered.forEach((r,n)=>{(r.eventObject===t||r.object===t)&&i.hovered.delete(n)}),i.capturedMap.forEach((r,n)=>{$se(i.capturedMap,t,r,n)})}function FXe(e){function t(l){const{internal:c}=e.getState(),u=l.offsetX-c.initialClick[0],h=l.offsetY-c.initialClick[1];return Math.round(Math.sqrt(u*u+h*h))}function i(l){return l.filter(c=>["Move","Over","Enter","Out","Leave"].some(u=>{var h;return(h=c.__r3f)==null?void 0:h.handlers["onPointer"+u]}))}function r(l,c){const u=e.getState(),h=new Set,d=[],f=c?c(u.internal.interaction):u.internal.interaction;for(let g=0;g<f.length;g++){const y=q1(f[g]);y&&(y.raycaster.camera=void 0)}u.previousRoot||u.events.compute==null||u.events.compute(l,u);function p(g){const y=q1(g);if(!y||!y.events.enabled||y.raycaster.camera===null)return[];if(y.raycaster.camera===void 0){var x;y.events.compute==null||y.events.compute(l,y,(x=y.previousRoot)==null?void 0:x.getState()),y.raycaster.camera===void 0&&(y.raycaster.camera=null)}return y.raycaster.camera?y.raycaster.intersectObject(g,!0):[]}let v=f.flatMap(p).sort((g,y)=>{const x=q1(g.object),_=q1(y.object);return!x||!_?g.distance-y.distance:_.events.priority-x.events.priority||g.distance-y.distance}).filter(g=>{const y=RE(g);return h.has(y)?!1:(h.add(y),!0)});u.events.filter&&(v=u.events.filter(v,u));for(const g of v){let y=g.object;for(;y;){var m;(m=y.__r3f)!=null&&m.eventCount&&d.push({...g,eventObject:y}),y=y.parent}}if("pointerId"in l&&u.internal.capturedMap.has(l.pointerId))for(let g of u.internal.capturedMap.get(l.pointerId).values())h.has(RE(g.intersection))||d.push(g.intersection);return d}function n(l,c,u,h){const d=e.getState();if(l.length){const f={stopped:!1};for(const p of l){const v=q1(p.object)||d,{raycaster:m,pointer:g,camera:y,internal:x}=v,_=new he(g.x,g.y,0).unproject(y),M=A=>{var D,R;return(D=(R=x.capturedMap.get(A))==null?void 0:R.has(p.eventObject))!=null?D:!1},S=A=>{const D={intersection:p,target:c.target};x.capturedMap.has(A)?x.capturedMap.get(A).set(p.eventObject,D):x.capturedMap.set(A,new Map([[p.eventObject,D]])),c.target.setPointerCapture(A)},T=A=>{const D=x.capturedMap.get(A);D&&$se(x.capturedMap,p.eventObject,D,A)};let E={};for(let A in c){let D=c[A];typeof D!="function"&&(E[A]=D)}let C={...p,...E,pointer:g,intersections:l,stopped:f.stopped,delta:u,unprojectedPoint:_,ray:m.ray,camera:y,stopPropagation(){const A="pointerId"in c&&x.capturedMap.get(c.pointerId);if((!A||A.has(p.eventObject))&&(C.stopped=f.stopped=!0,x.hovered.size&&Array.from(x.hovered.values()).find(D=>D.eventObject===p.eventObject))){const D=l.slice(0,l.indexOf(p));s([...D,p])}},target:{hasPointerCapture:M,setPointerCapture:S,releasePointerCapture:T},currentTarget:{hasPointerCapture:M,setPointerCapture:S,releasePointerCapture:T},nativeEvent:c};if(h(C),f.stopped===!0)break}}return l}function s(l){const{internal:c}=e.getState();for(const u of c.hovered.values())if(!l.length||!l.find(h=>h.object===u.object&&h.index===u.index&&h.instanceId===u.instanceId)){const d=u.eventObject.__r3f,f=d==null?void 0:d.handlers;if(c.hovered.delete(RE(u)),d!=null&&d.eventCount){const p={...u,intersections:l};f.onPointerOut==null||f.onPointerOut(p),f.onPointerLeave==null||f.onPointerLeave(p)}}}function a(l,c){for(let u=0;u<c.length;u++){const h=c[u].__r3f;h==null||h.handlers.onPointerMissed==null||h.handlers.onPointerMissed(l)}}function o(l){switch(l){case"onPointerLeave":case"onPointerCancel":return()=>s([]);case"onLostPointerCapture":return c=>{const{internal:u}=e.getState();"pointerId"in c&&u.capturedMap.has(c.pointerId)&&requestAnimationFrame(()=>{u.capturedMap.has(c.pointerId)&&(u.capturedMap.delete(c.pointerId),s([]))})}}return function(u){const{onPointerMissed:h,internal:d}=e.getState();d.lastEvent.current=u;const f=l==="onPointerMove",p=l==="onClick"||l==="onContextMenu"||l==="onDoubleClick",m=r(u,f?i:void 0),g=p?t(u):0;l==="onPointerDown"&&(d.initialClick=[u.offsetX,u.offsetY],d.initialHits=m.map(x=>x.eventObject)),p&&!m.length&&g<=2&&(a(u,d.interaction),h&&h(u)),f&&s(m);function y(x){const _=x.eventObject,M=_.__r3f,S=M==null?void 0:M.handlers;if(M!=null&&M.eventCount)if(f){if(S.onPointerOver||S.onPointerEnter||S.onPointerOut||S.onPointerLeave){const T=RE(x),E=d.hovered.get(T);E?E.stopped&&x.stopPropagation():(d.hovered.set(T,x),S.onPointerOver==null||S.onPointerOver(x),S.onPointerEnter==null||S.onPointerEnter(x))}S.onPointerMove==null||S.onPointerMove(x)}else{const T=S[l];T?(!p||d.initialHits.includes(_))&&(a(u,d.interaction.filter(E=>!d.initialHits.includes(E))),T(x)):p&&d.initialHits.includes(_)&&a(u,d.interaction.filter(E=>!d.initialHits.includes(E)))}}n(m,u,g,y)}}return{handlePointer:o}}const eae=e=>!!(e!=null&&e.render),tae=_e.createContext(null),UXe=(e,t)=>{const i=vXe((o,l)=>{const c=new he,u=new he,h=new he;function d(g=l().camera,y=u,x=l().size){const{width:_,height:M,top:S,left:T}=x,E=_/M;y.isVector3?h.copy(y):h.set(...y);const C=g.getWorldPosition(c).distanceTo(h);if(qse(g))return{width:_/g.zoom,height:M/g.zoom,top:S,left:T,factor:1,distance:C,aspect:E};{const A=g.fov*Math.PI/180,D=2*Math.tan(A/2)*C,R=D*(_/M);return{width:R,height:D,top:S,left:T,factor:_/R,distance:C,aspect:E}}}let f;const p=g=>o(y=>({performance:{...y.performance,current:g}})),v=new ut;return{set:o,get:l,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(g=1)=>e(l(),g),advance:(g,y)=>t(g,y,l()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new yk,pointer:v,mouse:v,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const g=l();f&&clearTimeout(f),g.performance.current!==g.performance.min&&p(g.performance.min),f=setTimeout(()=>p(l().performance.max),g.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:d},setEvents:g=>o(y=>({...y,events:{...y.events,...g}})),setSize:(g,y,x,_,M)=>{const S=l().camera,T={width:g,height:y,top:_||0,left:M||0,updateStyle:x};o(E=>({size:T,viewport:{...E.viewport,...d(S,u,T)}}))},setDpr:g=>o(y=>{const x=Kse(g);return{viewport:{...y.viewport,dpr:x,initialDpr:y.viewport.initialDpr||x}}}),setFrameloop:(g="always")=>{const y=l().clock;y.stop(),y.elapsedTime=0,g!=="never"&&(y.start(),y.elapsedTime=0),o(()=>({frameloop:g}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:_e.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(g,y,x)=>{const _=l().internal;return _.priority=_.priority+(y>0?1:0),_.subscribers.push({ref:g,priority:y,store:x}),_.subscribers=_.subscribers.sort((M,S)=>M.priority-S.priority),()=>{const M=l().internal;M!=null&&M.subscribers&&(M.priority=M.priority-(y>0?1:0),M.subscribers=M.subscribers.filter(S=>S.ref!==g))}}}}}),r=i.getState();let n=r.size,s=r.viewport.dpr,a=r.camera;return i.subscribe(()=>{const{camera:o,size:l,viewport:c,gl:u,set:h}=i.getState();if(l.width!==n.width||l.height!==n.height||c.dpr!==s){var d;n=l,s=c.dpr,OXe(o,l),u.setPixelRatio(c.dpr);const f=(d=l.updateStyle)!=null?d:typeof HTMLCanvasElement<"u"&&u.domElement instanceof HTMLCanvasElement;u.setSize(l.width,l.height,f)}o!==a&&(a=o,h(f=>({viewport:{...f.viewport,...f.viewport.getCurrentViewport(o)}})))}),i.subscribe(o=>e(o)),i};let IE,NXe=new Set,kXe=new Set,VXe=new Set;function xL(e,t){if(e.size)for(const{callback:i}of e.values())i(t)}function Y1(e,t){switch(e){case"before":return xL(NXe,t);case"after":return xL(kXe,t);case"tail":return xL(VXe,t)}}let wL,bL;function _L(e,t,i){let r=t.clock.getDelta();for(t.frameloop==="never"&&typeof e=="number"&&(r=e-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=e),wL=t.internal.subscribers,IE=0;IE<wL.length;IE++)bL=wL[IE],bL.ref.current(bL.store.getState(),r,i);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),t.frameloop==="always"?1:t.internal.frames}function GXe(e){let t=!1,i=!1,r,n,s;function a(c){n=requestAnimationFrame(a),t=!0,r=0,Y1("before",c),i=!0;for(const h of e.values()){var u;s=h.store.getState(),s.internal.active&&(s.frameloop==="always"||s.internal.frames>0)&&!((u=s.gl.xr)!=null&&u.isPresenting)&&(r+=_L(c,s))}if(i=!1,Y1("after",c),r===0)return Y1("tail",c),t=!1,cancelAnimationFrame(n)}function o(c,u=1){var h;if(!c)return e.forEach(d=>o(d.store.getState(),u));(h=c.gl.xr)!=null&&h.isPresenting||!c.internal.active||c.frameloop==="never"||(u>1?c.internal.frames=Math.min(60,c.internal.frames+u):i?c.internal.frames=2:c.internal.frames=1,t||(t=!0,requestAnimationFrame(a)))}function l(c,u=!0,h,d){if(u&&Y1("before",c),h)_L(c,h,d);else for(const f of e.values())_L(c,f.store.getState());u&&Y1("after",c)}return{loop:a,invalidate:o,advance:l}}function iae(){const e=_e.useContext(tae);if(!e)throw new Error("R3F: Hooks can only be used within the Canvas component!");return e}function Wu(e=i=>i,t){return iae()(e,t)}function LP(e,t=0){const i=iae(),r=i.getState().internal.subscribe,n=Yse(e);return t_(()=>r(n,t,i),[t,r,i]),null}const Z0=new Map,{invalidate:qq,advance:Yq}=GXe(Z0),{reconciler:$T,applyProps:dv}=CXe(Z0,zXe),fv={objects:"shallow",strict:!1},HXe=(e,t)=>{const i=typeof e=="function"?e(t):e;return eae(i)?i:new Vse({powerPreference:"high-performance",canvas:t,antialias:!0,alpha:!0,...e})};function jXe(e,t){const i=typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement;if(t){const{width:r,height:n,top:s,left:a,updateStyle:o=i}=t;return{width:r,height:n,top:s,left:a,updateStyle:o}}else if(typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&e.parentElement){const{width:r,height:n,top:s,left:a}=e.parentElement.getBoundingClientRect();return{width:r,height:n,top:s,left:a,updateStyle:i}}else if(typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height,top:0,left:0,updateStyle:i};return{width:0,height:0,top:0,left:0}}function WXe(e){const t=Z0.get(e),i=t==null?void 0:t.fiber,r=t==null?void 0:t.store;t&&console.warn("R3F.createRoot should only be called once!");const n=typeof reportError=="function"?reportError:console.error,s=r||UXe(qq,Yq),a=i||$T.createContainer(s,e0.ConcurrentRoot,null,!1,null,"",n,null);t||Z0.set(e,{fiber:a,store:s});let o,l=!1,c;return{configure(u={}){let{gl:h,size:d,scene:f,events:p,onCreated:v,shadows:m=!1,linear:g=!1,flat:y=!1,legacy:x=!1,orthographic:_=!1,frameloop:M="always",dpr:S=[1,2],performance:T,raycaster:E,camera:C,onPointerMissed:A}=u,D=s.getState(),R=D.gl;D.gl||D.set({gl:R=HXe(h,e)});let L=D.raycaster;L||D.set({raycaster:L=new Lse});const{params:O,...H}=E||{};if(Ar.equ(H,L,fv)||dv(L,{...H}),Ar.equ(O,L.params,fv)||dv(L,{params:{...L.params,...O}}),!D.camera||D.camera===c&&!Ar.equ(c,C,fv)){c=C;const U=C instanceof qb,k=U?C:_?new hf(0,0,0,0,.1,1e3):new fn(75,0,.1,1e3);U||(k.position.z=5,C&&(dv(k,C),("aspect"in C||"left"in C||"right"in C||"bottom"in C||"top"in C)&&(k.manual=!0,k.updateProjectionMatrix())),!D.camera&&!(C!=null&&C.rotation)&&k.lookAt(0,0,0)),D.set({camera:k}),L.camera=k}if(!D.scene){let U;f!=null&&f.isScene?U=f:(U=new J4,f&&dv(U,f)),D.set({scene:_v(U)})}if(!D.xr){var j;const U=(re,q)=>{const ee=s.getState();ee.frameloop!=="never"&&Yq(re,!0,ee,q)},k=()=>{const re=s.getState();re.gl.xr.enabled=re.gl.xr.isPresenting,re.gl.xr.setAnimationLoop(re.gl.xr.isPresenting?U:null),re.gl.xr.isPresenting||qq(re)},X={connect(){const re=s.getState().gl;re.xr.addEventListener("sessionstart",k),re.xr.addEventListener("sessionend",k)},disconnect(){const re=s.getState().gl;re.xr.removeEventListener("sessionstart",k),re.xr.removeEventListener("sessionend",k)}};typeof((j=R.xr)==null?void 0:j.addEventListener)=="function"&&X.connect(),D.set({xr:X})}if(R.shadowMap){const U=R.shadowMap.enabled,k=R.shadowMap.type;if(R.shadowMap.enabled=!!m,Ar.boo(m))R.shadowMap.type=Xx;else if(Ar.str(m)){var Y;const X={basic:Yre,percentage:$C,soft:Xx,variance:Gl};R.shadowMap.type=(Y=X[m])!=null?Y:Xx}else Ar.obj(m)&&Object.assign(R.shadowMap,m);(U!==R.shadowMap.enabled||k!==R.shadowMap.type)&&(R.shadowMap.needsUpdate=!0)}const z=Xse();z&&("enabled"in z?z.enabled=!x:"legacyMode"in z&&(z.legacyMode=x)),l||dv(R,{outputEncoding:g?3e3:3001,toneMapping:y?ru:O4}),D.legacy!==x&&D.set(()=>({legacy:x})),D.linear!==g&&D.set(()=>({linear:g})),D.flat!==y&&D.set(()=>({flat:y})),h&&!Ar.fun(h)&&!eae(h)&&!Ar.equ(h,R,fv)&&dv(R,h),p&&!D.events.handlers&&D.set({events:p(s)});const V=jXe(e,d);return Ar.equ(V,D.size,fv)||D.setSize(V.width,V.height,V.updateStyle,V.top,V.left),S&&D.viewport.dpr!==Kse(S)&&D.setDpr(S),D.frameloop!==M&&D.setFrameloop(M),D.onPointerMissed||D.set({onPointerMissed:A}),T&&!Ar.equ(T,D.performance,fv)&&D.set(U=>({performance:{...U.performance,...T}})),o=v,l=!0,this},render(u){return l||this.configure(),$T.updateContainer(Te.jsx(XXe,{store:s,children:u,onCreated:o,rootElement:e}),a,null,()=>{}),s},unmount(){rae(e)}}}function XXe({store:e,children:t,onCreated:i,rootElement:r}){return t_(()=>{const n=e.getState();n.set(s=>({internal:{...s.internal,active:!0}})),i&&i(n),e.getState().events.connected||n.events.connect==null||n.events.connect(r)},[]),Te.jsx(tae.Provider,{value:e,children:t})}function rae(e,t){const i=Z0.get(e),r=i==null?void 0:i.fiber;if(r){const n=i==null?void 0:i.store.getState();n&&(n.internal.active=!1),$T.updateContainer(null,r,null,()=>{n&&setTimeout(()=>{try{var s,a,o,l;n.events.disconnect==null||n.events.disconnect(),(s=n.gl)==null||(a=s.renderLists)==null||a.dispose==null||a.dispose(),(o=n.gl)==null||o.forceContextLoss==null||o.forceContextLoss(),(l=n.gl)!=null&&l.xr&&n.xr.disconnect(),IXe(n),Z0.delete(e)}catch{}},500)})}}$T.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:_e.version});const SL={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function qXe(e){const{handlePointer:t}=FXe(e);return{priority:1,enabled:!0,compute(i,r,n){r.pointer.set(i.offsetX/r.size.width*2-1,-(i.offsetY/r.size.height)*2+1),r.raycaster.setFromCamera(r.pointer,r.camera)},connected:void 0,handlers:Object.keys(SL).reduce((i,r)=>({...i,[r]:t(r)}),{}),update:()=>{var i;const{events:r,internal:n}=e.getState();(i=n.lastEvent)!=null&&i.current&&r.handlers&&r.handlers.onPointerMove(n.lastEvent.current)},connect:i=>{var r;const{set:n,events:s}=e.getState();s.disconnect==null||s.disconnect(),n(a=>({events:{...a.events,connected:i}})),Object.entries((r=s.handlers)!=null?r:[]).forEach(([a,o])=>{const[l,c]=SL[a];i.addEventListener(l,o,{passive:c})})},disconnect:()=>{const{set:i,events:r}=e.getState();if(r.connected){var n;Object.entries((n=r.handlers)!=null?n:[]).forEach(([s,a])=>{if(r&&r.connected instanceof HTMLElement){const[o]=SL[s];r.connected.removeEventListener(o,a)}}),i(s=>({events:{...s.events,connected:void 0}}))}}}}function Qq(e,t){let i;return(...r)=>{window.clearTimeout(i),i=window.setTimeout(()=>e(...r),t)}}function YXe({debounce:e,scroll:t,polyfill:i,offsetSize:r}={debounce:0,scroll:!1,offsetSize:!1}){const n=i||(typeof window>"u"?class{}:window.ResizeObserver);if(!n)throw new Error("This browser does not support ResizeObserver out of the box. See: https://github.com/react-spring/react-use-measure/#resize-observer-polyfills");const[s,a]=_e.useState({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0}),o=_e.useRef({element:null,scrollContainers:null,resizeObserver:null,lastBounds:s,orientationHandler:null}),l=e?typeof e=="number"?e:e.scroll:null,c=e?typeof e=="number"?e:e.resize:null,u=_e.useRef(!1);_e.useEffect(()=>(u.current=!0,()=>void(u.current=!1)));const[h,d,f]=_e.useMemo(()=>{const g=()=>{if(!o.current.element)return;const{left:y,top:x,width:_,height:M,bottom:S,right:T,x:E,y:C}=o.current.element.getBoundingClientRect(),A={left:y,top:x,width:_,height:M,bottom:S,right:T,x:E,y:C};o.current.element instanceof HTMLElement&&r&&(A.height=o.current.element.offsetHeight,A.width=o.current.element.offsetWidth),Object.freeze(A),u.current&&!JXe(o.current.lastBounds,A)&&a(o.current.lastBounds=A)};return[g,c?Qq(g,c):g,l?Qq(g,l):g]},[a,r,l,c]);function p(){o.current.scrollContainers&&(o.current.scrollContainers.forEach(g=>g.removeEventListener("scroll",f,!0)),o.current.scrollContainers=null),o.current.resizeObserver&&(o.current.resizeObserver.disconnect(),o.current.resizeObserver=null),o.current.orientationHandler&&("orientation"in screen&&"removeEventListener"in screen.orientation?screen.orientation.removeEventListener("change",o.current.orientationHandler):"onorientationchange"in window&&window.removeEventListener("orientationchange",o.current.orientationHandler))}function v(){o.current.element&&(o.current.resizeObserver=new n(f),o.current.resizeObserver.observe(o.current.element),t&&o.current.scrollContainers&&o.current.scrollContainers.forEach(g=>g.addEventListener("scroll",f,{capture:!0,passive:!0})),o.current.orientationHandler=()=>{f()},"orientation"in screen&&"addEventListener"in screen.orientation?screen.orientation.addEventListener("change",o.current.orientationHandler):"onorientationchange"in window&&window.addEventListener("orientationchange",o.current.orientationHandler))}const m=g=>{!g||g===o.current.element||(p(),o.current.element=g,o.current.scrollContainers=nae(g),v())};return ZXe(f,!!t),QXe(d),_e.useEffect(()=>{p(),v()},[t,f,d]),_e.useEffect(()=>p,[]),[m,s,h]}function QXe(e){_e.useEffect(()=>{const t=e;return window.addEventListener("resize",t),()=>void window.removeEventListener("resize",t)},[e])}function ZXe(e,t){_e.useEffect(()=>{if(t){const i=e;return window.addEventListener("scroll",i,{capture:!0,passive:!0}),()=>void window.removeEventListener("scroll",i,!0)}},[e,t])}function nae(e){const t=[];if(!e||e===document.body)return t;const{overflow:i,overflowX:r,overflowY:n}=window.getComputedStyle(e);return[i,r,n].some(s=>s==="auto"||s==="scroll")&&t.push(e),[...t,...nae(e.parentElement)]}const KXe=["x","y","top","bottom","left","right","width","height"],JXe=(e,t)=>KXe.every(i=>e[i]===t[i]);var $Xe=Object.defineProperty,eqe=Object.defineProperties,tqe=Object.getOwnPropertyDescriptors,Zq=Object.getOwnPropertySymbols,iqe=Object.prototype.hasOwnProperty,rqe=Object.prototype.propertyIsEnumerable,Kq=(e,t,i)=>t in e?$Xe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,Jq=(e,t)=>{for(var i in t||(t={}))iqe.call(t,i)&&Kq(e,i,t[i]);if(Zq)for(var i of Zq(t))rqe.call(t,i)&&Kq(e,i,t[i]);return e},nqe=(e,t)=>eqe(e,tqe(t)),$q,eY;typeof window<"u"&&(($q=window.document)!=null&&$q.createElement||((eY=window.navigator)==null?void 0:eY.product)==="ReactNative")?_e.useLayoutEffect:_e.useEffect;function sae(e,t,i){if(!e)return;if(i(e)===!0)return e;let r=e.child;for(;r;){const n=sae(r,t,i);if(n)return n;r=r.sibling}}function aae(e){try{return Object.defineProperties(e,{_currentRenderer:{get(){return null},set(){}},_currentRenderer2:{get(){return null},set(){}}})}catch{return e}}const tY=console.error;console.error=function(){const e=[...arguments].join("");if(e!=null&&e.startsWith("Warning:")&&e.includes("useContext")){console.error=tY;return}return tY.apply(this,arguments)};const Ek=aae(_e.createContext(null));class oae extends _e.Component{render(){return _e.createElement(Ek.Provider,{value:this._reactInternals},this.props.children)}}function sqe(){const e=_e.useContext(Ek);if(e===null)throw new Error("its-fine: useFiber must be called within a <FiberProvider />!");const t=_e.useId();return _e.useMemo(()=>{for(const r of[e,e==null?void 0:e.alternate]){if(!r)continue;const n=sae(r,!1,s=>{let a=s.memoizedState;for(;a;){if(a.memoizedState===t)return!0;a=a.next}});if(n)return n}},[e,t])}function aqe(){const e=sqe(),[t]=_e.useState(()=>new Map);t.clear();let i=e;for(;i;){if(i.type&&typeof i.type=="object"){const n=i.type._context===void 0&&i.type.Provider===i.type?i.type:i.type._context;n&&n!==Ek&&!t.has(n)&&t.set(n,_e.useContext(aae(n)))}i=i.return}return t}function oqe(){const e=aqe();return _e.useMemo(()=>Array.from(e.keys()).reduce((t,i)=>r=>_e.createElement(t,null,_e.createElement(i.Provider,nqe(Jq({},r),{value:e.get(i)}))),t=>_e.createElement(oae,Jq({},t))),[e])}const lqe=_e.forwardRef(function({children:t,fallback:i,resize:r,style:n,gl:s,events:a=qXe,eventSource:o,eventPrefix:l,shadows:c,linear:u,flat:h,legacy:d,orthographic:f,frameloop:p,dpr:v,performance:m,raycaster:g,camera:y,scene:x,onPointerMissed:_,onCreated:M,...S},T){_e.useMemo(()=>TXe(pXe),[]);const E=oqe(),[C,A]=YXe({scroll:!0,debounce:{scroll:50,resize:0},...r}),D=_e.useRef(null),R=_e.useRef(null);_e.useImperativeHandle(T,()=>D.current);const L=Yse(_),[O,H]=_e.useState(!1),[j,Y]=_e.useState(!1);if(O)throw O;if(j)throw j;const z=_e.useRef(null);t_(()=>{const U=D.current;A.width>0&&A.height>0&&U&&(z.current||(z.current=WXe(U)),z.current.configure({gl:s,events:a,shadows:c,linear:u,flat:h,legacy:d,orthographic:f,frameloop:p,dpr:v,performance:m,raycaster:g,camera:y,scene:x,size:A,onPointerMissed:(...k)=>L.current==null?void 0:L.current(...k),onCreated:k=>{k.events.connect==null||k.events.connect(o?PXe(o)?o.current:o:R.current),l&&k.setEvents({compute:(X,re)=>{const q=X[l+"X"],ee=X[l+"Y"];re.pointer.set(q/re.size.width*2-1,-(ee/re.size.height)*2+1),re.raycaster.setFromCamera(re.pointer,re.camera)}}),M==null||M(k)}}),z.current.render(Te.jsx(E,{children:Te.jsx(Qse,{set:Y,children:Te.jsx(_e.Suspense,{fallback:Te.jsx(DXe,{set:H}),children:t??null})})})))}),_e.useEffect(()=>{const U=D.current;if(U)return()=>rae(U)},[]);const V=o?"none":"auto";return Te.jsx("div",{ref:R,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:V,...n},...S,children:Te.jsx("div",{ref:C,style:{width:"100%",height:"100%"},children:Te.jsx("canvas",{ref:D,style:{display:"block"},children:i})})})}),lae=_e.forwardRef(function(t,i){return Te.jsx(oae,{children:Te.jsx(lqe,{...t,ref:i})})});function K0(){return K0=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)({}).hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},K0.apply(null,arguments)}var cqe=Object.defineProperty,uqe=(e,t,i)=>t in e?cqe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,hqe=(e,t,i)=>(uqe(e,t+"",i),i);class dqe{constructor(){hqe(this,"_listeners")}addEventListener(t,i){this._listeners===void 0&&(this._listeners={});const r=this._listeners;r[t]===void 0&&(r[t]=[]),r[t].indexOf(i)===-1&&r[t].push(i)}hasEventListener(t,i){if(this._listeners===void 0)return!1;const r=this._listeners;return r[t]!==void 0&&r[t].indexOf(i)!==-1}removeEventListener(t,i){if(this._listeners===void 0)return;const n=this._listeners[t];if(n!==void 0){const s=n.indexOf(i);s!==-1&&n.splice(s,1)}}dispatchEvent(t){if(this._listeners===void 0)return;const r=this._listeners[t.type];if(r!==void 0){t.target=this;const n=r.slice(0);for(let s=0,a=n.length;s<a;s++)n[s].call(this,t);t.target=null}}}var fqe=Object.defineProperty,pqe=(e,t,i)=>t in e?fqe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,ti=(e,t,i)=>(pqe(e,typeof t!="symbol"?t+"":t,i),i);const LE=new Zm,iY=new eh,mqe=Math.cos(70*(Math.PI/180)),rY=(e,t)=>(e%t+t)%t;let gqe=class extends dqe{constructor(t,i){super(),ti(this,"object"),ti(this,"domElement"),ti(this,"enabled",!0),ti(this,"target",new he),ti(this,"minDistance",0),ti(this,"maxDistance",1/0),ti(this,"minZoom",0),ti(this,"maxZoom",1/0),ti(this,"minPolarAngle",0),ti(this,"maxPolarAngle",Math.PI),ti(this,"minAzimuthAngle",-1/0),ti(this,"maxAzimuthAngle",1/0),ti(this,"enableDamping",!1),ti(this,"dampingFactor",.05),ti(this,"enableZoom",!0),ti(this,"zoomSpeed",1),ti(this,"enableRotate",!0),ti(this,"rotateSpeed",1),ti(this,"enablePan",!0),ti(this,"panSpeed",1),ti(this,"screenSpacePanning",!0),ti(this,"keyPanSpeed",7),ti(this,"zoomToCursor",!1),ti(this,"autoRotate",!1),ti(this,"autoRotateSpeed",2),ti(this,"reverseOrbit",!1),ti(this,"reverseHorizontalOrbit",!1),ti(this,"reverseVerticalOrbit",!1),ti(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),ti(this,"mouseButtons",{LEFT:Cp.ROTATE,MIDDLE:Cp.DOLLY,RIGHT:Cp.PAN}),ti(this,"touches",{ONE:Pp.ROTATE,TWO:Pp.DOLLY_PAN}),ti(this,"target0"),ti(this,"position0"),ti(this,"zoom0"),ti(this,"_domElementKeyEvents",null),ti(this,"getPolarAngle"),ti(this,"getAzimuthalAngle"),ti(this,"setPolarAngle"),ti(this,"setAzimuthalAngle"),ti(this,"getDistance"),ti(this,"getZoomScale"),ti(this,"listenToKeyEvents"),ti(this,"stopListenToKeyEvents"),ti(this,"saveState"),ti(this,"reset"),ti(this,"update"),ti(this,"connect"),ti(this,"dispose"),ti(this,"dollyIn"),ti(this,"dollyOut"),ti(this,"getScale"),ti(this,"setScale"),this.object=t,this.domElement=i,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=()=>u.phi,this.getAzimuthalAngle=()=>u.theta,this.setPolarAngle=de=>{let We=rY(de,2*Math.PI),dt=u.phi;dt<0&&(dt+=2*Math.PI),We<0&&(We+=2*Math.PI);let J=Math.abs(We-dt);2*Math.PI-J<J&&(We<dt?We+=2*Math.PI:dt+=2*Math.PI),h.phi=We-dt,r.update()},this.setAzimuthalAngle=de=>{let We=rY(de,2*Math.PI),dt=u.theta;dt<0&&(dt+=2*Math.PI),We<0&&(We+=2*Math.PI);let J=Math.abs(We-dt);2*Math.PI-J<J&&(We<dt?We+=2*Math.PI:dt+=2*Math.PI),h.theta=We-dt,r.update()},this.getDistance=()=>r.object.position.distanceTo(r.target),this.listenToKeyEvents=de=>{de.addEventListener("keydown",Oe),this._domElementKeyEvents=de},this.stopListenToKeyEvents=()=>{this._domElementKeyEvents.removeEventListener("keydown",Oe),this._domElementKeyEvents=null},this.saveState=()=>{r.target0.copy(r.target),r.position0.copy(r.object.position),r.zoom0=r.object.zoom},this.reset=()=>{r.target.copy(r.target0),r.object.position.copy(r.position0),r.object.zoom=r.zoom0,r.object.updateProjectionMatrix(),r.dispatchEvent(n),r.update(),l=o.NONE},this.update=(()=>{const de=new he,We=new he(0,1,0),dt=new oa().setFromUnitVectors(t.up,We),J=dt.clone().invert(),xe=new he,me=new oa,ze=2*Math.PI;return function(){const Je=r.object.position;dt.setFromUnitVectors(t.up,We),J.copy(dt).invert(),de.copy(Je).sub(r.target),de.applyQuaternion(dt),u.setFromVector3(de),r.autoRotate&&l===o.NONE&&O(R()),r.enableDamping?(u.theta+=h.theta*r.dampingFactor,u.phi+=h.phi*r.dampingFactor):(u.theta+=h.theta,u.phi+=h.phi);let mt=r.minAzimuthAngle,St=r.maxAzimuthAngle;isFinite(mt)&&isFinite(St)&&(mt<-Math.PI?mt+=ze:mt>Math.PI&&(mt-=ze),St<-Math.PI?St+=ze:St>Math.PI&&(St-=ze),mt<=St?u.theta=Math.max(mt,Math.min(St,u.theta)):u.theta=u.theta>(mt+St)/2?Math.max(mt,u.theta):Math.min(St,u.theta)),u.phi=Math.max(r.minPolarAngle,Math.min(r.maxPolarAngle,u.phi)),u.makeSafe(),r.enableDamping===!0?r.target.addScaledVector(f,r.dampingFactor):r.target.add(f),r.zoomToCursor&&C||r.object.isOrthographicCamera?u.radius=re(u.radius):u.radius=re(u.radius*d),de.setFromSpherical(u),de.applyQuaternion(J),Je.copy(r.target).add(de),r.object.matrixAutoUpdate||r.object.updateMatrix(),r.object.lookAt(r.target),r.enableDamping===!0?(h.theta*=1-r.dampingFactor,h.phi*=1-r.dampingFactor,f.multiplyScalar(1-r.dampingFactor)):(h.set(0,0,0),f.set(0,0,0));let Mt=!1;if(r.zoomToCursor&&C){let vt=null;if(r.object instanceof fn&&r.object.isPerspectiveCamera){const ui=de.length();vt=re(ui*d);const hi=ui-vt;r.object.position.addScaledVector(T,hi),r.object.updateMatrixWorld()}else if(r.object.isOrthographicCamera){const ui=new he(E.x,E.y,0);ui.unproject(r.object),r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom/d)),r.object.updateProjectionMatrix(),Mt=!0;const hi=new he(E.x,E.y,0);hi.unproject(r.object),r.object.position.sub(hi).add(ui),r.object.updateMatrixWorld(),vt=de.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),r.zoomToCursor=!1;vt!==null&&(r.screenSpacePanning?r.target.set(0,0,-1).transformDirection(r.object.matrix).multiplyScalar(vt).add(r.object.position):(LE.origin.copy(r.object.position),LE.direction.set(0,0,-1).transformDirection(r.object.matrix),Math.abs(r.object.up.dot(LE.direction))<mqe?t.lookAt(r.target):(iY.setFromNormalAndCoplanarPoint(r.object.up,r.target),LE.intersectPlane(iY,r.target))))}else r.object instanceof hf&&r.object.isOrthographicCamera&&(Mt=d!==1,Mt&&(r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom/d)),r.object.updateProjectionMatrix()));return d=1,C=!1,Mt||xe.distanceToSquared(r.object.position)>c||8*(1-me.dot(r.object.quaternion))>c?(r.dispatchEvent(n),xe.copy(r.object.position),me.copy(r.object.quaternion),Mt=!1,!0):!1}})(),this.connect=de=>{r.domElement=de,r.domElement.style.touchAction="none",r.domElement.addEventListener("contextmenu",ke),r.domElement.addEventListener("pointerdown",B),r.domElement.addEventListener("pointercancel",oe),r.domElement.addEventListener("wheel",Ie)},this.dispose=()=>{var de,We,dt,J,xe,me;r.domElement&&(r.domElement.style.touchAction="auto"),(de=r.domElement)==null||de.removeEventListener("contextmenu",ke),(We=r.domElement)==null||We.removeEventListener("pointerdown",B),(dt=r.domElement)==null||dt.removeEventListener("pointercancel",oe),(J=r.domElement)==null||J.removeEventListener("wheel",Ie),(xe=r.domElement)==null||xe.ownerDocument.removeEventListener("pointermove",G),(me=r.domElement)==null||me.ownerDocument.removeEventListener("pointerup",oe),r._domElementKeyEvents!==null&&r._domElementKeyEvents.removeEventListener("keydown",Oe)};const r=this,n={type:"change"},s={type:"start"},a={type:"end"},o={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let l=o.NONE;const c=1e-6,u=new aF,h=new aF;let d=1;const f=new he,p=new ut,v=new ut,m=new ut,g=new ut,y=new ut,x=new ut,_=new ut,M=new ut,S=new ut,T=new he,E=new ut;let C=!1;const A=[],D={};function R(){return 2*Math.PI/60/60*r.autoRotateSpeed}function L(){return Math.pow(.95,r.zoomSpeed)}function O(de){r.reverseOrbit||r.reverseHorizontalOrbit?h.theta+=de:h.theta-=de}function H(de){r.reverseOrbit||r.reverseVerticalOrbit?h.phi+=de:h.phi-=de}const j=(()=>{const de=new he;return function(dt,J){de.setFromMatrixColumn(J,0),de.multiplyScalar(-dt),f.add(de)}})(),Y=(()=>{const de=new he;return function(dt,J){r.screenSpacePanning===!0?de.setFromMatrixColumn(J,1):(de.setFromMatrixColumn(J,0),de.crossVectors(r.object.up,de)),de.multiplyScalar(dt),f.add(de)}})(),z=(()=>{const de=new he;return function(dt,J){const xe=r.domElement;if(xe&&r.object instanceof fn&&r.object.isPerspectiveCamera){const me=r.object.position;de.copy(me).sub(r.target);let ze=de.length();ze*=Math.tan(r.object.fov/2*Math.PI/180),j(2*dt*ze/xe.clientHeight,r.object.matrix),Y(2*J*ze/xe.clientHeight,r.object.matrix)}else xe&&r.object instanceof hf&&r.object.isOrthographicCamera?(j(dt*(r.object.right-r.object.left)/r.object.zoom/xe.clientWidth,r.object.matrix),Y(J*(r.object.top-r.object.bottom)/r.object.zoom/xe.clientHeight,r.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),r.enablePan=!1)}})();function V(de){r.object instanceof fn&&r.object.isPerspectiveCamera||r.object instanceof hf&&r.object.isOrthographicCamera?d=de:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function U(de){V(d/de)}function k(de){V(d*de)}function X(de){if(!r.zoomToCursor||!r.domElement)return;C=!0;const We=r.domElement.getBoundingClientRect(),dt=de.clientX-We.left,J=de.clientY-We.top,xe=We.width,me=We.height;E.x=dt/xe*2-1,E.y=-(J/me)*2+1,T.set(E.x,E.y,1).unproject(r.object).sub(r.object.position).normalize()}function re(de){return Math.max(r.minDistance,Math.min(r.maxDistance,de))}function q(de){p.set(de.clientX,de.clientY)}function ee(de){X(de),_.set(de.clientX,de.clientY)}function $(de){g.set(de.clientX,de.clientY)}function ne(de){v.set(de.clientX,de.clientY),m.subVectors(v,p).multiplyScalar(r.rotateSpeed);const We=r.domElement;We&&(O(2*Math.PI*m.x/We.clientHeight),H(2*Math.PI*m.y/We.clientHeight)),p.copy(v),r.update()}function ce(de){M.set(de.clientX,de.clientY),S.subVectors(M,_),S.y>0?U(L()):S.y<0&&k(L()),_.copy(M),r.update()}function pe(de){y.set(de.clientX,de.clientY),x.subVectors(y,g).multiplyScalar(r.panSpeed),z(x.x,x.y),g.copy(y),r.update()}function ge(de){X(de),de.deltaY<0?k(L()):de.deltaY>0&&U(L()),r.update()}function we(de){let We=!1;switch(de.code){case r.keys.UP:z(0,r.keyPanSpeed),We=!0;break;case r.keys.BOTTOM:z(0,-r.keyPanSpeed),We=!0;break;case r.keys.LEFT:z(r.keyPanSpeed,0),We=!0;break;case r.keys.RIGHT:z(-r.keyPanSpeed,0),We=!0;break}We&&(de.preventDefault(),r.update())}function le(){if(A.length==1)p.set(A[0].pageX,A[0].pageY);else{const de=.5*(A[0].pageX+A[1].pageX),We=.5*(A[0].pageY+A[1].pageY);p.set(de,We)}}function ve(){if(A.length==1)g.set(A[0].pageX,A[0].pageY);else{const de=.5*(A[0].pageX+A[1].pageX),We=.5*(A[0].pageY+A[1].pageY);g.set(de,We)}}function ie(){const de=A[0].pageX-A[1].pageX,We=A[0].pageY-A[1].pageY,dt=Math.sqrt(de*de+We*We);_.set(0,dt)}function Ce(){r.enableZoom&&ie(),r.enablePan&&ve()}function Pe(){r.enableZoom&&ie(),r.enableRotate&&le()}function Ne(de){if(A.length==1)v.set(de.pageX,de.pageY);else{const dt=He(de),J=.5*(de.pageX+dt.x),xe=.5*(de.pageY+dt.y);v.set(J,xe)}m.subVectors(v,p).multiplyScalar(r.rotateSpeed);const We=r.domElement;We&&(O(2*Math.PI*m.x/We.clientHeight),H(2*Math.PI*m.y/We.clientHeight)),p.copy(v)}function be(de){if(A.length==1)y.set(de.pageX,de.pageY);else{const We=He(de),dt=.5*(de.pageX+We.x),J=.5*(de.pageY+We.y);y.set(dt,J)}x.subVectors(y,g).multiplyScalar(r.panSpeed),z(x.x,x.y),g.copy(y)}function Le(de){const We=He(de),dt=de.pageX-We.x,J=de.pageY-We.y,xe=Math.sqrt(dt*dt+J*J);M.set(0,xe),S.set(0,Math.pow(M.y/_.y,r.zoomSpeed)),U(S.y),_.copy(M)}function Fe(de){r.enableZoom&&Le(de),r.enablePan&&be(de)}function K(de){r.enableZoom&&Le(de),r.enableRotate&&Ne(de)}function B(de){var We,dt;r.enabled!==!1&&(A.length===0&&((We=r.domElement)==null||We.ownerDocument.addEventListener("pointermove",G),(dt=r.domElement)==null||dt.ownerDocument.addEventListener("pointerup",oe)),qe(de),de.pointerType==="touch"?Be(de):fe(de))}function G(de){r.enabled!==!1&&(de.pointerType==="touch"?Re(de):W(de))}function oe(de){var We,dt,J;Ke(de),A.length===0&&((We=r.domElement)==null||We.releasePointerCapture(de.pointerId),(dt=r.domElement)==null||dt.ownerDocument.removeEventListener("pointermove",G),(J=r.domElement)==null||J.ownerDocument.removeEventListener("pointerup",oe)),r.dispatchEvent(a),l=o.NONE}function fe(de){let We;switch(de.button){case 0:We=r.mouseButtons.LEFT;break;case 1:We=r.mouseButtons.MIDDLE;break;case 2:We=r.mouseButtons.RIGHT;break;default:We=-1}switch(We){case Cp.DOLLY:if(r.enableZoom===!1)return;ee(de),l=o.DOLLY;break;case Cp.ROTATE:if(de.ctrlKey||de.metaKey||de.shiftKey){if(r.enablePan===!1)return;$(de),l=o.PAN}else{if(r.enableRotate===!1)return;q(de),l=o.ROTATE}break;case Cp.PAN:if(de.ctrlKey||de.metaKey||de.shiftKey){if(r.enableRotate===!1)return;q(de),l=o.ROTATE}else{if(r.enablePan===!1)return;$(de),l=o.PAN}break;default:l=o.NONE}l!==o.NONE&&r.dispatchEvent(s)}function W(de){if(r.enabled!==!1)switch(l){case o.ROTATE:if(r.enableRotate===!1)return;ne(de);break;case o.DOLLY:if(r.enableZoom===!1)return;ce(de);break;case o.PAN:if(r.enablePan===!1)return;pe(de);break}}function Ie(de){r.enabled===!1||r.enableZoom===!1||l!==o.NONE&&l!==o.ROTATE||(de.preventDefault(),r.dispatchEvent(s),ge(de),r.dispatchEvent(a))}function Oe(de){r.enabled===!1||r.enablePan===!1||we(de)}function Be(de){switch(it(de),A.length){case 1:switch(r.touches.ONE){case Pp.ROTATE:if(r.enableRotate===!1)return;le(),l=o.TOUCH_ROTATE;break;case Pp.PAN:if(r.enablePan===!1)return;ve(),l=o.TOUCH_PAN;break;default:l=o.NONE}break;case 2:switch(r.touches.TWO){case Pp.DOLLY_PAN:if(r.enableZoom===!1&&r.enablePan===!1)return;Ce(),l=o.TOUCH_DOLLY_PAN;break;case Pp.DOLLY_ROTATE:if(r.enableZoom===!1&&r.enableRotate===!1)return;Pe(),l=o.TOUCH_DOLLY_ROTATE;break;default:l=o.NONE}break;default:l=o.NONE}l!==o.NONE&&r.dispatchEvent(s)}function Re(de){switch(it(de),l){case o.TOUCH_ROTATE:if(r.enableRotate===!1)return;Ne(de),r.update();break;case o.TOUCH_PAN:if(r.enablePan===!1)return;be(de),r.update();break;case o.TOUCH_DOLLY_PAN:if(r.enableZoom===!1&&r.enablePan===!1)return;Fe(de),r.update();break;case o.TOUCH_DOLLY_ROTATE:if(r.enableZoom===!1&&r.enableRotate===!1)return;K(de),r.update();break;default:l=o.NONE}}function ke(de){r.enabled!==!1&&de.preventDefault()}function qe(de){A.push(de)}function Ke(de){delete D[de.pointerId];for(let We=0;We<A.length;We++)if(A[We].pointerId==de.pointerId){A.splice(We,1);return}}function it(de){let We=D[de.pointerId];We===void 0&&(We=new ut,D[de.pointerId]=We),We.set(de.pageX,de.pageY)}function He(de){const We=de.pointerId===A[0].pointerId?A[1]:A[0];return D[We.pointerId]}this.dollyIn=(de=L())=>{k(de),r.update()},this.dollyOut=(de=L())=>{U(de),r.update()},this.getScale=()=>d,this.setScale=de=>{V(de),r.update()},this.getZoomScale=()=>L(),i!==void 0&&this.connect(i),this.update()}};function vqe(){var e=Object.create(null);function t(n,s){var a=n.id,o=n.name,l=n.dependencies;l===void 0&&(l=[]);var c=n.init;c===void 0&&(c=function(){});var u=n.getTransferables;if(u===void 0&&(u=null),!e[a])try{l=l.map(function(d){return d&&d.isWorkerModule&&(t(d,function(f){if(f instanceof Error)throw f}),d=e[d.id].value),d}),c=r("<"+o+">.init",c),u&&(u=r("<"+o+">.getTransferables",u));var h=null;typeof c=="function"?h=c.apply(void 0,l):console.error("worker module init function failed to rehydrate"),e[a]={id:a,value:h,getTransferables:u},s(h)}catch(d){d&&d.noLog||console.error(d),s(d)}}function i(n,s){var a,o=n.id,l=n.args;(!e[o]||typeof e[o].value!="function")&&s(new Error("Worker module "+o+": not found or its 'init' did not return a function"));try{var c=(a=e[o]).value.apply(a,l);c&&typeof c.then=="function"?c.then(u,function(h){return s(h instanceof Error?h:new Error(""+h))}):u(c)}catch(h){s(h)}function u(h){try{var d=e[o].getTransferables&&e[o].getTransferables(h);(!d||!Array.isArray(d)||!d.length)&&(d=void 0),s(h,d)}catch(f){console.error(f),s(f)}}}function r(n,s){var a=void 0;self.troikaDefine=function(l){return a=l};var o=URL.createObjectURL(new Blob(["/** "+n.replace(/\*/g,"")+` **/

troikaDefine(
`+s+`
)`],{type:"application/javascript"}));try{importScripts(o)}catch(l){console.error(l)}return URL.revokeObjectURL(o),delete self.troikaDefine,a}self.addEventListener("message",function(n){var s=n.data,a=s.messageId,o=s.action,l=s.data;try{o==="registerModule"&&t(l,function(c){c instanceof Error?postMessage({messageId:a,success:!1,error:c.message}):postMessage({messageId:a,success:!0,result:{isCallable:typeof c=="function"}})}),o==="callModule"&&i(l,function(c,u){c instanceof Error?postMessage({messageId:a,success:!1,error:c.message}):postMessage({messageId:a,success:!0,result:c},u||void 0)})}catch(c){postMessage({messageId:a,success:!1,error:c.stack})}})}function yqe(e){var t=function(){for(var i=[],r=arguments.length;r--;)i[r]=arguments[r];return t._getInitResult().then(function(n){if(typeof n=="function")return n.apply(void 0,i);throw new Error("Worker module function was called but `init` did not return a callable function")})};return t._getInitResult=function(){var i=e.dependencies,r=e.init;i=Array.isArray(i)?i.map(function(s){return s&&(s=s.onMainThread||s,s._getInitResult&&(s=s._getInitResult())),s}):[];var n=Promise.all(i).then(function(s){return r.apply(null,s)});return t._getInitResult=function(){return n},n},t}var cae=function(){var e=!1;if(typeof window<"u"&&typeof window.document<"u")try{var t=new Worker(URL.createObjectURL(new Blob([""],{type:"application/javascript"})));t.terminate(),e=!0}catch(i){typeof process<"u",console.log("Troika createWorkerModule: web workers not allowed; falling back to main thread execution. Cause: ["+i.message+"]")}return cae=function(){return e},e},xqe=0,wqe=0,ML=!1,iw=Object.create(null),rw=Object.create(null),dF=Object.create(null);function Ey(e){if((!e||typeof e.init!="function")&&!ML)throw new Error("requires `options.init` function");var t=e.dependencies,i=e.init,r=e.getTransferables,n=e.workerId,s=yqe(e);n==null&&(n="#default");var a="workerModule"+ ++xqe,o=e.name||a,l=null;t=t&&t.map(function(u){return typeof u=="function"&&!u.workerModuleData&&(ML=!0,u=Ey({workerId:n,name:"<"+o+"> function dependency: "+u.name,init:`function(){return (
`+b2(u)+`
)}`}),ML=!1),u&&u.workerModuleData&&(u=u.workerModuleData),u});function c(){for(var u=[],h=arguments.length;h--;)u[h]=arguments[h];if(!cae())return s.apply(void 0,u);if(!l){l=nY(n,"registerModule",c.workerModuleData);var d=function(){l=null,rw[n].delete(d)};(rw[n]||(rw[n]=new Set)).add(d)}return l.then(function(f){var p=f.isCallable;if(p)return nY(n,"callModule",{id:a,args:u});throw new Error("Worker module function was called but `init` did not return a callable function")})}return c.workerModuleData={isWorkerModule:!0,id:a,name:o,dependencies:t,init:b2(i),getTransferables:r&&b2(r)},c.onMainThread=s,c}function bqe(e){rw[e]&&rw[e].forEach(function(t){t()}),iw[e]&&(iw[e].terminate(),delete iw[e])}function b2(e){var t=e.toString();return!/^function/.test(t)&&/^\w+\s*\(/.test(t)&&(t="function "+t),t}function _qe(e){var t=iw[e];if(!t){var i=b2(vqe);t=iw[e]=new Worker(URL.createObjectURL(new Blob(["/** Worker Module Bootstrap: "+e.replace(/\*/g,"")+` **/

;(`+i+")()"],{type:"application/javascript"}))),t.onmessage=function(r){var n=r.data,s=n.messageId,a=dF[s];if(!a)throw new Error("WorkerModule response with empty or unknown messageId");delete dF[s],a(n)}}return t}function nY(e,t,i){return new Promise(function(r,n){var s=++wqe;dF[s]=function(a){a.success?r(a.result):n(new Error("Error in worker "+t+" call: "+a.error))},_qe(e).postMessage({messageId:s,action:t,data:i})})}function uae(){var e=function(t){function i(V,U,k,X,re,q,ee,$){var ne=1-ee;$.x=ne*ne*V+2*ne*ee*k+ee*ee*re,$.y=ne*ne*U+2*ne*ee*X+ee*ee*q}function r(V,U,k,X,re,q,ee,$,ne,ce){var pe=1-ne;ce.x=pe*pe*pe*V+3*pe*pe*ne*k+3*pe*ne*ne*re+ne*ne*ne*ee,ce.y=pe*pe*pe*U+3*pe*pe*ne*X+3*pe*ne*ne*q+ne*ne*ne*$}function n(V,U){for(var k=/([MLQCZ])([^MLQCZ]*)/g,X,re,q,ee,$;X=k.exec(V);){var ne=X[2].replace(/^\s*|\s*$/g,"").split(/[,\s]+/).map(function(ce){return parseFloat(ce)});switch(X[1]){case"M":ee=re=ne[0],$=q=ne[1];break;case"L":(ne[0]!==ee||ne[1]!==$)&&U("L",ee,$,ee=ne[0],$=ne[1]);break;case"Q":{U("Q",ee,$,ee=ne[2],$=ne[3],ne[0],ne[1]);break}case"C":{U("C",ee,$,ee=ne[4],$=ne[5],ne[0],ne[1],ne[2],ne[3]);break}case"Z":(ee!==re||$!==q)&&U("L",ee,$,re,q);break}}}function s(V,U,k){k===void 0&&(k=16);var X={x:0,y:0};n(V,function(re,q,ee,$,ne,ce,pe,ge,we){switch(re){case"L":U(q,ee,$,ne);break;case"Q":{for(var le=q,ve=ee,ie=1;ie<k;ie++)i(q,ee,ce,pe,$,ne,ie/(k-1),X),U(le,ve,X.x,X.y),le=X.x,ve=X.y;break}case"C":{for(var Ce=q,Pe=ee,Ne=1;Ne<k;Ne++)r(q,ee,ce,pe,ge,we,$,ne,Ne/(k-1),X),U(Ce,Pe,X.x,X.y),Ce=X.x,Pe=X.y;break}}})}var a="precision highp float;attribute vec2 aUV;varying vec2 vUV;void main(){vUV=aUV;gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",o="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){gl_FragColor=texture2D(tex,vUV);}",l=new WeakMap,c={premultipliedAlpha:!1,preserveDrawingBuffer:!0,antialias:!1,depth:!1};function u(V,U){var k=V.getContext?V.getContext("webgl",c):V,X=l.get(k);if(!X){let pe=function(Ce){var Pe=q[Ce];if(!Pe&&(Pe=q[Ce]=k.getExtension(Ce),!Pe))throw new Error(Ce+" not supported");return Pe},ge=function(Ce,Pe){var Ne=k.createShader(Pe);return k.shaderSource(Ne,Ce),k.compileShader(Ne),Ne},we=function(Ce,Pe,Ne,be){if(!ee[Ce]){var Le={},Fe={},K=k.createProgram();k.attachShader(K,ge(Pe,k.VERTEX_SHADER)),k.attachShader(K,ge(Ne,k.FRAGMENT_SHADER)),k.linkProgram(K),ee[Ce]={program:K,transaction:function(G){k.useProgram(K),G({setUniform:function(fe,W){for(var Ie=[],Oe=arguments.length-2;Oe-- >0;)Ie[Oe]=arguments[Oe+2];var Be=Fe[W]||(Fe[W]=k.getUniformLocation(K,W));k["uniform"+fe].apply(k,[Be].concat(Ie))},setAttribute:function(fe,W,Ie,Oe,Be){var Re=Le[fe];Re||(Re=Le[fe]={buf:k.createBuffer(),loc:k.getAttribLocation(K,fe),data:null}),k.bindBuffer(k.ARRAY_BUFFER,Re.buf),k.vertexAttribPointer(Re.loc,W,k.FLOAT,!1,0,0),k.enableVertexAttribArray(Re.loc),re?k.vertexAttribDivisor(Re.loc,Oe):pe("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(Re.loc,Oe),Be!==Re.data&&(k.bufferData(k.ARRAY_BUFFER,Be,Ie),Re.data=Be)}})}}}ee[Ce].transaction(be)},le=function(Ce,Pe){ne++;try{k.activeTexture(k.TEXTURE0+ne);var Ne=$[Ce];Ne||(Ne=$[Ce]=k.createTexture(),k.bindTexture(k.TEXTURE_2D,Ne),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MIN_FILTER,k.NEAREST),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MAG_FILTER,k.NEAREST)),k.bindTexture(k.TEXTURE_2D,Ne),Pe(Ne,ne)}finally{ne--}},ve=function(Ce,Pe,Ne){var be=k.createFramebuffer();ce.push(be),k.bindFramebuffer(k.FRAMEBUFFER,be),k.activeTexture(k.TEXTURE0+Pe),k.bindTexture(k.TEXTURE_2D,Ce),k.framebufferTexture2D(k.FRAMEBUFFER,k.COLOR_ATTACHMENT0,k.TEXTURE_2D,Ce,0);try{Ne(be)}finally{k.deleteFramebuffer(be),k.bindFramebuffer(k.FRAMEBUFFER,ce[--ce.length-1]||null)}},ie=function(){q={},ee={},$={},ne=-1,ce.length=0};var re=typeof WebGL2RenderingContext<"u"&&k instanceof WebGL2RenderingContext,q={},ee={},$={},ne=-1,ce=[];k.canvas.addEventListener("webglcontextlost",function(Ce){ie(),Ce.preventDefault()},!1),l.set(k,X={gl:k,isWebGL2:re,getExtension:pe,withProgram:we,withTexture:le,withTextureFramebuffer:ve,handleContextLoss:ie})}U(X)}function h(V,U,k,X,re,q,ee,$){ee===void 0&&(ee=15),$===void 0&&($=null),u(V,function(ne){var ce=ne.gl,pe=ne.withProgram,ge=ne.withTexture;ge("copy",function(we,le){ce.texImage2D(ce.TEXTURE_2D,0,ce.RGBA,re,q,0,ce.RGBA,ce.UNSIGNED_BYTE,U),pe("copy",a,o,function(ve){var ie=ve.setUniform,Ce=ve.setAttribute;Ce("aUV",2,ce.STATIC_DRAW,0,new Float32Array([0,0,2,0,0,2])),ie("1i","image",le),ce.bindFramebuffer(ce.FRAMEBUFFER,$||null),ce.disable(ce.BLEND),ce.colorMask(ee&8,ee&4,ee&2,ee&1),ce.viewport(k,X,re,q),ce.scissor(k,X,re,q),ce.drawArrays(ce.TRIANGLES,0,3)})})})}function d(V,U,k){var X=V.width,re=V.height;u(V,function(q){var ee=q.gl,$=new Uint8Array(X*re*4);ee.readPixels(0,0,X,re,ee.RGBA,ee.UNSIGNED_BYTE,$),V.width=U,V.height=k,h(ee,$,0,0,X,re)})}var f=Object.freeze({__proto__:null,withWebGLContext:u,renderImageData:h,resizeWebGLCanvasWithoutClearing:d});function p(V,U,k,X,re,q){q===void 0&&(q=1);var ee=new Uint8Array(V*U),$=X[2]-X[0],ne=X[3]-X[1],ce=[];s(k,function(Ce,Pe,Ne,be){ce.push({x1:Ce,y1:Pe,x2:Ne,y2:be,minX:Math.min(Ce,Ne),minY:Math.min(Pe,be),maxX:Math.max(Ce,Ne),maxY:Math.max(Pe,be)})}),ce.sort(function(Ce,Pe){return Ce.maxX-Pe.maxX});for(var pe=0;pe<V;pe++)for(var ge=0;ge<U;ge++){var we=ve(X[0]+$*(pe+.5)/V,X[1]+ne*(ge+.5)/U),le=Math.pow(1-Math.abs(we)/re,q)/2;we<0&&(le=1-le),le=Math.max(0,Math.min(255,Math.round(le*255))),ee[ge*V+pe]=le}return ee;function ve(Ce,Pe){for(var Ne=1/0,be=1/0,Le=ce.length;Le--;){var Fe=ce[Le];if(Fe.maxX+be<=Ce)break;if(Ce+be>Fe.minX&&Pe-be<Fe.maxY&&Pe+be>Fe.minY){var K=g(Ce,Pe,Fe.x1,Fe.y1,Fe.x2,Fe.y2);K<Ne&&(Ne=K,be=Math.sqrt(Ne))}}return ie(Ce,Pe)&&(be=-be),be}function ie(Ce,Pe){for(var Ne=0,be=ce.length;be--;){var Le=ce[be];if(Le.maxX<=Ce)break;var Fe=Le.y1>Pe!=Le.y2>Pe&&Ce<(Le.x2-Le.x1)*(Pe-Le.y1)/(Le.y2-Le.y1)+Le.x1;Fe&&(Ne+=Le.y1<Le.y2?1:-1)}return Ne!==0}}function v(V,U,k,X,re,q,ee,$,ne,ce){q===void 0&&(q=1),$===void 0&&($=0),ne===void 0&&(ne=0),ce===void 0&&(ce=0),m(V,U,k,X,re,q,ee,null,$,ne,ce)}function m(V,U,k,X,re,q,ee,$,ne,ce,pe){q===void 0&&(q=1),ne===void 0&&(ne=0),ce===void 0&&(ce=0),pe===void 0&&(pe=0);for(var ge=p(V,U,k,X,re,q),we=new Uint8Array(ge.length*4),le=0;le<ge.length;le++)we[le*4+pe]=ge[le];h(ee,we,ne,ce,V,U,1<<3-pe,$)}function g(V,U,k,X,re,q){var ee=re-k,$=q-X,ne=ee*ee+$*$,ce=ne?Math.max(0,Math.min(1,((V-k)*ee+(U-X)*$)/ne)):0,pe=V-(k+ce*ee),ge=U-(X+ce*$);return pe*pe+ge*ge}var y=Object.freeze({__proto__:null,generate:p,generateIntoCanvas:v,generateIntoFramebuffer:m}),x="precision highp float;uniform vec4 uGlyphBounds;attribute vec2 aUV;attribute vec4 aLineSegment;varying vec4 vLineSegment;varying vec2 vGlyphXY;void main(){vLineSegment=aLineSegment;vGlyphXY=mix(uGlyphBounds.xy,uGlyphBounds.zw,aUV);gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",_="precision highp float;uniform vec4 uGlyphBounds;uniform float uMaxDistance;uniform float uExponent;varying vec4 vLineSegment;varying vec2 vGlyphXY;float absDistToSegment(vec2 point,vec2 lineA,vec2 lineB){vec2 lineDir=lineB-lineA;float lenSq=dot(lineDir,lineDir);float t=lenSq==0.0 ? 0.0 : clamp(dot(point-lineA,lineDir)/lenSq,0.0,1.0);vec2 linePt=lineA+t*lineDir;return distance(point,linePt);}void main(){vec4 seg=vLineSegment;vec2 p=vGlyphXY;float dist=absDistToSegment(p,seg.xy,seg.zw);float val=pow(1.0-clamp(dist/uMaxDistance,0.0,1.0),uExponent)*0.5;bool crossing=(seg.y>p.y!=seg.w>p.y)&&(p.x<(seg.z-seg.x)*(p.y-seg.y)/(seg.w-seg.y)+seg.x);bool crossingUp=crossing&&vLineSegment.y<vLineSegment.w;gl_FragColor=vec4(crossingUp ? 1.0/255.0 : 0.0,crossing&&!crossingUp ? 1.0/255.0 : 0.0,0.0,val);}",M="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){vec4 color=texture2D(tex,vUV);bool inside=color.r!=color.g;float val=inside ? 1.0-color.a : color.a;gl_FragColor=vec4(val);}",S=new Float32Array([0,0,2,0,0,2]),T=null,E=!1,C={},A=new WeakMap;function D(V){if(!E&&!H(V))throw new Error("WebGL generation not supported")}function R(V,U,k,X,re,q,ee){if(q===void 0&&(q=1),ee===void 0&&(ee=null),!ee&&(ee=T,!ee)){var $=typeof OffscreenCanvas=="function"?new OffscreenCanvas(1,1):typeof document<"u"?document.createElement("canvas"):null;if(!$)throw new Error("OffscreenCanvas or DOM canvas not supported");ee=T=$.getContext("webgl",{depth:!1})}D(ee);var ne=new Uint8Array(V*U*4);u(ee,function(we){var le=we.gl,ve=we.withTexture,ie=we.withTextureFramebuffer;ve("readable",function(Ce,Pe){le.texImage2D(le.TEXTURE_2D,0,le.RGBA,V,U,0,le.RGBA,le.UNSIGNED_BYTE,null),ie(Ce,Pe,function(Ne){O(V,U,k,X,re,q,le,Ne,0,0,0),le.readPixels(0,0,V,U,le.RGBA,le.UNSIGNED_BYTE,ne)})})});for(var ce=new Uint8Array(V*U),pe=0,ge=0;pe<ne.length;pe+=4)ce[ge++]=ne[pe];return ce}function L(V,U,k,X,re,q,ee,$,ne,ce){q===void 0&&(q=1),$===void 0&&($=0),ne===void 0&&(ne=0),ce===void 0&&(ce=0),O(V,U,k,X,re,q,ee,null,$,ne,ce)}function O(V,U,k,X,re,q,ee,$,ne,ce,pe){q===void 0&&(q=1),ne===void 0&&(ne=0),ce===void 0&&(ce=0),pe===void 0&&(pe=0),D(ee);var ge=[];s(k,function(we,le,ve,ie){ge.push(we,le,ve,ie)}),ge=new Float32Array(ge),u(ee,function(we){var le=we.gl,ve=we.isWebGL2,ie=we.getExtension,Ce=we.withProgram,Pe=we.withTexture,Ne=we.withTextureFramebuffer,be=we.handleContextLoss;if(Pe("rawDistances",function(Le,Fe){(V!==Le._lastWidth||U!==Le._lastHeight)&&le.texImage2D(le.TEXTURE_2D,0,le.RGBA,Le._lastWidth=V,Le._lastHeight=U,0,le.RGBA,le.UNSIGNED_BYTE,null),Ce("main",x,_,function(K){var B=K.setAttribute,G=K.setUniform,oe=!ve&&ie("ANGLE_instanced_arrays"),fe=!ve&&ie("EXT_blend_minmax");B("aUV",2,le.STATIC_DRAW,0,S),B("aLineSegment",4,le.DYNAMIC_DRAW,1,ge),G.apply(void 0,["4f","uGlyphBounds"].concat(X)),G("1f","uMaxDistance",re),G("1f","uExponent",q),Ne(Le,Fe,function(W){le.enable(le.BLEND),le.colorMask(!0,!0,!0,!0),le.viewport(0,0,V,U),le.scissor(0,0,V,U),le.blendFunc(le.ONE,le.ONE),le.blendEquationSeparate(le.FUNC_ADD,ve?le.MAX:fe.MAX_EXT),le.clear(le.COLOR_BUFFER_BIT),ve?le.drawArraysInstanced(le.TRIANGLES,0,3,ge.length/4):oe.drawArraysInstancedANGLE(le.TRIANGLES,0,3,ge.length/4)})}),Ce("post",a,M,function(K){K.setAttribute("aUV",2,le.STATIC_DRAW,0,S),K.setUniform("1i","tex",Fe),le.bindFramebuffer(le.FRAMEBUFFER,$),le.disable(le.BLEND),le.colorMask(pe===0,pe===1,pe===2,pe===3),le.viewport(ne,ce,V,U),le.scissor(ne,ce,V,U),le.drawArrays(le.TRIANGLES,0,3)})}),le.isContextLost())throw be(),new Error("webgl context lost")})}function H(V){var U=!V||V===T?C:V.canvas||V,k=A.get(U);if(k===void 0){E=!0;var X=null;try{var re=[97,106,97,61,99,137,118,80,80,118,137,99,61,97,106,97],q=R(4,4,"M8,8L16,8L24,24L16,24Z",[0,0,32,32],24,1,V);k=q&&re.length===q.length&&q.every(function(ee,$){return ee===re[$]}),k||(X="bad trial run results",console.info(re,q))}catch(ee){k=!1,X=ee.message}X&&console.warn("WebGL SDF generation not supported:",X),E=!1,A.set(U,k)}return k}var j=Object.freeze({__proto__:null,generate:R,generateIntoCanvas:L,generateIntoFramebuffer:O,isSupported:H});function Y(V,U,k,X,re,q){re===void 0&&(re=Math.max(X[2]-X[0],X[3]-X[1])/2),q===void 0&&(q=1);try{return R.apply(j,arguments)}catch(ee){return console.info("WebGL SDF generation failed, falling back to JS",ee),p.apply(y,arguments)}}function z(V,U,k,X,re,q,ee,$,ne,ce){re===void 0&&(re=Math.max(X[2]-X[0],X[3]-X[1])/2),q===void 0&&(q=1),$===void 0&&($=0),ne===void 0&&(ne=0),ce===void 0&&(ce=0);try{return L.apply(j,arguments)}catch(pe){return console.info("WebGL SDF generation failed, falling back to JS",pe),v.apply(y,arguments)}}return t.forEachPathCommand=n,t.generate=Y,t.generateIntoCanvas=z,t.javascript=y,t.pathToLineSegments=s,t.webgl=j,t.webglUtils=f,Object.defineProperty(t,"__esModule",{value:!0}),t}({});return e}function Sqe(){var e=function(t){var i={R:"13k,1a,2,3,3,2+1j,ch+16,a+1,5+2,2+n,5,a,4,6+16,4+3,h+1b,4mo,179q,2+9,2+11,2i9+7y,2+68,4,3+4,5+13,4+3,2+4k,3+29,8+cf,1t+7z,w+17,3+3m,1t+3z,16o1+5r,8+30,8+mc,29+1r,29+4v,75+73",EN:"1c+9,3d+1,6,187+9,513,4+5,7+9,sf+j,175h+9,qw+q,161f+1d,4xt+a,25i+9",ES:"17,2,6dp+1,f+1,av,16vr,mx+1,4o,2",ET:"z+2,3h+3,b+1,ym,3e+1,2o,p4+1,8,6u,7c,g6,1wc,1n9+4,30+1b,2n,6d,qhx+1,h0m,a+1,49+2,63+1,4+1,6bb+3,12jj",AN:"16o+5,2j+9,2+1,35,ed,1ff2+9,87+u",CS:"18,2+1,b,2u,12k,55v,l,17v0,2,3,53,2+1,b",B:"a,3,f+2,2v,690",S:"9,2,k",WS:"c,k,4f4,1vk+a,u,1j,335",ON:"x+1,4+4,h+5,r+5,r+3,z,5+3,2+1,2+1,5,2+2,3+4,o,w,ci+1,8+d,3+d,6+8,2+g,39+1,9,6+1,2,33,b8,3+1,3c+1,7+1,5r,b,7h+3,sa+5,2,3i+6,jg+3,ur+9,2v,ij+1,9g+9,7+a,8m,4+1,49+x,14u,2+2,c+2,e+2,e+2,e+1,i+n,e+e,2+p,u+2,e+2,36+1,2+3,2+1,b,2+2,6+5,2,2,2,h+1,5+4,6+3,3+f,16+2,5+3l,3+81,1y+p,2+40,q+a,m+13,2r+ch,2+9e,75+hf,3+v,2+2w,6e+5,f+6,75+2a,1a+p,2+2g,d+5x,r+b,6+3,4+o,g,6+1,6+2,2k+1,4,2j,5h+z,1m+1,1e+f,t+2,1f+e,d+3,4o+3,2s+1,w,535+1r,h3l+1i,93+2,2s,b+1,3l+x,2v,4g+3,21+3,kz+1,g5v+1,5a,j+9,n+v,2,3,2+8,2+1,3+2,2,3,46+1,4+4,h+5,r+5,r+a,3h+2,4+6,b+4,78,1r+24,4+c,4,1hb,ey+6,103+j,16j+c,1ux+7,5+g,fsh,jdq+1t,4,57+2e,p1,1m,1m,1m,1m,4kt+1,7j+17,5+2r,d+e,3+e,2+e,2+10,m+4,w,1n+5,1q,4z+5,4b+rb,9+c,4+c,4+37,d+2g,8+b,l+b,5+1j,9+9,7+13,9+t,3+1,27+3c,2+29,2+3q,d+d,3+4,4+2,6+6,a+o,8+6,a+2,e+6,16+42,2+1i",BN:"0+8,6+d,2s+5,2+p,e,4m9,1kt+2,2b+5,5+5,17q9+v,7k,6p+8,6+1,119d+3,440+7,96s+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+75,6p+2rz,1ben+1,1ekf+1,1ekf+1",NSM:"lc+33,7o+6,7c+18,2,2+1,2+1,2,21+a,1d+k,h,2u+6,3+5,3+1,2+3,10,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,g+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+g,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,k1+w,2db+2,3y,2p+v,ff+3,30+1,n9x+3,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,r2,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+5,3+1,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2d+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,f0c+4,1o+6,t5,1s+3,2a,f5l+1,43t+2,i+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,gzhy+6n",AL:"16w,3,2,e+1b,z+2,2+2s,g+1,8+1,b+m,2+t,s+2i,c+e,4h+f,1d+1e,1bwe+dp,3+3z,x+c,2+1,35+3y,2rm+z,5+7,b+5,dt+l,c+u,17nl+27,1t+27,4x+6n,3+d",LRO:"6ct",RLO:"6cu",LRE:"6cq",RLE:"6cr",PDF:"6cs",LRI:"6ee",RLI:"6ef",FSI:"6eg",PDI:"6eh"},r={},n={};r.L=1,n[1]="L",Object.keys(i).forEach(function(be,Le){r[be]=1<<Le+1,n[r[be]]=be}),Object.freeze(r);var s=r.LRI|r.RLI|r.FSI,a=r.L|r.R|r.AL,o=r.B|r.S|r.WS|r.ON|r.FSI|r.LRI|r.RLI|r.PDI,l=r.BN|r.RLE|r.LRE|r.RLO|r.LRO|r.PDF,c=r.S|r.WS|r.B|s|r.PDI|l,u=null;function h(){if(!u){u=new Map;var be=function(Fe){if(i.hasOwnProperty(Fe)){var K=0;i[Fe].split(",").forEach(function(B){var G=B.split("+"),oe=G[0],fe=G[1];oe=parseInt(oe,36),fe=fe?parseInt(fe,36):0,u.set(K+=oe,r[Fe]);for(var W=0;W<fe;W++)u.set(++K,r[Fe])})}};for(var Le in i)be(Le)}}function d(be){return h(),u.get(be.codePointAt(0))||r.L}function f(be){return n[d(be)]}var p={pairs:"14>1,1e>2,u>2,2wt>1,1>1,1ge>1,1wp>1,1j>1,f>1,hm>1,1>1,u>1,u6>1,1>1,+5,28>1,w>1,1>1,+3,b8>1,1>1,+3,1>3,-1>-1,3>1,1>1,+2,1s>1,1>1,x>1,th>1,1>1,+2,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,4q>1,1e>2,u>2,2>1,+1",canonical:"6f1>-6dx,6dy>-6dx,6ec>-6ed,6ee>-6ed,6ww>2jj,-2ji>2jj,14r4>-1e7l,1e7m>-1e7l,1e7m>-1e5c,1e5d>-1e5b,1e5c>-14qx,14qy>-14qx,14vn>-1ecg,1ech>-1ecg,1edu>-1ecg,1eci>-1ecg,1eda>-1ecg,1eci>-1ecg,1eci>-168q,168r>-168q,168s>-14ye,14yf>-14ye"};function v(be,Le){var Fe=36,K=0,B=new Map,G=Le&&new Map,oe;return be.split(",").forEach(function fe(W){if(W.indexOf("+")!==-1)for(var Ie=+W;Ie--;)fe(oe);else{oe=W;var Oe=W.split(">"),Be=Oe[0],Re=Oe[1];Be=String.fromCodePoint(K+=parseInt(Be,Fe)),Re=String.fromCodePoint(K+=parseInt(Re,Fe)),B.set(Be,Re),Le&&G.set(Re,Be)}}),{map:B,reverseMap:G}}var m,g,y;function x(){if(!m){var be=v(p.pairs,!0),Le=be.map,Fe=be.reverseMap;m=Le,g=Fe,y=v(p.canonical,!1).map}}function _(be){return x(),m.get(be)||null}function M(be){return x(),g.get(be)||null}function S(be){return x(),y.get(be)||null}var T=r.L,E=r.R,C=r.EN,A=r.ES,D=r.ET,R=r.AN,L=r.CS,O=r.B,H=r.S,j=r.ON,Y=r.BN,z=r.NSM,V=r.AL,U=r.LRO,k=r.RLO,X=r.LRE,re=r.RLE,q=r.PDF,ee=r.LRI,$=r.RLI,ne=r.FSI,ce=r.PDI;function pe(be,Le){for(var Fe=125,K=new Uint32Array(be.length),B=0;B<be.length;B++)K[B]=d(be[B]);var G=new Map;function oe(is,ma){var nn=K[is];K[is]=ma,G.set(nn,G.get(nn)-1),nn&o&&G.set(o,G.get(o)-1),G.set(ma,(G.get(ma)||0)+1),ma&o&&G.set(o,(G.get(o)||0)+1)}for(var fe=new Uint8Array(be.length),W=new Map,Ie=[],Oe=null,Be=0;Be<be.length;Be++)Oe||Ie.push(Oe={start:Be,end:be.length-1,level:Le==="rtl"?1:Le==="ltr"?0:ng(Be,!1)}),K[Be]&O&&(Oe.end=Be,Oe=null);for(var Re=re|X|k|U|s|ce|q|O,ke=function(is){return is+(is&1?1:2)},qe=function(is){return is+(is&1?2:1)},Ke=0;Ke<Ie.length;Ke++){Oe=Ie[Ke];var it=[{_level:Oe.level,_override:0,_isolate:0}],He=void 0,de=0,We=0,dt=0;G.clear();for(var J=Oe.start;J<=Oe.end;J++){var xe=K[J];if(He=it[it.length-1],G.set(xe,(G.get(xe)||0)+1),xe&o&&G.set(o,(G.get(o)||0)+1),xe&Re)if(xe&(re|X)){fe[J]=He._level;var me=(xe===re?qe:ke)(He._level);me<=Fe&&!de&&!We?it.push({_level:me,_override:0,_isolate:0}):de||We++}else if(xe&(k|U)){fe[J]=He._level;var ze=(xe===k?qe:ke)(He._level);ze<=Fe&&!de&&!We?it.push({_level:ze,_override:xe&k?E:T,_isolate:0}):de||We++}else if(xe&s){xe&ne&&(xe=ng(J+1,!0)===1?$:ee),fe[J]=He._level,He._override&&oe(J,He._override);var Ze=(xe===$?qe:ke)(He._level);Ze<=Fe&&de===0&&We===0?(dt++,it.push({_level:Ze,_override:0,_isolate:1,_isolInitIndex:J})):de++}else if(xe&ce){if(de>0)de--;else if(dt>0){for(We=0;!it[it.length-1]._isolate;)it.pop();var Je=it[it.length-1]._isolInitIndex;Je!=null&&(W.set(Je,J),W.set(J,Je)),it.pop(),dt--}He=it[it.length-1],fe[J]=He._level,He._override&&oe(J,He._override)}else xe&q?(de===0&&(We>0?We--:!He._isolate&&it.length>1&&(it.pop(),He=it[it.length-1])),fe[J]=He._level):xe&O&&(fe[J]=Oe.level);else fe[J]=He._level,He._override&&xe!==Y&&oe(J,He._override)}for(var mt=[],St=null,Mt=Oe.start;Mt<=Oe.end;Mt++){var vt=K[Mt];if(!(vt&l)){var ui=fe[Mt],hi=vt&s,$i=vt===ce;St&&ui===St._level?(St._end=Mt,St._endsWithIsolInit=hi):mt.push(St={_start:Mt,_end:Mt,_level:ui,_startsWithPDI:$i,_endsWithIsolInit:hi})}}for(var xn=[],Or=0;Or<mt.length;Or++){var zr=mt[Or];if(!zr._startsWithPDI||zr._startsWithPDI&&!W.has(zr._start)){for(var ue=[St=zr],Xe=void 0;St&&St._endsWithIsolInit&&(Xe=W.get(St._end))!=null;)for(var et=Or+1;et<mt.length;et++)if(mt[et]._start===Xe){ue.push(St=mt[et]);break}for(var Ge=[],nt=0;nt<ue.length;nt++)for(var It=ue[nt],jt=It._start;jt<=It._end;jt++)Ge.push(jt);for(var Jt=fe[Ge[0]],Vt=Oe.level,Ei=Ge[0]-1;Ei>=0;Ei--)if(!(K[Ei]&l)){Vt=fe[Ei];break}var li=Ge[Ge.length-1],fi=fe[li],si=Oe.level;if(!(K[li]&s)){for(var se=li+1;se<=Oe.end;se++)if(!(K[se]&l)){si=fe[se];break}}xn.push({_seqIndices:Ge,_sosType:Math.max(Vt,Jt)%2?E:T,_eosType:Math.max(si,fi)%2?E:T})}}for(var Ue=0;Ue<xn.length;Ue++){var Qe=xn[Ue],Ae=Qe._seqIndices,De=Qe._sosType,pt=Qe._eosType,lt=fe[Ae[0]]&1?E:T;if(G.get(z))for(var bt=0;bt<Ae.length;bt++){var Et=Ae[bt];if(K[Et]&z){for(var Ft=De,zt=bt-1;zt>=0;zt--)if(!(K[Ae[zt]]&l)){Ft=K[Ae[zt]];break}oe(Et,Ft&(s|ce)?j:Ft)}}if(G.get(C))for(var Q=0;Q<Ae.length;Q++){var te=Ae[Q];if(K[te]&C)for(var ye=Q-1;ye>=-1;ye--){var ae=ye===-1?De:K[Ae[ye]];if(ae&a){ae===V&&oe(te,R);break}}}if(G.get(V))for(var Ee=0;Ee<Ae.length;Ee++){var rt=Ae[Ee];K[rt]&V&&oe(rt,E)}if(G.get(A)||G.get(L))for(var Ct=1;Ct<Ae.length-1;Ct++){var Di=Ae[Ct];if(K[Di]&(A|L)){for(var pi=0,qr=0,es=Ct-1;es>=0&&(pi=K[Ae[es]],!!(pi&l));es--);for(var xr=Ct+1;xr<Ae.length&&(qr=K[Ae[xr]],!!(qr&l));xr++);pi===qr&&(K[Di]===A?pi===C:pi&(C|R))&&oe(Di,pi)}}if(G.get(C))for(var Bn=0;Bn<Ae.length;Bn++){var Li=Ae[Bn];if(K[Li]&C){for(var Fn=Bn-1;Fn>=0&&K[Ae[Fn]]&(D|l);Fn--)oe(Ae[Fn],C);for(Bn++;Bn<Ae.length&&K[Ae[Bn]]&(D|l|C);Bn++)K[Ae[Bn]]!==C&&oe(Ae[Bn],C)}}if(G.get(D)||G.get(A)||G.get(L))for(var wn=0;wn<Ae.length;wn++){var bn=Ae[wn];if(K[bn]&(D|A|L)){oe(bn,j);for(var Dr=wn-1;Dr>=0&&K[Ae[Dr]]&l;Dr--)oe(Ae[Dr],j);for(var po=wn+1;po<Ae.length&&K[Ae[po]]&l;po++)oe(Ae[po],j)}}if(G.get(C))for(var ws=0,Of=De;ws<Ae.length;ws++){var i_=Ae[ws],Ay=K[i_];Ay&C?Of===T&&oe(i_,T):Ay&a&&(Of=Ay)}if(G.get(o)){var gu=E|C|R,tg=gu|T,pc=[];{for(var Gh=[],mc=0;mc<Ae.length;mc++)if(K[Ae[mc]]&o){var Oi=be[Ae[mc]],Ty=void 0;if(_(Oi)!==null)if(Gh.length<63)Gh.push({char:Oi,seqIndex:mc});else break;else if((Ty=M(Oi))!==null)for(var vu=Gh.length-1;vu>=0;vu--){var ig=Gh[vu].char;if(ig===Ty||ig===M(S(Oi))||_(S(ig))===Oi){pc.push([Gh[vu].seqIndex,mc]),Gh.length=vu;break}}}pc.sort(function(is,ma){return is[0]-ma[0]})}for(var Cy=0;Cy<pc.length;Cy++){for(var r_=pc[Cy],Br=r_[0],zf=r_[1],n_=!1,da=0,Py=Br+1;Py<zf;Py++){var Bf=Ae[Py];if(K[Bf]&tg){n_=!0;var mo=K[Bf]&gu?E:T;if(mo===lt){da=mo;break}}}if(n_&&!da){da=De;for(var Dy=Br-1;Dy>=0;Dy--){var s_=Ae[Dy];if(K[s_]&tg){var go=K[s_]&gu?E:T;go!==lt?da=go:da=lt;break}}}if(da){if(K[Ae[Br]]=K[Ae[zf]]=da,da!==lt){for(var fa=Br+1;fa<Ae.length;fa++)if(!(K[Ae[fa]]&l)){d(be[Ae[fa]])&z&&(K[Ae[fa]]=da);break}}if(da!==lt){for(var gc=zf+1;gc<Ae.length;gc++)if(!(K[Ae[gc]]&l)){d(be[Ae[gc]])&z&&(K[Ae[gc]]=da);break}}}}for(var Vo=0;Vo<Ae.length;Vo++)if(K[Ae[Vo]]&o){for(var Ry=Vo,Iy=Vo,Va=De,Ff=Vo-1;Ff>=0;Ff--)if(K[Ae[Ff]]&l)Ry=Ff;else{Va=K[Ae[Ff]]&gu?E:T;break}for(var Uf=pt,Nf=Vo+1;Nf<Ae.length;Nf++)if(K[Ae[Nf]]&(o|l))Iy=Nf;else{Uf=K[Ae[Nf]]&gu?E:T;break}for(var pa=Ry;pa<=Iy;pa++)K[Ae[pa]]=Va===Uf?Va:lt;Vo=Iy}}}for(var ts=Oe.start;ts<=Oe.end;ts++){var rg=fe[ts],Sl=K[ts];if(rg&1?Sl&(T|C|R)&&fe[ts]++:Sl&E?fe[ts]++:Sl&(R|C)&&(fe[ts]+=2),Sl&l&&(fe[ts]=ts===0?Oe.level:fe[ts-1]),ts===Oe.end||d(be[ts])&(H|O))for(var Hh=ts;Hh>=0&&d(be[Hh])&c;Hh--)fe[Hh]=Oe.level}}return{levels:fe,paragraphs:Ie};function ng(is,ma){for(var nn=is;nn<be.length;nn++){var sn=K[nn];if(sn&(E|V))return 1;if(sn&(O|T)||ma&&sn===ce)return 0;if(sn&s){var vo=a_(nn);nn=vo===-1?be.length:vo}}return 0}function a_(is){for(var ma=1,nn=is+1;nn<be.length;nn++){var sn=K[nn];if(sn&O)break;if(sn&ce){if(--ma===0)return nn}else sn&s&&ma++}return-1}}var ge="14>1,j>2,t>2,u>2,1a>g,2v3>1,1>1,1ge>1,1wd>1,b>1,1j>1,f>1,ai>3,-2>3,+1,8>1k0,-1jq>1y7,-1y6>1hf,-1he>1h6,-1h5>1ha,-1h8>1qi,-1pu>1,6>3u,-3s>7,6>1,1>1,f>1,1>1,+2,3>1,1>1,+13,4>1,1>1,6>1eo,-1ee>1,3>1mg,-1me>1mk,-1mj>1mi,-1mg>1mi,-1md>1,1>1,+2,1>10k,-103>1,1>1,4>1,5>1,1>1,+10,3>1,1>8,-7>8,+1,-6>7,+1,a>1,1>1,u>1,u6>1,1>1,+5,26>1,1>1,2>1,2>2,8>1,7>1,4>1,1>1,+5,b8>1,1>1,+3,1>3,-2>1,2>1,1>1,+2,c>1,3>1,1>1,+2,h>1,3>1,a>1,1>1,2>1,3>1,1>1,d>1,f>1,3>1,1a>1,1>1,6>1,7>1,13>1,k>1,1>1,+19,4>1,1>1,+2,2>1,1>1,+18,m>1,a>1,1>1,lk>1,1>1,4>1,2>1,f>1,3>1,1>1,+3,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,6>1,4j>1,j>2,t>2,u>2,2>1,+1",we;function le(){if(!we){var be=v(ge,!0),Le=be.map,Fe=be.reverseMap;Fe.forEach(function(K,B){Le.set(B,K)}),we=Le}}function ve(be){return le(),we.get(be)||null}function ie(be,Le,Fe,K){var B=be.length;Fe=Math.max(0,Fe==null?0:+Fe),K=Math.min(B-1,K==null?B-1:+K);for(var G=new Map,oe=Fe;oe<=K;oe++)if(Le[oe]&1){var fe=ve(be[oe]);fe!==null&&G.set(oe,fe)}return G}function Ce(be,Le,Fe,K){var B=be.length;Fe=Math.max(0,Fe==null?0:+Fe),K=Math.min(B-1,K==null?B-1:+K);var G=[];return Le.paragraphs.forEach(function(oe){var fe=Math.max(Fe,oe.start),W=Math.min(K,oe.end);if(fe<W){for(var Ie=Le.levels.slice(fe,W+1),Oe=W;Oe>=fe&&d(be[Oe])&c;Oe--)Ie[Oe]=oe.level;for(var Be=oe.level,Re=1/0,ke=0;ke<Ie.length;ke++){var qe=Ie[ke];qe>Be&&(Be=qe),qe<Re&&(Re=qe|1)}for(var Ke=Be;Ke>=Re;Ke--)for(var it=0;it<Ie.length;it++)if(Ie[it]>=Ke){for(var He=it;it+1<Ie.length&&Ie[it+1]>=Ke;)it++;it>He&&G.push([He+fe,it+fe])}}}),G}function Pe(be,Le,Fe,K){var B=Ne(be,Le,Fe,K),G=[].concat(be);return B.forEach(function(oe,fe){G[fe]=(Le.levels[oe]&1?ve(be[oe]):null)||be[oe]}),G.join("")}function Ne(be,Le,Fe,K){for(var B=Ce(be,Le,Fe,K),G=[],oe=0;oe<be.length;oe++)G[oe]=oe;return B.forEach(function(fe){for(var W=fe[0],Ie=fe[1],Oe=G.slice(W,Ie+1),Be=Oe.length;Be--;)G[Ie-Be]=Oe[Be]}),G}return t.closingToOpeningBracket=M,t.getBidiCharType=d,t.getBidiCharTypeName=f,t.getCanonicalBracket=S,t.getEmbeddingLevels=pe,t.getMirroredCharacter=ve,t.getMirroredCharactersMap=ie,t.getReorderSegments=Ce,t.getReorderedIndices=Ne,t.getReorderedString=Pe,t.openingToClosingBracket=_,Object.defineProperty(t,"__esModule",{value:!0}),t}({});return e}const hae=/\bvoid\s+main\s*\(\s*\)\s*{/g;function fF(e){const t=/^[ \t]*#include +<([\w\d./]+)>/gm;function i(r,n){let s=Ai[n];return s?fF(s):r}return e.replace(t,i)}const Ms=[];for(let e=0;e<256;e++)Ms[e]=(e<16?"0":"")+e.toString(16);function Mqe(){const e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,i=Math.random()*4294967295|0,r=Math.random()*4294967295|0;return(Ms[e&255]+Ms[e>>8&255]+Ms[e>>16&255]+Ms[e>>24&255]+"-"+Ms[t&255]+Ms[t>>8&255]+"-"+Ms[t>>16&15|64]+Ms[t>>24&255]+"-"+Ms[i&63|128]+Ms[i>>8&255]+"-"+Ms[i>>16&255]+Ms[i>>24&255]+Ms[r&255]+Ms[r>>8&255]+Ms[r>>16&255]+Ms[r>>24&255]).toUpperCase()}const yp=Object.assign||function(){let e=arguments[0];for(let t=1,i=arguments.length;t<i;t++){let r=arguments[t];if(r)for(let n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Eqe=Date.now(),sY=new WeakMap,aY=new Map;let Aqe=1e10;function pF(e,t){const i=Dqe(t);let r=sY.get(e);if(r||sY.set(e,r=Object.create(null)),r[i])return new r[i];const n=`_onBeforeCompile${i}`,s=function(c,u){e.onBeforeCompile.call(this,c,u);const h=this.customProgramCacheKey()+"|"+c.vertexShader+"|"+c.fragmentShader;let d=aY[h];if(!d){const f=Tqe(this,c,t,i);d=aY[h]=f}c.vertexShader=d.vertexShader,c.fragmentShader=d.fragmentShader,yp(c.uniforms,this.uniforms),t.timeUniform&&(c.uniforms[t.timeUniform]={get value(){return Date.now()-Eqe}}),this[n]&&this[n](c)},a=function(){return o(t.chained?e:e.clone())},o=function(c){const u=Object.create(c,l);return Object.defineProperty(u,"baseMaterial",{value:e}),Object.defineProperty(u,"id",{value:Aqe++}),u.uuid=Mqe(),u.uniforms=yp({},c.uniforms,t.uniforms),u.defines=yp({},c.defines,t.defines),u.defines[`TROIKA_DERIVED_MATERIAL_${i}`]="",u.extensions=yp({},c.extensions,t.extensions),u._listeners=void 0,u},l={constructor:{value:a},isDerivedMaterial:{value:!0},type:{get:()=>e.type,set:c=>{e.type=c}},isDerivedFrom:{writable:!0,configurable:!0,value:function(c){const u=this.baseMaterial;return c===u||u.isDerivedMaterial&&u.isDerivedFrom(c)||!1}},customProgramCacheKey:{writable:!0,configurable:!0,value:function(){return e.customProgramCacheKey()+"|"+i}},onBeforeCompile:{get(){return s},set(c){this[n]=c}},copy:{writable:!0,configurable:!0,value:function(c){return e.copy.call(this,c),!e.isShaderMaterial&&!e.isDerivedMaterial&&(yp(this.extensions,c.extensions),yp(this.defines,c.defines),yp(this.uniforms,K4.clone(c.uniforms))),this}},clone:{writable:!0,configurable:!0,value:function(){const c=new e.constructor;return o(c).copy(this)}},getDepthMaterial:{writable:!0,configurable:!0,value:function(){let c=this._depthMaterial;return c||(c=this._depthMaterial=pF(e.isDerivedMaterial?e.getDepthMaterial():new PP({depthPacking:X4}),t),c.defines.IS_DEPTH_MATERIAL="",c.uniforms=this.uniforms),c}},getDistanceMaterial:{writable:!0,configurable:!0,value:function(){let c=this._distanceMaterial;return c||(c=this._distanceMaterial=pF(e.isDerivedMaterial?e.getDistanceMaterial():new DP,t),c.defines.IS_DISTANCE_MATERIAL="",c.uniforms=this.uniforms),c}},dispose:{writable:!0,configurable:!0,value(){const{_depthMaterial:c,_distanceMaterial:u}=this;c&&c.dispose(),u&&u.dispose(),e.dispose.call(this)}}};return r[i]=a,new a}function Tqe(e,{vertexShader:t,fragmentShader:i},r,n){let{vertexDefs:s,vertexMainIntro:a,vertexMainOutro:o,vertexTransform:l,fragmentDefs:c,fragmentMainIntro:u,fragmentMainOutro:h,fragmentColorTransform:d,customRewriter:f,timeUniform:p}=r;if(s=s||"",a=a||"",o=o||"",c=c||"",u=u||"",h=h||"",(l||f)&&(t=fF(t)),(d||f)&&(i=i.replace(/^[ \t]*#include <((?:tonemapping|encodings|colorspace|fog|premultiplied_alpha|dithering)_fragment)>/gm,`
//!BEGIN_POST_CHUNK $1
$&
//!END_POST_CHUNK
`),i=fF(i)),f){let v=f({vertexShader:t,fragmentShader:i});t=v.vertexShader,i=v.fragmentShader}if(d){let v=[];i=i.replace(/^\/\/!BEGIN_POST_CHUNK[^]+?^\/\/!END_POST_CHUNK/gm,m=>(v.push(m),"")),h=`${d}
${v.join(`
`)}
${h}`}if(p){const v=`
uniform float ${p};
`;s=v+s,c=v+c}return l&&(t=`vec3 troika_position_${n};
vec3 troika_normal_${n};
vec2 troika_uv_${n};
${t}
`,s=`${s}
void troikaVertexTransform${n}(inout vec3 position, inout vec3 normal, inout vec2 uv) {
  ${l}
}
`,a=`
troika_position_${n} = vec3(position);
troika_normal_${n} = vec3(normal);
troika_uv_${n} = vec2(uv);
troikaVertexTransform${n}(troika_position_${n}, troika_normal_${n}, troika_uv_${n});
${a}
`,t=t.replace(/\b(position|normal|uv)\b/g,(v,m,g,y)=>/\battribute\s+vec[23]\s+$/.test(y.substr(0,g))?m:`troika_${m}_${n}`),e.map&&e.map.channel>0||(t=t.replace(/\bMAP_UV\b/g,`troika_uv_${n}`))),t=oY(t,n,s,a,o),i=oY(i,n,c,u,h),{vertexShader:t,fragmentShader:i}}function oY(e,t,i,r,n){return(r||n||i)&&(e=e.replace(hae,`
${i}
void troikaOrigMain${t}() {`),e+=`
void main() {
  ${r}
  troikaOrigMain${t}();
  ${n}
}`),e}function Cqe(e,t){return e==="uniforms"?void 0:typeof t=="function"?t.toString():t}let Pqe=0;const lY=new Map;function Dqe(e){const t=JSON.stringify(e,Cqe);let i=lY.get(t);return i==null&&lY.set(t,i=++Pqe),i}/*!
Custom build of Typr.ts (https://github.com/fredli74/Typr.ts) for use in Troika text rendering.
Original MIT license applies: https://github.com/fredli74/Typr.ts/blob/master/LICENSE
*/function Rqe(){return typeof window>"u"&&(self.window=self),function(e){var t={parse:function(n){var s=t._bin,a=new Uint8Array(n);if(s.readASCII(a,0,4)=="ttcf"){var o=4;s.readUshort(a,o),o+=2,s.readUshort(a,o),o+=2;var l=s.readUint(a,o);o+=4;for(var c=[],u=0;u<l;u++){var h=s.readUint(a,o);o+=4,c.push(t._readFont(a,h))}return c}return[t._readFont(a,0)]},_readFont:function(n,s){var a=t._bin,o=s;a.readFixed(n,s),s+=4;var l=a.readUshort(n,s);s+=2,a.readUshort(n,s),s+=2,a.readUshort(n,s),s+=2,a.readUshort(n,s),s+=2;for(var c=["cmap","head","hhea","maxp","hmtx","name","OS/2","post","loca","glyf","kern","CFF ","GDEF","GPOS","GSUB","SVG "],u={_data:n,_offset:o},h={},d=0;d<l;d++){var f=a.readASCII(n,s,4);s+=4,a.readUint(n,s),s+=4;var p=a.readUint(n,s);s+=4;var v=a.readUint(n,s);s+=4,h[f]={offset:p,length:v}}for(d=0;d<c.length;d++){var m=c[d];h[m]&&(u[m.trim()]=t[m.trim()].parse(n,h[m].offset,h[m].length,u))}return u},_tabOffset:function(n,s,a){for(var o=t._bin,l=o.readUshort(n,a+4),c=a+12,u=0;u<l;u++){var h=o.readASCII(n,c,4);c+=4,o.readUint(n,c),c+=4;var d=o.readUint(n,c);if(c+=4,o.readUint(n,c),c+=4,h==s)return d}return 0}};t._bin={readFixed:function(n,s){return(n[s]<<8|n[s+1])+(n[s+2]<<8|n[s+3])/65540},readF2dot14:function(n,s){return t._bin.readShort(n,s)/16384},readInt:function(n,s){return t._bin._view(n).getInt32(s)},readInt8:function(n,s){return t._bin._view(n).getInt8(s)},readShort:function(n,s){return t._bin._view(n).getInt16(s)},readUshort:function(n,s){return t._bin._view(n).getUint16(s)},readUshorts:function(n,s,a){for(var o=[],l=0;l<a;l++)o.push(t._bin.readUshort(n,s+2*l));return o},readUint:function(n,s){return t._bin._view(n).getUint32(s)},readUint64:function(n,s){return 4294967296*t._bin.readUint(n,s)+t._bin.readUint(n,s+4)},readASCII:function(n,s,a){for(var o="",l=0;l<a;l++)o+=String.fromCharCode(n[s+l]);return o},readUnicode:function(n,s,a){for(var o="",l=0;l<a;l++){var c=n[s++]<<8|n[s++];o+=String.fromCharCode(c)}return o},_tdec:typeof window<"u"&&window.TextDecoder?new window.TextDecoder:null,readUTF8:function(n,s,a){var o=t._bin._tdec;return o&&s==0&&a==n.length?o.decode(n):t._bin.readASCII(n,s,a)},readBytes:function(n,s,a){for(var o=[],l=0;l<a;l++)o.push(n[s+l]);return o},readASCIIArray:function(n,s,a){for(var o=[],l=0;l<a;l++)o.push(String.fromCharCode(n[s+l]));return o},_view:function(n){return n._dataView||(n._dataView=n.buffer?new DataView(n.buffer,n.byteOffset,n.byteLength):new DataView(new Uint8Array(n).buffer))}},t._lctf={},t._lctf.parse=function(n,s,a,o,l){var c=t._bin,u={},h=s;c.readFixed(n,s),s+=4;var d=c.readUshort(n,s);s+=2;var f=c.readUshort(n,s);s+=2;var p=c.readUshort(n,s);return s+=2,u.scriptList=t._lctf.readScriptList(n,h+d),u.featureList=t._lctf.readFeatureList(n,h+f),u.lookupList=t._lctf.readLookupList(n,h+p,l),u},t._lctf.readLookupList=function(n,s,a){var o=t._bin,l=s,c=[],u=o.readUshort(n,s);s+=2;for(var h=0;h<u;h++){var d=o.readUshort(n,s);s+=2;var f=t._lctf.readLookupTable(n,l+d,a);c.push(f)}return c},t._lctf.readLookupTable=function(n,s,a){var o=t._bin,l=s,c={tabs:[]};c.ltype=o.readUshort(n,s),s+=2,c.flag=o.readUshort(n,s),s+=2;var u=o.readUshort(n,s);s+=2;for(var h=c.ltype,d=0;d<u;d++){var f=o.readUshort(n,s);s+=2;var p=a(n,h,l+f,c);c.tabs.push(p)}return c},t._lctf.numOfOnes=function(n){for(var s=0,a=0;a<32;a++)n>>>a&1&&s++;return s},t._lctf.readClassDef=function(n,s){var a=t._bin,o=[],l=a.readUshort(n,s);if(s+=2,l==1){var c=a.readUshort(n,s);s+=2;var u=a.readUshort(n,s);s+=2;for(var h=0;h<u;h++)o.push(c+h),o.push(c+h),o.push(a.readUshort(n,s)),s+=2}if(l==2){var d=a.readUshort(n,s);for(s+=2,h=0;h<d;h++)o.push(a.readUshort(n,s)),s+=2,o.push(a.readUshort(n,s)),s+=2,o.push(a.readUshort(n,s)),s+=2}return o},t._lctf.getInterval=function(n,s){for(var a=0;a<n.length;a+=3){var o=n[a],l=n[a+1];if(n[a+2],o<=s&&s<=l)return a}return-1},t._lctf.readCoverage=function(n,s){var a=t._bin,o={};o.fmt=a.readUshort(n,s),s+=2;var l=a.readUshort(n,s);return s+=2,o.fmt==1&&(o.tab=a.readUshorts(n,s,l)),o.fmt==2&&(o.tab=a.readUshorts(n,s,3*l)),o},t._lctf.coverageIndex=function(n,s){var a=n.tab;if(n.fmt==1)return a.indexOf(s);if(n.fmt==2){var o=t._lctf.getInterval(a,s);if(o!=-1)return a[o+2]+(s-a[o])}return-1},t._lctf.readFeatureList=function(n,s){var a=t._bin,o=s,l=[],c=a.readUshort(n,s);s+=2;for(var u=0;u<c;u++){var h=a.readASCII(n,s,4);s+=4;var d=a.readUshort(n,s);s+=2;var f=t._lctf.readFeatureTable(n,o+d);f.tag=h.trim(),l.push(f)}return l},t._lctf.readFeatureTable=function(n,s){var a=t._bin,o=s,l={},c=a.readUshort(n,s);s+=2,c>0&&(l.featureParams=o+c);var u=a.readUshort(n,s);s+=2,l.tab=[];for(var h=0;h<u;h++)l.tab.push(a.readUshort(n,s+2*h));return l},t._lctf.readScriptList=function(n,s){var a=t._bin,o=s,l={},c=a.readUshort(n,s);s+=2;for(var u=0;u<c;u++){var h=a.readASCII(n,s,4);s+=4;var d=a.readUshort(n,s);s+=2,l[h.trim()]=t._lctf.readScriptTable(n,o+d)}return l},t._lctf.readScriptTable=function(n,s){var a=t._bin,o=s,l={},c=a.readUshort(n,s);s+=2,c>0&&(l.default=t._lctf.readLangSysTable(n,o+c));var u=a.readUshort(n,s);s+=2;for(var h=0;h<u;h++){var d=a.readASCII(n,s,4);s+=4;var f=a.readUshort(n,s);s+=2,l[d.trim()]=t._lctf.readLangSysTable(n,o+f)}return l},t._lctf.readLangSysTable=function(n,s){var a=t._bin,o={};a.readUshort(n,s),s+=2,o.reqFeature=a.readUshort(n,s),s+=2;var l=a.readUshort(n,s);return s+=2,o.features=a.readUshorts(n,s,l),o},t.CFF={},t.CFF.parse=function(n,s,a){var o=t._bin;(n=new Uint8Array(n.buffer,s,a))[s=0],n[++s],n[++s],n[++s],s++;var l=[];s=t.CFF.readIndex(n,s,l);for(var c=[],u=0;u<l.length-1;u++)c.push(o.readASCII(n,s+l[u],l[u+1]-l[u]));s+=l[l.length-1];var h=[];s=t.CFF.readIndex(n,s,h);var d=[];for(u=0;u<h.length-1;u++)d.push(t.CFF.readDict(n,s+h[u],s+h[u+1]));s+=h[h.length-1];var f=d[0],p=[];s=t.CFF.readIndex(n,s,p);var v=[];for(u=0;u<p.length-1;u++)v.push(o.readASCII(n,s+p[u],p[u+1]-p[u]));if(s+=p[p.length-1],t.CFF.readSubrs(n,s,f),f.CharStrings){s=f.CharStrings,p=[],s=t.CFF.readIndex(n,s,p);var m=[];for(u=0;u<p.length-1;u++)m.push(o.readBytes(n,s+p[u],p[u+1]-p[u]));f.CharStrings=m}if(f.ROS){s=f.FDArray;var g=[];for(s=t.CFF.readIndex(n,s,g),f.FDArray=[],u=0;u<g.length-1;u++){var y=t.CFF.readDict(n,s+g[u],s+g[u+1]);t.CFF._readFDict(n,y,v),f.FDArray.push(y)}s+=g[g.length-1],s=f.FDSelect,f.FDSelect=[];var x=n[s];if(s++,x!=3)throw x;var _=o.readUshort(n,s);for(s+=2,u=0;u<_+1;u++)f.FDSelect.push(o.readUshort(n,s),n[s+2]),s+=3}return f.Encoding&&(f.Encoding=t.CFF.readEncoding(n,f.Encoding,f.CharStrings.length)),f.charset&&(f.charset=t.CFF.readCharset(n,f.charset,f.CharStrings.length)),t.CFF._readFDict(n,f,v),f},t.CFF._readFDict=function(n,s,a){var o;for(var l in s.Private&&(o=s.Private[1],s.Private=t.CFF.readDict(n,o,o+s.Private[0]),s.Private.Subrs&&t.CFF.readSubrs(n,o+s.Private.Subrs,s.Private)),s)["FamilyName","FontName","FullName","Notice","version","Copyright"].indexOf(l)!=-1&&(s[l]=a[s[l]-426+35])},t.CFF.readSubrs=function(n,s,a){var o=t._bin,l=[];s=t.CFF.readIndex(n,s,l);var c,u=l.length;c=u<1240?107:u<33900?1131:32768,a.Bias=c,a.Subrs=[];for(var h=0;h<l.length-1;h++)a.Subrs.push(o.readBytes(n,s+l[h],l[h+1]-l[h]))},t.CFF.tableSE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,0,111,112,113,114,0,115,116,117,118,119,120,121,122,0,123,0,124,125,126,127,128,129,130,131,0,132,133,0,134,135,136,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,139,0,0,0,0,140,141,142,143,0,0,0,0,0,144,0,0,0,145,0,0,146,147,148,149,0,0,0,0],t.CFF.glyphByUnicode=function(n,s){for(var a=0;a<n.charset.length;a++)if(n.charset[a]==s)return a;return-1},t.CFF.glyphBySE=function(n,s){return s<0||s>255?-1:t.CFF.glyphByUnicode(n,t.CFF.tableSE[s])},t.CFF.readEncoding=function(n,s,a){t._bin;var o=[".notdef"],l=n[s];if(s++,l!=0)throw"error: unknown encoding format: "+l;var c=n[s];s++;for(var u=0;u<c;u++)o.push(n[s+u]);return o},t.CFF.readCharset=function(n,s,a){var o=t._bin,l=[".notdef"],c=n[s];if(s++,c==0)for(var u=0;u<a;u++){var h=o.readUshort(n,s);s+=2,l.push(h)}else{if(c!=1&&c!=2)throw"error: format: "+c;for(;l.length<a;){h=o.readUshort(n,s),s+=2;var d=0;for(c==1?(d=n[s],s++):(d=o.readUshort(n,s),s+=2),u=0;u<=d;u++)l.push(h),h++}}return l},t.CFF.readIndex=function(n,s,a){var o=t._bin,l=o.readUshort(n,s)+1,c=n[s+=2];if(s++,c==1)for(var u=0;u<l;u++)a.push(n[s+u]);else if(c==2)for(u=0;u<l;u++)a.push(o.readUshort(n,s+2*u));else if(c==3)for(u=0;u<l;u++)a.push(16777215&o.readUint(n,s+3*u-1));else if(l!=1)throw"unsupported offset size: "+c+", count: "+l;return(s+=l*c)-1},t.CFF.getCharString=function(n,s,a){var o=t._bin,l=n[s],c=n[s+1];n[s+2],n[s+3],n[s+4];var u=1,h=null,d=null;l<=20&&(h=l,u=1),l==12&&(h=100*l+c,u=2),21<=l&&l<=27&&(h=l,u=1),l==28&&(d=o.readShort(n,s+1),u=3),29<=l&&l<=31&&(h=l,u=1),32<=l&&l<=246&&(d=l-139,u=1),247<=l&&l<=250&&(d=256*(l-247)+c+108,u=2),251<=l&&l<=254&&(d=256*-(l-251)-c-108,u=2),l==255&&(d=o.readInt(n,s+1)/65535,u=5),a.val=d??"o"+h,a.size=u},t.CFF.readCharString=function(n,s,a){for(var o=s+a,l=t._bin,c=[];s<o;){var u=n[s],h=n[s+1];n[s+2],n[s+3],n[s+4];var d=1,f=null,p=null;u<=20&&(f=u,d=1),u==12&&(f=100*u+h,d=2),u!=19&&u!=20||(f=u,d=2),21<=u&&u<=27&&(f=u,d=1),u==28&&(p=l.readShort(n,s+1),d=3),29<=u&&u<=31&&(f=u,d=1),32<=u&&u<=246&&(p=u-139,d=1),247<=u&&u<=250&&(p=256*(u-247)+h+108,d=2),251<=u&&u<=254&&(p=256*-(u-251)-h-108,d=2),u==255&&(p=l.readInt(n,s+1)/65535,d=5),c.push(p??"o"+f),s+=d}return c},t.CFF.readDict=function(n,s,a){for(var o=t._bin,l={},c=[];s<a;){var u=n[s],h=n[s+1];n[s+2],n[s+3],n[s+4];var d=1,f=null,p=null;if(u==28&&(p=o.readShort(n,s+1),d=3),u==29&&(p=o.readInt(n,s+1),d=5),32<=u&&u<=246&&(p=u-139,d=1),247<=u&&u<=250&&(p=256*(u-247)+h+108,d=2),251<=u&&u<=254&&(p=256*-(u-251)-h-108,d=2),u==255)throw p=o.readInt(n,s+1)/65535,d=5,"unknown number";if(u==30){var v=[];for(d=1;;){var m=n[s+d];d++;var g=m>>4,y=15&m;if(g!=15&&v.push(g),y!=15&&v.push(y),y==15)break}for(var x="",_=[0,1,2,3,4,5,6,7,8,9,".","e","e-","reserved","-","endOfNumber"],M=0;M<v.length;M++)x+=_[v[M]];p=parseFloat(x)}u<=21&&(f=["version","Notice","FullName","FamilyName","Weight","FontBBox","BlueValues","OtherBlues","FamilyBlues","FamilyOtherBlues","StdHW","StdVW","escape","UniqueID","XUID","charset","Encoding","CharStrings","Private","Subrs","defaultWidthX","nominalWidthX"][u],d=1,u==12&&(f=["Copyright","isFixedPitch","ItalicAngle","UnderlinePosition","UnderlineThickness","PaintType","CharstringType","FontMatrix","StrokeWidth","BlueScale","BlueShift","BlueFuzz","StemSnapH","StemSnapV","ForceBold",0,0,"LanguageGroup","ExpansionFactor","initialRandomSeed","SyntheticBase","PostScript","BaseFontName","BaseFontBlend",0,0,0,0,0,0,"ROS","CIDFontVersion","CIDFontRevision","CIDFontType","CIDCount","UIDBase","FDArray","FDSelect","FontName"][h],d=2)),f!=null?(l[f]=c.length==1?c[0]:c,c=[]):c.push(p),s+=d}return l},t.cmap={},t.cmap.parse=function(n,s,a){n=new Uint8Array(n.buffer,s,a),s=0;var o=t._bin,l={};o.readUshort(n,s),s+=2;var c=o.readUshort(n,s);s+=2;var u=[];l.tables=[];for(var h=0;h<c;h++){var d=o.readUshort(n,s);s+=2;var f=o.readUshort(n,s);s+=2;var p=o.readUint(n,s);s+=4;var v="p"+d+"e"+f,m=u.indexOf(p);if(m==-1){var g;m=l.tables.length,u.push(p);var y=o.readUshort(n,p);y==0?g=t.cmap.parse0(n,p):y==4?g=t.cmap.parse4(n,p):y==6?g=t.cmap.parse6(n,p):y==12?g=t.cmap.parse12(n,p):console.debug("unknown format: "+y,d,f,p),l.tables.push(g)}if(l[v]!=null)throw"multiple tables for one platform+encoding";l[v]=m}return l},t.cmap.parse0=function(n,s){var a=t._bin,o={};o.format=a.readUshort(n,s),s+=2;var l=a.readUshort(n,s);s+=2,a.readUshort(n,s),s+=2,o.map=[];for(var c=0;c<l-6;c++)o.map.push(n[s+c]);return o},t.cmap.parse4=function(n,s){var a=t._bin,o=s,l={};l.format=a.readUshort(n,s),s+=2;var c=a.readUshort(n,s);s+=2,a.readUshort(n,s),s+=2;var u=a.readUshort(n,s);s+=2;var h=u/2;l.searchRange=a.readUshort(n,s),s+=2,l.entrySelector=a.readUshort(n,s),s+=2,l.rangeShift=a.readUshort(n,s),s+=2,l.endCount=a.readUshorts(n,s,h),s+=2*h,s+=2,l.startCount=a.readUshorts(n,s,h),s+=2*h,l.idDelta=[];for(var d=0;d<h;d++)l.idDelta.push(a.readShort(n,s)),s+=2;for(l.idRangeOffset=a.readUshorts(n,s,h),s+=2*h,l.glyphIdArray=[];s<o+c;)l.glyphIdArray.push(a.readUshort(n,s)),s+=2;return l},t.cmap.parse6=function(n,s){var a=t._bin,o={};o.format=a.readUshort(n,s),s+=2,a.readUshort(n,s),s+=2,a.readUshort(n,s),s+=2,o.firstCode=a.readUshort(n,s),s+=2;var l=a.readUshort(n,s);s+=2,o.glyphIdArray=[];for(var c=0;c<l;c++)o.glyphIdArray.push(a.readUshort(n,s)),s+=2;return o},t.cmap.parse12=function(n,s){var a=t._bin,o={};o.format=a.readUshort(n,s),s+=2,s+=2,a.readUint(n,s),s+=4,a.readUint(n,s),s+=4;var l=a.readUint(n,s);s+=4,o.groups=[];for(var c=0;c<l;c++){var u=s+12*c,h=a.readUint(n,u+0),d=a.readUint(n,u+4),f=a.readUint(n,u+8);o.groups.push([h,d,f])}return o},t.glyf={},t.glyf.parse=function(n,s,a,o){for(var l=[],c=0;c<o.maxp.numGlyphs;c++)l.push(null);return l},t.glyf._parseGlyf=function(n,s){var a=t._bin,o=n._data,l=t._tabOffset(o,"glyf",n._offset)+n.loca[s];if(n.loca[s]==n.loca[s+1])return null;var c={};if(c.noc=a.readShort(o,l),l+=2,c.xMin=a.readShort(o,l),l+=2,c.yMin=a.readShort(o,l),l+=2,c.xMax=a.readShort(o,l),l+=2,c.yMax=a.readShort(o,l),l+=2,c.xMin>=c.xMax||c.yMin>=c.yMax)return null;if(c.noc>0){c.endPts=[];for(var u=0;u<c.noc;u++)c.endPts.push(a.readUshort(o,l)),l+=2;var h=a.readUshort(o,l);if(l+=2,o.length-l<h)return null;c.instructions=a.readBytes(o,l,h),l+=h;var d=c.endPts[c.noc-1]+1;for(c.flags=[],u=0;u<d;u++){var f=o[l];if(l++,c.flags.push(f),(8&f)!=0){var p=o[l];l++;for(var v=0;v<p;v++)c.flags.push(f),u++}}for(c.xs=[],u=0;u<d;u++){var m=(2&c.flags[u])!=0,g=(16&c.flags[u])!=0;m?(c.xs.push(g?o[l]:-o[l]),l++):g?c.xs.push(0):(c.xs.push(a.readShort(o,l)),l+=2)}for(c.ys=[],u=0;u<d;u++)m=(4&c.flags[u])!=0,g=(32&c.flags[u])!=0,m?(c.ys.push(g?o[l]:-o[l]),l++):g?c.ys.push(0):(c.ys.push(a.readShort(o,l)),l+=2);var y=0,x=0;for(u=0;u<d;u++)y+=c.xs[u],x+=c.ys[u],c.xs[u]=y,c.ys[u]=x}else{var _;c.parts=[];do{_=a.readUshort(o,l),l+=2;var M={m:{a:1,b:0,c:0,d:1,tx:0,ty:0},p1:-1,p2:-1};if(c.parts.push(M),M.glyphIndex=a.readUshort(o,l),l+=2,1&_){var S=a.readShort(o,l);l+=2;var T=a.readShort(o,l);l+=2}else S=a.readInt8(o,l),l++,T=a.readInt8(o,l),l++;2&_?(M.m.tx=S,M.m.ty=T):(M.p1=S,M.p2=T),8&_?(M.m.a=M.m.d=a.readF2dot14(o,l),l+=2):64&_?(M.m.a=a.readF2dot14(o,l),l+=2,M.m.d=a.readF2dot14(o,l),l+=2):128&_&&(M.m.a=a.readF2dot14(o,l),l+=2,M.m.b=a.readF2dot14(o,l),l+=2,M.m.c=a.readF2dot14(o,l),l+=2,M.m.d=a.readF2dot14(o,l),l+=2)}while(32&_);if(256&_){var E=a.readUshort(o,l);for(l+=2,c.instr=[],u=0;u<E;u++)c.instr.push(o[l]),l++}}return c},t.GDEF={},t.GDEF.parse=function(n,s,a,o){var l=s;s+=4;var c=t._bin.readUshort(n,s);return{glyphClassDef:c===0?null:t._lctf.readClassDef(n,l+c)}},t.GPOS={},t.GPOS.parse=function(n,s,a,o){return t._lctf.parse(n,s,a,o,t.GPOS.subt)},t.GPOS.subt=function(n,s,a,o){var l=t._bin,c=a,u={};if(u.fmt=l.readUshort(n,a),a+=2,s==1||s==2||s==3||s==7||s==8&&u.fmt<=2){var h=l.readUshort(n,a);a+=2,u.coverage=t._lctf.readCoverage(n,h+c)}if(s==1&&u.fmt==1){var d=l.readUshort(n,a);a+=2,d!=0&&(u.pos=t.GPOS.readValueRecord(n,a,d))}else if(s==2&&u.fmt>=1&&u.fmt<=2){d=l.readUshort(n,a),a+=2;var f=l.readUshort(n,a);a+=2;var p=t._lctf.numOfOnes(d),v=t._lctf.numOfOnes(f);if(u.fmt==1){u.pairsets=[];var m=l.readUshort(n,a);a+=2;for(var g=0;g<m;g++){var y=c+l.readUshort(n,a);a+=2;var x=l.readUshort(n,y);y+=2;for(var _=[],M=0;M<x;M++){var S=l.readUshort(n,y);y+=2,d!=0&&(R=t.GPOS.readValueRecord(n,y,d),y+=2*p),f!=0&&(L=t.GPOS.readValueRecord(n,y,f),y+=2*v),_.push({gid2:S,val1:R,val2:L})}u.pairsets.push(_)}}if(u.fmt==2){var T=l.readUshort(n,a);a+=2;var E=l.readUshort(n,a);a+=2;var C=l.readUshort(n,a);a+=2;var A=l.readUshort(n,a);for(a+=2,u.classDef1=t._lctf.readClassDef(n,c+T),u.classDef2=t._lctf.readClassDef(n,c+E),u.matrix=[],g=0;g<C;g++){var D=[];for(M=0;M<A;M++){var R=null,L=null;d!=0&&(R=t.GPOS.readValueRecord(n,a,d),a+=2*p),f!=0&&(L=t.GPOS.readValueRecord(n,a,f),a+=2*v),D.push({val1:R,val2:L})}u.matrix.push(D)}}}else if(s==4&&u.fmt==1)u.markCoverage=t._lctf.readCoverage(n,l.readUshort(n,a)+c),u.baseCoverage=t._lctf.readCoverage(n,l.readUshort(n,a+2)+c),u.markClassCount=l.readUshort(n,a+4),u.markArray=t.GPOS.readMarkArray(n,l.readUshort(n,a+6)+c),u.baseArray=t.GPOS.readBaseArray(n,l.readUshort(n,a+8)+c,u.markClassCount);else if(s==6&&u.fmt==1)u.mark1Coverage=t._lctf.readCoverage(n,l.readUshort(n,a)+c),u.mark2Coverage=t._lctf.readCoverage(n,l.readUshort(n,a+2)+c),u.markClassCount=l.readUshort(n,a+4),u.mark1Array=t.GPOS.readMarkArray(n,l.readUshort(n,a+6)+c),u.mark2Array=t.GPOS.readBaseArray(n,l.readUshort(n,a+8)+c,u.markClassCount);else{if(s==9&&u.fmt==1){var O=l.readUshort(n,a);a+=2;var H=l.readUint(n,a);if(a+=4,o.ltype==9)o.ltype=O;else if(o.ltype!=O)throw"invalid extension substitution";return t.GPOS.subt(n,o.ltype,c+H)}console.debug("unsupported GPOS table LookupType",s,"format",u.fmt)}return u},t.GPOS.readValueRecord=function(n,s,a){var o=t._bin,l=[];return l.push(1&a?o.readShort(n,s):0),s+=1&a?2:0,l.push(2&a?o.readShort(n,s):0),s+=2&a?2:0,l.push(4&a?o.readShort(n,s):0),s+=4&a?2:0,l.push(8&a?o.readShort(n,s):0),s+=8&a?2:0,l},t.GPOS.readBaseArray=function(n,s,a){var o=t._bin,l=[],c=s,u=o.readUshort(n,s);s+=2;for(var h=0;h<u;h++){for(var d=[],f=0;f<a;f++)d.push(t.GPOS.readAnchorRecord(n,c+o.readUshort(n,s))),s+=2;l.push(d)}return l},t.GPOS.readMarkArray=function(n,s){var a=t._bin,o=[],l=s,c=a.readUshort(n,s);s+=2;for(var u=0;u<c;u++){var h=t.GPOS.readAnchorRecord(n,a.readUshort(n,s+2)+l);h.markClass=a.readUshort(n,s),o.push(h),s+=4}return o},t.GPOS.readAnchorRecord=function(n,s){var a=t._bin,o={};return o.fmt=a.readUshort(n,s),o.x=a.readShort(n,s+2),o.y=a.readShort(n,s+4),o},t.GSUB={},t.GSUB.parse=function(n,s,a,o){return t._lctf.parse(n,s,a,o,t.GSUB.subt)},t.GSUB.subt=function(n,s,a,o){var l=t._bin,c=a,u={};if(u.fmt=l.readUshort(n,a),a+=2,s!=1&&s!=2&&s!=4&&s!=5&&s!=6)return null;if(s==1||s==2||s==4||s==5&&u.fmt<=2||s==6&&u.fmt<=2){var h=l.readUshort(n,a);a+=2,u.coverage=t._lctf.readCoverage(n,c+h)}if(s==1&&u.fmt>=1&&u.fmt<=2){if(u.fmt==1)u.delta=l.readShort(n,a),a+=2;else if(u.fmt==2){var d=l.readUshort(n,a);a+=2,u.newg=l.readUshorts(n,a,d),a+=2*u.newg.length}}else if(s==2&&u.fmt==1){d=l.readUshort(n,a),a+=2,u.seqs=[];for(var f=0;f<d;f++){var p=l.readUshort(n,a)+c;a+=2;var v=l.readUshort(n,p);u.seqs.push(l.readUshorts(n,p+2,v))}}else if(s==4)for(u.vals=[],d=l.readUshort(n,a),a+=2,f=0;f<d;f++){var m=l.readUshort(n,a);a+=2,u.vals.push(t.GSUB.readLigatureSet(n,c+m))}else if(s==5&&u.fmt==2){if(u.fmt==2){var g=l.readUshort(n,a);a+=2,u.cDef=t._lctf.readClassDef(n,c+g),u.scset=[];var y=l.readUshort(n,a);for(a+=2,f=0;f<y;f++){var x=l.readUshort(n,a);a+=2,u.scset.push(x==0?null:t.GSUB.readSubClassSet(n,c+x))}}}else if(s==6&&u.fmt==3){if(u.fmt==3){for(f=0;f<3;f++){d=l.readUshort(n,a),a+=2;for(var _=[],M=0;M<d;M++)_.push(t._lctf.readCoverage(n,c+l.readUshort(n,a+2*M)));a+=2*d,f==0&&(u.backCvg=_),f==1&&(u.inptCvg=_),f==2&&(u.ahedCvg=_)}d=l.readUshort(n,a),a+=2,u.lookupRec=t.GSUB.readSubstLookupRecords(n,a,d)}}else{if(s==7&&u.fmt==1){var S=l.readUshort(n,a);a+=2;var T=l.readUint(n,a);if(a+=4,o.ltype==9)o.ltype=S;else if(o.ltype!=S)throw"invalid extension substitution";return t.GSUB.subt(n,o.ltype,c+T)}console.debug("unsupported GSUB table LookupType",s,"format",u.fmt)}return u},t.GSUB.readSubClassSet=function(n,s){var a=t._bin.readUshort,o=s,l=[],c=a(n,s);s+=2;for(var u=0;u<c;u++){var h=a(n,s);s+=2,l.push(t.GSUB.readSubClassRule(n,o+h))}return l},t.GSUB.readSubClassRule=function(n,s){var a=t._bin.readUshort,o={},l=a(n,s),c=a(n,s+=2);s+=2,o.input=[];for(var u=0;u<l-1;u++)o.input.push(a(n,s)),s+=2;return o.substLookupRecords=t.GSUB.readSubstLookupRecords(n,s,c),o},t.GSUB.readSubstLookupRecords=function(n,s,a){for(var o=t._bin.readUshort,l=[],c=0;c<a;c++)l.push(o(n,s),o(n,s+2)),s+=4;return l},t.GSUB.readChainSubClassSet=function(n,s){var a=t._bin,o=s,l=[],c=a.readUshort(n,s);s+=2;for(var u=0;u<c;u++){var h=a.readUshort(n,s);s+=2,l.push(t.GSUB.readChainSubClassRule(n,o+h))}return l},t.GSUB.readChainSubClassRule=function(n,s){for(var a=t._bin,o={},l=["backtrack","input","lookahead"],c=0;c<l.length;c++){var u=a.readUshort(n,s);s+=2,c==1&&u--,o[l[c]]=a.readUshorts(n,s,u),s+=2*o[l[c]].length}return u=a.readUshort(n,s),s+=2,o.subst=a.readUshorts(n,s,2*u),s+=2*o.subst.length,o},t.GSUB.readLigatureSet=function(n,s){var a=t._bin,o=s,l=[],c=a.readUshort(n,s);s+=2;for(var u=0;u<c;u++){var h=a.readUshort(n,s);s+=2,l.push(t.GSUB.readLigature(n,o+h))}return l},t.GSUB.readLigature=function(n,s){var a=t._bin,o={chain:[]};o.nglyph=a.readUshort(n,s),s+=2;var l=a.readUshort(n,s);s+=2;for(var c=0;c<l-1;c++)o.chain.push(a.readUshort(n,s)),s+=2;return o},t.head={},t.head.parse=function(n,s,a){var o=t._bin,l={};return o.readFixed(n,s),s+=4,l.fontRevision=o.readFixed(n,s),s+=4,o.readUint(n,s),s+=4,o.readUint(n,s),s+=4,l.flags=o.readUshort(n,s),s+=2,l.unitsPerEm=o.readUshort(n,s),s+=2,l.created=o.readUint64(n,s),s+=8,l.modified=o.readUint64(n,s),s+=8,l.xMin=o.readShort(n,s),s+=2,l.yMin=o.readShort(n,s),s+=2,l.xMax=o.readShort(n,s),s+=2,l.yMax=o.readShort(n,s),s+=2,l.macStyle=o.readUshort(n,s),s+=2,l.lowestRecPPEM=o.readUshort(n,s),s+=2,l.fontDirectionHint=o.readShort(n,s),s+=2,l.indexToLocFormat=o.readShort(n,s),s+=2,l.glyphDataFormat=o.readShort(n,s),s+=2,l},t.hhea={},t.hhea.parse=function(n,s,a){var o=t._bin,l={};return o.readFixed(n,s),s+=4,l.ascender=o.readShort(n,s),s+=2,l.descender=o.readShort(n,s),s+=2,l.lineGap=o.readShort(n,s),s+=2,l.advanceWidthMax=o.readUshort(n,s),s+=2,l.minLeftSideBearing=o.readShort(n,s),s+=2,l.minRightSideBearing=o.readShort(n,s),s+=2,l.xMaxExtent=o.readShort(n,s),s+=2,l.caretSlopeRise=o.readShort(n,s),s+=2,l.caretSlopeRun=o.readShort(n,s),s+=2,l.caretOffset=o.readShort(n,s),s+=2,s+=8,l.metricDataFormat=o.readShort(n,s),s+=2,l.numberOfHMetrics=o.readUshort(n,s),s+=2,l},t.hmtx={},t.hmtx.parse=function(n,s,a,o){for(var l=t._bin,c={aWidth:[],lsBearing:[]},u=0,h=0,d=0;d<o.maxp.numGlyphs;d++)d<o.hhea.numberOfHMetrics&&(u=l.readUshort(n,s),s+=2,h=l.readShort(n,s),s+=2),c.aWidth.push(u),c.lsBearing.push(h);return c},t.kern={},t.kern.parse=function(n,s,a,o){var l=t._bin,c=l.readUshort(n,s);if(s+=2,c==1)return t.kern.parseV1(n,s-2,a,o);var u=l.readUshort(n,s);s+=2;for(var h={glyph1:[],rval:[]},d=0;d<u;d++){s+=2,a=l.readUshort(n,s),s+=2;var f=l.readUshort(n,s);s+=2;var p=f>>>8;if((p&=15)!=0)throw"unknown kern table format: "+p;s=t.kern.readFormat0(n,s,h)}return h},t.kern.parseV1=function(n,s,a,o){var l=t._bin;l.readFixed(n,s),s+=4;var c=l.readUint(n,s);s+=4;for(var u={glyph1:[],rval:[]},h=0;h<c;h++){l.readUint(n,s),s+=4;var d=l.readUshort(n,s);s+=2,l.readUshort(n,s),s+=2;var f=d>>>8;if((f&=15)!=0)throw"unknown kern table format: "+f;s=t.kern.readFormat0(n,s,u)}return u},t.kern.readFormat0=function(n,s,a){var o=t._bin,l=-1,c=o.readUshort(n,s);s+=2,o.readUshort(n,s),s+=2,o.readUshort(n,s),s+=2,o.readUshort(n,s),s+=2;for(var u=0;u<c;u++){var h=o.readUshort(n,s);s+=2;var d=o.readUshort(n,s);s+=2;var f=o.readShort(n,s);s+=2,h!=l&&(a.glyph1.push(h),a.rval.push({glyph2:[],vals:[]}));var p=a.rval[a.rval.length-1];p.glyph2.push(d),p.vals.push(f),l=h}return s},t.loca={},t.loca.parse=function(n,s,a,o){var l=t._bin,c=[],u=o.head.indexToLocFormat,h=o.maxp.numGlyphs+1;if(u==0)for(var d=0;d<h;d++)c.push(l.readUshort(n,s+(d<<1))<<1);if(u==1)for(d=0;d<h;d++)c.push(l.readUint(n,s+(d<<2)));return c},t.maxp={},t.maxp.parse=function(n,s,a){var o=t._bin,l={},c=o.readUint(n,s);return s+=4,l.numGlyphs=o.readUshort(n,s),s+=2,c==65536&&(l.maxPoints=o.readUshort(n,s),s+=2,l.maxContours=o.readUshort(n,s),s+=2,l.maxCompositePoints=o.readUshort(n,s),s+=2,l.maxCompositeContours=o.readUshort(n,s),s+=2,l.maxZones=o.readUshort(n,s),s+=2,l.maxTwilightPoints=o.readUshort(n,s),s+=2,l.maxStorage=o.readUshort(n,s),s+=2,l.maxFunctionDefs=o.readUshort(n,s),s+=2,l.maxInstructionDefs=o.readUshort(n,s),s+=2,l.maxStackElements=o.readUshort(n,s),s+=2,l.maxSizeOfInstructions=o.readUshort(n,s),s+=2,l.maxComponentElements=o.readUshort(n,s),s+=2,l.maxComponentDepth=o.readUshort(n,s),s+=2),l},t.name={},t.name.parse=function(n,s,a){var o=t._bin,l={};o.readUshort(n,s),s+=2;var c=o.readUshort(n,s);s+=2,o.readUshort(n,s);for(var u,h=["copyright","fontFamily","fontSubfamily","ID","fullName","version","postScriptName","trademark","manufacturer","designer","description","urlVendor","urlDesigner","licence","licenceURL","---","typoFamilyName","typoSubfamilyName","compatibleFull","sampleText","postScriptCID","wwsFamilyName","wwsSubfamilyName","lightPalette","darkPalette"],d=s+=2,f=0;f<c;f++){var p=o.readUshort(n,s);s+=2;var v=o.readUshort(n,s);s+=2;var m=o.readUshort(n,s);s+=2;var g=o.readUshort(n,s);s+=2;var y=o.readUshort(n,s);s+=2;var x=o.readUshort(n,s);s+=2;var _,M=h[g],S=d+12*c+x;if(p==0)_=o.readUnicode(n,S,y/2);else if(p==3&&v==0)_=o.readUnicode(n,S,y/2);else if(v==0)_=o.readASCII(n,S,y);else if(v==1)_=o.readUnicode(n,S,y/2);else if(v==3)_=o.readUnicode(n,S,y/2);else{if(p!=1)throw"unknown encoding "+v+", platformID: "+p;_=o.readASCII(n,S,y),console.debug("reading unknown MAC encoding "+v+" as ASCII")}var T="p"+p+","+m.toString(16);l[T]==null&&(l[T]={}),l[T][M!==void 0?M:g]=_,l[T]._lang=m}for(var E in l)if(l[E].postScriptName!=null&&l[E]._lang==1033)return l[E];for(var E in l)if(l[E].postScriptName!=null&&l[E]._lang==0)return l[E];for(var E in l)if(l[E].postScriptName!=null&&l[E]._lang==3084)return l[E];for(var E in l)if(l[E].postScriptName!=null)return l[E];for(var E in l){u=E;break}return console.debug("returning name table with languageID "+l[u]._lang),l[u]},t["OS/2"]={},t["OS/2"].parse=function(n,s,a){var o=t._bin.readUshort(n,s);s+=2;var l={};if(o==0)t["OS/2"].version0(n,s,l);else if(o==1)t["OS/2"].version1(n,s,l);else if(o==2||o==3||o==4)t["OS/2"].version2(n,s,l);else{if(o!=5)throw"unknown OS/2 table version: "+o;t["OS/2"].version5(n,s,l)}return l},t["OS/2"].version0=function(n,s,a){var o=t._bin;return a.xAvgCharWidth=o.readShort(n,s),s+=2,a.usWeightClass=o.readUshort(n,s),s+=2,a.usWidthClass=o.readUshort(n,s),s+=2,a.fsType=o.readUshort(n,s),s+=2,a.ySubscriptXSize=o.readShort(n,s),s+=2,a.ySubscriptYSize=o.readShort(n,s),s+=2,a.ySubscriptXOffset=o.readShort(n,s),s+=2,a.ySubscriptYOffset=o.readShort(n,s),s+=2,a.ySuperscriptXSize=o.readShort(n,s),s+=2,a.ySuperscriptYSize=o.readShort(n,s),s+=2,a.ySuperscriptXOffset=o.readShort(n,s),s+=2,a.ySuperscriptYOffset=o.readShort(n,s),s+=2,a.yStrikeoutSize=o.readShort(n,s),s+=2,a.yStrikeoutPosition=o.readShort(n,s),s+=2,a.sFamilyClass=o.readShort(n,s),s+=2,a.panose=o.readBytes(n,s,10),s+=10,a.ulUnicodeRange1=o.readUint(n,s),s+=4,a.ulUnicodeRange2=o.readUint(n,s),s+=4,a.ulUnicodeRange3=o.readUint(n,s),s+=4,a.ulUnicodeRange4=o.readUint(n,s),s+=4,a.achVendID=[o.readInt8(n,s),o.readInt8(n,s+1),o.readInt8(n,s+2),o.readInt8(n,s+3)],s+=4,a.fsSelection=o.readUshort(n,s),s+=2,a.usFirstCharIndex=o.readUshort(n,s),s+=2,a.usLastCharIndex=o.readUshort(n,s),s+=2,a.sTypoAscender=o.readShort(n,s),s+=2,a.sTypoDescender=o.readShort(n,s),s+=2,a.sTypoLineGap=o.readShort(n,s),s+=2,a.usWinAscent=o.readUshort(n,s),s+=2,a.usWinDescent=o.readUshort(n,s),s+=2},t["OS/2"].version1=function(n,s,a){var o=t._bin;return s=t["OS/2"].version0(n,s,a),a.ulCodePageRange1=o.readUint(n,s),s+=4,a.ulCodePageRange2=o.readUint(n,s),s+=4},t["OS/2"].version2=function(n,s,a){var o=t._bin;return s=t["OS/2"].version1(n,s,a),a.sxHeight=o.readShort(n,s),s+=2,a.sCapHeight=o.readShort(n,s),s+=2,a.usDefault=o.readUshort(n,s),s+=2,a.usBreak=o.readUshort(n,s),s+=2,a.usMaxContext=o.readUshort(n,s),s+=2},t["OS/2"].version5=function(n,s,a){var o=t._bin;return s=t["OS/2"].version2(n,s,a),a.usLowerOpticalPointSize=o.readUshort(n,s),s+=2,a.usUpperOpticalPointSize=o.readUshort(n,s),s+=2},t.post={},t.post.parse=function(n,s,a){var o=t._bin,l={};return l.version=o.readFixed(n,s),s+=4,l.italicAngle=o.readFixed(n,s),s+=4,l.underlinePosition=o.readShort(n,s),s+=2,l.underlineThickness=o.readShort(n,s),s+=2,l},t==null&&(t={}),t.U==null&&(t.U={}),t.U.codeToGlyph=function(n,s){var a=n.cmap,o=-1;if(a.p0e4!=null?o=a.p0e4:a.p3e1!=null?o=a.p3e1:a.p1e0!=null?o=a.p1e0:a.p0e3!=null&&(o=a.p0e3),o==-1)throw"no familiar platform and encoding!";var l=a.tables[o];if(l.format==0)return s>=l.map.length?0:l.map[s];if(l.format==4){for(var c=-1,u=0;u<l.endCount.length;u++)if(s<=l.endCount[u]){c=u;break}return c==-1||l.startCount[c]>s?0:65535&(l.idRangeOffset[c]!=0?l.glyphIdArray[s-l.startCount[c]+(l.idRangeOffset[c]>>1)-(l.idRangeOffset.length-c)]:s+l.idDelta[c])}if(l.format==12){if(s>l.groups[l.groups.length-1][1])return 0;for(u=0;u<l.groups.length;u++){var h=l.groups[u];if(h[0]<=s&&s<=h[1])return h[2]+(s-h[0])}return 0}throw"unknown cmap table format "+l.format},t.U.glyphToPath=function(n,s){var a={cmds:[],crds:[]};if(n.SVG&&n.SVG.entries[s]){var o=n.SVG.entries[s];return o==null?a:(typeof o=="string"&&(o=t.SVG.toPath(o),n.SVG.entries[s]=o),o)}if(n.CFF){var l={x:0,y:0,stack:[],nStems:0,haveWidth:!1,width:n.CFF.Private?n.CFF.Private.defaultWidthX:0,open:!1},c=n.CFF,u=n.CFF.Private;if(c.ROS){for(var h=0;c.FDSelect[h+2]<=s;)h+=2;u=c.FDArray[c.FDSelect[h+1]].Private}t.U._drawCFF(n.CFF.CharStrings[s],l,c,u,a)}else n.glyf&&t.U._drawGlyf(s,n,a);return a},t.U._drawGlyf=function(n,s,a){var o=s.glyf[n];o==null&&(o=s.glyf[n]=t.glyf._parseGlyf(s,n)),o!=null&&(o.noc>-1?t.U._simpleGlyph(o,a):t.U._compoGlyph(o,s,a))},t.U._simpleGlyph=function(n,s){for(var a=0;a<n.noc;a++){for(var o=a==0?0:n.endPts[a-1]+1,l=n.endPts[a],c=o;c<=l;c++){var u=c==o?l:c-1,h=c==l?o:c+1,d=1&n.flags[c],f=1&n.flags[u],p=1&n.flags[h],v=n.xs[c],m=n.ys[c];if(c==o)if(d){if(!f){t.U.P.moveTo(s,v,m);continue}t.U.P.moveTo(s,n.xs[u],n.ys[u])}else f?t.U.P.moveTo(s,n.xs[u],n.ys[u]):t.U.P.moveTo(s,(n.xs[u]+v)/2,(n.ys[u]+m)/2);d?f&&t.U.P.lineTo(s,v,m):p?t.U.P.qcurveTo(s,v,m,n.xs[h],n.ys[h]):t.U.P.qcurveTo(s,v,m,(v+n.xs[h])/2,(m+n.ys[h])/2)}t.U.P.closePath(s)}},t.U._compoGlyph=function(n,s,a){for(var o=0;o<n.parts.length;o++){var l={cmds:[],crds:[]},c=n.parts[o];t.U._drawGlyf(c.glyphIndex,s,l);for(var u=c.m,h=0;h<l.crds.length;h+=2){var d=l.crds[h],f=l.crds[h+1];a.crds.push(d*u.a+f*u.b+u.tx),a.crds.push(d*u.c+f*u.d+u.ty)}for(h=0;h<l.cmds.length;h++)a.cmds.push(l.cmds[h])}},t.U._getGlyphClass=function(n,s){var a=t._lctf.getInterval(s,n);return a==-1?0:s[a+2]},t.U._applySubs=function(n,s,a,o){for(var l=n.length-s-1,c=0;c<a.tabs.length;c++)if(a.tabs[c]!=null){var u,h=a.tabs[c];if(!h.coverage||(u=t._lctf.coverageIndex(h.coverage,n[s]))!=-1){if(a.ltype==1)n[s],h.fmt==1?n[s]=n[s]+h.delta:n[s]=h.newg[u];else if(a.ltype==4)for(var d=h.vals[u],f=0;f<d.length;f++){var p=d[f],v=p.chain.length;if(!(v>l)){for(var m=!0,g=0,y=0;y<v;y++){for(;n[s+g+(1+y)]==-1;)g++;p.chain[y]!=n[s+g+(1+y)]&&(m=!1)}if(m){for(n[s]=p.nglyph,y=0;y<v+g;y++)n[s+y+1]=-1;break}}}else if(a.ltype==5&&h.fmt==2)for(var x=t._lctf.getInterval(h.cDef,n[s]),_=h.cDef[x+2],M=h.scset[_],S=0;S<M.length;S++){var T=M[S],E=T.input;if(!(E.length>l)){for(m=!0,y=0;y<E.length;y++){var C=t._lctf.getInterval(h.cDef,n[s+1+y]);if(x==-1&&h.cDef[C+2]!=E[y]){m=!1;break}}if(m){var A=T.substLookupRecords;for(f=0;f<A.length;f+=2)A[f],A[f+1]}}}else if(a.ltype==6&&h.fmt==3){if(!t.U._glsCovered(n,h.backCvg,s-h.backCvg.length)||!t.U._glsCovered(n,h.inptCvg,s)||!t.U._glsCovered(n,h.ahedCvg,s+h.inptCvg.length))continue;var D=h.lookupRec;for(S=0;S<D.length;S+=2){x=D[S];var R=o[D[S+1]];t.U._applySubs(n,s+x,R,o)}}}}},t.U._glsCovered=function(n,s,a){for(var o=0;o<s.length;o++)if(t._lctf.coverageIndex(s[o],n[a+o])==-1)return!1;return!0},t.U.glyphsToPath=function(n,s,a){for(var o={cmds:[],crds:[]},l=0,c=0;c<s.length;c++){var u=s[c];if(u!=-1){for(var h=c<s.length-1&&s[c+1]!=-1?s[c+1]:0,d=t.U.glyphToPath(n,u),f=0;f<d.crds.length;f+=2)o.crds.push(d.crds[f]+l),o.crds.push(d.crds[f+1]);for(a&&o.cmds.push(a),f=0;f<d.cmds.length;f++)o.cmds.push(d.cmds[f]);a&&o.cmds.push("X"),l+=n.hmtx.aWidth[u],c<s.length-1&&(l+=t.U.getPairAdjustment(n,u,h))}}return o},t.U.P={},t.U.P.moveTo=function(n,s,a){n.cmds.push("M"),n.crds.push(s,a)},t.U.P.lineTo=function(n,s,a){n.cmds.push("L"),n.crds.push(s,a)},t.U.P.curveTo=function(n,s,a,o,l,c,u){n.cmds.push("C"),n.crds.push(s,a,o,l,c,u)},t.U.P.qcurveTo=function(n,s,a,o,l){n.cmds.push("Q"),n.crds.push(s,a,o,l)},t.U.P.closePath=function(n){n.cmds.push("Z")},t.U._drawCFF=function(n,s,a,o,l){for(var c=s.stack,u=s.nStems,h=s.haveWidth,d=s.width,f=s.open,p=0,v=s.x,m=s.y,g=0,y=0,x=0,_=0,M=0,S=0,T=0,E=0,C=0,A=0,D={val:0,size:0};p<n.length;){t.CFF.getCharString(n,p,D);var R=D.val;if(p+=D.size,R=="o1"||R=="o18")c.length%2!=0&&!h&&(d=c.shift()+o.nominalWidthX),u+=c.length>>1,c.length=0,h=!0;else if(R=="o3"||R=="o23")c.length%2!=0&&!h&&(d=c.shift()+o.nominalWidthX),u+=c.length>>1,c.length=0,h=!0;else if(R=="o4")c.length>1&&!h&&(d=c.shift()+o.nominalWidthX,h=!0),f&&t.U.P.closePath(l),m+=c.pop(),t.U.P.moveTo(l,v,m),f=!0;else if(R=="o5")for(;c.length>0;)v+=c.shift(),m+=c.shift(),t.U.P.lineTo(l,v,m);else if(R=="o6"||R=="o7")for(var L=c.length,O=R=="o6",H=0;H<L;H++){var j=c.shift();O?v+=j:m+=j,O=!O,t.U.P.lineTo(l,v,m)}else if(R=="o8"||R=="o24"){L=c.length;for(var Y=0;Y+6<=L;)g=v+c.shift(),y=m+c.shift(),x=g+c.shift(),_=y+c.shift(),v=x+c.shift(),m=_+c.shift(),t.U.P.curveTo(l,g,y,x,_,v,m),Y+=6;R=="o24"&&(v+=c.shift(),m+=c.shift(),t.U.P.lineTo(l,v,m))}else{if(R=="o11")break;if(R=="o1234"||R=="o1235"||R=="o1236"||R=="o1237")R=="o1234"&&(y=m,x=(g=v+c.shift())+c.shift(),A=_=y+c.shift(),S=_,E=m,v=(T=(M=(C=x+c.shift())+c.shift())+c.shift())+c.shift(),t.U.P.curveTo(l,g,y,x,_,C,A),t.U.P.curveTo(l,M,S,T,E,v,m)),R=="o1235"&&(g=v+c.shift(),y=m+c.shift(),x=g+c.shift(),_=y+c.shift(),C=x+c.shift(),A=_+c.shift(),M=C+c.shift(),S=A+c.shift(),T=M+c.shift(),E=S+c.shift(),v=T+c.shift(),m=E+c.shift(),c.shift(),t.U.P.curveTo(l,g,y,x,_,C,A),t.U.P.curveTo(l,M,S,T,E,v,m)),R=="o1236"&&(g=v+c.shift(),y=m+c.shift(),x=g+c.shift(),A=_=y+c.shift(),S=_,T=(M=(C=x+c.shift())+c.shift())+c.shift(),E=S+c.shift(),v=T+c.shift(),t.U.P.curveTo(l,g,y,x,_,C,A),t.U.P.curveTo(l,M,S,T,E,v,m)),R=="o1237"&&(g=v+c.shift(),y=m+c.shift(),x=g+c.shift(),_=y+c.shift(),C=x+c.shift(),A=_+c.shift(),M=C+c.shift(),S=A+c.shift(),T=M+c.shift(),E=S+c.shift(),Math.abs(T-v)>Math.abs(E-m)?v=T+c.shift():m=E+c.shift(),t.U.P.curveTo(l,g,y,x,_,C,A),t.U.P.curveTo(l,M,S,T,E,v,m));else if(R=="o14"){if(c.length>0&&!h&&(d=c.shift()+a.nominalWidthX,h=!0),c.length==4){var z=c.shift(),V=c.shift(),U=c.shift(),k=c.shift(),X=t.CFF.glyphBySE(a,U),re=t.CFF.glyphBySE(a,k);t.U._drawCFF(a.CharStrings[X],s,a,o,l),s.x=z,s.y=V,t.U._drawCFF(a.CharStrings[re],s,a,o,l)}f&&(t.U.P.closePath(l),f=!1)}else if(R=="o19"||R=="o20")c.length%2!=0&&!h&&(d=c.shift()+o.nominalWidthX),u+=c.length>>1,c.length=0,h=!0,p+=u+7>>3;else if(R=="o21")c.length>2&&!h&&(d=c.shift()+o.nominalWidthX,h=!0),m+=c.pop(),v+=c.pop(),f&&t.U.P.closePath(l),t.U.P.moveTo(l,v,m),f=!0;else if(R=="o22")c.length>1&&!h&&(d=c.shift()+o.nominalWidthX,h=!0),v+=c.pop(),f&&t.U.P.closePath(l),t.U.P.moveTo(l,v,m),f=!0;else if(R=="o25"){for(;c.length>6;)v+=c.shift(),m+=c.shift(),t.U.P.lineTo(l,v,m);g=v+c.shift(),y=m+c.shift(),x=g+c.shift(),_=y+c.shift(),v=x+c.shift(),m=_+c.shift(),t.U.P.curveTo(l,g,y,x,_,v,m)}else if(R=="o26")for(c.length%2&&(v+=c.shift());c.length>0;)g=v,y=m+c.shift(),v=x=g+c.shift(),m=(_=y+c.shift())+c.shift(),t.U.P.curveTo(l,g,y,x,_,v,m);else if(R=="o27")for(c.length%2&&(m+=c.shift());c.length>0;)y=m,x=(g=v+c.shift())+c.shift(),_=y+c.shift(),v=x+c.shift(),m=_,t.U.P.curveTo(l,g,y,x,_,v,m);else if(R=="o10"||R=="o29"){var q=R=="o10"?o:a;if(c.length==0)console.debug("error: empty stack");else{var ee=c.pop(),$=q.Subrs[ee+q.Bias];s.x=v,s.y=m,s.nStems=u,s.haveWidth=h,s.width=d,s.open=f,t.U._drawCFF($,s,a,o,l),v=s.x,m=s.y,u=s.nStems,h=s.haveWidth,d=s.width,f=s.open}}else if(R=="o30"||R=="o31"){var ne=c.length,ce=(Y=0,R=="o31");for(Y+=ne-(L=-3&ne);Y<L;)ce?(y=m,x=(g=v+c.shift())+c.shift(),m=(_=y+c.shift())+c.shift(),L-Y==5?(v=x+c.shift(),Y++):v=x,ce=!1):(g=v,y=m+c.shift(),x=g+c.shift(),_=y+c.shift(),v=x+c.shift(),L-Y==5?(m=_+c.shift(),Y++):m=_,ce=!0),t.U.P.curveTo(l,g,y,x,_,v,m),Y+=4}else{if((R+"").charAt(0)=="o")throw console.debug("Unknown operation: "+R,n),R;c.push(R)}}}s.x=v,s.y=m,s.nStems=u,s.haveWidth=h,s.width=d,s.open=f};var i=t,r={Typr:i};return e.Typr=i,e.default=r,Object.defineProperty(e,"__esModule",{value:!0}),e}({}).Typr}/*!
Custom bundle of woff2otf (https://github.com/arty-name/woff2otf) with fflate
(https://github.com/101arrowz/fflate) for use in Troika text rendering. 
Original licenses apply: 
- fflate: https://github.com/101arrowz/fflate/blob/master/LICENSE (MIT)
- woff2otf.js: https://github.com/arty-name/woff2otf/blob/master/woff2otf.js (Apache2)
*/function Iqe(){return function(e){var t=Uint8Array,i=Uint16Array,r=Uint32Array,n=new t([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),s=new t([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),a=new t([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),o=function(R,L){for(var O=new i(31),H=0;H<31;++H)O[H]=L+=1<<R[H-1];var j=new r(O[30]);for(H=1;H<30;++H)for(var Y=O[H];Y<O[H+1];++Y)j[Y]=Y-O[H]<<5|H;return[O,j]},l=o(n,2),c=l[0],u=l[1];c[28]=258,u[258]=28;for(var h=o(s,0)[0],d=new i(32768),f=0;f<32768;++f){var p=(43690&f)>>>1|(21845&f)<<1;p=(61680&(p=(52428&p)>>>2|(13107&p)<<2))>>>4|(3855&p)<<4,d[f]=((65280&p)>>>8|(255&p)<<8)>>>1}var v=function(R,L,O){for(var H=R.length,j=0,Y=new i(L);j<H;++j)++Y[R[j]-1];var z,V=new i(L);for(j=0;j<L;++j)V[j]=V[j-1]+Y[j-1]<<1;{z=new i(1<<L);var U=15-L;for(j=0;j<H;++j)if(R[j])for(var k=j<<4|R[j],X=L-R[j],re=V[R[j]-1]++<<X,q=re|(1<<X)-1;re<=q;++re)z[d[re]>>>U]=k}return z},m=new t(288);for(f=0;f<144;++f)m[f]=8;for(f=144;f<256;++f)m[f]=9;for(f=256;f<280;++f)m[f]=7;for(f=280;f<288;++f)m[f]=8;var g=new t(32);for(f=0;f<32;++f)g[f]=5;var y=v(m,9),x=v(g,5),_=function(R){for(var L=R[0],O=1;O<R.length;++O)R[O]>L&&(L=R[O]);return L},M=function(R,L,O){var H=L/8|0;return(R[H]|R[H+1]<<8)>>(7&L)&O},S=function(R,L){var O=L/8|0;return(R[O]|R[O+1]<<8|R[O+2]<<16)>>(7&L)},T=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],E=function(R,L,O){var H=new Error(L||T[R]);if(H.code=R,Error.captureStackTrace&&Error.captureStackTrace(H,E),!O)throw H;return H},C=function(R,L,O){var H=R.length;if(!H||O&&!O.l&&H<5)return L||new t(0);var j=!L||O,Y=!O||O.i;O||(O={}),L||(L=new t(3*H));var z,V=function(He){var de=L.length;if(He>de){var We=new t(Math.max(2*de,He));We.set(L),L=We}},U=O.f||0,k=O.p||0,X=O.b||0,re=O.l,q=O.d,ee=O.m,$=O.n,ne=8*H;do{if(!re){O.f=U=M(R,k,1);var ce=M(R,k+1,3);if(k+=3,!ce){var pe=R[(Fe=((z=k)/8|0)+(7&z&&1)+4)-4]|R[Fe-3]<<8,ge=Fe+pe;if(ge>H){Y&&E(0);break}j&&V(X+pe),L.set(R.subarray(Fe,ge),X),O.b=X+=pe,O.p=k=8*ge;continue}if(ce==1)re=y,q=x,ee=9,$=5;else if(ce==2){var we=M(R,k,31)+257,le=M(R,k+10,15)+4,ve=we+M(R,k+5,31)+1;k+=14;for(var ie=new t(ve),Ce=new t(19),Pe=0;Pe<le;++Pe)Ce[a[Pe]]=M(R,k+3*Pe,7);k+=3*le;var Ne=_(Ce),be=(1<<Ne)-1,Le=v(Ce,Ne);for(Pe=0;Pe<ve;){var Fe,K=Le[M(R,k,be)];if(k+=15&K,(Fe=K>>>4)<16)ie[Pe++]=Fe;else{var B=0,G=0;for(Fe==16?(G=3+M(R,k,3),k+=2,B=ie[Pe-1]):Fe==17?(G=3+M(R,k,7),k+=3):Fe==18&&(G=11+M(R,k,127),k+=7);G--;)ie[Pe++]=B}}var oe=ie.subarray(0,we),fe=ie.subarray(we);ee=_(oe),$=_(fe),re=v(oe,ee),q=v(fe,$)}else E(1);if(k>ne){Y&&E(0);break}}j&&V(X+131072);for(var W=(1<<ee)-1,Ie=(1<<$)-1,Oe=k;;Oe=k){var Be=(B=re[S(R,k)&W])>>>4;if((k+=15&B)>ne){Y&&E(0);break}if(B||E(2),Be<256)L[X++]=Be;else{if(Be==256){Oe=k,re=null;break}var Re=Be-254;if(Be>264){var ke=n[Pe=Be-257];Re=M(R,k,(1<<ke)-1)+c[Pe],k+=ke}var qe=q[S(R,k)&Ie],Ke=qe>>>4;if(qe||E(3),k+=15&qe,fe=h[Ke],Ke>3&&(ke=s[Ke],fe+=S(R,k)&(1<<ke)-1,k+=ke),k>ne){Y&&E(0);break}j&&V(X+131072);for(var it=X+Re;X<it;X+=4)L[X]=L[X-fe],L[X+1]=L[X+1-fe],L[X+2]=L[X+2-fe],L[X+3]=L[X+3-fe];X=it}}O.l=re,O.p=Oe,O.b=X,re&&(U=1,O.m=ee,O.d=q,O.n=$)}while(!U);return X==L.length?L:function(He,de,We){(We==null||We>He.length)&&(We=He.length);var dt=new(He instanceof i?i:He instanceof r?r:t)(We-de);return dt.set(He.subarray(de,We)),dt}(L,0,X)},A=new t(0),D=typeof TextDecoder<"u"&&new TextDecoder;try{D.decode(A,{stream:!0})}catch{}return e.convert_streams=function(R){var L=new DataView(R),O=0;function H(){var we=L.getUint16(O);return O+=2,we}function j(){var we=L.getUint32(O);return O+=4,we}function Y(we){pe.setUint16(ge,we),ge+=2}function z(we){pe.setUint32(ge,we),ge+=4}for(var V={signature:j(),flavor:j(),length:j(),numTables:H(),reserved:H(),totalSfntSize:j(),majorVersion:H(),minorVersion:H(),metaOffset:j(),metaLength:j(),metaOrigLength:j(),privOffset:j(),privLength:j()},U=0;Math.pow(2,U)<=V.numTables;)U++;U--;for(var k=16*Math.pow(2,U),X=16*V.numTables-k,re=12,q=[],ee=0;ee<V.numTables;ee++)q.push({tag:j(),offset:j(),compLength:j(),origLength:j(),origChecksum:j()}),re+=16;var $,ne=new Uint8Array(12+16*q.length+q.reduce(function(we,le){return we+le.origLength+4},0)),ce=ne.buffer,pe=new DataView(ce),ge=0;return z(V.flavor),Y(V.numTables),Y(k),Y(U),Y(X),q.forEach(function(we){z(we.tag),z(we.origChecksum),z(re),z(we.origLength),we.outOffset=re,(re+=we.origLength)%4!=0&&(re+=4-re%4)}),q.forEach(function(we){var le,ve=R.slice(we.offset,we.offset+we.compLength);if(we.compLength!=we.origLength){var ie=new Uint8Array(we.origLength);le=new Uint8Array(ve,2),C(le,ie)}else ie=new Uint8Array(ve);ne.set(ie,we.outOffset);var Ce=0;(re=we.outOffset+we.origLength)%4!=0&&(Ce=4-re%4),ne.set(new Uint8Array(Ce).buffer,we.outOffset+we.origLength),$=re+Ce}),ce.slice(0,$)},Object.defineProperty(e,"__esModule",{value:!0}),e}({}).convert_streams}function Lqe(e,t){const i={M:2,L:2,Q:4,C:6,Z:0},r={C:"18g,ca,368,1kz",D:"17k,6,2,2+4,5+c,2+6,2+1,10+1,9+f,j+11,2+1,a,2,2+1,15+2,3,j+2,6+3,2+8,2,2,2+1,w+a,4+e,3+3,2,3+2,3+5,23+w,2f+4,3,2+9,2,b,2+3,3,1k+9,6+1,3+1,2+2,2+d,30g,p+y,1,1+1g,f+x,2,sd2+1d,jf3+4,f+3,2+4,2+2,b+3,42,2,4+2,2+1,2,3,t+1,9f+w,2,el+2,2+g,d+2,2l,2+1,5,3+1,2+1,2,3,6,16wm+1v",R:"17m+3,2,2,6+3,m,15+2,2+2,h+h,13,3+8,2,2,3+1,2,p+1,x,5+4,5,a,2,2,3,u,c+2,g+1,5,2+1,4+1,5j,6+1,2,b,2+2,f,2+1,1s+2,2,3+1,7,1ez0,2,2+1,4+4,b,4,3,b,42,2+2,4,3,2+1,2,o+3,ae,ep,x,2o+2,3+1,3,5+1,6",L:"x9u,jff,a,fd,jv",T:"4t,gj+33,7o+4,1+1,7c+18,2,2+1,2+1,2,21+a,2,1b+k,h,2u+6,3+5,3+1,2+3,y,2,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,3,7,6+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+d,1,1+1,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,ek,3+1,r+4,1e+4,6+5,2p+c,1+3,1,1+2,1+b,2db+2,3y,2p+v,ff+3,30+1,n9x,1+2,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,5s,6y+2,ea,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+9,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2,2b+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,470+8,at4+4,1o+6,t5,1s+3,2a,f5l+1,2+3,43o+2,a+7,1+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,1,gzau,v+2n,3l+6n"},n=1,s=2,a=4,o=8,l=16,c=32;let u;function h(T){if(!u){const E={R:s,L:n,D:a,C:l,U:c,T:o};u=new Map;for(let C in r){let A=0;r[C].split(",").forEach(D=>{let[R,L]=D.split("+");R=parseInt(R,36),L=L?parseInt(L,36):0,u.set(A+=R,E[C]);for(let O=L;O--;)u.set(++A,E[C])})}}return u.get(T)||c}const d=1,f=2,p=3,v=4,m=[null,"isol","init","fina","medi"];function g(T){const E=new Uint8Array(T.length);let C=c,A=d,D=-1;for(let R=0;R<T.length;R++){const L=T.codePointAt(R);let O=h(L)|0,H=d;O&o||(C&(n|a|l)?O&(s|a|l)?(H=p,(A===d||A===p)&&E[D]++):O&(n|c)&&(A===f||A===v)&&E[D]--:C&(s|c)&&(A===f||A===v)&&E[D]--,A=E[R]=H,C=O,D=R,L>65535&&R++)}return E}function y(T,E){const C=[];for(let D=0;D<E.length;D++){const R=E.codePointAt(D);R>65535&&D++,C.push(e.U.codeToGlyph(T,R))}const A=T.GSUB;if(A){const{lookupList:D,featureList:R}=A;let L;const O=/^(rlig|liga|mset|isol|init|fina|medi|half|pres|blws|ccmp)$/,H=[];R.forEach(j=>{if(O.test(j.tag))for(let Y=0;Y<j.tab.length;Y++){if(H[j.tab[Y]])continue;H[j.tab[Y]]=!0;const z=D[j.tab[Y]],V=/^(isol|init|fina|medi)$/.test(j.tag);V&&!L&&(L=g(E));for(let U=0;U<C.length;U++)(!L||!V||m[L[U]]===j.tag)&&e.U._applySubs(C,U,z,D)}})}return C}function x(T,E){const C=new Int16Array(E.length*3);let A=0;for(;A<E.length;A++){const O=E[A];if(O===-1)continue;C[A*3+2]=T.hmtx.aWidth[O];const H=T.GPOS;if(H){const j=H.lookupList;for(let Y=0;Y<j.length;Y++){const z=j[Y];for(let V=0;V<z.tabs.length;V++){const U=z.tabs[V];if(z.ltype===1){if(e._lctf.coverageIndex(U.coverage,O)!==-1&&U.pos){L(U.pos,A);break}}else if(z.ltype===2){let k=null,X=D();if(X!==-1){const re=e._lctf.coverageIndex(U.coverage,E[X]);if(re!==-1){if(U.fmt===1){const q=U.pairsets[re];for(let ee=0;ee<q.length;ee++)q[ee].gid2===O&&(k=q[ee])}else if(U.fmt===2){const q=e.U._getGlyphClass(E[X],U.classDef1),ee=e.U._getGlyphClass(O,U.classDef2);k=U.matrix[q][ee]}if(k){k.val1&&L(k.val1,X),k.val2&&L(k.val2,A);break}}}}else if(z.ltype===4){const k=e._lctf.coverageIndex(U.markCoverage,O);if(k!==-1){const X=D(R),re=X===-1?-1:e._lctf.coverageIndex(U.baseCoverage,E[X]);if(re!==-1){const q=U.markArray[k],ee=U.baseArray[re][q.markClass];C[A*3]=ee.x-q.x+C[X*3]-C[X*3+2],C[A*3+1]=ee.y-q.y+C[X*3+1];break}}}else if(z.ltype===6){const k=e._lctf.coverageIndex(U.mark1Coverage,O);if(k!==-1){const X=D();if(X!==-1){const re=E[X];if(_(T,re)===3){const q=e._lctf.coverageIndex(U.mark2Coverage,re);if(q!==-1){const ee=U.mark1Array[k],$=U.mark2Array[q][ee.markClass];C[A*3]=$.x-ee.x+C[X*3]-C[X*3+2],C[A*3+1]=$.y-ee.y+C[X*3+1];break}}}}}}}}else if(T.kern&&!T.cff){const j=D();if(j!==-1){const Y=T.kern.glyph1.indexOf(E[j]);if(Y!==-1){const z=T.kern.rval[Y].glyph2.indexOf(O);z!==-1&&(C[j*3+2]+=T.kern.rval[Y].vals[z])}}}}return C;function D(O){for(let H=A-1;H>=0;H--)if(E[H]!==-1&&(!O||O(E[H])))return H;return-1}function R(O){return _(T,O)===1}function L(O,H){for(let j=0;j<3;j++)C[H*3+j]+=O[j]||0}}function _(T,E){const C=T.GDEF&&T.GDEF.glyphClassDef;return C?e.U._getGlyphClass(E,C):0}function M(...T){for(let E=0;E<T.length;E++)if(typeof T[E]=="number")return T[E]}function S(T){const E=Object.create(null),C=T["OS/2"],A=T.hhea,D=T.head.unitsPerEm,R=M(C&&C.sTypoAscender,A&&A.ascender,D),L={unitsPerEm:D,ascender:R,descender:M(C&&C.sTypoDescender,A&&A.descender,0),capHeight:M(C&&C.sCapHeight,R),xHeight:M(C&&C.sxHeight,R),lineGap:M(C&&C.sTypoLineGap,A&&A.lineGap),supportsCodePoint(O){return e.U.codeToGlyph(T,O)>0},forEachGlyph(O,H,j,Y){let z=0;const V=1/L.unitsPerEm*H,U=y(T,O);let k=0;const X=x(T,U);return U.forEach((re,q)=>{if(re!==-1){let ee=E[re];if(!ee){const{cmds:$,crds:ne}=e.U.glyphToPath(T,re);let ce="",pe=0;for(let ie=0,Ce=$.length;ie<Ce;ie++){const Pe=i[$[ie]];ce+=$[ie];for(let Ne=1;Ne<=Pe;Ne++)ce+=(Ne>1?",":"")+ne[pe++]}let ge,we,le,ve;if(ne.length){ge=we=1/0,le=ve=-1/0;for(let ie=0,Ce=ne.length;ie<Ce;ie+=2){let Pe=ne[ie],Ne=ne[ie+1];Pe<ge&&(ge=Pe),Ne<we&&(we=Ne),Pe>le&&(le=Pe),Ne>ve&&(ve=Ne)}}else ge=le=we=ve=0;ee=E[re]={index:re,advanceWidth:T.hmtx.aWidth[re],xMin:ge,yMin:we,xMax:le,yMax:ve,path:ce}}Y.call(null,ee,z+X[q*3]*V,X[q*3+1]*V,k),z+=X[q*3+2]*V,j&&(z+=j*H)}k+=O.codePointAt(k)>65535?2:1}),z}};return L}return function(E){const C=new Uint8Array(E,0,4),A=e._bin.readASCII(C,0,4);if(A==="wOFF")E=t(E);else if(A==="wOF2")throw new Error("woff2 fonts not supported");return S(e.parse(E)[0])}}const Oqe=Ey({name:"Typr Font Parser",dependencies:[Rqe,Iqe,Lqe],init(e,t,i){const r=e(),n=t();return i(r,n)}});/*!
Custom bundle of @unicode-font-resolver/client v1.0.2 (https://github.com/lojjic/unicode-font-resolver)
for use in Troika text rendering. 
Original MIT license applies
*/function zqe(){return function(e){var t=function(){this.buckets=new Map};t.prototype.add=function(x){var _=x>>5;this.buckets.set(_,(this.buckets.get(_)||0)|1<<(31&x))},t.prototype.has=function(x){var _=this.buckets.get(x>>5);return _!==void 0&&(_&1<<(31&x))!=0},t.prototype.serialize=function(){var x=[];return this.buckets.forEach(function(_,M){x.push((+M).toString(36)+":"+_.toString(36))}),x.join(",")},t.prototype.deserialize=function(x){var _=this;this.buckets.clear(),x.split(",").forEach(function(M){var S=M.split(":");_.buckets.set(parseInt(S[0],36),parseInt(S[1],36))})};var i=Math.pow(2,8),r=i-1,n=~r;function s(x){var _=function(S){return S&n}(x).toString(16),M=function(S){return(S&n)+i-1}(x).toString(16);return"codepoint-index/plane"+(x>>16)+"/"+_+"-"+M+".json"}function a(x,_){var M=x&r,S=_.codePointAt(M/6|0);return((S=(S||48)-48)&1<<M%6)!=0}function o(x,_){var M;(M=x,M.replace(/U\+/gi,"").replace(/^,+|,+$/g,"").split(/,+/).map(function(S){return S.split("-").map(function(T){return parseInt(T.trim(),16)})})).forEach(function(S){var T=S[0],E=S[1];E===void 0&&(E=T),_(T,E)})}function l(x,_){o(x,function(M,S){for(var T=M;T<=S;T++)_(T)})}var c={},u={},h=new WeakMap,d="https://cdn.jsdelivr.net/gh/lojjic/unicode-font-resolver@v1.0.1/packages/data";function f(x){var _=h.get(x);return _||(_=new t,l(x.ranges,function(M){return _.add(M)}),h.set(x,_)),_}var p,v=new Map;function m(x,_,M){return x[_]?_:x[M]?M:function(S){for(var T in S)return T}(x)}function g(x,_){var M=_;if(!x.includes(M)){M=1/0;for(var S=0;S<x.length;S++)Math.abs(x[S]-_)<Math.abs(M-_)&&(M=x[S])}return M}function y(x){return p||(p=new Set,l("9-D,20,85,A0,1680,2000-200A,2028-202F,205F,3000",function(_){p.add(_)})),p.has(x)}return e.CodePointSet=t,e.clearCache=function(){c={},u={}},e.getFontsForString=function(x,_){_===void 0&&(_={});var M,S=_.lang;S===void 0&&(S=new RegExp("\\p{Script=Hangul}","u").test(M=x)?"ko":new RegExp("\\p{Script=Hiragana}|\\p{Script=Katakana}","u").test(M)?"ja":"en");var T=_.category;T===void 0&&(T="sans-serif");var E=_.style;E===void 0&&(E="normal");var C=_.weight;C===void 0&&(C=400);var A=(_.dataUrl||d).replace(/\/$/g,""),D=new Map,R=new Uint8Array(x.length),L={},O={},H=new Array(x.length),j=new Map,Y=!1;function z(k){var X=v.get(k);return X||(X=fetch(A+"/"+k).then(function(re){if(!re.ok)throw new Error(re.statusText);return re.json().then(function(q){if(!Array.isArray(q)||q[0]!==1)throw new Error("Incorrect schema version; need 1, got "+q[0]);return q[1]})}).catch(function(re){if(A!==d)return Y||(console.error('unicode-font-resolver: Failed loading from dataUrl "'+A+'", trying default CDN. '+re.message),Y=!0),A=d,v.delete(k),z(k);throw re}),v.set(k,X)),X}for(var V=function(k){var X=x.codePointAt(k),re=s(X);H[k]=re,c[re]||j.has(re)||j.set(re,z(re).then(function(q){c[re]=q})),X>65535&&(k++,U=k)},U=0;U<x.length;U++)V(U);return Promise.all(j.values()).then(function(){j.clear();for(var k=function(re){var q=x.codePointAt(re),ee=null,$=c[H[re]],ne=void 0;for(var ce in $){var pe=O[ce];if(pe===void 0&&(pe=O[ce]=new RegExp(ce).test(S||"en")),pe){for(var ge in ne=ce,$[ce])if(a(q,$[ce][ge])){ee=ge;break}break}}if(!ee){e:for(var we in $)if(we!==ne){for(var le in $[we])if(a(q,$[we][le])){ee=le;break e}}}ee||(console.debug("No font coverage for U+"+q.toString(16)),ee="latin"),H[re]=ee,u[ee]||j.has(ee)||j.set(ee,z("font-meta/"+ee+".json").then(function(ve){u[ee]=ve})),q>65535&&(re++,X=re)},X=0;X<x.length;X++)k(X);return Promise.all(j.values())}).then(function(){for(var k,X=null,re=0;re<x.length;re++){var q=x.codePointAt(re);if(X&&(y(q)||f(X).has(q)))R[re]=R[re-1];else{X=u[H[re]];var ee=L[X.id];if(!ee){var $=X.typeforms,ne=m($,T,"sans-serif"),ce=m($[ne],E,"normal"),pe=g((k=$[ne])===null||k===void 0?void 0:k[ce],C);ee=L[X.id]=A+"/font-files/"+X.id+"/"+ne+"."+ce+"."+pe+".woff"}var ge=D.get(ee);ge==null&&(ge=D.size,D.set(ee,ge)),R[re]=ge}q>65535&&(re++,R[re]=R[re-1])}return{fontUrls:Array.from(D.keys()),chars:R}})},Object.defineProperty(e,"__esModule",{value:!0}),e}({})}function Bqe(e,t){const i=Object.create(null),r=Object.create(null);function n(a,o){const l=c=>{console.error(`Failure loading font ${a}`,c)};try{const c=new XMLHttpRequest;c.open("get",a,!0),c.responseType="arraybuffer",c.onload=function(){if(c.status>=400)l(new Error(c.statusText));else if(c.status>0)try{const u=e(c.response);u.src=a,o(u)}catch(u){l(u)}},c.onerror=l,c.send()}catch(c){l(c)}}function s(a,o){let l=i[a];l?o(l):r[a]?r[a].push(o):(r[a]=[o],n(a,c=>{c.src=a,i[a]=c,r[a].forEach(u=>u(c)),delete r[a]}))}return function(a,o,{lang:l,fonts:c=[],style:u="normal",weight:h="normal",unicodeFontsURL:d}={}){const f=new Uint8Array(a.length),p=[];a.length||y();const v=new Map,m=[];if(u!=="italic"&&(u="normal"),typeof h!="number"&&(h=h==="bold"?700:400),c&&!Array.isArray(c)&&(c=[c]),c=c.slice().filter(_=>!_.lang||_.lang.test(l)).reverse(),c.length){let T=0;(function E(C=0){for(let A=C,D=a.length;A<D;A++){const R=a.codePointAt(A);if(T===1&&p[f[A-1]].supportsCodePoint(R)||A>0&&/\s/.test(a[A]))f[A]=f[A-1],T===2&&(m[m.length-1][1]=A);else for(let L=f[A],O=c.length;L<=O;L++)if(L===O){const H=T===2?m[m.length-1]:m[m.length]=[A,A];H[1]=A,T=2}else{f[A]=L;const{src:H,unicodeRange:j}=c[L];if(!j||x(R,j)){const Y=i[H];if(!Y){s(H,()=>{E(A)});return}if(Y.supportsCodePoint(R)){let z=v.get(Y);typeof z!="number"&&(z=p.length,p.push(Y),v.set(Y,z)),f[A]=z,T=1;break}}}R>65535&&A+1<D&&(f[A+1]=f[A],A++,T===2&&(m[m.length-1][1]=A))}g()})()}else m.push([0,a.length-1]),g();function g(){if(m.length){const _=m.map(M=>a.substring(M[0],M[1]+1)).join(`
`);t.getFontsForString(_,{lang:l||void 0,style:u,weight:h,dataUrl:d}).then(({fontUrls:M,chars:S})=>{const T=p.length;let E=0;m.forEach(A=>{for(let D=0,R=A[1]-A[0];D<=R;D++)f[A[0]+D]=S[E++]+T;E++});let C=0;M.forEach((A,D)=>{s(A,R=>{p[D+T]=R,++C===M.length&&y()})})})}else y()}function y(){o({chars:f,fonts:p})}function x(_,M){for(let S=0;S<M.length;S++){const[T,E=T]=M[S];if(T<=_&&_<=E)return!0}return!1}}}const Fqe=Ey({name:"FontResolver",dependencies:[Bqe,Oqe,zqe],init(e,t,i){return e(t,i())}});function Uqe(e,t){const r=/[\u00AD\u034F\u061C\u115F-\u1160\u17B4-\u17B5\u180B-\u180E\u200B-\u200F\u202A-\u202E\u2060-\u206F\u3164\uFE00-\uFE0F\uFEFF\uFFA0\uFFF0-\uFFF8]/,n="[^\\S\\u00A0]",s=new RegExp(`${n}|[\\-\\u007C\\u00AD\\u2010\\u2012-\\u2014\\u2027\\u2056\\u2E17\\u2E40]`);function a({text:p,lang:v,fonts:m,style:g,weight:y,preResolvedFonts:x,unicodeFontsURL:_},M){const S=({chars:T,fonts:E})=>{let C,A;const D=[];for(let R=0;R<T.length;R++)T[R]!==A?(A=T[R],D.push(C={start:R,end:R,fontObj:E[T[R]]})):C.end=R;M(D)};x?S(x):e(p,S,{lang:v,fonts:m,style:g,weight:y,unicodeFontsURL:_})}function o({text:p="",font:v,lang:m,sdfGlyphSize:g=64,fontSize:y=400,fontWeight:x=1,fontStyle:_="normal",letterSpacing:M=0,lineHeight:S="normal",maxWidth:T=1/0,direction:E,textAlign:C="left",textIndent:A=0,whiteSpace:D="normal",overflowWrap:R="normal",anchorX:L=0,anchorY:O=0,metricsOnly:H=!1,unicodeFontsURL:j,preResolvedFonts:Y=null,includeCaretPositions:z=!1,chunkedBoundsSize:V=8192,colorRanges:U=null},k){const X=h(),re={fontLoad:0,typesetting:0};p.indexOf("\r")>-1&&(console.info("Typesetter: got text with \\r chars; normalizing to \\n"),p=p.replace(/\r\n/g,`
`).replace(/\r/g,`
`)),y=+y,M=+M,T=+T,S=S||"normal",A=+A,a({text:p,lang:m,style:_,weight:x,fonts:typeof v=="string"?[{src:v}]:v,unicodeFontsURL:j,preResolvedFonts:Y},q=>{re.fontLoad=h()-X;const ee=isFinite(T);let $=null,ne=null,ce=null,pe=null,ge=null,we=null,le=null,ve=null,ie=0,Ce=0,Pe=D!=="nowrap";const Ne=new Map,be=h();let Le=A,Fe=0,K=new d;const B=[K];q.forEach(Ie=>{const{fontObj:Oe}=Ie,{ascender:Be,descender:Re,unitsPerEm:ke,lineGap:qe,capHeight:Ke,xHeight:it}=Oe;let He=Ne.get(Oe);if(!He){const xe=y/ke,me=S==="normal"?(Be-Re+qe)*xe:S*y,ze=(me-(Be-Re)*xe)/2,Ze=Math.min(me,(Be-Re)*xe),Je=(Be+Re)/2*xe+Ze/2;He={index:Ne.size,src:Oe.src,fontObj:Oe,fontSizeMult:xe,unitsPerEm:ke,ascender:Be*xe,descender:Re*xe,capHeight:Ke*xe,xHeight:it*xe,lineHeight:me,baseline:-ze-Be*xe,caretTop:Je,caretBottom:Je-Ze},Ne.set(Oe,He)}const{fontSizeMult:de}=He,We=p.slice(Ie.start,Ie.end+1);let dt,J;Oe.forEachGlyph(We,y,M,(xe,me,ze,Ze)=>{me+=Fe,Ze+=Ie.start,dt=me,J=xe;const Je=p.charAt(Ze),mt=xe.advanceWidth*de,St=K.count;let Mt;if("isEmpty"in xe||(xe.isWhitespace=!!Je&&new RegExp(n).test(Je),xe.canBreakAfter=!!Je&&s.test(Je),xe.isEmpty=xe.xMin===xe.xMax||xe.yMin===xe.yMax||r.test(Je)),!xe.isWhitespace&&!xe.isEmpty&&Ce++,Pe&&ee&&!xe.isWhitespace&&me+mt+Le>T&&St){if(K.glyphAt(St-1).glyphObj.canBreakAfter)Mt=new d,Le=-me;else for(let ui=St;ui--;)if(ui===0&&R==="break-word"){Mt=new d,Le=-me;break}else if(K.glyphAt(ui).glyphObj.canBreakAfter){Mt=K.splitAt(ui+1);const hi=Mt.glyphAt(0).x;Le-=hi;for(let $i=Mt.count;$i--;)Mt.glyphAt($i).x-=hi;break}Mt&&(K.isSoftWrapped=!0,K=Mt,B.push(K),ie=T)}let vt=K.glyphAt(K.count);vt.glyphObj=xe,vt.x=me+Le,vt.y=ze,vt.width=mt,vt.charIndex=Ze,vt.fontData=He,Je===`
`&&(K=new d,B.push(K),Le=-(me+mt+M*y)+A)}),Fe=dt+J.advanceWidth*de+M*y});let G=0;B.forEach(Ie=>{let Oe=!0;for(let Be=Ie.count;Be--;){const Re=Ie.glyphAt(Be);Oe&&!Re.glyphObj.isWhitespace&&(Ie.width=Re.x+Re.width,Ie.width>ie&&(ie=Ie.width),Oe=!1);let{lineHeight:ke,capHeight:qe,xHeight:Ke,baseline:it}=Re.fontData;ke>Ie.lineHeight&&(Ie.lineHeight=ke);const He=it-Ie.baseline;He<0&&(Ie.baseline+=He,Ie.cap+=He,Ie.ex+=He),Ie.cap=Math.max(Ie.cap,Ie.baseline+qe),Ie.ex=Math.max(Ie.ex,Ie.baseline+Ke)}Ie.baseline-=G,Ie.cap-=G,Ie.ex-=G,G+=Ie.lineHeight});let oe=0,fe=0;if(L&&(typeof L=="number"?oe=-L:typeof L=="string"&&(oe=-ie*(L==="left"?0:L==="center"?.5:L==="right"?1:c(L)))),O&&(typeof O=="number"?fe=-O:typeof O=="string"&&(fe=O==="top"?0:O==="top-baseline"?-B[0].baseline:O==="top-cap"?-B[0].cap:O==="top-ex"?-B[0].ex:O==="middle"?G/2:O==="bottom"?G:O==="bottom-baseline"?-B[B.length-1].baseline:c(O)*G)),!H){const Ie=t.getEmbeddingLevels(p,E);$=new Uint16Array(Ce),ne=new Uint8Array(Ce),ce=new Float32Array(Ce*2),pe={},le=[1/0,1/0,-1/0,-1/0],ve=[],z&&(we=new Float32Array(p.length*4)),U&&(ge=new Uint8Array(Ce*3));let Oe=0,Be=-1,Re=-1,ke,qe;if(B.forEach((Ke,it)=>{let{count:He,width:de}=Ke;if(He>0){let We=0;for(let Ze=He;Ze--&&Ke.glyphAt(Ze).glyphObj.isWhitespace;)We++;let dt=0,J=0;if(C==="center")dt=(ie-de)/2;else if(C==="right")dt=ie-de;else if(C==="justify"&&Ke.isSoftWrapped){let Ze=0;for(let Je=He-We;Je--;)Ke.glyphAt(Je).glyphObj.isWhitespace&&Ze++;J=(ie-de)/Ze}if(J||dt){let Ze=0;for(let Je=0;Je<He;Je++){let mt=Ke.glyphAt(Je);const St=mt.glyphObj;mt.x+=dt+Ze,J!==0&&St.isWhitespace&&Je<He-We&&(Ze+=J,mt.width+=J)}}const xe=t.getReorderSegments(p,Ie,Ke.glyphAt(0).charIndex,Ke.glyphAt(Ke.count-1).charIndex);for(let Ze=0;Ze<xe.length;Ze++){const[Je,mt]=xe[Ze];let St=1/0,Mt=-1/0;for(let vt=0;vt<He;vt++)if(Ke.glyphAt(vt).charIndex>=Je){let ui=vt,hi=vt;for(;hi<He;hi++){let $i=Ke.glyphAt(hi);if($i.charIndex>mt)break;hi<He-We&&(St=Math.min(St,$i.x),Mt=Math.max(Mt,$i.x+$i.width))}for(let $i=ui;$i<hi;$i++){const xn=Ke.glyphAt($i);xn.x=Mt-(xn.x+xn.width-St)}break}}let me;const ze=Ze=>me=Ze;for(let Ze=0;Ze<He;Ze++){const Je=Ke.glyphAt(Ze);me=Je.glyphObj;const mt=me.index,St=Ie.levels[Je.charIndex]&1;if(St){const Mt=t.getMirroredCharacter(p[Je.charIndex]);Mt&&Je.fontData.fontObj.forEachGlyph(Mt,0,0,ze)}if(z){const{charIndex:Mt,fontData:vt}=Je,ui=Je.x+oe,hi=Je.x+Je.width+oe;we[Mt*4]=St?hi:ui,we[Mt*4+1]=St?ui:hi,we[Mt*4+2]=Ke.baseline+vt.caretBottom+fe,we[Mt*4+3]=Ke.baseline+vt.caretTop+fe;const $i=Mt-Be;$i>1&&u(we,Be,$i),Be=Mt}if(U){const{charIndex:Mt}=Je;for(;Mt>Re;)Re++,U.hasOwnProperty(Re)&&(qe=U[Re])}if(!me.isWhitespace&&!me.isEmpty){const Mt=Oe++,{fontSizeMult:vt,src:ui,index:hi}=Je.fontData,$i=pe[ui]||(pe[ui]={});$i[mt]||($i[mt]={path:me.path,pathBounds:[me.xMin,me.yMin,me.xMax,me.yMax]});const xn=Je.x+oe,Or=Je.y+Ke.baseline+fe;ce[Mt*2]=xn,ce[Mt*2+1]=Or;const zr=xn+me.xMin*vt,ue=Or+me.yMin*vt,Xe=xn+me.xMax*vt,et=Or+me.yMax*vt;zr<le[0]&&(le[0]=zr),ue<le[1]&&(le[1]=ue),Xe>le[2]&&(le[2]=Xe),et>le[3]&&(le[3]=et),Mt%V===0&&(ke={start:Mt,end:Mt,rect:[1/0,1/0,-1/0,-1/0]},ve.push(ke)),ke.end++;const Ge=ke.rect;if(zr<Ge[0]&&(Ge[0]=zr),ue<Ge[1]&&(Ge[1]=ue),Xe>Ge[2]&&(Ge[2]=Xe),et>Ge[3]&&(Ge[3]=et),$[Mt]=mt,ne[Mt]=hi,U){const nt=Mt*3;ge[nt]=qe>>16&255,ge[nt+1]=qe>>8&255,ge[nt+2]=qe&255}}}}}),we){const Ke=p.length-Be;Ke>1&&u(we,Be,Ke)}}const W=[];Ne.forEach(({index:Ie,src:Oe,unitsPerEm:Be,ascender:Re,descender:ke,lineHeight:qe,capHeight:Ke,xHeight:it})=>{W[Ie]={src:Oe,unitsPerEm:Be,ascender:Re,descender:ke,lineHeight:qe,capHeight:Ke,xHeight:it}}),re.typesetting=h()-be,k({glyphIds:$,glyphFontIndices:ne,glyphPositions:ce,glyphData:pe,fontData:W,caretPositions:we,glyphColors:ge,chunkedBounds:ve,fontSize:y,topBaseline:fe+B[0].baseline,blockBounds:[oe,fe-G,oe+ie,fe],visibleBounds:le,timings:re})})}function l(p,v){o({...p,metricsOnly:!0},m=>{const[g,y,x,_]=m.blockBounds;v({width:x-g,height:_-y})})}function c(p){let v=p.match(/^([\d.]+)%$/),m=v?parseFloat(v[1]):NaN;return isNaN(m)?0:m/100}function u(p,v,m){const g=p[v*4],y=p[v*4+1],x=p[v*4+2],_=p[v*4+3],M=(y-g)/m;for(let S=0;S<m;S++){const T=(v+S)*4;p[T]=g+M*S,p[T+1]=g+M*(S+1),p[T+2]=x,p[T+3]=_}}function h(){return(self.performance||Date).now()}function d(){this.data=[]}const f=["glyphObj","x","y","width","charIndex","fontData"];return d.prototype={width:0,lineHeight:0,baseline:0,cap:0,ex:0,isSoftWrapped:!1,get count(){return Math.ceil(this.data.length/f.length)},glyphAt(p){let v=d.flyweight;return v.data=this.data,v.index=p,v},splitAt(p){let v=new d;return v.data=this.data.splice(p*f.length),v}},d.flyweight=f.reduce((p,v,m,g)=>(Object.defineProperty(p,v,{get(){return this.data[this.index*f.length+m]},set(y){this.data[this.index*f.length+m]=y}}),p),{data:null,index:0}),{typeset:o,measure:l}}const gm=()=>(self.performance||Date).now(),OP=uae();let cY;function Nqe(e,t,i,r,n,s,a,o,l,c,u=!0){return u?Vqe(e,t,i,r,n,s,a,o,l,c).then(null,h=>(cY||(console.warn("WebGL SDF generation failed, falling back to JS",h),cY=!0),hY(e,t,i,r,n,s,a,o,l,c))):hY(e,t,i,r,n,s,a,o,l,c)}const _2=[],kqe=5;let mF=0;function dae(){const e=gm();for(;_2.length&&gm()-e<kqe;)_2.shift()();mF=_2.length?setTimeout(dae,0):0}const Vqe=(...e)=>new Promise((t,i)=>{_2.push(()=>{const r=gm();try{OP.webgl.generateIntoCanvas(...e),t({timing:gm()-r})}catch(n){i(n)}}),mF||(mF=setTimeout(dae,0))}),Gqe=4,Hqe=2e3,uY={};let jqe=0;function hY(e,t,i,r,n,s,a,o,l,c){const u="TroikaTextSDFGenerator_JS_"+jqe++%Gqe;let h=uY[u];return h||(h=uY[u]={workerModule:Ey({name:u,workerId:u,dependencies:[uae,gm],init(d,f){const p=d().javascript.generate;return function(...v){const m=f();return{textureData:p(...v),timing:f()-m}}},getTransferables(d){return[d.textureData.buffer]}}),requests:0,idleTimer:null}),h.requests++,clearTimeout(h.idleTimer),h.workerModule(e,t,i,r,n,s).then(({textureData:d,timing:f})=>{const p=gm(),v=new Uint8Array(d.length*4);for(let m=0;m<d.length;m++)v[m*4+c]=d[m];return OP.webglUtils.renderImageData(a,v,o,l,e,t,1<<3-c),f+=gm()-p,--h.requests===0&&(h.idleTimer=setTimeout(()=>{bqe(u)},Hqe)),{timing:f}})}function Wqe(e){e._warm||(OP.webgl.isSupported(e),e._warm=!0)}const Xqe=OP.webglUtils.resizeWebGLCanvasWithoutClearing,Mv={defaultFontURL:null,unicodeFontsURL:null,sdfGlyphSize:64,sdfMargin:1/16,sdfExponent:9,textureWidth:2048,useWorker:!0},qqe=new Rt;function pv(){return(self.performance||Date).now()}const dY=Object.create(null);function fae(e,t){e=Zqe({},e);const i=pv(),{defaultFontURL:r}=Mv,n=[];if(r&&n.push({label:"default",src:fY(r)}),e.font&&n.push({label:"user",src:fY(e.font)}),e.font=n,e.text=""+e.text,e.sdfGlyphSize=e.sdfGlyphSize||Mv.sdfGlyphSize,e.unicodeFontsURL=e.unicodeFontsURL||Mv.unicodeFontsURL,e.colorRanges!=null){let f={};for(let p in e.colorRanges)if(e.colorRanges.hasOwnProperty(p)){let v=e.colorRanges[p];typeof v!="number"&&(v=qqe.set(v).getHex()),f[p]=v}e.colorRanges=f}Object.freeze(e);const{textureWidth:s,sdfExponent:a}=Mv,{sdfGlyphSize:o}=e,l=s/o*4;let c=dY[o];if(!c){const f=document.createElement("canvas");f.width=s,f.height=o*256/l,c=dY[o]={glyphCount:0,sdfGlyphSize:o,sdfCanvas:f,sdfTexture:new Wr(f,void 0,void 0,void 0,pn,pn),contextLost:!1,glyphsByFont:new Map},c.sdfTexture.generateMipmaps=!1,Yqe(c)}const{sdfTexture:u,sdfCanvas:h}=c;gae(e).then(f=>{const{glyphIds:p,glyphFontIndices:v,fontData:m,glyphPositions:g,fontSize:y,timings:x}=f,_=[],M=new Float32Array(p.length*4);let S=0,T=0;const E=pv(),C=m.map(O=>{let H=c.glyphsByFont.get(O.src);return H||c.glyphsByFont.set(O.src,H=new Map),H});p.forEach((O,H)=>{const j=v[H],{src:Y,unitsPerEm:z}=m[j];let V=C[j].get(O);if(!V){const{path:q,pathBounds:ee}=f.glyphData[Y][O],$=Math.max(ee[2]-ee[0],ee[3]-ee[1])/o*(Mv.sdfMargin*o+.5),ne=c.glyphCount++,ce=[ee[0]-$,ee[1]-$,ee[2]+$,ee[3]+$];C[j].set(O,V={path:q,atlasIndex:ne,sdfViewBox:ce}),_.push(V)}const{sdfViewBox:U}=V,k=g[T++],X=g[T++],re=y/z;M[S++]=k+U[0]*re,M[S++]=X+U[1]*re,M[S++]=k+U[2]*re,M[S++]=X+U[3]*re,p[H]=V.atlasIndex}),x.quads=(x.quads||0)+(pv()-E);const A=pv();x.sdf={};const D=h.height,R=Math.ceil(c.glyphCount/l),L=Math.pow(2,Math.ceil(Math.log2(R*o)));L>D&&(console.info(`Increasing SDF texture size ${D}->${L}`),Xqe(h,s,L),u.dispose()),Promise.all(_.map(O=>pae(O,c,e.gpuAccelerateSDF).then(({timing:H})=>{x.sdf[O.atlasIndex]=H}))).then(()=>{_.length&&!c.contextLost&&(mae(c),u.needsUpdate=!0),x.sdfTotal=pv()-A,x.total=pv()-i,t(Object.freeze({parameters:e,sdfTexture:u,sdfGlyphSize:o,sdfExponent:a,glyphBounds:M,glyphAtlasIndices:p,glyphColors:f.glyphColors,caretPositions:f.caretPositions,chunkedBounds:f.chunkedBounds,ascender:f.ascender,descender:f.descender,lineHeight:f.lineHeight,capHeight:f.capHeight,xHeight:f.xHeight,topBaseline:f.topBaseline,blockBounds:f.blockBounds,visibleBounds:f.visibleBounds,timings:f.timings}))})}),Promise.resolve().then(()=>{c.contextLost||Wqe(h)})}function pae({path:e,atlasIndex:t,sdfViewBox:i},{sdfGlyphSize:r,sdfCanvas:n,contextLost:s},a){if(s)return Promise.resolve({timing:-1});const{textureWidth:o,sdfExponent:l}=Mv,c=Math.max(i[2]-i[0],i[3]-i[1]),u=Math.floor(t/4),h=u%(o/r)*r,d=Math.floor(u/(o/r))*r,f=t%4;return Nqe(r,r,e,i,c,l,n,h,d,f,a)}function Yqe(e){const t=e.sdfCanvas;t.addEventListener("webglcontextlost",i=>{console.log("Context Lost",i),i.preventDefault(),e.contextLost=!0}),t.addEventListener("webglcontextrestored",i=>{console.log("Context Restored",i),e.contextLost=!1;const r=[];e.glyphsByFont.forEach(n=>{n.forEach(s=>{r.push(pae(s,e,!0))})}),Promise.all(r).then(()=>{mae(e),e.sdfTexture.needsUpdate=!0})})}function Qqe({font:e,characters:t,sdfGlyphSize:i},r){let n=Array.isArray(t)?t.join(`
`):""+t;fae({font:e,sdfGlyphSize:i,text:n},r)}function Zqe(e,t){for(let i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e}let OE;function fY(e){return OE||(OE=typeof document>"u"?{}:document.createElement("a")),OE.href=e,OE.href}function mae(e){if(typeof createImageBitmap!="function"){console.info("Safari<15: applying SDF canvas workaround");const{sdfCanvas:t,sdfTexture:i}=e,{width:r,height:n}=t,s=e.sdfCanvas.getContext("webgl");let a=i.image.data;(!a||a.length!==r*n*4)&&(a=new Uint8Array(r*n*4),i.image={width:r,height:n,data:a},i.flipY=!1,i.isDataTexture=!0),s.readPixels(0,0,r,n,s.RGBA,s.UNSIGNED_BYTE,a)}}const Kqe=Ey({name:"Typesetter",dependencies:[Uqe,Fqe,Sqe],init(e,t,i){return e(t,i())}}),gae=Ey({name:"Typesetter",dependencies:[Kqe],init(e){return function(t){return new Promise(i=>{e.typeset(t,i)})}},getTransferables(e){const t=[];for(let i in e)e[i]&&e[i].buffer&&t.push(e[i].buffer);return t}});gae.onMainThread;const pY={};function Jqe(e){let t=pY[e];return t||(t=pY[e]=new Vh(1,1,e,e).translate(.5,.5,0)),t}const $qe="aTroikaGlyphBounds",mY="aTroikaGlyphIndex",eYe="aTroikaGlyphColor";class tYe extends gk{constructor(){super(),this.detail=1,this.curveRadius=0,this.groups=[{start:0,count:1/0,materialIndex:0},{start:0,count:1/0,materialIndex:1}],this.boundingSphere=new Ns,this.boundingBox=new Us}computeBoundingSphere(){}computeBoundingBox(){}set detail(t){if(t!==this._detail){this._detail=t,(typeof t!="number"||t<1)&&(t=1);let i=Jqe(t);["position","normal","uv"].forEach(r=>{this.attributes[r]=i.attributes[r].clone()}),this.setIndex(i.getIndex().clone())}}get detail(){return this._detail}set curveRadius(t){t!==this._curveRadius&&(this._curveRadius=t,this._updateBounds())}get curveRadius(){return this._curveRadius}updateGlyphs(t,i,r,n,s){this.updateAttributeData($qe,t,4),this.updateAttributeData(mY,i,1),this.updateAttributeData(eYe,s,3),this._blockBounds=r,this._chunkedBounds=n,this.instanceCount=i.length,this._updateBounds()}_updateBounds(){const t=this._blockBounds;if(t){const{curveRadius:i,boundingBox:r}=this;if(i){const{PI:n,floor:s,min:a,max:o,sin:l,cos:c}=Math,u=n/2,h=n*2,d=Math.abs(i),f=t[0]/d,p=t[2]/d,v=s((f+u)/h)!==s((p+u)/h)?-d:a(l(f)*d,l(p)*d),m=s((f-u)/h)!==s((p-u)/h)?d:o(l(f)*d,l(p)*d),g=s((f+n)/h)!==s((p+n)/h)?d*2:o(d-c(f)*d,d-c(p)*d);r.min.set(v,t[1],i<0?-g:0),r.max.set(m,t[3],i<0?0:g)}else r.min.set(t[0],t[1],0),r.max.set(t[2],t[3],0);r.getBoundingSphere(this.boundingSphere)}}applyClipRect(t){let i=this.getAttribute(mY).count,r=this._chunkedBounds;if(r)for(let n=r.length;n--;){i=r[n].end;let s=r[n].rect;if(s[1]<t.w&&s[3]>t.y&&s[0]<t.z&&s[2]>t.x)break}this.instanceCount=i}updateAttributeData(t,i,r){const n=this.getAttribute(t);i?n&&n.array.length===i.length?(n.array.set(i),n.needsUpdate=!0):(this.setAttribute(t,new Fm(i,r)),delete this._maxInstanceCount,this.dispose()):n&&this.deleteAttribute(t)}}const iYe=`
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform vec4 uTroikaTotalBounds;
uniform vec4 uTroikaClipRect;
uniform mat3 uTroikaOrient;
uniform bool uTroikaUseGlyphColors;
uniform float uTroikaEdgeOffset;
uniform float uTroikaBlurRadius;
uniform vec2 uTroikaPositionOffset;
uniform float uTroikaCurveRadius;
attribute vec4 aTroikaGlyphBounds;
attribute float aTroikaGlyphIndex;
attribute vec3 aTroikaGlyphColor;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec3 vTroikaGlyphColor;
varying vec2 vTroikaGlyphDimensions;
`,rYe=`
vec4 bounds = aTroikaGlyphBounds;
bounds.xz += uTroikaPositionOffset.x;
bounds.yw -= uTroikaPositionOffset.y;

vec4 outlineBounds = vec4(
  bounds.xy - uTroikaEdgeOffset - uTroikaBlurRadius,
  bounds.zw + uTroikaEdgeOffset + uTroikaBlurRadius
);
vec4 clippedBounds = vec4(
  clamp(outlineBounds.xy, uTroikaClipRect.xy, uTroikaClipRect.zw),
  clamp(outlineBounds.zw, uTroikaClipRect.xy, uTroikaClipRect.zw)
);

vec2 clippedXY = (mix(clippedBounds.xy, clippedBounds.zw, position.xy) - bounds.xy) / (bounds.zw - bounds.xy);

position.xy = mix(bounds.xy, bounds.zw, clippedXY);

uv = (position.xy - uTroikaTotalBounds.xy) / (uTroikaTotalBounds.zw - uTroikaTotalBounds.xy);

float rad = uTroikaCurveRadius;
if (rad != 0.0) {
  float angle = position.x / rad;
  position.xz = vec2(sin(angle) * rad, rad - cos(angle) * rad);
  normal.xz = vec2(sin(angle), cos(angle));
}
  
position = uTroikaOrient * position;
normal = uTroikaOrient * normal;

vTroikaGlyphUV = clippedXY.xy;
vTroikaGlyphDimensions = vec2(bounds[2] - bounds[0], bounds[3] - bounds[1]);


float txCols = uTroikaSDFTextureSize.x / uTroikaSDFGlyphSize;
vec2 txUvPerSquare = uTroikaSDFGlyphSize / uTroikaSDFTextureSize;
vec2 txStartUV = txUvPerSquare * vec2(
  mod(floor(aTroikaGlyphIndex / 4.0), txCols),
  floor(floor(aTroikaGlyphIndex / 4.0) / txCols)
);
vTroikaTextureUVBounds = vec4(txStartUV, vec2(txStartUV) + txUvPerSquare);
vTroikaTextureChannel = mod(aTroikaGlyphIndex, 4.0);
`,nYe=`
uniform sampler2D uTroikaSDFTexture;
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform float uTroikaSDFExponent;
uniform float uTroikaEdgeOffset;
uniform float uTroikaFillOpacity;
uniform float uTroikaBlurRadius;
uniform vec3 uTroikaStrokeColor;
uniform float uTroikaStrokeWidth;
uniform float uTroikaStrokeOpacity;
uniform bool uTroikaSDFDebug;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec2 vTroikaGlyphDimensions;

float troikaSdfValueToSignedDistance(float alpha) {
  // Inverse of exponential encoding in webgl-sdf-generator
  
  float maxDimension = max(vTroikaGlyphDimensions.x, vTroikaGlyphDimensions.y);
  float absDist = (1.0 - pow(2.0 * (alpha > 0.5 ? 1.0 - alpha : alpha), 1.0 / uTroikaSDFExponent)) * maxDimension;
  float signedDist = absDist * (alpha > 0.5 ? -1.0 : 1.0);
  return signedDist;
}

float troikaGlyphUvToSdfValue(vec2 glyphUV) {
  vec2 textureUV = mix(vTroikaTextureUVBounds.xy, vTroikaTextureUVBounds.zw, glyphUV);
  vec4 rgba = texture2D(uTroikaSDFTexture, textureUV);
  float ch = floor(vTroikaTextureChannel + 0.5); //NOTE: can't use round() in WebGL1
  return ch == 0.0 ? rgba.r : ch == 1.0 ? rgba.g : ch == 2.0 ? rgba.b : rgba.a;
}

float troikaGlyphUvToDistance(vec2 uv) {
  return troikaSdfValueToSignedDistance(troikaGlyphUvToSdfValue(uv));
}

float troikaGetAADist() {
  
  #if defined(GL_OES_standard_derivatives) || __VERSION__ >= 300
  return length(fwidth(vTroikaGlyphUV * vTroikaGlyphDimensions)) * 0.5;
  #else
  return vTroikaGlyphDimensions.x / 64.0;
  #endif
}

float troikaGetFragDistValue() {
  vec2 clampedGlyphUV = clamp(vTroikaGlyphUV, 0.5 / uTroikaSDFGlyphSize, 1.0 - 0.5 / uTroikaSDFGlyphSize);
  float distance = troikaGlyphUvToDistance(clampedGlyphUV);
 
  // Extrapolate distance when outside bounds:
  distance += clampedGlyphUV == vTroikaGlyphUV ? 0.0 : 
    length((vTroikaGlyphUV - clampedGlyphUV) * vTroikaGlyphDimensions);

  

  return distance;
}

float troikaGetEdgeAlpha(float distance, float distanceOffset, float aaDist) {
  #if defined(IS_DEPTH_MATERIAL) || defined(IS_DISTANCE_MATERIAL)
  float alpha = step(-distanceOffset, -distance);
  #else

  float alpha = smoothstep(
    distanceOffset + aaDist,
    distanceOffset - aaDist,
    distance
  );
  #endif

  return alpha;
}
`,sYe=`
float aaDist = troikaGetAADist();
float fragDistance = troikaGetFragDistValue();
float edgeAlpha = uTroikaSDFDebug ?
  troikaGlyphUvToSdfValue(vTroikaGlyphUV) :
  troikaGetEdgeAlpha(fragDistance, uTroikaEdgeOffset, max(aaDist, uTroikaBlurRadius));

#if !defined(IS_DEPTH_MATERIAL) && !defined(IS_DISTANCE_MATERIAL)
vec4 fillRGBA = gl_FragColor;
fillRGBA.a *= uTroikaFillOpacity;
vec4 strokeRGBA = uTroikaStrokeWidth == 0.0 ? fillRGBA : vec4(uTroikaStrokeColor, uTroikaStrokeOpacity);
if (fillRGBA.a == 0.0) fillRGBA.rgb = strokeRGBA.rgb;
gl_FragColor = mix(fillRGBA, strokeRGBA, smoothstep(
  -uTroikaStrokeWidth - aaDist,
  -uTroikaStrokeWidth + aaDist,
  fragDistance
));
gl_FragColor.a *= edgeAlpha;
#endif

if (edgeAlpha == 0.0) {
  discard;
}
`;function aYe(e){const t=pF(e,{chained:!0,extensions:{derivatives:!0},uniforms:{uTroikaSDFTexture:{value:null},uTroikaSDFTextureSize:{value:new ut},uTroikaSDFGlyphSize:{value:0},uTroikaSDFExponent:{value:0},uTroikaTotalBounds:{value:new Hi(0,0,0,0)},uTroikaClipRect:{value:new Hi(0,0,0,0)},uTroikaEdgeOffset:{value:0},uTroikaFillOpacity:{value:1},uTroikaPositionOffset:{value:new ut},uTroikaCurveRadius:{value:0},uTroikaBlurRadius:{value:0},uTroikaStrokeWidth:{value:0},uTroikaStrokeColor:{value:new Rt},uTroikaStrokeOpacity:{value:1},uTroikaOrient:{value:new xi},uTroikaUseGlyphColors:{value:!0},uTroikaSDFDebug:{value:!1}},vertexDefs:iYe,vertexTransform:rYe,fragmentDefs:nYe,fragmentColorTransform:sYe,customRewriter({vertexShader:i,fragmentShader:r}){let n=/\buniform\s+vec3\s+diffuse\b/;return n.test(r)&&(r=r.replace(n,"varying vec3 vTroikaGlyphColor").replace(/\bdiffuse\b/g,"vTroikaGlyphColor"),n.test(i)||(i=i.replace(hae,`uniform vec3 diffuse;
$&
vTroikaGlyphColor = uTroikaUseGlyphColors ? aTroikaGlyphColor / 255.0 : diffuse;
`))),{vertexShader:i,fragmentShader:r}}});return t.transparent=!0,t.forceSinglePass=!0,Object.defineProperties(t,{isTroikaTextMaterial:{value:!0},shadowSide:{get(){return this.side},set(){}}}),t}const Ak=new kh({color:16777215,side:Ql,transparent:!0}),gY=8421504,vY=new ci,zE=new he,EL=new he,Q1=[],oYe=new he,AL="+x+y";function yY(e){return Array.isArray(e)?e[0]:e}let vae=()=>{const e=new Gr(new Vh(1,1),Ak);return vae=()=>e,e},yae=()=>{const e=new Gr(new Vh(1,1,32,1),Ak);return yae=()=>e,e};const lYe={type:"syncstart"},cYe={type:"synccomplete"},xae=["font","fontSize","fontStyle","fontWeight","lang","letterSpacing","lineHeight","maxWidth","overflowWrap","text","direction","textAlign","textIndent","whiteSpace","anchorX","anchorY","colorRanges","sdfGlyphSize"],uYe=xae.concat("material","color","depthOffset","clipRect","curveRadius","orientation","glyphGeometryDetail");let wae=class extends Gr{constructor(){const t=new tYe;super(t,null),this.text="",this.anchorX=0,this.anchorY=0,this.curveRadius=0,this.direction="auto",this.font=null,this.unicodeFontsURL=null,this.fontSize=.1,this.fontWeight="normal",this.fontStyle="normal",this.lang=null,this.letterSpacing=0,this.lineHeight="normal",this.maxWidth=1/0,this.overflowWrap="normal",this.textAlign="left",this.textIndent=0,this.whiteSpace="normal",this.material=null,this.color=null,this.colorRanges=null,this.outlineWidth=0,this.outlineColor=0,this.outlineOpacity=1,this.outlineBlur=0,this.outlineOffsetX=0,this.outlineOffsetY=0,this.strokeWidth=0,this.strokeColor=gY,this.strokeOpacity=1,this.fillOpacity=1,this.depthOffset=0,this.clipRect=null,this.orientation=AL,this.glyphGeometryDetail=1,this.sdfGlyphSize=null,this.gpuAccelerateSDF=!0,this.debugSDF=!1}sync(t){this._needsSync&&(this._needsSync=!1,this._isSyncing?(this._queuedSyncs||(this._queuedSyncs=[])).push(t):(this._isSyncing=!0,this.dispatchEvent(lYe),fae({text:this.text,font:this.font,lang:this.lang,fontSize:this.fontSize||.1,fontWeight:this.fontWeight||"normal",fontStyle:this.fontStyle||"normal",letterSpacing:this.letterSpacing||0,lineHeight:this.lineHeight||"normal",maxWidth:this.maxWidth,direction:this.direction||"auto",textAlign:this.textAlign,textIndent:this.textIndent,whiteSpace:this.whiteSpace,overflowWrap:this.overflowWrap,anchorX:this.anchorX,anchorY:this.anchorY,colorRanges:this.colorRanges,includeCaretPositions:!0,sdfGlyphSize:this.sdfGlyphSize,gpuAccelerateSDF:this.gpuAccelerateSDF,unicodeFontsURL:this.unicodeFontsURL},i=>{this._isSyncing=!1,this._textRenderInfo=i,this.geometry.updateGlyphs(i.glyphBounds,i.glyphAtlasIndices,i.blockBounds,i.chunkedBounds,i.glyphColors);const r=this._queuedSyncs;r&&(this._queuedSyncs=null,this._needsSync=!0,this.sync(()=>{r.forEach(n=>n&&n())})),this.dispatchEvent(cYe),t&&t()})))}onBeforeRender(t,i,r,n,s,a){this.sync(),s.isTroikaTextMaterial&&this._prepareForRender(s)}dispose(){this.geometry.dispose()}get textRenderInfo(){return this._textRenderInfo||null}createDerivedMaterial(t){return aYe(t)}get material(){let t=this._derivedMaterial;const i=this._baseMaterial||this._defaultMaterial||(this._defaultMaterial=Ak.clone());if((!t||!t.isDerivedFrom(i))&&(t=this._derivedMaterial=this.createDerivedMaterial(i),i.addEventListener("dispose",function r(){i.removeEventListener("dispose",r),t.dispose()})),this.hasOutline()){let r=t._outlineMtl;return r||(r=t._outlineMtl=Object.create(t,{id:{value:t.id+.1}}),r.isTextOutlineMaterial=!0,r.depthWrite=!1,r.map=null,t.addEventListener("dispose",function n(){t.removeEventListener("dispose",n),r.dispose()})),[r,t]}else return t}set material(t){t&&t.isTroikaTextMaterial?(this._derivedMaterial=t,this._baseMaterial=t.baseMaterial):this._baseMaterial=t}hasOutline(){return!!(this.outlineWidth||this.outlineBlur||this.outlineOffsetX||this.outlineOffsetY)}get glyphGeometryDetail(){return this.geometry.detail}set glyphGeometryDetail(t){this.geometry.detail=t}get curveRadius(){return this.geometry.curveRadius}set curveRadius(t){this.geometry.curveRadius=t}get customDepthMaterial(){return yY(this.material).getDepthMaterial()}get customDistanceMaterial(){return yY(this.material).getDistanceMaterial()}_prepareForRender(t){const i=t.isTextOutlineMaterial,r=t.uniforms,n=this.textRenderInfo;if(n){const{sdfTexture:o,blockBounds:l}=n;r.uTroikaSDFTexture.value=o,r.uTroikaSDFTextureSize.value.set(o.image.width,o.image.height),r.uTroikaSDFGlyphSize.value=n.sdfGlyphSize,r.uTroikaSDFExponent.value=n.sdfExponent,r.uTroikaTotalBounds.value.fromArray(l),r.uTroikaUseGlyphColors.value=!i&&!!n.glyphColors;let c=0,u=0,h=0,d,f,p,v=0,m=0;if(i){let{outlineWidth:y,outlineOffsetX:x,outlineOffsetY:_,outlineBlur:M,outlineOpacity:S}=this;c=this._parsePercent(y)||0,u=Math.max(0,this._parsePercent(M)||0),d=S,v=this._parsePercent(x)||0,m=this._parsePercent(_)||0}else h=Math.max(0,this._parsePercent(this.strokeWidth)||0),h&&(p=this.strokeColor,r.uTroikaStrokeColor.value.set(p??gY),f=this.strokeOpacity,f==null&&(f=1)),d=this.fillOpacity;r.uTroikaEdgeOffset.value=c,r.uTroikaPositionOffset.value.set(v,m),r.uTroikaBlurRadius.value=u,r.uTroikaStrokeWidth.value=h,r.uTroikaStrokeOpacity.value=f,r.uTroikaFillOpacity.value=d??1,r.uTroikaCurveRadius.value=this.curveRadius||0;let g=this.clipRect;if(g&&Array.isArray(g)&&g.length===4)r.uTroikaClipRect.value.fromArray(g);else{const y=(this.fontSize||.1)*100;r.uTroikaClipRect.value.set(l[0]-y,l[1]-y,l[2]+y,l[3]+y)}this.geometry.applyClipRect(r.uTroikaClipRect.value)}r.uTroikaSDFDebug.value=!!this.debugSDF,t.polygonOffset=!!this.depthOffset,t.polygonOffsetFactor=t.polygonOffsetUnits=this.depthOffset||0;const s=i?this.outlineColor||0:this.color;if(s==null)delete t.color;else{const o=t.hasOwnProperty("color")?t.color:t.color=new Rt;(s!==o._input||typeof s=="object")&&o.set(o._input=s)}let a=this.orientation||AL;if(a!==t._orientation){let o=r.uTroikaOrient.value;a=a.replace(/[^-+xyz]/g,"");let l=a!==AL&&a.match(/^([-+])([xyz])([-+])([xyz])$/);if(l){let[,c,u,h,d]=l;zE.set(0,0,0)[u]=c==="-"?1:-1,EL.set(0,0,0)[d]=h==="-"?-1:1,vY.lookAt(oYe,zE.cross(EL),EL),o.setFromMatrix4(vY)}else o.identity();t._orientation=a}}_parsePercent(t){if(typeof t=="string"){let i=t.match(/^(-?[\d.]+)%$/),r=i?parseFloat(i[1]):NaN;t=(isNaN(r)?0:r/100)*this.fontSize}return t}localPositionToTextCoords(t,i=new ut){i.copy(t);const r=this.curveRadius;return r&&(i.x=Math.atan2(t.x,Math.abs(r)-Math.abs(t.z))*Math.abs(r)),i}worldPositionToTextCoords(t,i=new ut){return zE.copy(t),this.localPositionToTextCoords(this.worldToLocal(zE),i)}raycast(t,i){const{textRenderInfo:r,curveRadius:n}=this;if(r){const s=r.blockBounds,a=n?yae():vae(),o=a.geometry,{position:l,uv:c}=o.attributes;for(let u=0;u<c.count;u++){let h=s[0]+c.getX(u)*(s[2]-s[0]);const d=s[1]+c.getY(u)*(s[3]-s[1]);let f=0;n&&(f=n-Math.cos(h/n)*n,h=Math.sin(h/n)*n),l.setXYZ(u,h,d,f)}o.boundingSphere=this.geometry.boundingSphere,o.boundingBox=this.geometry.boundingBox,a.matrixWorld=this.matrixWorld,a.material.side=this.material.side,Q1.length=0,a.raycast(t,Q1);for(let u=0;u<Q1.length;u++)Q1[u].object=this,i.push(Q1[u])}}copy(t){const i=this.geometry;return super.copy(t),this.geometry=i,uYe.forEach(r=>{this[r]=t[r]}),this}clone(){return new this.constructor().copy(this)}};xae.forEach(e=>{const t="_private_"+e;Object.defineProperty(wae.prototype,e,{get(){return this[t]},set(i){i!==this[t]&&(this[t]=i,this._needsSync=!0)}})});new Us;new Rt;const hYe=_e.forwardRef(({sdfGlyphSize:e=64,anchorX:t="center",anchorY:i="middle",font:r,fontSize:n=1,children:s,characters:a,onSync:o,...l},c)=>{const u=Wu(({invalidate:p})=>p),[h]=_e.useState(()=>new wae),[d,f]=_e.useMemo(()=>{const p=[];let v="";return _e.Children.forEach(s,m=>{typeof m=="string"||typeof m=="number"?v+=m:p.push(m)}),[p,v]},[s]);return bXe(()=>new Promise(p=>Qqe({font:r,characters:a},p)),["troika-text",r,a]),_e.useLayoutEffect(()=>void h.sync(()=>{u(),o&&o(h)})),_e.useEffect(()=>()=>h.dispose(),[h]),_e.createElement("primitive",K0({object:h,ref:c,font:r,text:f,anchorX:t,anchorY:i,fontSize:n,sdfGlyphSize:e},l),d)}),bae=_e.forwardRef(({makeDefault:e,camera:t,regress:i,domElement:r,enableDamping:n=!0,keyEvents:s=!1,onChange:a,onStart:o,onEnd:l,...c},u)=>{const h=Wu(S=>S.invalidate),d=Wu(S=>S.camera),f=Wu(S=>S.gl),p=Wu(S=>S.events),v=Wu(S=>S.setEvents),m=Wu(S=>S.set),g=Wu(S=>S.get),y=Wu(S=>S.performance),x=t||d,_=r||p.connected||f.domElement,M=_e.useMemo(()=>new gqe(x),[x]);return LP(()=>{M.enabled&&M.update()},-1),_e.useEffect(()=>(s&&M.connect(s===!0?_:s),M.connect(_),()=>void M.dispose()),[s,_,i,M,h]),_e.useEffect(()=>{const S=C=>{h(),i&&y.regress(),a&&a(C)},T=C=>{o&&o(C)},E=C=>{l&&l(C)};return M.addEventListener("change",S),M.addEventListener("start",T),M.addEventListener("end",E),()=>{M.removeEventListener("start",T),M.removeEventListener("end",E),M.removeEventListener("change",S)}},[a,o,l,M,h,v]),_e.useEffect(()=>{if(e){const S=g().controls;return m({controls:M}),()=>m({controls:S})}},[e,M]),_e.createElement("primitive",K0({ref:u,object:M,enableDamping:n},c))});var dYe=`#define GLSLIFY 1
vec3 mod289(vec3 x){return x-floor(x*(1.0/289.0))*289.0;}vec4 mod289(vec4 x){return x-floor(x*(1.0/289.0))*289.0;}vec4 permute(vec4 x){return mod289(((x*34.0)+1.0)*x);}vec4 taylorInvSqrt(vec4 r){return 1.79284291400159-0.85373472095314*r;}float snoise(vec3 v){const vec2 C=vec2(1.0/6.0,1.0/3.0);const vec4 D=vec4(0.0,0.5,1.0,2.0);vec3 i=floor(v+dot(v,C.yyy));vec3 x0=v-i+dot(i,C.xxx);vec3 g=step(x0.yzx,x0.xyz);vec3 l=1.0-g;vec3 i1=min(g.xyz,l.zxy);vec3 i2=max(g.xyz,l.zxy);vec3 x1=x0-i1+C.xxx;vec3 x2=x0-i2+C.yyy;vec3 x3=x0-D.yyy;i=mod289(i);vec4 p=permute(permute(permute(i.z+vec4(0.0,i1.z,i2.z,1.0))+i.y+vec4(0.0,i1.y,i2.y,1.0))+i.x+vec4(0.0,i1.x,i2.x,1.0));float n_=0.142857142857;vec3 ns=n_*D.wyz-D.xzx;vec4 j=p-49.0*floor(p*ns.z*ns.z);vec4 x_=floor(j*ns.z);vec4 y_=floor(j-7.0*x_);vec4 x=x_*ns.x+ns.yyyy;vec4 y=y_*ns.x+ns.yyyy;vec4 h=1.0-abs(x)-abs(y);vec4 b0=vec4(x.xy,y.xy);vec4 b1=vec4(x.zw,y.zw);vec4 s0=floor(b0)*2.0+1.0;vec4 s1=floor(b1)*2.0+1.0;vec4 sh=-step(h,vec4(0.0));vec4 a0=b0.xzyw+s0.xzyw*sh.xxyy;vec4 a1=b1.xzyw+s1.xzyw*sh.zzww;vec3 p0=vec3(a0.xy,h.x);vec3 p1=vec3(a0.zw,h.y);vec3 p2=vec3(a1.xy,h.z);vec3 p3=vec3(a1.zw,h.w);vec4 norm=taylorInvSqrt(vec4(dot(p0,p0),dot(p1,p1),dot(p2,p2),dot(p3,p3)));p0*=norm.x;p1*=norm.y;p2*=norm.z;p3*=norm.w;vec4 m=max(0.6-vec4(dot(x0,x0),dot(x1,x1),dot(x2,x2),dot(x3,x3)),0.0);m=m*m;return 42.0*dot(m*m,vec4(dot(p0,x0),dot(p1,x1),dot(p2,x2),dot(p3,x3)));}`;class fYe extends uk{constructor(t={}){super(t),this.setValues(t),this._time={value:0},this._distort={value:.4},this._radius={value:1}}onBeforeCompile(t){t.uniforms.time=this._time,t.uniforms.radius=this._radius,t.uniforms.distort=this._distort,t.vertexShader=`
      uniform float time;
      uniform float radius;
      uniform float distort;
      ${dYe}
      ${t.vertexShader}
    `,t.vertexShader=t.vertexShader.replace("#include <begin_vertex>",`
        float updateTime = time / 50.0;
        float noise = snoise(vec3(position / 2.0 + updateTime * 5.0));
        vec3 transformed = vec3(position * (noise * pow(distort, 2.0) + radius));
        `)}get time(){return this._time.value}set time(t){this._time.value=t}get distort(){return this._distort.value}set distort(t){this._distort.value=t}get radius(){return this._radius.value}set radius(t){this._radius.value=t}}const pYe=_e.forwardRef(({speed:e=1,...t},i)=>{const[r]=_e.useState(()=>new fYe);return LP(n=>r&&(r.time=n.clock.elapsedTime*e)),_e.createElement("primitive",K0({object:r,ref:i,attach:"material"},t))});function mYe(e,t){const i=e+"Geometry";return _e.forwardRef(({args:r,children:n,...s},a)=>{const o=_e.useRef(null);return _e.useImperativeHandle(a,()=>o.current),_e.useLayoutEffect(()=>void(t==null?void 0:t(o.current))),_e.createElement("mesh",K0({ref:o},s),_e.createElement(i,{attach:"geometry",args:r}),n)})}const _ae=mYe("sphere"),gYe=()=>Te.jsxs(Mi.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{duration:.8},className:"flex flex-col items-center justify-center pt-20 text-white",children:[Te.jsxs(lae,{camera:{position:[0,0,5],fov:50},className:"h-80 w-80",children:[Te.jsx(bae,{enableZoom:!1,autoRotate:!0,autoRotateSpeed:2}),Te.jsx(hYe,{color:"hotpink",fontSize:2,position:[0,0,0],font:"/fonts/Roboto-Black.ttf",children:"404"})]}),Te.jsx("h2",{className:"text-3xl font-bold mt-6 text-[#DAA520]",children:"Page Not Found"}),Te.jsx("p",{className:"text-gray-300 mt-2",children:"Oops! The page you're looking for doesn't exist."}),Te.jsx(oh,{to:"/",className:"mt-6 px-6 py-2 bg-[#FF4500] rounded-lg shadow-lg text-white font-semibold hover:bg-[#FF4500] transition",children:"Go Back Home"})]}),vYe=()=>{const e=_e.useMemo(()=>{const i=[];for(let r=0;r<1e3;r++){const n=v2.randFloatSpread(20),s=v2.randFloatSpread(20),a=v2.randFloatSpread(20);i.push(new he(n,s,a))}return i},[]),t=_e.useRef();return LP(i=>{t.current&&(t.current.rotation.x+=.001,t.current.rotation.y+=.001)}),Te.jsx("group",{ref:t,children:e.map((i,r)=>Te.jsx(_ae,{position:[i.x,i.y,i.z],args:[.02],children:Te.jsx("meshStandardMaterial",{color:"#fff",emissive:"#fff",emissiveIntensity:.5})},r))})},yYe=()=>{const e=_e.useRef();return LP(t=>{e.current&&(e.current.rotation.x=t.clock.getElapsedTime()*.3,e.current.rotation.y=t.clock.getElapsedTime()*.4)}),Te.jsx(_ae,{ref:e,args:[2,64,64],scale:1.5,children:Te.jsx(pYe,{color:"#FF4500",attach:"material",distort:.5,speed:2,roughness:0,metalness:.8})})},xYe=()=>Te.jsx("div",{className:"fixed top-0 left-0 w-full h-full -z-10",children:Te.jsxs(lae,{camera:{position:[0,0,15]},children:[Te.jsx("color",{attach:"background",args:["#0A0A0F"]}),Te.jsx("ambientLight",{intensity:.5}),Te.jsx("pointLight",{position:[10,10,10],intensity:1}),Te.jsx(yYe,{}),Te.jsx(vYe,{}),Te.jsx(bae,{enableZoom:!1,enablePan:!1,autoRotate:!0,autoRotateSpeed:.5,maxPolarAngle:Math.PI/2,minPolarAngle:Math.PI/2})]})}),wYe=()=>Te.jsxs(Mi.div,{className:"spinner-container",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.5},children:[Te.jsx("div",{className:"spinner",children:Te.jsx(Mi.div,{className:"spinner-inner",animate:{rotate:360},transition:{repeat:1/0,duration:1.5,ease:"linear"}})}),Te.jsx(Mi.p,{className:"spinner-text",initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.5,duration:.5}})]});function bYe(){const[e,t]=_e.useState(!0);return _e.useEffect(()=>{setTimeout(()=>t(!1),2e3)},[]),Te.jsx(Sue,{basename:"/sahal",children:Te.jsxs("div",{className:"min-h-screen transition-colors",children:[Te.jsx(xYe,{}),Te.jsx(lme,{}),Te.jsxs(gue,{children:[Te.jsx(bp,{path:"/",element:Te.jsxs(Te.Fragment,{children:[e?Te.jsx(wYe,{}):Te.jsx(l5e,{}),Te.jsx(Y7,{}),Te.jsx(K7,{}),Te.jsx(sX,{}),Te.jsx(aX,{}),Te.jsx(r6e,{})]})}),Te.jsx(bp,{path:"/about",element:Te.jsx(Y7,{})}),Te.jsx(bp,{path:"/portfolio",element:Te.jsx(sX,{})}),Te.jsx(bp,{path:"/skills",element:Te.jsx(K7,{})}),Te.jsx(bp,{path:"/contact",element:Te.jsx(aX,{})}),Te.jsx(bp,{path:"*",element:Te.jsx(gYe,{})})]})]})})}RZ(document.getElementById("root")).render(Te.jsx(_e.StrictMode,{children:Te.jsx(bYe,{})}));export{W_ as c,gF as g};
